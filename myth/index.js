var bigInt=function(undefined){"use strict";var BASE=1e7,LOG_BASE=7,MAX_INT=9007199254740992,MAX_INT_ARR=smallToArray(MAX_INT),DEFAULT_ALPHABET="0123456789abcdefghijklmnopqrstuvwxyz";var supportsNativeBigInt=typeof BigInt==="function";function Integer(v,radix,alphabet,caseSensitive){if(typeof v==="undefined")return Integer[0];if(typeof radix!=="undefined")return+radix===10&&!alphabet?parseValue(v):parseBase(v,radix,alphabet,caseSensitive);return parseValue(v)}function BigInteger(value,sign){this.value=value;this.sign=sign;this.isSmall=false}BigInteger.prototype=Object.create(Integer.prototype);function SmallInteger(value){this.value=value;this.sign=value<0;this.isSmall=true}SmallInteger.prototype=Object.create(Integer.prototype);function NativeBigInt(value){this.value=value}NativeBigInt.prototype=Object.create(Integer.prototype);function isPrecise(n){return-MAX_INT<n&&n<MAX_INT}function smallToArray(n){if(n<1e7)return[n];if(n<1e14)return[n%1e7,Math.floor(n/1e7)];return[n%1e7,Math.floor(n/1e7)%1e7,Math.floor(n/1e14)]}function arrayToSmall(arr){trim(arr);var length=arr.length;if(length<4&&compareAbs(arr,MAX_INT_ARR)<0){switch(length){case 0:return 0;case 1:return arr[0];case 2:return arr[0]+arr[1]*BASE;default:return arr[0]+(arr[1]+arr[2]*BASE)*BASE}}return arr}function trim(v){var i=v.length;while(v[--i]===0);v.length=i+1}function createArray(length){var x=new Array(length);var i=-1;while(++i<length){x[i]=0}return x}function truncate(n){if(n>0)return Math.floor(n);return Math.ceil(n)}function add(a,b){var l_a=a.length,l_b=b.length,r=new Array(l_a),carry=0,base=BASE,sum,i;for(i=0;i<l_b;i++){sum=a[i]+b[i]+carry;carry=sum>=base?1:0;r[i]=sum-carry*base}while(i<l_a){sum=a[i]+carry;carry=sum===base?1:0;r[i++]=sum-carry*base}if(carry>0)r.push(carry);return r}function addAny(a,b){if(a.length>=b.length)return add(a,b);return add(b,a)}function addSmall(a,carry){var l=a.length,r=new Array(l),base=BASE,sum,i;for(i=0;i<l;i++){sum=a[i]-base+carry;carry=Math.floor(sum/base);r[i]=sum-carry*base;carry+=1}while(carry>0){r[i++]=carry%base;carry=Math.floor(carry/base)}return r}BigInteger.prototype.add=function(v){var n=parseValue(v);if(this.sign!==n.sign){return this.subtract(n.negate())}var a=this.value,b=n.value;if(n.isSmall){return new BigInteger(addSmall(a,Math.abs(b)),this.sign)}return new BigInteger(addAny(a,b),this.sign)};BigInteger.prototype.plus=BigInteger.prototype.add;SmallInteger.prototype.add=function(v){var n=parseValue(v);var a=this.value;if(a<0!==n.sign){return this.subtract(n.negate())}var b=n.value;if(n.isSmall){if(isPrecise(a+b))return new SmallInteger(a+b);b=smallToArray(Math.abs(b))}return new BigInteger(addSmall(b,Math.abs(a)),a<0)};SmallInteger.prototype.plus=SmallInteger.prototype.add;NativeBigInt.prototype.add=function(v){return new NativeBigInt(this.value+parseValue(v).value)};NativeBigInt.prototype.plus=NativeBigInt.prototype.add;function subtract(a,b){var a_l=a.length,b_l=b.length,r=new Array(a_l),borrow=0,base=BASE,i,difference;for(i=0;i<b_l;i++){difference=a[i]-borrow-b[i];if(difference<0){difference+=base;borrow=1}else borrow=0;r[i]=difference}for(i=b_l;i<a_l;i++){difference=a[i]-borrow;if(difference<0)difference+=base;else{r[i++]=difference;break}r[i]=difference}for(;i<a_l;i++){r[i]=a[i]}trim(r);return r}function subtractAny(a,b,sign){var value;if(compareAbs(a,b)>=0){value=subtract(a,b)}else{value=subtract(b,a);sign=!sign}value=arrayToSmall(value);if(typeof value==="number"){if(sign)value=-value;return new SmallInteger(value)}return new BigInteger(value,sign)}function subtractSmall(a,b,sign){var l=a.length,r=new Array(l),carry=-b,base=BASE,i,difference;for(i=0;i<l;i++){difference=a[i]+carry;carry=Math.floor(difference/base);difference%=base;r[i]=difference<0?difference+base:difference}r=arrayToSmall(r);if(typeof r==="number"){if(sign)r=-r;return new SmallInteger(r)}return new BigInteger(r,sign)}BigInteger.prototype.subtract=function(v){var n=parseValue(v);if(this.sign!==n.sign){return this.add(n.negate())}var a=this.value,b=n.value;if(n.isSmall)return subtractSmall(a,Math.abs(b),this.sign);return subtractAny(a,b,this.sign)};BigInteger.prototype.minus=BigInteger.prototype.subtract;SmallInteger.prototype.subtract=function(v){var n=parseValue(v);var a=this.value;if(a<0!==n.sign){return this.add(n.negate())}var b=n.value;if(n.isSmall){return new SmallInteger(a-b)}return subtractSmall(b,Math.abs(a),a>=0)};SmallInteger.prototype.minus=SmallInteger.prototype.subtract;NativeBigInt.prototype.subtract=function(v){return new NativeBigInt(this.value-parseValue(v).value)};NativeBigInt.prototype.minus=NativeBigInt.prototype.subtract;BigInteger.prototype.negate=function(){return new BigInteger(this.value,!this.sign)};SmallInteger.prototype.negate=function(){var sign=this.sign;var small=new SmallInteger(-this.value);small.sign=!sign;return small};NativeBigInt.prototype.negate=function(){return new NativeBigInt(-this.value)};BigInteger.prototype.abs=function(){return new BigInteger(this.value,false)};SmallInteger.prototype.abs=function(){return new SmallInteger(Math.abs(this.value))};NativeBigInt.prototype.abs=function(){return new NativeBigInt(this.value>=0?this.value:-this.value)};function multiplyLong(a,b){var a_l=a.length,b_l=b.length,l=a_l+b_l,r=createArray(l),base=BASE,product,carry,i,a_i,b_j;for(i=0;i<a_l;++i){a_i=a[i];for(var j=0;j<b_l;++j){b_j=b[j];product=a_i*b_j+r[i+j];carry=Math.floor(product/base);r[i+j]=product-carry*base;r[i+j+1]+=carry}}trim(r);return r}function multiplySmall(a,b){var l=a.length,r=new Array(l),base=BASE,carry=0,product,i;for(i=0;i<l;i++){product=a[i]*b+carry;carry=Math.floor(product/base);r[i]=product-carry*base}while(carry>0){r[i++]=carry%base;carry=Math.floor(carry/base)}return r}function shiftLeft(x,n){var r=[];while(n-- >0)r.push(0);return r.concat(x)}function multiplyKaratsuba(x,y){var n=Math.max(x.length,y.length);if(n<=30)return multiplyLong(x,y);n=Math.ceil(n/2);var b=x.slice(n),a=x.slice(0,n),d=y.slice(n),c=y.slice(0,n);var ac=multiplyKaratsuba(a,c),bd=multiplyKaratsuba(b,d),abcd=multiplyKaratsuba(addAny(a,b),addAny(c,d));var product=addAny(addAny(ac,shiftLeft(subtract(subtract(abcd,ac),bd),n)),shiftLeft(bd,2*n));trim(product);return product}function useKaratsuba(l1,l2){return-.012*l1-.012*l2+15e-6*l1*l2>0}BigInteger.prototype.multiply=function(v){var n=parseValue(v),a=this.value,b=n.value,sign=this.sign!==n.sign,abs;if(n.isSmall){if(b===0)return Integer[0];if(b===1)return this;if(b===-1)return this.negate();abs=Math.abs(b);if(abs<BASE){return new BigInteger(multiplySmall(a,abs),sign)}b=smallToArray(abs)}if(useKaratsuba(a.length,b.length))return new BigInteger(multiplyKaratsuba(a,b),sign);return new BigInteger(multiplyLong(a,b),sign)};BigInteger.prototype.times=BigInteger.prototype.multiply;function multiplySmallAndArray(a,b,sign){if(a<BASE){return new BigInteger(multiplySmall(b,a),sign)}return new BigInteger(multiplyLong(b,smallToArray(a)),sign)}SmallInteger.prototype._multiplyBySmall=function(a){if(isPrecise(a.value*this.value)){return new SmallInteger(a.value*this.value)}return multiplySmallAndArray(Math.abs(a.value),smallToArray(Math.abs(this.value)),this.sign!==a.sign)};BigInteger.prototype._multiplyBySmall=function(a){if(a.value===0)return Integer[0];if(a.value===1)return this;if(a.value===-1)return this.negate();return multiplySmallAndArray(Math.abs(a.value),this.value,this.sign!==a.sign)};SmallInteger.prototype.multiply=function(v){return parseValue(v)._multiplyBySmall(this)};SmallInteger.prototype.times=SmallInteger.prototype.multiply;NativeBigInt.prototype.multiply=function(v){return new NativeBigInt(this.value*parseValue(v).value)};NativeBigInt.prototype.times=NativeBigInt.prototype.multiply;function square(a){var l=a.length,r=createArray(l+l),base=BASE,product,carry,i,a_i,a_j;for(i=0;i<l;i++){a_i=a[i];carry=0-a_i*a_i;for(var j=i;j<l;j++){a_j=a[j];product=2*(a_i*a_j)+r[i+j]+carry;carry=Math.floor(product/base);r[i+j]=product-carry*base}r[i+l]=carry}trim(r);return r}BigInteger.prototype.square=function(){return new BigInteger(square(this.value),false)};SmallInteger.prototype.square=function(){var value=this.value*this.value;if(isPrecise(value))return new SmallInteger(value);return new BigInteger(square(smallToArray(Math.abs(this.value))),false)};NativeBigInt.prototype.square=function(v){return new NativeBigInt(this.value*this.value)};function divMod1(a,b){var a_l=a.length,b_l=b.length,base=BASE,result=createArray(b.length),divisorMostSignificantDigit=b[b_l-1],lambda=Math.ceil(base/(2*divisorMostSignificantDigit)),remainder=multiplySmall(a,lambda),divisor=multiplySmall(b,lambda),quotientDigit,shift,carry,borrow,i,l,q;if(remainder.length<=a_l)remainder.push(0);divisor.push(0);divisorMostSignificantDigit=divisor[b_l-1];for(shift=a_l-b_l;shift>=0;shift--){quotientDigit=base-1;if(remainder[shift+b_l]!==divisorMostSignificantDigit){quotientDigit=Math.floor((remainder[shift+b_l]*base+remainder[shift+b_l-1])/divisorMostSignificantDigit)}carry=0;borrow=0;l=divisor.length;for(i=0;i<l;i++){carry+=quotientDigit*divisor[i];q=Math.floor(carry/base);borrow+=remainder[shift+i]-(carry-q*base);carry=q;if(borrow<0){remainder[shift+i]=borrow+base;borrow=-1}else{remainder[shift+i]=borrow;borrow=0}}while(borrow!==0){quotientDigit-=1;carry=0;for(i=0;i<l;i++){carry+=remainder[shift+i]-base+divisor[i];if(carry<0){remainder[shift+i]=carry+base;carry=0}else{remainder[shift+i]=carry;carry=1}}borrow+=carry}result[shift]=quotientDigit}remainder=divModSmall(remainder,lambda)[0];return[arrayToSmall(result),arrayToSmall(remainder)]}function divMod2(a,b){var a_l=a.length,b_l=b.length,result=[],part=[],base=BASE,guess,xlen,highx,highy,check;while(a_l){part.unshift(a[--a_l]);trim(part);if(compareAbs(part,b)<0){result.push(0);continue}xlen=part.length;highx=part[xlen-1]*base+part[xlen-2];highy=b[b_l-1]*base+b[b_l-2];if(xlen>b_l){highx=(highx+1)*base}guess=Math.ceil(highx/highy);do{check=multiplySmall(b,guess);if(compareAbs(check,part)<=0)break;guess--}while(guess);result.push(guess);part=subtract(part,check)}result.reverse();return[arrayToSmall(result),arrayToSmall(part)]}function divModSmall(value,lambda){var length=value.length,quotient=createArray(length),base=BASE,i,q,remainder,divisor;remainder=0;for(i=length-1;i>=0;--i){divisor=remainder*base+value[i];q=truncate(divisor/lambda);remainder=divisor-q*lambda;quotient[i]=q|0}return[quotient,remainder|0]}function divModAny(self,v){var value,n=parseValue(v);if(supportsNativeBigInt){return[new NativeBigInt(self.value/n.value),new NativeBigInt(self.value%n.value)]}var a=self.value,b=n.value;var quotient;if(b===0)throw new Error("Cannot divide by zero");if(self.isSmall){if(n.isSmall){return[new SmallInteger(truncate(a/b)),new SmallInteger(a%b)]}return[Integer[0],self]}if(n.isSmall){if(b===1)return[self,Integer[0]];if(b==-1)return[self.negate(),Integer[0]];var abs=Math.abs(b);if(abs<BASE){value=divModSmall(a,abs);quotient=arrayToSmall(value[0]);var remainder=value[1];if(self.sign)remainder=-remainder;if(typeof quotient==="number"){if(self.sign!==n.sign)quotient=-quotient;return[new SmallInteger(quotient),new SmallInteger(remainder)]}return[new BigInteger(quotient,self.sign!==n.sign),new SmallInteger(remainder)]}b=smallToArray(abs)}var comparison=compareAbs(a,b);if(comparison===-1)return[Integer[0],self];if(comparison===0)return[Integer[self.sign===n.sign?1:-1],Integer[0]];if(a.length+b.length<=200)value=divMod1(a,b);else value=divMod2(a,b);quotient=value[0];var qSign=self.sign!==n.sign,mod=value[1],mSign=self.sign;if(typeof quotient==="number"){if(qSign)quotient=-quotient;quotient=new SmallInteger(quotient)}else quotient=new BigInteger(quotient,qSign);if(typeof mod==="number"){if(mSign)mod=-mod;mod=new SmallInteger(mod)}else mod=new BigInteger(mod,mSign);return[quotient,mod]}BigInteger.prototype.divmod=function(v){var result=divModAny(this,v);return{quotient:result[0],remainder:result[1]}};NativeBigInt.prototype.divmod=SmallInteger.prototype.divmod=BigInteger.prototype.divmod;BigInteger.prototype.divide=function(v){return divModAny(this,v)[0]};NativeBigInt.prototype.over=NativeBigInt.prototype.divide=SmallInteger.prototype.over=SmallInteger.prototype.divide=BigInteger.prototype.over=BigInteger.prototype.divide;BigInteger.prototype.mod=function(v){return divModAny(this,v)[1]};NativeBigInt.prototype.mod=NativeBigInt.prototype.remainder=SmallInteger.prototype.remainder=SmallInteger.prototype.mod=BigInteger.prototype.remainder=BigInteger.prototype.mod;BigInteger.prototype.pow=function(v){var n=parseValue(v),a=this.value,b=n.value,value,x,y;if(b===0)return Integer[1];if(a===0)return Integer[0];if(a===1)return Integer[1];if(a===-1)return n.isEven()?Integer[1]:Integer[-1];if(n.sign){return Integer[0]}if(!n.isSmall)throw new Error("The exponent "+n.toString()+" is too large.");if(this.isSmall){if(isPrecise(value=Math.pow(a,b)))return new SmallInteger(truncate(value))}x=this;y=Integer[1];while(true){if(b&1===1){y=y.times(x);--b}if(b===0)break;b/=2;x=x.square()}return y};SmallInteger.prototype.pow=BigInteger.prototype.pow;var pow;if(supportsNativeBigInt){pow=eval("(a,b)=>a**b")}NativeBigInt.prototype.pow=function(v){var n=parseValue(v);var a=this.value,b=n.value;if(b===BigInt(0))return Integer[1];if(a===BigInt(0))return Integer[0];if(a===BigInt(1))return Integer[1];if(a===BigInt(-1))return n.isEven()?Integer[1]:Integer[-1];if(n.isNegative())return new NativeBigInt(BigInt(0));return new NativeBigInt(pow(a,b))};BigInteger.prototype.modPow=function(exp,mod){exp=parseValue(exp);mod=parseValue(mod);if(mod.isZero())throw new Error("Cannot take modPow with modulus 0");var r=Integer[1],base=this.mod(mod);while(exp.isPositive()){if(base.isZero())return Integer[0];if(exp.isOdd())r=r.multiply(base).mod(mod);exp=exp.divide(2);base=base.square().mod(mod)}return r};NativeBigInt.prototype.modPow=SmallInteger.prototype.modPow=BigInteger.prototype.modPow;function compareAbs(a,b){if(a.length!==b.length){return a.length>b.length?1:-1}for(var i=a.length-1;i>=0;i--){if(a[i]!==b[i])return a[i]>b[i]?1:-1}return 0}BigInteger.prototype.compareAbs=function(v){var n=parseValue(v),a=this.value,b=n.value;if(n.isSmall)return 1;return compareAbs(a,b)};SmallInteger.prototype.compareAbs=function(v){var n=parseValue(v),a=Math.abs(this.value),b=n.value;if(n.isSmall){b=Math.abs(b);return a===b?0:a>b?1:-1}return-1};NativeBigInt.prototype.compareAbs=function(v){var a=this.value;var b=parseValue(v).value;a=a>=0?a:-a;b=b>=0?b:-b;return a===b?0:a>b?1:-1};BigInteger.prototype.compare=function(v){if(v===Infinity){return-1}if(v===-Infinity){return 1}var n=parseValue(v),a=this.value,b=n.value;if(this.sign!==n.sign){return n.sign?1:-1}if(n.isSmall){return this.sign?-1:1}return compareAbs(a,b)*(this.sign?-1:1)};BigInteger.prototype.compareTo=BigInteger.prototype.compare;SmallInteger.prototype.compare=function(v){if(v===Infinity){return-1}if(v===-Infinity){return 1}var n=parseValue(v),a=this.value,b=n.value;if(n.isSmall){return a==b?0:a>b?1:-1}if(a<0!==n.sign){return a<0?-1:1}return a<0?1:-1};SmallInteger.prototype.compareTo=SmallInteger.prototype.compare;NativeBigInt.prototype.compare=function(v){if(v===Infinity){return-1}if(v===-Infinity){return 1}var a=this.value;var b=parseValue(v).value;return a===b?0:a>b?1:-1};NativeBigInt.prototype.compareTo=NativeBigInt.prototype.compare;BigInteger.prototype.equals=function(v){return this.compare(v)===0};NativeBigInt.prototype.eq=NativeBigInt.prototype.equals=SmallInteger.prototype.eq=SmallInteger.prototype.equals=BigInteger.prototype.eq=BigInteger.prototype.equals;BigInteger.prototype.notEquals=function(v){return this.compare(v)!==0};NativeBigInt.prototype.neq=NativeBigInt.prototype.notEquals=SmallInteger.prototype.neq=SmallInteger.prototype.notEquals=BigInteger.prototype.neq=BigInteger.prototype.notEquals;BigInteger.prototype.greater=function(v){return this.compare(v)>0};NativeBigInt.prototype.gt=NativeBigInt.prototype.greater=SmallInteger.prototype.gt=SmallInteger.prototype.greater=BigInteger.prototype.gt=BigInteger.prototype.greater;BigInteger.prototype.lesser=function(v){return this.compare(v)<0};NativeBigInt.prototype.lt=NativeBigInt.prototype.lesser=SmallInteger.prototype.lt=SmallInteger.prototype.lesser=BigInteger.prototype.lt=BigInteger.prototype.lesser;BigInteger.prototype.greaterOrEquals=function(v){return this.compare(v)>=0};NativeBigInt.prototype.geq=NativeBigInt.prototype.greaterOrEquals=SmallInteger.prototype.geq=SmallInteger.prototype.greaterOrEquals=BigInteger.prototype.geq=BigInteger.prototype.greaterOrEquals;BigInteger.prototype.lesserOrEquals=function(v){return this.compare(v)<=0};NativeBigInt.prototype.leq=NativeBigInt.prototype.lesserOrEquals=SmallInteger.prototype.leq=SmallInteger.prototype.lesserOrEquals=BigInteger.prototype.leq=BigInteger.prototype.lesserOrEquals;BigInteger.prototype.isEven=function(){return(this.value[0]&1)===0};SmallInteger.prototype.isEven=function(){return(this.value&1)===0};NativeBigInt.prototype.isEven=function(){return(this.value&BigInt(1))===BigInt(0)};BigInteger.prototype.isOdd=function(){return(this.value[0]&1)===1};SmallInteger.prototype.isOdd=function(){return(this.value&1)===1};NativeBigInt.prototype.isOdd=function(){return(this.value&BigInt(1))===BigInt(1)};BigInteger.prototype.isPositive=function(){return!this.sign};SmallInteger.prototype.isPositive=function(){return this.value>0};NativeBigInt.prototype.isPositive=SmallInteger.prototype.isPositive;BigInteger.prototype.isNegative=function(){return this.sign};SmallInteger.prototype.isNegative=function(){return this.value<0};NativeBigInt.prototype.isNegative=SmallInteger.prototype.isNegative;BigInteger.prototype.isUnit=function(){return false};SmallInteger.prototype.isUnit=function(){return Math.abs(this.value)===1};NativeBigInt.prototype.isUnit=function(){return this.abs().value===BigInt(1)};BigInteger.prototype.isZero=function(){return false};SmallInteger.prototype.isZero=function(){return this.value===0};NativeBigInt.prototype.isZero=function(){return this.value===BigInt(0)};BigInteger.prototype.isDivisibleBy=function(v){var n=parseValue(v);if(n.isZero())return false;if(n.isUnit())return true;if(n.compareAbs(2)===0)return this.isEven();return this.mod(n).isZero()};NativeBigInt.prototype.isDivisibleBy=SmallInteger.prototype.isDivisibleBy=BigInteger.prototype.isDivisibleBy;function isBasicPrime(v){var n=v.abs();if(n.isUnit())return false;if(n.equals(2)||n.equals(3)||n.equals(5))return true;if(n.isEven()||n.isDivisibleBy(3)||n.isDivisibleBy(5))return false;if(n.lesser(49))return true}function millerRabinTest(n,a){var nPrev=n.prev(),b=nPrev,r=0,d,t,i,x;while(b.isEven())b=b.divide(2),r++;next:for(i=0;i<a.length;i++){if(n.lesser(a[i]))continue;x=bigInt(a[i]).modPow(b,n);if(x.isUnit()||x.equals(nPrev))continue;for(d=r-1;d!=0;d--){x=x.square().mod(n);if(x.isUnit())return false;if(x.equals(nPrev))continue next}return false}return true}BigInteger.prototype.isPrime=function(strict){var isPrime=isBasicPrime(this);if(isPrime!==undefined)return isPrime;var n=this.abs();var bits=n.bitLength();if(bits<=64)return millerRabinTest(n,[2,3,5,7,11,13,17,19,23,29,31,37]);var logN=Math.log(2)*bits.toJSNumber();var t=Math.ceil(strict===true?2*Math.pow(logN,2):logN);for(var a=[],i=0;i<t;i++){a.push(bigInt(i+2))}return millerRabinTest(n,a)};NativeBigInt.prototype.isPrime=SmallInteger.prototype.isPrime=BigInteger.prototype.isPrime;BigInteger.prototype.isProbablePrime=function(iterations){var isPrime=isBasicPrime(this);if(isPrime!==undefined)return isPrime;var n=this.abs();var t=iterations===undefined?5:iterations;for(var a=[],i=0;i<t;i++){a.push(bigInt.randBetween(2,n.minus(2)))}return millerRabinTest(n,a)};NativeBigInt.prototype.isProbablePrime=SmallInteger.prototype.isProbablePrime=BigInteger.prototype.isProbablePrime;BigInteger.prototype.modInv=function(n){var t=bigInt.zero,newT=bigInt.one,r=parseValue(n),newR=this.abs(),q,lastT,lastR;while(!newR.isZero()){q=r.divide(newR);lastT=t;lastR=r;t=newT;r=newR;newT=lastT.subtract(q.multiply(newT));newR=lastR.subtract(q.multiply(newR))}if(!r.isUnit())throw new Error(this.toString()+" and "+n.toString()+" are not co-prime");if(t.compare(0)===-1){t=t.add(n)}if(this.isNegative()){return t.negate()}return t};NativeBigInt.prototype.modInv=SmallInteger.prototype.modInv=BigInteger.prototype.modInv;BigInteger.prototype.next=function(){var value=this.value;if(this.sign){return subtractSmall(value,1,this.sign)}return new BigInteger(addSmall(value,1),this.sign)};SmallInteger.prototype.next=function(){var value=this.value;if(value+1<MAX_INT)return new SmallInteger(value+1);return new BigInteger(MAX_INT_ARR,false)};NativeBigInt.prototype.next=function(){return new NativeBigInt(this.value+BigInt(1))};BigInteger.prototype.prev=function(){var value=this.value;if(this.sign){return new BigInteger(addSmall(value,1),true)}return subtractSmall(value,1,this.sign)};SmallInteger.prototype.prev=function(){var value=this.value;if(value-1>-MAX_INT)return new SmallInteger(value-1);return new BigInteger(MAX_INT_ARR,true)};NativeBigInt.prototype.prev=function(){return new NativeBigInt(this.value-BigInt(1))};var powersOfTwo=[1];while(2*powersOfTwo[powersOfTwo.length-1]<=BASE)powersOfTwo.push(2*powersOfTwo[powersOfTwo.length-1]);var powers2Length=powersOfTwo.length,highestPower2=powersOfTwo[powers2Length-1];function shift_isSmall(n){return Math.abs(n)<=BASE}BigInteger.prototype.shiftLeft=function(v){var n=parseValue(v).toJSNumber();if(!shift_isSmall(n)){throw new Error(String(n)+" is too large for shifting.")}if(n<0)return this.shiftRight(-n);var result=this;if(result.isZero())return result;while(n>=powers2Length){result=result.multiply(highestPower2);n-=powers2Length-1}return result.multiply(powersOfTwo[n])};NativeBigInt.prototype.shiftLeft=SmallInteger.prototype.shiftLeft=BigInteger.prototype.shiftLeft;BigInteger.prototype.shiftRight=function(v){var remQuo;var n=parseValue(v).toJSNumber();if(!shift_isSmall(n)){throw new Error(String(n)+" is too large for shifting.")}if(n<0)return this.shiftLeft(-n);var result=this;while(n>=powers2Length){if(result.isZero()||result.isNegative()&&result.isUnit())return result;remQuo=divModAny(result,highestPower2);result=remQuo[1].isNegative()?remQuo[0].prev():remQuo[0];n-=powers2Length-1}remQuo=divModAny(result,powersOfTwo[n]);return remQuo[1].isNegative()?remQuo[0].prev():remQuo[0]};NativeBigInt.prototype.shiftRight=SmallInteger.prototype.shiftRight=BigInteger.prototype.shiftRight;function bitwise(x,y,fn){y=parseValue(y);var xSign=x.isNegative(),ySign=y.isNegative();var xRem=xSign?x.not():x,yRem=ySign?y.not():y;var xDigit=0,yDigit=0;var xDivMod=null,yDivMod=null;var result=[];while(!xRem.isZero()||!yRem.isZero()){xDivMod=divModAny(xRem,highestPower2);xDigit=xDivMod[1].toJSNumber();if(xSign){xDigit=highestPower2-1-xDigit}yDivMod=divModAny(yRem,highestPower2);yDigit=yDivMod[1].toJSNumber();if(ySign){yDigit=highestPower2-1-yDigit}xRem=xDivMod[0];yRem=yDivMod[0];result.push(fn(xDigit,yDigit))}var sum=fn(xSign?1:0,ySign?1:0)!==0?bigInt(-1):bigInt(0);for(var i=result.length-1;i>=0;i-=1){sum=sum.multiply(highestPower2).add(bigInt(result[i]))}return sum}BigInteger.prototype.not=function(){return this.negate().prev()};NativeBigInt.prototype.not=SmallInteger.prototype.not=BigInteger.prototype.not;BigInteger.prototype.and=function(n){return bitwise(this,n,function(a,b){return a&b})};NativeBigInt.prototype.and=SmallInteger.prototype.and=BigInteger.prototype.and;BigInteger.prototype.or=function(n){return bitwise(this,n,function(a,b){return a|b})};NativeBigInt.prototype.or=SmallInteger.prototype.or=BigInteger.prototype.or;BigInteger.prototype.xor=function(n){return bitwise(this,n,function(a,b){return a^b})};NativeBigInt.prototype.xor=SmallInteger.prototype.xor=BigInteger.prototype.xor;var LOBMASK_I=1<<30,LOBMASK_BI=(BASE&-BASE)*(BASE&-BASE)|LOBMASK_I;function roughLOB(n){var v=n.value,x=typeof v==="number"?v|LOBMASK_I:typeof v==="bigint"?v|BigInt(LOBMASK_I):v[0]+v[1]*BASE|LOBMASK_BI;return x&-x}function integerLogarithm(value,base){if(base.compareTo(value)<=0){var tmp=integerLogarithm(value,base.square(base));var p=tmp.p;var e=tmp.e;var t=p.multiply(base);return t.compareTo(value)<=0?{p:t,e:e*2+1}:{p:p,e:e*2}}return{p:bigInt(1),e:0}}BigInteger.prototype.bitLength=function(){var n=this;if(n.compareTo(bigInt(0))<0){n=n.negate().subtract(bigInt(1))}if(n.compareTo(bigInt(0))===0){return bigInt(0)}return bigInt(integerLogarithm(n,bigInt(2)).e).add(bigInt(1))};NativeBigInt.prototype.bitLength=SmallInteger.prototype.bitLength=BigInteger.prototype.bitLength;function max(a,b){a=parseValue(a);b=parseValue(b);return a.greater(b)?a:b}function min(a,b){a=parseValue(a);b=parseValue(b);return a.lesser(b)?a:b}function gcd(a,b){a=parseValue(a).abs();b=parseValue(b).abs();if(a.equals(b))return a;if(a.isZero())return b;if(b.isZero())return a;var c=Integer[1],d,t;while(a.isEven()&&b.isEven()){d=min(roughLOB(a),roughLOB(b));a=a.divide(d);b=b.divide(d);c=c.multiply(d)}while(a.isEven()){a=a.divide(roughLOB(a))}do{while(b.isEven()){b=b.divide(roughLOB(b))}if(a.greater(b)){t=b;b=a;a=t}b=b.subtract(a)}while(!b.isZero());return c.isUnit()?a:a.multiply(c)}function lcm(a,b){a=parseValue(a).abs();b=parseValue(b).abs();return a.divide(gcd(a,b)).multiply(b)}function randBetween(a,b){a=parseValue(a);b=parseValue(b);var low=min(a,b),high=max(a,b);var range=high.subtract(low).add(1);if(range.isSmall)return low.add(Math.floor(Math.random()*range));var digits=toBase(range,BASE).value;var result=[],restricted=true;for(var i=0;i<digits.length;i++){var top=restricted?digits[i]:BASE;var digit=truncate(Math.random()*top);result.push(digit);if(digit<top)restricted=false}return low.add(Integer.fromArray(result,BASE,false))}var parseBase=function(text,base,alphabet,caseSensitive){alphabet=alphabet||DEFAULT_ALPHABET;text=String(text);if(!caseSensitive){text=text.toLowerCase();alphabet=alphabet.toLowerCase()}var length=text.length;var i;var absBase=Math.abs(base);var alphabetValues={};for(i=0;i<alphabet.length;i++){alphabetValues[alphabet[i]]=i}for(i=0;i<length;i++){var c=text[i];if(c==="-")continue;if(c in alphabetValues){if(alphabetValues[c]>=absBase){if(c==="1"&&absBase===1)continue;throw new Error(c+" is not a valid digit in base "+base+".")}}}base=parseValue(base);var digits=[];var isNegative=text[0]==="-";for(i=isNegative?1:0;i<text.length;i++){var c=text[i];if(c in alphabetValues)digits.push(parseValue(alphabetValues[c]));else if(c==="<"){var start=i;do{i++}while(text[i]!==">"&&i<text.length);digits.push(parseValue(text.slice(start+1,i)))}else throw new Error(c+" is not a valid character")}return parseBaseFromArray(digits,base,isNegative)};function parseBaseFromArray(digits,base,isNegative){var val=Integer[0],pow=Integer[1],i;for(i=digits.length-1;i>=0;i--){val=val.add(digits[i].times(pow));pow=pow.times(base)}return isNegative?val.negate():val}function stringify(digit,alphabet){alphabet=alphabet||DEFAULT_ALPHABET;if(digit<alphabet.length){return alphabet[digit]}return"<"+digit+">"}function toBase(n,base){base=bigInt(base);if(base.isZero()){if(n.isZero())return{value:[0],isNegative:false};throw new Error("Cannot convert nonzero numbers to base 0.")}if(base.equals(-1)){if(n.isZero())return{value:[0],isNegative:false};if(n.isNegative())return{value:[].concat.apply([],Array.apply(null,Array(-n.toJSNumber())).map(Array.prototype.valueOf,[1,0])),isNegative:false};var arr=Array.apply(null,Array(n.toJSNumber()-1)).map(Array.prototype.valueOf,[0,1]);arr.unshift([1]);return{value:[].concat.apply([],arr),isNegative:false}}var neg=false;if(n.isNegative()&&base.isPositive()){neg=true;n=n.abs()}if(base.isUnit()){if(n.isZero())return{value:[0],isNegative:false};return{value:Array.apply(null,Array(n.toJSNumber())).map(Number.prototype.valueOf,1),isNegative:neg}}var out=[];var left=n,divmod;while(left.isNegative()||left.compareAbs(base)>=0){divmod=left.divmod(base);left=divmod.quotient;var digit=divmod.remainder;if(digit.isNegative()){digit=base.minus(digit).abs();left=left.next()}out.push(digit.toJSNumber())}out.push(left.toJSNumber());return{value:out.reverse(),isNegative:neg}}function toBaseString(n,base,alphabet){var arr=toBase(n,base);return(arr.isNegative?"-":"")+arr.value.map(function(x){return stringify(x,alphabet)}).join("")}BigInteger.prototype.toArray=function(radix){return toBase(this,radix)};SmallInteger.prototype.toArray=function(radix){return toBase(this,radix)};NativeBigInt.prototype.toArray=function(radix){return toBase(this,radix)};BigInteger.prototype.toString=function(radix,alphabet){if(radix===undefined)radix=10;if(radix!==10)return toBaseString(this,radix,alphabet);var v=this.value,l=v.length,str=String(v[--l]),zeros="0000000",digit;while(--l>=0){digit=String(v[l]);str+=zeros.slice(digit.length)+digit}var sign=this.sign?"-":"";return sign+str};SmallInteger.prototype.toString=function(radix,alphabet){if(radix===undefined)radix=10;if(radix!=10)return toBaseString(this,radix,alphabet);return String(this.value)};NativeBigInt.prototype.toString=SmallInteger.prototype.toString;NativeBigInt.prototype.toJSON=BigInteger.prototype.toJSON=SmallInteger.prototype.toJSON=function(){return this.toString()};BigInteger.prototype.valueOf=function(){return parseInt(this.toString(),10)};BigInteger.prototype.toJSNumber=BigInteger.prototype.valueOf;SmallInteger.prototype.valueOf=function(){return this.value};SmallInteger.prototype.toJSNumber=SmallInteger.prototype.valueOf;NativeBigInt.prototype.valueOf=NativeBigInt.prototype.toJSNumber=function(){return parseInt(this.toString(),10)};function parseStringValue(v){if(isPrecise(+v)){var x=+v;if(x===truncate(x))return supportsNativeBigInt?new NativeBigInt(BigInt(x)):new SmallInteger(x);throw new Error("Invalid integer: "+v)}var sign=v[0]==="-";if(sign)v=v.slice(1);var split=v.split(/e/i);if(split.length>2)throw new Error("Invalid integer: "+split.join("e"));if(split.length===2){var exp=split[1];if(exp[0]==="+")exp=exp.slice(1);exp=+exp;if(exp!==truncate(exp)||!isPrecise(exp))throw new Error("Invalid integer: "+exp+" is not a valid exponent.");var text=split[0];var decimalPlace=text.indexOf(".");if(decimalPlace>=0){exp-=text.length-decimalPlace-1;text=text.slice(0,decimalPlace)+text.slice(decimalPlace+1)}if(exp<0)throw new Error("Cannot include negative exponent part for integers");text+=new Array(exp+1).join("0");v=text}var isValid=/^([0-9][0-9]*)$/.test(v);if(!isValid)throw new Error("Invalid integer: "+v);if(supportsNativeBigInt){return new NativeBigInt(BigInt(sign?"-"+v:v))}var r=[],max=v.length,l=LOG_BASE,min=max-l;while(max>0){r.push(+v.slice(min,max));min-=l;if(min<0)min=0;max-=l}trim(r);return new BigInteger(r,sign)}function parseNumberValue(v){if(supportsNativeBigInt){return new NativeBigInt(BigInt(v))}if(isPrecise(v)){if(v!==truncate(v))throw new Error(v+" is not an integer.");return new SmallInteger(v)}return parseStringValue(v.toString())}function parseValue(v){if(typeof v==="number"){return parseNumberValue(v)}if(typeof v==="string"){return parseStringValue(v)}if(typeof v==="bigint"){return new NativeBigInt(v)}return v}for(var i=0;i<1e3;i++){Integer[i]=parseValue(i);if(i>0)Integer[-i]=parseValue(-i)}Integer.one=Integer[1];Integer.zero=Integer[0];Integer.minusOne=Integer[-1];Integer.max=max;Integer.min=min;Integer.gcd=gcd;Integer.lcm=lcm;Integer.isInstance=function(x){return x instanceof BigInteger||x instanceof SmallInteger||x instanceof NativeBigInt};Integer.randBetween=randBetween;Integer.fromArray=function(digits,base,isNegative){return parseBaseFromArray(digits.map(parseValue),parseValue(base||10),isNegative)};return Integer}();if(typeof module!=="undefined"&&module.hasOwnProperty("exports")){module.exports=bigInt}if(typeof define==="function"&&define.amd){define("big-integer",[],function(){return bigInt})}
(function(root,factory){"use strict";if(typeof define==="function"&&define.amd){define([],factory)}else if(typeof exports==="object"){module.exports=factory()}else{root.textFit=factory()}})(typeof global==="object"?global:this,function(){"use strict";var defaultSettings={alignVert:false,alignHoriz:false,multiLine:false,detectMultiLine:true,minFontSize:12,maxFontSize:30,reProcess:true,widthOnly:false,alignVertWithFlexbox:false};return function textFit(els,options){if(!options)options={};var settings={};for(var key in defaultSettings){if(options.hasOwnProperty(key)){settings[key]=options[key]}else{settings[key]=defaultSettings[key]}}if(typeof els.toArray==="function"){els=els.toArray()}var elType=Object.prototype.toString.call(els);if(elType!=="[object Array]"&&elType!=="[object NodeList]"&&elType!=="[object HTMLCollection]"){els=[els]}for(var i=0;i<els.length;i++){processItem(els[i],settings)}};function processItem(el,settings){if(!isElement(el)||!settings.reProcess&&el.getAttribute("textFitted")){return false}if(!settings.reProcess){el.setAttribute("textFitted",1)}var innerSpan,originalHeight,originalHTML,originalWidth;var low,mid,high;originalHTML=el.innerHTML;originalWidth=innerWidth(el);originalHeight=innerHeight(el);if(!originalWidth||!settings.widthOnly&&!originalHeight){if(!settings.widthOnly)throw new Error("Set a static height and width on the target element "+el.outerHTML+" before using textFit!");else throw new Error("Set a static width on the target element "+el.outerHTML+" before using textFit!")}if(originalHTML.indexOf("textFitted")===-1){innerSpan=document.createElement("span");innerSpan.className="textFitted";innerSpan.style["display"]="inline-block";innerSpan.innerHTML=originalHTML;el.innerHTML="";el.appendChild(innerSpan)}else{innerSpan=el.querySelector("span.textFitted");if(hasClass(innerSpan,"textFitAlignVert")){innerSpan.className=innerSpan.className.replace("textFitAlignVert","");innerSpan.style["height"]="";el.className.replace("textFitAlignVertFlex","")}}if(settings.alignHoriz){el.style["text-align"]="center";innerSpan.style["text-align"]="center"}var multiLine=settings.multiLine;if(settings.detectMultiLine&&!multiLine&&innerSpan.scrollHeight>=parseInt(window.getComputedStyle(innerSpan)["font-size"],10)*2){multiLine=true}if(!multiLine){el.style["white-space"]="nowrap"}low=settings.minFontSize;high=settings.maxFontSize;if (el.style.fontSize) high = el.style.fontSize.substring(0, el.style.fontSize.length - 2);var size=low;while(low<=high){mid=high+low>>1;innerSpan.style.fontSize=mid+"px";if(innerSpan.scrollWidth<=originalWidth+2&&(settings.widthOnly||innerSpan.scrollHeight<=originalHeight)){size=mid;low=mid+1}else{high=mid-1}}if(innerSpan.style.fontSize!=size+"px")innerSpan.style.fontSize=size+"px";if(settings.alignVert){addStyleSheet();var height=innerSpan.scrollHeight;if(window.getComputedStyle(el)["position"]==="static"){el.style["position"]="relative"}if(!hasClass(innerSpan,"textFitAlignVert")){innerSpan.className=innerSpan.className+" textFitAlignVert"}innerSpan.style["height"]=height+"px";if(settings.alignVertWithFlexbox&&!hasClass(el,"textFitAlignVertFlex")){el.className=el.className+" textFitAlignVertFlex"}}}function innerHeight(el){var style=window.getComputedStyle(el,null);return el.clientHeight-parseInt(style.getPropertyValue("padding-top"),10)-parseInt(style.getPropertyValue("padding-bottom"),10)}function innerWidth(el){var style=window.getComputedStyle(el,null);return el.clientWidth-parseInt(style.getPropertyValue("padding-left"),10)-parseInt(style.getPropertyValue("padding-right"),10)}function isElement(o){return typeof HTMLElement==="object"?o instanceof HTMLElement:o&&typeof o==="object"&&o!==null&&o.nodeType===1&&typeof o.nodeName==="string"}function hasClass(element,cls){return(" "+element.className+" ").indexOf(" "+cls+" ")>-1}function addStyleSheet(){if(document.getElementById("textFitStyleSheet"))return;var style=[".textFitAlignVert{","position: absolute;","top: 0; right: 0; bottom: 0; left: 0;","margin: auto;","display: flex;","justify-content: center;","flex-direction: column;","}",".textFitAlignVertFlex{","display: flex;","}",".textFitAlignVertFlex .textFitAlignVert{","position: static;","}"].join("");var css=document.createElement("style");css.type="text/css";css.id="textFitStyleSheet";css.innerHTML=style;document.body.appendChild(css)}});

(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==='object'&&typeof module==='object')
    module.exports=factory();else if(typeof define==='function'&&define.amd)
    define("Phaser",[],factory);else if(typeof exports==='object')
    exports["Phaser"]=factory();else
    root["Phaser"]=factory();})(window,function(){return(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports;}
    var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports;}
    __webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter});}};__webpack_require__.r=function(exports){if(typeof Symbol!=='undefined'&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:'Module'});}
        Object.defineProperty(exports,'__esModule',{value:true});};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if((mode&4)&&typeof value==='object'&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,'default',{enumerable:true,value:value});if(mode&2&&typeof value!='string')for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key];}.bind(null,key));return ns;};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module['default'];}:function getModuleExports(){return module;};__webpack_require__.d(getter,'a',getter);return getter;};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property);};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s="./phaser.js");})
({"../node_modules/eventemitter3/index.js":(function(module,exports,__webpack_require__){"use strict";var has=Object.prototype.hasOwnProperty,prefix='~';function Events(){}
        if(Object.create){Events.prototype=Object.create(null);if(!new Events().__proto__)prefix=false;}
        function EE(fn,context,once){this.fn=fn;this.context=context;this.once=once||false;}
        function addListener(emitter,event,fn,context,once){if(typeof fn!=='function'){throw new TypeError('The listener must be a function');}
            var listener=new EE(fn,context||emitter,once),evt=prefix?prefix+event:event;if(!emitter._events[evt])emitter._events[evt]=listener,emitter._eventsCount++;else if(!emitter._events[evt].fn)emitter._events[evt].push(listener);else emitter._events[evt]=[emitter._events[evt],listener];return emitter;}
        function clearEvent(emitter,evt){if(--emitter._eventsCount===0)emitter._events=new Events();else delete emitter._events[evt];}
        function EventEmitter(){this._events=new Events();this._eventsCount=0;}
        EventEmitter.prototype.eventNames=function eventNames(){var names=[],events,name;if(this._eventsCount===0)return names;for(name in(events=this._events)){if(has.call(events,name))names.push(prefix?name.slice(1):name);}
            if(Object.getOwnPropertySymbols){return names.concat(Object.getOwnPropertySymbols(events));}
            return names;};EventEmitter.prototype.listeners=function listeners(event){var evt=prefix?prefix+event:event,handlers=this._events[evt];if(!handlers)return[];if(handlers.fn)return[handlers.fn];for(var i=0,l=handlers.length,ee=new Array(l);i<l;i++){ee[i]=handlers[i].fn;}
            return ee;};EventEmitter.prototype.listenerCount=function listenerCount(event){var evt=prefix?prefix+event:event,listeners=this._events[evt];if(!listeners)return 0;if(listeners.fn)return 1;return listeners.length;};EventEmitter.prototype.emit=function emit(event,a1,a2,a3,a4,a5){var evt=prefix?prefix+event:event;if(!this._events[evt])return false;var listeners=this._events[evt],len=arguments.length,args,i;if(listeners.fn){if(listeners.once)this.removeListener(event,listeners.fn,undefined,true);switch(len){case 1:return listeners.fn.call(listeners.context),true;case 2:return listeners.fn.call(listeners.context,a1),true;case 3:return listeners.fn.call(listeners.context,a1,a2),true;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),true;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),true;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),true;}
            for(i=1,args=new Array(len-1);i<len;i++){args[i-1]=arguments[i];}
            listeners.fn.apply(listeners.context,args);}else{var length=listeners.length,j;for(i=0;i<length;i++){if(listeners[i].once)this.removeListener(event,listeners[i].fn,undefined,true);switch(len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;case 4:listeners[i].fn.call(listeners[i].context,a1,a2,a3);break;default:if(!args)for(j=1,args=new Array(len-1);j<len;j++){args[j-1]=arguments[j];}
            listeners[i].fn.apply(listeners[i].context,args);}}}
            return true;};EventEmitter.prototype.on=function on(event,fn,context){return addListener(this,event,fn,context,false);};EventEmitter.prototype.once=function once(event,fn,context){return addListener(this,event,fn,context,true);};EventEmitter.prototype.removeListener=function removeListener(event,fn,context,once){var evt=prefix?prefix+event:event;if(!this._events[evt])return this;if(!fn){clearEvent(this,evt);return this;}
            var listeners=this._events[evt];if(listeners.fn){if(listeners.fn===fn&&(!once||listeners.once)&&(!context||listeners.context===context)){clearEvent(this,evt);}}else{for(var i=0,events=[],length=listeners.length;i<length;i++){if(listeners[i].fn!==fn||(once&&!listeners[i].once)||(context&&listeners[i].context!==context)){events.push(listeners[i]);}}
                if(events.length)this._events[evt]=events.length===1?events[0]:events;else clearEvent(this,evt);}
            return this;};EventEmitter.prototype.removeAllListeners=function removeAllListeners(event){var evt;if(event){evt=prefix?prefix+event:event;if(this._events[evt])clearEvent(this,evt);}else{this._events=new Events();this._eventsCount=0;}
            return this;};EventEmitter.prototype.off=EventEmitter.prototype.removeListener;EventEmitter.prototype.addListener=EventEmitter.prototype.on;EventEmitter.prefixed=prefix;EventEmitter.EventEmitter=EventEmitter;if(true){module.exports=EventEmitter;}}),"../node_modules/process/browser.js":(function(module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error('setTimeout has not been defined');}
        function defaultClearTimeout(){throw new Error('clearTimeout has not been defined');}
        (function(){try{if(typeof setTimeout==='function'){cachedSetTimeout=setTimeout;}else{cachedSetTimeout=defaultSetTimout;}}catch(e){cachedSetTimeout=defaultSetTimout;}
            try{if(typeof clearTimeout==='function'){cachedClearTimeout=clearTimeout;}else{cachedClearTimeout=defaultClearTimeout;}}catch(e){cachedClearTimeout=defaultClearTimeout;}}())
        function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0);}
            if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0);}
            try{return cachedSetTimeout(fun,0);}catch(e){try{return cachedSetTimeout.call(null,fun,0);}catch(e){return cachedSetTimeout.call(this,fun,0);}}}
        function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker);}
            if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker);}
            try{return cachedClearTimeout(marker);}catch(e){try{return cachedClearTimeout.call(null,marker);}catch(e){return cachedClearTimeout.call(this,marker);}}}
        var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return;}
            draining=false;if(currentQueue.length){queue=currentQueue.concat(queue);}else{queueIndex=-1;}
            if(queue.length){drainQueue();}}
        function drainQueue(){if(draining){return;}
            var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run();}}
                queueIndex=-1;len=queue.length;}
            currentQueue=null;draining=false;runClearTimeout(timeout);}
        process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i];}}
            queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue);}};function Item(fun,array){this.fun=fun;this.array=array;}
        Item.prototype.run=function(){this.fun.apply(null,this.array);};process.title='browser';process.browser=true;process.env={};process.argv=[];process.version='';process.versions={};function noop(){}
        process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.prependListener=noop;process.prependOnceListener=noop;process.listeners=function(name){return[]}
        process.binding=function(name){throw new Error('process.binding is not supported');};process.cwd=function(){return'/'};process.chdir=function(dir){throw new Error('process.chdir is not supported');};process.umask=function(){return 0;};}),"../node_modules/webpack/buildin/global.js":(function(module,exports){var g;g=(function(){return this;})();try{g=g||Function("return this")()||(1,eval)("this");}catch(e){if(typeof window==="object")g=window;}
        module.exports=g;}),"./actions/Angle.js":(function(module,exports,__webpack_require__){var PropertyValueInc=__webpack_require__("./actions/PropertyValueInc.js");var Angle=function(items,value,step,index,direction)
    {return PropertyValueInc(items,'angle',value,step,index,direction);};module.exports=Angle;}),"./actions/Call.js":(function(module,exports){var Call=function(items,callback,context)
    {for(var i=0;i<items.length;i++)
    {var item=items[i];callback.call(context,item);}
        return items;};module.exports=Call;}),"./actions/GetFirst.js":(function(module,exports){var GetFirst=function(items,compare,index)
    {if(index===undefined){index=0;}
        for(var i=index;i<items.length;i++)
        {var item=items[i];var match=true;for(var property in compare)
        {if(item[property]!==compare[property])
        {match=false;}}
            if(match)
            {return item;}}
        return null;};module.exports=GetFirst;}),"./actions/GetLast.js":(function(module,exports){var GetLast=function(items,compare,index)
    {if(index===undefined){index=0;}
        for(var i=index;i<items.length;i++)
        {var item=items[i];var match=true;for(var property in compare)
        {if(item[property]!==compare[property])
        {match=false;}}
            if(match)
            {return item;}}
        return null;};module.exports=GetLast;}),"./actions/GridAlign.js":(function(module,exports,__webpack_require__){var AlignIn=__webpack_require__("./display/align/in/QuickSet.js");var CONST=__webpack_require__("./display/align/const.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var NOOP=__webpack_require__("./utils/NOOP.js");var Zone=__webpack_require__("./gameobjects/zone/Zone.js");var tempZone=new Zone({sys:{queueDepthSort:NOOP,events:{once:NOOP}}},0,0,1,1);var GridAlign=function(items,options)
    {if(options===undefined){options={};}
        var width=GetFastValue(options,'width',-1);var height=GetFastValue(options,'height',-1);var cellWidth=GetFastValue(options,'cellWidth',1);var cellHeight=GetFastValue(options,'cellHeight',cellWidth);var position=GetFastValue(options,'position',CONST.TOP_LEFT);var x=GetFastValue(options,'x',0);var y=GetFastValue(options,'y',0);var cx=0;var cy=0;var w=(width*cellWidth);var h=(height*cellHeight);tempZone.setPosition(x,y);tempZone.setSize(cellWidth,cellHeight);for(var i=0;i<items.length;i++)
    {AlignIn(items[i],tempZone,position);if(width===-1)
    {cy+=cellHeight;tempZone.y+=cellHeight;if(cy===h)
    {cy=0;tempZone.x+=cellWidth;tempZone.y=y;}}
    else if(height===-1)
    {cx+=cellWidth;tempZone.x+=cellWidth;if(cx===w)
    {cx=0;tempZone.x=x;tempZone.y+=cellHeight;}}
    else
    {cx+=cellWidth;tempZone.x+=cellWidth;if(cx===w)
    {cx=0;cy+=cellHeight;tempZone.x=x;tempZone.y+=cellHeight;if(cy===h)
    {break;}}}}
        return items;};module.exports=GridAlign;}),"./actions/IncAlpha.js":(function(module,exports,__webpack_require__){var PropertyValueInc=__webpack_require__("./actions/PropertyValueInc.js");var IncAlpha=function(items,value,step,index,direction)
    {return PropertyValueInc(items,'alpha',value,step,index,direction);};module.exports=IncAlpha;}),"./actions/IncX.js":(function(module,exports,__webpack_require__){var PropertyValueInc=__webpack_require__("./actions/PropertyValueInc.js");var IncX=function(items,value,step,index,direction)
    {return PropertyValueInc(items,'x',value,step,index,direction);};module.exports=IncX;}),"./actions/IncXY.js":(function(module,exports,__webpack_require__){var PropertyValueInc=__webpack_require__("./actions/PropertyValueInc.js");var IncXY=function(items,x,y,stepX,stepY,index,direction)
    {if(y===undefined||y===null){y=x;}
        PropertyValueInc(items,'x',x,stepX,index,direction);return PropertyValueInc(items,'y',y,stepY,index,direction);};module.exports=IncXY;}),"./actions/IncY.js":(function(module,exports,__webpack_require__){var PropertyValueInc=__webpack_require__("./actions/PropertyValueInc.js");var IncY=function(items,value,step,index,direction)
    {return PropertyValueInc(items,'y',value,step,index,direction);};module.exports=IncY;}),"./actions/PlaceOnCircle.js":(function(module,exports){var PlaceOnCircle=function(items,circle,startAngle,endAngle)
    {if(startAngle===undefined){startAngle=0;}
        if(endAngle===undefined){endAngle=6.28;}
        var angle=startAngle;var angleStep=(endAngle-startAngle)/ items.length;for(var i=0;i<items.length;i++)
    {items[i].x=circle.x+(circle.radius*Math.cos(angle));items[i].y=circle.y+(circle.radius*Math.sin(angle));angle+=angleStep;}
        return items;};module.exports=PlaceOnCircle;}),"./actions/PlaceOnEllipse.js":(function(module,exports){var PlaceOnEllipse=function(items,ellipse,startAngle,endAngle)
    {if(startAngle===undefined){startAngle=0;}
        if(endAngle===undefined){endAngle=6.28;}
        var angle=startAngle;var angleStep=(endAngle-startAngle)/ items.length;var a=ellipse.width / 2;var b=ellipse.height / 2;for(var i=0;i<items.length;i++)
    {items[i].x=ellipse.x+a*Math.cos(angle);items[i].y=ellipse.y+b*Math.sin(angle);angle+=angleStep;}
        return items;};module.exports=PlaceOnEllipse;}),"./actions/PlaceOnLine.js":(function(module,exports,__webpack_require__){var GetPoints=__webpack_require__("./geom/line/GetPoints.js");var PlaceOnLine=function(items,line)
    {var points=GetPoints(line,items.length);for(var i=0;i<items.length;i++)
    {var item=items[i];var point=points[i];item.x=point.x;item.y=point.y;}
        return items;};module.exports=PlaceOnLine;}),"./actions/PlaceOnRectangle.js":(function(module,exports,__webpack_require__){var MarchingAnts=__webpack_require__("./geom/rectangle/MarchingAnts.js");var RotateLeft=__webpack_require__("./utils/array/RotateLeft.js");var RotateRight=__webpack_require__("./utils/array/RotateRight.js");var PlaceOnRectangle=function(items,rect,shift)
    {if(shift===undefined){shift=0;}
        var points=MarchingAnts(rect,false,items.length);if(shift>0)
    {RotateLeft(points,shift);}
    else if(shift<0)
    {RotateRight(points,Math.abs(shift));}
        for(var i=0;i<items.length;i++)
        {items[i].x=points[i].x;items[i].y=points[i].y;}
        return items;};module.exports=PlaceOnRectangle;}),"./actions/PlaceOnTriangle.js":(function(module,exports,__webpack_require__){var BresenhamPoints=__webpack_require__("./geom/line/BresenhamPoints.js");var PlaceOnTriangle=function(items,triangle,stepRate)
    {var p1=BresenhamPoints({x1:triangle.x1,y1:triangle.y1,x2:triangle.x2,y2:triangle.y2},stepRate);var p2=BresenhamPoints({x1:triangle.x2,y1:triangle.y2,x2:triangle.x3,y2:triangle.y3},stepRate);var p3=BresenhamPoints({x1:triangle.x3,y1:triangle.y3,x2:triangle.x1,y2:triangle.y1},stepRate);p1.pop();p2.pop();p3.pop();p1=p1.concat(p2,p3);var step=p1.length / items.length;var p=0;for(var i=0;i<items.length;i++)
    {var item=items[i];var point=p1[Math.floor(p)];item.x=point.x;item.y=point.y;p+=step;}
        return items;};module.exports=PlaceOnTriangle;}),"./actions/PlayAnimation.js":(function(module,exports){var PlayAnimation=function(items,key,startFrame)
    {for(var i=0;i<items.length;i++)
    {items[i].anims.play(key,startFrame);}
        return items;};module.exports=PlayAnimation;}),"./actions/PropertyValueInc.js":(function(module,exports){var PropertyValueInc=function(items,key,value,step,index,direction)
    {if(step===undefined){step=0;}
        if(index===undefined){index=0;}
        if(direction===undefined){direction=1;}
        var i;var t=0;var end=items.length;if(direction===1)
    {for(i=index;i<end;i++)
    {items[i][key]+=value+(t*step);t++;}}
    else
    {for(i=index;i>=0;i--)
    {items[i][key]+=value+(t*step);t++;}}
        return items;};module.exports=PropertyValueInc;}),"./actions/PropertyValueSet.js":(function(module,exports){var PropertyValueSet=function(items,key,value,step,index,direction)
    {if(step===undefined){step=0;}
        if(index===undefined){index=0;}
        if(direction===undefined){direction=1;}
        var i;var t=0;var end=items.length;if(direction===1)
    {for(i=index;i<end;i++)
    {items[i][key]=value+(t*step);t++;}}
    else
    {for(i=index;i>=0;i--)
    {items[i][key]=value+(t*step);t++;}}
        return items;};module.exports=PropertyValueSet;}),"./actions/RandomCircle.js":(function(module,exports,__webpack_require__){var Random=__webpack_require__("./geom/circle/Random.js");var RandomCircle=function(items,circle)
    {for(var i=0;i<items.length;i++)
    {Random(circle,items[i]);}
        return items;};module.exports=RandomCircle;}),"./actions/RandomEllipse.js":(function(module,exports,__webpack_require__){var Random=__webpack_require__("./geom/ellipse/Random.js");var RandomEllipse=function(items,ellipse)
    {for(var i=0;i<items.length;i++)
    {Random(ellipse,items[i]);}
        return items;};module.exports=RandomEllipse;}),"./actions/RandomLine.js":(function(module,exports,__webpack_require__){var Random=__webpack_require__("./geom/line/Random.js");var RandomLine=function(items,line)
    {for(var i=0;i<items.length;i++)
    {Random(line,items[i]);}
        return items;};module.exports=RandomLine;}),"./actions/RandomRectangle.js":(function(module,exports,__webpack_require__){var Random=__webpack_require__("./geom/rectangle/Random.js");var RandomRectangle=function(items,rect)
    {for(var i=0;i<items.length;i++)
    {Random(rect,items[i]);}
        return items;};module.exports=RandomRectangle;}),"./actions/RandomTriangle.js":(function(module,exports,__webpack_require__){var Random=__webpack_require__("./geom/triangle/Random.js");var RandomTriangle=function(items,triangle)
    {for(var i=0;i<items.length;i++)
    {Random(triangle,items[i]);}
        return items;};module.exports=RandomTriangle;}),"./actions/Rotate.js":(function(module,exports,__webpack_require__){var PropertyValueInc=__webpack_require__("./actions/PropertyValueInc.js");var Rotate=function(items,value,step,index,direction)
    {return PropertyValueInc(items,'rotation',value,step,index,direction);};module.exports=Rotate;}),"./actions/RotateAround.js":(function(module,exports,__webpack_require__){var RotateAroundDistance=__webpack_require__("./math/RotateAroundDistance.js");var DistanceBetween=__webpack_require__("./math/distance/DistanceBetween.js");var RotateAround=function(items,point,angle)
    {var x=point.x;var y=point.y;for(var i=0;i<items.length;i++)
    {var item=items[i];RotateAroundDistance(item,x,y,angle,Math.max(1,DistanceBetween(item.x,item.y,x,y)));}
        return items;};module.exports=RotateAround;}),"./actions/RotateAroundDistance.js":(function(module,exports,__webpack_require__){var MathRotateAroundDistance=__webpack_require__("./math/RotateAroundDistance.js");var RotateAroundDistance=function(items,point,angle,distance)
    {var x=point.x;var y=point.y;if(distance===0)
    {return items;}
        for(var i=0;i<items.length;i++)
        {MathRotateAroundDistance(items[i],x,y,angle,distance);}
        return items;};module.exports=RotateAroundDistance;}),"./actions/ScaleX.js":(function(module,exports,__webpack_require__){var PropertyValueInc=__webpack_require__("./actions/PropertyValueInc.js");var ScaleX=function(items,value,step,index,direction)
    {return PropertyValueInc(items,'scaleX',value,step,index,direction);};module.exports=ScaleX;}),"./actions/ScaleXY.js":(function(module,exports,__webpack_require__){var PropertyValueInc=__webpack_require__("./actions/PropertyValueInc.js");var ScaleXY=function(items,scaleX,scaleY,stepX,stepY,index,direction)
    {if(scaleY===undefined||scaleY===null){scaleY=scaleX;}
        PropertyValueInc(items,'scaleX',scaleX,stepX,index,direction);return PropertyValueInc(items,'scaleY',scaleY,stepY,index,direction);};module.exports=ScaleXY;}),"./actions/ScaleY.js":(function(module,exports,__webpack_require__){var PropertyValueInc=__webpack_require__("./actions/PropertyValueInc.js");var ScaleY=function(items,value,step,index,direction)
    {return PropertyValueInc(items,'scaleY',value,step,index,direction);};module.exports=ScaleY;}),"./actions/SetAlpha.js":(function(module,exports,__webpack_require__){var PropertyValueSet=__webpack_require__("./actions/PropertyValueSet.js");var SetAlpha=function(items,value,step,index,direction)
    {return PropertyValueSet(items,'alpha',value,step,index,direction);};module.exports=SetAlpha;}),"./actions/SetBlendMode.js":(function(module,exports,__webpack_require__){var PropertyValueSet=__webpack_require__("./actions/PropertyValueSet.js");var SetBlendMode=function(items,value,index,direction)
    {return PropertyValueSet(items,'blendMode',value,0,index,direction);};module.exports=SetBlendMode;}),"./actions/SetDepth.js":(function(module,exports,__webpack_require__){var PropertyValueSet=__webpack_require__("./actions/PropertyValueSet.js");var SetDepth=function(items,value,step,index,direction)
    {return PropertyValueSet(items,'depth',value,step,index,direction);};module.exports=SetDepth;}),"./actions/SetHitArea.js":(function(module,exports){var SetHitArea=function(items,hitArea,hitAreaCallback)
    {for(var i=0;i<items.length;i++)
    {items[i].setInteractive(hitArea,hitAreaCallback);}
        return items;};module.exports=SetHitArea;}),"./actions/SetOrigin.js":(function(module,exports,__webpack_require__){var PropertyValueSet=__webpack_require__("./actions/PropertyValueSet.js");var SetOrigin=function(items,originX,originY,stepX,stepY,index,direction)
    {if(originY===undefined||originY===null){originY=originX;}
        PropertyValueSet(items,'originX',originX,stepX,index,direction);return PropertyValueSet(items,'originY',originY,stepY,index,direction);};module.exports=SetOrigin;}),"./actions/SetRotation.js":(function(module,exports,__webpack_require__){var PropertyValueSet=__webpack_require__("./actions/PropertyValueSet.js");var SetRotation=function(items,value,step,index,direction)
    {return PropertyValueSet(items,'rotation',value,step,index,direction);};module.exports=SetRotation;}),"./actions/SetScale.js":(function(module,exports,__webpack_require__){var PropertyValueSet=__webpack_require__("./actions/PropertyValueSet.js");var SetScale=function(items,scaleX,scaleY,stepX,stepY,index,direction)
    {if(scaleY===undefined||scaleY===null){scaleY=scaleX;}
        PropertyValueSet(items,'scaleX',scaleX,stepX,index,direction);return PropertyValueSet(items,'scaleY',scaleY,stepY,index,direction);};module.exports=SetScale;}),"./actions/SetScaleX.js":(function(module,exports,__webpack_require__){var PropertyValueSet=__webpack_require__("./actions/PropertyValueSet.js");var SetScaleX=function(items,value,step,index,direction)
    {return PropertyValueSet(items,'scaleX',value,step,index,direction);};module.exports=SetScaleX;}),"./actions/SetScaleY.js":(function(module,exports,__webpack_require__){var PropertyValueSet=__webpack_require__("./actions/PropertyValueSet.js");var SetScaleY=function(items,value,step,index,direction)
    {return PropertyValueSet(items,'scaleY',value,step,index,direction);};module.exports=SetScaleY;}),"./actions/SetTint.js":(function(module,exports){var SetTint=function(items,topLeft,topRight,bottomLeft,bottomRight)
    {for(var i=0;i<items.length;i++)
    {items[i].setTint(topLeft,topRight,bottomLeft,bottomRight);}
        return items;};module.exports=SetTint;}),"./actions/SetVisible.js":(function(module,exports,__webpack_require__){var PropertyValueSet=__webpack_require__("./actions/PropertyValueSet.js");var SetVisible=function(items,value,index,direction)
    {return PropertyValueSet(items,'visible',value,0,index,direction);};module.exports=SetVisible;}),"./actions/SetX.js":(function(module,exports,__webpack_require__){var PropertyValueSet=__webpack_require__("./actions/PropertyValueSet.js");var SetX=function(items,value,step,index,direction)
    {return PropertyValueSet(items,'x',value,step,index,direction);};module.exports=SetX;}),"./actions/SetXY.js":(function(module,exports,__webpack_require__){var PropertyValueSet=__webpack_require__("./actions/PropertyValueSet.js");var SetXY=function(items,x,y,stepX,stepY,index,direction)
    {if(y===undefined||y===null){y=x;}
        PropertyValueSet(items,'x',x,stepX,index,direction);return PropertyValueSet(items,'y',y,stepY,index,direction);};module.exports=SetXY;}),"./actions/SetY.js":(function(module,exports,__webpack_require__){var PropertyValueSet=__webpack_require__("./actions/PropertyValueSet.js");var SetY=function(items,value,step,index,direction)
    {return PropertyValueSet(items,'y',value,step,index,direction);};module.exports=SetY;}),"./actions/ShiftPosition.js":(function(module,exports,__webpack_require__){var Vector2=__webpack_require__("./math/Vector2.js");var ShiftPosition=function(items,x,y,direction,output)
    {if(direction===undefined){direction=0;}
        if(output===undefined){output=new Vector2();}
        var px;var py;if(items.length>1)
    {var i;var cx;var cy;var cur;if(direction===0)
    {var len=items.length-1;px=items[len].x;py=items[len].y;for(i=len-1;i>=0;i--)
    {cur=items[i];cx=cur.x;cy=cur.y;cur.x=px;cur.y=py;px=cx;py=cy;}
        items[len].x=x;items[len].y=y;}
    else
    {px=items[0].x;py=items[0].y;for(i=1;i<items.length;i++)
    {cur=items[i];cx=cur.x;cy=cur.y;cur.x=px;cur.y=py;px=cx;py=cy;}
        items[0].x=x;items[0].y=y;}}
    else
    {px=items[0].x;py=items[0].y;items[0].x=x;items[0].y=y;}
        output.x=px;output.y=py;return output;};module.exports=ShiftPosition;}),"./actions/Shuffle.js":(function(module,exports,__webpack_require__){var ArrayShuffle=__webpack_require__("./utils/array/Shuffle.js");var Shuffle=function(items)
    {return ArrayShuffle(items);};module.exports=Shuffle;}),"./actions/SmoothStep.js":(function(module,exports,__webpack_require__){var MathSmoothStep=__webpack_require__("./math/SmoothStep.js");var SmoothStep=function(items,property,min,max,inc)
    {if(inc===undefined){inc=false;}
        var step=Math.abs(max-min)/ items.length;var i;if(inc)
    {for(i=0;i<items.length;i++)
    {items[i][property]+=MathSmoothStep(i*step,min,max);}}
    else
    {for(i=0;i<items.length;i++)
    {items[i][property]=MathSmoothStep(i*step,min,max);}}
        return items;};module.exports=SmoothStep;}),"./actions/SmootherStep.js":(function(module,exports,__webpack_require__){var MathSmootherStep=__webpack_require__("./math/SmootherStep.js");var SmootherStep=function(items,property,min,max,inc)
    {if(inc===undefined){inc=false;}
        var step=Math.abs(max-min)/ items.length;var i;if(inc)
    {for(i=0;i<items.length;i++)
    {items[i][property]+=MathSmootherStep(i*step,min,max);}}
    else
    {for(i=0;i<items.length;i++)
    {items[i][property]=MathSmootherStep(i*step,min,max);}}
        return items;};module.exports=SmootherStep;}),"./actions/Spread.js":(function(module,exports){var Spread=function(items,property,min,max,inc)
    {if(inc===undefined){inc=false;}
        var step=Math.abs(max-min)/ items.length;var i;if(inc)
    {for(i=0;i<items.length;i++)
    {items[i][property]+=i*step;}}
    else
    {for(i=0;i<items.length;i++)
    {items[i][property]=i*step;}}
        return items;};module.exports=Spread;}),"./actions/ToggleVisible.js":(function(module,exports){var ToggleVisible=function(items)
    {for(var i=0;i<items.length;i++)
    {items[i].visible=!items[i].visible;}
        return items;};module.exports=ToggleVisible;}),"./actions/WrapInRectangle.js":(function(module,exports,__webpack_require__){var Wrap=__webpack_require__("./math/Wrap.js");var WrapInRectangle=function(items,rect,padding)
    {if(padding===undefined)
    {padding=0;}
        for(var i=0;i<items.length;i++)
        {var item=items[i];item.x=Wrap(item.x,rect.left-padding,rect.right+padding);item.y=Wrap(item.y,rect.top-padding,rect.bottom+padding);}
        return items;};module.exports=WrapInRectangle;}),"./actions/index.js":(function(module,exports,__webpack_require__){module.exports={Angle:__webpack_require__("./actions/Angle.js"),Call:__webpack_require__("./actions/Call.js"),GetFirst:__webpack_require__("./actions/GetFirst.js"),GetLast:__webpack_require__("./actions/GetLast.js"),GridAlign:__webpack_require__("./actions/GridAlign.js"),IncAlpha:__webpack_require__("./actions/IncAlpha.js"),IncX:__webpack_require__("./actions/IncX.js"),IncXY:__webpack_require__("./actions/IncXY.js"),IncY:__webpack_require__("./actions/IncY.js"),PlaceOnCircle:__webpack_require__("./actions/PlaceOnCircle.js"),PlaceOnEllipse:__webpack_require__("./actions/PlaceOnEllipse.js"),PlaceOnLine:__webpack_require__("./actions/PlaceOnLine.js"),PlaceOnRectangle:__webpack_require__("./actions/PlaceOnRectangle.js"),PlaceOnTriangle:__webpack_require__("./actions/PlaceOnTriangle.js"),PlayAnimation:__webpack_require__("./actions/PlayAnimation.js"),PropertyValueInc:__webpack_require__("./actions/PropertyValueInc.js"),PropertyValueSet:__webpack_require__("./actions/PropertyValueSet.js"),RandomCircle:__webpack_require__("./actions/RandomCircle.js"),RandomEllipse:__webpack_require__("./actions/RandomEllipse.js"),RandomLine:__webpack_require__("./actions/RandomLine.js"),RandomRectangle:__webpack_require__("./actions/RandomRectangle.js"),RandomTriangle:__webpack_require__("./actions/RandomTriangle.js"),Rotate:__webpack_require__("./actions/Rotate.js"),RotateAround:__webpack_require__("./actions/RotateAround.js"),RotateAroundDistance:__webpack_require__("./actions/RotateAroundDistance.js"),ScaleX:__webpack_require__("./actions/ScaleX.js"),ScaleXY:__webpack_require__("./actions/ScaleXY.js"),ScaleY:__webpack_require__("./actions/ScaleY.js"),SetAlpha:__webpack_require__("./actions/SetAlpha.js"),SetBlendMode:__webpack_require__("./actions/SetBlendMode.js"),SetDepth:__webpack_require__("./actions/SetDepth.js"),SetHitArea:__webpack_require__("./actions/SetHitArea.js"),SetOrigin:__webpack_require__("./actions/SetOrigin.js"),SetRotation:__webpack_require__("./actions/SetRotation.js"),SetScale:__webpack_require__("./actions/SetScale.js"),SetScaleX:__webpack_require__("./actions/SetScaleX.js"),SetScaleY:__webpack_require__("./actions/SetScaleY.js"),SetTint:__webpack_require__("./actions/SetTint.js"),SetVisible:__webpack_require__("./actions/SetVisible.js"),SetX:__webpack_require__("./actions/SetX.js"),SetXY:__webpack_require__("./actions/SetXY.js"),SetY:__webpack_require__("./actions/SetY.js"),ShiftPosition:__webpack_require__("./actions/ShiftPosition.js"),Shuffle:__webpack_require__("./actions/Shuffle.js"),SmootherStep:__webpack_require__("./actions/SmootherStep.js"),SmoothStep:__webpack_require__("./actions/SmoothStep.js"),Spread:__webpack_require__("./actions/Spread.js"),ToggleVisible:__webpack_require__("./actions/ToggleVisible.js"),WrapInRectangle:__webpack_require__("./actions/WrapInRectangle.js")};}),"./animations/Animation.js":(function(module,exports,__webpack_require__){var Clamp=__webpack_require__("./math/Clamp.js");var Class=__webpack_require__("./utils/Class.js");var EventEmitter=__webpack_require__("../node_modules/eventemitter3/index.js");var FindClosestInSorted=__webpack_require__("./utils/array/FindClosestInSorted.js");var Frame=__webpack_require__("./animations/AnimationFrame.js");var GetValue=__webpack_require__("./utils/object/GetValue.js");var Animation=new Class({Extends:EventEmitter,initialize:function Animation(manager,key,config)
        {EventEmitter.call(this);this.manager=manager;this.key=key;this.type='frame';this.frames=this.getFrames(manager.textureManager,GetValue(config,'frames',[]),GetValue(config,'defaultTextureKey',null));this.frameRate=GetValue(config,'frameRate',null);this.duration=GetValue(config,'duration',null);if(this.duration===null&&this.frameRate===null)
        {this.frameRate=24;this.duration=(this.frameRate / this.frames.length)*1000;}
        else if(this.duration&&this.frameRate===null)
        {this.frameRate=this.frames.length /(this.duration / 1000);}
        else
        {this.duration=(this.frames.length / this.frameRate)*1000;}
            this.msPerFrame=1000 / this.frameRate;this.skipMissedFrames=GetValue(config,'skipMissedFrames',true);this.delay=GetValue(config,'delay',0);this.repeat=GetValue(config,'repeat',0);this.repeatDelay=GetValue(config,'repeatDelay',0);this.yoyo=GetValue(config,'yoyo',false);this.showOnStart=GetValue(config,'showOnStart',false);this.hideOnComplete=GetValue(config,'hideOnComplete',false);this.paused=false;this.manager.on('pauseall',this.pause,this);this.manager.on('resumeall',this.resume,this);},addFrame:function(config)
        {return this.addFrameAt(this.frames.length,config);},addFrameAt:function(index,config)
        {var newFrames=this.getFrames(this.manager.textureManager,config);if(newFrames.length>0)
        {if(index===0)
        {this.frames=newFrames.concat(this.frames);}
        else if(index===this.frames.length)
        {this.frames=this.frames.concat(newFrames);}
        else
        {var pre=this.frames.slice(0,index);var post=this.frames.slice(index);this.frames=pre.concat(newFrames,post);}
            this.updateFrameSequence();}
            return this;},checkFrame:function(index)
        {return(index>=0&&index<this.frames.length);},completeAnimation:function(component)
        {if(this.hideOnComplete)
        {component.parent.visible=false;}
            component.stop();},getFirstTick:function(component,includeDelay)
        {if(includeDelay===undefined){includeDelay=true;}
            component.accumulator=0;component.nextTick=component.msPerFrame+component.currentFrame.duration;if(includeDelay)
        {component.nextTick+=component._delay;}},getFrameAt:function(index)
        {return this.frames[index];},getFrames:function(textureManager,frames,defaultTextureKey)
        {var out=[];var prev;var animationFrame;var index=1;var i;var textureKey;if(typeof frames==='string')
        {textureKey=frames;var texture=textureManager.get(textureKey);var frameKeys=texture.getFrameNames();frames=[];frameKeys.forEach(function(idx,value)
        {frames.push({key:textureKey,frame:value});});}
            if(!Array.isArray(frames)||frames.length===0)
            {return out;}
            for(i=0;i<frames.length;i++)
            {var item=frames[i];var key=GetValue(item,'key',defaultTextureKey);if(!key)
            {continue;}
                var frame=GetValue(item,'frame',0);var textureFrame=textureManager.getFrame(key,frame);animationFrame=new Frame(key,frame,index,textureFrame);animationFrame.duration=GetValue(item,'duration',0);animationFrame.isFirst=(!prev);if(prev)
            {prev.nextFrame=animationFrame;animationFrame.prevFrame=prev;}
                out.push(animationFrame);prev=animationFrame;index++;}
            if(out.length>0)
            {animationFrame.isLast=true;animationFrame.nextFrame=out[0];out[0].prevFrame=animationFrame;var slice=1 /(out.length-1);for(i=0;i<out.length;i++)
            {out[i].progress=i*slice;}}
            return out;},getNextTick:function(component)
        {component.accumulator-=component.nextTick;component.nextTick=component.msPerFrame+component.currentFrame.duration;},load:function(component,startFrame)
        {if(startFrame>=this.frames.length)
        {startFrame=0;}
            if(component.currentAnim!==this)
            {component.currentAnim=this;component.frameRate=this.frameRate;component.duration=this.duration;component.msPerFrame=this.msPerFrame;component.skipMissedFrames=this.skipMissedFrames;component._delay=this.delay;component._repeat=this.repeat;component._repeatDelay=this.repeatDelay;component._yoyo=this.yoyo;}
            var frame=this.frames[startFrame];if(startFrame===0&&!component.forward)
        {frame=this.getLastFrame();}
            component.updateFrame(frame);},getFrameByProgress:function(value)
        {value=Clamp(value,0,1);return FindClosestInSorted(value,this.frames,'progress');},nextFrame:function(component)
        {var frame=component.currentFrame;if(frame.isLast)
        {if(component._yoyo)
        {this.handleYoyoFrame(component,false);}
        else if(component.repeatCounter>0)
        {if(component._reverse&&component.forward)
        {component.forward=false;}
        else
        {this.repeatAnimation(component);}}
        else
        {this.completeAnimation(component);}}
        else
        {this.updateAndGetNextTick(component,frame.nextFrame);}},handleYoyoFrame:function(component,isReverse)
        {if(!isReverse){isReverse=false;}
            if(component._reverse===!isReverse&&component.repeatCounter>0)
            {component.forward=isReverse;this.repeatAnimation(component);return;}
            if(component._reverse!==isReverse&&component.repeatCounter===0)
            {this.completeAnimation(component);return;}
            component.forward=isReverse;var frame=(isReverse)?component.currentFrame.nextFrame:component.currentFrame.prevFrame;this.updateAndGetNextTick(component,frame);},getLastFrame:function()
        {return this.frames[this.frames.length-1];},previousFrame:function(component)
        {var frame=component.currentFrame;if(frame.isFirst)
        {if(component._yoyo)
        {this.handleYoyoFrame(component,true);}
        else if(component.repeatCounter>0)
        {if(component._reverse&&!component.forward)
        {component.currentFrame=this.getLastFrame();this.repeatAnimation(component);}
        else
        {component.forward=true;this.repeatAnimation(component);}}
        else
        {this.completeAnimation(component);}}
        else
        {this.updateAndGetNextTick(component,frame.prevFrame);}},updateAndGetNextTick:function(component,frame)
        {component.updateFrame(frame);this.getNextTick(component);},removeFrame:function(frame)
        {var index=this.frames.indexOf(frame);if(index!==-1)
        {this.removeFrameAt(index);}
            return this;},removeFrameAt:function(index)
        {this.frames.splice(index,1);this.updateFrameSequence();return this;},repeatAnimation:function(component)
        {if(component._pendingStop===2)
        {return this.completeAnimation(component);}
            if(component._repeatDelay>0&&component.pendingRepeat===false)
            {component.pendingRepeat=true;component.accumulator-=component.nextTick;component.nextTick+=component._repeatDelay;}
            else
            {component.repeatCounter--;component.updateFrame(component.currentFrame[(component.forward)?'nextFrame':'prevFrame']);if(component.isPlaying)
            {this.getNextTick(component);component.pendingRepeat=false;var frame=component.currentFrame;var parent=component.parent;this.emit('repeat',this,frame);parent.emit('animationrepeat-'+this.key,this,frame,component.repeatCounter,parent);parent.emit('animationrepeat',this,frame,component.repeatCounter,parent);}}},setFrame:function(component)
        {if(component.forward)
        {this.nextFrame(component);}
        else
        {this.previousFrame(component);}},toJSON:function()
        {var output={key:this.key,type:this.type,frames:[],frameRate:this.frameRate,duration:this.duration,skipMissedFrames:this.skipMissedFrames,delay:this.delay,repeat:this.repeat,repeatDelay:this.repeatDelay,yoyo:this.yoyo,showOnStart:this.showOnStart,hideOnComplete:this.hideOnComplete};this.frames.forEach(function(frame)
        {output.frames.push(frame.toJSON());});return output;},updateFrameSequence:function()
        {var len=this.frames.length;var slice=1 /(len-1);for(var i=0;i<len;i++)
        {var frame=this.frames[i];frame.index=i+1;frame.isFirst=false;frame.isLast=false;frame.progress=i*slice;if(i===0)
        {frame.isFirst=true;frame.isLast=(len===1);frame.prevFrame=this.frames[len-1];frame.nextFrame=this.frames[i+1];}
        else if(i===len-1)
        {frame.isLast=true;frame.prevFrame=this.frames[len-2];frame.nextFrame=this.frames[0];}
        else if(len>1)
        {frame.prevFrame=this.frames[i-1];frame.nextFrame=this.frames[i+1];}}
            return this;},pause:function()
        {this.paused=true;return this;},resume:function()
        {this.paused=false;return this;},destroy:function()
        {this.removeAllListeners();this.manager.off('pauseall',this.pause,this);this.manager.off('resumeall',this.resume,this);this.manager.remove(this.key);for(var i=0;i<this.frames.length;i++)
        {this.frames[i].destroy();}
            this.frames=[];this.manager=null;}});module.exports=Animation;}),"./animations/AnimationFrame.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var AnimationFrame=new Class({initialize:function AnimationFrame(textureKey,textureFrame,index,frame)
        {this.textureKey=textureKey;this.textureFrame=textureFrame;this.index=index;this.frame=frame;this.isFirst=false;this.isLast=false;this.prevFrame=null;this.nextFrame=null;this.duration=0;this.progress=0;},toJSON:function()
        {return{key:this.textureKey,frame:this.textureFrame,duration:this.duration};},destroy:function()
        {this.frame=undefined;}});module.exports=AnimationFrame;}),"./animations/AnimationManager.js":(function(module,exports,__webpack_require__){var Animation=__webpack_require__("./animations/Animation.js");var Class=__webpack_require__("./utils/Class.js");var CustomMap=__webpack_require__("./structs/Map.js");var EventEmitter=__webpack_require__("../node_modules/eventemitter3/index.js");var GetValue=__webpack_require__("./utils/object/GetValue.js");var Pad=__webpack_require__("./utils/string/Pad.js");var AnimationManager=new Class({Extends:EventEmitter,initialize:function AnimationManager(game)
        {EventEmitter.call(this);this.game=game;this.textureManager=null;this.globalTimeScale=1;this.anims=new CustomMap();this.paused=false;this.name='AnimationManager';game.events.once('boot',this.boot,this);},boot:function()
        {this.textureManager=this.game.textures;this.game.events.once('destroy',this.destroy,this);},add:function(key,animation)
        {if(this.anims.has(key))
        {console.warn('Animation with key',key,'already exists');return;}
            animation.key=key;this.anims.set(key,animation);this.emit('add',key,animation);return this;},exists:function(key)
        {return this.anims.has(key);},create:function(config)
        {var key=config.key;var anim=false;if(key)
        {anim=this.get(key);if(!anim)
        {anim=new Animation(this,key,config);this.anims.set(key,anim);this.emit('add',key,anim);}}
            return anim;},fromJSON:function(data,clearCurrentAnimations)
        {if(clearCurrentAnimations===undefined){clearCurrentAnimations=false;}
            if(clearCurrentAnimations)
            {this.anims.clear();}
            if(typeof data==='string')
            {data=JSON.parse(data);}
            var output=[];if(data.hasOwnProperty('anims')&&Array.isArray(data.anims))
        {for(var i=0;i<data.anims.length;i++)
        {output.push(this.create(data.anims[i]));}
            if(data.hasOwnProperty('globalTimeScale'))
            {this.globalTimeScale=data.globalTimeScale;}}
        else if(data.hasOwnProperty('key')&&data.type==='frame')
        {output.push(this.create(data));}
            return output;},generateFrameNames:function(key,config)
        {var prefix=GetValue(config,'prefix','');var start=GetValue(config,'start',0);var end=GetValue(config,'end',0);var suffix=GetValue(config,'suffix','');var zeroPad=GetValue(config,'zeroPad',0);var out=GetValue(config,'outputArray',[]);var frames=GetValue(config,'frames',false);var texture=this.textureManager.get(key);if(!texture)
        {return out;}
            var diff=(start<end)?1:-1;end+=diff;var i;var frame;if(!config)
        {frames=texture.getFrameNames();for(i=0;i<frames.length;i++)
        {out.push({key:key,frame:frames[i]});}}
        else if(Array.isArray(frames))
        {for(i=0;i<frames.length;i++)
        {frame=prefix+Pad(frames[i],zeroPad,'0',1)+suffix;if(texture.has(frame))
        {out.push({key:key,frame:frame});}}}
        else
        {for(i=start;i!==end;i+=diff)
        {frame=prefix+Pad(i,zeroPad,'0',1)+suffix;if(texture.has(frame))
        {out.push({key:key,frame:frame});}}}
            return out;},generateFrameNumbers:function(key,config)
        {var startFrame=GetValue(config,'start',0);var endFrame=GetValue(config,'end',-1);var firstFrame=GetValue(config,'first',false);var out=GetValue(config,'outputArray',[]);var frames=GetValue(config,'frames',false);var texture=this.textureManager.get(key);if(!texture)
        {return out;}
            if(firstFrame&&texture.has(firstFrame))
            {out.push({key:key,frame:firstFrame});}
            var i;if(Array.isArray(frames))
        {for(i=0;i<frames.length;i++)
        {if(texture.has(frames[i]))
        {out.push({key:key,frame:frames[i]});}}}
        else
        {if(endFrame===-1)
        {endFrame=texture.frameTotal;}
            for(i=startFrame;i<=endFrame;i++)
            {if(texture.has(i))
            {out.push({key:key,frame:i});}}}
            return out;},get:function(key)
        {return this.anims.get(key);},load:function(child,key,startFrame)
        {var anim=this.get(key);if(anim)
        {anim.load(child,startFrame);}
            return child;},pauseAll:function()
        {if(!this.paused)
        {this.paused=true;this.emit('pauseall');}
            return this;},play:function(key,child)
        {if(!Array.isArray(child))
        {child=[child];}
            var anim=this.get(key);if(!anim)
        {return;}
            for(var i=0;i<child.length;i++)
            {child[i].anims.play(key);}
            return this;},remove:function(key)
        {var anim=this.get(key);if(anim)
        {this.emit('remove',key,anim);this.anims.delete(key);}
            return anim;},resumeAll:function()
        {if(this.paused)
        {this.paused=false;this.emit('resumeall');}
            return this;},staggerPlay:function(key,children,stagger)
        {if(stagger===undefined){stagger=0;}
            if(!Array.isArray(children))
            {children=[children];}
            var anim=this.get(key);if(!anim)
        {return;}
            for(var i=0;i<children.length;i++)
            {children[i].anims.delayedPlay(stagger*i,key);}
            return this;},toJSON:function(key)
        {if(key!==undefined&&key!=='')
        {return this.anims.get(key).toJSON();}
        else
        {var output={anims:[],globalTimeScale:this.globalTimeScale};this.anims.each(function(animationKey,animation)
        {output.anims.push(animation.toJSON());});return output;}},destroy:function()
        {this.anims.clear();this.textureManager=null;this.game=null;}});module.exports=AnimationManager;}),"./animations/index.js":(function(module,exports,__webpack_require__){module.exports={Animation:__webpack_require__("./animations/Animation.js"),AnimationFrame:__webpack_require__("./animations/AnimationFrame.js"),AnimationManager:__webpack_require__("./animations/AnimationManager.js")};}),"./boot/Config.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var CONST=__webpack_require__("./const.js");var Device=__webpack_require__("./device/index.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var GetValue=__webpack_require__("./utils/object/GetValue.js");var IsPlainObject=__webpack_require__("./utils/object/IsPlainObject.js");var PhaserMath=__webpack_require__("./math/index.js");var NOOP=__webpack_require__("./utils/NOOP.js");var DefaultPlugins=__webpack_require__("./plugins/DefaultPlugins.js");var ValueToColor=__webpack_require__("./display/color/ValueToColor.js");var Config=new Class({initialize:function Config(config)
        {if(config===undefined){config={};}
            var defaultBannerColor=['#ff0000','#ffff00','#00ff00','#00ffff','#000000'];var defaultBannerTextColor='#ffffff';this.width=GetValue(config,'width',1024);this.height=GetValue(config,'height',768);this.zoom=GetValue(config,'zoom',1);this.resolution=GetValue(config,'resolution',1);this.parent=GetValue(config,'parent',null);this.scaleMode=GetValue(config,'scaleMode',0);this.expandParent=GetValue(config,'expandParent',true);this.autoRound=GetValue(config,'autoRound',false);this.autoCenter=GetValue(config,'autoCenter',0);this.resizeInterval=GetValue(config,'autoRound',2000);this.minWidth=GetValue(config,'minWidth',0);this.maxWidth=GetValue(config,'maxWidth',0);this.minHeight=GetValue(config,'minHeight',0);this.maxHeight=GetValue(config,'maxHeight',0);var scaleConfig=GetValue(config,'scale',null);if(scaleConfig)
        {this.width=GetValue(scaleConfig,'width',this.width);this.height=GetValue(scaleConfig,'height',this.height);this.zoom=GetValue(scaleConfig,'zoom',this.zoom);this.resolution=GetValue(scaleConfig,'resolution',this.resolution);this.parent=GetValue(scaleConfig,'parent',this.parent);this.scaleMode=GetValue(scaleConfig,'mode',this.scaleMode);this.expandParent=GetValue(scaleConfig,'expandParent',this.expandParent);this.autoRound=GetValue(scaleConfig,'autoRound',this.autoRound);this.autoCenter=GetValue(scaleConfig,'autoCenter',this.autoCenter);this.resizeInterval=GetValue(scaleConfig,'resizeInterval',this.resizeInterval);this.minWidth=GetValue(scaleConfig,'min.width',this.minWidth);this.maxWidth=GetValue(scaleConfig,'max.width',this.maxWidth);this.minHeight=GetValue(scaleConfig,'min.height',this.minHeight);this.maxHeight=GetValue(scaleConfig,'max.height',this.maxHeight);}
            this.renderType=GetValue(config,'type',CONST.AUTO);this.canvas=GetValue(config,'canvas',null);this.context=GetValue(config,'context',null);this.canvasStyle=GetValue(config,'canvasStyle',null);this.customEnvironment=GetValue(config,'customEnvironment',false);this.sceneConfig=GetValue(config,'scene',null);this.seed=GetValue(config,'seed',[(Date.now()*Math.random()).toString()]);PhaserMath.RND=new PhaserMath.RandomDataGenerator(this.seed);this.gameTitle=GetValue(config,'title','');this.gameURL=GetValue(config,'url','https://phaser.io');this.gameVersion=GetValue(config,'version','');this.autoFocus=GetValue(config,'autoFocus',true);this.domCreateContainer=GetValue(config,'dom.createContainer',false);this.domBehindCanvas=GetValue(config,'dom.behindCanvas',false);this.inputKeyboard=GetValue(config,'input.keyboard',true);this.inputKeyboardEventTarget=GetValue(config,'input.keyboard.target',window);this.inputKeyboardCapture=GetValue(config,'input.keyboard.capture',[]);this.inputMouse=GetValue(config,'input.mouse',true);this.inputMouseEventTarget=GetValue(config,'input.mouse.target',null);this.inputMouseCapture=GetValue(config,'input.mouse.capture',true);this.inputTouch=GetValue(config,'input.touch',Device.input.touch);this.inputTouchEventTarget=GetValue(config,'input.touch.target',null);this.inputTouchCapture=GetValue(config,'input.touch.capture',true);this.inputActivePointers=GetValue(config,'input.activePointers',1);this.inputSmoothFactor=GetValue(config,'input.smoothFactor',0);this.inputGamepad=GetValue(config,'input.gamepad',false);this.inputGamepadEventTarget=GetValue(config,'input.gamepad.target',window);this.disableContextMenu=GetValue(config,'disableContextMenu',false);this.audio=GetValue(config,'audio');this.hideBanner=(GetValue(config,'banner',null)===false);this.hidePhaser=GetValue(config,'banner.hidePhaser',false);this.bannerTextColor=GetValue(config,'banner.text',defaultBannerTextColor);this.bannerBackgroundColor=GetValue(config,'banner.background',defaultBannerColor);if(this.gameTitle===''&&this.hidePhaser)
        {this.hideBanner=true;}
            this.fps=GetValue(config,'fps',null);var renderConfig=GetValue(config,'render',config);this.antialias=GetValue(renderConfig,'antialias',true);this.roundPixels=GetValue(renderConfig,'roundPixels',false);this.pixelArt=GetValue(renderConfig,'pixelArt',this.zoom>1);if(this.pixelArt)
        {this.antialias=false;this.roundPixels=true;}
            this.transparent=GetValue(renderConfig,'transparent',false);this.clearBeforeRender=GetValue(renderConfig,'clearBeforeRender',true);this.premultipliedAlpha=GetValue(renderConfig,'premultipliedAlpha',true);this.failIfMajorPerformanceCaveat=GetValue(renderConfig,'failIfMajorPerformanceCaveat',false);this.powerPreference=GetValue(renderConfig,'powerPreference','default');this.batchSize=GetValue(renderConfig,'batchSize',2000);this.maxLights=GetValue(renderConfig,'maxLights',10);var bgc=GetValue(config,'backgroundColor',0);this.backgroundColor=ValueToColor(bgc);if(bgc===0&&this.transparent)
        {this.backgroundColor.alpha=0;}
            this.preBoot=GetValue(config,'callbacks.preBoot',NOOP);this.postBoot=GetValue(config,'callbacks.postBoot',NOOP);this.physics=GetValue(config,'physics',{});this.defaultPhysicsSystem=GetValue(this.physics,'default',false);this.loaderBaseURL=GetValue(config,'loader.baseURL','');this.loaderPath=GetValue(config,'loader.path','');this.loaderMaxParallelDownloads=GetValue(config,'loader.maxParallelDownloads',32);this.loaderCrossOrigin=GetValue(config,'loader.crossOrigin',undefined);this.loaderResponseType=GetValue(config,'loader.responseType','');this.loaderAsync=GetValue(config,'loader.async',true);this.loaderUser=GetValue(config,'loader.user','');this.loaderPassword=GetValue(config,'loader.password','');this.loaderTimeout=GetValue(config,'loader.timeout',0);this.installGlobalPlugins=[];this.installScenePlugins=[];var plugins=GetValue(config,'plugins',null);var defaultPlugins=DefaultPlugins.DefaultScene;if(plugins)
        {if(Array.isArray(plugins))
        {this.defaultPlugins=plugins;}
        else if(IsPlainObject(plugins))
        {this.installGlobalPlugins=GetFastValue(plugins,'global',[]);this.installScenePlugins=GetFastValue(plugins,'scene',[]);if(Array.isArray(plugins.default))
        {defaultPlugins=plugins.default;}
        else if(Array.isArray(plugins.defaultMerge))
        {defaultPlugins=defaultPlugins.concat(plugins.defaultMerge);}}}
            this.defaultPlugins=defaultPlugins;var pngPrefix='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAg';this.defaultImage=GetValue(config,'images.default',pngPrefix+'AQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==');this.missingImage=GetValue(config,'images.missing',pngPrefix+'CAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==');if(window)
        {if(window.FORCE_WEBGL)
        {this.renderType=CONST.WEBGL;}
        else if(window.FORCE_CANVAS)
        {this.renderType=CONST.CANVAS;}}}});module.exports=Config;}),"./boot/CreateDOMContainer.js":(function(module,exports,__webpack_require__){var AddToDOM=__webpack_require__("./dom/AddToDOM.js");var CreateDOMContainer=function(game)
    {var config=game.config;if(!config.parent||!config.domCreateContainer)
    {return;}
        var div=document.createElement('div');div.style=['display: block;','width: '+game.canvas.width+'px;','height: '+game.canvas.height+'px;','padding: 0; margin: 0;','position: absolute;','overflow: hidden;','pointer-events: none;'].join(' ');game.domContainer=div;AddToDOM(div,config.parent);};module.exports=CreateDOMContainer;}),"./boot/CreateRenderer.js":(function(module,exports,__webpack_require__){var CanvasInterpolation=__webpack_require__("./display/canvas/CanvasInterpolation.js");var CanvasPool=__webpack_require__("./display/canvas/CanvasPool.js");var CONST=__webpack_require__("./const.js");var Features=__webpack_require__("./device/Features.js");var CreateRenderer=function(game)
    {var config=game.config;if((config.customEnvironment||config.canvas)&&config.renderType===CONST.AUTO)
    {throw new Error('Must set explicit renderType in custom environment');}
        if(!config.customEnvironment&&!config.canvas&&config.renderType!==CONST.HEADLESS)
        {if(config.renderType===CONST.CANVAS||(config.renderType!==CONST.CANVAS&&!Features.webGL))
        {if(Features.canvas)
        {config.renderType=CONST.CANVAS;}
        else
        {throw new Error('Cannot create Canvas or WebGL context, aborting.');}}
        else
        {config.renderType=CONST.WEBGL;}}
        if(!config.antialias)
        {CanvasPool.disableSmoothing();}
        var baseSize=game.scale.baseSize;if(config.canvas)
    {game.canvas=config.canvas;game.canvas.width=baseSize.width;game.canvas.height=baseSize.height;}
    else
    {game.canvas=CanvasPool.create(game,baseSize.width,baseSize.height,config.renderType);}
        if(config.canvasStyle)
        {game.canvas.style=config.canvasStyle;}
        if(!config.antialias)
        {CanvasInterpolation.setCrisp(game.canvas);}
        if(config.renderType===CONST.HEADLESS)
        {return;}
        var CanvasRenderer;var WebGLRenderer;if(true)
    {CanvasRenderer=__webpack_require__("./renderer/canvas/CanvasRenderer.js");WebGLRenderer=__webpack_require__("./renderer/webgl/WebGLRenderer.js");if(config.renderType===CONST.WEBGL)
    {game.renderer=new WebGLRenderer(game);}
    else
    {game.renderer=new CanvasRenderer(game);game.context=game.renderer.gameContext;}}
        if(false)
        {}
        if(false)
        {}};module.exports=CreateRenderer;}),"./boot/DebugHeader.js":(function(module,exports,__webpack_require__){var CONST=__webpack_require__("./const.js");var DebugHeader=function(game)
    {var config=game.config;if(config.hideBanner)
    {return;}
        var renderType='WebGL';if(config.renderType===CONST.CANVAS)
    {renderType='Canvas';}
    else if(config.renderType===CONST.HEADLESS)
    {renderType='Headless';}
        var audioConfig=config.audio;var deviceAudio=game.device.audio;var audioType;if(deviceAudio.webAudio&&!(audioConfig&&audioConfig.disableWebAudio))
    {audioType='Web Audio';}
    else if((audioConfig&&audioConfig.noAudio)||(!deviceAudio.webAudio&&!deviceAudio.audioData))
    {audioType='No Audio';}
    else
    {audioType='HTML5 Audio';}
        if(!game.device.browser.ie)
        {var c='';var args=[c];if(Array.isArray(config.bannerBackgroundColor))
        {var lastColor;config.bannerBackgroundColor.forEach(function(color)
        {c=c.concat('%c ');args.push('background: '+color);lastColor=color;});args[args.length-1]='color: '+config.bannerTextColor+'; background: '+lastColor;}
        else
        {c=c.concat('%c ');args.push('color: '+config.bannerTextColor+'; background: '+config.bannerBackgroundColor);}
            args.push('background: #fff');if(config.gameTitle)
        {c=c.concat(config.gameTitle);if(config.gameVersion)
        {c=c.concat(' v'+config.gameVersion);}
            if(!config.hidePhaser)
            {c=c.concat(' / ');}}
            var fb=(false)?undefined:'';if(!config.hidePhaser)
        {c=c.concat('Phaser v'+CONST.VERSION+fb+' ('+renderType+' | '+audioType+')');}
            c=c.concat(' %c '+config.gameURL);args[0]=c;console.log.apply(console,args);}
        else if(window['console'])
        {console.log('Phaser v'+CONST.VERSION+' / https://phaser.io');}};module.exports=DebugHeader;}),"./boot/Game.js":(function(module,exports,__webpack_require__){var AddToDOM=__webpack_require__("./dom/AddToDOM.js");var AnimationManager=__webpack_require__("./animations/AnimationManager.js");var CacheManager=__webpack_require__("./cache/CacheManager.js");var CanvasPool=__webpack_require__("./display/canvas/CanvasPool.js");var Class=__webpack_require__("./utils/Class.js");var Config=__webpack_require__("./boot/Config.js");var CreateRenderer=__webpack_require__("./boot/CreateRenderer.js");var DataManager=__webpack_require__("./data/DataManager.js");var DebugHeader=__webpack_require__("./boot/DebugHeader.js");var Device=__webpack_require__("./device/index.js");var DOMContentLoaded=__webpack_require__("./dom/DOMContentLoaded.js");var EventEmitter=__webpack_require__("../node_modules/eventemitter3/index.js");var InputManager=__webpack_require__("./input/InputManager.js");var PluginCache=__webpack_require__("./plugins/PluginCache.js");var PluginManager=__webpack_require__("./plugins/PluginManager.js");var ScaleManager=__webpack_require__("./dom/ScaleManager.js");var SceneManager=__webpack_require__("./scene/SceneManager.js");var SoundManagerCreator=__webpack_require__("./sound/SoundManagerCreator.js");var TextureManager=__webpack_require__("./textures/TextureManager.js");var TimeStep=__webpack_require__("./boot/TimeStep.js");var VisibilityHandler=__webpack_require__("./boot/VisibilityHandler.js");if(true)
    {var CreateDOMContainer=__webpack_require__("./boot/CreateDOMContainer.js");}
        if(false)
        {var FacebookInstantGamesPlugin;}
        var Game=new Class({initialize:function Game(config)
            {this.config=new Config(config);this.renderer=null;if(true)
            {this.domContainer=null;}
                this.canvas=null;this.context=null;this.isBooted=false;this.isRunning=false;this.events=new EventEmitter();this.anims=new AnimationManager(this);this.textures=new TextureManager(this);this.cache=new CacheManager(this);this.registry=new DataManager(this);this.input=new InputManager(this,this.config);this.scene=new SceneManager(this,this.config.sceneConfig);this.device=Device;this.scale=new ScaleManager(this,this.config);this.sound=SoundManagerCreator.create(this);this.loop=new TimeStep(this,this.config.fps);this.plugins=new PluginManager(this,this.config);if(false)
            {}
                this.pendingDestroy=false;this.removeCanvas=false;this.noReturn=false;this.hasFocus=false;DOMContentLoaded(this.boot.bind(this));},boot:function()
            {if(!PluginCache.hasCore('EventEmitter'))
            {console.warn('Aborting. Core Plugins missing.');return;}
                this.isBooted=true;this.config.preBoot(this);this.scale.preBoot();CreateRenderer(this);if(true)
            {CreateDOMContainer(this);}
                DebugHeader(this);AddToDOM(this.canvas,this.config.parent);this.events.emit('boot');this.events.once('texturesready',this.texturesReady,this);},texturesReady:function()
            {this.events.emit('ready');this.start();},start:function()
            {this.isRunning=true;this.config.postBoot(this);if(this.renderer)
            {this.loop.start(this.step.bind(this));}
            else
            {this.loop.start(this.headlessStep.bind(this));}
                VisibilityHandler(this);var eventEmitter=this.events;eventEmitter.on('hidden',this.onHidden,this);eventEmitter.on('visible',this.onVisible,this);eventEmitter.on('blur',this.onBlur,this);eventEmitter.on('focus',this.onFocus,this);},step:function(time,delta)
            {if(this.pendingDestroy)
            {return this.runDestroy();}
                var eventEmitter=this.events;eventEmitter.emit('prestep',time,delta);eventEmitter.emit('step',time,delta);this.scene.update(time,delta);eventEmitter.emit('poststep',time,delta);var renderer=this.renderer;renderer.preRender();eventEmitter.emit('prerender',renderer,time,delta);this.scene.render(renderer);renderer.postRender();eventEmitter.emit('postrender',renderer,time,delta);},headlessStep:function(time,delta)
            {var eventEmitter=this.events;eventEmitter.emit('prestep',time,delta);eventEmitter.emit('step',time,delta);this.scene.update(time,delta);eventEmitter.emit('poststep',time,delta);eventEmitter.emit('prerender');eventEmitter.emit('postrender');},onHidden:function()
            {this.loop.pause();this.events.emit('pause');},onVisible:function()
            {this.loop.resume();this.events.emit('resume');},onBlur:function()
            {this.hasFocus=false;this.loop.blur();},onFocus:function()
            {this.hasFocus=true;this.loop.focus();},getFrame:function()
            {return this.loop.frame;},getTime:function()
            {return this.loop.frame.time;},destroy:function(removeCanvas,noReturn)
            {if(noReturn===undefined){noReturn=false;}
                this.pendingDestroy=true;this.removeCanvas=removeCanvas;this.noReturn=noReturn;},runDestroy:function()
            {this.events.emit('destroy');this.events.removeAllListeners();this.scene.destroy();if(this.renderer)
            {this.renderer.destroy();}
                if(this.removeCanvas&&this.canvas)
                {CanvasPool.remove(this.canvas);if(this.canvas.parentNode)
                {this.canvas.parentNode.removeChild(this.canvas);}}
                if(true)
                {if(this.domContainer)
                {this.domContainer.parentNode.removeChild(this.domContainer);}}
                this.loop.destroy();this.pendingDestroy=false;}});module.exports=Game;}),"./boot/TimeStep.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var GetValue=__webpack_require__("./utils/object/GetValue.js");var NOOP=__webpack_require__("./utils/NOOP.js");var RequestAnimationFrame=__webpack_require__("./dom/RequestAnimationFrame.js");var TimeStep=new Class({initialize:function TimeStep(game,config)
        {this.game=game;this.raf=new RequestAnimationFrame();this.started=false;this.running=false;this.minFps=GetValue(config,'min',5);this.targetFps=GetValue(config,'target',60);this._min=1000 / this.minFps;this._target=1000 / this.targetFps;this.actualFps=this.targetFps;this.nextFpsUpdate=0;this.framesThisSecond=0;this.callback=NOOP;this.forceSetTimeOut=GetValue(config,'forceSetTimeOut',false);this.time=0;this.startTime=0;this.lastTime=0;this.frame=0;this.inFocus=true;this._pauseTime=0;this._coolDown=0;this.delta=0;this.deltaIndex=0;this.deltaHistory=[];this.deltaSmoothingMax=GetValue(config,'deltaHistory',10);this.panicMax=GetValue(config,'panicMax',120);this.rawDelta=0;},blur:function()
        {this.inFocus=false;},focus:function()
        {this.inFocus=true;this.resetDelta();},pause:function()
        {this._pauseTime=window.performance.now();},resume:function()
        {this.resetDelta();this.startTime+=this.time-this._pauseTime;},resetDelta:function()
        {var now=window.performance.now();this.time=now;this.lastTime=now;this.nextFpsUpdate=now+1000;this.framesThisSecond=0;this.frame=0;for(var i=0;i<this.deltaSmoothingMax;i++)
        {this.deltaHistory[i]=Math.min(this._target,this.deltaHistory[i]);}
            this.delta=0;this.deltaIndex=0;this._coolDown=this.panicMax;},start:function(callback)
        {if(this.started)
        {return this;}
            this.started=true;this.running=true;for(var i=0;i<this.deltaSmoothingMax;i++)
        {this.deltaHistory[i]=this._target;}
            this.resetDelta();this.startTime=window.performance.now();this.callback=callback;this.raf.start(this.step.bind(this),this.forceSetTimeOut);},step:function(time)
        {var before=time-this.lastTime;if(before<0)
        {before=0;}
            this.rawDelta=before;var idx=this.deltaIndex;var history=this.deltaHistory;var max=this.deltaSmoothingMax;var dt=before;if(this._coolDown>0||!this.inFocus)
        {this._coolDown--;dt=Math.min(dt,this._target);}
            if(dt>this._min)
            {dt=history[idx];dt=Math.min(dt,this._min);}
            history[idx]=dt;this.deltaIndex++;if(this.deltaIndex>max)
        {this.deltaIndex=0;}
            var avg=0;for(var i=0;i<max;i++)
        {avg+=history[i];}
            avg /=max;this.delta=avg;this.time+=this.rawDelta;if(time>this.nextFpsUpdate)
        {this.actualFps=0.25*this.framesThisSecond+0.75*this.actualFps;this.nextFpsUpdate=time+1000;this.framesThisSecond=0;}
            this.framesThisSecond++;var interpolation=avg / this._target;this.callback(time,avg,interpolation);this.lastTime=time;this.frame++;},tick:function()
        {this.step(window.performance.now());},sleep:function()
        {if(this.running)
        {this.raf.stop();this.running=false;}},wake:function(seamless)
        {if(this.running)
        {this.sleep();}
        else if(seamless)
        {this.startTime+=-this.lastTime+(this.lastTime+window.performance.now());}
            this.raf.start(this.step.bind(this),this.useRAF);this.running=true;this.step(window.performance.now());},stop:function()
        {this.running=false;this.started=false;this.raf.stop();return this;},destroy:function()
        {this.stop();this.callback=NOOP;this.raf=null;this.game=null;}});module.exports=TimeStep;}),"./boot/VisibilityHandler.js":(function(module,exports){var VisibilityHandler=function(game)
    {var hiddenVar;var eventEmitter=game.events;if(document.hidden!==undefined)
    {hiddenVar='visibilitychange';}
    else
    {var vendors=['webkit','moz','ms'];vendors.forEach(function(prefix)
    {if(document[prefix+'Hidden']!==undefined)
    {document.hidden=function()
    {return document[prefix+'Hidden'];};hiddenVar=prefix+'visibilitychange';}});}
        var onChange=function(event)
        {if(document.hidden||event.type==='pause')
        {eventEmitter.emit('hidden');}
        else
        {eventEmitter.emit('visible');}};if(hiddenVar)
    {document.addEventListener(hiddenVar,onChange,false);}
        window.onblur=function()
        {eventEmitter.emit('blur');};window.onfocus=function()
    {eventEmitter.emit('focus');};if(window.focus&&game.config.autoFocus)
    {window.focus();}};module.exports=VisibilityHandler;}),"./cache/BaseCache.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var CustomMap=__webpack_require__("./structs/Map.js");var EventEmitter=__webpack_require__("../node_modules/eventemitter3/index.js");var BaseCache=new Class({initialize:function BaseCache()
        {this.entries=new CustomMap();this.events=new EventEmitter();},add:function(key,data)
        {this.entries.set(key,data);this.events.emit('add',this,key,data);return this;},has:function(key)
        {return this.entries.has(key);},exists:function(key)
        {return this.entries.has(key);},get:function(key)
        {return this.entries.get(key);},remove:function(key)
        {var entry=this.get(key);if(entry)
        {this.entries.delete(key);this.events.emit('remove',this,key,entry.data);}
            return this;},destroy:function()
        {this.entries.clear();this.events.removeAllListeners();this.entries=null;this.events=null;}});module.exports=BaseCache;}),"./cache/CacheManager.js":(function(module,exports,__webpack_require__){var BaseCache=__webpack_require__("./cache/BaseCache.js");var Class=__webpack_require__("./utils/Class.js");var CacheManager=new Class({initialize:function CacheManager(game)
        {this.game=game;this.binary=new BaseCache();this.bitmapFont=new BaseCache();this.json=new BaseCache();this.physics=new BaseCache();this.shader=new BaseCache();this.audio=new BaseCache();this.text=new BaseCache();this.html=new BaseCache();this.obj=new BaseCache();this.tilemap=new BaseCache();this.xml=new BaseCache();this.custom={};this.game.events.once('destroy',this.destroy,this);},addCustom:function(key)
        {if(!this.custom.hasOwnProperty(key))
        {this.custom[key]=new BaseCache();}
            return this.custom[key];},destroy:function()
        {var keys=['binary','bitmapFont','json','physics','shader','audio','text','html','obj','tilemap','xml'];for(var i=0;i<keys.length;i++)
        {this[keys[i]].destroy();this[keys[i]]=null;}
            for(var key in this.custom)
            {this.custom[key].destroy();}
            this.custom=null;this.game=null;}});module.exports=CacheManager;}),"./cache/index.js":(function(module,exports,__webpack_require__){module.exports={BaseCache:__webpack_require__("./cache/BaseCache.js"),CacheManager:__webpack_require__("./cache/CacheManager.js")};}),"./cameras/2d/BaseCamera.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Components=__webpack_require__("./gameobjects/components/index.js");var DegToRad=__webpack_require__("./math/DegToRad.js");var EventEmitter=__webpack_require__("../node_modules/eventemitter3/index.js");var Rectangle=__webpack_require__("./geom/rectangle/Rectangle.js");var TransformMatrix=__webpack_require__("./gameobjects/components/TransformMatrix.js");var ValueToColor=__webpack_require__("./display/color/ValueToColor.js");var Vector2=__webpack_require__("./math/Vector2.js");var BaseCamera=new Class({Extends:EventEmitter,Mixins:[Components.Alpha,Components.Visible],initialize:function BaseCamera(x,y,width,height)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            if(width===undefined){width=0;}
            if(height===undefined){height=0;}
            EventEmitter.call(this);this.scene;this.sceneManager;this.scaleManager;this.id=0;this.name='';this.resolution=1;this.roundPixels=false;this.useBounds=false;this.worldView=new Rectangle();this.dirty=true;this._x=x;this._y=y;this._cx=0;this._cy=0;this._cw=0;this._ch=0;this._width=width;this._height=height;this._bounds=new Rectangle();this._scrollX=0;this._scrollY=0;this._zoom=1;this._rotation=0;this.matrix=new TransformMatrix();this.transparent=true;this.backgroundColor=ValueToColor('rgba(0,0,0,0)');this.disableCull=false;this.culledObjects=[];this.midPoint=new Vector2(width / 2,height / 2);this.originX=0.5;this.originY=0.5;this._customViewport=false;},setOrigin:function(x,y)
        {if(x===undefined){x=0.5;}
            if(y===undefined){y=x;}
            this.originX=x;this.originY=y;return this;},getScroll:function(x,y,out)
        {if(out===undefined){out=new Vector2();}
            var originX=this.width*0.5;var originY=this.height*0.5;out.x=x-originX;out.y=y-originY;if(this.useBounds)
        {out.x=this.clampX(out.x);out.y=this.clampY(out.y);}
            return out;},centerOnX:function(x)
        {var originX=this.width*0.5;this.midPoint.x=x;this.scrollX=x-originX;if(this.useBounds)
        {this.scrollX=this.clampX(this.scrollX);}
            return this;},centerOnY:function(y)
        {var originY=this.height*0.5;this.midPoint.y=y;this.scrollY=y-originY;if(this.useBounds)
        {this.scrollY=this.clampY(this.scrollY);}
            return this;},centerOn:function(x,y)
        {this.centerOnX(x);this.centerOnY(y);return this;},centerToBounds:function()
        {if(this.useBounds)
        {var bounds=this._bounds;var originX=this.width*0.5;var originY=this.height*0.5;this.midPoint.set(bounds.centerX,bounds.centerY);this.scrollX=bounds.centerX-originX;this.scrollY=bounds.centerY-originY;}
            return this;},centerToSize:function()
        {this.scrollX=this.width*0.5;this.scrollY=this.height*0.5;return this;},cull:function(renderableObjects)
        {if(this.disableCull)
        {return renderableObjects;}
            var cameraMatrix=this.matrix.matrix;var mva=cameraMatrix[0];var mvb=cameraMatrix[1];var mvc=cameraMatrix[2];var mvd=cameraMatrix[3];var determinant=(mva*mvd)-(mvb*mvc);if(!determinant)
        {return renderableObjects;}
            var mve=cameraMatrix[4];var mvf=cameraMatrix[5];var scrollX=this.scrollX;var scrollY=this.scrollY;var cameraW=this.width;var cameraH=this.height;var culledObjects=this.culledObjects;var length=renderableObjects.length;determinant=1 / determinant;culledObjects.length=0;for(var index=0;index<length;++index)
        {var object=renderableObjects[index];if(!object.hasOwnProperty('width')||object.parentContainer)
        {culledObjects.push(object);continue;}
            var objectW=object.width;var objectH=object.height;var objectX=(object.x-(scrollX*object.scrollFactorX))-(objectW*object.originX);var objectY=(object.y-(scrollY*object.scrollFactorY))-(objectH*object.originY);var tx=(objectX*mva+objectY*mvc+mve);var ty=(objectX*mvb+objectY*mvd+mvf);var tw=((objectX+objectW)*mva+(objectY+objectH)*mvc+mve);var th=((objectX+objectW)*mvb+(objectY+objectH)*mvd+mvf);var cullTop=this.y;var cullBottom=cullTop+cameraH;var cullLeft=this.x;var cullRight=cullLeft+cameraW;if((tw>cullLeft&&tx<cullRight)&&(th>cullTop&&ty<cullBottom))
        {culledObjects.push(object);}}
            return culledObjects;},getWorldPoint:function(x,y,output)
        {if(output===undefined){output=new Vector2();}
            var cameraMatrix=this.matrix.matrix;var mva=cameraMatrix[0];var mvb=cameraMatrix[1];var mvc=cameraMatrix[2];var mvd=cameraMatrix[3];var mve=cameraMatrix[4];var mvf=cameraMatrix[5];var determinant=(mva*mvd)-(mvb*mvc);if(!determinant)
        {output.x=x;output.y=y;return output;}
            determinant=1 / determinant;var ima=mvd*determinant;var imb=-mvb*determinant;var imc=-mvc*determinant;var imd=mva*determinant;var ime=(mvc*mvf-mvd*mve)*determinant;var imf=(mvb*mve-mva*mvf)*determinant;var c=Math.cos(this.rotation);var s=Math.sin(this.rotation);var zoom=this.zoom;var res=this.resolution;var scrollX=this.scrollX;var scrollY=this.scrollY;var sx=x+((scrollX*c-scrollY*s)*zoom);var sy=y+((scrollX*s+scrollY*c)*zoom);output.x=(sx*ima+sy*imc)*res+ime;output.y=(sx*imb+sy*imd)*res+imf;return output;},ignore:function(entries)
        {var id=this.id;if(!Array.isArray(entries))
        {entries=[entries];}
            for(var i=0;i<entries.length;i++)
            {var entry=entries[i];if(Array.isArray(entry))
            {this.ignore(entry);}
            else if(entry.isParent)
            {this.ignore(entry.getChildren());}
            else
            {entry.cameraFilter|=id;}}
            return this;},preRender:function(resolution)
        {var width=this.width;var height=this.height;var halfWidth=width*0.5;var halfHeight=height*0.5;var zoom=this.zoom*resolution;var matrix=this.matrix;var originX=width*this.originX;var originY=height*this.originY;var sx=this.scrollX;var sy=this.scrollY;if(this.useBounds)
        {sx=this.clampX(sx);sy=this.clampY(sy);}
            if(this.roundPixels)
            {originX=Math.round(originX);originY=Math.round(originY);}
            this.scrollX=sx;this.scrollY=sy;var midX=sx+halfWidth;var midY=sy+halfHeight;this.midPoint.set(midX,midY);var displayWidth=width / zoom;var displayHeight=height / zoom;this.worldView.setTo(midX-(displayWidth / 2),midY-(displayHeight / 2),displayWidth,displayHeight);matrix.loadIdentity();matrix.scale(resolution,resolution);matrix.translate(this.x+originX,this.y+originY);matrix.rotate(this.rotation);matrix.scale(zoom,zoom);matrix.translate(-(originX / resolution),-(originY / resolution));},clampX:function(x)
        {var bounds=this._bounds;var dw=this.displayWidth;var bx=bounds.x+((dw-this.width)/ 2);var bw=Math.max(bx,bx+bounds.width-dw);if(x<bx)
        {x=bx;}
        else if(x>bw)
        {x=bw;}
            return x;},clampY:function(y)
        {var bounds=this._bounds;var dh=this.displayHeight;var by=bounds.y+((dh-this.height)/ 2);var bh=Math.max(by,by+bounds.height-dh);if(y<by)
        {y=by;}
        else if(y>bh)
        {y=bh;}
            return y;},removeBounds:function()
        {this.useBounds=false;this.dirty=true;this._bounds.setEmpty();return this;},setAngle:function(value)
        {if(value===undefined){value=0;}
            this.rotation=DegToRad(value);return this;},setBackgroundColor:function(color)
        {if(color===undefined){color='rgba(0,0,0,0)';}
            this.backgroundColor=ValueToColor(color);this.transparent=(this.backgroundColor.alpha===0);return this;},setBounds:function(x,y,width,height,centerOn)
        {if(centerOn===undefined){centerOn=false;}
            this._bounds.setTo(x,y,width,height);this.dirty=true;this.useBounds=true;if(centerOn)
        {this.centerToBounds();}
        else
        {this.scrollX=this.clampX(this.scrollX);this.scrollY=this.clampY(this.scrollY);}
            return this;},getBounds:function(out)
        {if(out===undefined){out=new Rectangle();}
            var source=this._bounds;out.setTo(source.x,source.y,source.width,source.height);return out;},setName:function(value)
        {if(value===undefined){value='';}
            this.name=value;return this;},setPosition:function(x,y)
        {if(y===undefined){y=x;}
            this.x=x;this.y=y;return this;},setRotation:function(value)
        {if(value===undefined){value=0;}
            this.rotation=value;return this;},setRoundPixels:function(value)
        {this.roundPixels=value;return this;},setScene:function(scene)
        {if(this.scene&&this._customViewport)
        {this.sceneManager.customViewports--;}
            this.scene=scene;this.sceneManager=scene.sys.game.scene;this.scaleManager=scene.sys.scale;var res=this.scaleManager.resolution;this.resolution=res;this._cx=this._x*res;this._cy=this._y*res;this._cw=this._width*res;this._ch=this._height*res;this.updateSystem();return this;},setScroll:function(x,y)
        {if(y===undefined){y=x;}
            this.scrollX=x;this.scrollY=y;return this;},setSize:function(width,height)
        {if(height===undefined){height=width;}
            this.width=width;this.height=height;return this;},setViewport:function(x,y,width,height)
        {this.x=x;this.y=y;this.width=width;this.height=height;return this;},setZoom:function(value)
        {if(value===undefined){value=1;}
            if(value===0)
            {value=0.001;}
            this.zoom=value;return this;},toJSON:function()
        {var output={name:this.name,x:this.x,y:this.y,width:this.width,height:this.height,zoom:this.zoom,rotation:this.rotation,roundPixels:this.roundPixels,scrollX:this.scrollX,scrollY:this.scrollY,backgroundColor:this.backgroundColor.rgba};if(this.useBounds)
        {output['bounds']={x:this._bounds.x,y:this._bounds.y,width:this._bounds.width,height:this._bounds.height};}
            return output;},update:function()
        {},updateSystem:function()
        {if(!this.scaleManager)
        {return;}
            var custom=(this._x!==0||this._y!==0||this.scaleManager.width!==this._width||this.scaleManager.height!==this._height);var sceneManager=this.sceneManager;if(custom&&!this._customViewport)
        {sceneManager.customViewports++;}
        else if(!custom&&this._customViewport)
        {sceneManager.customViewports--;}
            this.dirty=true;this._customViewport=custom;},destroy:function()
        {this.emit('cameradestroy',this);this.removeAllListeners();this.matrix.destroy();this.culledObjects=[];if(this._customViewport)
        {this.sceneManager.customViewports--;}
            this._bounds=null;this.scene=null;this.scaleManager=null;this.sceneManager=null;},x:{get:function()
            {return this._x;},set:function(value)
            {this._x=value;this._cx=value*this.resolution;this.updateSystem();}},y:{get:function()
            {return this._y;},set:function(value)
            {this._y=value;this._cy=value*this.resolution;this.updateSystem();}},width:{get:function()
            {return this._width;},set:function(value)
            {this._width=value;this._cw=value*this.resolution;this.updateSystem();}},height:{get:function()
            {return this._height;},set:function(value)
            {this._height=value;this._ch=value*this.resolution;this.updateSystem();}},scrollX:{get:function()
            {return this._scrollX;},set:function(value)
            {this._scrollX=value;this.dirty=true;}},scrollY:{get:function()
            {return this._scrollY;},set:function(value)
            {this._scrollY=value;this.dirty=true;}},zoom:{get:function()
            {return this._zoom;},set:function(value)
            {this._zoom=value;this.dirty=true;}},rotation:{get:function()
            {return this._rotation;},set:function(value)
            {this._rotation=value;this.dirty=true;}},centerX:{get:function()
            {return this.x+(0.5*this.width);}},centerY:{get:function()
            {return this.y+(0.5*this.height);}},displayWidth:{get:function()
            {return this.width / this.zoom;}},displayHeight:{get:function()
            {return this.height / this.zoom;}}});module.exports=BaseCamera;}),"./cameras/2d/Camera.js":(function(module,exports,__webpack_require__){var BaseCamera=__webpack_require__("./cameras/2d/BaseCamera.js");var CanvasPool=__webpack_require__("./display/canvas/CanvasPool.js");var CenterOn=__webpack_require__("./geom/rectangle/CenterOn.js");var Clamp=__webpack_require__("./math/Clamp.js");var Class=__webpack_require__("./utils/Class.js");var Components=__webpack_require__("./gameobjects/components/index.js");var Effects=__webpack_require__("./cameras/2d/effects/index.js");var Linear=__webpack_require__("./math/Linear.js");var Rectangle=__webpack_require__("./geom/rectangle/Rectangle.js");var Vector2=__webpack_require__("./math/Vector2.js");var Camera=new Class({Extends:BaseCamera,Mixins:[Components.Flip,Components.Tint],initialize:function Camera(x,y,width,height)
        {BaseCamera.call(this,x,y,width,height);this.inputEnabled=true;this.fadeEffect=new Effects.Fade(this);this.flashEffect=new Effects.Flash(this);this.shakeEffect=new Effects.Shake(this);this.panEffect=new Effects.Pan(this);this.zoomEffect=new Effects.Zoom(this);this.lerp=new Vector2(1,1);this.followOffset=new Vector2();this.deadzone=null;this._follow=null;this.renderToTexture=false;this.canvas=null;this.context=null;this.glTexture=null;this.framebuffer=null;this.pipeline=null;},setRenderToTexture:function(pipeline)
        {var renderer=this.scene.sys.game.renderer;if(renderer.gl)
        {this.glTexture=renderer.createTextureFromSource(null,this.width,this.height,0);this.framebuffer=renderer.createFramebuffer(this.width,this.height,this.glTexture,false);}
        else
        {this.canvas=CanvasPool.create2D(this,this.width,this.height);this.context=this.canvas.getContext('2d');}
            this.renderToTexture=true;if(pipeline)
        {this.setPipeline(pipeline);}
            return this;},setPipeline:function(pipeline)
        {if(typeof pipeline==='string')
        {var renderer=this.scene.sys.game.renderer;if(renderer.gl&&renderer.hasPipeline(pipeline))
        {this.pipeline=renderer.getPipeline(pipeline);}}
        else
        {this.pipeline=pipeline;}
            return this;},clearRenderToTexture:function()
        {var renderer=this.scene.sys.game.renderer;if(renderer.gl)
        {if(this.framebuffer)
        {renderer.deleteFramebuffer(this.framebuffer);}
            if(this.glTexture)
            {renderer.deleteTexture(this.glTexture);}
            this.framebuffer=null;this.glTexture=null;this.pipeline=null;}
        else
        {CanvasPool.remove(this);this.canvas=null;this.context=null;}
            this.renderToTexture=false;return this;},setDeadzone:function(width,height)
        {if(width===undefined)
        {this.deadzone=null;}
        else
        {if(this.deadzone)
        {this.deadzone.width=width;this.deadzone.height=height;}
        else
        {this.deadzone=new Rectangle(0,0,width,height);}
            if(this._follow)
            {var originX=this.width / 2;var originY=this.height / 2;var fx=this._follow.x-this.followOffset.x;var fy=this._follow.y-this.followOffset.y;this.midPoint.set(fx,fy);this.scrollX=fx-originX;this.scrollY=fy-originY;}
            CenterOn(this.deadzone,this.midPoint.x,this.midPoint.y);}
            return this;},fadeIn:function(duration,red,green,blue,callback,context)
        {return this.fadeEffect.start(false,duration,red,green,blue,true,callback,context);},fadeOut:function(duration,red,green,blue,callback,context)
        {return this.fadeEffect.start(true,duration,red,green,blue,true,callback,context);},fadeFrom:function(duration,red,green,blue,force,callback,context)
        {return this.fadeEffect.start(false,duration,red,green,blue,force,callback,context);},fade:function(duration,red,green,blue,force,callback,context)
        {return this.fadeEffect.start(true,duration,red,green,blue,force,callback,context);},flash:function(duration,red,green,blue,force,callback,context)
        {return this.flashEffect.start(duration,red,green,blue,force,callback,context);},shake:function(duration,intensity,force,callback,context)
        {return this.shakeEffect.start(duration,intensity,force,callback,context);},pan:function(x,y,duration,ease,force,callback,context)
        {return this.panEffect.start(x,y,duration,ease,force,callback,context);},zoomTo:function(zoom,duration,ease,force,callback,context)
        {return this.zoomEffect.start(zoom,duration,ease,force,callback,context);},preRender:function(resolution)
        {var width=this.width;var height=this.height;var halfWidth=width*0.5;var halfHeight=height*0.5;var zoom=this.zoom*resolution;var matrix=this.matrix;var originX=width*this.originX;var originY=height*this.originY;var follow=this._follow;var deadzone=this.deadzone;var sx=this.scrollX;var sy=this.scrollY;if(deadzone)
        {CenterOn(deadzone,this.midPoint.x,this.midPoint.y);}
            if(follow)
            {var fx=(follow.x-this.followOffset.x);var fy=(follow.y-this.followOffset.y);if(deadzone)
            {if(fx<deadzone.x)
            {sx=Linear(sx,sx-(deadzone.x-fx),this.lerp.x);}
            else if(fx>deadzone.right)
            {sx=Linear(sx,sx+(fx-deadzone.right),this.lerp.x);}
                if(fy<deadzone.y)
                {sy=Linear(sy,sy-(deadzone.y-fy),this.lerp.y);}
                else if(fy>deadzone.bottom)
                {sy=Linear(sy,sy+(fy-deadzone.bottom),this.lerp.y);}}
            else
            {sx=Linear(sx,fx-originX,this.lerp.x);sy=Linear(sy,fy-originY,this.lerp.y);}}
            if(this.useBounds)
            {sx=this.clampX(sx);sy=this.clampY(sy);}
            if(this.roundPixels)
            {originX=Math.round(originX);originY=Math.round(originY);}
            this.scrollX=sx;this.scrollY=sy;var midX=sx+halfWidth;var midY=sy+halfHeight;this.midPoint.set(midX,midY);var displayWidth=width / zoom;var displayHeight=height / zoom;this.worldView.setTo(midX-(displayWidth / 2),midY-(displayHeight / 2),displayWidth,displayHeight);matrix.loadIdentity();matrix.scale(resolution,resolution);matrix.translate(this.x+originX,this.y+originY);matrix.rotate(this.rotation);matrix.scale(zoom,zoom);matrix.translate(-(originX / resolution),-(originY / resolution));this.shakeEffect.preRender();},setLerp:function(x,y)
        {if(x===undefined){x=1;}
            if(y===undefined){y=x;}
            this.lerp.set(x,y);return this;},setFollowOffset:function(x,y)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            this.followOffset.set(x,y);return this;},startFollow:function(target,roundPixels,lerpX,lerpY,offsetX,offsetY)
        {if(roundPixels===undefined){roundPixels=false;}
            if(lerpX===undefined){lerpX=1;}
            if(lerpY===undefined){lerpY=lerpX;}
            if(offsetX===undefined){offsetX=0;}
            if(offsetY===undefined){offsetY=offsetX;}
            this._follow=target;this.roundPixels=roundPixels;lerpX=Clamp(lerpX,0,1);lerpY=Clamp(lerpY,0,1);this.lerp.set(lerpX,lerpY);this.followOffset.set(offsetX,offsetY);var originX=this.width / 2;var originY=this.height / 2;var fx=target.x-offsetX;var fy=target.y-offsetY;this.midPoint.set(fx,fy);this.scrollX=fx-originX;this.scrollY=fy-originY;return this;},stopFollow:function()
        {this._follow=null;return this;},resetFX:function()
        {this.panEffect.reset();this.shakeEffect.reset();this.flashEffect.reset();this.fadeEffect.reset();return this;},update:function(time,delta)
        {if(this.visible)
        {this.panEffect.update(time,delta);this.zoomEffect.update(time,delta);this.shakeEffect.update(time,delta);this.flashEffect.update(time,delta);this.fadeEffect.update(time,delta);}},destroy:function()
        {this.clearRenderToTexture();this.resetFX();BaseCamera.prototype.destroy.call(this);this._follow=null;this.deadzone=null;}});module.exports=Camera;}),"./cameras/2d/CameraManager.js":(function(module,exports,__webpack_require__){var Camera=__webpack_require__("./cameras/2d/Camera.js");var Class=__webpack_require__("./utils/Class.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var PluginCache=__webpack_require__("./plugins/PluginCache.js");var RectangleContains=__webpack_require__("./geom/rectangle/Contains.js");var CameraManager=new Class({initialize:function CameraManager(scene)
        {this.scene=scene;this.systems=scene.sys;this.roundPixels=scene.sys.game.config.roundPixels;this.cameras=[];this.main;scene.sys.events.once('boot',this.boot,this);scene.sys.events.on('start',this.start,this);},boot:function()
        {var sys=this.systems;if(sys.settings.cameras)
        {this.fromJSON(sys.settings.cameras);}
        else
        {this.add();}
            this.main=this.cameras[0];this.systems.events.once('destroy',this.destroy,this);},start:function()
        {if(!this.main)
        {var sys=this.systems;if(sys.settings.cameras)
        {this.fromJSON(sys.settings.cameras);}
        else
        {this.add();}
            this.main=this.cameras[0];}
            var eventEmitter=this.systems.events;eventEmitter.on('update',this.update,this);eventEmitter.once('shutdown',this.shutdown,this);},add:function(x,y,width,height,makeMain,name)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            if(width===undefined){width=this.scene.sys.scale.width;}
            if(height===undefined){height=this.scene.sys.scale.height;}
            if(makeMain===undefined){makeMain=false;}
            if(name===undefined){name='';}
            var camera=new Camera(x,y,width,height);camera.setName(name);camera.setScene(this.scene);camera.setRoundPixels(this.roundPixels);camera.id=this.getNextID();this.cameras.push(camera);if(makeMain)
        {this.main=camera;}
            return camera;},addExisting:function(camera,makeMain)
        {if(makeMain===undefined){makeMain=false;}
            var index=this.cameras.indexOf(camera);if(index===-1)
        {camera.id=this.getNextID();camera.setRoundPixels(this.roundPixels);this.cameras.push(camera);if(makeMain)
        {this.main=camera;}
            return camera;}
            return null;},getNextID:function()
        {var cameras=this.cameras;var testID=1;for(var t=0;t<32;t++)
        {var found=false;for(var i=0;i<cameras.length;i++)
        {var camera=cameras[i];if(camera&&camera.id===testID)
        {found=true;continue;}}
            if(found)
            {testID=testID<<1;}
            else
            {return testID;}}
            return 0;},getTotal:function(isVisible)
        {if(isVisible===undefined){isVisible=false;}
            var total=0;var cameras=this.cameras;for(var i=0;i<cameras.length;i++)
        {var camera=cameras[i];if(!isVisible||(isVisible&&camera.visible))
        {total++;}}
            return total;},fromJSON:function(config)
        {if(!Array.isArray(config))
        {config=[config];}
            var gameWidth=this.scene.sys.scale.width;var gameHeight=this.scene.sys.scale.height;for(var i=0;i<config.length;i++)
        {var cameraConfig=config[i];var x=GetFastValue(cameraConfig,'x',0);var y=GetFastValue(cameraConfig,'y',0);var width=GetFastValue(cameraConfig,'width',gameWidth);var height=GetFastValue(cameraConfig,'height',gameHeight);var camera=this.add(x,y,width,height);camera.name=GetFastValue(cameraConfig,'name','');camera.zoom=GetFastValue(cameraConfig,'zoom',1);camera.rotation=GetFastValue(cameraConfig,'rotation',0);camera.scrollX=GetFastValue(cameraConfig,'scrollX',0);camera.scrollY=GetFastValue(cameraConfig,'scrollY',0);camera.roundPixels=GetFastValue(cameraConfig,'roundPixels',false);camera.visible=GetFastValue(cameraConfig,'visible',true);var backgroundColor=GetFastValue(cameraConfig,'backgroundColor',false);if(backgroundColor)
        {camera.setBackgroundColor(backgroundColor);}
            var boundsConfig=GetFastValue(cameraConfig,'bounds',null);if(boundsConfig)
        {var bx=GetFastValue(boundsConfig,'x',0);var by=GetFastValue(boundsConfig,'y',0);var bwidth=GetFastValue(boundsConfig,'width',gameWidth);var bheight=GetFastValue(boundsConfig,'height',gameHeight);camera.setBounds(bx,by,bwidth,bheight);}}
            return this;},getCamera:function(name)
        {var cameras=this.cameras;for(var i=0;i<cameras.length;i++)
        {if(cameras[i].name===name)
        {return cameras[i];}}
            return null;},getCamerasBelowPointer:function(pointer)
        {var cameras=this.cameras;var x=pointer.x;var y=pointer.y;var output=[];for(var i=0;i<cameras.length;i++)
        {var camera=cameras[i];if(camera.visible&&camera.inputEnabled&&RectangleContains(camera,x,y))
        {output.unshift(camera);}}
            return output;},remove:function(camera,runDestroy)
        {if(runDestroy===undefined){runDestroy=true;}
            if(!Array.isArray(camera))
            {camera=[camera];}
            var total=0;var cameras=this.cameras;for(var i=0;i<camera.length;i++)
        {var index=cameras.indexOf(camera[i]);if(index!==-1)
        {if(runDestroy)
        {cameras[index].destroy();}
            cameras.splice(index,1);total++;}}
            if(!this.main&&cameras[0])
            {this.main=cameras[0];}
            return total;},render:function(renderer,children,interpolation)
        {var scene=this.scene;var cameras=this.cameras;var resolution=this.systems.game.scale.resolution;for(var i=0;i<this.cameras.length;i++)
        {var camera=cameras[i];if(camera.visible&&camera.alpha>0)
        {camera.preRender(resolution);renderer.render(scene,children,interpolation,camera);}}},resetAll:function()
        {for(var i=0;i<this.cameras.length;i++)
        {this.cameras[i].destroy();}
            this.cameras=[];this.main=this.add();return this.main;},update:function(timestep,delta)
        {for(var i=0;i<this.cameras.length;i++)
        {this.cameras[i].update(timestep,delta);}},resize:function(width,height)
        {for(var i=0;i<this.cameras.length;i++)
        {this.cameras[i].setSize(width,height);}},shutdown:function()
        {this.main=undefined;for(var i=0;i<this.cameras.length;i++)
        {this.cameras[i].destroy();}
            this.cameras=[];var eventEmitter=this.systems.events;eventEmitter.off('update',this.update,this);eventEmitter.off('shutdown',this.shutdown,this);},destroy:function()
        {this.shutdown();this.scene.sys.events.off('start',this.start,this);this.scene=null;this.systems=null;}});PluginCache.register('CameraManager',CameraManager,'cameras');module.exports=CameraManager;}),"./cameras/2d/effects/Fade.js":(function(module,exports,__webpack_require__){var Clamp=__webpack_require__("./math/Clamp.js");var Class=__webpack_require__("./utils/Class.js");var Fade=new Class({initialize:function Fade(camera)
        {this.camera=camera;this.isRunning=false;this.isComplete=false;this.direction=true;this.duration=0;this.red=0;this.green=0;this.blue=0;this.alpha=0;this.progress=0;this._elapsed=0;this._onUpdate;this._onUpdateScope;},start:function(direction,duration,red,green,blue,force,callback,context)
        {if(direction===undefined){direction=true;}
            if(duration===undefined){duration=1000;}
            if(red===undefined){red=0;}
            if(green===undefined){green=0;}
            if(blue===undefined){blue=0;}
            if(force===undefined){force=false;}
            if(callback===undefined){callback=null;}
            if(context===undefined){context=this.camera.scene;}
            if(!force&&this.isRunning)
            {return this.camera;}
            this.isRunning=true;this.isComplete=false;this.duration=duration;this.direction=direction;this.progress=0;this.red=red;this.green=green;this.blue=blue;this.alpha=(direction)?Number.MIN_VALUE:1;this._elapsed=0;this._onUpdate=callback;this._onUpdateScope=context;var eventName=(direction)?'camerafadeoutstart':'camerafadeinstart';this.camera.emit(eventName,this.camera,this,duration,red,green,blue);return this.camera;},update:function(time,delta)
        {if(!this.isRunning)
        {return;}
            this._elapsed+=delta;this.progress=Clamp(this._elapsed / this.duration,0,1);if(this._onUpdate)
        {this._onUpdate.call(this._onUpdateScope,this.camera,this.progress);}
            if(this._elapsed<this.duration)
            {this.alpha=(this.direction)?this.progress:1-this.progress;}
            else
            {this.effectComplete();}},postRenderCanvas:function(ctx)
        {if(!this.isRunning&&!this.isComplete)
        {return false;}
            var camera=this.camera;ctx.fillStyle='rgba('+this.red+','+this.green+','+this.blue+','+this.alpha+')';ctx.fillRect(camera._cx,camera._cy,camera._cw,camera._ch);return true;},postRenderWebGL:function(pipeline,getTintFunction)
        {if(!this.isRunning&&!this.isComplete)
        {return false;}
            var camera=this.camera;var red=this.red / 255;var blue=this.blue / 255;var green=this.green / 255;pipeline.drawFillRect(camera._cx,camera._cy,camera._cw,camera._ch,getTintFunction(red,green,blue,1),this.alpha);return true;},effectComplete:function()
        {this._onUpdate=null;this._onUpdateScope=null;this.isRunning=false;this.isComplete=true;var eventName=(this.direction)?'camerafadeoutcomplete':'camerafadeincomplete';this.camera.emit(eventName,this.camera,this);},reset:function()
        {this.isRunning=false;this.isComplete=false;this._onUpdate=null;this._onUpdateScope=null;},destroy:function()
        {this.reset();this.camera=null;}});module.exports=Fade;}),"./cameras/2d/effects/Flash.js":(function(module,exports,__webpack_require__){var Clamp=__webpack_require__("./math/Clamp.js");var Class=__webpack_require__("./utils/Class.js");var Flash=new Class({initialize:function Flash(camera)
        {this.camera=camera;this.isRunning=false;this.duration=0;this.red=0;this.green=0;this.blue=0;this.alpha=0;this.progress=0;this._elapsed=0;this._onUpdate;this._onUpdateScope;},start:function(duration,red,green,blue,force,callback,context)
        {if(duration===undefined){duration=250;}
            if(red===undefined){red=255;}
            if(green===undefined){green=255;}
            if(blue===undefined){blue=255;}
            if(force===undefined){force=false;}
            if(callback===undefined){callback=null;}
            if(context===undefined){context=this.camera.scene;}
            if(!force&&this.isRunning)
            {return this.camera;}
            this.isRunning=true;this.duration=duration;this.progress=0;this.red=red;this.green=green;this.blue=blue;this.alpha=1;this._elapsed=0;this._onUpdate=callback;this._onUpdateScope=context;this.camera.emit('cameraflashstart',this.camera,this,duration,red,green,blue);return this.camera;},update:function(time,delta)
        {if(!this.isRunning)
        {return;}
            this._elapsed+=delta;this.progress=Clamp(this._elapsed / this.duration,0,1);if(this._onUpdate)
        {this._onUpdate.call(this._onUpdateScope,this.camera,this.progress);}
            if(this._elapsed<this.duration)
            {this.alpha=1-this.progress;}
            else
            {this.effectComplete();}},postRenderCanvas:function(ctx)
        {if(!this.isRunning)
        {return false;}
            var camera=this.camera;ctx.fillStyle='rgba('+this.red+','+this.green+','+this.blue+','+this.alpha+')';ctx.fillRect(camera._cx,camera._cy,camera._cw,camera._ch);return true;},postRenderWebGL:function(pipeline,getTintFunction)
        {if(!this.isRunning)
        {return false;}
            var camera=this.camera;var red=this.red / 255;var blue=this.blue / 255;var green=this.green / 255;pipeline.drawFillRect(camera._cx,camera._cy,camera._cw,camera._ch,getTintFunction(red,green,blue,1),this.alpha);return true;},effectComplete:function()
        {this._onUpdate=null;this._onUpdateScope=null;this.isRunning=false;this.camera.emit('cameraflashcomplete',this.camera,this);},reset:function()
        {this.isRunning=false;this._onUpdate=null;this._onUpdateScope=null;},destroy:function()
        {this.reset();this.camera=null;}});module.exports=Flash;}),"./cameras/2d/effects/Pan.js":(function(module,exports,__webpack_require__){var Clamp=__webpack_require__("./math/Clamp.js");var Class=__webpack_require__("./utils/Class.js");var Vector2=__webpack_require__("./math/Vector2.js");var EaseMap=__webpack_require__("./math/easing/EaseMap.js");var Pan=new Class({initialize:function Pan(camera)
        {this.camera=camera;this.isRunning=false;this.duration=0;this.source=new Vector2();this.current=new Vector2();this.destination=new Vector2();this.ease;this.progress=0;this._elapsed=0;this._onUpdate;this._onUpdateScope;},start:function(x,y,duration,ease,force,callback,context)
        {if(duration===undefined){duration=1000;}
            if(ease===undefined){ease=EaseMap.Linear;}
            if(force===undefined){force=false;}
            if(callback===undefined){callback=null;}
            if(context===undefined){context=this.camera.scene;}
            var cam=this.camera;if(!force&&this.isRunning)
        {return cam;}
            this.isRunning=true;this.duration=duration;this.progress=0;this.source.set(cam.scrollX,cam.scrollY);this.destination.set(x,y);cam.getScroll(x,y,this.current);if(typeof ease==='string'&&EaseMap.hasOwnProperty(ease))
        {this.ease=EaseMap[ease];}
        else if(typeof ease==='function')
        {this.ease=ease;}
            this._elapsed=0;this._onUpdate=callback;this._onUpdateScope=context;this.camera.emit('camerapanstart',this.camera,this,duration,x,y);return cam;},update:function(time,delta)
        {if(!this.isRunning)
        {return;}
            this._elapsed+=delta;var progress=Clamp(this._elapsed / this.duration,0,1);this.progress=progress;var cam=this.camera;if(this._elapsed<this.duration)
        {var v=this.ease(progress);cam.getScroll(this.destination.x,this.destination.y,this.current);var x=this.source.x+((this.current.x-this.source.x)*v);var y=this.source.y+((this.current.y-this.source.y)*v);cam.setScroll(x,y);if(this._onUpdate)
        {this._onUpdate.call(this._onUpdateScope,cam,progress,x,y);}}
        else
        {cam.centerOn(this.destination.x,this.destination.y);if(this._onUpdate)
        {this._onUpdate.call(this._onUpdateScope,cam,progress,cam.scrollX,cam.scrollY);}
            this.effectComplete();}},effectComplete:function()
        {this._onUpdate=null;this._onUpdateScope=null;this.isRunning=false;this.camera.emit('camerapancomplete',this.camera,this);},reset:function()
        {this.isRunning=false;this._onUpdate=null;this._onUpdateScope=null;},destroy:function()
        {this.reset();this.camera=null;this.source=null;this.destination=null;}});module.exports=Pan;}),"./cameras/2d/effects/Shake.js":(function(module,exports,__webpack_require__){var Clamp=__webpack_require__("./math/Clamp.js");var Class=__webpack_require__("./utils/Class.js");var Vector2=__webpack_require__("./math/Vector2.js");var Shake=new Class({initialize:function Shake(camera)
        {this.camera=camera;this.isRunning=false;this.duration=0;this.intensity=new Vector2();this.progress=0;this._elapsed=0;this._offsetX=0;this._offsetY=0;this._onUpdate;this._onUpdateScope;},start:function(duration,intensity,force,callback,context)
        {if(duration===undefined){duration=100;}
            if(intensity===undefined){intensity=0.05;}
            if(force===undefined){force=false;}
            if(callback===undefined){callback=null;}
            if(context===undefined){context=this.camera.scene;}
            if(!force&&this.isRunning)
            {return this.camera;}
            this.isRunning=true;this.duration=duration;this.progress=0;if(typeof intensity==='number')
        {this.intensity.set(intensity);}
        else
        {this.intensity.set(intensity.x,intensity.y);}
            this._elapsed=0;this._offsetX=0;this._offsetY=0;this._onUpdate=callback;this._onUpdateScope=context;this.camera.emit('camerashakestart',this.camera,this,duration,intensity);return this.camera;},preRender:function()
        {if(this.isRunning)
        {this.camera.matrix.translate(this._offsetX,this._offsetY);}},update:function(time,delta)
        {if(!this.isRunning)
        {return;}
            this._elapsed+=delta;this.progress=Clamp(this._elapsed / this.duration,0,1);if(this._onUpdate)
        {this._onUpdate.call(this._onUpdateScope,this.camera,this.progress);}
            if(this._elapsed<this.duration)
            {var intensity=this.intensity;var width=this.camera._cw;var height=this.camera._ch;var zoom=this.camera.zoom;this._offsetX=(Math.random()*intensity.x*width*2-intensity.x*width)*zoom;this._offsetY=(Math.random()*intensity.y*height*2-intensity.y*height)*zoom;if(this.camera.roundPixels)
            {this._offsetX=Math.round(this._offsetX);this._offsetY=Math.round(this._offsetY);}}
            else
            {this.effectComplete();}},effectComplete:function()
        {this._offsetX=0;this._offsetY=0;this._onUpdate=null;this._onUpdateScope=null;this.isRunning=false;this.camera.emit('camerashakecomplete',this.camera,this);},reset:function()
        {this.isRunning=false;this._offsetX=0;this._offsetY=0;this._onUpdate=null;this._onUpdateScope=null;},destroy:function()
        {this.reset();this.camera=null;this.intensity=null;}});module.exports=Shake;}),"./cameras/2d/effects/Zoom.js":(function(module,exports,__webpack_require__){var Clamp=__webpack_require__("./math/Clamp.js");var Class=__webpack_require__("./utils/Class.js");var EaseMap=__webpack_require__("./math/easing/EaseMap.js");var Zoom=new Class({initialize:function Zoom(camera)
        {this.camera=camera;this.isRunning=false;this.duration=0;this.source=1;this.destination=1;this.ease;this.progress=0;this._elapsed=0;this._onUpdate;this._onUpdateScope;},start:function(zoom,duration,ease,force,callback,context)
        {if(duration===undefined){duration=1000;}
            if(ease===undefined){ease=EaseMap.Linear;}
            if(force===undefined){force=false;}
            if(callback===undefined){callback=null;}
            if(context===undefined){context=this.camera.scene;}
            var cam=this.camera;if(!force&&this.isRunning)
        {return cam;}
            this.isRunning=true;this.duration=duration;this.progress=0;this.source=cam.zoom;this.destination=zoom;if(typeof ease==='string'&&EaseMap.hasOwnProperty(ease))
        {this.ease=EaseMap[ease];}
        else if(typeof ease==='function')
        {this.ease=ease;}
            this._elapsed=0;this._onUpdate=callback;this._onUpdateScope=context;this.camera.emit('camerazoomstart',this.camera,this,duration,zoom);return cam;},update:function(time,delta)
        {if(!this.isRunning)
        {return;}
            this._elapsed+=delta;this.progress=Clamp(this._elapsed / this.duration,0,1);if(this._elapsed<this.duration)
        {this.camera.zoom=this.source+((this.destination-this.source)*this.ease(this.progress));if(this._onUpdate)
        {this._onUpdate.call(this._onUpdateScope,this.camera,this.progress,this.camera.zoom);}}
        else
        {this.camera.zoom=this.destination;if(this._onUpdate)
        {this._onUpdate.call(this._onUpdateScope,this.camera,this.progress,this.destination);}
            this.effectComplete();}},effectComplete:function()
        {this._onUpdate=null;this._onUpdateScope=null;this.isRunning=false;this.camera.emit('camerazoomcomplete',this.camera,this);},reset:function()
        {this.isRunning=false;this._onUpdate=null;this._onUpdateScope=null;},destroy:function()
        {this.reset();this.camera=null;}});module.exports=Zoom;}),"./cameras/2d/effects/index.js":(function(module,exports,__webpack_require__){module.exports={Fade:__webpack_require__("./cameras/2d/effects/Fade.js"),Flash:__webpack_require__("./cameras/2d/effects/Flash.js"),Pan:__webpack_require__("./cameras/2d/effects/Pan.js"),Shake:__webpack_require__("./cameras/2d/effects/Shake.js"),Zoom:__webpack_require__("./cameras/2d/effects/Zoom.js")};}),"./cameras/2d/index.js":(function(module,exports,__webpack_require__){module.exports={Camera:__webpack_require__("./cameras/2d/Camera.js"),CameraManager:__webpack_require__("./cameras/2d/CameraManager.js"),Effects:__webpack_require__("./cameras/2d/effects/index.js")};}),"./cameras/controls/FixedKeyControl.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var GetValue=__webpack_require__("./utils/object/GetValue.js");var FixedKeyControl=new Class({initialize:function FixedKeyControl(config)
        {this.camera=GetValue(config,'camera',null);this.left=GetValue(config,'left',null);this.right=GetValue(config,'right',null);this.up=GetValue(config,'up',null);this.down=GetValue(config,'down',null);this.zoomIn=GetValue(config,'zoomIn',null);this.zoomOut=GetValue(config,'zoomOut',null);this.zoomSpeed=GetValue(config,'zoomSpeed',0.01);this.speedX=0;this.speedY=0;var speed=GetValue(config,'speed',null);if(typeof speed==='number')
        {this.speedX=speed;this.speedY=speed;}
        else
        {this.speedX=GetValue(config,'speed.x',0);this.speedY=GetValue(config,'speed.y',0);}
            this._zoom=0;this.active=(this.camera!==null);},start:function()
        {this.active=(this.camera!==null);return this;},stop:function()
        {this.active=false;return this;},setCamera:function(camera)
        {this.camera=camera;return this;},update:function(delta)
        {if(!this.active)
        {return;}
            if(delta===undefined){delta=1;}
            var cam=this.camera;if(this.up&&this.up.isDown)
        {cam.scrollY-=((this.speedY*delta)|0);}
        else if(this.down&&this.down.isDown)
        {cam.scrollY+=((this.speedY*delta)|0);}
            if(this.left&&this.left.isDown)
            {cam.scrollX-=((this.speedX*delta)|0);}
            else if(this.right&&this.right.isDown)
            {cam.scrollX+=((this.speedX*delta)|0);}
            if(this.zoomIn&&this.zoomIn.isDown)
            {cam.zoom-=this.zoomSpeed;if(cam.zoom<0.1)
            {cam.zoom=0.1;}}
            else if(this.zoomOut&&this.zoomOut.isDown)
            {cam.zoom+=this.zoomSpeed;}},destroy:function()
        {this.camera=null;this.left=null;this.right=null;this.up=null;this.down=null;this.zoomIn=null;this.zoomOut=null;}});module.exports=FixedKeyControl;}),"./cameras/controls/SmoothedKeyControl.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var GetValue=__webpack_require__("./utils/object/GetValue.js");var SmoothedKeyControl=new Class({initialize:function SmoothedKeyControl(config)
        {this.camera=GetValue(config,'camera',null);this.left=GetValue(config,'left',null);this.right=GetValue(config,'right',null);this.up=GetValue(config,'up',null);this.down=GetValue(config,'down',null);this.zoomIn=GetValue(config,'zoomIn',null);this.zoomOut=GetValue(config,'zoomOut',null);this.zoomSpeed=GetValue(config,'zoomSpeed',0.01);this.accelX=0;this.accelY=0;var accel=GetValue(config,'acceleration',null);if(typeof accel==='number')
        {this.accelX=accel;this.accelY=accel;}
        else
        {this.accelX=GetValue(config,'acceleration.x',0);this.accelY=GetValue(config,'acceleration.y',0);}
            this.dragX=0;this.dragY=0;var drag=GetValue(config,'drag',null);if(typeof drag==='number')
        {this.dragX=drag;this.dragY=drag;}
        else
        {this.dragX=GetValue(config,'drag.x',0);this.dragY=GetValue(config,'drag.y',0);}
            this.maxSpeedX=0;this.maxSpeedY=0;var maxSpeed=GetValue(config,'maxSpeed',null);if(typeof maxSpeed==='number')
        {this.maxSpeedX=maxSpeed;this.maxSpeedY=maxSpeed;}
        else
        {this.maxSpeedX=GetValue(config,'maxSpeed.x',0);this.maxSpeedY=GetValue(config,'maxSpeed.y',0);}
            this._speedX=0;this._speedY=0;this._zoom=0;this.active=(this.camera!==null);},start:function()
        {this.active=(this.camera!==null);return this;},stop:function()
        {this.active=false;return this;},setCamera:function(camera)
        {this.camera=camera;return this;},update:function(delta)
        {if(!this.active)
        {return;}
            if(delta===undefined){delta=1;}
            var cam=this.camera;if(this._speedX>0)
        {this._speedX-=this.dragX*delta;if(this._speedX<0)
        {this._speedX=0;}}
        else if(this._speedX<0)
        {this._speedX+=this.dragX*delta;if(this._speedX>0)
        {this._speedX=0;}}
            if(this._speedY>0)
            {this._speedY-=this.dragY*delta;if(this._speedY<0)
            {this._speedY=0;}}
            else if(this._speedY<0)
            {this._speedY+=this.dragY*delta;if(this._speedY>0)
            {this._speedY=0;}}
            if(this.up&&this.up.isDown)
            {this._speedY+=this.accelY;if(this._speedY>this.maxSpeedY)
            {this._speedY=this.maxSpeedY;}}
            else if(this.down&&this.down.isDown)
            {this._speedY-=this.accelY;if(this._speedY<-this.maxSpeedY)
            {this._speedY=-this.maxSpeedY;}}
            if(this.left&&this.left.isDown)
            {this._speedX+=this.accelX;if(this._speedX>this.maxSpeedX)
            {this._speedX=this.maxSpeedX;}}
            else if(this.right&&this.right.isDown)
            {this._speedX-=this.accelX;if(this._speedX<-this.maxSpeedX)
            {this._speedX=-this.maxSpeedX;}}
            if(this.zoomIn&&this.zoomIn.isDown)
            {this._zoom=-this.zoomSpeed;}
            else if(this.zoomOut&&this.zoomOut.isDown)
            {this._zoom=this.zoomSpeed;}
            else
            {this._zoom=0;}
            if(this._speedX!==0)
            {cam.scrollX-=((this._speedX*delta)|0);}
            if(this._speedY!==0)
            {cam.scrollY-=((this._speedY*delta)|0);}
            if(this._zoom!==0)
            {cam.zoom+=this._zoom;if(cam.zoom<0.1)
            {cam.zoom=0.1;}}},destroy:function()
        {this.camera=null;this.left=null;this.right=null;this.up=null;this.down=null;this.zoomIn=null;this.zoomOut=null;}});module.exports=SmoothedKeyControl;}),"./cameras/controls/index.js":(function(module,exports,__webpack_require__){module.exports={FixedKeyControl:__webpack_require__("./cameras/controls/FixedKeyControl.js"),SmoothedKeyControl:__webpack_require__("./cameras/controls/SmoothedKeyControl.js")};}),"./cameras/index.js":(function(module,exports,__webpack_require__){module.exports={Controls:__webpack_require__("./cameras/controls/index.js"),Scene2D:__webpack_require__("./cameras/2d/index.js")};}),"./const.js":(function(module,exports,__webpack_require__){var CONST={VERSION:'3.16.0 Beta 4',BlendModes:__webpack_require__("./renderer/BlendModes.js"),ScaleModes:__webpack_require__("./renderer/ScaleModes.js"),AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,FOREVER:-1,NONE:4,UP:5,DOWN:6,LEFT:7,RIGHT:8};module.exports=CONST;}),"./create/GenerateTexture.js":(function(module,exports,__webpack_require__){var Arne16=__webpack_require__("./create/palettes/Arne16.js");var CanvasPool=__webpack_require__("./display/canvas/CanvasPool.js");var GetValue=__webpack_require__("./utils/object/GetValue.js");var GenerateTexture=function(config)
    {var data=GetValue(config,'data',[]);var canvas=GetValue(config,'canvas',null);var palette=GetValue(config,'palette',Arne16);var pixelWidth=GetValue(config,'pixelWidth',1);var pixelHeight=GetValue(config,'pixelHeight',pixelWidth);var resizeCanvas=GetValue(config,'resizeCanvas',true);var clearCanvas=GetValue(config,'clearCanvas',true);var preRender=GetValue(config,'preRender',null);var postRender=GetValue(config,'postRender',null);var width=Math.floor(Math.abs(data[0].length*pixelWidth));var height=Math.floor(Math.abs(data.length*pixelHeight));if(!canvas)
    {canvas=CanvasPool.create2D(this,width,height);resizeCanvas=false;clearCanvas=false;}
        if(resizeCanvas)
        {canvas.width=width;canvas.height=height;}
        var ctx=canvas.getContext('2d');if(clearCanvas)
    {ctx.clearRect(0,0,width,height);}
        if(preRender)
        {preRender(canvas,ctx);}
        for(var y=0;y<data.length;y++)
        {var row=data[y];for(var x=0;x<row.length;x++)
        {var d=row[x];if(d!=='.'&&d!==' ')
        {ctx.fillStyle=palette[d];ctx.fillRect(x*pixelWidth,y*pixelHeight,pixelWidth,pixelHeight);}}}
        if(postRender)
        {postRender(canvas,ctx);}
        return canvas;};module.exports=GenerateTexture;}),"./create/index.js":(function(module,exports,__webpack_require__){module.exports={GenerateTexture:__webpack_require__("./create/GenerateTexture.js"),Palettes:__webpack_require__("./create/palettes/index.js")};}),"./create/palettes/Arne16.js":(function(module,exports){module.exports={0:'#000',1:'#9D9D9D',2:'#FFF',3:'#BE2633',4:'#E06F8B',5:'#493C2B',6:'#A46422',7:'#EB8931',8:'#F7E26B',9:'#2F484E',A:'#44891A',B:'#A3CE27',C:'#1B2632',D:'#005784',E:'#31A2F2',F:'#B2DCEF'};}),"./create/palettes/C64.js":(function(module,exports){module.exports={0:'#000',1:'#fff',2:'#8b4131',3:'#7bbdc5',4:'#8b41ac',5:'#6aac41',6:'#3931a4',7:'#d5de73',8:'#945a20',9:'#5a4100',A:'#bd736a',B:'#525252',C:'#838383',D:'#acee8b',E:'#7b73de',F:'#acacac'};}),"./create/palettes/CGA.js":(function(module,exports){module.exports={0:'#000',1:'#2234d1',2:'#0c7e45',3:'#44aacc',4:'#8a3622',5:'#5c2e78',6:'#aa5c3d',7:'#b5b5b5',8:'#5e606e',9:'#4c81fb',A:'#6cd947',B:'#7be2f9',C:'#eb8a60',D:'#e23d69',E:'#ffd93f',F:'#fff'};}),"./create/palettes/JMP.js":(function(module,exports){module.exports={0:'#000',1:'#191028',2:'#46af45',3:'#a1d685',4:'#453e78',5:'#7664fe',6:'#833129',7:'#9ec2e8',8:'#dc534b',9:'#e18d79',A:'#d6b97b',B:'#e9d8a1',C:'#216c4b',D:'#d365c8',E:'#afaab9',F:'#f5f4eb'};}),"./create/palettes/MSX.js":(function(module,exports){module.exports={0:'#000',1:'#191028',2:'#46af45',3:'#a1d685',4:'#453e78',5:'#7664fe',6:'#833129',7:'#9ec2e8',8:'#dc534b',9:'#e18d79',A:'#d6b97b',B:'#e9d8a1',C:'#216c4b',D:'#d365c8',E:'#afaab9',F:'#fff'};}),"./create/palettes/index.js":(function(module,exports,__webpack_require__){module.exports={ARNE16:__webpack_require__("./create/palettes/Arne16.js"),C64:__webpack_require__("./create/palettes/C64.js"),CGA:__webpack_require__("./create/palettes/CGA.js"),JMP:__webpack_require__("./create/palettes/JMP.js"),MSX:__webpack_require__("./create/palettes/MSX.js")};}),"./curves/CubicBezierCurve.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var CubicBezier=__webpack_require__("./math/interpolation/CubicBezierInterpolation.js");var Curve=__webpack_require__("./curves/Curve.js");var Vector2=__webpack_require__("./math/Vector2.js");var CubicBezierCurve=new Class({Extends:Curve,initialize:function CubicBezierCurve(p0,p1,p2,p3)
        {Curve.call(this,'CubicBezierCurve');if(Array.isArray(p0))
        {p3=new Vector2(p0[6],p0[7]);p2=new Vector2(p0[4],p0[5]);p1=new Vector2(p0[2],p0[3]);p0=new Vector2(p0[0],p0[1]);}
            this.p0=p0;this.p1=p1;this.p2=p2;this.p3=p3;},getStartPoint:function(out)
        {if(out===undefined){out=new Vector2();}
            return out.copy(this.p0);},getResolution:function(divisions)
        {return divisions;},getPoint:function(t,out)
        {if(out===undefined){out=new Vector2();}
            var p0=this.p0;var p1=this.p1;var p2=this.p2;var p3=this.p3;return out.set(CubicBezier(t,p0.x,p1.x,p2.x,p3.x),CubicBezier(t,p0.y,p1.y,p2.y,p3.y));},draw:function(graphics,pointsTotal)
        {if(pointsTotal===undefined){pointsTotal=32;}
            var points=this.getPoints(pointsTotal);graphics.beginPath();graphics.moveTo(this.p0.x,this.p0.y);for(var i=1;i<points.length;i++)
        {graphics.lineTo(points[i].x,points[i].y);}
            graphics.strokePath();return graphics;},toJSON:function()
        {return{type:this.type,points:[this.p0.x,this.p0.y,this.p1.x,this.p1.y,this.p2.x,this.p2.y,this.p3.x,this.p3.y]};}});CubicBezierCurve.fromJSON=function(data)
    {var points=data.points;var p0=new Vector2(points[0],points[1]);var p1=new Vector2(points[2],points[3]);var p2=new Vector2(points[4],points[5]);var p3=new Vector2(points[6],points[7]);return new CubicBezierCurve(p0,p1,p2,p3);};module.exports=CubicBezierCurve;}),"./curves/Curve.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var FromPoints=__webpack_require__("./geom/rectangle/FromPoints.js");var Rectangle=__webpack_require__("./geom/rectangle/Rectangle.js");var Vector2=__webpack_require__("./math/Vector2.js");var Curve=new Class({initialize:function Curve(type)
        {this.type=type;this.defaultDivisions=5;this.arcLengthDivisions=100;this.cacheArcLengths=[];this.needsUpdate=true;this.active=true;this._tmpVec2A=new Vector2();this._tmpVec2B=new Vector2();},draw:function(graphics,pointsTotal)
        {if(pointsTotal===undefined){pointsTotal=32;}
            return graphics.strokePoints(this.getPoints(pointsTotal));},getBounds:function(out,accuracy)
        {if(!out){out=new Rectangle();}
            if(accuracy===undefined){accuracy=16;}
            var len=this.getLength();if(accuracy>len)
        {accuracy=len / 2;}
            var spaced=Math.max(1,Math.round(len / accuracy));return FromPoints(this.getSpacedPoints(spaced),out);},getDistancePoints:function(distance)
        {var len=this.getLength();var spaced=Math.max(1,len / distance);return this.getSpacedPoints(spaced);},getEndPoint:function(out)
        {if(out===undefined){out=new Vector2();}
            return this.getPointAt(1,out);},getLength:function()
        {var lengths=this.getLengths();return lengths[lengths.length-1];},getLengths:function(divisions)
        {if(divisions===undefined){divisions=this.arcLengthDivisions;}
            if((this.cacheArcLengths.length===divisions+1)&&!this.needsUpdate)
            {return this.cacheArcLengths;}
            this.needsUpdate=false;var cache=[];var current;var last=this.getPoint(0,this._tmpVec2A);var sum=0;cache.push(0);for(var p=1;p<=divisions;p++)
        {current=this.getPoint(p / divisions,this._tmpVec2B);sum+=current.distance(last);cache.push(sum);last.copy(current);}
            this.cacheArcLengths=cache;return cache;},getPointAt:function(u,out)
        {var t=this.getUtoTmapping(u);return this.getPoint(t,out);},getPoints:function(divisions)
        {if(divisions===undefined){divisions=this.defaultDivisions;}
            var points=[];for(var d=0;d<=divisions;d++)
        {points.push(this.getPoint(d / divisions));}
            return points;},getRandomPoint:function(out)
        {if(out===undefined){out=new Vector2();}
            return this.getPoint(Math.random(),out);},getSpacedPoints:function(divisions)
        {if(divisions===undefined){divisions=this.defaultDivisions;}
            var points=[];for(var d=0;d<=divisions;d++)
        {var t=this.getUtoTmapping(d / divisions,null,divisions);points.push(this.getPoint(t));}
            return points;},getStartPoint:function(out)
        {if(out===undefined){out=new Vector2();}
            return this.getPointAt(0,out);},getTangent:function(t,out)
        {if(out===undefined){out=new Vector2();}
            var delta=0.0001;var t1=t-delta;var t2=t+delta;if(t1<0)
        {t1=0;}
            if(t2>1)
            {t2=1;}
            this.getPoint(t1,this._tmpVec2A);this.getPoint(t2,out);return out.subtract(this._tmpVec2A).normalize();},getTangentAt:function(u,out)
        {var t=this.getUtoTmapping(u);return this.getTangent(t,out);},getTFromDistance:function(distance,divisions)
        {if(distance<=0)
        {return 0;}
            return this.getUtoTmapping(0,distance,divisions);},getUtoTmapping:function(u,distance,divisions)
        {var arcLengths=this.getLengths(divisions);var i=0;var il=arcLengths.length;var targetArcLength;if(distance)
        {targetArcLength=Math.min(distance,arcLengths[il-1]);}
        else
        {targetArcLength=u*arcLengths[il-1];}
            var low=0;var high=il-1;var comparison;while(low<=high)
        {i=Math.floor(low+(high-low)/ 2);comparison=arcLengths[i]-targetArcLength;if(comparison<0)
        {low=i+1;}
        else if(comparison>0)
        {high=i-1;}
        else
        {high=i;break;}}
            i=high;if(arcLengths[i]===targetArcLength)
        {return i /(il-1);}
            var lengthBefore=arcLengths[i];var lengthAfter=arcLengths[i+1];var segmentLength=lengthAfter-lengthBefore;var segmentFraction=(targetArcLength-lengthBefore)/ segmentLength;return(i+segmentFraction)/(il-1);},updateArcLengths:function()
        {this.needsUpdate=true;this.getLengths();}});module.exports=Curve;}),"./curves/EllipseCurve.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Curve=__webpack_require__("./curves/Curve.js");var DegToRad=__webpack_require__("./math/DegToRad.js");var GetValue=__webpack_require__("./utils/object/GetValue.js");var RadToDeg=__webpack_require__("./math/RadToDeg.js");var Vector2=__webpack_require__("./math/Vector2.js");var EllipseCurve=new Class({Extends:Curve,initialize:function EllipseCurve(x,y,xRadius,yRadius,startAngle,endAngle,clockwise,rotation)
        {if(typeof x==='object')
        {var config=x;x=GetValue(config,'x',0);y=GetValue(config,'y',0);xRadius=GetValue(config,'xRadius',0);yRadius=GetValue(config,'yRadius',xRadius);startAngle=GetValue(config,'startAngle',0);endAngle=GetValue(config,'endAngle',360);clockwise=GetValue(config,'clockwise',false);rotation=GetValue(config,'rotation',0);}
        else
        {if(yRadius===undefined){yRadius=xRadius;}
            if(startAngle===undefined){startAngle=0;}
            if(endAngle===undefined){endAngle=360;}
            if(clockwise===undefined){clockwise=false;}
            if(rotation===undefined){rotation=0;}}
            Curve.call(this,'EllipseCurve');this.p0=new Vector2(x,y);this._xRadius=xRadius;this._yRadius=yRadius;this._startAngle=DegToRad(startAngle);this._endAngle=DegToRad(endAngle);this._clockwise=clockwise;this._rotation=DegToRad(rotation);},getStartPoint:function(out)
        {if(out===undefined){out=new Vector2();}
            return this.getPoint(0,out);},getResolution:function(divisions)
        {return divisions*2;},getPoint:function(t,out)
        {if(out===undefined){out=new Vector2();}
            var twoPi=Math.PI*2;var deltaAngle=this._endAngle-this._startAngle;var samePoints=Math.abs(deltaAngle)<Number.EPSILON;while(deltaAngle<0)
        {deltaAngle+=twoPi;}
            while(deltaAngle>twoPi)
            {deltaAngle-=twoPi;}
            if(deltaAngle<Number.EPSILON)
            {if(samePoints)
            {deltaAngle=0;}
            else
            {deltaAngle=twoPi;}}
            if(this._clockwise&&!samePoints)
            {if(deltaAngle===twoPi)
            {deltaAngle=-twoPi;}
            else
            {deltaAngle=deltaAngle-twoPi;}}
            var angle=this._startAngle+t*deltaAngle;var x=this.p0.x+this._xRadius*Math.cos(angle);var y=this.p0.y+this._yRadius*Math.sin(angle);if(this._rotation!==0)
        {var cos=Math.cos(this._rotation);var sin=Math.sin(this._rotation);var tx=x-this.p0.x;var ty=y-this.p0.y;x=tx*cos-ty*sin+this.p0.x;y=tx*sin+ty*cos+this.p0.y;}
            return out.set(x,y);},setXRadius:function(value)
        {this.xRadius=value;return this;},setYRadius:function(value)
        {this.yRadius=value;return this;},setWidth:function(value)
        {this.xRadius=value*2;return this;},setHeight:function(value)
        {this.yRadius=value*2;return this;},setStartAngle:function(value)
        {this.startAngle=value;return this;},setEndAngle:function(value)
        {this.endAngle=value;return this;},setClockwise:function(value)
        {this.clockwise=value;return this;},setRotation:function(value)
        {this.rotation=value;return this;},x:{get:function()
            {return this.p0.x;},set:function(value)
            {this.p0.x=value;}},y:{get:function()
            {return this.p0.y;},set:function(value)
            {this.p0.y=value;}},xRadius:{get:function()
            {return this._xRadius;},set:function(value)
            {this._xRadius=value;}},yRadius:{get:function()
            {return this._yRadius;},set:function(value)
            {this._yRadius=value;}},startAngle:{get:function()
            {return RadToDeg(this._startAngle);},set:function(value)
            {this._startAngle=DegToRad(value);}},endAngle:{get:function()
            {return RadToDeg(this._endAngle);},set:function(value)
            {this._endAngle=DegToRad(value);}},clockwise:{get:function()
            {return this._clockwise;},set:function(value)
            {this._clockwise=value;}},angle:{get:function()
            {return RadToDeg(this._rotation);},set:function(value)
            {this._rotation=DegToRad(value);}},rotation:{get:function()
            {return this._rotation;},set:function(value)
            {this._rotation=value;}},toJSON:function()
        {return{type:this.type,x:this.p0.x,y:this.p0.y,xRadius:this._xRadius,yRadius:this._yRadius,startAngle:RadToDeg(this._startAngle),endAngle:RadToDeg(this._endAngle),clockwise:this._clockwise,rotation:RadToDeg(this._rotation)};}});EllipseCurve.fromJSON=function(data)
    {return new EllipseCurve(data);};module.exports=EllipseCurve;}),"./curves/LineCurve.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Curve=__webpack_require__("./curves/Curve.js");var FromPoints=__webpack_require__("./geom/rectangle/FromPoints.js");var Rectangle=__webpack_require__("./geom/rectangle/Rectangle.js");var Vector2=__webpack_require__("./math/Vector2.js");var tmpVec2=new Vector2();var LineCurve=new Class({Extends:Curve,initialize:function LineCurve(p0,p1)
        {Curve.call(this,'LineCurve');if(Array.isArray(p0))
        {p1=new Vector2(p0[2],p0[3]);p0=new Vector2(p0[0],p0[1]);}
            this.p0=p0;this.p1=p1;},getBounds:function(out)
        {if(out===undefined){out=new Rectangle();}
            return FromPoints([this.p0,this.p1],out);},getStartPoint:function(out)
        {if(out===undefined){out=new Vector2();}
            return out.copy(this.p0);},getResolution:function(divisions)
        {if(divisions===undefined){divisions=1;}
            return divisions;},getPoint:function(t,out)
        {if(out===undefined){out=new Vector2();}
            if(t===1)
            {return out.copy(this.p1);}
            out.copy(this.p1).subtract(this.p0).scale(t).add(this.p0);return out;},getPointAt:function(u,out)
        {return this.getPoint(u,out);},getTangent:function()
        {var tangent=tmpVec2.copy(this.p1).subtract(this.p0);return tangent.normalize();},draw:function(graphics)
        {graphics.lineBetween(this.p0.x,this.p0.y,this.p1.x,this.p1.y);return graphics;},toJSON:function()
        {return{type:this.type,points:[this.p0.x,this.p0.y,this.p1.x,this.p1.y]};}});LineCurve.fromJSON=function(data)
    {var points=data.points;var p0=new Vector2(points[0],points[1]);var p1=new Vector2(points[2],points[3]);return new LineCurve(p0,p1);};module.exports=LineCurve;}),"./curves/QuadraticBezierCurve.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Curve=__webpack_require__("./curves/Curve.js");var QuadraticBezierInterpolation=__webpack_require__("./math/interpolation/QuadraticBezierInterpolation.js");var Vector2=__webpack_require__("./math/Vector2.js");var QuadraticBezier=new Class({Extends:Curve,initialize:function QuadraticBezier(p0,p1,p2)
        {Curve.call(this,'QuadraticBezier');if(Array.isArray(p0))
        {p2=new Vector2(p0[4],p0[5]);p1=new Vector2(p0[2],p0[3]);p0=new Vector2(p0[0],p0[1]);}
            this.p0=p0;this.p1=p1;this.p2=p2;},getStartPoint:function(out)
        {if(out===undefined){out=new Vector2();}
            return out.copy(this.p0);},getResolution:function(divisions)
        {return divisions;},getPoint:function(t,out)
        {if(out===undefined){out=new Vector2();}
            var p0=this.p0;var p1=this.p1;var p2=this.p2;return out.set(QuadraticBezierInterpolation(t,p0.x,p1.x,p2.x),QuadraticBezierInterpolation(t,p0.y,p1.y,p2.y));},draw:function(graphics,pointsTotal)
        {if(pointsTotal===undefined){pointsTotal=32;}
            var points=this.getPoints(pointsTotal);graphics.beginPath();graphics.moveTo(this.p0.x,this.p0.y);for(var i=1;i<points.length;i++)
        {graphics.lineTo(points[i].x,points[i].y);}
            graphics.strokePath();return graphics;},toJSON:function()
        {return{type:this.type,points:[this.p0.x,this.p0.y,this.p1.x,this.p1.y,this.p2.x,this.p2.y]};}});QuadraticBezier.fromJSON=function(data)
    {var points=data.points;var p0=new Vector2(points[0],points[1]);var p1=new Vector2(points[2],points[3]);var p2=new Vector2(points[4],points[5]);return new QuadraticBezier(p0,p1,p2);};module.exports=QuadraticBezier;}),"./curves/SplineCurve.js":(function(module,exports,__webpack_require__){var CatmullRom=__webpack_require__("./math/CatmullRom.js");var Class=__webpack_require__("./utils/Class.js");var Curve=__webpack_require__("./curves/Curve.js");var Vector2=__webpack_require__("./math/Vector2.js");var SplineCurve=new Class({Extends:Curve,initialize:function SplineCurve(points)
        {if(points===undefined){points=[];}
            Curve.call(this,'SplineCurve');this.points=[];this.addPoints(points);},addPoints:function(points)
        {for(var i=0;i<points.length;i++)
        {var p=new Vector2();if(typeof points[i]==='number')
        {p.x=points[i];p.y=points[i+1];i++;}
        else if(Array.isArray(points[i]))
        {p.x=points[i][0];p.y=points[i][1];}
        else
        {p.x=points[i].x;p.y=points[i].y;}
            this.points.push(p);}
            return this;},addPoint:function(x,y)
        {var vec=new Vector2(x,y);this.points.push(vec);return vec;},getStartPoint:function(out)
        {if(out===undefined){out=new Vector2();}
            return out.copy(this.points[0]);},getResolution:function(divisions)
        {return divisions*this.points.length;},getPoint:function(t,out)
        {if(out===undefined){out=new Vector2();}
            var points=this.points;var point=(points.length-1)*t;var intPoint=Math.floor(point);var weight=point-intPoint;var p0=points[(intPoint===0)?intPoint:intPoint-1];var p1=points[intPoint];var p2=points[(intPoint>points.length-2)?points.length-1:intPoint+1];var p3=points[(intPoint>points.length-3)?points.length-1:intPoint+2];return out.set(CatmullRom(weight,p0.x,p1.x,p2.x,p3.x),CatmullRom(weight,p0.y,p1.y,p2.y,p3.y));},toJSON:function()
        {var points=[];for(var i=0;i<this.points.length;i++)
        {points.push(this.points[i].x);points.push(this.points[i].y);}
            return{type:this.type,points:points};}});SplineCurve.fromJSON=function(data)
    {return new SplineCurve(data.points);};module.exports=SplineCurve;}),"./curves/index.js":(function(module,exports,__webpack_require__){module.exports={Path:__webpack_require__("./curves/path/Path.js"),CubicBezier:__webpack_require__("./curves/CubicBezierCurve.js"),Curve:__webpack_require__("./curves/Curve.js"),Ellipse:__webpack_require__("./curves/EllipseCurve.js"),Line:__webpack_require__("./curves/LineCurve.js"),QuadraticBezier:__webpack_require__("./curves/QuadraticBezierCurve.js"),Spline:__webpack_require__("./curves/SplineCurve.js")};}),"./curves/path/MoveTo.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Vector2=__webpack_require__("./math/Vector2.js");var MoveTo=new Class({initialize:function MoveTo(x,y)
        {this.active=false;this.p0=new Vector2(x,y);},getPoint:function(t,out)
        {if(out===undefined){out=new Vector2();}
            return out.copy(this.p0);},getPointAt:function(u,out)
        {return this.getPoint(u,out);},getResolution:function()
        {return 1;},getLength:function()
        {return 0;},toJSON:function()
        {return{type:'MoveTo',points:[this.p0.x,this.p0.y]};}});module.exports=MoveTo;}),"./curves/path/Path.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var CubicBezierCurve=__webpack_require__("./curves/CubicBezierCurve.js");var EllipseCurve=__webpack_require__("./curves/EllipseCurve.js");var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");var LineCurve=__webpack_require__("./curves/LineCurve.js");var MovePathTo=__webpack_require__("./curves/path/MoveTo.js");var QuadraticBezierCurve=__webpack_require__("./curves/QuadraticBezierCurve.js");var Rectangle=__webpack_require__("./geom/rectangle/Rectangle.js");var SplineCurve=__webpack_require__("./curves/SplineCurve.js");var Vector2=__webpack_require__("./math/Vector2.js");var Path=new Class({initialize:function Path(x,y)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            this.name='';this.curves=[];this.cacheLengths=[];this.autoClose=false;this.startPoint=new Vector2();this._tmpVec2A=new Vector2();this._tmpVec2B=new Vector2();if(typeof x==='object')
        {this.fromJSON(x);}
        else
        {this.startPoint.set(x,y);}},add:function(curve)
        {this.curves.push(curve);return this;},circleTo:function(radius,clockwise,rotation)
        {if(clockwise===undefined){clockwise=false;}
            return this.ellipseTo(radius,radius,0,360,clockwise,rotation);},closePath:function()
        {var startPoint=this.curves[0].getPoint(0);var endPoint=this.curves[this.curves.length-1].getPoint(1);if(!startPoint.equals(endPoint))
        {this.curves.push(new LineCurve(endPoint,startPoint));}
            return this;},cubicBezierTo:function(x,y,control1X,control1Y,control2X,control2Y)
        {var p0=this.getEndPoint();var p1;var p2;var p3;if(x instanceof Vector2)
        {p1=x;p2=y;p3=control1X;}
        else
        {p1=new Vector2(control1X,control1Y);p2=new Vector2(control2X,control2Y);p3=new Vector2(x,y);}
            return this.add(new CubicBezierCurve(p0,p1,p2,p3));},quadraticBezierTo:function(x,y,controlX,controlY)
        {var p0=this.getEndPoint();var p1;var p2;if(x instanceof Vector2)
        {p1=x;p2=y;}
        else
        {p1=new Vector2(controlX,controlY);p2=new Vector2(x,y);}
            return this.add(new QuadraticBezierCurve(p0,p1,p2));},draw:function(graphics,pointsTotal)
        {for(var i=0;i<this.curves.length;i++)
        {var curve=this.curves[i];if(!curve.active)
        {continue;}
            curve.draw(graphics,pointsTotal);}
            return graphics;},ellipseTo:function(xRadius,yRadius,startAngle,endAngle,clockwise,rotation)
        {var ellipse=new EllipseCurve(0,0,xRadius,yRadius,startAngle,endAngle,clockwise,rotation);var end=this.getEndPoint(this._tmpVec2A);var start=ellipse.getStartPoint(this._tmpVec2B);end.subtract(start);ellipse.x=end.x;ellipse.y=end.y;return this.add(ellipse);},fromJSON:function(data)
        {this.curves=[];this.cacheLengths=[];this.startPoint.set(data.x,data.y);this.autoClose=data.autoClose;for(var i=0;i<data.curves.length;i++)
        {var curve=data.curves[i];switch(curve.type)
        {case'LineCurve':this.add(LineCurve.fromJSON(curve));break;case'EllipseCurve':this.add(EllipseCurve.fromJSON(curve));break;case'SplineCurve':this.add(SplineCurve.fromJSON(curve));break;case'CubicBezierCurve':this.add(CubicBezierCurve.fromJSON(curve));break;case'QuadraticBezierCurve':this.add(QuadraticBezierCurve.fromJSON(curve));break;}}
            return this;},getBounds:function(out,accuracy)
        {if(out===undefined){out=new Rectangle();}
            if(accuracy===undefined){accuracy=16;}
            out.x=Number.MAX_VALUE;out.y=Number.MAX_VALUE;var bounds=new Rectangle();var maxRight=Number.MIN_SAFE_INTEGER;var maxBottom=Number.MIN_SAFE_INTEGER;for(var i=0;i<this.curves.length;i++)
        {var curve=this.curves[i];if(!curve.active)
        {continue;}
            curve.getBounds(bounds,accuracy);out.x=Math.min(out.x,bounds.x);out.y=Math.min(out.y,bounds.y);maxRight=Math.max(maxRight,bounds.right);maxBottom=Math.max(maxBottom,bounds.bottom);}
            out.right=maxRight;out.bottom=maxBottom;return out;},getCurveLengths:function()
        {if(this.cacheLengths.length===this.curves.length)
        {return this.cacheLengths;}
            var lengths=[];var sums=0;for(var i=0;i<this.curves.length;i++)
        {sums+=this.curves[i].getLength();lengths.push(sums);}
            this.cacheLengths=lengths;return lengths;},getEndPoint:function(out)
        {if(out===undefined){out=new Vector2();}
            if(this.curves.length>0)
            {this.curves[this.curves.length-1].getPoint(1,out);}
            else
            {out.copy(this.startPoint);}
            return out;},getLength:function()
        {var lens=this.getCurveLengths();return lens[lens.length-1];},getPoint:function(t,out)
        {if(out===undefined){out=new Vector2();}
            var d=t*this.getLength();var curveLengths=this.getCurveLengths();var i=0;while(i<curveLengths.length)
        {if(curveLengths[i]>=d)
        {var diff=curveLengths[i]-d;var curve=this.curves[i];var segmentLength=curve.getLength();var u=(segmentLength===0)?0:1-diff / segmentLength;return curve.getPointAt(u,out);}
            i++;}
            return null;},getPoints:function(divisions)
        {if(divisions===undefined){divisions=12;}
            var points=[];var last;for(var i=0;i<this.curves.length;i++)
        {var curve=this.curves[i];if(!curve.active)
        {continue;}
            var resolution=curve.getResolution(divisions);var pts=curve.getPoints(resolution);for(var j=0;j<pts.length;j++)
        {var point=pts[j];if(last&&last.equals(point))
        {continue;}
            points.push(point);last=point;}}
            if(this.autoClose&&points.length>1&&!points[points.length-1].equals(points[0]))
            {points.push(points[0]);}
            return points;},getRandomPoint:function(out)
        {if(out===undefined){out=new Vector2();}
            return this.getPoint(Math.random(),out);},getSpacedPoints:function(divisions)
        {if(divisions===undefined){divisions=40;}
            var points=[];for(var i=0;i<=divisions;i++)
        {points.push(this.getPoint(i / divisions));}
            if(this.autoClose)
            {points.push(points[0]);}
            return points;},getStartPoint:function(out)
        {if(out===undefined){out=new Vector2();}
            return out.copy(this.startPoint);},lineTo:function(x,y)
        {if(x instanceof Vector2)
        {this._tmpVec2B.copy(x);}
        else
        {this._tmpVec2B.set(x,y);}
            var end=this.getEndPoint(this._tmpVec2A);return this.add(new LineCurve([end.x,end.y,this._tmpVec2B.x,this._tmpVec2B.y]));},splineTo:function(points)
        {points.unshift(this.getEndPoint());return this.add(new SplineCurve(points));},moveTo:function(x,y)
        {return this.add(new MovePathTo(x,y));},toJSON:function()
        {var out=[];for(var i=0;i<this.curves.length;i++)
        {out.push(this.curves[i].toJSON());}
            return{type:'Path',x:this.startPoint.x,y:this.startPoint.y,autoClose:this.autoClose,curves:out};},updateArcLengths:function()
        {this.cacheLengths=[];this.getCurveLengths();},destroy:function()
        {this.curves.length=0;this.cacheLengths.length=0;this.startPoint=undefined;}});GameObjectFactory.register('path',function(x,y)
    {return new Path(x,y);});module.exports=Path;}),"./data/DataManager.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var DataManager=new Class({initialize:function DataManager(parent,eventEmitter)
        {this.parent=parent;this.events=eventEmitter;if(!eventEmitter)
        {this.events=(parent.events)?parent.events:parent;}
            this.list={};this.values={};this._frozen=false;if(!parent.hasOwnProperty('sys')&&this.events)
        {this.events.once('destroy',this.destroy,this);}},get:function(key)
        {var list=this.list;if(Array.isArray(key))
        {var output=[];for(var i=0;i<key.length;i++)
        {output.push(list[key[i]]);}
            return output;}
        else
        {return list[key];}},getAll:function()
        {var results={};for(var key in this.list)
        {if(this.list.hasOwnProperty(key))
        {results[key]=this.list[key];}}
            return results;},query:function(search)
        {var results={};for(var key in this.list)
        {if(this.list.hasOwnProperty(key)&&key.match(search))
        {results[key]=this.list[key];}}
            return results;},set:function(key,data)
        {if(this._frozen)
        {return this;}
            if(typeof key==='string')
            {return this.setValue(key,data);}
            else
            {for(var entry in key)
            {this.setValue(entry,key[entry]);}}
            return this;},setValue:function(key,data)
        {if(this._frozen)
        {return this;}
            if(this.has(key))
            {this.values[key]=data;}
            else
            {var _this=this;var list=this.list;var events=this.events;var parent=this.parent;Object.defineProperty(this.values,key,{enumerable:true,configurable:true,get:function()
                {return list[key];},set:function(value)
                {if(!_this._frozen)
                {var previousValue=list[key];list[key]=value;events.emit('changedata',parent,key,value,previousValue);events.emit('changedata_'+key,parent,value,previousValue);}}});list[key]=data;events.emit('setdata',parent,key,data);}
            return this;},each:function(callback,context)
        {var args=[this.parent,null,undefined];for(var i=1;i<arguments.length;i++)
        {args.push(arguments[i]);}
            for(var key in this.list)
            {args[1]=key;args[2]=this.list[key];callback.apply(context,args);}
            return this;},merge:function(data,overwrite)
        {if(overwrite===undefined){overwrite=true;}
            for(var key in data)
            {if(data.hasOwnProperty(key)&&(overwrite||(!overwrite&&!this.has(key))))
            {this.setValue(key,data[key]);}}
            return this;},remove:function(key)
        {if(this._frozen)
        {return this;}
            if(Array.isArray(key))
            {for(var i=0;i<key.length;i++)
            {this.removeValue(key[i]);}}
            else
            {return this.removeValue(key);}
            return this;},removeValue:function(key)
        {if(this.has(key))
        {var data=this.list[key];delete this.list[key];delete this.values[key];this.events.emit('removedata',this.parent,key,data);}
            return this;},pop:function(key)
        {var data=undefined;if(!this._frozen&&this.has(key))
        {data=this.list[key];delete this.list[key];delete this.values[key];this.events.emit('removedata',this,key,data);}
            return data;},has:function(key)
        {return this.list.hasOwnProperty(key);},setFreeze:function(value)
        {this._frozen=value;return this;},reset:function()
        {for(var key in this.list)
        {delete this.list[key];delete this.values[key];}
            this._frozen=false;return this;},destroy:function()
        {this.reset();this.events.off('changedata');this.events.off('setdata');this.events.off('removedata');this.parent=null;},freeze:{get:function()
            {return this._frozen;},set:function(value)
            {this._frozen=(value)?true:false;}},count:{get:function()
            {var i=0;for(var key in this.list)
            {if(this.list[key]!==undefined)
            {i++;}}
                return i;}}});module.exports=DataManager;}),"./data/DataManagerPlugin.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var DataManager=__webpack_require__("./data/DataManager.js");var PluginCache=__webpack_require__("./plugins/PluginCache.js");var DataManagerPlugin=new Class({Extends:DataManager,initialize:function DataManagerPlugin(scene)
        {DataManager.call(this,scene,scene.sys.events);this.scene=scene;this.systems=scene.sys;scene.sys.events.once('boot',this.boot,this);scene.sys.events.on('start',this.start,this);},boot:function()
        {this.events=this.systems.events;this.events.once('destroy',this.destroy,this);},start:function()
        {this.events.once('shutdown',this.shutdown,this);},shutdown:function()
        {this.systems.events.off('shutdown',this.shutdown,this);},destroy:function()
        {DataManager.prototype.destroy.call(this);this.events.off('start',this.start,this);this.scene=null;this.systems=null;}});PluginCache.register('DataManagerPlugin',DataManagerPlugin,'data');module.exports=DataManagerPlugin;}),"./data/index.js":(function(module,exports,__webpack_require__){module.exports={DataManager:__webpack_require__("./data/DataManager.js"),DataManagerPlugin:__webpack_require__("./data/DataManagerPlugin.js")};}),"./device/Audio.js":(function(module,exports,__webpack_require__){var Browser=__webpack_require__("./device/Browser.js");var Audio={audioData:false,dolby:false,m4a:false,mp3:false,ogg:false,opus:false,wav:false,webAudio:false,webm:false};function init()
    {Audio.audioData=!!(window['Audio']);Audio.webAudio=!!(window['AudioContext']||window['webkitAudioContext']);var audioElement=document.createElement('audio');var result=!!audioElement.canPlayType;try
    {if(result)
    {if(audioElement.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,''))
    {Audio.ogg=true;}
        if(audioElement.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,'')||audioElement.canPlayType('audio/opus;').replace(/^no$/,''))
        {Audio.opus=true;}
        if(audioElement.canPlayType('audio/mpeg;').replace(/^no$/,''))
        {Audio.mp3=true;}
        if(audioElement.canPlayType('audio/wav; codecs="1"').replace(/^no$/,''))
        {Audio.wav=true;}
        if(audioElement.canPlayType('audio/x-m4a;')||audioElement.canPlayType('audio/aac;').replace(/^no$/,''))
        {Audio.m4a=true;}
        if(audioElement.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,''))
        {Audio.webm=true;}
        if(audioElement.canPlayType('audio/mp4;codecs="ec-3"')!=='')
        {if(Browser.edge)
        {Audio.dolby=true;}
        else if(Browser.safari&&Browser.safariVersion>=9)
        {if((/Mac OS X (\d+)_(\d+)/).test(navigator.userAgent))
        {var major=parseInt(RegExp.$1,10);var minor=parseInt(RegExp.$2,10);if((major===10&&minor>=11)||major>10)
        {Audio.dolby=true;}}}}}}
    catch(e)
    {}
        return Audio;}
        module.exports=init();}),"./device/Browser.js":(function(module,exports,__webpack_require__){var OS=__webpack_require__("./device/OS.js");var Browser={chrome:false,chromeVersion:0,edge:false,firefox:false,firefoxVersion:0,ie:false,ieVersion:0,mobileSafari:false,opera:false,safari:false,safariVersion:0,silk:false,trident:false,tridentVersion:0};function init()
    {var ua=navigator.userAgent;if(/Edge\/\d+/.test(ua))
    {Browser.edge=true;}
    else if((/Chrome\/(\d+)/).test(ua)&&!OS.windowsPhone)
    {Browser.chrome=true;Browser.chromeVersion=parseInt(RegExp.$1,10);}
    else if((/Firefox\D+(\d+)/).test(ua))
    {Browser.firefox=true;Browser.firefoxVersion=parseInt(RegExp.$1,10);}
    else if((/AppleWebKit/).test(ua)&&OS.iOS)
    {Browser.mobileSafari=true;}
    else if((/MSIE (\d+\.\d+);/).test(ua))
    {Browser.ie=true;Browser.ieVersion=parseInt(RegExp.$1,10);}
    else if((/Opera/).test(ua))
    {Browser.opera=true;}
    else if((/Safari/).test(ua)&&!OS.windowsPhone)
    {Browser.safari=true;}
    else if((/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/).test(ua))
    {Browser.ie=true;Browser.trident=true;Browser.tridentVersion=parseInt(RegExp.$1,10);Browser.ieVersion=parseInt(RegExp.$3,10);}
        if((/Silk/).test(ua))
        {Browser.silk=true;}
        return Browser;}
        module.exports=init();}),"./device/CanvasFeatures.js":(function(module,exports,__webpack_require__){var CanvasPool=__webpack_require__("./display/canvas/CanvasPool.js");var CanvasFeatures={supportInverseAlpha:false,supportNewBlendModes:false};function checkBlendMode()
    {var pngHead='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX/';var pngEnd='AAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==';var magenta=new Image();magenta.onload=function()
    {var yellow=new Image();yellow.onload=function()
    {var canvas=CanvasPool.create(yellow,6,1);var context=canvas.getContext('2d');context.globalCompositeOperation='multiply';context.drawImage(magenta,0,0);context.drawImage(yellow,2,0);if(!context.getImageData(2,0,1,1))
    {return false;}
        var data=context.getImageData(2,0,1,1).data;CanvasPool.remove(yellow);CanvasFeatures.supportNewBlendModes=(data[0]===255&&data[1]===0&&data[2]===0);};yellow.src=pngHead+'/wCKxvRF'+pngEnd;};magenta.src=pngHead+'AP804Oa6'+pngEnd;return false;}
        function checkInverseAlpha()
        {var canvas=CanvasPool.create(this,2,1);var context=canvas.getContext('2d');context.fillStyle='rgba(10, 20, 30, 0.5)';context.fillRect(0,0,1,1);var s1=context.getImageData(0,0,1,1);if(s1===null)
        {return false;}
            context.putImageData(s1,1,0);var s2=context.getImageData(1,0,1,1);return(s2.data[0]===s1.data[0]&&s2.data[1]===s1.data[1]&&s2.data[2]===s1.data[2]&&s2.data[3]===s1.data[3]);}
        function init()
        {if(document!==undefined)
        {CanvasFeatures.supportNewBlendModes=checkBlendMode();CanvasFeatures.supportInverseAlpha=checkInverseAlpha();}
            return CanvasFeatures;}
        module.exports=init();}),"./device/Features.js":(function(module,exports,__webpack_require__){var OS=__webpack_require__("./device/OS.js");var Browser=__webpack_require__("./device/Browser.js");var CanvasPool=__webpack_require__("./display/canvas/CanvasPool.js");var Features={canvas:false,canvasBitBltShift:null,file:false,fileSystem:false,getUserMedia:true,littleEndian:false,localStorage:false,pointerLock:false,support32bit:false,vibration:false,webGL:false,worker:false};function checkIsLittleEndian()
    {var a=new ArrayBuffer(4);var b=new Uint8Array(a);var c=new Uint32Array(a);b[0]=0xa1;b[1]=0xb2;b[2]=0xc3;b[3]=0xd4;if(c[0]===0xd4c3b2a1)
    {return true;}
        if(c[0]===0xa1b2c3d4)
        {return false;}
        else
        {return null;}}
        function init()
        {Features.canvas=!!window['CanvasRenderingContext2D']||OS.cocoonJS;try
        {Features.localStorage=!!localStorage.getItem;}
        catch(error)
        {Features.localStorage=false;}
            Features.file=!!window['File']&&!!window['FileReader']&&!!window['FileList']&&!!window['Blob'];Features.fileSystem=!!window['requestFileSystem'];var isUint8=false;var testWebGL=function()
        {if(window['WebGLRenderingContext'])
        {try
        {var canvas=CanvasPool.createWebGL(this);if(OS.cocoonJS)
        {canvas.screencanvas=false;}
            var ctx=canvas.getContext('webgl')||canvas.getContext('experimental-webgl');var canvas2D=CanvasPool.create2D(this);var ctx2D=canvas2D.getContext('2d');var image=ctx2D.createImageData(1,1);isUint8=image.data instanceof Uint8ClampedArray;CanvasPool.remove(canvas);CanvasPool.remove(canvas2D);return!!ctx;}
        catch(e)
        {return false;}}
            return false;};Features.webGL=testWebGL();Features.worker=!!window['Worker'];Features.pointerLock='pointerLockElement'in document||'mozPointerLockElement'in document||'webkitPointerLockElement'in document;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia;window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL;Features.getUserMedia=Features.getUserMedia&&!!navigator.getUserMedia&&!!window.URL;if(Browser.firefox&&Browser.firefoxVersion<21)
        {Features.getUserMedia=false;}
            if(!OS.iOS&&(Browser.ie||Browser.firefox||Browser.chrome))
            {Features.canvasBitBltShift=true;}
            if(Browser.safari||Browser.mobileSafari)
            {Features.canvasBitBltShift=false;}
            navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate;if(navigator.vibrate)
        {Features.vibration=true;}
            if(typeof ArrayBuffer!=='undefined'&&typeof Uint8Array!=='undefined'&&typeof Uint32Array!=='undefined')
            {Features.littleEndian=checkIsLittleEndian();}
            Features.support32bit=(typeof ArrayBuffer!=='undefined'&&typeof Uint8ClampedArray!=='undefined'&&typeof Int32Array!=='undefined'&&Features.littleEndian!==null&&isUint8);return Features;}
        module.exports=init();}),"./device/Fullscreen.js":(function(module,exports){var Fullscreen={available:false,cancel:'',keyboard:false,request:''};function init()
    {var i;var fs=['requestFullscreen','requestFullScreen','webkitRequestFullscreen','webkitRequestFullScreen','msRequestFullscreen','msRequestFullScreen','mozRequestFullScreen','mozRequestFullscreen'];var element=document.createElement('div');for(i=0;i<fs.length;i++)
    {if(element[fs[i]])
    {Fullscreen.available=true;Fullscreen.request=fs[i];break;}}
        var cfs=['cancelFullScreen','exitFullscreen','webkitCancelFullScreen','webkitExitFullscreen','msCancelFullScreen','msExitFullscreen','mozCancelFullScreen','mozExitFullscreen'];if(Fullscreen.available)
    {for(i=0;i<cfs.length;i++)
    {if(document[cfs[i]])
    {Fullscreen.cancel=cfs[i];break;}}}
        if(window['Element']&&Element['ALLOW_KEYBOARD_INPUT'])
        {Fullscreen.keyboard=true;}
        return Fullscreen;}
        module.exports=init();}),"./device/Input.js":(function(module,exports,__webpack_require__){var OS=__webpack_require__("./device/OS.js");var Browser=__webpack_require__("./device/Browser.js");var Input={gamepads:false,mspointer:false,touch:false,wheelEvent:null};function init()
    {if('ontouchstart'in document.documentElement||(navigator.maxTouchPoints&&navigator.maxTouchPoints>=1))
    {Input.touch=true;}
        if(navigator.msPointerEnabled||navigator.pointerEnabled)
        {Input.mspointer=true;}
        if(navigator.getGamepads)
        {Input.gamepads=true;}
        if(!OS.cocoonJS)
        {if('onwheel'in window||(Browser.ie&&'WheelEvent'in window))
        {Input.wheelEvent='wheel';}
        else if('onmousewheel'in window)
        {Input.wheelEvent='mousewheel';}
        else if(Browser.firefox&&'MouseScrollEvent'in window)
        {Input.wheelEvent='DOMMouseScroll';}}
        return Input;}
        module.exports=init();}),"./device/OS.js":(function(module,exports,__webpack_require__){(function(process){var OS={android:false,chromeOS:false,cocoonJS:false,cocoonJSApp:false,cordova:false,crosswalk:false,desktop:false,ejecta:false,electron:false,iOS:false,iOSVersion:0,iPad:false,iPhone:false,kindle:false,linux:false,macOS:false,node:false,nodeWebkit:false,pixelRatio:1,webApp:false,windows:false,windowsPhone:false};function init()
    {var ua=navigator.userAgent;if(/Windows/.test(ua))
    {OS.windows=true;}
    else if(/Mac OS/.test(ua)&&!(/like Mac OS/.test(ua)))
    {OS.macOS=true;}
    else if(/Android/.test(ua))
    {OS.android=true;}
    else if(/Linux/.test(ua))
    {OS.linux=true;}
    else if(/iP[ao]d|iPhone/i.test(ua))
    {OS.iOS=true;(navigator.appVersion).match(/OS (\d+)/);OS.iOSVersion=parseInt(RegExp.$1,10);OS.iPhone=ua.toLowerCase().indexOf('iphone')!==-1;OS.iPad=ua.toLowerCase().indexOf('ipad')!==-1;}
    else if(/Kindle/.test(ua)||(/\bKF[A-Z][A-Z]+/).test(ua)||(/Silk.*Mobile Safari/).test(ua))
    {OS.kindle=true;}
    else if(/CrOS/.test(ua))
    {OS.chromeOS=true;}
        if(/Windows Phone/i.test(ua)||(/IEMobile/i).test(ua))
        {OS.android=false;OS.iOS=false;OS.macOS=false;OS.windows=true;OS.windowsPhone=true;}
        var silk=(/Silk/).test(ua);if(OS.windows||OS.macOS||(OS.linux&&!silk)||OS.chromeOS)
    {OS.desktop=true;}
        if(OS.windowsPhone||((/Windows NT/i.test(ua))&&(/Touch/i.test(ua))))
        {OS.desktop=false;}
        if(navigator.standalone)
        {OS.webApp=true;}
        if(window.cordova!==undefined)
        {OS.cordova=true;}
        if(typeof process!=='undefined'&&process.versions&&process.versions.node)
        {OS.node=true;}
        if(OS.node&&typeof process.versions==='object')
        {OS.nodeWebkit=!!process.versions['node-webkit'];OS.electron=!!process.versions.electron;}
        if(navigator.isCocoonJS)
        {OS.cocoonJS=true;try
        {OS.cocoonJSApp=(typeof CocoonJS!=='undefined');}
        catch(error)
        {OS.cocoonJSApp=false;}}
        if(window.ejecta!==undefined)
        {OS.ejecta=true;}
        if((/Crosswalk/).test(ua))
        {OS.crosswalk=true;}
        OS.pixelRatio=window['devicePixelRatio']||1;return OS;}
        module.exports=init();}.call(this,__webpack_require__("../node_modules/process/browser.js")))}),"./device/Video.js":(function(module,exports){var Video={h264Video:false,hlsVideo:false,mp4Video:false,oggVideo:false,vp9Video:false,webmVideo:false};function init()
    {var videoElement=document.createElement('video');var result=!!videoElement.canPlayType;try
    {if(result)
    {if(videoElement.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,''))
    {Video.oggVideo=true;}
        if(videoElement.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,''))
        {Video.h264Video=true;Video.mp4Video=true;}
        if(videoElement.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,''))
        {Video.webmVideo=true;}
        if(videoElement.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,''))
        {Video.vp9Video=true;}
        if(videoElement.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,''))
        {Video.hlsVideo=true;}}}
    catch(e)
    {}
        return Video;}
        module.exports=init();}),"./device/index.js":(function(module,exports,__webpack_require__){module.exports={os:__webpack_require__("./device/OS.js"),browser:__webpack_require__("./device/Browser.js"),features:__webpack_require__("./device/Features.js"),input:__webpack_require__("./device/Input.js"),audio:__webpack_require__("./device/Audio.js"),video:__webpack_require__("./device/Video.js"),fullscreen:__webpack_require__("./device/Fullscreen.js"),canvasFeatures:__webpack_require__("./device/CanvasFeatures.js")};}),"./display/align/const.js":(function(module,exports){var ALIGN_CONST={TOP_LEFT:0,TOP_CENTER:1,TOP_RIGHT:2,LEFT_TOP:3,LEFT_CENTER:4,LEFT_BOTTOM:5,CENTER:6,RIGHT_TOP:7,RIGHT_CENTER:8,RIGHT_BOTTOM:9,BOTTOM_LEFT:10,BOTTOM_CENTER:11,BOTTOM_RIGHT:12};module.exports=ALIGN_CONST;}),"./display/align/in/BottomCenter.js":(function(module,exports,__webpack_require__){var GetBottom=__webpack_require__("./display/bounds/GetBottom.js");var GetCenterX=__webpack_require__("./display/bounds/GetCenterX.js");var SetBottom=__webpack_require__("./display/bounds/SetBottom.js");var SetCenterX=__webpack_require__("./display/bounds/SetCenterX.js");var BottomCenter=function(gameObject,alignIn,offsetX,offsetY)
    {if(offsetX===undefined){offsetX=0;}
        if(offsetY===undefined){offsetY=0;}
        SetCenterX(gameObject,GetCenterX(alignIn)+offsetX);SetBottom(gameObject,GetBottom(alignIn)+offsetY);return gameObject;};module.exports=BottomCenter;}),"./display/align/in/BottomLeft.js":(function(module,exports,__webpack_require__){var GetBottom=__webpack_require__("./display/bounds/GetBottom.js");var GetLeft=__webpack_require__("./display/bounds/GetLeft.js");var SetBottom=__webpack_require__("./display/bounds/SetBottom.js");var SetLeft=__webpack_require__("./display/bounds/SetLeft.js");var BottomLeft=function(gameObject,alignIn,offsetX,offsetY)
    {if(offsetX===undefined){offsetX=0;}
        if(offsetY===undefined){offsetY=0;}
        SetLeft(gameObject,GetLeft(alignIn)-offsetX);SetBottom(gameObject,GetBottom(alignIn)+offsetY);return gameObject;};module.exports=BottomLeft;}),"./display/align/in/BottomRight.js":(function(module,exports,__webpack_require__){var GetBottom=__webpack_require__("./display/bounds/GetBottom.js");var GetRight=__webpack_require__("./display/bounds/GetRight.js");var SetBottom=__webpack_require__("./display/bounds/SetBottom.js");var SetRight=__webpack_require__("./display/bounds/SetRight.js");var BottomRight=function(gameObject,alignIn,offsetX,offsetY)
    {if(offsetX===undefined){offsetX=0;}
        if(offsetY===undefined){offsetY=0;}
        SetRight(gameObject,GetRight(alignIn)+offsetX);SetBottom(gameObject,GetBottom(alignIn)+offsetY);return gameObject;};module.exports=BottomRight;}),"./display/align/in/Center.js":(function(module,exports,__webpack_require__){var CenterOn=__webpack_require__("./display/bounds/CenterOn.js");var GetCenterX=__webpack_require__("./display/bounds/GetCenterX.js");var GetCenterY=__webpack_require__("./display/bounds/GetCenterY.js");var Center=function(gameObject,alignIn,offsetX,offsetY)
    {if(offsetX===undefined){offsetX=0;}
        if(offsetY===undefined){offsetY=0;}
        CenterOn(gameObject,GetCenterX(alignIn)+offsetX,GetCenterY(alignIn)+offsetY);return gameObject;};module.exports=Center;}),"./display/align/in/LeftCenter.js":(function(module,exports,__webpack_require__){var GetCenterY=__webpack_require__("./display/bounds/GetCenterY.js");var GetLeft=__webpack_require__("./display/bounds/GetLeft.js");var SetCenterY=__webpack_require__("./display/bounds/SetCenterY.js");var SetLeft=__webpack_require__("./display/bounds/SetLeft.js");var LeftCenter=function(gameObject,alignIn,offsetX,offsetY)
    {if(offsetX===undefined){offsetX=0;}
        if(offsetY===undefined){offsetY=0;}
        SetLeft(gameObject,GetLeft(alignIn)-offsetX);SetCenterY(gameObject,GetCenterY(alignIn)+offsetY);return gameObject;};module.exports=LeftCenter;}),"./display/align/in/QuickSet.js":(function(module,exports,__webpack_require__){var ALIGN_CONST=__webpack_require__("./display/align/const.js");var AlignInMap=[];AlignInMap[ALIGN_CONST.BOTTOM_CENTER]=__webpack_require__("./display/align/in/BottomCenter.js");AlignInMap[ALIGN_CONST.BOTTOM_LEFT]=__webpack_require__("./display/align/in/BottomLeft.js");AlignInMap[ALIGN_CONST.BOTTOM_RIGHT]=__webpack_require__("./display/align/in/BottomRight.js");AlignInMap[ALIGN_CONST.CENTER]=__webpack_require__("./display/align/in/Center.js");AlignInMap[ALIGN_CONST.LEFT_CENTER]=__webpack_require__("./display/align/in/LeftCenter.js");AlignInMap[ALIGN_CONST.RIGHT_CENTER]=__webpack_require__("./display/align/in/RightCenter.js");AlignInMap[ALIGN_CONST.TOP_CENTER]=__webpack_require__("./display/align/in/TopCenter.js");AlignInMap[ALIGN_CONST.TOP_LEFT]=__webpack_require__("./display/align/in/TopLeft.js");AlignInMap[ALIGN_CONST.TOP_RIGHT]=__webpack_require__("./display/align/in/TopRight.js");var QuickSet=function(child,alignIn,position,offsetX,offsetY)
    {return AlignInMap[position](child,alignIn,offsetX,offsetY);};module.exports=QuickSet;}),"./display/align/in/RightCenter.js":(function(module,exports,__webpack_require__){var GetCenterY=__webpack_require__("./display/bounds/GetCenterY.js");var GetRight=__webpack_require__("./display/bounds/GetRight.js");var SetCenterY=__webpack_require__("./display/bounds/SetCenterY.js");var SetRight=__webpack_require__("./display/bounds/SetRight.js");var RightCenter=function(gameObject,alignIn,offsetX,offsetY)
    {if(offsetX===undefined){offsetX=0;}
        if(offsetY===undefined){offsetY=0;}
        SetRight(gameObject,GetRight(alignIn)+offsetX);SetCenterY(gameObject,GetCenterY(alignIn)+offsetY);return gameObject;};module.exports=RightCenter;}),"./display/align/in/TopCenter.js":(function(module,exports,__webpack_require__){var GetCenterX=__webpack_require__("./display/bounds/GetCenterX.js");var GetTop=__webpack_require__("./display/bounds/GetTop.js");var SetCenterX=__webpack_require__("./display/bounds/SetCenterX.js");var SetTop=__webpack_require__("./display/bounds/SetTop.js");var TopCenter=function(gameObject,alignIn,offsetX,offsetY)
    {if(offsetX===undefined){offsetX=0;}
        if(offsetY===undefined){offsetY=0;}
        SetCenterX(gameObject,GetCenterX(alignIn)+offsetX);SetTop(gameObject,GetTop(alignIn)-offsetY);return gameObject;};module.exports=TopCenter;}),"./display/align/in/TopLeft.js":(function(module,exports,__webpack_require__){var GetLeft=__webpack_require__("./display/bounds/GetLeft.js");var GetTop=__webpack_require__("./display/bounds/GetTop.js");var SetLeft=__webpack_require__("./display/bounds/SetLeft.js");var SetTop=__webpack_require__("./display/bounds/SetTop.js");var TopLeft=function(gameObject,alignIn,offsetX,offsetY)
    {if(offsetX===undefined){offsetX=0;}
        if(offsetY===undefined){offsetY=0;}
        SetLeft(gameObject,GetLeft(alignIn)-offsetX);SetTop(gameObject,GetTop(alignIn)-offsetY);return gameObject;};module.exports=TopLeft;}),"./display/align/in/TopRight.js":(function(module,exports,__webpack_require__){var GetRight=__webpack_require__("./display/bounds/GetRight.js");var GetTop=__webpack_require__("./display/bounds/GetTop.js");var SetRight=__webpack_require__("./display/bounds/SetRight.js");var SetTop=__webpack_require__("./display/bounds/SetTop.js");var TopRight=function(gameObject,alignIn,offsetX,offsetY)
    {if(offsetX===undefined){offsetX=0;}
        if(offsetY===undefined){offsetY=0;}
        SetRight(gameObject,GetRight(alignIn)+offsetX);SetTop(gameObject,GetTop(alignIn)-offsetY);return gameObject;};module.exports=TopRight;}),"./display/align/in/index.js":(function(module,exports,__webpack_require__){module.exports={BottomCenter:__webpack_require__("./display/align/in/BottomCenter.js"),BottomLeft:__webpack_require__("./display/align/in/BottomLeft.js"),BottomRight:__webpack_require__("./display/align/in/BottomRight.js"),Center:__webpack_require__("./display/align/in/Center.js"),LeftCenter:__webpack_require__("./display/align/in/LeftCenter.js"),QuickSet:__webpack_require__("./display/align/in/QuickSet.js"),RightCenter:__webpack_require__("./display/align/in/RightCenter.js"),TopCenter:__webpack_require__("./display/align/in/TopCenter.js"),TopLeft:__webpack_require__("./display/align/in/TopLeft.js"),TopRight:__webpack_require__("./display/align/in/TopRight.js")};}),"./display/align/index.js":(function(module,exports,__webpack_require__){var CONST=__webpack_require__("./display/align/const.js");var Extend=__webpack_require__("./utils/object/Extend.js");var Align={In:__webpack_require__("./display/align/in/index.js"),To:__webpack_require__("./display/align/to/index.js")};Align=Extend(false,Align,CONST);module.exports=Align;}),"./display/align/to/BottomCenter.js":(function(module,exports,__webpack_require__){var GetBottom=__webpack_require__("./display/bounds/GetBottom.js");var GetCenterX=__webpack_require__("./display/bounds/GetCenterX.js");var SetCenterX=__webpack_require__("./display/bounds/SetCenterX.js");var SetTop=__webpack_require__("./display/bounds/SetTop.js");var BottomCenter=function(gameObject,alignTo,offsetX,offsetY)
    {if(offsetX===undefined){offsetX=0;}
        if(offsetY===undefined){offsetY=0;}
        SetCenterX(gameObject,GetCenterX(alignTo)+offsetX);SetTop(gameObject,GetBottom(alignTo)+offsetY);return gameObject;};module.exports=BottomCenter;}),"./display/align/to/BottomLeft.js":(function(module,exports,__webpack_require__){var GetBottom=__webpack_require__("./display/bounds/GetBottom.js");var GetLeft=__webpack_require__("./display/bounds/GetLeft.js");var SetLeft=__webpack_require__("./display/bounds/SetLeft.js");var SetTop=__webpack_require__("./display/bounds/SetTop.js");var BottomLeft=function(gameObject,alignTo,offsetX,offsetY)
    {if(offsetX===undefined){offsetX=0;}
        if(offsetY===undefined){offsetY=0;}
        SetLeft(gameObject,GetLeft(alignTo)-offsetX);SetTop(gameObject,GetBottom(alignTo)+offsetY);return gameObject;};module.exports=BottomLeft;}),"./display/align/to/BottomRight.js":(function(module,exports,__webpack_require__){var GetBottom=__webpack_require__("./display/bounds/GetBottom.js");var GetRight=__webpack_require__("./display/bounds/GetRight.js");var SetRight=__webpack_require__("./display/bounds/SetRight.js");var SetTop=__webpack_require__("./display/bounds/SetTop.js");var BottomRight=function(gameObject,alignTo,offsetX,offsetY)
    {if(offsetX===undefined){offsetX=0;}
        if(offsetY===undefined){offsetY=0;}
        SetRight(gameObject,GetRight(alignTo)+offsetX);SetTop(gameObject,GetBottom(alignTo)+offsetY);return gameObject;};module.exports=BottomRight;}),"./display/align/to/LeftBottom.js":(function(module,exports,__webpack_require__){var GetBottom=__webpack_require__("./display/bounds/GetBottom.js");var GetLeft=__webpack_require__("./display/bounds/GetLeft.js");var SetBottom=__webpack_require__("./display/bounds/SetBottom.js");var SetRight=__webpack_require__("./display/bounds/SetRight.js");var LeftBottom=function(gameObject,alignTo,offsetX,offsetY)
    {if(offsetX===undefined){offsetX=0;}
        if(offsetY===undefined){offsetY=0;}
        SetRight(gameObject,GetLeft(alignTo)-offsetX);SetBottom(gameObject,GetBottom(alignTo)+offsetY);return gameObject;};module.exports=LeftBottom;}),"./display/align/to/LeftCenter.js":(function(module,exports,__webpack_require__){var GetCenterY=__webpack_require__("./display/bounds/GetCenterY.js");var GetLeft=__webpack_require__("./display/bounds/GetLeft.js");var SetCenterY=__webpack_require__("./display/bounds/SetCenterY.js");var SetRight=__webpack_require__("./display/bounds/SetRight.js");var LeftCenter=function(gameObject,alignTo,offsetX,offsetY)
    {if(offsetX===undefined){offsetX=0;}
        if(offsetY===undefined){offsetY=0;}
        SetRight(gameObject,GetLeft(alignTo)-offsetX);SetCenterY(gameObject,GetCenterY(alignTo)+offsetY);return gameObject;};module.exports=LeftCenter;}),"./display/align/to/LeftTop.js":(function(module,exports,__webpack_require__){var GetLeft=__webpack_require__("./display/bounds/GetLeft.js");var GetTop=__webpack_require__("./display/bounds/GetTop.js");var SetRight=__webpack_require__("./display/bounds/SetRight.js");var SetTop=__webpack_require__("./display/bounds/SetTop.js");var LeftTop=function(gameObject,alignTo,offsetX,offsetY)
    {if(offsetX===undefined){offsetX=0;}
        if(offsetY===undefined){offsetY=0;}
        SetRight(gameObject,GetLeft(alignTo)-offsetX);SetTop(gameObject,GetTop(alignTo)-offsetY);return gameObject;};module.exports=LeftTop;}),"./display/align/to/RightBottom.js":(function(module,exports,__webpack_require__){var GetBottom=__webpack_require__("./display/bounds/GetBottom.js");var GetRight=__webpack_require__("./display/bounds/GetRight.js");var SetBottom=__webpack_require__("./display/bounds/SetBottom.js");var SetLeft=__webpack_require__("./display/bounds/SetLeft.js");var RightBottom=function(gameObject,alignTo,offsetX,offsetY)
    {if(offsetX===undefined){offsetX=0;}
        if(offsetY===undefined){offsetY=0;}
        SetLeft(gameObject,GetRight(alignTo)+offsetX);SetBottom(gameObject,GetBottom(alignTo)+offsetY);return gameObject;};module.exports=RightBottom;}),"./display/align/to/RightCenter.js":(function(module,exports,__webpack_require__){var GetCenterY=__webpack_require__("./display/bounds/GetCenterY.js");var GetRight=__webpack_require__("./display/bounds/GetRight.js");var SetCenterY=__webpack_require__("./display/bounds/SetCenterY.js");var SetLeft=__webpack_require__("./display/bounds/SetLeft.js");var RightCenter=function(gameObject,alignTo,offsetX,offsetY)
    {if(offsetX===undefined){offsetX=0;}
        if(offsetY===undefined){offsetY=0;}
        SetLeft(gameObject,GetRight(alignTo)+offsetX);SetCenterY(gameObject,GetCenterY(alignTo)+offsetY);return gameObject;};module.exports=RightCenter;}),"./display/align/to/RightTop.js":(function(module,exports,__webpack_require__){var GetRight=__webpack_require__("./display/bounds/GetRight.js");var GetTop=__webpack_require__("./display/bounds/GetTop.js");var SetLeft=__webpack_require__("./display/bounds/SetLeft.js");var SetTop=__webpack_require__("./display/bounds/SetTop.js");var RightTop=function(gameObject,alignTo,offsetX,offsetY)
    {if(offsetX===undefined){offsetX=0;}
        if(offsetY===undefined){offsetY=0;}
        SetLeft(gameObject,GetRight(alignTo)+offsetX);SetTop(gameObject,GetTop(alignTo)-offsetY);return gameObject;};module.exports=RightTop;}),"./display/align/to/TopCenter.js":(function(module,exports,__webpack_require__){var GetCenterX=__webpack_require__("./display/bounds/GetCenterX.js");var GetTop=__webpack_require__("./display/bounds/GetTop.js");var SetBottom=__webpack_require__("./display/bounds/SetBottom.js");var SetCenterX=__webpack_require__("./display/bounds/SetCenterX.js");var TopCenter=function(gameObject,alignTo,offsetX,offsetY)
    {if(offsetX===undefined){offsetX=0;}
        if(offsetY===undefined){offsetY=0;}
        SetCenterX(gameObject,GetCenterX(alignTo)+offsetX);SetBottom(gameObject,GetTop(alignTo)-offsetY);return gameObject;};module.exports=TopCenter;}),"./display/align/to/TopLeft.js":(function(module,exports,__webpack_require__){var GetLeft=__webpack_require__("./display/bounds/GetLeft.js");var GetTop=__webpack_require__("./display/bounds/GetTop.js");var SetBottom=__webpack_require__("./display/bounds/SetBottom.js");var SetLeft=__webpack_require__("./display/bounds/SetLeft.js");var TopLeft=function(gameObject,alignTo,offsetX,offsetY)
    {if(offsetX===undefined){offsetX=0;}
        if(offsetY===undefined){offsetY=0;}
        SetLeft(gameObject,GetLeft(alignTo)-offsetX);SetBottom(gameObject,GetTop(alignTo)-offsetY);return gameObject;};module.exports=TopLeft;}),"./display/align/to/TopRight.js":(function(module,exports,__webpack_require__){var GetRight=__webpack_require__("./display/bounds/GetRight.js");var GetTop=__webpack_require__("./display/bounds/GetTop.js");var SetBottom=__webpack_require__("./display/bounds/SetBottom.js");var SetRight=__webpack_require__("./display/bounds/SetRight.js");var TopRight=function(gameObject,alignTo,offsetX,offsetY)
    {if(offsetX===undefined){offsetX=0;}
        if(offsetY===undefined){offsetY=0;}
        SetRight(gameObject,GetRight(alignTo)+offsetX);SetBottom(gameObject,GetTop(alignTo)-offsetY);return gameObject;};module.exports=TopRight;}),"./display/align/to/index.js":(function(module,exports,__webpack_require__){module.exports={BottomCenter:__webpack_require__("./display/align/to/BottomCenter.js"),BottomLeft:__webpack_require__("./display/align/to/BottomLeft.js"),BottomRight:__webpack_require__("./display/align/to/BottomRight.js"),LeftBottom:__webpack_require__("./display/align/to/LeftBottom.js"),LeftCenter:__webpack_require__("./display/align/to/LeftCenter.js"),LeftTop:__webpack_require__("./display/align/to/LeftTop.js"),RightBottom:__webpack_require__("./display/align/to/RightBottom.js"),RightCenter:__webpack_require__("./display/align/to/RightCenter.js"),RightTop:__webpack_require__("./display/align/to/RightTop.js"),TopCenter:__webpack_require__("./display/align/to/TopCenter.js"),TopLeft:__webpack_require__("./display/align/to/TopLeft.js"),TopRight:__webpack_require__("./display/align/to/TopRight.js")};}),"./display/bounds/CenterOn.js":(function(module,exports,__webpack_require__){var SetCenterX=__webpack_require__("./display/bounds/SetCenterX.js");var SetCenterY=__webpack_require__("./display/bounds/SetCenterY.js");var CenterOn=function(gameObject,x,y)
    {SetCenterX(gameObject,x);return SetCenterY(gameObject,y);};module.exports=CenterOn;}),"./display/bounds/GetBottom.js":(function(module,exports){var GetBottom=function(gameObject)
    {return(gameObject.y+gameObject.height)-(gameObject.height*gameObject.originY);};module.exports=GetBottom;}),"./display/bounds/GetCenterX.js":(function(module,exports){var GetCenterX=function(gameObject)
    {return gameObject.x-(gameObject.width*gameObject.originX)+(gameObject.width*0.5);};module.exports=GetCenterX;}),"./display/bounds/GetCenterY.js":(function(module,exports){var GetCenterY=function(gameObject)
    {return gameObject.y-(gameObject.height*gameObject.originY)+(gameObject.height*0.5);};module.exports=GetCenterY;}),"./display/bounds/GetLeft.js":(function(module,exports){var GetLeft=function(gameObject)
    {return gameObject.x-(gameObject.width*gameObject.originX);};module.exports=GetLeft;}),"./display/bounds/GetOffsetX.js":(function(module,exports){var GetOffsetX=function(gameObject)
    {return gameObject.width*gameObject.originX;};module.exports=GetOffsetX;}),"./display/bounds/GetOffsetY.js":(function(module,exports){var GetOffsetY=function(gameObject)
    {return gameObject.height*gameObject.originY;};module.exports=GetOffsetY;}),"./display/bounds/GetRight.js":(function(module,exports){var GetRight=function(gameObject)
    {return(gameObject.x+gameObject.width)-(gameObject.width*gameObject.originX);};module.exports=GetRight;}),"./display/bounds/GetTop.js":(function(module,exports){var GetTop=function(gameObject)
    {return gameObject.y-(gameObject.height*gameObject.originY);};module.exports=GetTop;}),"./display/bounds/SetBottom.js":(function(module,exports){var SetBottom=function(gameObject,value)
    {gameObject.y=(value-gameObject.height)+(gameObject.height*gameObject.originY);return gameObject;};module.exports=SetBottom;}),"./display/bounds/SetCenterX.js":(function(module,exports){var SetCenterX=function(gameObject,x)
    {var offsetX=gameObject.width*gameObject.originX;gameObject.x=(x+offsetX)-(gameObject.width*0.5);return gameObject;};module.exports=SetCenterX;}),"./display/bounds/SetCenterY.js":(function(module,exports){var SetCenterY=function(gameObject,y)
    {var offsetY=gameObject.height*gameObject.originY;gameObject.y=(y+offsetY)-(gameObject.height*0.5);return gameObject;};module.exports=SetCenterY;}),"./display/bounds/SetLeft.js":(function(module,exports){var SetLeft=function(gameObject,value)
    {gameObject.x=value+(gameObject.width*gameObject.originX);return gameObject;};module.exports=SetLeft;}),"./display/bounds/SetRight.js":(function(module,exports){var SetRight=function(gameObject,value)
    {gameObject.x=(value-gameObject.width)+(gameObject.width*gameObject.originX);return gameObject;};module.exports=SetRight;}),"./display/bounds/SetTop.js":(function(module,exports){var SetTop=function(gameObject,value)
    {gameObject.y=value+(gameObject.height*gameObject.originY);return gameObject;};module.exports=SetTop;}),"./display/bounds/index.js":(function(module,exports,__webpack_require__){module.exports={CenterOn:__webpack_require__("./display/bounds/CenterOn.js"),GetBottom:__webpack_require__("./display/bounds/GetBottom.js"),GetCenterX:__webpack_require__("./display/bounds/GetCenterX.js"),GetCenterY:__webpack_require__("./display/bounds/GetCenterY.js"),GetLeft:__webpack_require__("./display/bounds/GetLeft.js"),GetOffsetX:__webpack_require__("./display/bounds/GetOffsetX.js"),GetOffsetY:__webpack_require__("./display/bounds/GetOffsetY.js"),GetRight:__webpack_require__("./display/bounds/GetRight.js"),GetTop:__webpack_require__("./display/bounds/GetTop.js"),SetBottom:__webpack_require__("./display/bounds/SetBottom.js"),SetCenterX:__webpack_require__("./display/bounds/SetCenterX.js"),SetCenterY:__webpack_require__("./display/bounds/SetCenterY.js"),SetLeft:__webpack_require__("./display/bounds/SetLeft.js"),SetRight:__webpack_require__("./display/bounds/SetRight.js"),SetTop:__webpack_require__("./display/bounds/SetTop.js")};}),"./display/canvas/CanvasInterpolation.js":(function(module,exports){var CanvasInterpolation={setCrisp:function(canvas)
        {var types=['optimizeSpeed','crisp-edges','-moz-crisp-edges','-webkit-optimize-contrast','optimize-contrast','pixelated'];types.forEach(function(type)
        {canvas.style['image-rendering']=type;});canvas.style.msInterpolationMode='nearest-neighbor';return canvas;},setBicubic:function(canvas)
        {canvas.style['image-rendering']='auto';canvas.style.msInterpolationMode='bicubic';return canvas;}};module.exports=CanvasInterpolation;}),"./display/canvas/CanvasPool.js":(function(module,exports,__webpack_require__){var CONST=__webpack_require__("./const.js");var Smoothing=__webpack_require__("./display/canvas/Smoothing.js");var pool=[];var _disableContextSmoothing=false;var CanvasPool=function()
    {var create=function(parent,width,height,canvasType,selfParent)
    {if(width===undefined){width=1;}
        if(height===undefined){height=1;}
        if(canvasType===undefined){canvasType=CONST.CANVAS;}
        if(selfParent===undefined){selfParent=false;}
        var canvas;var container=first(canvasType);if(container===null)
    {container={parent:parent,canvas:document.createElement('canvas'),type:canvasType};if(canvasType===CONST.CANVAS)
    {pool.push(container);}
        canvas=container.canvas;}
    else
    {container.parent=parent;canvas=container.canvas;}
        if(selfParent)
        {container.parent=canvas;}
        canvas.width=width;canvas.height=height;if(_disableContextSmoothing&&canvasType===CONST.CANVAS)
    {Smoothing.disable(canvas.getContext('2d'));}
        return canvas;};var create2D=function(parent,width,height)
    {return create(parent,width,height,CONST.CANVAS);};var createWebGL=function(parent,width,height)
    {return create(parent,width,height,CONST.WEBGL);};var first=function(canvasType)
    {if(canvasType===undefined){canvasType=CONST.CANVAS;}
        if(canvasType===CONST.WEBGL)
        {return null;}
        for(var i=0;i<pool.length;i++)
        {var container=pool[i];if(!container.parent&&container.type===canvasType)
        {return container;}}
        return null;};var remove=function(parent)
    {var isCanvas=parent instanceof HTMLCanvasElement;pool.forEach(function(container)
    {if((isCanvas&&container.canvas===parent)||(!isCanvas&&container.parent===parent))
    {container.parent=null;container.canvas.width=1;container.canvas.height=1;}});};var total=function()
    {var c=0;pool.forEach(function(container)
    {if(container.parent)
    {c++;}});return c;};var free=function()
    {return pool.length-total();};var disableSmoothing=function()
    {_disableContextSmoothing=true;};var enableSmoothing=function()
    {_disableContextSmoothing=false;};return{create2D:create2D,create:create,createWebGL:createWebGL,disableSmoothing:disableSmoothing,enableSmoothing:enableSmoothing,first:first,free:free,pool:pool,remove:remove,total:total};};module.exports=CanvasPool();}),"./display/canvas/Smoothing.js":(function(module,exports){var prefix='';var Smoothing=function()
    {var getPrefix=function(context)
    {var vendors=['i','webkitI','msI','mozI','oI'];for(var i=0;i<vendors.length;i++)
    {var s=vendors[i]+'mageSmoothingEnabled';if(s in context)
    {return s;}}
        return null;};var enable=function(context)
    {if(prefix==='')
    {prefix=getPrefix(context);}
        if(prefix)
        {context[prefix]=true;}
        return context;};var disable=function(context)
    {if(prefix==='')
    {prefix=getPrefix(context);}
        if(prefix)
        {context[prefix]=false;}
        return context;};var isEnabled=function(context)
    {return(prefix!==null)?context[prefix]:null;};return{disable:disable,enable:enable,getPrefix:getPrefix,isEnabled:isEnabled};};module.exports=Smoothing();}),"./display/canvas/TouchAction.js":(function(module,exports){var TouchAction=function(canvas,value)
    {if(value===undefined){value='none';}
        canvas.style['msTouchAction']=value;canvas.style['ms-touch-action']=value;canvas.style['touch-action']=value;return canvas;};module.exports=TouchAction;}),"./display/canvas/UserSelect.js":(function(module,exports){var UserSelect=function(canvas,value)
    {if(value===undefined){value='none';}
        var vendors=['-webkit-','-khtml-','-moz-','-ms-',''];vendors.forEach(function(vendor)
    {canvas.style[vendor+'user-select']=value;});canvas.style['-webkit-touch-callout']=value;canvas.style['-webkit-tap-highlight-color']='rgba(0, 0, 0, 0)';return canvas;};module.exports=UserSelect;}),"./display/canvas/index.js":(function(module,exports,__webpack_require__){module.exports={CanvasInterpolation:__webpack_require__("./display/canvas/CanvasInterpolation.js"),CanvasPool:__webpack_require__("./display/canvas/CanvasPool.js"),Smoothing:__webpack_require__("./display/canvas/Smoothing.js"),TouchAction:__webpack_require__("./display/canvas/TouchAction.js"),UserSelect:__webpack_require__("./display/canvas/UserSelect.js")};}),"./display/color/Color.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var GetColor=__webpack_require__("./display/color/GetColor.js");var GetColor32=__webpack_require__("./display/color/GetColor32.js");var HSVToRGB=__webpack_require__("./display/color/HSVToRGB.js");var RGBToHSV=__webpack_require__("./display/color/RGBToHSV.js");var Color=new Class({initialize:function Color(red,green,blue,alpha)
        {if(red===undefined){red=0;}
            if(green===undefined){green=0;}
            if(blue===undefined){blue=0;}
            if(alpha===undefined){alpha=255;}
            this.r=0;this.g=0;this.b=0;this.a=255;this._h=0;this._s=0;this._v=0;this._locked=false;this.gl=[0,0,0,1];this._color=0;this._color32=0;this._rgba='';this.setTo(red,green,blue,alpha);},transparent:function()
        {this._locked=true;this.red=0;this.green=0;this.blue=0;this.alpha=0;this._locked=false;return this.update(true);},setTo:function(red,green,blue,alpha,updateHSV)
        {if(alpha===undefined){alpha=255;}
            if(updateHSV===undefined){updateHSV=true;}
            this._locked=true;this.red=red;this.green=green;this.blue=blue;this.alpha=alpha;this._locked=false;return this.update(updateHSV);},setGLTo:function(red,green,blue,alpha)
        {if(alpha===undefined){alpha=1;}
            this._locked=true;this.redGL=red;this.greenGL=green;this.blueGL=blue;this.alphaGL=alpha;this._locked=false;return this.update(true);},setFromRGB:function(color)
        {this._locked=true;this.red=color.r;this.green=color.g;this.blue=color.b;if(color.hasOwnProperty('a'))
        {this.alpha=color.a;}
            this._locked=false;return this.update(true);},setFromHSV:function(h,s,v)
        {return HSVToRGB(h,s,v,this);},update:function(updateHSV)
        {if(updateHSV===undefined){updateHSV=false;}
            if(this._locked)
            {return this;}
            var r=this.r;var g=this.g;var b=this.b;var a=this.a;this._color=GetColor(r,g,b);this._color32=GetColor32(r,g,b,a);this._rgba='rgba('+r+','+g+','+b+','+(a / 255)+')';if(updateHSV)
        {RGBToHSV(r,g,b,this);}
            return this;},updateHSV:function()
        {var r=this.r;var g=this.g;var b=this.b;RGBToHSV(r,g,b,this);return this;},clone:function()
        {return new Color(this.r,this.g,this.b,this.a);},gray:function(shade)
        {return this.setTo(shade,shade,shade);},random:function(min,max)
        {if(min===undefined){min=0;}
            if(max===undefined){max=255;}
            var r=Math.floor(min+Math.random()*(max-min));var g=Math.floor(min+Math.random()*(max-min));var b=Math.floor(min+Math.random()*(max-min));return this.setTo(r,g,b);},randomGray:function(min,max)
        {if(min===undefined){min=0;}
            if(max===undefined){max=255;}
            var s=Math.floor(min+Math.random()*(max-min));return this.setTo(s,s,s);},saturate:function(amount)
        {this.s+=amount / 100;return this;},desaturate:function(amount)
        {this.s-=amount / 100;return this;},lighten:function(amount)
        {this.v+=amount / 100;return this;},darken:function(amount)
        {this.v-=amount / 100;return this;},brighten:function(amount)
        {var r=this.r;var g=this.g;var b=this.b;r=Math.max(0,Math.min(255,r-Math.round(255*-(amount / 100))));g=Math.max(0,Math.min(255,g-Math.round(255*-(amount / 100))));b=Math.max(0,Math.min(255,b-Math.round(255*-(amount / 100))));return this.setTo(r,g,b);},color:{get:function()
            {return this._color;}},color32:{get:function()
            {return this._color32;}},rgba:{get:function()
            {return this._rgba;}},redGL:{get:function()
            {return this.gl[0];},set:function(value)
            {this.gl[0]=Math.min(Math.abs(value),1);this.r=Math.floor(this.gl[0]*255);this.update(true);}},greenGL:{get:function()
            {return this.gl[1];},set:function(value)
            {this.gl[1]=Math.min(Math.abs(value),1);this.g=Math.floor(this.gl[1]*255);this.update(true);}},blueGL:{get:function()
            {return this.gl[2];},set:function(value)
            {this.gl[2]=Math.min(Math.abs(value),1);this.b=Math.floor(this.gl[2]*255);this.update(true);}},alphaGL:{get:function()
            {return this.gl[3];},set:function(value)
            {this.gl[3]=Math.min(Math.abs(value),1);this.a=Math.floor(this.gl[3]*255);this.update();}},red:{get:function()
            {return this.r;},set:function(value)
            {value=Math.floor(Math.abs(value));this.r=Math.min(value,255);this.gl[0]=value / 255;this.update(true);}},green:{get:function()
            {return this.g;},set:function(value)
            {value=Math.floor(Math.abs(value));this.g=Math.min(value,255);this.gl[1]=value / 255;this.update(true);}},blue:{get:function()
            {return this.b;},set:function(value)
            {value=Math.floor(Math.abs(value));this.b=Math.min(value,255);this.gl[2]=value / 255;this.update(true);}},alpha:{get:function()
            {return this.a;},set:function(value)
            {value=Math.floor(Math.abs(value));this.a=Math.min(value,255);this.gl[3]=value / 255;this.update();}},h:{get:function()
            {return this._h;},set:function(value)
            {this._h=value;HSVToRGB(value,this._s,this._v,this);}},s:{get:function()
            {return this._s;},set:function(value)
            {this._s=value;HSVToRGB(this._h,value,this._v,this);}},v:{get:function()
            {return this._v;},set:function(value)
            {this._v=value;HSVToRGB(this._h,this._s,value,this);}}});module.exports=Color;}),"./display/color/ColorToRGBA.js":(function(module,exports){var ColorToRGBA=function(color)
    {var output={r:color>>16&0xFF,g:color>>8&0xFF,b:color&0xFF,a:255};if(color>16777215)
    {output.a=color>>>24;}
        return output;};module.exports=ColorToRGBA;}),"./display/color/ComponentToHex.js":(function(module,exports){var ComponentToHex=function(color)
    {var hex=color.toString(16);return(hex.length===1)?'0'+hex:hex;};module.exports=ComponentToHex;}),"./display/color/GetColor.js":(function(module,exports){var GetColor=function(red,green,blue)
    {return red<<16|green<<8|blue;};module.exports=GetColor;}),"./display/color/GetColor32.js":(function(module,exports){var GetColor32=function(red,green,blue,alpha)
    {return alpha<<24|red<<16|green<<8|blue;};module.exports=GetColor32;}),"./display/color/HSLToColor.js":(function(module,exports,__webpack_require__){var Color=__webpack_require__("./display/color/Color.js");var HueToComponent=__webpack_require__("./display/color/HueToComponent.js");var HSLToColor=function(h,s,l)
    {var r=l;var g=l;var b=l;if(s!==0)
    {var q=(l<0.5)?l*(1+s):l+s-l*s;var p=2*l-q;r=HueToComponent(p,q,h+1 / 3);g=HueToComponent(p,q,h);b=HueToComponent(p,q,h-1 / 3);}
        var color=new Color();return color.setGLTo(r,g,b,1);};module.exports=HSLToColor;}),"./display/color/HSVColorWheel.js":(function(module,exports,__webpack_require__){var HSVToRGB=__webpack_require__("./display/color/HSVToRGB.js");var HSVColorWheel=function(s,v)
    {if(s===undefined){s=1;}
        if(v===undefined){v=1;}
        var colors=[];for(var c=0;c<=359;c++)
    {colors.push(HSVToRGB(c / 359,s,v));}
        return colors;};module.exports=HSVColorWheel;}),"./display/color/HSVToRGB.js":(function(module,exports,__webpack_require__){var GetColor=__webpack_require__("./display/color/GetColor.js");var HSVToRGB=function(h,s,v,out)
    {if(s===undefined){s=1;}
        if(v===undefined){v=1;}
        var i=Math.floor(h*6);var f=h*6-i;var p=Math.floor((v*(1-s))*255);var q=Math.floor((v*(1-f*s))*255);var t=Math.floor((v*(1-(1-f)*s))*255);v=Math.floor(v*=255);var r=v;var g=v;var b=v;var c=i%6;if(c===0)
    {g=t;b=p;}
    else if(c===1)
    {r=q;b=p;}
    else if(c===2)
    {r=p;b=t;}
    else if(c===3)
    {r=p;g=q;}
    else if(c===4)
    {r=t;g=p;}
    else if(c===5)
    {g=p;b=q;}
        if(!out)
        {return{r:r,g:g,b:b,color:GetColor(r,g,b)};}
        else if(out.setTo)
        {return out.setTo(r,g,b,out.alpha,false);}
        else
        {out.r=r;out.g=g;out.b=b;out.color=GetColor(r,g,b);return out;}};module.exports=HSVToRGB;}),"./display/color/HexStringToColor.js":(function(module,exports,__webpack_require__){var Color=__webpack_require__("./display/color/Color.js");var HexStringToColor=function(hex)
    {var color=new Color();hex=hex.replace(/^(?:#|0x)?([a-f\d])([a-f\d])([a-f\d])$/i,function(m,r,g,b)
    {return r+r+g+g+b+b;});var result=(/^(?:#|0x)?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i).exec(hex);if(result)
    {var r=parseInt(result[1],16);var g=parseInt(result[2],16);var b=parseInt(result[3],16);color.setTo(r,g,b);}
        return color;};module.exports=HexStringToColor;}),"./display/color/HueToComponent.js":(function(module,exports){var HueToComponent=function(p,q,t)
    {if(t<0)
    {t+=1;}
        if(t>1)
        {t-=1;}
        if(t<1 / 6)
        {return p+(q-p)*6*t;}
        if(t<1 / 2)
        {return q;}
        if(t<2 / 3)
        {return p+(q-p)*(2 / 3-t)*6;}
        return p;};module.exports=HueToComponent;}),"./display/color/IntegerToColor.js":(function(module,exports,__webpack_require__){var Color=__webpack_require__("./display/color/Color.js");var IntegerToRGB=__webpack_require__("./display/color/IntegerToRGB.js");var IntegerToColor=function(input)
    {var rgb=IntegerToRGB(input);return new Color(rgb.r,rgb.g,rgb.b,rgb.a);};module.exports=IntegerToColor;}),"./display/color/IntegerToRGB.js":(function(module,exports){var IntegerToRGB=function(color)
    {if(color>16777215)
    {return{a:color>>>24,r:color>>16&0xFF,g:color>>8&0xFF,b:color&0xFF};}
    else
    {return{a:255,r:color>>16&0xFF,g:color>>8&0xFF,b:color&0xFF};}};module.exports=IntegerToRGB;}),"./display/color/Interpolate.js":(function(module,exports,__webpack_require__){var Linear=__webpack_require__("./math/Linear.js");var RGBWithRGB=function(r1,g1,b1,r2,g2,b2,length,index)
    {if(length===undefined){length=100;}
        if(index===undefined){index=0;}
        var t=index / length;return{r:Linear(r1,r2,t),g:Linear(g1,g2,t),b:Linear(b1,b2,t)};};var ColorWithColor=function(color1,color2,length,index)
    {if(length===undefined){length=100;}
        if(index===undefined){index=0;}
        return RGBWithRGB(color1.r,color1.g,color1.b,color2.r,color2.g,color2.b,length,index);};var ColorWithRGB=function(color,r,g,b,length,index)
    {if(length===undefined){length=100;}
        if(index===undefined){index=0;}
        return RGBWithRGB(color.r,color.g,color.b,r,g,b,length,index);};module.exports={RGBWithRGB:RGBWithRGB,ColorWithRGB:ColorWithRGB,ColorWithColor:ColorWithColor};}),"./display/color/ObjectToColor.js":(function(module,exports,__webpack_require__){var Color=__webpack_require__("./display/color/Color.js");var ObjectToColor=function(input)
    {return new Color(input.r,input.g,input.b,input.a);};module.exports=ObjectToColor;}),"./display/color/RGBStringToColor.js":(function(module,exports,__webpack_require__){var Color=__webpack_require__("./display/color/Color.js");var RGBStringToColor=function(rgb)
    {var color=new Color();var result=(/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/).exec(rgb.toLowerCase());if(result)
    {var r=parseInt(result[1],10);var g=parseInt(result[2],10);var b=parseInt(result[3],10);var a=(result[4]!==undefined)?parseFloat(result[4]):1;color.setTo(r,g,b,a*255);}
        return color;};module.exports=RGBStringToColor;}),"./display/color/RGBToHSV.js":(function(module,exports){var RGBToHSV=function(r,g,b,out)
    {if(out===undefined){out={h:0,s:0,v:0};}
        r /=255;g /=255;b /=255;var min=Math.min(r,g,b);var max=Math.max(r,g,b);var d=max-min;var h=0;var s=(max===0)?0:d / max;var v=max;if(max!==min)
    {if(max===r)
    {h=(g-b)/ d+((g<b)?6:0);}
    else if(max===g)
    {h=(b-r)/ d+2;}
    else if(max===b)
    {h=(r-g)/ d+4;}
        h /=6;}
        if(out.hasOwnProperty('_h'))
        {out._h=h;out._s=s;out._v=v;}
        else
        {out.h=h;out.s=s;out.v=v;}
        return out;};module.exports=RGBToHSV;}),"./display/color/RGBToString.js":(function(module,exports,__webpack_require__){var ComponentToHex=__webpack_require__("./display/color/ComponentToHex.js");var RGBToString=function(r,g,b,a,prefix)
    {if(a===undefined){a=255;}
        if(prefix===undefined){prefix='#';}
        if(prefix==='#')
        {return'#'+((1<<24)+(r<<16)+(g<<8)+b).toString(16).slice(1);}
        else
        {return'0x'+ComponentToHex(a)+ComponentToHex(r)+ComponentToHex(g)+ComponentToHex(b);}};module.exports=RGBToString;}),"./display/color/RandomRGB.js":(function(module,exports,__webpack_require__){var Between=__webpack_require__("./math/Between.js");var Color=__webpack_require__("./display/color/Color.js");var RandomRGB=function(min,max)
    {if(min===undefined){min=0;}
        if(max===undefined){max=255;}
        return new Color(Between(min,max),Between(min,max),Between(min,max));};module.exports=RandomRGB;}),"./display/color/ValueToColor.js":(function(module,exports,__webpack_require__){var HexStringToColor=__webpack_require__("./display/color/HexStringToColor.js");var IntegerToColor=__webpack_require__("./display/color/IntegerToColor.js");var ObjectToColor=__webpack_require__("./display/color/ObjectToColor.js");var RGBStringToColor=__webpack_require__("./display/color/RGBStringToColor.js");var ValueToColor=function(input)
    {var t=typeof input;switch(t)
    {case'string':if(input.substr(0,3).toLowerCase()==='rgb')
        {return RGBStringToColor(input);}
        else
        {return HexStringToColor(input);}
        case'number':return IntegerToColor(input);case'object':return ObjectToColor(input);}};module.exports=ValueToColor;}),"./display/color/index.js":(function(module,exports,__webpack_require__){var Color=__webpack_require__("./display/color/Color.js");Color.ColorToRGBA=__webpack_require__("./display/color/ColorToRGBA.js");Color.ComponentToHex=__webpack_require__("./display/color/ComponentToHex.js");Color.GetColor=__webpack_require__("./display/color/GetColor.js");Color.GetColor32=__webpack_require__("./display/color/GetColor32.js");Color.HexStringToColor=__webpack_require__("./display/color/HexStringToColor.js");Color.HSLToColor=__webpack_require__("./display/color/HSLToColor.js");Color.HSVColorWheel=__webpack_require__("./display/color/HSVColorWheel.js");Color.HSVToRGB=__webpack_require__("./display/color/HSVToRGB.js");Color.HueToComponent=__webpack_require__("./display/color/HueToComponent.js");Color.IntegerToColor=__webpack_require__("./display/color/IntegerToColor.js");Color.IntegerToRGB=__webpack_require__("./display/color/IntegerToRGB.js");Color.Interpolate=__webpack_require__("./display/color/Interpolate.js");Color.ObjectToColor=__webpack_require__("./display/color/ObjectToColor.js");Color.RandomRGB=__webpack_require__("./display/color/RandomRGB.js");Color.RGBStringToColor=__webpack_require__("./display/color/RGBStringToColor.js");Color.RGBToHSV=__webpack_require__("./display/color/RGBToHSV.js");Color.RGBToString=__webpack_require__("./display/color/RGBToString.js");Color.ValueToColor=__webpack_require__("./display/color/ValueToColor.js");module.exports=Color;}),"./display/index.js":(function(module,exports,__webpack_require__){module.exports={Align:__webpack_require__("./display/align/index.js"),Bounds:__webpack_require__("./display/bounds/index.js"),Canvas:__webpack_require__("./display/canvas/index.js"),Color:__webpack_require__("./display/color/index.js"),Masks:__webpack_require__("./display/mask/index.js")};}),"./display/mask/BitmapMask.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var BitmapMask=new Class({initialize:function BitmapMask(scene,renderable)
        {var renderer=scene.sys.game.renderer;this.renderer=renderer;this.bitmapMask=renderable;this.maskTexture=null;this.mainTexture=null;this.dirty=true;this.mainFramebuffer=null;this.maskFramebuffer=null;this.invertAlpha=false;if(renderer&&renderer.gl)
        {var width=renderer.width;var height=renderer.height;var pot=((width&(width-1))===0&&(height&(height-1))===0);var gl=renderer.gl;var wrap=pot?gl.REPEAT:gl.CLAMP_TO_EDGE;var filter=gl.LINEAR;this.mainTexture=renderer.createTexture2D(0,filter,filter,wrap,wrap,gl.RGBA,null,width,height);this.maskTexture=renderer.createTexture2D(0,filter,filter,wrap,wrap,gl.RGBA,null,width,height);this.mainFramebuffer=renderer.createFramebuffer(width,height,this.mainTexture,false);this.maskFramebuffer=renderer.createFramebuffer(width,height,this.maskTexture,false);renderer.onContextRestored(function(renderer)
        {var width=renderer.width;var height=renderer.height;var pot=((width&(width-1))===0&&(height&(height-1))===0);var gl=renderer.gl;var wrap=pot?gl.REPEAT:gl.CLAMP_TO_EDGE;var filter=gl.LINEAR;this.mainTexture=renderer.createTexture2D(0,filter,filter,wrap,wrap,gl.RGBA,null,width,height);this.maskTexture=renderer.createTexture2D(0,filter,filter,wrap,wrap,gl.RGBA,null,width,height);this.mainFramebuffer=renderer.createFramebuffer(width,height,this.mainTexture,false);this.maskFramebuffer=renderer.createFramebuffer(width,height,this.maskTexture,false);},this);}},setBitmap:function(renderable)
        {this.bitmapMask=renderable;},preRenderWebGL:function(renderer,maskedObject,camera)
        {renderer.pipelines.BitmapMaskPipeline.beginMask(this,maskedObject,camera);},postRenderWebGL:function(renderer)
        {renderer.pipelines.BitmapMaskPipeline.endMask(this);},preRenderCanvas:function()
        {},postRenderCanvas:function()
        {},destroy:function()
        {this.bitmapMask=null;var renderer=this.renderer;if(renderer&&renderer.gl)
        {renderer.deleteTexture(this.mainTexture);renderer.deleteTexture(this.maskTexture);renderer.deleteFramebuffer(this.mainFramebuffer);renderer.deleteFramebuffer(this.maskFramebuffer);}
            this.mainTexture=null;this.maskTexture=null;this.mainFramebuffer=null;this.maskFramebuffer=null;this.renderer=null;}});module.exports=BitmapMask;}),"./display/mask/GeometryMask.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var GeometryMask=new Class({initialize:function GeometryMask(scene,graphicsGeometry)
        {this.geometryMask=graphicsGeometry;},setShape:function(graphicsGeometry)
        {this.geometryMask=graphicsGeometry;},preRenderWebGL:function(renderer,mask,camera)
        {var gl=renderer.gl;var geometryMask=this.geometryMask;renderer.flush();gl.enable(gl.STENCIL_TEST);gl.clear(gl.STENCIL_BUFFER_BIT);gl.colorMask(false,false,false,false);gl.stencilFunc(gl.NOTEQUAL,1,1);gl.stencilOp(gl.REPLACE,gl.REPLACE,gl.REPLACE);geometryMask.renderWebGL(renderer,geometryMask,0.0,camera);renderer.flush();gl.colorMask(true,true,true,true);gl.stencilFunc(gl.EQUAL,1,1);gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP);},postRenderWebGL:function(renderer)
        {var gl=renderer.gl;renderer.flush();gl.disable(gl.STENCIL_TEST);},preRenderCanvas:function(renderer,mask,camera)
        {var geometryMask=this.geometryMask;renderer.currentContext.save();geometryMask.renderCanvas(renderer,geometryMask,0,camera,null,null,true);renderer.currentContext.clip();},postRenderCanvas:function(renderer)
        {renderer.currentContext.restore();},destroy:function()
        {this.geometryMask=null;}});module.exports=GeometryMask;}),"./display/mask/index.js":(function(module,exports,__webpack_require__){module.exports={BitmapMask:__webpack_require__("./display/mask/BitmapMask.js"),GeometryMask:__webpack_require__("./display/mask/GeometryMask.js")};}),"./dom/AddToDOM.js":(function(module,exports){var AddToDOM=function(element,parent,overflowHidden)
    {if(overflowHidden===undefined){overflowHidden=true;}
        var target;if(parent)
    {if(typeof parent==='string')
    {target=document.getElementById(parent);}
    else if(typeof parent==='object'&&parent.nodeType===1)
    {target=parent;}}
    else if(element.parentElement)
    {return element;}
        if(!target)
        {target=document.body;}
        if(overflowHidden&&target.style)
        {target.style.overflow='hidden';}
        target.appendChild(element);return element;};module.exports=AddToDOM;}),"./dom/Calibrate.js":(function(module,exports){var Calibrate=function(coords,cushion)
    {if(cushion===undefined){cushion=0;}
        var output={width:0,height:0,left:0,right:0,top:0,bottom:0};output.width=(output.right=coords.right+cushion)-(output.left=coords.left-cushion);output.height=(output.bottom=coords.bottom+cushion)-(output.top=coords.top-cushion);return output;};module.exports=Calibrate;}),"./dom/ClientHeight.js":(function(module,exports){var ClientHeight=function()
    {return Math.max(window.innerHeight,document.documentElement.clientHeight);};module.exports=ClientHeight;}),"./dom/ClientWidth.js":(function(module,exports){var ClientWidth=function()
    {return Math.max(window.innerWidth,document.documentElement.clientWidth);};module.exports=ClientWidth;}),"./dom/DOMContentLoaded.js":(function(module,exports,__webpack_require__){var OS=__webpack_require__("./device/OS.js");var DOMContentLoaded=function(callback)
    {if(document.readyState==='complete'||document.readyState==='interactive')
    {callback();return;}
        var check=function()
        {document.removeEventListener('deviceready',check,true);document.removeEventListener('DOMContentLoaded',check,true);window.removeEventListener('load',check,true);callback();};if(!document.body)
    {window.setTimeout(check,20);}
    else if(OS.cordova&&!OS.cocoonJS)
    {document.addEventListener('deviceready',check,false);}
    else
    {document.addEventListener('DOMContentLoaded',check,true);window.addEventListener('load',check,true);}};module.exports=DOMContentLoaded;}),"./dom/DocumentBounds.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Rectangle=__webpack_require__("./geom/rectangle/Rectangle.js");var DocumentBounds=new Class({Extends:Rectangle,initialize:function DocumentBounds()
        {Rectangle.call(this);},width:{get:function()
            {var d=document.documentElement;return Math.max(d.clientWidth,d.offsetWidth,d.scrollWidth);}},height:{get:function()
            {var d=document.documentElement;return Math.max(d.clientHeight,d.offsetHeight,d.scrollHeight);}}});module.exports=new DocumentBounds();}),"./dom/GetAspectRatio.js":(function(module,exports,__webpack_require__){var GetBounds=__webpack_require__("./dom/GetBounds.js");var VisualBounds=__webpack_require__("./dom/VisualBounds.js");var GetAspectRatio=function(object)
    {object=(object===null)?VisualBounds:(object.nodeType===1)?GetBounds(object):object;var w=object.width;var h=object.height;if(typeof w==='function')
    {w=w.call(object);}
        if(typeof h==='function')
        {h=h.call(object);}
        return w / h;};module.exports=GetAspectRatio;}),"./dom/GetBounds.js":(function(module,exports,__webpack_require__){var Calibrate=__webpack_require__("./dom/Calibrate.js");var GetBounds=function(element,cushion)
    {if(cushion===undefined){cushion=0;}
        element=(element&&!element.nodeType)?element[0]:element;if(!element||element.nodeType!==1)
    {return false;}
    else
    {return Calibrate(element.getBoundingClientRect(),cushion);}};module.exports=GetBounds;}),"./dom/GetInnerHeight.js":(function(module,exports){var GetInnerHeight=function(iOS)
    {if(!iOS)
    {return window.innerHeight;}
        var axis=Math.abs(window.orientation);var size={w:0,h:0};var ruler=document.createElement('div');ruler.setAttribute('style','position: fixed; height: 100vh; width: 0; top: 0');document.documentElement.appendChild(ruler);size.w=(axis===90)?ruler.offsetHeight:window.innerWidth;size.h=(axis===90)?window.innerWidth:ruler.offsetHeight;document.documentElement.removeChild(ruler);ruler=null;if(Math.abs(window.orientation)!==90)
    {return size.h;}
    else
    {return size.w;}};module.exports=GetInnerHeight;}),"./dom/GetOffset.js":(function(module,exports,__webpack_require__){var Vec2=__webpack_require__("./math/Vector2.js");var VisualBounds=__webpack_require__("./dom/VisualBounds.js");var GetOffset=function(element,point)
    {if(point===undefined){point=new Vec2();}
        var box=element.getBoundingClientRect();var scrollTop=VisualBounds.y;var scrollLeft=VisualBounds.x;var clientTop=document.documentElement.clientTop;var clientLeft=document.documentElement.clientLeft;point.x=box.left+scrollLeft-clientLeft;point.y=box.top+scrollTop-clientTop;return point;};module.exports=GetOffset;}),"./dom/GetScreenOrientation.js":(function(module,exports,__webpack_require__){var CONST=__webpack_require__("./dom/const.js");var GetScreenOrientation=function(width,height)
    {var screen=window.screen;var orientation=(screen)?screen.orientation||screen.mozOrientation||screen.msOrientation:false;if(orientation&&typeof orientation.type==='string')
    {return orientation.type;}
    else if(typeof orientation==='string')
    {return orientation;}
        if(screen)
        {return(screen.height>screen.width)?CONST.PORTRAIT:CONST.LANDSCAPE;}
        else if(typeof window.orientation==='number')
        {return(window.orientation===0||window.orientation===180)?CONST.PORTRAIT:CONST.LANDSCAPE;}
        else if(window.matchMedia)
        {if(window.matchMedia('(orientation: portrait)').matches)
        {return CONST.PORTRAIT;}
        else if(window.matchMedia('(orientation: landscape)').matches)
        {return CONST.LANDSCAPE;}}
        return(height>width)?CONST.PORTRAIT:CONST.LANDSCAPE;};module.exports=GetScreenOrientation;}),"./dom/InLayoutViewport.js":(function(module,exports,__webpack_require__){var GetBounds=__webpack_require__("./dom/GetBounds.js");var LayoutBounds=__webpack_require__("./dom/LayoutBounds.js");var InLayoutViewport=function(element,cushion)
    {var r=GetBounds(element,cushion);return!!r&&r.bottom>=0&&r.right>=0&&r.top<=LayoutBounds.width&&r.left<=LayoutBounds.height;};module.exports=InLayoutViewport;}),"./dom/LayoutBounds.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var ClientHeight=__webpack_require__("./dom/ClientHeight.js");var ClientWidth=__webpack_require__("./dom/ClientWidth.js");var Rectangle=__webpack_require__("./geom/rectangle/Rectangle.js");var LayoutBounds=new Class({Extends:Rectangle,initialize:function LayoutBounds()
        {Rectangle.call(this);},init:function(isDesktop)
        {if(isDesktop)
        {Object.defineProperty(this,'width',{get:ClientWidth});Object.defineProperty(this,'height',{get:ClientHeight});}
        else
        {Object.defineProperty(this,'width',{get:function()
            {var a=document.documentElement.clientWidth;var b=window.innerWidth;return a<b?b:a;}});Object.defineProperty(this,'height',{get:function()
            {var a=document.documentElement.clientHeight;var b=window.innerHeight;return a<b?b:a;}});}}});module.exports=new LayoutBounds();}),"./dom/ParseXML.js":(function(module,exports){var ParseXML=function(data)
    {var xml='';try
    {if(window['DOMParser'])
    {var domparser=new DOMParser();xml=domparser.parseFromString(data,'text/xml');}
    else
    {xml=new ActiveXObject('Microsoft.XMLDOM');xml.loadXML(data);}}
    catch(e)
    {xml=null;}
        if(!xml||!xml.documentElement||xml.getElementsByTagName('parsererror').length)
        {return null;}
        else
        {return xml;}};module.exports=ParseXML;}),"./dom/RemoveFromDOM.js":(function(module,exports){var RemoveFromDOM=function(element)
    {if(element.parentNode)
    {element.parentNode.removeChild(element);}};module.exports=RemoveFromDOM;}),"./dom/RequestAnimationFrame.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var NOOP=__webpack_require__("./utils/NOOP.js");var RequestAnimationFrame=new Class({initialize:function RequestAnimationFrame()
        {this.isRunning=false;this.callback=NOOP;this.tick=0;this.isSetTimeOut=false;this.timeOutID=null;this.lastTime=0;var _this=this;this.step=function step()
        {var timestamp=window.performance.now();_this.lastTime=_this.tick;_this.tick=timestamp;_this.callback(timestamp);_this.timeOutID=window.requestAnimationFrame(step);};this.stepTimeout=function stepTimeout()
        {var d=Date.now();var delay=Math.max(16+_this.lastTime-d,0);_this.lastTime=_this.tick;_this.tick=d;_this.callback(d);_this.timeOutID=window.setTimeout(stepTimeout,delay);};},start:function(callback,forceSetTimeOut)
        {if(this.isRunning)
        {return;}
            this.callback=callback;this.isSetTimeOut=forceSetTimeOut;this.isRunning=true;this.timeOutID=(forceSetTimeOut)?window.setTimeout(this.stepTimeout,0):window.requestAnimationFrame(this.step);},stop:function()
        {this.isRunning=false;if(this.isSetTimeOut)
        {clearTimeout(this.timeOutID);}
        else
        {window.cancelAnimationFrame(this.timeOutID);}},destroy:function()
        {this.stop();this.callback=NOOP;}});module.exports=RequestAnimationFrame;}),"./dom/ScaleManager.js":(function(module,exports,__webpack_require__){var CONST=__webpack_require__("./dom/const.js");var Class=__webpack_require__("./utils/Class.js");var EventEmitter=__webpack_require__("../node_modules/eventemitter3/index.js");var GetInnerHeight=__webpack_require__("./dom/GetInnerHeight.js");var GetScreenOrientation=__webpack_require__("./dom/GetScreenOrientation.js");var NOOP=__webpack_require__("./utils/NOOP.js");var Rectangle=__webpack_require__("./geom/rectangle/Rectangle.js");var Size=__webpack_require__("./structs/Size.js");var Vector2=__webpack_require__("./math/Vector2.js");var ScaleManager=new Class({Extends:EventEmitter,initialize:function ScaleManager(game)
        {EventEmitter.call(this);this.game=game;this.canvas;this.canvasBounds=new Rectangle();this.parent;this.parentIsWindow;this.parentSize=new Size();this.gameSize=new Size();this.baseSize=new Size();this.displaySize=new Size();this.scaleMode=CONST.NONE;this.resolution=1;this.zoom=1;this.displayScale=new Vector2(1,1);this.autoRound=false;this.autoCenter=CONST.NO_CENTER;this.orientation=CONST.LANDSCAPE;this.trackParent=false;this.allowFullScreen=false;this.dirty=false;this.resizeInterval=500;this._lastCheck=0;this._checkOrientation=false;this.listeners={orientationChange:NOOP,windowResize:NOOP,fullScreenChange:NOOP,fullScreenError:NOOP};},preBoot:function()
        {this.parseConfig(this.game.config);this.game.events.once('boot',this.boot,this);},boot:function()
        {this.canvas=this.game.canvas;this.getParentBounds();if(this.scaleMode<5)
        {this.displaySize.setAspectMode(this.scaleMode);}
            if(this.scaleMode>0)
            {this.displaySize.setParent(this.parentSize);}
            this.game.events.on('prestep',this.step,this);this.startListeners();this.refresh();},parseConfig:function(config)
        {this.getParent(config);this.getParentBounds();var width=config.width;var height=config.height;var resolution=config.resolution;var scaleMode=config.scaleMode;var zoom=config.zoom;var autoRound=config.autoRound;if(typeof width==='string')
        {var parentScaleX=parseInt(width,10)/ 100;width=Math.floor(this.parentSize.width*parentScaleX);}
            if(typeof height==='string')
            {var parentScaleY=parseInt(height,10)/ 100;height=Math.floor(this.parentSize.height*parentScaleY);}
            this.resolution=resolution;this.zoom=zoom;this.scaleMode=scaleMode;this.autoRound=autoRound;this.autoCenter=config.autoCenter;this.resizeInterval=config.resizeInterval;if(autoRound)
        {width=Math.floor(width);height=Math.floor(height);}
            this.gameSize.setSize(width,height);this.baseSize.setSize(width*resolution,height*resolution);if(autoRound)
        {this.baseSize.width=Math.floor(this.baseSize.width);this.baseSize.height=Math.floor(this.baseSize.height);}
            if(config.minWidth>0)
            {this.displaySize.setMin(config.minWidth*zoom,config.minHeight*zoom);}
            if(config.maxWidth>0)
            {this.displaySize.setMax(config.maxWidth*zoom,config.maxHeight*zoom);}
            this.displaySize.setSize(width,height);this.orientation=GetScreenOrientation(width,height);},getParent:function(config)
        {var parent=config.parent;var canExpandParent=config.expandParent;var target;if(parent!=='')
        {if(typeof parent==='string')
        {target=document.getElementById(parent);}
        else if(parent&&parent.nodeType===1)
        {target=parent;}}
            if(!target)
            {this.parent=document.body;this.parentIsWindow=true;}
            else
            {this.parent=target;this.parentIsWindow=false;}
            if(canExpandParent)
            {if(this.parentIsWindow)
            {document.getElementsByTagName('html')[0].style.height='100%';}
            else
            {this.parent.style.height='100%';}}},getParentBounds:function()
        {var DOMRect=this.parent.getBoundingClientRect();if(this.parentIsWindow&&this.game.device.os.iOS)
        {DOMRect.height=GetInnerHeight(true);}
            var parentSize=this.parentSize;var resolution=this.resolution;var newWidth=DOMRect.width*resolution;var newHeight=DOMRect.height*resolution;if(parentSize.width!==newWidth||parentSize.height!==newHeight)
        {this.parentSize.setSize(newWidth,newHeight);return true;}
        else
        {return false;}},lockOrientation:function(orientation)
        {var lock=screen.lockOrientation||screen.mozLockOrientation||screen.msLockOrientation;if(lock)
        {return lock(orientation);}
            return false;},resize:function(width,height)
        {if(this.autoRound)
        {width=Math.floor(width);height=Math.floor(height);}
            this.gameSize.setSize(width,height);this.baseSize.setSize(width*this.resolution,height*this.resolution);this.refresh();},setZoom:function(value)
        {if(value!==this.zoom)
        {this.zoom=value;this.refresh();}
            return this;},refresh:function()
        {this.updateScale();this.updateBounds();if(this._checkOrientation)
        {this._checkOrientation=false;var newOrientation=GetScreenOrientation(this.width,this.height);if(newOrientation!==this.orientation)
        {this.orientation=newOrientation;this.emit('orientationchange',newOrientation);}}
            this.emit('resize',this.gameSize,this.baseSize,this.displaySize,this.resolution);},updateScale:function()
        {var style=this.canvas.style;var width=this.gameSize.width;var height=this.gameSize.height;var styleWidth;var styleHeight;var zoom=this.zoom;var autoRound=this.autoRound;var resolution=this.resolution;if(this.scaleMode===0)
        {this.displaySize.setSize((width*zoom)*resolution,(height*zoom)*resolution);styleWidth=this.displaySize.width / resolution;styleHeight=this.displaySize.height / resolution;if(autoRound)
        {styleWidth=Math.floor(styleWidth);styleHeight=Math.floor(styleHeight);}
            style.width=styleWidth+'px';style.height=styleHeight+'px';}
        else if(this.scaleMode===5)
        {this.displaySize.setSize(this.parentSize.width,this.parentSize.height);this.gameSize.setSize(this.displaySize.width,this.displaySize.height);this.baseSize.setSize(this.displaySize.width*resolution,this.displaySize.height*resolution);styleWidth=this.displaySize.width / resolution;styleHeight=this.displaySize.height / resolution;if(autoRound)
        {styleWidth=Math.floor(styleWidth);styleHeight=Math.floor(styleHeight);}
            this.canvas.width=styleWidth;this.canvas.height=styleHeight;}
        else
        {this.displaySize.setSize(this.parentSize.width,this.parentSize.height);styleWidth=this.displaySize.width / resolution;styleHeight=this.displaySize.height / resolution;if(autoRound)
        {styleWidth=Math.floor(styleWidth);styleHeight=Math.floor(styleHeight);}
            style.width=styleWidth+'px';style.height=styleHeight+'px';}
            var offsetX=Math.floor((this.parentSize.width-styleWidth)/ 2);var offsetY=Math.floor((this.parentSize.height-styleHeight)/ 2);if(this.autoCenter===1)
        {style.marginLeft=offsetX+'px';style.marginTop=offsetY+'px';}
        else if(this.autoCenter===2)
        {style.marginLeft=offsetX+'px';}
        else if(this.autoCenter===3)
        {style.marginTop=offsetY+'px';}
            if(!this.parentIsWindow)
            {this.getParentBounds();}},updateBounds:function()
        {var bounds=this.canvasBounds;var clientRect=this.canvas.getBoundingClientRect();bounds.x=clientRect.left+window.pageXOffset-document.documentElement.clientLeft;bounds.y=clientRect.top+window.pageYOffset-document.documentElement.clientTop;bounds.width=clientRect.width;bounds.height=clientRect.height;this.displayScale.set(this.baseSize.width / bounds.width,this.baseSize.height / bounds.height);},transformX:function(pageX)
        {return(pageX-this.canvasBounds.left)*this.displayScale.x;},transformY:function(pageY)
        {return(pageY-this.canvasBounds.top)*this.displayScale.y;},startListeners:function()
        {var _this=this;var listeners=this.listeners;listeners.orientationChange=function()
        {_this._checkOrientation=true;_this.dirty=true;};listeners.windowResize=function()
        {_this.dirty=true;};window.addEventListener('orientationchange',listeners.orientationChange,false);window.addEventListener('resize',listeners.windowResize,false);if(this.allowFullScreen)
        {listeners.fullScreenChange=function(event)
        {return _this.onFullScreenChange(event);};listeners.fullScreenError=function(event)
        {return _this.onFullScreenError(event);};var vendors=['webkit','moz',''];vendors.forEach(function(prefix)
        {document.addEventListener(prefix+'fullscreenchange',listeners.fullScreenChange,false);document.addEventListener(prefix+'fullscreenerror',listeners.fullScreenError,false);});document.addEventListener('MSFullscreenChange',listeners.fullScreenChange,false);document.addEventListener('MSFullscreenError',listeners.fullScreenError,false);}},onFullScreenChange:function()
        {},onFullScreenError:function()
        {},step:function(time,delta)
        {this._lastCheck+=delta;if(this.dirty||this._lastCheck>this.resizeInterval)
        {if(this.getParentBounds())
        {this.refresh();}
            this.dirty=false;this._lastCheck=0;}},stopListeners:function()
        {var listeners=this.listeners;window.removeEventListener('orientationchange',listeners.orientationChange,false);window.removeEventListener('resize',listeners.windowResize,false);var vendors=['webkit','moz',''];vendors.forEach(function(prefix)
        {document.removeEventListener(prefix+'fullscreenchange',listeners.fullScreenChange,false);document.removeEventListener(prefix+'fullscreenerror',listeners.fullScreenError,false);});document.removeEventListener('MSFullscreenChange',listeners.fullScreenChange,false);document.removeEventListener('MSFullscreenError',listeners.fullScreenError,false);},destroy:function()
        {this.removeAllListeners();this.stopListeners();},isFullScreen:{get:function()
            {return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);}},width:{get:function()
            {return this.gameSize.width;}},height:{get:function()
            {return this.gameSize.height;}},isPortrait:{get:function()
            {return(this.orientation===CONST.PORTRAIT);}},isLandscape:{get:function()
            {return(this.orientation===CONST.LANDSCAPE);}},isGamePortrait:{get:function()
            {return(this.height>this.width);}},isGameLandscape:{get:function()
            {return(this.width>this.height);}}});module.exports=ScaleManager;}),"./dom/VisualBounds.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var ClientHeight=__webpack_require__("./dom/ClientHeight.js");var ClientWidth=__webpack_require__("./dom/ClientWidth.js");var Rectangle=__webpack_require__("./geom/rectangle/Rectangle.js");var ScrollX=(window&&('pageXOffset'in window))?function(){return window.pageXOffset;}:function(){return document.documentElement.scrollLeft;};var ScrollY=(window&&('pageYOffset'in window))?function(){return window.pageYOffset;}:function(){return document.documentElement.scrollTop;};var VisualBounds=new Class({Extends:Rectangle,initialize:function VisualBounds()
        {Rectangle.call(this);},x:{get:ScrollX},y:{get:ScrollY},init:function(isDesktop)
        {if(isDesktop)
        {Object.defineProperty(this,'width',{get:ClientWidth});Object.defineProperty(this,'height',{get:ClientHeight});}
        else
        {Object.defineProperty(this,'width',{get:function()
            {return window.innerWidth;}});Object.defineProperty(this,'height',{get:function()
            {return window.innerHeight;}});}}});module.exports=new VisualBounds();}),"./dom/const.js":(function(module,exports){module.exports={NONE:0,WIDTH_CONTROLS_HEIGHT:1,HEIGHT_CONTROLS_WIDTH:2,FIT:3,ENVELOP:4,RESIZE:5,NO_CENTER:0,CENTER_BOTH:1,CENTER_HORIZONTALLY:2,CENTER_VERTICALLY:3,LANDSCAPE:'landscape-primary',PORTRAIT:'portrait-primary'};}),"./dom/index.js":(function(module,exports,__webpack_require__){var Extend=__webpack_require__("./utils/object/Extend.js");var ScaleModes=__webpack_require__("./dom/const.js");var Dom={AddToDOM:__webpack_require__("./dom/AddToDOM.js"),Calibrate:__webpack_require__("./dom/Calibrate.js"),ClientHeight:__webpack_require__("./dom/ClientHeight.js"),ClientWidth:__webpack_require__("./dom/ClientWidth.js"),DocumentBounds:__webpack_require__("./dom/DocumentBounds.js"),DOMContentLoaded:__webpack_require__("./dom/DOMContentLoaded.js"),GetAspectRatio:__webpack_require__("./dom/GetAspectRatio.js"),GetBounds:__webpack_require__("./dom/GetBounds.js"),GetOffset:__webpack_require__("./dom/GetOffset.js"),GetScreenOrientation:__webpack_require__("./dom/GetScreenOrientation.js"),InLayoutViewport:__webpack_require__("./dom/InLayoutViewport.js"),ParseXML:__webpack_require__("./dom/ParseXML.js"),RemoveFromDOM:__webpack_require__("./dom/RemoveFromDOM.js"),RequestAnimationFrame:__webpack_require__("./dom/RequestAnimationFrame.js"),ScaleManager:__webpack_require__("./dom/ScaleManager.js"),VisualBounds:__webpack_require__("./dom/VisualBounds.js"),ScaleModes:ScaleModes};Dom=Extend(false,Dom,ScaleModes);module.exports=Dom;}),"./events/EventEmitter.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var EE=__webpack_require__("../node_modules/eventemitter3/index.js");var PluginCache=__webpack_require__("./plugins/PluginCache.js");var EventEmitter=new Class({Extends:EE,initialize:function EventEmitter()
        {EE.call(this);},shutdown:function()
        {this.removeAllListeners();},destroy:function()
        {this.removeAllListeners();}});PluginCache.register('EventEmitter',EventEmitter,'events');module.exports=EventEmitter;}),"./events/index.js":(function(module,exports,__webpack_require__){module.exports={EventEmitter:__webpack_require__("./events/EventEmitter.js")};}),"./gameobjects/BuildGameObject.js":(function(module,exports,__webpack_require__){var BlendModes=__webpack_require__("./renderer/BlendModes.js");var GetAdvancedValue=__webpack_require__("./utils/object/GetAdvancedValue.js");var ScaleModes=__webpack_require__("./renderer/ScaleModes.js");var BuildGameObject=function(scene,gameObject,config)
    {gameObject.x=GetAdvancedValue(config,'x',0);gameObject.y=GetAdvancedValue(config,'y',0);gameObject.depth=GetAdvancedValue(config,'depth',0);gameObject.flipX=GetAdvancedValue(config,'flipX',false);gameObject.flipY=GetAdvancedValue(config,'flipY',false);var scale=GetAdvancedValue(config,'scale',null);if(typeof scale==='number')
    {gameObject.setScale(scale);}
    else if(scale!==null)
    {gameObject.scaleX=GetAdvancedValue(scale,'x',1);gameObject.scaleY=GetAdvancedValue(scale,'y',1);}
        var scrollFactor=GetAdvancedValue(config,'scrollFactor',null);if(typeof scrollFactor==='number')
    {gameObject.setScrollFactor(scrollFactor);}
    else if(scrollFactor!==null)
    {gameObject.scrollFactorX=GetAdvancedValue(scrollFactor,'x',1);gameObject.scrollFactorY=GetAdvancedValue(scrollFactor,'y',1);}
        gameObject.rotation=GetAdvancedValue(config,'rotation',0);var angle=GetAdvancedValue(config,'angle',null);if(angle!==null)
    {gameObject.angle=angle;}
        gameObject.alpha=GetAdvancedValue(config,'alpha',1);var origin=GetAdvancedValue(config,'origin',null);if(typeof origin==='number')
    {gameObject.setOrigin(origin);}
    else if(origin!==null)
    {var ox=GetAdvancedValue(origin,'x',0.5);var oy=GetAdvancedValue(origin,'y',0.5);gameObject.setOrigin(ox,oy);}
        gameObject.scaleMode=GetAdvancedValue(config,'scaleMode',ScaleModes.DEFAULT);gameObject.blendMode=GetAdvancedValue(config,'blendMode',BlendModes.NORMAL);gameObject.visible=GetAdvancedValue(config,'visible',true);var add=GetAdvancedValue(config,'add',true);if(add)
    {scene.sys.displayList.add(gameObject);}
        if(gameObject.preUpdate)
        {scene.sys.updateList.add(gameObject);}
        return gameObject;};module.exports=BuildGameObject;}),"./gameobjects/BuildGameObjectAnimation.js":(function(module,exports,__webpack_require__){var GetAdvancedValue=__webpack_require__("./utils/object/GetAdvancedValue.js");var BuildGameObjectAnimation=function(sprite,config)
    {var animConfig=GetAdvancedValue(config,'anims',null);if(animConfig===null)
    {return sprite;}
        if(typeof animConfig==='string')
        {sprite.anims.play(animConfig);}
        else if(typeof animConfig==='object')
        {var anims=sprite.anims;var key=GetAdvancedValue(animConfig,'key',undefined);var startFrame=GetAdvancedValue(animConfig,'startFrame',undefined);var delay=GetAdvancedValue(animConfig,'delay',0);var repeat=GetAdvancedValue(animConfig,'repeat',0);var repeatDelay=GetAdvancedValue(animConfig,'repeatDelay',0);var yoyo=GetAdvancedValue(animConfig,'yoyo',false);var play=GetAdvancedValue(animConfig,'play',false);var delayedPlay=GetAdvancedValue(animConfig,'delayedPlay',0);anims.setDelay(delay);anims.setRepeat(repeat);anims.setRepeatDelay(repeatDelay);anims.setYoyo(yoyo);if(play)
        {anims.play(key,startFrame);}
        else if(delayedPlay>0)
        {anims.delayedPlay(delayedPlay,key,startFrame);}
        else
        {anims.load(key);}}
        return sprite;};module.exports=BuildGameObjectAnimation;}),"./gameobjects/DisplayList.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var List=__webpack_require__("./structs/List.js");var PluginCache=__webpack_require__("./plugins/PluginCache.js");var StableSort=__webpack_require__("./utils/array/StableSort.js");var DisplayList=new Class({Extends:List,initialize:function DisplayList(scene)
        {List.call(this,scene);this.sortChildrenFlag=false;this.scene=scene;this.systems=scene.sys;scene.sys.events.once('boot',this.boot,this);scene.sys.events.on('start',this.start,this);},boot:function()
        {this.systems.events.once('destroy',this.destroy,this);},start:function()
        {this.systems.events.once('shutdown',this.shutdown,this);},queueDepthSort:function()
        {this.sortChildrenFlag=true;},depthSort:function()
        {if(this.sortChildrenFlag)
        {StableSort.inplace(this.list,this.sortByDepth);this.sortChildrenFlag=false;}},sortByDepth:function(childA,childB)
        {return childA._depth-childB._depth;},getChildren:function()
        {return this.list;},shutdown:function()
        {var i=this.list.length;while(i--)
        {this.list[i].destroy(true);}
            this.list.length=0;this.systems.events.off('shutdown',this.shutdown,this);},destroy:function()
        {this.shutdown();this.scene.sys.events.off('start',this.start,this);this.scene=null;this.systems=null;}});PluginCache.register('DisplayList',DisplayList,'displayList');module.exports=DisplayList;}),"./gameobjects/GameObject.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var ComponentsToJSON=__webpack_require__("./gameobjects/components/ToJSON.js");var DataManager=__webpack_require__("./data/DataManager.js");var EventEmitter=__webpack_require__("../node_modules/eventemitter3/index.js");var GameObject=new Class({Extends:EventEmitter,initialize:function GameObject(scene,type)
        {EventEmitter.call(this);this.scene=scene;this.type=type;this.state=0;this.parentContainer=null;this.name='';this.active=true;this.tabIndex=-1;this.data=null;this.renderFlags=15;this.cameraFilter=0;this.input=null;this.body=null;this.ignoreDestroy=false;scene.sys.queueDepthSort();},setActive:function(value)
        {this.active=value;return this;},setName:function(value)
        {this.name=value;return this;},setState:function(value)
        {this.state=value;return this;},setDataEnabled:function()
        {if(!this.data)
        {this.data=new DataManager(this);}
            return this;},setData:function(key,value)
        {if(!this.data)
        {this.data=new DataManager(this);}
            this.data.set(key,value);return this;},getData:function(key)
        {if(!this.data)
        {this.data=new DataManager(this);}
            return this.data.get(key);},setInteractive:function(shape,callback,dropZone)
        {this.scene.sys.input.enable(this,shape,callback,dropZone);return this;},disableInteractive:function()
        {if(this.input)
        {this.input.enabled=false;}
            return this;},removeInteractive:function()
        {this.scene.sys.input.clear(this);this.input=undefined;return this;},update:function()
        {},toJSON:function()
        {return ComponentsToJSON(this);},willRender:function(camera)
        {return!(GameObject.RENDER_MASK!==this.renderFlags||(this.cameraFilter!==0&&(this.cameraFilter&camera.id)));},getIndexList:function()
        {var child=this;var parent=this.parentContainer;var indexes=[];while(parent)
        {indexes.unshift(parent.getIndex(child));child=parent;if(!parent.parentContainer)
        {break;}
        else
        {parent=parent.parentContainer;}}
            indexes.unshift(this.scene.sys.displayList.getIndex(child));return indexes;},destroy:function(fromScene)
        {if(fromScene===undefined){fromScene=false;}
            if(!this.scene||this.ignoreDestroy)
            {return;}
            if(this.preDestroy)
            {this.preDestroy.call(this);}
            this.emit('destroy',this);var sys=this.scene.sys;if(!fromScene)
        {sys.displayList.remove(this);sys.updateList.remove(this);}
            if(this.input)
            {sys.input.clear(this);this.input=undefined;}
            if(this.data)
            {this.data.destroy();this.data=undefined;}
            if(this.body)
            {this.body.destroy();this.body=undefined;}
            if(!fromScene)
            {sys.queueDepthSort();}
            this.active=false;this.visible=false;this.scene=undefined;this.parentContainer=undefined;this.removeAllListeners();}});GameObject.RENDER_MASK=15;module.exports=GameObject;}),"./gameobjects/GameObjectCreator.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var PluginCache=__webpack_require__("./plugins/PluginCache.js");var GameObjectCreator=new Class({initialize:function GameObjectCreator(scene)
        {this.scene=scene;this.systems=scene.sys;this.displayList;this.updateList;scene.sys.events.once('boot',this.boot,this);scene.sys.events.on('start',this.start,this);},boot:function()
        {this.displayList=this.systems.displayList;this.updateList=this.systems.updateList;this.systems.events.once('destroy',this.destroy,this);},start:function()
        {this.systems.events.once('shutdown',this.shutdown,this);},shutdown:function()
        {this.systems.events.off('shutdown',this.shutdown,this);},destroy:function()
        {this.shutdown();this.scene.sys.events.off('start',this.start,this);this.scene=null;this.systems=null;this.displayList=null;this.updateList=null;}});GameObjectCreator.register=function(factoryType,factoryFunction)
    {if(!GameObjectCreator.prototype.hasOwnProperty(factoryType))
    {GameObjectCreator.prototype[factoryType]=factoryFunction;}};PluginCache.register('GameObjectCreator',GameObjectCreator,'make');module.exports=GameObjectCreator;}),"./gameobjects/GameObjectFactory.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var PluginCache=__webpack_require__("./plugins/PluginCache.js");var GameObjectFactory=new Class({initialize:function GameObjectFactory(scene)
        {this.scene=scene;this.systems=scene.sys;this.displayList;this.updateList;scene.sys.events.once('boot',this.boot,this);scene.sys.events.on('start',this.start,this);},boot:function()
        {this.displayList=this.systems.displayList;this.updateList=this.systems.updateList;this.systems.events.once('destroy',this.destroy,this);},start:function()
        {this.systems.events.once('shutdown',this.shutdown,this);},existing:function(child)
        {if(child.renderCanvas||child.renderWebGL)
        {this.displayList.add(child);}
            if(child.preUpdate)
            {this.updateList.add(child);}
            return child;},shutdown:function()
        {this.systems.events.off('shutdown',this.shutdown,this);},destroy:function()
        {this.shutdown();this.scene.sys.events.off('start',this.start,this);this.scene=null;this.systems=null;this.displayList=null;this.updateList=null;}});GameObjectFactory.register=function(factoryType,factoryFunction)
    {if(!GameObjectFactory.prototype.hasOwnProperty(factoryType))
    {GameObjectFactory.prototype[factoryType]=factoryFunction;}};PluginCache.register('GameObjectFactory',GameObjectFactory,'add');module.exports=GameObjectFactory;}),"./gameobjects/UpdateList.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var PluginCache=__webpack_require__("./plugins/PluginCache.js");var UpdateList=new Class({initialize:function UpdateList(scene)
        {this.scene=scene;this.systems=scene.sys;this._list=[];this._pendingInsertion=[];this._pendingRemoval=[];scene.sys.events.once('boot',this.boot,this);scene.sys.events.on('start',this.start,this);},boot:function()
        {this.systems.events.once('destroy',this.destroy,this);},start:function()
        {var eventEmitter=this.systems.events;eventEmitter.on('preupdate',this.preUpdate,this);eventEmitter.on('update',this.update,this);eventEmitter.once('shutdown',this.shutdown,this);},add:function(child)
        {if(this._list.indexOf(child)===-1&&this._pendingInsertion.indexOf(child)===-1)
        {this._pendingInsertion.push(child);}
            return child;},preUpdate:function()
        {var toRemove=this._pendingRemoval.length;var toInsert=this._pendingInsertion.length;if(toRemove===0&&toInsert===0)
        {return;}
            var i;var gameObject;for(i=0;i<toRemove;i++)
        {gameObject=this._pendingRemoval[i];var index=this._list.indexOf(gameObject);if(index>-1)
        {this._list.splice(index,1);}}
            this._list=this._list.concat(this._pendingInsertion.splice(0));this._pendingRemoval.length=0;this._pendingInsertion.length=0;},update:function(time,delta)
        {for(var i=0;i<this._list.length;i++)
        {var gameObject=this._list[i];if(gameObject.active)
        {gameObject.preUpdate.call(gameObject,time,delta);}}},remove:function(child)
        {var index=this._list.indexOf(child);if(index!==-1)
        {this._list.splice(index,1);}
            return child;},removeAll:function()
        {var i=this._list.length;while(i--)
        {this.remove(this._list[i]);}
            return this;},shutdown:function()
        {var i=this._list.length;while(i--)
        {this._list[i].destroy(true);}
            i=this._pendingRemoval.length;while(i--)
        {this._pendingRemoval[i].destroy(true);}
            i=this._pendingInsertion.length;while(i--)
        {this._pendingInsertion[i].destroy(true);}
            this._list.length=0;this._pendingRemoval.length=0;this._pendingInsertion.length=0;var eventEmitter=this.systems.events;eventEmitter.off('preupdate',this.preUpdate,this);eventEmitter.off('update',this.update,this);eventEmitter.off('shutdown',this.shutdown,this);},destroy:function()
        {this.shutdown();this.scene.sys.events.off('start',this.start,this);this.scene=null;this.systems=null;},length:{get:function()
            {return this._list.length;}}});PluginCache.register('UpdateList',UpdateList,'updateList');module.exports=UpdateList;}),"./gameobjects/bitmaptext/GetBitmapTextSize.js":(function(module,exports){var GetBitmapTextSize=function(src,round,out)
    {if(out===undefined)
    {out={local:{x:0,y:0,width:0,height:0},global:{x:0,y:0,width:0,height:0},lines:{shortest:0,longest:0,lengths:null}};}
        var text=src.text;var textLength=text.length;var bx=Number.MAX_VALUE;var by=Number.MAX_VALUE;var bw=0;var bh=0;var chars=src.fontData.chars;var lineHeight=src.fontData.lineHeight;var letterSpacing=src.letterSpacing;var xAdvance=0;var yAdvance=0;var charCode=0;var glyph=null;var x=0;var y=0;var scale=(src.fontSize / src.fontData.size);var sx=scale*src.scaleX;var sy=scale*src.scaleY;var lastGlyph=null;var lastCharCode=0;var lineWidths=[];var shortestLine=Number.MAX_VALUE;var longestLine=0;var currentLine=0;var currentLineWidth=0;for(var i=0;i<textLength;i++)
    {charCode=text.charCodeAt(i);if(charCode===10)
    {xAdvance=0;yAdvance+=lineHeight;lastGlyph=null;lineWidths[currentLine]=currentLineWidth;if(currentLineWidth>longestLine)
    {longestLine=currentLineWidth;}
        if(currentLineWidth<shortestLine)
        {shortestLine=currentLineWidth;}
        currentLine++;currentLineWidth=0;continue;}
        glyph=chars[charCode];if(!glyph)
    {continue;}
        x=xAdvance;y=yAdvance;if(lastGlyph!==null)
    {var kerningOffset=glyph.kerning[lastCharCode];x+=(kerningOffset!==undefined)?kerningOffset:0;}
        if(bx>x)
        {bx=x;}
        if(by>y)
        {by=y;}
        var gw=x+glyph.xAdvance;var gh=y+lineHeight;if(bw<gw)
    {bw=gw;}
        if(bh<gh)
        {bh=gh;}
        xAdvance+=glyph.xAdvance+letterSpacing;lastGlyph=glyph;lastCharCode=charCode;currentLineWidth=gw*scale;}
        lineWidths[currentLine]=currentLineWidth;if(currentLineWidth>longestLine)
    {longestLine=currentLineWidth;}
        if(currentLineWidth<shortestLine)
        {shortestLine=currentLineWidth;}
        var local=out.local;var global=out.global;var lines=out.lines;local.x=bx*scale;local.y=by*scale;local.width=bw*scale;local.height=bh*scale;global.x=(src.x-src.displayOriginX)+(bx*sx);global.y=(src.y-src.displayOriginY)+(by*sy);global.width=bw*sx;global.height=bh*sy;lines.shortest=shortestLine;lines.longest=longestLine;lines.lengths=lineWidths;if(round)
    {local.x=Math.round(local.x);local.y=Math.round(local.y);local.width=Math.round(local.width);local.height=Math.round(local.height);global.x=Math.round(global.x);global.y=Math.round(global.y);global.width=Math.round(global.width);global.height=Math.round(global.height);lines.shortest=Math.round(shortestLine);lines.longest=Math.round(longestLine);}
        return out;};module.exports=GetBitmapTextSize;}),"./gameobjects/bitmaptext/ParseFromAtlas.js":(function(module,exports,__webpack_require__){var ParseXMLBitmapFont=__webpack_require__("./gameobjects/bitmaptext/ParseXMLBitmapFont.js");var ParseFromAtlas=function(scene,fontName,textureKey,frameKey,xmlKey,xSpacing,ySpacing)
    {var frame=scene.sys.textures.getFrame(textureKey,frameKey);var xml=scene.sys.cache.xml.get(xmlKey);if(frame&&xml)
    {var data=ParseXMLBitmapFont(xml,xSpacing,ySpacing,frame);scene.sys.cache.bitmapFont.add(fontName,{data:data,texture:textureKey,frame:frameKey});return true;}
    else
    {return false;}};module.exports=ParseFromAtlas;}),"./gameobjects/bitmaptext/ParseRetroFont.js":(function(module,exports,__webpack_require__){var GetValue=__webpack_require__("./utils/object/GetValue.js");var ParseRetroFont=function(scene,config)
    {var w=config.width;var h=config.height;var cx=Math.floor(w / 2);var cy=Math.floor(h / 2);var letters=GetValue(config,'chars','');if(letters==='')
    {return;}
        var key=GetValue(config,'image','');var offsetX=GetValue(config,'offset.x',0);var offsetY=GetValue(config,'offset.y',0);var spacingX=GetValue(config,'spacing.x',0);var spacingY=GetValue(config,'spacing.y',0);var lineSpacing=GetValue(config,'lineSpacing',0);var charsPerRow=GetValue(config,'charsPerRow',null);if(charsPerRow===null)
    {charsPerRow=scene.sys.textures.getFrame(key).width / w;if(charsPerRow>letters.length)
    {charsPerRow=letters.length;}}
        var x=offsetX;var y=offsetY;var data={retroFont:true,font:key,size:w,lineHeight:h+lineSpacing,chars:{}};var r=0;for(var i=0;i<letters.length;i++)
    {var charCode=letters.charCodeAt(i);data.chars[charCode]={x:x,y:y,width:w,height:h,centerX:cx,centerY:cy,xOffset:0,yOffset:0,xAdvance:w,data:{},kerning:{}};r++;if(r===charsPerRow)
    {r=0;x=offsetX;y+=h+spacingY;}
    else
    {x+=w+spacingX;}}
        var entry={data:data,frame:null,texture:key};return entry;};module.exports=ParseRetroFont;}),"./gameobjects/bitmaptext/ParseXMLBitmapFont.js":(function(module,exports){function getValue(node,attribute)
    {return parseInt(node.getAttribute(attribute),10);}
        var ParseXMLBitmapFont=function(xml,xSpacing,ySpacing,frame)
        {if(xSpacing===undefined){xSpacing=0;}
            if(ySpacing===undefined){ySpacing=0;}
            var data={};var info=xml.getElementsByTagName('info')[0];var common=xml.getElementsByTagName('common')[0];data.font=info.getAttribute('face');data.size=getValue(info,'size');data.lineHeight=getValue(common,'lineHeight')+ySpacing;data.chars={};var letters=xml.getElementsByTagName('char');var adjustForTrim=(frame!==undefined&&frame.trimmed);if(adjustForTrim)
        {var top=frame.height;var left=frame.width;}
            for(var i=0;i<letters.length;i++)
            {var node=letters[i];var charCode=getValue(node,'id');var gx=getValue(node,'x');var gy=getValue(node,'y');var gw=getValue(node,'width');var gh=getValue(node,'height');if(adjustForTrim)
            {if(gx<left)
            {left=gx;}
                if(gy<top)
                {top=gy;}}
                data.chars[charCode]={x:gx,y:gy,width:gw,height:gh,centerX:Math.floor(gw / 2),centerY:Math.floor(gh / 2),xOffset:getValue(node,'xoffset'),yOffset:getValue(node,'yoffset'),xAdvance:getValue(node,'xadvance')+xSpacing,data:{},kerning:{}};}
            if(adjustForTrim&&top!==0&&left!==0)
            {for(var code in data.chars)
            {var glyph=data.chars[code];glyph.x-=frame.x;glyph.y-=frame.y;}}
            var kernings=xml.getElementsByTagName('kerning');for(i=0;i<kernings.length;i++)
        {var kern=kernings[i];var first=getValue(kern,'first');var second=getValue(kern,'second');var amount=getValue(kern,'amount');data.chars[second].kerning[first]=amount;}
            return data;};module.exports=ParseXMLBitmapFont;}),"./gameobjects/bitmaptext/RetroFont.js":(function(module,exports,__webpack_require__){var RETRO_FONT_CONST=__webpack_require__("./gameobjects/bitmaptext/const.js");var Extend=__webpack_require__("./utils/object/Extend.js");var RetroFont={Parse:__webpack_require__("./gameobjects/bitmaptext/ParseRetroFont.js")};RetroFont=Extend(false,RetroFont,RETRO_FONT_CONST);module.exports=RetroFont;}),"./gameobjects/bitmaptext/const.js":(function(module,exports){var RETRO_FONT_CONST={TEXT_SET1:' !"#$%&\'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~',TEXT_SET2:' !"#$%&\'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ',TEXT_SET3:'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ',TEXT_SET4:'ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789',TEXT_SET5:'ABCDEFGHIJKLMNOPQRSTUVWXYZ.,/() \'!?-*:0123456789',TEXT_SET6:'ABCDEFGHIJKLMNOPQRSTUVWXYZ!?:;0123456789"(),-.\' ',TEXT_SET7:'AGMSY+:4BHNTZ!;5CIOU.?06DJPV,(17EKQW")28FLRX-\'39',TEXT_SET8:'0123456789 .ABCDEFGHIJKLMNOPQRSTUVWXYZ',TEXT_SET9:'ABCDEFGHIJKLMNOPQRSTUVWXYZ()-0123456789.:,\'"?!',TEXT_SET10:'ABCDEFGHIJKLMNOPQRSTUVWXYZ',TEXT_SET11:'ABCDEFGHIJKLMNOPQRSTUVWXYZ.,"-+!?()\':;0123456789'};module.exports=RETRO_FONT_CONST;}),"./gameobjects/bitmaptext/dynamic/DynamicBitmapText.js":(function(module,exports,__webpack_require__){var BitmapText=__webpack_require__("./gameobjects/bitmaptext/static/BitmapText.js");var Class=__webpack_require__("./utils/Class.js");var Render=__webpack_require__("./gameobjects/bitmaptext/dynamic/DynamicBitmapTextRender.js");var DynamicBitmapText=new Class({Extends:BitmapText,Mixins:[Render],initialize:function DynamicBitmapText(scene,x,y,font,text,size,align)
        {BitmapText.call(this,scene,x,y,font,text,size,align);this.type='DynamicBitmapText';this.scrollX=0;this.scrollY=0;this.cropWidth=0;this.cropHeight=0;this.displayCallback;this.callbackData={parent:this,color:0,tint:{topLeft:0,topRight:0,bottomLeft:0,bottomRight:0},index:0,charCode:0,x:0,y:0,scale:0,rotation:0,data:0};},setSize:function(width,height)
        {this.cropWidth=width;this.cropHeight=height;return this;},setDisplayCallback:function(callback)
        {this.displayCallback=callback;return this;},setScrollX:function(value)
        {this.scrollX=value;return this;},setScrollY:function(value)
        {this.scrollY=value;return this;}});module.exports=DynamicBitmapText;}),"./gameobjects/bitmaptext/dynamic/DynamicBitmapTextCanvasRenderer.js":(function(module,exports,__webpack_require__){var SetTransform=__webpack_require__("./renderer/canvas/utils/SetTransform.js");var DynamicBitmapTextCanvasRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var text=src.text;var textLength=text.length;var ctx=renderer.currentContext;if(textLength===0||!SetTransform(renderer,ctx,src,camera,parentMatrix))
    {return;}
        var textureFrame=src.frame;var displayCallback=src.displayCallback;var callbackData=src.callbackData;var cameraScrollX=camera.scrollX*src.scrollFactorX;var cameraScrollY=camera.scrollY*src.scrollFactorY;var chars=src.fontData.chars;var lineHeight=src.fontData.lineHeight;var xAdvance=0;var yAdvance=0;var indexCount=0;var charCode=0;var glyph=null;var glyphX=0;var glyphY=0;var glyphW=0;var glyphH=0;var x=0;var y=0;var lastGlyph=null;var lastCharCode=0;var image=src.frame.source.image;var textureX=textureFrame.cutX;var textureY=textureFrame.cutY;var rotation=0;var scale=(src.fontSize / src.fontData.size);if(src.cropWidth>0&&src.cropHeight>0)
    {ctx.beginPath();ctx.rect(0,0,src.cropWidth,src.cropHeight);ctx.clip();}
        for(var index=0;index<textLength;++index)
        {scale=(src.fontSize / src.fontData.size);rotation=0;charCode=text.charCodeAt(index);if(charCode===10)
        {xAdvance=0;indexCount=0;yAdvance+=lineHeight;lastGlyph=null;continue;}
            glyph=chars[charCode];if(!glyph)
        {continue;}
            glyphX=textureX+glyph.x;glyphY=textureY+glyph.y;glyphW=glyph.width;glyphH=glyph.height;x=(indexCount+glyph.xOffset+xAdvance)-src.scrollX;y=(glyph.yOffset+yAdvance)-src.scrollY;if(lastGlyph!==null)
        {var kerningOffset=glyph.kerning[lastCharCode];x+=(kerningOffset!==undefined)?kerningOffset:0;}
            if(displayCallback)
            {callbackData.index=index;callbackData.charCode=charCode;callbackData.x=x;callbackData.y=y;callbackData.scale=scale;callbackData.rotation=rotation;callbackData.data=glyph.data;var output=displayCallback(callbackData);x=output.x;y=output.y;scale=output.scale;rotation=output.rotation;}
            x*=scale;y*=scale;x-=cameraScrollX;y-=cameraScrollY;if(camera.roundPixels)
        {x=Math.round(x);y=Math.round(y);}
            ctx.save();ctx.translate(x,y);ctx.rotate(rotation);ctx.scale(scale,scale);ctx.drawImage(image,glyphX,glyphY,glyphW,glyphH,0,0,glyphW,glyphH);ctx.restore();xAdvance+=glyph.xAdvance;indexCount+=1;lastGlyph=glyph;lastCharCode=charCode;}
        ctx.restore();};module.exports=DynamicBitmapTextCanvasRenderer;}),"./gameobjects/bitmaptext/dynamic/DynamicBitmapTextCreator.js":(function(module,exports,__webpack_require__){var BitmapText=__webpack_require__("./gameobjects/bitmaptext/dynamic/DynamicBitmapText.js");var BuildGameObject=__webpack_require__("./gameobjects/BuildGameObject.js");var GameObjectCreator=__webpack_require__("./gameobjects/GameObjectCreator.js");var GetAdvancedValue=__webpack_require__("./utils/object/GetAdvancedValue.js");GameObjectCreator.register('dynamicBitmapText',function(config,addToScene)
    {if(config===undefined){config={};}
        var font=GetAdvancedValue(config,'font','');var text=GetAdvancedValue(config,'text','');var size=GetAdvancedValue(config,'size',false);var bitmapText=new BitmapText(this.scene,0,0,font,text,size);if(addToScene!==undefined)
    {config.add=addToScene;}
        BuildGameObject(this.scene,bitmapText,config);return bitmapText;});}),"./gameobjects/bitmaptext/dynamic/DynamicBitmapTextFactory.js":(function(module,exports,__webpack_require__){var DynamicBitmapText=__webpack_require__("./gameobjects/bitmaptext/dynamic/DynamicBitmapText.js");var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");GameObjectFactory.register('dynamicBitmapText',function(x,y,font,text,size)
    {return this.displayList.add(new DynamicBitmapText(this.scene,x,y,font,text,size));});}),"./gameobjects/bitmaptext/dynamic/DynamicBitmapTextRender.js":(function(module,exports,__webpack_require__){var renderWebGL=__webpack_require__("./utils/NOOP.js");var renderCanvas=__webpack_require__("./utils/NOOP.js");if(true)
    {renderWebGL=__webpack_require__("./gameobjects/bitmaptext/dynamic/DynamicBitmapTextWebGLRenderer.js");}
        if(true)
        {renderCanvas=__webpack_require__("./gameobjects/bitmaptext/dynamic/DynamicBitmapTextCanvasRenderer.js");}
        module.exports={renderWebGL:renderWebGL,renderCanvas:renderCanvas};}),"./gameobjects/bitmaptext/dynamic/DynamicBitmapTextWebGLRenderer.js":(function(module,exports,__webpack_require__){var Utils=__webpack_require__("./renderer/webgl/Utils.js");var DynamicBitmapTextWebGLRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var text=src.text;var textLength=text.length;if(textLength===0)
    {return;}
        var pipeline=this.pipeline;renderer.setPipeline(pipeline,src);var crop=(src.cropWidth>0||src.cropHeight>0);if(crop)
    {pipeline.flush();renderer.pushScissor(src.x,src.y,src.cropWidth*src.scaleX,src.cropHeight*src.scaleY);}
        var camMatrix=pipeline._tempMatrix1;var spriteMatrix=pipeline._tempMatrix2;var calcMatrix=pipeline._tempMatrix3;var fontMatrix=pipeline._tempMatrix4;spriteMatrix.applyITRS(src.x,src.y,src.rotation,src.scaleX,src.scaleY);camMatrix.copyFrom(camera.matrix);if(parentMatrix)
    {camMatrix.multiplyWithOffset(parentMatrix,-camera.scrollX*src.scrollFactorX,-camera.scrollY*src.scrollFactorY);spriteMatrix.e=src.x;spriteMatrix.f=src.y;camMatrix.multiply(spriteMatrix,calcMatrix);}
    else
    {spriteMatrix.e-=camera.scrollX*src.scrollFactorX;spriteMatrix.f-=camera.scrollY*src.scrollFactorY;camMatrix.multiply(spriteMatrix,calcMatrix);}
        var frame=src.frame;var texture=frame.glTexture;var textureX=frame.cutX;var textureY=frame.cutY;var textureWidth=texture.width;var textureHeight=texture.height;var tintEffect=(src._isTinted&&src.tintFill);var tintTL=Utils.getTintAppendFloatAlpha(src._tintTL,camera.alpha*src._alphaTL);var tintTR=Utils.getTintAppendFloatAlpha(src._tintTR,camera.alpha*src._alphaTR);var tintBL=Utils.getTintAppendFloatAlpha(src._tintBL,camera.alpha*src._alphaBL);var tintBR=Utils.getTintAppendFloatAlpha(src._tintBR,camera.alpha*src._alphaBR);pipeline.setTexture2D(texture,0);var xAdvance=0;var yAdvance=0;var charCode=0;var lastCharCode=0;var letterSpacing=src.letterSpacing;var glyph;var glyphX=0;var glyphY=0;var glyphW=0;var glyphH=0;var lastGlyph;var scrollX=src.scrollX;var scrollY=src.scrollY;var fontData=src.fontData;var chars=fontData.chars;var lineHeight=fontData.lineHeight;var scale=(src.fontSize / fontData.size);var rotation=0;var align=src._align;var currentLine=0;var lineOffsetX=0;src.getTextBounds(false);var lineData=src._bounds.lines;if(align===1)
    {lineOffsetX=(lineData.longest-lineData.lengths[0])/ 2;}
    else if(align===2)
    {lineOffsetX=(lineData.longest-lineData.lengths[0]);}
        var roundPixels=camera.roundPixels;var displayCallback=src.displayCallback;var callbackData=src.callbackData;for(var i=0;i<textLength;i++)
    {charCode=text.charCodeAt(i);if(charCode===10)
    {currentLine++;if(align===1)
    {lineOffsetX=(lineData.longest-lineData.lengths[currentLine])/ 2;}
    else if(align===2)
    {lineOffsetX=(lineData.longest-lineData.lengths[currentLine]);}
        xAdvance=0;yAdvance+=lineHeight;lastGlyph=null;continue;}
        glyph=chars[charCode];if(!glyph)
    {continue;}
        glyphX=textureX+glyph.x;glyphY=textureY+glyph.y;glyphW=glyph.width;glyphH=glyph.height;var x=(glyph.xOffset+xAdvance)-scrollX;var y=(glyph.yOffset+yAdvance)-scrollY;if(lastGlyph!==null)
    {var kerningOffset=glyph.kerning[lastCharCode];x+=(kerningOffset!==undefined)?kerningOffset:0;}
        xAdvance+=glyph.xAdvance+letterSpacing;lastGlyph=glyph;lastCharCode=charCode;if(glyphW===0||glyphH===0||charCode===32)
    {continue;}
        scale=(src.fontSize / src.fontData.size);rotation=0;if(displayCallback)
    {callbackData.color=0;callbackData.tint.topLeft=tintTL;callbackData.tint.topRight=tintTR;callbackData.tint.bottomLeft=tintBL;callbackData.tint.bottomRight=tintBR;callbackData.index=i;callbackData.charCode=charCode;callbackData.x=x;callbackData.y=y;callbackData.scale=scale;callbackData.rotation=rotation;callbackData.data=glyph.data;var output=displayCallback(callbackData);x=output.x;y=output.y;scale=output.scale;rotation=output.rotation;if(output.color)
    {tintTL=output.color;tintTR=output.color;tintBL=output.color;tintBR=output.color;}
    else
    {tintTL=output.tint.topLeft;tintTR=output.tint.topRight;tintBL=output.tint.bottomLeft;tintBR=output.tint.bottomRight;}
        tintTL=Utils.getTintAppendFloatAlpha(tintTL,camera.alpha*src._alphaTL);tintTR=Utils.getTintAppendFloatAlpha(tintTR,camera.alpha*src._alphaTR);tintBL=Utils.getTintAppendFloatAlpha(tintBL,camera.alpha*src._alphaBL);tintBR=Utils.getTintAppendFloatAlpha(tintBR,camera.alpha*src._alphaBR);}
        x*=scale;y*=scale;x-=src.displayOriginX;y-=src.displayOriginY;x+=lineOffsetX;fontMatrix.applyITRS(x,y,rotation,scale,scale);calcMatrix.multiply(fontMatrix,spriteMatrix);var u0=glyphX / textureWidth;var v0=glyphY / textureHeight;var u1=(glyphX+glyphW)/ textureWidth;var v1=(glyphY+glyphH)/ textureHeight;var xw=glyphW;var yh=glyphH;var tx0=spriteMatrix.e;var ty0=spriteMatrix.f;var tx1=yh*spriteMatrix.c+spriteMatrix.e;var ty1=yh*spriteMatrix.d+spriteMatrix.f;var tx2=xw*spriteMatrix.a+yh*spriteMatrix.c+spriteMatrix.e;var ty2=xw*spriteMatrix.b+yh*spriteMatrix.d+spriteMatrix.f;var tx3=xw*spriteMatrix.a+spriteMatrix.e;var ty3=xw*spriteMatrix.b+spriteMatrix.f;if(roundPixels)
    {tx0=Math.round(tx0);ty0=Math.round(ty0);tx1=Math.round(tx1);ty1=Math.round(ty1);tx2=Math.round(tx2);ty2=Math.round(ty2);tx3=Math.round(tx3);ty3=Math.round(ty3);}
        pipeline.batchQuad(tx0,ty0,tx1,ty1,tx2,ty2,tx3,ty3,u0,v0,u1,v1,tintTL,tintTR,tintBL,tintBR,tintEffect,texture,0);}
        if(crop)
        {pipeline.flush();renderer.popScissor();}};module.exports=DynamicBitmapTextWebGLRenderer;}),"./gameobjects/bitmaptext/static/BitmapText.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Components=__webpack_require__("./gameobjects/components/index.js");var GameObject=__webpack_require__("./gameobjects/GameObject.js");var GetBitmapTextSize=__webpack_require__("./gameobjects/bitmaptext/GetBitmapTextSize.js");var ParseFromAtlas=__webpack_require__("./gameobjects/bitmaptext/ParseFromAtlas.js");var Render=__webpack_require__("./gameobjects/bitmaptext/static/BitmapTextRender.js");var BitmapText=new Class({Extends:GameObject,Mixins:[Components.Alpha,Components.BlendMode,Components.Depth,Components.Mask,Components.Origin,Components.Pipeline,Components.ScaleMode,Components.ScrollFactor,Components.Texture,Components.Tint,Components.Transform,Components.Visible,Render],initialize:function BitmapText(scene,x,y,font,text,size,align)
        {if(text===undefined){text='';}
            if(align===undefined){align=0;}
            GameObject.call(this,scene,'BitmapText');this.font=font;var entry=this.scene.sys.cache.bitmapFont.get(font);this.fontData=entry.data;this._text='';this._fontSize=size||this.fontData.size;this._letterSpacing=0;this._align=align;this._bounds=GetBitmapTextSize(this,false,this._bounds);this._dirty=false;this.setTexture(entry.texture,entry.frame);this.setPosition(x,y);this.setOrigin(0,0);this.initPipeline();this.setText(text);},setLeftAlign:function()
        {this._align=BitmapText.ALIGN_LEFT;this._dirty=true;return this;},setCenterAlign:function()
        {this._align=BitmapText.ALIGN_CENTER;this._dirty=true;return this;},setRightAlign:function()
        {this._align=BitmapText.ALIGN_RIGHT;this._dirty=true;return this;},setFontSize:function(size)
        {this._fontSize=size;this._dirty=true;return this;},setLetterSpacing:function(spacing)
        {if(spacing===undefined){spacing=0;}
            this._letterSpacing=spacing;this._dirty=true;return this;},setText:function(value)
        {if(!value&&value!==0)
        {value='';}
            if(Array.isArray(value))
            {value=value.join('\n');}
            if(value!==this.text)
            {this._text=value.toString();this._dirty=true;this.updateDisplayOrigin();}
            return this;},getTextBounds:function(round)
        {if(this._dirty)
        {GetBitmapTextSize(this,round,this._bounds);}
            return this._bounds;},setFont:function(key,size,align)
        {if(size===undefined){size=this._fontSize;}
            if(align===undefined){align=this._align;}
            if(key!==this.font)
            {var entry=this.scene.sys.cache.bitmapFont.get(key);if(entry)
            {this.font=key;this.fontData=entry.data;this._fontSize=size;this._align=align;this.setTexture(entry.texture,entry.frame);GetBitmapTextSize(this,false,this._bounds);}}
            return this;},align:{set:function(value)
            {this._align=value;this._dirty=true;},get:function()
            {return this._align;}},text:{set:function(value)
            {this.setText(value);},get:function()
            {return this._text;}},fontSize:{set:function(value)
            {this._fontSize=value;this._dirty=true;},get:function()
            {return this._fontSize;}},letterSpacing:{set:function(value)
            {this._letterSpacing=value;this._dirty=true;},get:function()
            {return this._letterSpacing;}},width:{get:function()
            {this.getTextBounds(false);return this._bounds.global.width;}},height:{get:function()
            {this.getTextBounds(false);return this._bounds.global.height;}},toJSON:function()
        {var out=Components.ToJSON(this);var data={font:this.font,text:this.text,fontSize:this.fontSize,letterSpacing:this.letterSpacing,align:this.align};out.data=data;return out;}});BitmapText.ALIGN_LEFT=0;BitmapText.ALIGN_CENTER=1;BitmapText.ALIGN_RIGHT=2;BitmapText.ParseFromAtlas=ParseFromAtlas;module.exports=BitmapText;}),"./gameobjects/bitmaptext/static/BitmapTextCanvasRenderer.js":(function(module,exports,__webpack_require__){var SetTransform=__webpack_require__("./renderer/canvas/utils/SetTransform.js");var BitmapTextCanvasRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var text=src._text;var textLength=text.length;var ctx=renderer.currentContext;if(textLength===0||!SetTransform(renderer,ctx,src,camera,parentMatrix))
    {return;}
        var textureFrame=src.frame;var chars=src.fontData.chars;var lineHeight=src.fontData.lineHeight;var letterSpacing=src._letterSpacing;var xAdvance=0;var yAdvance=0;var charCode=0;var glyph=null;var glyphX=0;var glyphY=0;var glyphW=0;var glyphH=0;var x=0;var y=0;var lastGlyph=null;var lastCharCode=0;var image=src.frame.source.image;var textureX=textureFrame.cutX;var textureY=textureFrame.cutY;var scale=(src._fontSize / src.fontData.size);var align=src._align;var currentLine=0;var lineOffsetX=0;src.getTextBounds(false);var lineData=src._bounds.lines;if(align===1)
    {lineOffsetX=(lineData.longest-lineData.lengths[0])/ 2;}
    else if(align===2)
    {lineOffsetX=(lineData.longest-lineData.lengths[0]);}
        ctx.translate(-src.displayOriginX,-src.displayOriginY);var roundPixels=camera.roundPixels;for(var i=0;i<textLength;i++)
    {charCode=text.charCodeAt(i);if(charCode===10)
    {currentLine++;if(align===1)
    {lineOffsetX=(lineData.longest-lineData.lengths[currentLine])/ 2;}
    else if(align===2)
    {lineOffsetX=(lineData.longest-lineData.lengths[currentLine]);}
        xAdvance=0;yAdvance+=lineHeight;lastGlyph=null;continue;}
        glyph=chars[charCode];if(!glyph)
    {continue;}
        glyphX=textureX+glyph.x;glyphY=textureY+glyph.y;glyphW=glyph.width;glyphH=glyph.height;x=glyph.xOffset+xAdvance;y=glyph.yOffset+yAdvance;if(lastGlyph!==null)
    {var kerningOffset=glyph.kerning[lastCharCode];x+=(kerningOffset!==undefined)?kerningOffset:0;}
        x*=scale;y*=scale;x+=lineOffsetX;xAdvance+=glyph.xAdvance+letterSpacing;lastGlyph=glyph;lastCharCode=charCode;if(glyphW===0||glyphH===0||charCode===32)
    {continue;}
        if(roundPixels)
        {x=Math.round(x);y=Math.round(y);}
        ctx.save();ctx.translate(x,y);ctx.scale(scale,scale);ctx.drawImage(image,glyphX,glyphY,glyphW,glyphH,0,0,glyphW,glyphH);ctx.restore();}
        ctx.restore();};module.exports=BitmapTextCanvasRenderer;}),"./gameobjects/bitmaptext/static/BitmapTextCreator.js":(function(module,exports,__webpack_require__){var BitmapText=__webpack_require__("./gameobjects/bitmaptext/static/BitmapText.js");var BuildGameObject=__webpack_require__("./gameobjects/BuildGameObject.js");var GameObjectCreator=__webpack_require__("./gameobjects/GameObjectCreator.js");var GetAdvancedValue=__webpack_require__("./utils/object/GetAdvancedValue.js");var GetValue=__webpack_require__("./utils/object/GetValue.js");GameObjectCreator.register('bitmapText',function(config,addToScene)
    {if(config===undefined){config={};}
        var font=GetValue(config,'font','');var text=GetAdvancedValue(config,'text','');var size=GetAdvancedValue(config,'size',false);var align=GetValue(config,'align',0);var bitmapText=new BitmapText(this.scene,0,0,font,text,size,align);if(addToScene!==undefined)
    {config.add=addToScene;}
        BuildGameObject(this.scene,bitmapText,config);return bitmapText;});}),"./gameobjects/bitmaptext/static/BitmapTextFactory.js":(function(module,exports,__webpack_require__){var BitmapText=__webpack_require__("./gameobjects/bitmaptext/static/BitmapText.js");var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");GameObjectFactory.register('bitmapText',function(x,y,font,text,size,align)
    {return this.displayList.add(new BitmapText(this.scene,x,y,font,text,size,align));});}),"./gameobjects/bitmaptext/static/BitmapTextRender.js":(function(module,exports,__webpack_require__){var renderWebGL=__webpack_require__("./utils/NOOP.js");var renderCanvas=__webpack_require__("./utils/NOOP.js");if(true)
    {renderWebGL=__webpack_require__("./gameobjects/bitmaptext/static/BitmapTextWebGLRenderer.js");}
        if(true)
        {renderCanvas=__webpack_require__("./gameobjects/bitmaptext/static/BitmapTextCanvasRenderer.js");}
        module.exports={renderWebGL:renderWebGL,renderCanvas:renderCanvas};}),"./gameobjects/bitmaptext/static/BitmapTextWebGLRenderer.js":(function(module,exports,__webpack_require__){var Utils=__webpack_require__("./renderer/webgl/Utils.js");var BitmapTextWebGLRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var text=src._text;var textLength=text.length;if(textLength===0)
    {return;}
        var pipeline=this.pipeline;renderer.setPipeline(pipeline,src);var camMatrix=pipeline._tempMatrix1;var spriteMatrix=pipeline._tempMatrix2;var calcMatrix=pipeline._tempMatrix3;spriteMatrix.applyITRS(src.x,src.y,src.rotation,src.scaleX,src.scaleY);camMatrix.copyFrom(camera.matrix);if(parentMatrix)
    {camMatrix.multiplyWithOffset(parentMatrix,-camera.scrollX*src.scrollFactorX,-camera.scrollY*src.scrollFactorY);spriteMatrix.e=src.x;spriteMatrix.f=src.y;camMatrix.multiply(spriteMatrix,calcMatrix);}
    else
    {spriteMatrix.e-=camera.scrollX*src.scrollFactorX;spriteMatrix.f-=camera.scrollY*src.scrollFactorY;camMatrix.multiply(spriteMatrix,calcMatrix);}
        var frame=src.frame;var texture=frame.glTexture;var textureX=frame.cutX;var textureY=frame.cutY;var textureWidth=texture.width;var textureHeight=texture.height;var tintEffect=(src._isTinted&&src.tintFill);var tintTL=Utils.getTintAppendFloatAlpha(src._tintTL,camera.alpha*src._alphaTL);var tintTR=Utils.getTintAppendFloatAlpha(src._tintTR,camera.alpha*src._alphaTR);var tintBL=Utils.getTintAppendFloatAlpha(src._tintBL,camera.alpha*src._alphaBL);var tintBR=Utils.getTintAppendFloatAlpha(src._tintBR,camera.alpha*src._alphaBR);pipeline.setTexture2D(texture,0);var xAdvance=0;var yAdvance=0;var charCode=0;var lastCharCode=0;var letterSpacing=src._letterSpacing;var glyph;var glyphX=0;var glyphY=0;var glyphW=0;var glyphH=0;var lastGlyph;var fontData=src.fontData;var chars=fontData.chars;var lineHeight=fontData.lineHeight;var scale=(src._fontSize / fontData.size);var align=src._align;var currentLine=0;var lineOffsetX=0;src.getTextBounds(false);var lineData=src._bounds.lines;if(align===1)
    {lineOffsetX=(lineData.longest-lineData.lengths[0])/ 2;}
    else if(align===2)
    {lineOffsetX=(lineData.longest-lineData.lengths[0]);}
        var roundPixels=camera.roundPixels;for(var i=0;i<textLength;i++)
    {charCode=text.charCodeAt(i);if(charCode===10)
    {currentLine++;if(align===1)
    {lineOffsetX=(lineData.longest-lineData.lengths[currentLine])/ 2;}
    else if(align===2)
    {lineOffsetX=(lineData.longest-lineData.lengths[currentLine]);}
        xAdvance=0;yAdvance+=lineHeight;lastGlyph=null;continue;}
        glyph=chars[charCode];if(!glyph)
    {continue;}
        glyphX=textureX+glyph.x;glyphY=textureY+glyph.y;glyphW=glyph.width;glyphH=glyph.height;var x=glyph.xOffset+xAdvance;var y=glyph.yOffset+yAdvance;if(lastGlyph!==null)
    {var kerningOffset=glyph.kerning[lastCharCode];x+=(kerningOffset!==undefined)?kerningOffset:0;}
        xAdvance+=glyph.xAdvance+letterSpacing;lastGlyph=glyph;lastCharCode=charCode;if(glyphW===0||glyphH===0||charCode===32)
    {continue;}
        x*=scale;y*=scale;x-=src.displayOriginX;y-=src.displayOriginY;x+=lineOffsetX;var u0=glyphX / textureWidth;var v0=glyphY / textureHeight;var u1=(glyphX+glyphW)/ textureWidth;var v1=(glyphY+glyphH)/ textureHeight;var xw=x+(glyphW*scale);var yh=y+(glyphH*scale);var tx0=calcMatrix.getX(x,y);var ty0=calcMatrix.getY(x,y);var tx1=calcMatrix.getX(x,yh);var ty1=calcMatrix.getY(x,yh);var tx2=calcMatrix.getX(xw,yh);var ty2=calcMatrix.getY(xw,yh);var tx3=calcMatrix.getX(xw,y);var ty3=calcMatrix.getY(xw,y);if(roundPixels)
    {tx0=Math.round(tx0);ty0=Math.round(ty0);tx1=Math.round(tx1);ty1=Math.round(ty1);tx2=Math.round(tx2);ty2=Math.round(ty2);tx3=Math.round(tx3);ty3=Math.round(ty3);}
        pipeline.batchQuad(tx0,ty0,tx1,ty1,tx2,ty2,tx3,ty3,u0,v0,u1,v1,tintTL,tintTR,tintBL,tintBR,tintEffect,texture,0);}};module.exports=BitmapTextWebGLRenderer;}),"./gameobjects/blitter/Blitter.js":(function(module,exports,__webpack_require__){var BlitterRender=__webpack_require__("./gameobjects/blitter/BlitterRender.js");var Bob=__webpack_require__("./gameobjects/blitter/Bob.js");var Class=__webpack_require__("./utils/Class.js");var Components=__webpack_require__("./gameobjects/components/index.js");var Frame=__webpack_require__("./textures/Frame.js");var GameObject=__webpack_require__("./gameobjects/GameObject.js");var List=__webpack_require__("./structs/List.js");var Blitter=new Class({Extends:GameObject,Mixins:[Components.Alpha,Components.BlendMode,Components.Depth,Components.Mask,Components.Pipeline,Components.ScaleMode,Components.ScrollFactor,Components.Size,Components.Texture,Components.Transform,Components.Visible,BlitterRender],initialize:function Blitter(scene,x,y,texture,frame)
        {GameObject.call(this,scene,'Blitter');this.setTexture(texture,frame);this.setPosition(x,y);this.initPipeline();this.children=new List();this.renderList=[];this.dirty=false;},create:function(x,y,frame,visible,index)
        {if(visible===undefined){visible=true;}
            if(index===undefined){index=this.children.length;}
            if(frame===undefined)
            {frame=this.frame;}
            else if(!(frame instanceof Frame))
            {frame=this.texture.get(frame);}
            var bob=new Bob(this,x,y,frame,visible);this.children.addAt(bob,index,false);this.dirty=true;return bob;},createFromCallback:function(callback,quantity,frame,visible)
        {var bobs=this.createMultiple(quantity,frame,visible);for(var i=0;i<bobs.length;i++)
        {var bob=bobs[i];callback.call(this,bob,i);}
            return bobs;},createMultiple:function(quantity,frame,visible)
        {if(frame===undefined){frame=this.frame.name;}
            if(visible===undefined){visible=true;}
            if(!Array.isArray(frame))
            {frame=[frame];}
            var bobs=[];var _this=this;frame.forEach(function(singleFrame)
        {for(var i=0;i<quantity;i++)
        {bobs.push(_this.create(0,0,singleFrame,visible));}});return bobs;},childCanRender:function(child)
        {return(child.visible&&child.alpha>0);},getRenderList:function()
        {if(this.dirty)
        {this.renderList=this.children.list.filter(this.childCanRender,this);this.dirty=false;}
            return this.renderList;},clear:function()
        {this.children.removeAll();this.dirty=true;},preDestroy:function()
        {this.children.destroy();this.renderList=[];}});module.exports=Blitter;}),"./gameobjects/blitter/BlitterCanvasRenderer.js":(function(module,exports){var BlitterCanvasRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var list=src.getRenderList();if(list.length===0)
    {return;}
        var ctx=renderer.currentContext;var alpha=camera.alpha*src.alpha;if(alpha===0)
    {return;}
        ctx.globalCompositeOperation=renderer.blendModes[src.blendMode];var cameraScrollX=src.x-camera.scrollX*src.scrollFactorX;var cameraScrollY=src.y-camera.scrollY*src.scrollFactorY;ctx.save();if(parentMatrix)
    {parentMatrix.copyToContext(ctx);}
        var roundPixels=camera.roundPixels;for(var i=0;i<list.length;i++)
    {var bob=list[i];var flip=(bob.flipX||bob.flipY);var frame=bob.frame;var cd=frame.canvasData;var dx=frame.x;var dy=frame.y;var fx=1;var fy=1;var bobAlpha=bob.alpha*alpha;if(bobAlpha===0)
    {continue;}
        ctx.globalAlpha=bobAlpha;if(!flip)
    {if(roundPixels)
    {dx=Math.round(dx);dy=Math.round(dy);}
        ctx.drawImage(frame.source.image,cd.x,cd.y,cd.width,cd.height,dx+bob.x+cameraScrollX,dy+bob.y+cameraScrollY,cd.width,cd.height);}
    else
    {if(bob.flipX)
    {fx=-1;dx-=cd.width;}
        if(bob.flipY)
        {fy=-1;dy-=cd.height;}
        ctx.save();ctx.translate(bob.x+cameraScrollX,bob.y+cameraScrollY);ctx.scale(fx,fy);ctx.drawImage(frame.source.image,cd.x,cd.y,cd.width,cd.height,dx,dy,cd.width,cd.height);ctx.restore();}}
        ctx.restore();};module.exports=BlitterCanvasRenderer;}),"./gameobjects/blitter/BlitterCreator.js":(function(module,exports,__webpack_require__){var Blitter=__webpack_require__("./gameobjects/blitter/Blitter.js");var BuildGameObject=__webpack_require__("./gameobjects/BuildGameObject.js");var GameObjectCreator=__webpack_require__("./gameobjects/GameObjectCreator.js");var GetAdvancedValue=__webpack_require__("./utils/object/GetAdvancedValue.js");GameObjectCreator.register('blitter',function(config,addToScene)
    {if(config===undefined){config={};}
        var key=GetAdvancedValue(config,'key',null);var frame=GetAdvancedValue(config,'frame',null);var blitter=new Blitter(this.scene,0,0,key,frame);if(addToScene!==undefined)
    {config.add=addToScene;}
        BuildGameObject(this.scene,blitter,config);return blitter;});}),"./gameobjects/blitter/BlitterFactory.js":(function(module,exports,__webpack_require__){var Blitter=__webpack_require__("./gameobjects/blitter/Blitter.js");var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");GameObjectFactory.register('blitter',function(x,y,key,frame)
    {return this.displayList.add(new Blitter(this.scene,x,y,key,frame));});}),"./gameobjects/blitter/BlitterRender.js":(function(module,exports,__webpack_require__){var renderWebGL=__webpack_require__("./utils/NOOP.js");var renderCanvas=__webpack_require__("./utils/NOOP.js");if(true)
    {renderWebGL=__webpack_require__("./gameobjects/blitter/BlitterWebGLRenderer.js");}
        if(true)
        {renderCanvas=__webpack_require__("./gameobjects/blitter/BlitterCanvasRenderer.js");}
        module.exports={renderWebGL:renderWebGL,renderCanvas:renderCanvas};}),"./gameobjects/blitter/BlitterWebGLRenderer.js":(function(module,exports,__webpack_require__){var Utils=__webpack_require__("./renderer/webgl/Utils.js");var BlitterWebGLRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var list=src.getRenderList();if(list.length===0)
    {return;}
        var pipeline=this.pipeline;renderer.setPipeline(pipeline,src);var cameraScrollX=camera.scrollX*src.scrollFactorX;var cameraScrollY=camera.scrollY*src.scrollFactorY;var calcMatrix=pipeline._tempMatrix1;calcMatrix.copyFrom(camera.matrix);if(parentMatrix)
    {calcMatrix.multiplyWithOffset(parentMatrix,-cameraScrollX,-cameraScrollY);cameraScrollX=0;cameraScrollY=0;}
        var blitterX=src.x-cameraScrollX;var blitterY=src.y-cameraScrollY;var prevTextureSourceIndex=-1;var tintEffect=false;var alpha=camera.alpha*src.alpha;var roundPixels=camera.roundPixels;for(var index=0;index<list.length;index++)
    {var bob=list[index];var frame=bob.frame;var bobAlpha=bob.alpha*alpha;if(bobAlpha===0)
    {continue;}
        var width=frame.width;var height=frame.height;var x=blitterX+bob.x+frame.x;var y=blitterY+bob.y+frame.y;if(bob.flipX)
    {width*=-1;x+=frame.width;}
        if(bob.flipY)
        {height*=-1;y+=frame.height;}
        var xw=x+width;var yh=y+height;var tx0=calcMatrix.getX(x,y);var ty0=calcMatrix.getY(x,y);var tx1=calcMatrix.getX(xw,yh);var ty1=calcMatrix.getY(xw,yh);var tint=Utils.getTintAppendFloatAlpha(0xffffff,bobAlpha);if(frame.sourceIndex!==prevTextureSourceIndex)
    {pipeline.setTexture2D(frame.glTexture,0);prevTextureSourceIndex=frame.sourceIndex;}
        if(roundPixels)
        {tx0=Math.round(tx0);ty0=Math.round(ty0);tx1=Math.round(tx1);ty1=Math.round(ty1);}
        if(pipeline.batchQuad(tx0,ty0,tx0,ty1,tx1,ty1,tx1,ty0,frame.u0,frame.v0,frame.u1,frame.v1,tint,tint,tint,tint,tintEffect,frame.glTexture,0))
        {prevTextureSourceIndex=-1;}}};module.exports=BlitterWebGLRenderer;}),"./gameobjects/blitter/Bob.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Bob=new Class({initialize:function Bob(blitter,x,y,frame,visible)
        {this.parent=blitter;this.x=x;this.y=y;this.frame=frame;this.data={};this._visible=visible;this._alpha=1;this.flipX=false;this.flipY=false;},setFrame:function(frame)
        {if(frame===undefined)
        {this.frame=this.parent.frame;}
        else
        {this.frame=this.parent.texture.get(frame);}
            return this;},resetFlip:function()
        {this.flipX=false;this.flipY=false;return this;},reset:function(x,y,frame)
        {this.x=x;this.y=y;this.flipX=false;this.flipY=false;this._alpha=1;this._visible=true;this.parent.dirty=true;if(frame)
        {this.setFrame(frame);}
            return this;},setFlipX:function(value)
        {this.flipX=value;return this;},setFlipY:function(value)
        {this.flipY=value;return this;},setFlip:function(x,y)
        {this.flipX=x;this.flipY=y;return this;},setVisible:function(value)
        {this.visible=value;return this;},setAlpha:function(value)
        {this.alpha=value;return this;},destroy:function()
        {this.parent.dirty=true;this.parent.children.remove(this);this.parent=undefined;this.frame=undefined;this.data=undefined;},visible:{get:function()
            {return this._visible;},set:function(value)
            {this._visible=value;this.parent.dirty=true;}},alpha:{get:function()
            {return this._alpha;},set:function(value)
            {this._alpha=value;this.parent.dirty=true;}}});module.exports=Bob;}),"./gameobjects/components/Alpha.js":(function(module,exports,__webpack_require__){var Clamp=__webpack_require__("./math/Clamp.js");var _FLAG=2;var Alpha={_alpha:1,_alphaTL:1,_alphaTR:1,_alphaBL:1,_alphaBR:1,clearAlpha:function()
        {return this.setAlpha(1);},setAlpha:function(topLeft,topRight,bottomLeft,bottomRight)
        {if(topLeft===undefined){topLeft=1;}
            if(topRight===undefined)
            {this.alpha=topLeft;}
            else
            {this._alphaTL=Clamp(topLeft,0,1);this._alphaTR=Clamp(topRight,0,1);this._alphaBL=Clamp(bottomLeft,0,1);this._alphaBR=Clamp(bottomRight,0,1);}
            return this;},alpha:{get:function()
            {return this._alpha;},set:function(value)
            {var v=Clamp(value,0,1);this._alpha=v;this._alphaTL=v;this._alphaTR=v;this._alphaBL=v;this._alphaBR=v;if(v===0)
            {this.renderFlags&=~_FLAG;}
            else
            {this.renderFlags|=_FLAG;}}},alphaTopLeft:{get:function()
            {return this._alphaTL;},set:function(value)
            {var v=Clamp(value,0,1);this._alphaTL=v;if(v!==0)
            {this.renderFlags|=_FLAG;}}},alphaTopRight:{get:function()
            {return this._alphaTR;},set:function(value)
            {var v=Clamp(value,0,1);this._alphaTR=v;if(v!==0)
            {this.renderFlags|=_FLAG;}}},alphaBottomLeft:{get:function()
            {return this._alphaBL;},set:function(value)
            {var v=Clamp(value,0,1);this._alphaBL=v;if(v!==0)
            {this.renderFlags|=_FLAG;}}},alphaBottomRight:{get:function()
            {return this._alphaBR;},set:function(value)
            {var v=Clamp(value,0,1);this._alphaBR=v;if(v!==0)
            {this.renderFlags|=_FLAG;}}}};module.exports=Alpha;}),"./gameobjects/components/Animation.js":(function(module,exports,__webpack_require__){var BaseAnimation=__webpack_require__("./animations/Animation.js");var Class=__webpack_require__("./utils/Class.js");var Animation=new Class({initialize:function Animation(parent)
        {this.parent=parent;this.animationManager=parent.scene.sys.anims;this.animationManager.once('remove',this.remove,this);this.isPlaying=false;this.currentAnim=null;this.currentFrame=null;this.nextAnim=null;this._timeScale=1;this.frameRate=0;this.duration=0;this.msPerFrame=0;this.skipMissedFrames=true;this._delay=0;this._repeat=0;this._repeatDelay=0;this._yoyo=false;this.forward=true;this._reverse=false;this.accumulator=0;this.nextTick=0;this.repeatCounter=0;this.pendingRepeat=false;this._paused=false;this._wasPlaying=false;this._pendingStop=0;this._pendingStopValue;},chain:function(key)
        {if(key instanceof BaseAnimation)
        {key=key.key;}
            this.nextAnim=key;return this.parent;},setDelay:function(value)
        {if(value===undefined){value=0;}
            this._delay=value;return this.parent;},getDelay:function()
        {return this._delay;},delayedPlay:function(delay,key,startFrame)
        {this.play(key,true,startFrame);this.nextTick+=delay;return this.parent;},getCurrentKey:function()
        {if(this.currentAnim)
        {return this.currentAnim.key;}},load:function(key,startFrame)
        {if(startFrame===undefined){startFrame=0;}
            if(this.isPlaying)
            {this.stop();}
            this.animationManager.load(this,key,startFrame);return this.parent;},pause:function(atFrame)
        {if(!this._paused)
        {this._paused=true;this._wasPlaying=this.isPlaying;this.isPlaying=false;}
            if(atFrame!==undefined)
            {this.updateFrame(atFrame);}
            return this.parent;},resume:function(fromFrame)
        {if(this._paused)
        {this._paused=false;this.isPlaying=this._wasPlaying;}
            if(fromFrame!==undefined)
            {this.updateFrame(fromFrame);}
            return this.parent;},isPaused:{get:function()
            {return this._paused;}},play:function(key,ignoreIfPlaying,startFrame)
        {if(ignoreIfPlaying===undefined){ignoreIfPlaying=false;}
            if(startFrame===undefined){startFrame=0;}
            if(key instanceof BaseAnimation)
            {key=key.key;}
            if(ignoreIfPlaying&&this.isPlaying&&this.currentAnim.key===key)
            {return this.parent;}
            this.forward=true;this._reverse=false;return this._startAnimation(key,startFrame);},playReverse:function(key,ignoreIfPlaying,startFrame)
        {if(ignoreIfPlaying===undefined){ignoreIfPlaying=false;}
            if(startFrame===undefined){startFrame=0;}
            if(key instanceof BaseAnimation)
            {key=key.key;}
            if(ignoreIfPlaying&&this.isPlaying&&this.currentAnim.key===key)
            {return this.parent;}
            this.forward=false;this._reverse=true;return this._startAnimation(key,startFrame);},_startAnimation:function(key,startFrame)
        {this.load(key,startFrame);var anim=this.currentAnim;var gameObject=this.parent;this.repeatCounter=(this._repeat===-1)?Number.MAX_VALUE:this._repeat;anim.getFirstTick(this);this.isPlaying=true;this.pendingRepeat=false;if(anim.showOnStart)
        {gameObject.visible=true;}
            var frame=this.currentFrame;anim.emit('start',anim,frame);gameObject.emit('animationstart-'+key,anim,frame,gameObject);gameObject.emit('animationstart',anim,frame,gameObject);return gameObject;},reverse:function()
        {if(this.isPlaying)
        {this._reverse=!this._reverse;this.forward=!this.forward;}
            return this.parent;},getProgress:function()
        {var p=this.currentFrame.progress;if(!this.forward)
        {p=1-p;}
            return p;},setProgress:function(value)
        {if(!this.forward)
        {value=1-value;}
            this.setCurrentFrame(this.currentAnim.getFrameByProgress(value));return this.parent;},remove:function(key,animation)
        {if(animation===undefined){animation=this.currentAnim;}
            if(this.isPlaying&&animation.key===this.currentAnim.key)
            {this.stop();this.setCurrentFrame(this.currentAnim.frames[0]);}},getRepeat:function()
        {return this._repeat;},setRepeat:function(value)
        {this._repeat=value;this.repeatCounter=0;return this.parent;},getRepeatDelay:function()
        {return this._repeatDelay;},setRepeatDelay:function(value)
        {this._repeatDelay=value;return this.parent;},restart:function(includeDelay)
        {if(includeDelay===undefined){includeDelay=false;}
            var anim=this.currentAnim;anim.getFirstTick(this,includeDelay);this.forward=true;this.isPlaying=true;this.pendingRepeat=false;this._paused=false;this.updateFrame(anim.frames[0]);var gameObject=this.parent;var frame=this.currentFrame;anim.emit('restart',anim,frame);gameObject.emit('animationrestart-'+anim.key,anim,frame,gameObject);gameObject.emit('animationrestart',anim,frame,gameObject);return this.parent;},stop:function()
        {this._pendingStop=0;this.isPlaying=false;var gameObject=this.parent;var anim=this.currentAnim;var frame=this.currentFrame;if(anim)
        {anim.emit('complete',anim,frame);gameObject.emit('animationcomplete-'+anim.key,anim,frame,gameObject);gameObject.emit('animationcomplete',anim,frame,gameObject);}
            if(this.nextAnim)
            {var key=this.nextAnim;this.nextAnim=null;this.play(key);}
            return gameObject;},stopAfterDelay:function(delay)
        {this._pendingStop=1;this._pendingStopValue=delay;return this.parent;},stopOnRepeat:function()
        {this._pendingStop=2;return this.parent;},stopOnFrame:function(frame)
        {this._pendingStop=3;this._pendingStopValue=frame;return this.parent;},setTimeScale:function(value)
        {if(value===undefined){value=1;}
            this._timeScale=value;return this.parent;},getTimeScale:function()
        {return this._timeScale;},getTotalFrames:function()
        {return this.currentAnim.frames.length;},update:function(time,delta)
        {if(!this.currentAnim||!this.isPlaying||this.currentAnim.paused)
        {return;}
            this.accumulator+=delta*this._timeScale;if(this._pendingStop===1)
        {this._pendingStopValue-=delta;if(this._pendingStopValue<=0)
        {return this.currentAnim.completeAnimation(this);}}
            if(this.accumulator>=this.nextTick)
            {this.currentAnim.setFrame(this);}},setCurrentFrame:function(animationFrame)
        {var gameObject=this.parent;this.currentFrame=animationFrame;gameObject.texture=animationFrame.frame.texture;gameObject.frame=animationFrame.frame;if(gameObject.isCropped)
        {gameObject.frame.updateCropUVs(gameObject._crop,gameObject.flipX,gameObject.flipY);}
            gameObject.setSizeToFrame();if(animationFrame.frame.customPivot)
        {gameObject.setOrigin(animationFrame.frame.pivotX,animationFrame.frame.pivotY);}
        else
        {gameObject.updateDisplayOrigin();}
            return gameObject;},updateFrame:function(animationFrame)
        {var gameObject=this.setCurrentFrame(animationFrame);if(this.isPlaying)
        {if(animationFrame.setAlpha)
        {gameObject.alpha=animationFrame.alpha;}
            var anim=this.currentAnim;gameObject.emit('animationupdate-'+anim.key,anim,animationFrame,gameObject);gameObject.emit('animationupdate',anim,animationFrame,gameObject);if(this._pendingStop===3&&this._pendingStopValue===animationFrame)
        {this.currentAnim.completeAnimation(this);}}},nextFrame:function()
        {if(this.currentAnim)
        {this.currentAnim.nextFrame(this);}
            return this.parent;},previousFrame:function()
        {if(this.currentAnim)
        {this.currentAnim.previousFrame(this);}
            return this.parent;},setYoyo:function(value)
        {if(value===undefined){value=false;}
            this._yoyo=value;return this.parent;},getYoyo:function()
        {return this._yoyo;},destroy:function()
        {this.animationManager.off('remove',this.remove,this);this.animationManager=null;this.parent=null;this.currentAnim=null;this.currentFrame=null;}});module.exports=Animation;}),"./gameobjects/components/BlendMode.js":(function(module,exports,__webpack_require__){var BlendModes=__webpack_require__("./renderer/BlendModes.js");var BlendMode={_blendMode:BlendModes.NORMAL,blendMode:{get:function()
            {return this._blendMode;},set:function(value)
            {if(typeof value==='string')
            {value=BlendModes[value];}
                value|=0;if(value>=-1)
            {this._blendMode=value;}}},setBlendMode:function(value)
        {this.blendMode=value;return this;}};module.exports=BlendMode;}),"./gameobjects/components/ComputedSize.js":(function(module,exports){var ComputedSize={width:0,height:0,displayWidth:{get:function()
            {return this.scaleX*this.width;},set:function(value)
            {this.scaleX=value / this.width;}},displayHeight:{get:function()
            {return this.scaleY*this.height;},set:function(value)
            {this.scaleY=value / this.height;}},setSize:function(width,height)
        {this.width=width;this.height=height;return this;},setDisplaySize:function(width,height)
        {this.displayWidth=width;this.displayHeight=height;return this;}};module.exports=ComputedSize;}),"./gameobjects/components/Crop.js":(function(module,exports){var Crop={texture:null,frame:null,isCropped:false,setCrop:function(x,y,width,height)
        {if(x===undefined)
        {this.isCropped=false;}
        else if(this.frame)
        {if(typeof x==='number')
        {this.frame.setCropUVs(this._crop,x,y,width,height,this.flipX,this.flipY);}
        else
        {var rect=x;this.frame.setCropUVs(this._crop,rect.x,rect.y,rect.width,rect.height,this.flipX,this.flipY);}
            this.isCropped=true;}
            return this;},resetCropObject:function()
        {return{u0:0,v0:0,u1:0,v1:0,width:0,height:0,x:0,y:0,flipX:false,flipY:false,cx:0,cy:0,cw:0,ch:0};}};module.exports=Crop;}),"./gameobjects/components/Depth.js":(function(module,exports){var Depth={_depth:0,depth:{get:function()
            {return this._depth;},set:function(value)
            {this.scene.sys.queueDepthSort();this._depth=value;}},setDepth:function(value)
        {if(value===undefined){value=0;}
            this.depth=value;return this;}};module.exports=Depth;}),"./gameobjects/components/Flip.js":(function(module,exports){var Flip={flipX:false,flipY:false,toggleFlipX:function()
        {this.flipX=!this.flipX;return this;},toggleFlipY:function()
        {this.flipY=!this.flipY;return this;},setFlipX:function(value)
        {this.flipX=value;return this;},setFlipY:function(value)
        {this.flipY=value;return this;},setFlip:function(x,y)
        {this.flipX=x;this.flipY=y;return this;},resetFlip:function()
        {this.flipX=false;this.flipY=false;return this;}};module.exports=Flip;}),"./gameobjects/components/GetBounds.js":(function(module,exports,__webpack_require__){var Rectangle=__webpack_require__("./geom/rectangle/Rectangle.js");var RotateAround=__webpack_require__("./math/RotateAround.js");var Vector2=__webpack_require__("./math/Vector2.js");var GetBounds={getCenter:function(output)
        {if(output===undefined){output=new Vector2();}
            output.x=this.x-(this.displayWidth*this.originX)+(this.displayWidth / 2);output.y=this.y-(this.displayHeight*this.originY)+(this.displayHeight / 2);return output;},getTopLeft:function(output,includeParent)
        {if(!output){output=new Vector2();}
            if(includeParent===undefined){includeParent=false;}
            output.x=this.x-(this.displayWidth*this.originX);output.y=this.y-(this.displayHeight*this.originY);if(this.rotation!==0)
        {RotateAround(output,this.x,this.y,this.rotation);}
            if(includeParent&&this.parentContainer)
            {var parentMatrix=this.parentContainer.getBoundsTransformMatrix();parentMatrix.transformPoint(output.x,output.y,output);}
            return output;},getTopRight:function(output,includeParent)
        {if(!output){output=new Vector2();}
            if(includeParent===undefined){includeParent=false;}
            output.x=(this.x-(this.displayWidth*this.originX))+this.displayWidth;output.y=this.y-(this.displayHeight*this.originY);if(this.rotation!==0)
        {RotateAround(output,this.x,this.y,this.rotation);}
            if(includeParent&&this.parentContainer)
            {var parentMatrix=this.parentContainer.getBoundsTransformMatrix();parentMatrix.transformPoint(output.x,output.y,output);}
            return output;},getBottomLeft:function(output,includeParent)
        {if(!output){output=new Vector2();}
            if(includeParent===undefined){includeParent=false;}
            output.x=this.x-(this.displayWidth*this.originX);output.y=(this.y-(this.displayHeight*this.originY))+this.displayHeight;if(this.rotation!==0)
        {RotateAround(output,this.x,this.y,this.rotation);}
            if(includeParent&&this.parentContainer)
            {var parentMatrix=this.parentContainer.getBoundsTransformMatrix();parentMatrix.transformPoint(output.x,output.y,output);}
            return output;},getBottomRight:function(output,includeParent)
        {if(!output){output=new Vector2();}
            if(includeParent===undefined){includeParent=false;}
            output.x=(this.x-(this.displayWidth*this.originX))+this.displayWidth;output.y=(this.y-(this.displayHeight*this.originY))+this.displayHeight;if(this.rotation!==0)
        {RotateAround(output,this.x,this.y,this.rotation);}
            if(includeParent&&this.parentContainer)
            {var parentMatrix=this.parentContainer.getBoundsTransformMatrix();parentMatrix.transformPoint(output.x,output.y,output);}
            return output;},getBounds:function(output)
        {if(output===undefined){output=new Rectangle();}
            var TLx,TLy,TRx,TRy,BLx,BLy,BRx,BRy;if(this.parentContainer)
        {var parentMatrix=this.parentContainer.getBoundsTransformMatrix();this.getTopLeft(output);parentMatrix.transformPoint(output.x,output.y,output);TLx=output.x;TLy=output.y;this.getTopRight(output);parentMatrix.transformPoint(output.x,output.y,output);TRx=output.x;TRy=output.y;this.getBottomLeft(output);parentMatrix.transformPoint(output.x,output.y,output);BLx=output.x;BLy=output.y;this.getBottomRight(output);parentMatrix.transformPoint(output.x,output.y,output);BRx=output.x;BRy=output.y;}
        else
        {this.getTopLeft(output);TLx=output.x;TLy=output.y;this.getTopRight(output);TRx=output.x;TRy=output.y;this.getBottomLeft(output);BLx=output.x;BLy=output.y;this.getBottomRight(output);BRx=output.x;BRy=output.y;}
            output.x=Math.min(TLx,TRx,BLx,BRx);output.y=Math.min(TLy,TRy,BLy,BRy);output.width=Math.max(TLx,TRx,BLx,BRx)-output.x;output.height=Math.max(TLy,TRy,BLy,BRy)-output.y;return output;}};module.exports=GetBounds;}),"./gameobjects/components/Mask.js":(function(module,exports,__webpack_require__){var BitmapMask=__webpack_require__("./display/mask/BitmapMask.js");var GeometryMask=__webpack_require__("./display/mask/GeometryMask.js");var Mask={mask:null,setMask:function(mask)
        {this.mask=mask;return this;},clearMask:function(destroyMask)
        {if(destroyMask===undefined){destroyMask=false;}
            if(destroyMask&&this.mask)
            {this.mask.destroy();}
            this.mask=null;return this;},createBitmapMask:function(renderable)
        {if(renderable===undefined&&this.texture)
        {renderable=this;}
            return new BitmapMask(this.scene,renderable);},createGeometryMask:function(graphics)
        {if(graphics===undefined&&this.type==='Graphics')
        {graphics=this;}
            return new GeometryMask(this.scene,graphics);}};module.exports=Mask;}),"./gameobjects/components/Origin.js":(function(module,exports){var Origin={_originComponent:true,originX:0.5,originY:0.5,_displayOriginX:0,_displayOriginY:0,displayOriginX:{get:function()
            {return this._displayOriginX;},set:function(value)
            {this._displayOriginX=value;this.originX=value / this.width;}},displayOriginY:{get:function()
            {return this._displayOriginY;},set:function(value)
            {this._displayOriginY=value;this.originY=value / this.height;}},setOrigin:function(x,y)
        {if(x===undefined){x=0.5;}
            if(y===undefined){y=x;}
            this.originX=x;this.originY=y;return this.updateDisplayOrigin();},setOriginFromFrame:function()
        {if(!this.frame||!this.frame.customPivot)
        {return this.setOrigin();}
        else
        {this.originX=this.frame.pivotX;this.originY=this.frame.pivotY;}
            return this.updateDisplayOrigin();},setDisplayOrigin:function(x,y)
        {if(x===undefined){x=0;}
            if(y===undefined){y=x;}
            this.displayOriginX=x;this.displayOriginY=y;return this;},updateDisplayOrigin:function()
        {this._displayOriginX=Math.round(this.originX*this.width);this._displayOriginY=Math.round(this.originY*this.height);return this;}};module.exports=Origin;}),"./gameobjects/components/Pipeline.js":(function(module,exports){var Pipeline={defaultPipeline:null,pipeline:null,initPipeline:function(pipelineName)
        {if(pipelineName===undefined){pipelineName='TextureTintPipeline';}
            var renderer=this.scene.sys.game.renderer;if(renderer&&renderer.gl&&renderer.hasPipeline(pipelineName))
        {this.defaultPipeline=renderer.getPipeline(pipelineName);this.pipeline=this.defaultPipeline;return true;}
            return false;},setPipeline:function(pipelineName)
        {var renderer=this.scene.sys.game.renderer;if(renderer&&renderer.gl&&renderer.hasPipeline(pipelineName))
        {this.pipeline=renderer.getPipeline(pipelineName);}
            return this;},resetPipeline:function()
        {this.pipeline=this.defaultPipeline;return(this.pipeline!==null);},getPipelineName:function()
        {return this.pipeline.name;}};module.exports=Pipeline;}),"./gameobjects/components/ScaleMode.js":(function(module,exports,__webpack_require__){var ScaleModes=__webpack_require__("./renderer/ScaleModes.js");var ScaleMode={_scaleMode:ScaleModes.DEFAULT,scaleMode:{get:function()
            {return this._scaleMode;},set:function(value)
            {if(value===ScaleModes.LINEAR||value===ScaleModes.NEAREST)
            {this._scaleMode=value;}}},setScaleMode:function(value)
        {this.scaleMode=value;return this;}};module.exports=ScaleMode;}),"./gameobjects/components/ScrollFactor.js":(function(module,exports){var ScrollFactor={scrollFactorX:1,scrollFactorY:1,setScrollFactor:function(x,y)
        {if(y===undefined){y=x;}
            this.scrollFactorX=x;this.scrollFactorY=y;return this;}};module.exports=ScrollFactor;}),"./gameobjects/components/Size.js":(function(module,exports){var Size={_sizeComponent:true,width:0,height:0,displayWidth:{get:function()
            {return this.scaleX*this.frame.realWidth;},set:function(value)
            {this.scaleX=value / this.frame.realWidth;}},displayHeight:{get:function()
            {return this.scaleY*this.frame.realHeight;},set:function(value)
            {this.scaleY=value / this.frame.realHeight;}},setSizeToFrame:function(frame)
        {if(frame===undefined){frame=this.frame;}
            this.width=frame.realWidth;this.height=frame.realHeight;return this;},setSize:function(width,height)
        {this.width=width;this.height=height;return this;},setDisplaySize:function(width,height)
        {this.displayWidth=width;this.displayHeight=height;return this;}};module.exports=Size;}),"./gameobjects/components/Texture.js":(function(module,exports){var _FLAG=8;var Texture={texture:null,frame:null,isCropped:false,setTexture:function(key,frame)
        {this.texture=this.scene.sys.textures.get(key);return this.setFrame(frame);},setFrame:function(frame,updateSize,updateOrigin)
        {if(updateSize===undefined){updateSize=true;}
            if(updateOrigin===undefined){updateOrigin=true;}
            this.frame=this.texture.get(frame);if(!this.frame.cutWidth||!this.frame.cutHeight)
        {this.renderFlags&=~_FLAG;}
        else
        {this.renderFlags|=_FLAG;}
            if(this._sizeComponent&&updateSize)
            {this.setSizeToFrame();}
            if(this._originComponent&&updateOrigin)
            {if(this.frame.customPivot)
            {this.setOrigin(this.frame.pivotX,this.frame.pivotY);}
            else
            {this.updateDisplayOrigin();}}
            return this;}};module.exports=Texture;}),"./gameobjects/components/TextureCrop.js":(function(module,exports){var _FLAG=8;var TextureCrop={texture:null,frame:null,isCropped:false,setCrop:function(x,y,width,height)
        {if(x===undefined)
        {this.isCropped=false;}
        else if(this.frame)
        {if(typeof x==='number')
        {this.frame.setCropUVs(this._crop,x,y,width,height,this.flipX,this.flipY);}
        else
        {var rect=x;this.frame.setCropUVs(this._crop,rect.x,rect.y,rect.width,rect.height,this.flipX,this.flipY);}
            this.isCropped=true;}
            return this;},setTexture:function(key,frame)
        {this.texture=this.scene.sys.textures.get(key);return this.setFrame(frame);},setFrame:function(frame,updateSize,updateOrigin)
        {if(updateSize===undefined){updateSize=true;}
            if(updateOrigin===undefined){updateOrigin=true;}
            this.frame=this.texture.get(frame);if(!this.frame.cutWidth||!this.frame.cutHeight)
        {this.renderFlags&=~_FLAG;}
        else
        {this.renderFlags|=_FLAG;}
            if(this._sizeComponent&&updateSize)
            {this.setSizeToFrame();}
            if(this._originComponent&&updateOrigin)
            {if(this.frame.customPivot)
            {this.setOrigin(this.frame.pivotX,this.frame.pivotY);}
            else
            {this.updateDisplayOrigin();}}
            if(this.isCropped)
            {this.frame.updateCropUVs(this._crop,this.flipX,this.flipY);}
            return this;},resetCropObject:function()
        {return{u0:0,v0:0,u1:0,v1:0,width:0,height:0,x:0,y:0,flipX:false,flipY:false,cx:0,cy:0,cw:0,ch:0};}};module.exports=TextureCrop;}),"./gameobjects/components/Tint.js":(function(module,exports){var GetColor=function(value)
    {return(value>>16)+(value&0xff00)+((value&0xff)<<16);};var Tint={_tintTL:16777215,_tintTR:16777215,_tintBL:16777215,_tintBR:16777215,_isTinted:false,tintFill:false,clearTint:function()
        {this.setTint(0xffffff);this._isTinted=false;return this;},setTint:function(topLeft,topRight,bottomLeft,bottomRight)
        {if(topLeft===undefined){topLeft=0xffffff;}
            if(topRight===undefined)
            {topRight=topLeft;bottomLeft=topLeft;bottomRight=topLeft;}
            this._tintTL=GetColor(topLeft);this._tintTR=GetColor(topRight);this._tintBL=GetColor(bottomLeft);this._tintBR=GetColor(bottomRight);this._isTinted=true;this.tintFill=false;return this;},setTintFill:function(topLeft,topRight,bottomLeft,bottomRight)
        {this.setTint(topLeft,topRight,bottomLeft,bottomRight);this.tintFill=true;return this;},tintTopLeft:{get:function()
            {return this._tintTL;},set:function(value)
            {this._tintTL=GetColor(value);this._isTinted=true;}},tintTopRight:{get:function()
            {return this._tintTR;},set:function(value)
            {this._tintTR=GetColor(value);this._isTinted=true;}},tintBottomLeft:{get:function()
            {return this._tintBL;},set:function(value)
            {this._tintBL=GetColor(value);this._isTinted=true;}},tintBottomRight:{get:function()
            {return this._tintBR;},set:function(value)
            {this._tintBR=GetColor(value);this._isTinted=true;}},tint:{set:function(value)
            {this.setTint(value,value,value,value);}},isTinted:{get:function()
            {return this._isTinted;}}};module.exports=Tint;}),"./gameobjects/components/ToJSON.js":(function(module,exports){var ToJSON=function(gameObject)
    {var out={name:gameObject.name,type:gameObject.type,x:gameObject.x,y:gameObject.y,depth:gameObject.depth,scale:{x:gameObject.scaleX,y:gameObject.scaleY},origin:{x:gameObject.originX,y:gameObject.originY},flipX:gameObject.flipX,flipY:gameObject.flipY,rotation:gameObject.rotation,alpha:gameObject.alpha,visible:gameObject.visible,scaleMode:gameObject.scaleMode,blendMode:gameObject.blendMode,textureKey:'',frameKey:'',data:{}};if(gameObject.texture)
    {out.textureKey=gameObject.texture.key;out.frameKey=gameObject.frame.name;}
        return out;};module.exports=ToJSON;}),"./gameobjects/components/Transform.js":(function(module,exports,__webpack_require__){var MATH_CONST=__webpack_require__("./math/const.js");var TransformMatrix=__webpack_require__("./gameobjects/components/TransformMatrix.js");var WrapAngle=__webpack_require__("./math/angle/Wrap.js");var WrapAngleDegrees=__webpack_require__("./math/angle/WrapDegrees.js");var _FLAG=4;var Transform={_scaleX:1,_scaleY:1,_rotation:0,x:0,y:0,z:0,w:0,scaleX:{get:function()
            {return this._scaleX;},set:function(value)
            {this._scaleX=value;if(this._scaleX===0)
            {this.renderFlags&=~_FLAG;}
            else
            {this.renderFlags|=_FLAG;}}},scaleY:{get:function()
            {return this._scaleY;},set:function(value)
            {this._scaleY=value;if(this._scaleY===0)
            {this.renderFlags&=~_FLAG;}
            else
            {this.renderFlags|=_FLAG;}}},angle:{get:function()
            {return WrapAngleDegrees(this._rotation*MATH_CONST.RAD_TO_DEG);},set:function(value)
            {this.rotation=WrapAngleDegrees(value)*MATH_CONST.DEG_TO_RAD;}},rotation:{get:function()
            {return this._rotation;},set:function(value)
            {this._rotation=WrapAngle(value);}},setPosition:function(x,y,z,w)
        {if(x===undefined){x=0;}
            if(y===undefined){y=x;}
            if(z===undefined){z=0;}
            if(w===undefined){w=0;}
            this.x=x;this.y=y;this.z=z;this.w=w;return this;},setRandomPosition:function(x,y,width,height)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            if(width===undefined){width=this.scene.sys.scale.width;}
            if(height===undefined){height=this.scene.sys.scale.height;}
            this.x=x+(Math.random()*width);this.y=y+(Math.random()*height);return this;},setRotation:function(radians)
        {if(radians===undefined){radians=0;}
            this.rotation=radians;return this;},setAngle:function(degrees)
        {if(degrees===undefined){degrees=0;}
            this.angle=degrees;return this;},setScale:function(x,y)
        {if(x===undefined){x=1;}
            if(y===undefined){y=x;}
            this.scaleX=x;this.scaleY=y;return this;},setX:function(value)
        {if(value===undefined){value=0;}
            this.x=value;return this;},setY:function(value)
        {if(value===undefined){value=0;}
            this.y=value;return this;},setZ:function(value)
        {if(value===undefined){value=0;}
            this.z=value;return this;},setW:function(value)
        {if(value===undefined){value=0;}
            this.w=value;return this;},getLocalTransformMatrix:function(tempMatrix)
        {if(tempMatrix===undefined){tempMatrix=new TransformMatrix();}
            return tempMatrix.applyITRS(this.x,this.y,this._rotation,this._scaleX,this._scaleY);},getWorldTransformMatrix:function(tempMatrix,parentMatrix)
        {if(tempMatrix===undefined){tempMatrix=new TransformMatrix();}
            if(parentMatrix===undefined){parentMatrix=new TransformMatrix();}
            var parent=this.parentContainer;if(!parent)
        {return this.getLocalTransformMatrix(tempMatrix);}
            tempMatrix.applyITRS(this.x,this.y,this._rotation,this._scaleX,this._scaleY);while(parent)
        {parentMatrix.applyITRS(parent.x,parent.y,parent._rotation,parent._scaleX,parent._scaleY);parentMatrix.multiply(tempMatrix,tempMatrix);parent=parent.parentContainer;}
            return tempMatrix;}};module.exports=Transform;}),"./gameobjects/components/TransformMatrix.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Vector2=__webpack_require__("./math/Vector2.js");var TransformMatrix=new Class({initialize:function TransformMatrix(a,b,c,d,tx,ty)
        {if(a===undefined){a=1;}
            if(b===undefined){b=0;}
            if(c===undefined){c=0;}
            if(d===undefined){d=1;}
            if(tx===undefined){tx=0;}
            if(ty===undefined){ty=0;}
            this.matrix=new Float32Array([a,b,c,d,tx,ty,0,0,1]);this.decomposedMatrix={translateX:0,translateY:0,scaleX:1,scaleY:1,rotation:0};},a:{get:function()
            {return this.matrix[0];},set:function(value)
            {this.matrix[0]=value;}},b:{get:function()
            {return this.matrix[1];},set:function(value)
            {this.matrix[1]=value;}},c:{get:function()
            {return this.matrix[2];},set:function(value)
            {this.matrix[2]=value;}},d:{get:function()
            {return this.matrix[3];},set:function(value)
            {this.matrix[3]=value;}},e:{get:function()
            {return this.matrix[4];},set:function(value)
            {this.matrix[4]=value;}},f:{get:function()
            {return this.matrix[5];},set:function(value)
            {this.matrix[5]=value;}},tx:{get:function()
            {return this.matrix[4];},set:function(value)
            {this.matrix[4]=value;}},ty:{get:function()
            {return this.matrix[5];},set:function(value)
            {this.matrix[5]=value;}},rotation:{get:function()
            {return Math.acos(this.a / this.scaleX)*(Math.atan(-this.c / this.a)<0?-1:1);}},scaleX:{get:function()
            {return Math.sqrt((this.a*this.a)+(this.c*this.c));}},scaleY:{get:function()
            {return Math.sqrt((this.b*this.b)+(this.d*this.d));}},loadIdentity:function()
        {var matrix=this.matrix;matrix[0]=1;matrix[1]=0;matrix[2]=0;matrix[3]=1;matrix[4]=0;matrix[5]=0;return this;},translate:function(x,y)
        {var matrix=this.matrix;matrix[4]=matrix[0]*x+matrix[2]*y+matrix[4];matrix[5]=matrix[1]*x+matrix[3]*y+matrix[5];return this;},scale:function(x,y)
        {var matrix=this.matrix;matrix[0]*=x;matrix[1]*=x;matrix[2]*=y;matrix[3]*=y;return this;},rotate:function(angle)
        {var sin=Math.sin(angle);var cos=Math.cos(angle);var matrix=this.matrix;var a=matrix[0];var b=matrix[1];var c=matrix[2];var d=matrix[3];matrix[0]=a*cos+c*sin;matrix[1]=b*cos+d*sin;matrix[2]=a*-sin+c*cos;matrix[3]=b*-sin+d*cos;return this;},multiply:function(rhs,out)
        {var matrix=this.matrix;var source=rhs.matrix;var localA=matrix[0];var localB=matrix[1];var localC=matrix[2];var localD=matrix[3];var localE=matrix[4];var localF=matrix[5];var sourceA=source[0];var sourceB=source[1];var sourceC=source[2];var sourceD=source[3];var sourceE=source[4];var sourceF=source[5];var destinationMatrix=(out===undefined)?this:out;destinationMatrix.a=(sourceA*localA)+(sourceB*localC);destinationMatrix.b=(sourceA*localB)+(sourceB*localD);destinationMatrix.c=(sourceC*localA)+(sourceD*localC);destinationMatrix.d=(sourceC*localB)+(sourceD*localD);destinationMatrix.e=(sourceE*localA)+(sourceF*localC)+localE;destinationMatrix.f=(sourceE*localB)+(sourceF*localD)+localF;return destinationMatrix;},multiplyWithOffset:function(src,offsetX,offsetY)
        {var matrix=this.matrix;var otherMatrix=src.matrix;var a0=matrix[0];var b0=matrix[1];var c0=matrix[2];var d0=matrix[3];var tx0=matrix[4];var ty0=matrix[5];var pse=offsetX*a0+offsetY*c0+tx0;var psf=offsetX*b0+offsetY*d0+ty0;var a1=otherMatrix[0];var b1=otherMatrix[1];var c1=otherMatrix[2];var d1=otherMatrix[3];var tx1=otherMatrix[4];var ty1=otherMatrix[5];matrix[0]=a1*a0+b1*c0;matrix[1]=a1*b0+b1*d0;matrix[2]=c1*a0+d1*c0;matrix[3]=c1*b0+d1*d0;matrix[4]=tx1*a0+ty1*c0+pse;matrix[5]=tx1*b0+ty1*d0+psf;return this;},transform:function(a,b,c,d,tx,ty)
        {var matrix=this.matrix;var a0=matrix[0];var b0=matrix[1];var c0=matrix[2];var d0=matrix[3];var tx0=matrix[4];var ty0=matrix[5];matrix[0]=a*a0+b*c0;matrix[1]=a*b0+b*d0;matrix[2]=c*a0+d*c0;matrix[3]=c*b0+d*d0;matrix[4]=tx*a0+ty*c0+tx0;matrix[5]=tx*b0+ty*d0+ty0;return this;},transformPoint:function(x,y,point)
        {if(point===undefined){point={x:0,y:0};}
            var matrix=this.matrix;var a=matrix[0];var b=matrix[1];var c=matrix[2];var d=matrix[3];var tx=matrix[4];var ty=matrix[5];point.x=x*a+y*c+tx;point.y=x*b+y*d+ty;return point;},invert:function()
        {var matrix=this.matrix;var a=matrix[0];var b=matrix[1];var c=matrix[2];var d=matrix[3];var tx=matrix[4];var ty=matrix[5];var n=a*d-b*c;matrix[0]=d / n;matrix[1]=-b / n;matrix[2]=-c / n;matrix[3]=a / n;matrix[4]=(c*ty-d*tx)/ n;matrix[5]=-(a*ty-b*tx)/ n;return this;},copyFrom:function(src)
        {var matrix=this.matrix;matrix[0]=src.a;matrix[1]=src.b;matrix[2]=src.c;matrix[3]=src.d;matrix[4]=src.e;matrix[5]=src.f;return this;},copyFromArray:function(src)
        {var matrix=this.matrix;matrix[0]=src[0];matrix[1]=src[1];matrix[2]=src[2];matrix[3]=src[3];matrix[4]=src[4];matrix[5]=src[5];return this;},copyToContext:function(ctx)
        {var matrix=this.matrix;ctx.transform(matrix[0],matrix[1],matrix[2],matrix[3],matrix[4],matrix[5]);return ctx;},setToContext:function(ctx)
        {var matrix=this.matrix;ctx.setTransform(matrix[0],matrix[1],matrix[2],matrix[3],matrix[4],matrix[5]);return ctx;},copyToArray:function(out)
        {var matrix=this.matrix;if(out===undefined)
        {out=[matrix[0],matrix[1],matrix[2],matrix[3],matrix[4],matrix[5]];}
        else
        {out[0]=matrix[0];out[1]=matrix[1];out[2]=matrix[2];out[3]=matrix[3];out[4]=matrix[4];out[5]=matrix[5];}
            return out;},setTransform:function(a,b,c,d,tx,ty)
        {var matrix=this.matrix;matrix[0]=a;matrix[1]=b;matrix[2]=c;matrix[3]=d;matrix[4]=tx;matrix[5]=ty;return this;},decomposeMatrix:function()
        {var decomposedMatrix=this.decomposedMatrix;var matrix=this.matrix;var a=matrix[0];var b=matrix[1];var c=matrix[2];var d=matrix[3];var determ=a*d-b*c;decomposedMatrix.translateX=matrix[4];decomposedMatrix.translateY=matrix[5];if(a||b)
        {var r=Math.sqrt(a*a+b*b);decomposedMatrix.rotation=(b>0)?Math.acos(a / r):-Math.acos(a / r);decomposedMatrix.scaleX=r;decomposedMatrix.scaleY=determ / r;}
        else if(c||d)
        {var s=Math.sqrt(c*c+d*d);decomposedMatrix.rotation=Math.PI*0.5-(d>0?Math.acos(-c / s):-Math.acos(c / s));decomposedMatrix.scaleX=determ / s;decomposedMatrix.scaleY=s;}
        else
        {decomposedMatrix.rotation=0;decomposedMatrix.scaleX=0;decomposedMatrix.scaleY=0;}
            return decomposedMatrix;},applyITRS:function(x,y,rotation,scaleX,scaleY)
        {var matrix=this.matrix;var radianSin=Math.sin(rotation);var radianCos=Math.cos(rotation);matrix[4]=x;matrix[5]=y;matrix[0]=radianCos*scaleX;matrix[1]=radianSin*scaleX;matrix[2]=-radianSin*scaleY;matrix[3]=radianCos*scaleY;return this;},applyInverse:function(x,y,output)
        {if(output===undefined){output=new Vector2();}
            var matrix=this.matrix;var a=matrix[0];var b=matrix[1];var c=matrix[2];var d=matrix[3];var tx=matrix[4];var ty=matrix[5];var id=1 /((a*d)+(c*-b));output.x=(d*id*x)+(-c*id*y)+(((ty*c)-(tx*d))*id);output.y=(a*id*y)+(-b*id*x)+(((-ty*a)+(tx*b))*id);return output;},getX:function(x,y)
        {return x*this.a+y*this.c+this.e;},getY:function(x,y)
        {return x*this.b+y*this.d+this.f;},getCSSMatrix:function()
        {var m=this.matrix;return'matrix('+m[0]+','+m[1]+','+m[2]+','+m[3]+','+m[4]+','+m[5]+')';},destroy:function()
        {this.matrix=null;this.decomposedMatrix=null;}});module.exports=TransformMatrix;}),"./gameobjects/components/Visible.js":(function(module,exports){var _FLAG=1;var Visible={_visible:true,visible:{get:function()
            {return this._visible;},set:function(value)
            {if(value)
            {this._visible=true;this.renderFlags|=_FLAG;}
            else
            {this._visible=false;this.renderFlags&=~_FLAG;}}},setVisible:function(value)
        {this.visible=value;return this;}};module.exports=Visible;}),"./gameobjects/components/index.js":(function(module,exports,__webpack_require__){module.exports={Alpha:__webpack_require__("./gameobjects/components/Alpha.js"),Animation:__webpack_require__("./gameobjects/components/Animation.js"),BlendMode:__webpack_require__("./gameobjects/components/BlendMode.js"),ComputedSize:__webpack_require__("./gameobjects/components/ComputedSize.js"),Crop:__webpack_require__("./gameobjects/components/Crop.js"),Depth:__webpack_require__("./gameobjects/components/Depth.js"),Flip:__webpack_require__("./gameobjects/components/Flip.js"),GetBounds:__webpack_require__("./gameobjects/components/GetBounds.js"),Mask:__webpack_require__("./gameobjects/components/Mask.js"),Origin:__webpack_require__("./gameobjects/components/Origin.js"),Pipeline:__webpack_require__("./gameobjects/components/Pipeline.js"),ScaleMode:__webpack_require__("./gameobjects/components/ScaleMode.js"),ScrollFactor:__webpack_require__("./gameobjects/components/ScrollFactor.js"),Size:__webpack_require__("./gameobjects/components/Size.js"),Texture:__webpack_require__("./gameobjects/components/Texture.js"),TextureCrop:__webpack_require__("./gameobjects/components/TextureCrop.js"),Tint:__webpack_require__("./gameobjects/components/Tint.js"),ToJSON:__webpack_require__("./gameobjects/components/ToJSON.js"),Transform:__webpack_require__("./gameobjects/components/Transform.js"),TransformMatrix:__webpack_require__("./gameobjects/components/TransformMatrix.js"),Visible:__webpack_require__("./gameobjects/components/Visible.js")};}),"./gameobjects/container/Container.js":(function(module,exports,__webpack_require__){var ArrayUtils=__webpack_require__("./utils/array/index.js");var BlendModes=__webpack_require__("./renderer/BlendModes.js");var Class=__webpack_require__("./utils/Class.js");var Components=__webpack_require__("./gameobjects/components/index.js");var GameObject=__webpack_require__("./gameobjects/GameObject.js");var Rectangle=__webpack_require__("./geom/rectangle/Rectangle.js");var Render=__webpack_require__("./gameobjects/container/ContainerRender.js");var Union=__webpack_require__("./geom/rectangle/Union.js");var Vector2=__webpack_require__("./math/Vector2.js");var Container=new Class({Extends:GameObject,Mixins:[Components.Alpha,Components.BlendMode,Components.ComputedSize,Components.Depth,Components.Mask,Components.ScrollFactor,Components.Transform,Components.Visible,Render],initialize:function Container(scene,x,y,children)
        {GameObject.call(this,scene,'Container');this.list=[];this.exclusive=true;this.maxSize=-1;this.position=0;this.localTransform=new Components.TransformMatrix();this.tempTransformMatrix=new Components.TransformMatrix();this._displayList=scene.sys.displayList;this._sortKey='';this._sysEvents=scene.sys.events;this.setPosition(x,y);this.clearAlpha();this.setBlendMode(BlendModes.SKIP_CHECK);if(children)
        {this.add(children);}},originX:{get:function()
            {return 0.5;}},originY:{get:function()
            {return 0.5;}},displayOriginX:{get:function()
            {return this.width*0.5;}},displayOriginY:{get:function()
            {return this.height*0.5;}},setExclusive:function(value)
        {if(value===undefined){value=true;}
            this.exclusive=value;return this;},getBounds:function(output)
        {if(output===undefined){output=new Rectangle();}
            output.setTo(this.x,this.y,0,0);if(this.list.length>0)
        {var children=this.list;var tempRect=new Rectangle();for(var i=0;i<children.length;i++)
        {var entry=children[i];if(entry.getBounds)
        {entry.getBounds(tempRect);Union(tempRect,output,output);}}}
            return output;},addHandler:function(gameObject)
        {gameObject.once('destroy',this.remove,this);if(this.exclusive)
        {this._displayList.remove(gameObject);if(gameObject.parentContainer)
        {gameObject.parentContainer.remove(gameObject);}
            gameObject.parentContainer=this;}},removeHandler:function(gameObject)
        {gameObject.off('destroy',this.remove);if(this.exclusive)
        {gameObject.parentContainer=null;}},pointToContainer:function(source,output)
        {if(output===undefined){output=new Vector2();}
            if(this.parentContainer)
            {return this.parentContainer.pointToContainer(source,output);}
            var tempMatrix=this.tempTransformMatrix;tempMatrix.applyITRS(this.x,this.y,this.rotation,this.scaleX,this.scaleY);tempMatrix.invert();tempMatrix.transformPoint(source.x,source.y,output);return output;},getBoundsTransformMatrix:function()
        {return this.getWorldTransformMatrix(this.tempTransformMatrix,this.localTransform);},add:function(child)
        {ArrayUtils.Add(this.list,child,this.maxSize,this.addHandler,this);return this;},addAt:function(child,index)
        {ArrayUtils.AddAt(this.list,child,index,this.maxSize,this.addHandler,this);return this;},getAt:function(index)
        {return this.list[index];},getIndex:function(child)
        {return this.list.indexOf(child);},sort:function(property)
        {if(property)
        {this._sortKey=property;ArrayUtils.StableSort.inplace(this.list,this.sortHandler);}
            return this;},sortHandler:function(childA,childB)
        {return childA[this._sortKey]-childB[this._sortKey];},getByName:function(name)
        {return ArrayUtils.GetFirst(this.list,'name',name);},getRandom:function(startIndex,length)
        {return ArrayUtils.GetRandom(this.list,startIndex,length);},getFirst:function(property,value,startIndex,endIndex)
        {return ArrayUtils.GetFirst(this.list,property,value,startIndex,endIndex);},getAll:function(property,value,startIndex,endIndex)
        {return ArrayUtils.GetAll(this.list,property,value,startIndex,endIndex);},count:function(property,value,startIndex,endIndex)
        {return ArrayUtils.CountAllMatching(this.list,property,value,startIndex,endIndex);},swap:function(child1,child2)
        {ArrayUtils.Swap(this.list,child1,child2);return this;},moveTo:function(child,index)
        {ArrayUtils.MoveTo(this.list,child,index);return this;},remove:function(child,destroyChild)
        {var removed=ArrayUtils.Remove(this.list,child,this.removeHandler,this);if(destroyChild&&removed)
        {if(!Array.isArray(removed))
        {removed=[removed];}
            for(var i=0;i<removed.length;i++)
            {removed[i].destroy();}}
            return this;},removeAt:function(index,destroyChild)
        {var removed=ArrayUtils.RemoveAt(this.list,index,this.removeHandler,this);if(destroyChild&&removed)
        {removed.destroy();}
            return this;},removeBetween:function(startIndex,endIndex,destroyChild)
        {var removed=ArrayUtils.RemoveBetween(this.list,startIndex,endIndex,this.removeHandler,this);if(destroyChild)
        {for(var i=0;i<removed.length;i++)
        {removed[i].destroy();}}
            return this;},removeAll:function(destroyChild)
        {var removed=ArrayUtils.RemoveBetween(this.list,0,this.list.length,this.removeHandler,this);if(destroyChild)
        {for(var i=0;i<removed.length;i++)
        {removed[i].destroy();}}
            return this;},bringToTop:function(child)
        {ArrayUtils.BringToTop(this.list,child);return this;},sendToBack:function(child)
        {ArrayUtils.SendToBack(this.list,child);return this;},moveUp:function(child)
        {ArrayUtils.MoveUp(this.list,child);return this;},moveDown:function(child)
        {ArrayUtils.MoveDown(this.list,child);return this;},reverse:function()
        {this.list.reverse();return this;},shuffle:function()
        {ArrayUtils.Shuffle(this.list);return this;},replace:function(oldChild,newChild,destroyChild)
        {var moved=ArrayUtils.Replace(this.list,oldChild,newChild);if(moved)
        {this.addHandler(newChild);this.removeHandler(oldChild);if(destroyChild)
        {oldChild.destroy();}}
            return this;},exists:function(child)
        {return(this.list.indexOf(child)>-1);},setAll:function(property,value,startIndex,endIndex)
        {ArrayUtils.SetAll(this.list,property,value,startIndex,endIndex);return this;},each:function(callback,context)
        {var args=[null];var i;var temp=this.list.slice();var len=temp.length;for(i=2;i<arguments.length;i++)
        {args.push(arguments[i]);}
            for(i=0;i<len;i++)
            {args[0]=temp[i];callback.apply(context,args);}
            return this;},iterate:function(callback,context)
        {var args=[null];var i;for(i=2;i<arguments.length;i++)
        {args.push(arguments[i]);}
            for(i=0;i<this.list.length;i++)
            {args[0]=this.list[i];callback.apply(context,args);}
            return this;},length:{get:function()
            {return this.list.length;}},first:{get:function()
            {this.position=0;if(this.list.length>0)
            {return this.list[0];}
            else
            {return null;}}},last:{get:function()
            {if(this.list.length>0)
            {this.position=this.list.length-1;return this.list[this.position];}
            else
            {return null;}}},next:{get:function()
            {if(this.position<this.list.length)
            {this.position++;return this.list[this.position];}
            else
            {return null;}}},previous:{get:function()
            {if(this.position>0)
            {this.position--;return this.list[this.position];}
            else
            {return null;}}},preDestroy:function()
        {this.removeAll(!!this.exclusive);this.localTransform.destroy();this.tempTransformMatrix.destroy();this.list=[];this._displayList=null;}});module.exports=Container;}),"./gameobjects/container/ContainerCanvasRenderer.js":(function(module,exports){var ContainerCanvasRenderer=function(renderer,container,interpolationPercentage,camera,parentMatrix)
    {var children=container.list;if(children.length===0)
    {return;}
        var transformMatrix=container.localTransform;if(parentMatrix)
    {transformMatrix.loadIdentity();transformMatrix.multiply(parentMatrix);transformMatrix.translate(container.x,container.y);transformMatrix.rotate(container.rotation);transformMatrix.scale(container.scaleX,container.scaleY);}
    else
    {transformMatrix.applyITRS(container.x,container.y,container.rotation,container.scaleX,container.scaleY);}
        var containerHasBlendMode=(container.blendMode!==-1);if(!containerHasBlendMode)
    {renderer.setBlendMode(0);}
        var alpha=container._alpha;var scrollFactorX=container.scrollFactorX;var scrollFactorY=container.scrollFactorY;for(var i=0;i<children.length;i++)
    {var child=children[i];if(!child.willRender(camera))
    {continue;}
        var childAlpha=child._alpha;var childBlendMode=child._blendMode;var childScrollFactorX=child.scrollFactorX;var childScrollFactorY=child.scrollFactorY;child.setScrollFactor(childScrollFactorX*scrollFactorX,childScrollFactorY*scrollFactorY);child.setAlpha(childAlpha*alpha);if(containerHasBlendMode)
    {child.setBlendMode(container._blendMode);}
        child.renderCanvas(renderer,child,interpolationPercentage,camera,transformMatrix);child.setAlpha(childAlpha);child.setScrollFactor(childScrollFactorX,childScrollFactorY);child.setBlendMode(childBlendMode);}};module.exports=ContainerCanvasRenderer;}),"./gameobjects/container/ContainerCreator.js":(function(module,exports,__webpack_require__){var BuildGameObject=__webpack_require__("./gameobjects/BuildGameObject.js");var Container=__webpack_require__("./gameobjects/container/Container.js");var GameObjectCreator=__webpack_require__("./gameobjects/GameObjectCreator.js");var GetAdvancedValue=__webpack_require__("./utils/object/GetAdvancedValue.js");GameObjectCreator.register('container',function(config,addToScene)
    {if(config===undefined){config={};}
        var x=GetAdvancedValue(config,'x',0);var y=GetAdvancedValue(config,'y',0);var container=new Container(this.scene,x,y);if(addToScene!==undefined)
    {config.add=addToScene;}
        BuildGameObject(this.scene,container,config);return container;});}),"./gameobjects/container/ContainerFactory.js":(function(module,exports,__webpack_require__){var Container=__webpack_require__("./gameobjects/container/Container.js");var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");GameObjectFactory.register('container',function(x,y,children)
    {return this.displayList.add(new Container(this.scene,x,y,children));});}),"./gameobjects/container/ContainerRender.js":(function(module,exports,__webpack_require__){var renderWebGL=__webpack_require__("./utils/NOOP.js");var renderCanvas=__webpack_require__("./utils/NOOP.js");if(true)
    {renderWebGL=__webpack_require__("./gameobjects/container/ContainerWebGLRenderer.js");}
        if(true)
        {renderCanvas=__webpack_require__("./gameobjects/container/ContainerCanvasRenderer.js");}
        module.exports={renderWebGL:renderWebGL,renderCanvas:renderCanvas};}),"./gameobjects/container/ContainerWebGLRenderer.js":(function(module,exports){var ContainerWebGLRenderer=function(renderer,container,interpolationPercentage,camera,parentMatrix)
    {var children=container.list;if(children.length===0)
    {return;}
        var transformMatrix=container.localTransform;if(parentMatrix)
    {transformMatrix.loadIdentity();transformMatrix.multiply(parentMatrix);transformMatrix.translate(container.x,container.y);transformMatrix.rotate(container.rotation);transformMatrix.scale(container.scaleX,container.scaleY);}
    else
    {transformMatrix.applyITRS(container.x,container.y,container.rotation,container.scaleX,container.scaleY);}
        var containerHasBlendMode=(container.blendMode!==-1);if(!containerHasBlendMode)
    {renderer.setBlendMode(0);}
        var alpha=container._alpha;var scrollFactorX=container.scrollFactorX;var scrollFactorY=container.scrollFactorY;for(var i=0;i<children.length;i++)
    {var child=children[i];if(!child.willRender(camera))
    {continue;}
        var childAlpha=child._alpha;var childScrollFactorX=child.scrollFactorX;var childScrollFactorY=child.scrollFactorY;if(!containerHasBlendMode&&child.blendMode!==renderer.currentBlendMode)
    {renderer.setBlendMode(child.blendMode);}
        child.setScrollFactor(childScrollFactorX*scrollFactorX,childScrollFactorY*scrollFactorY);child.setAlpha(childAlpha*alpha);child.renderWebGL(renderer,child,interpolationPercentage,camera,transformMatrix);child.setAlpha(childAlpha);child.setScrollFactor(childScrollFactorX,childScrollFactorY);}};module.exports=ContainerWebGLRenderer;}),"./gameobjects/domelement/CSSBlendModes.js":(function(module,exports){module.exports=['normal','multiply','multiply','screen','overlay','darken','lighten','color-dodge','color-burn','hard-light','soft-light','difference','exclusion','hue','saturation','color','luminosity'];}),"./gameobjects/domelement/DOMElement.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Components=__webpack_require__("./gameobjects/components/index.js");var DOMElementRender=__webpack_require__("./gameobjects/domelement/DOMElementRender.js");var GameObject=__webpack_require__("./gameobjects/GameObject.js");var RemoveFromDOM=__webpack_require__("./dom/RemoveFromDOM.js");var Vector4=__webpack_require__("./math/Vector4.js");var DOMElement=new Class({Extends:GameObject,Mixins:[Components.Alpha,Components.BlendMode,Components.ComputedSize,Components.Depth,Components.Origin,Components.ScrollFactor,Components.Transform,Components.Visible,DOMElementRender],initialize:function DOMElement(scene,x,y,element)
        {GameObject.call(this,scene,'DOMElement');this.parent=scene.sys.game.domContainer;this.cache=scene.sys.cache.html;this.node;this.skewX=0;this.skewY=0;this.rotate3d=new Vector4();this.rotate3dAngle='deg';this.handler=this.dispatchNativeEvent.bind(this);this.setPosition(x,y);if(element)
        {this.setElement(element);}},setSkew:function(x,y)
        {if(x===undefined){x=0;}
            if(y===undefined){y=x;}
            this.skewX=x;this.skewY=y;return this;},perspective:{get:function()
            {return parseFloat(this.parent.style.perspective);},set:function(value)
            {this.parent.style.perspective=value+'px';}},setPerspective:function(value)
        {this.parent.style.perspective=value+'px';return this;},addListener:function(events)
        {if(this.node)
        {events=events.split(' ');for(var i=0;i<events.length;i++)
        {this.node.addEventListener(events[i],this.handler,false);}}
            return this;},removeListener:function(events)
        {if(this.node)
        {events=events.split(' ');for(var i=0;i<events.length;i++)
        {this.node.removeEventListener(events[i],this.handler);}}
            return this;},dispatchNativeEvent:function(event)
        {this.emit(event.type,event);},setElement:function(element)
        {var target;if(typeof element==='string')
        {target=document.getElementById(element);}
        else if(typeof element==='object'&&element.nodeType===1)
        {target=element;}
            if(!target)
            {return;}
            this.node=target;target.style.zIndex='0';target.style.display='inline';target.style.position='absolute';target.phaser=this;if(this.parent)
        {this.parent.appendChild(target);}
            var nodeBounds=target.getBoundingClientRect();this.setSize(nodeBounds.width||0,nodeBounds.height||0);return this;},createFromCache:function(key,elementType)
        {return this.createFromHTML(this.cache.get(key),elementType);},createFromHTML:function(html,elementType)
        {if(elementType===undefined){elementType='div';}
            var element=document.createElement(elementType);this.node=element;element.style.zIndex='0';element.style.display='inline';element.style.position='absolute';element.phaser=this;if(this.parent)
        {this.parent.appendChild(element);}
            element.innerHTML=html;var nodeBounds=element.getBoundingClientRect();this.setSize(nodeBounds.width||0,nodeBounds.height||0);return this;},getChildByProperty:function(property,value)
        {if(this.node)
        {var children=this.node.querySelectorAll('*');for(var i=0;i<children.length;i++)
        {if(children[i][property]===value)
        {return children[i];}}}
            return null;},getChildByID:function(id)
        {return this.getChildByProperty('id',id);},getChildByName:function(name)
        {return this.getChildByProperty('name',name);},setText:function(text)
        {if(this.node)
        {this.node.innerText=text;var nodeBounds=this.node.getBoundingClientRect();this.setSize(nodeBounds.width,nodeBounds.height);}
            return this;},setHTML:function(html)
        {if(this.node)
        {this.node.innerHTML=html;var nodeBounds=this.node.getBoundingClientRect();this.setSize(nodeBounds.width,nodeBounds.height);}
            return this;},willRender:function()
        {return true;},destroy:function()
        {RemoveFromDOM(this.node);}});module.exports=DOMElement;}),"./gameobjects/domelement/DOMElementCSSRenderer.js":(function(module,exports,__webpack_require__){var CSSBlendModes=__webpack_require__("./gameobjects/domelement/CSSBlendModes.js");var GameObject=__webpack_require__("./gameobjects/GameObject.js");var DOMElementCSSRenderer=function(renderer,src,interpolationPercentage,camera)
    {var node=src.node;if(!node||GameObject.RENDER_MASK!==src.renderFlags||(src.cameraFilter!==0&&(src.cameraFilter&camera.id)))
    {if(node)
    {node.style.display='none';}
        return;}
        var camMatrix=renderer._tempMatrix1;var spriteMatrix=renderer._tempMatrix2;var calcMatrix=renderer._tempMatrix3;var x=src.originX*src.width;var y=src.originY*src.height;spriteMatrix.applyITRS(src.x-x-(camera.scrollX*src.scrollFactorX),src.y-y-(camera.scrollY*src.scrollFactorY),src.rotation,src.scaleX,src.scaleY);camMatrix.copyFrom(camera.matrix);camMatrix.multiply(spriteMatrix,calcMatrix);node.style.display='block';node.style.opacity=src.alpha;node.style.zIndex=src._depth;node.style.pointerEvents='auto';node.style.mixBlendMode=CSSBlendModes[src._blendMode];node.style.transform=calcMatrix.getCSSMatrix()+' skew('+src.skewX+'rad, '+src.skewY+'rad)'+' rotate3d('+src.rotate3d.x+','+src.rotate3d.y+','+src.rotate3d.z+','+src.rotate3d.w+src.rotate3dAngle+')';node.style.transformOrigin=(100*src.originX)+'% '+(100*src.originY)+'%';};module.exports=DOMElementCSSRenderer;}),"./gameobjects/domelement/DOMElementFactory.js":(function(module,exports,__webpack_require__){var DOMElement=__webpack_require__("./gameobjects/domelement/DOMElement.js");var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");GameObjectFactory.register('dom',function(x,y,element)
    {return this.displayList.add(new DOMElement(this.scene,x,y,element));});}),"./gameobjects/domelement/DOMElementRender.js":(function(module,exports,__webpack_require__){var renderWebGL=__webpack_require__("./utils/NOOP.js");var renderCanvas=__webpack_require__("./utils/NOOP.js");if(true)
    {renderWebGL=__webpack_require__("./gameobjects/domelement/DOMElementCSSRenderer.js");}
        if(true)
        {renderCanvas=__webpack_require__("./gameobjects/domelement/DOMElementCSSRenderer.js");}
        module.exports={renderWebGL:renderWebGL,renderCanvas:renderCanvas};}),"./gameobjects/extern/Extern.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Components=__webpack_require__("./gameobjects/components/index.js");var GameObject=__webpack_require__("./gameobjects/GameObject.js");var ExternRender=__webpack_require__("./gameobjects/extern/ExternRender.js");var Extern=new Class({Extends:GameObject,Mixins:[Components.Alpha,Components.BlendMode,Components.Depth,Components.Flip,Components.Origin,Components.ScaleMode,Components.ScrollFactor,Components.Size,Components.Texture,Components.Tint,Components.Transform,Components.Visible,ExternRender],initialize:function Extern(scene)
        {GameObject.call(this,scene,'Extern');},preUpdate:function()
        {},render:function()
        {}});module.exports=Extern;}),"./gameobjects/extern/ExternCanvasRenderer.js":(function(module,exports){}),"./gameobjects/extern/ExternFactory.js":(function(module,exports,__webpack_require__){var Extern=__webpack_require__("./gameobjects/extern/Extern.js");var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");GameObjectFactory.register('extern',function()
    {var extern=new Extern(this.scene);this.displayList.add(extern);this.updateList.add(extern);return extern;});}),"./gameobjects/extern/ExternRender.js":(function(module,exports,__webpack_require__){var renderWebGL=__webpack_require__("./utils/NOOP.js");var renderCanvas=__webpack_require__("./utils/NOOP.js");if(true)
    {renderWebGL=__webpack_require__("./gameobjects/extern/ExternWebGLRenderer.js");}
        if(true)
        {renderCanvas=__webpack_require__("./gameobjects/extern/ExternCanvasRenderer.js");}
        module.exports={renderWebGL:renderWebGL,renderCanvas:renderCanvas};}),"./gameobjects/extern/ExternWebGLRenderer.js":(function(module,exports){var ExternWebGLRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var pipeline=renderer.currentPipeline;renderer.clearPipeline();var camMatrix=renderer._tempMatrix1;var spriteMatrix=renderer._tempMatrix2;var calcMatrix=renderer._tempMatrix3;spriteMatrix.applyITRS(src.x,src.y,src.rotation,src.scaleX,src.scaleY);camMatrix.copyFrom(camera.matrix);if(parentMatrix)
    {camMatrix.multiplyWithOffset(parentMatrix,-camera.scrollX*src.scrollFactorX,-camera.scrollY*src.scrollFactorY);spriteMatrix.e=src.x;spriteMatrix.f=src.y;camMatrix.multiply(spriteMatrix,calcMatrix);}
    else
    {spriteMatrix.e-=camera.scrollX*src.scrollFactorX;spriteMatrix.f-=camera.scrollY*src.scrollFactorY;camMatrix.multiply(spriteMatrix,calcMatrix);}
        src.render.call(src,renderer,camera,calcMatrix);renderer.rebindPipeline(pipeline);};module.exports=ExternWebGLRenderer;}),"./gameobjects/graphics/Commands.js":(function(module,exports){module.exports={ARC:0,BEGIN_PATH:1,CLOSE_PATH:2,FILL_RECT:3,LINE_TO:4,MOVE_TO:5,LINE_STYLE:6,FILL_STYLE:7,FILL_PATH:8,STROKE_PATH:9,FILL_TRIANGLE:10,STROKE_TRIANGLE:11,LINE_FX_TO:12,MOVE_FX_TO:13,SAVE:14,RESTORE:15,TRANSLATE:16,SCALE:17,ROTATE:18,SET_TEXTURE:19,CLEAR_TEXTURE:20,GRADIENT_FILL_STYLE:21,GRADIENT_LINE_STYLE:22};}),"./gameobjects/graphics/Graphics.js":(function(module,exports,__webpack_require__){var BaseCamera=__webpack_require__("./cameras/2d/BaseCamera.js");var Class=__webpack_require__("./utils/Class.js");var Commands=__webpack_require__("./gameobjects/graphics/Commands.js");var ComponentsAlpha=__webpack_require__("./gameobjects/components/Alpha.js");var ComponentsBlendMode=__webpack_require__("./gameobjects/components/BlendMode.js");var ComponentsDepth=__webpack_require__("./gameobjects/components/Depth.js");var ComponentsMask=__webpack_require__("./gameobjects/components/Mask.js");var ComponentsPipeline=__webpack_require__("./gameobjects/components/Pipeline.js");var ComponentsTransform=__webpack_require__("./gameobjects/components/Transform.js");var ComponentsVisible=__webpack_require__("./gameobjects/components/Visible.js");var ComponentsScrollFactor=__webpack_require__("./gameobjects/components/ScrollFactor.js");var Ellipse=__webpack_require__("./geom/ellipse/Ellipse.js");var GameObject=__webpack_require__("./gameobjects/GameObject.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var GetValue=__webpack_require__("./utils/object/GetValue.js");var MATH_CONST=__webpack_require__("./math/const.js");var Render=__webpack_require__("./gameobjects/graphics/GraphicsRender.js");var Graphics=new Class({Extends:GameObject,Mixins:[ComponentsAlpha,ComponentsBlendMode,ComponentsDepth,ComponentsMask,ComponentsPipeline,ComponentsTransform,ComponentsVisible,ComponentsScrollFactor,Render],initialize:function Graphics(scene,options)
        {var x=GetValue(options,'x',0);var y=GetValue(options,'y',0);GameObject.call(this,scene,'Graphics');this.setPosition(x,y);this.initPipeline();this.displayOriginX=0;this.displayOriginY=0;this.commandBuffer=[];this.defaultFillColor=-1;this.defaultFillAlpha=1;this.defaultStrokeWidth=1;this.defaultStrokeColor=-1;this.defaultStrokeAlpha=1;this._lineWidth=1.0;this.setDefaultStyles(options);},setDefaultStyles:function(options)
        {if(GetValue(options,'lineStyle',null))
        {this.defaultStrokeWidth=GetValue(options,'lineStyle.width',1);this.defaultStrokeColor=GetValue(options,'lineStyle.color',0xffffff);this.defaultStrokeAlpha=GetValue(options,'lineStyle.alpha',1);this.lineStyle(this.defaultStrokeWidth,this.defaultStrokeColor,this.defaultStrokeAlpha);}
            if(GetValue(options,'fillStyle',null))
            {this.defaultFillColor=GetValue(options,'fillStyle.color',0xffffff);this.defaultFillAlpha=GetValue(options,'fillStyle.alpha',1);this.fillStyle(this.defaultFillColor,this.defaultFillAlpha);}
            return this;},lineStyle:function(lineWidth,color,alpha)
        {if(alpha===undefined){alpha=1;}
            this.commandBuffer.push(Commands.LINE_STYLE,lineWidth,color,alpha);this._lineWidth=lineWidth;return this;},fillStyle:function(color,alpha)
        {if(alpha===undefined){alpha=1;}
            this.commandBuffer.push(Commands.FILL_STYLE,color,alpha);return this;},fillGradientStyle:function(topLeft,topRight,bottomLeft,bottomRight,alpha)
        {if(alpha===undefined){alpha=1;}
            this.commandBuffer.push(Commands.GRADIENT_FILL_STYLE,alpha,topLeft,topRight,bottomLeft,bottomRight);return this;},lineGradientStyle:function(lineWidth,topLeft,topRight,bottomLeft,bottomRight,alpha)
        {if(alpha===undefined){alpha=1;}
            this.commandBuffer.push(Commands.GRADIENT_LINE_STYLE,lineWidth,alpha,topLeft,topRight,bottomLeft,bottomRight);return this;},setTexture:function(key,frame,mode)
        {if(mode===undefined){mode=0;}
            if(key===undefined)
            {this.commandBuffer.push(Commands.CLEAR_TEXTURE);}
            else
            {var textureFrame=this.scene.sys.textures.getFrame(key,frame);if(textureFrame)
            {if(mode===2)
            {mode=3;}
                this.commandBuffer.push(Commands.SET_TEXTURE,textureFrame,mode);}}
            return this;},beginPath:function()
        {this.commandBuffer.push(Commands.BEGIN_PATH);return this;},closePath:function()
        {this.commandBuffer.push(Commands.CLOSE_PATH);return this;},fillPath:function()
        {this.commandBuffer.push(Commands.FILL_PATH);return this;},fill:function()
        {this.commandBuffer.push(Commands.FILL_PATH);return this;},strokePath:function()
        {this.commandBuffer.push(Commands.STROKE_PATH);return this;},stroke:function()
        {this.commandBuffer.push(Commands.STROKE_PATH);return this;},fillCircleShape:function(circle)
        {return this.fillCircle(circle.x,circle.y,circle.radius);},strokeCircleShape:function(circle)
        {return this.strokeCircle(circle.x,circle.y,circle.radius);},fillCircle:function(x,y,radius)
        {this.beginPath();this.arc(x,y,radius,0,MATH_CONST.PI2);this.fillPath();return this;},strokeCircle:function(x,y,radius)
        {this.beginPath();this.arc(x,y,radius,0,MATH_CONST.PI2);this.strokePath();return this;},fillRectShape:function(rect)
        {return this.fillRect(rect.x,rect.y,rect.width,rect.height);},strokeRectShape:function(rect)
        {return this.strokeRect(rect.x,rect.y,rect.width,rect.height);},fillRect:function(x,y,width,height)
        {this.commandBuffer.push(Commands.FILL_RECT,x,y,width,height);return this;},strokeRect:function(x,y,width,height)
        {var lineWidthHalf=this._lineWidth / 2;var minx=x-lineWidthHalf;var maxx=x+lineWidthHalf;this.beginPath();this.moveTo(x,y);this.lineTo(x,y+height);this.strokePath();this.beginPath();this.moveTo(x+width,y);this.lineTo(x+width,y+height);this.strokePath();this.beginPath();this.moveTo(minx,y);this.lineTo(maxx+width,y);this.strokePath();this.beginPath();this.moveTo(minx,y+height);this.lineTo(maxx+width,y+height);this.strokePath();return this;},fillRoundedRect:function(x,y,width,height,radius)
        {if(radius===undefined){radius=20;}
            var tl=radius;var tr=radius;var bl=radius;var br=radius;if(typeof radius!=='number')
        {tl=GetFastValue(radius,'tl',20);tr=GetFastValue(radius,'tr',20);bl=GetFastValue(radius,'bl',20);br=GetFastValue(radius,'br',20);}
            this.beginPath();this.moveTo(x+tl,y);this.lineTo(x+width-tr,y);this.arc(x+width-tr,y+tr,tr,-MATH_CONST.TAU,0);this.lineTo(x+width,y+height-br);this.arc(x+width-br,y+height-br,br,0,MATH_CONST.TAU);this.lineTo(x+bl,y+height);this.arc(x+bl,y+height-bl,bl,MATH_CONST.TAU,Math.PI);this.lineTo(x,y+tl);this.arc(x+tl,y+tl,tl,-Math.PI,-MATH_CONST.TAU);this.fillPath();return this;},strokeRoundedRect:function(x,y,width,height,radius)
        {if(radius===undefined){radius=20;}
            var tl=radius;var tr=radius;var bl=radius;var br=radius;if(typeof radius!=='number')
        {tl=GetFastValue(radius,'tl',20);tr=GetFastValue(radius,'tr',20);bl=GetFastValue(radius,'bl',20);br=GetFastValue(radius,'br',20);}
            this.beginPath();this.moveTo(x+tl,y);this.lineTo(x+width-tr,y);this.arc(x+width-tr,y+tr,tr,-MATH_CONST.TAU,0);this.lineTo(x+width,y+height-br);this.arc(x+width-br,y+height-br,br,0,MATH_CONST.TAU);this.lineTo(x+bl,y+height);this.arc(x+bl,y+height-bl,bl,MATH_CONST.TAU,Math.PI);this.lineTo(x,y+tl);this.arc(x+tl,y+tl,tl,-Math.PI,-MATH_CONST.TAU);this.strokePath();return this;},fillPointShape:function(point,size)
        {return this.fillPoint(point.x,point.y,size);},fillPoint:function(x,y,size)
        {if(!size||size<1)
        {size=1;}
        else
        {x-=(size / 2);y-=(size / 2);}
            this.commandBuffer.push(Commands.FILL_RECT,x,y,size,size);return this;},fillTriangleShape:function(triangle)
        {return this.fillTriangle(triangle.x1,triangle.y1,triangle.x2,triangle.y2,triangle.x3,triangle.y3);},strokeTriangleShape:function(triangle)
        {return this.strokeTriangle(triangle.x1,triangle.y1,triangle.x2,triangle.y2,triangle.x3,triangle.y3);},fillTriangle:function(x0,y0,x1,y1,x2,y2)
        {this.commandBuffer.push(Commands.FILL_TRIANGLE,x0,y0,x1,y1,x2,y2);return this;},strokeTriangle:function(x0,y0,x1,y1,x2,y2)
        {this.commandBuffer.push(Commands.STROKE_TRIANGLE,x0,y0,x1,y1,x2,y2);return this;},strokeLineShape:function(line)
        {return this.lineBetween(line.x1,line.y1,line.x2,line.y2);},lineBetween:function(x1,y1,x2,y2)
        {this.beginPath();this.moveTo(x1,y1);this.lineTo(x2,y2);this.strokePath();return this;},lineTo:function(x,y)
        {this.commandBuffer.push(Commands.LINE_TO,x,y);return this;},moveTo:function(x,y)
        {this.commandBuffer.push(Commands.MOVE_TO,x,y);return this;},lineFxTo:function(x,y,width,rgb)
        {this.commandBuffer.push(Commands.LINE_FX_TO,x,y,width,rgb,1);return this;},moveFxTo:function(x,y,width,rgb)
        {this.commandBuffer.push(Commands.MOVE_FX_TO,x,y,width,rgb,1);return this;},strokePoints:function(points,autoClose,endIndex)
        {if(autoClose===undefined){autoClose=false;}
            if(endIndex===undefined){endIndex=points.length;}
            this.beginPath();this.moveTo(points[0].x,points[0].y);for(var i=1;i<endIndex;i++)
        {this.lineTo(points[i].x,points[i].y);}
            if(autoClose)
            {this.lineTo(points[0].x,points[0].y);}
            this.strokePath();return this;},fillPoints:function(points,autoClose,endIndex)
        {if(autoClose===undefined){autoClose=false;}
            if(endIndex===undefined){endIndex=points.length;}
            this.beginPath();this.moveTo(points[0].x,points[0].y);for(var i=1;i<endIndex;i++)
        {this.lineTo(points[i].x,points[i].y);}
            if(autoClose)
            {this.lineTo(points[0].x,points[0].y);}
            this.fillPath();return this;},strokeEllipseShape:function(ellipse,smoothness)
        {if(smoothness===undefined){smoothness=32;}
            var points=ellipse.getPoints(smoothness);return this.strokePoints(points,true);},strokeEllipse:function(x,y,width,height,smoothness)
        {if(smoothness===undefined){smoothness=32;}
            var ellipse=new Ellipse(x,y,width,height);var points=ellipse.getPoints(smoothness);return this.strokePoints(points,true);},fillEllipseShape:function(ellipse,smoothness)
        {if(smoothness===undefined){smoothness=32;}
            var points=ellipse.getPoints(smoothness);return this.fillPoints(points,true);},fillEllipse:function(x,y,width,height,smoothness)
        {if(smoothness===undefined){smoothness=32;}
            var ellipse=new Ellipse(x,y,width,height);var points=ellipse.getPoints(smoothness);return this.fillPoints(points,true);},arc:function(x,y,radius,startAngle,endAngle,anticlockwise,overshoot)
        {if(anticlockwise===undefined){anticlockwise=false;}
            if(overshoot===undefined){overshoot=0;}
            this.commandBuffer.push(Commands.ARC,x,y,radius,startAngle,endAngle,anticlockwise,overshoot);return this;},slice:function(x,y,radius,startAngle,endAngle,anticlockwise,overshoot)
        {if(anticlockwise===undefined){anticlockwise=false;}
            if(overshoot===undefined){overshoot=0;}
            this.commandBuffer.push(Commands.BEGIN_PATH);this.commandBuffer.push(Commands.MOVE_TO,x,y);this.commandBuffer.push(Commands.ARC,x,y,radius,startAngle,endAngle,anticlockwise,overshoot);this.commandBuffer.push(Commands.CLOSE_PATH);return this;},save:function()
        {this.commandBuffer.push(Commands.SAVE);return this;},restore:function()
        {this.commandBuffer.push(Commands.RESTORE);return this;},translate:function(x,y)
        {this.commandBuffer.push(Commands.TRANSLATE,x,y);return this;},scale:function(x,y)
        {this.commandBuffer.push(Commands.SCALE,x,y);return this;},rotate:function(radians)
        {this.commandBuffer.push(Commands.ROTATE,radians);return this;},clear:function()
        {this.commandBuffer.length=0;if(this.defaultFillColor>-1)
        {this.fillStyle(this.defaultFillColor,this.defaultFillAlpha);}
            if(this.defaultStrokeColor>-1)
            {this.lineStyle(this.defaultStrokeWidth,this.defaultStrokeColor,this.defaultStrokeAlpha);}
            return this;},generateTexture:function(key,width,height)
        {var sys=this.scene.sys;var renderer=sys.game.renderer;if(width===undefined){width=sys.scale.width;}
            if(height===undefined){height=sys.scale.height;}
            Graphics.TargetCamera.setScene(this.scene);Graphics.TargetCamera.setViewport(0,0,width,height);Graphics.TargetCamera.scrollX=this.x;Graphics.TargetCamera.scrollY=this.y;var texture;var ctx;if(typeof key==='string')
        {if(sys.textures.exists(key))
        {texture=sys.textures.get(key);var src=texture.getSourceImage();if(src instanceof HTMLCanvasElement)
        {ctx=src.getContext('2d');}}
        else
        {texture=sys.textures.createCanvas(key,width,height);ctx=texture.getSourceImage().getContext('2d');}}
        else if(key instanceof HTMLCanvasElement)
        {ctx=key.getContext('2d');}
            if(ctx)
            {this.renderCanvas(renderer,this,0,Graphics.TargetCamera,null,ctx,false);if(texture)
            {texture.refresh();}}
            return this;},preDestroy:function()
        {this.commandBuffer=[];}});Graphics.TargetCamera=new BaseCamera();module.exports=Graphics;}),"./gameobjects/graphics/GraphicsCanvasRenderer.js":(function(module,exports,__webpack_require__){var Commands=__webpack_require__("./gameobjects/graphics/Commands.js");var SetTransform=__webpack_require__("./renderer/canvas/utils/SetTransform.js");var GraphicsCanvasRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix,renderTargetCtx,allowClip)
    {var commandBuffer=src.commandBuffer;var commandBufferLength=commandBuffer.length;var ctx=renderTargetCtx||renderer.currentContext;if(commandBufferLength===0||!SetTransform(renderer,ctx,src,camera,parentMatrix))
    {return;}
        var lineAlpha=1;var fillAlpha=1;var lineColor=0;var fillColor=0;var lineWidth=1;var red=0;var green=0;var blue=0;ctx.beginPath();for(var index=0;index<commandBufferLength;++index)
    {var commandID=commandBuffer[index];switch(commandID)
    {case Commands.ARC:ctx.arc(commandBuffer[index+1],commandBuffer[index+2],commandBuffer[index+3],commandBuffer[index+4],commandBuffer[index+5],commandBuffer[index+6]);index+=7;break;case Commands.LINE_STYLE:lineWidth=commandBuffer[index+1];lineColor=commandBuffer[index+2];lineAlpha=commandBuffer[index+3];red=((lineColor&0xFF0000)>>>16);green=((lineColor&0xFF00)>>>8);blue=(lineColor&0xFF);ctx.strokeStyle='rgba('+red+','+green+','+blue+','+lineAlpha+')';ctx.lineWidth=lineWidth;index+=3;break;case Commands.FILL_STYLE:fillColor=commandBuffer[index+1];fillAlpha=commandBuffer[index+2];red=((fillColor&0xFF0000)>>>16);green=((fillColor&0xFF00)>>>8);blue=(fillColor&0xFF);ctx.fillStyle='rgba('+red+','+green+','+blue+','+fillAlpha+')';index+=2;break;case Commands.BEGIN_PATH:ctx.beginPath();break;case Commands.CLOSE_PATH:ctx.closePath();break;case Commands.FILL_PATH:if(!allowClip)
        {ctx.fill();}
            break;case Commands.STROKE_PATH:if(!allowClip)
        {ctx.stroke();}
            break;case Commands.FILL_RECT:if(!allowClip)
        {ctx.fillRect(commandBuffer[index+1],commandBuffer[index+2],commandBuffer[index+3],commandBuffer[index+4]);}
        else
        {ctx.rect(commandBuffer[index+1],commandBuffer[index+2],commandBuffer[index+3],commandBuffer[index+4]);}
            index+=4;break;case Commands.FILL_TRIANGLE:ctx.beginPath();ctx.moveTo(commandBuffer[index+1],commandBuffer[index+2]);ctx.lineTo(commandBuffer[index+3],commandBuffer[index+4]);ctx.lineTo(commandBuffer[index+5],commandBuffer[index+6]);ctx.closePath();if(!allowClip)
        {ctx.fill();}
            index+=6;break;case Commands.STROKE_TRIANGLE:ctx.beginPath();ctx.moveTo(commandBuffer[index+1],commandBuffer[index+2]);ctx.lineTo(commandBuffer[index+3],commandBuffer[index+4]);ctx.lineTo(commandBuffer[index+5],commandBuffer[index+6]);ctx.closePath();if(!allowClip)
        {ctx.stroke();}
            index+=6;break;case Commands.LINE_TO:ctx.lineTo(commandBuffer[index+1],commandBuffer[index+2]);index+=2;break;case Commands.MOVE_TO:ctx.moveTo(commandBuffer[index+1],commandBuffer[index+2]);index+=2;break;case Commands.LINE_FX_TO:ctx.lineTo(commandBuffer[index+1],commandBuffer[index+2]);index+=5;break;case Commands.MOVE_FX_TO:ctx.moveTo(commandBuffer[index+1],commandBuffer[index+2]);index+=5;break;case Commands.SAVE:ctx.save();break;case Commands.RESTORE:ctx.restore();break;case Commands.TRANSLATE:ctx.translate(commandBuffer[index+1],commandBuffer[index+2]);index+=2;break;case Commands.SCALE:ctx.scale(commandBuffer[index+1],commandBuffer[index+2]);index+=2;break;case Commands.ROTATE:ctx.rotate(commandBuffer[index+1]);index+=1;break;case Commands.GRADIENT_FILL_STYLE:index+=5;break;case Commands.GRADIENT_LINE_STYLE:index+=6;break;case Commands.SET_TEXTURE:index+=2;break;}}
        ctx.restore();};module.exports=GraphicsCanvasRenderer;}),"./gameobjects/graphics/GraphicsCreator.js":(function(module,exports,__webpack_require__){var GameObjectCreator=__webpack_require__("./gameobjects/GameObjectCreator.js");var Graphics=__webpack_require__("./gameobjects/graphics/Graphics.js");GameObjectCreator.register('graphics',function(config,addToScene)
    {if(config===undefined){config={};}
        if(addToScene!==undefined)
        {config.add=addToScene;}
        var graphics=new Graphics(this.scene,config);if(config.add)
    {this.scene.sys.displayList.add(graphics);}
        return graphics;});}),"./gameobjects/graphics/GraphicsFactory.js":(function(module,exports,__webpack_require__){var Graphics=__webpack_require__("./gameobjects/graphics/Graphics.js");var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");GameObjectFactory.register('graphics',function(config)
    {return this.displayList.add(new Graphics(this.scene,config));});}),"./gameobjects/graphics/GraphicsRender.js":(function(module,exports,__webpack_require__){var renderWebGL=__webpack_require__("./utils/NOOP.js");var renderCanvas=__webpack_require__("./utils/NOOP.js");if(true)
    {renderWebGL=__webpack_require__("./gameobjects/graphics/GraphicsWebGLRenderer.js");renderCanvas=__webpack_require__("./gameobjects/graphics/GraphicsCanvasRenderer.js");}
        if(true)
        {renderCanvas=__webpack_require__("./gameobjects/graphics/GraphicsCanvasRenderer.js");}
        module.exports={renderWebGL:renderWebGL,renderCanvas:renderCanvas};}),"./gameobjects/graphics/GraphicsWebGLRenderer.js":(function(module,exports,__webpack_require__){var Commands=__webpack_require__("./gameobjects/graphics/Commands.js");var Utils=__webpack_require__("./renderer/webgl/Utils.js");var Point=function(x,y,width)
    {this.x=x;this.y=y;this.width=width;};var Path=function(x,y,width)
    {this.points=[];this.pointsLength=1;this.points[0]=new Point(x,y,width);};var matrixStack=[];var GraphicsWebGLRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {if(src.commandBuffer.length===0)
    {return;}
        var pipeline=this.pipeline;var camMatrix=pipeline._tempMatrix1;var graphicsMatrix=pipeline._tempMatrix2;var currentMatrix=pipeline._tempMatrix4;renderer.setPipeline(pipeline);currentMatrix.loadIdentity();graphicsMatrix.applyITRS(src.x,src.y,src.rotation,src.scaleX,src.scaleY);camMatrix.copyFrom(camera.matrix);if(parentMatrix)
    {camMatrix.multiplyWithOffset(parentMatrix,-camera.scrollX*src.scrollFactorX,-camera.scrollY*src.scrollFactorY);graphicsMatrix.e=src.x;graphicsMatrix.f=src.y;camMatrix.multiply(graphicsMatrix);}
    else
    {graphicsMatrix.e-=camera.scrollX*src.scrollFactorX;graphicsMatrix.f-=camera.scrollY*src.scrollFactorY;camMatrix.multiply(graphicsMatrix);}
        var commands=src.commandBuffer;var alpha=camera.alpha*src.alpha;var lineWidth=1;var fillTint=pipeline.fillTint;var strokeTint=pipeline.strokeTint;var tx=0;var ty=0;var ta=0;var iterStep=0.01;var PI2=Math.PI*2;var cmd;var path=[];var pathIndex=0;var pathOpen=false;var lastPath=null;var getTint=Utils.getTintAppendFloatAlphaAndSwap;var currentTexture=renderer.blankTexture.glTexture;for(var cmdIndex=0;cmdIndex<commands.length;cmdIndex++)
    {cmd=commands[cmdIndex];switch(cmd)
    {case Commands.BEGIN_PATH:path.length=0;lastPath=null;pathOpen=true;break;case Commands.CLOSE_PATH:pathOpen=false;if(lastPath&&lastPath.points.length)
        {lastPath.points.push(lastPath.points[0]);}
            break;case Commands.FILL_PATH:for(pathIndex=0;pathIndex<path.length;pathIndex++)
        {pipeline.setTexture2D(currentTexture);pipeline.batchFillPath(path[pathIndex].points,currentMatrix,camMatrix);}
            break;case Commands.STROKE_PATH:for(pathIndex=0;pathIndex<path.length;pathIndex++)
        {pipeline.setTexture2D(currentTexture);pipeline.batchStrokePath(path[pathIndex].points,lineWidth,pathOpen,currentMatrix,camMatrix);}
            break;case Commands.LINE_STYLE:lineWidth=commands[++cmdIndex];var strokeColor=commands[++cmdIndex];var strokeAlpha=commands[++cmdIndex]*alpha;var strokeTintColor=getTint(strokeColor,strokeAlpha);strokeTint.TL=strokeTintColor;strokeTint.TR=strokeTintColor;strokeTint.BL=strokeTintColor;strokeTint.BR=strokeTintColor;break;case Commands.FILL_STYLE:var fillColor=commands[++cmdIndex];var fillAlpha=commands[++cmdIndex]*alpha;var fillTintColor=getTint(fillColor,fillAlpha);fillTint.TL=fillTintColor;fillTint.TR=fillTintColor;fillTint.BL=fillTintColor;fillTint.BR=fillTintColor;break;case Commands.GRADIENT_FILL_STYLE:var gradientFillAlpha=commands[++cmdIndex]*alpha;fillTint.TL=getTint(commands[++cmdIndex],gradientFillAlpha);fillTint.TR=getTint(commands[++cmdIndex],gradientFillAlpha);fillTint.BL=getTint(commands[++cmdIndex],gradientFillAlpha);fillTint.BR=getTint(commands[++cmdIndex],gradientFillAlpha);break;case Commands.GRADIENT_LINE_STYLE:lineWidth=commands[++cmdIndex];var gradientLineAlpha=commands[++cmdIndex]*alpha;strokeTint.TL=getTint(commands[++cmdIndex],gradientLineAlpha);strokeTint.TR=getTint(commands[++cmdIndex],gradientLineAlpha);strokeTint.BL=getTint(commands[++cmdIndex],gradientLineAlpha);strokeTint.BR=getTint(commands[++cmdIndex],gradientLineAlpha);break;case Commands.ARC:var iteration=0;var x=commands[++cmdIndex];var y=commands[++cmdIndex];var radius=commands[++cmdIndex];var startAngle=commands[++cmdIndex];var endAngle=commands[++cmdIndex];var anticlockwise=commands[++cmdIndex];var overshoot=commands[++cmdIndex];endAngle-=startAngle;if(anticlockwise)
        {if(endAngle<-PI2)
        {endAngle=-PI2;}
        else if(endAngle>0)
        {endAngle=-PI2+endAngle%PI2;}}
        else if(endAngle>PI2)
        {endAngle=PI2;}
        else if(endAngle<0)
        {endAngle=PI2+endAngle%PI2;}
            if(lastPath===null)
            {lastPath=new Path(x+Math.cos(startAngle)*radius,y+Math.sin(startAngle)*radius,lineWidth);path.push(lastPath);iteration+=iterStep;}
            while(iteration<1+overshoot)
            {ta=endAngle*iteration+startAngle;tx=x+Math.cos(ta)*radius;ty=y+Math.sin(ta)*radius;lastPath.points.push(new Point(tx,ty,lineWidth));iteration+=iterStep;}
            ta=endAngle+startAngle;tx=x+Math.cos(ta)*radius;ty=y+Math.sin(ta)*radius;lastPath.points.push(new Point(tx,ty,lineWidth));break;case Commands.FILL_RECT:pipeline.setTexture2D(currentTexture);pipeline.batchFillRect(commands[++cmdIndex],commands[++cmdIndex],commands[++cmdIndex],commands[++cmdIndex],currentMatrix,camMatrix);break;case Commands.FILL_TRIANGLE:pipeline.setTexture2D(currentTexture);pipeline.batchFillTriangle(commands[++cmdIndex],commands[++cmdIndex],commands[++cmdIndex],commands[++cmdIndex],commands[++cmdIndex],commands[++cmdIndex],currentMatrix,camMatrix);break;case Commands.STROKE_TRIANGLE:pipeline.setTexture2D(currentTexture);pipeline.batchStrokeTriangle(commands[++cmdIndex],commands[++cmdIndex],commands[++cmdIndex],commands[++cmdIndex],commands[++cmdIndex],commands[++cmdIndex],lineWidth,currentMatrix,camMatrix);break;case Commands.LINE_TO:if(lastPath!==null)
        {lastPath.points.push(new Point(commands[++cmdIndex],commands[++cmdIndex],lineWidth));}
        else
        {lastPath=new Path(commands[++cmdIndex],commands[++cmdIndex],lineWidth);path.push(lastPath);}
            break;case Commands.MOVE_TO:lastPath=new Path(commands[++cmdIndex],commands[++cmdIndex],lineWidth);path.push(lastPath);break;case Commands.SAVE:matrixStack.push(currentMatrix.copyToArray());break;case Commands.RESTORE:currentMatrix.copyFromArray(matrixStack.pop());break;case Commands.TRANSLATE:x=commands[++cmdIndex];y=commands[++cmdIndex];currentMatrix.translate(x,y);break;case Commands.SCALE:x=commands[++cmdIndex];y=commands[++cmdIndex];currentMatrix.scale(x,y);break;case Commands.ROTATE:currentMatrix.rotate(commands[++cmdIndex]);break;case Commands.SET_TEXTURE:var frame=commands[++cmdIndex];var mode=commands[++cmdIndex];pipeline.currentFrame=frame;pipeline.setTexture2D(frame.glTexture,0);pipeline.tintEffect=mode;currentTexture=frame.glTexture;break;case Commands.CLEAR_TEXTURE:pipeline.currentFrame=renderer.blankTexture;pipeline.tintEffect=2;currentTexture=renderer.blankTexture.glTexture;break;}}};module.exports=GraphicsWebGLRenderer;}),"./gameobjects/group/Group.js":(function(module,exports,__webpack_require__){var Actions=__webpack_require__("./actions/index.js");var Class=__webpack_require__("./utils/Class.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var GetValue=__webpack_require__("./utils/object/GetValue.js");var IsPlainObject=__webpack_require__("./utils/object/IsPlainObject.js");var Range=__webpack_require__("./utils/array/Range.js");var Set=__webpack_require__("./structs/Set.js");var Sprite=__webpack_require__("./gameobjects/sprite/Sprite.js");var Group=new Class({initialize:function Group(scene,children,config)
        {if(config)
        {if(children&&!Array.isArray(children))
        {children=[children];}}
        else if(Array.isArray(children))
        {if(IsPlainObject(children[0]))
        {config=children;children=null;}}
        else if(IsPlainObject(children))
        {config=children;children=null;}
            this.scene=scene;this.children=new Set(children);this.isParent=true;this.classType=GetFastValue(config,'classType',Sprite);this.active=GetFastValue(config,'active',true);this.maxSize=GetFastValue(config,'maxSize',-1);this.defaultKey=GetFastValue(config,'defaultKey',null);this.defaultFrame=GetFastValue(config,'defaultFrame',null);this.runChildUpdate=GetFastValue(config,'runChildUpdate',false);this.createCallback=GetFastValue(config,'createCallback',null);this.removeCallback=GetFastValue(config,'removeCallback',null);this.createMultipleCallback=GetFastValue(config,'createMultipleCallback',null);if(config)
        {this.createMultiple(config);}},create:function(x,y,key,frame,visible,active)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            if(key===undefined){key=this.defaultKey;}
            if(frame===undefined){frame=this.defaultFrame;}
            if(visible===undefined){visible=true;}
            if(active===undefined){active=true;}
            if(this.isFull())
            {return null;}
            var child=new this.classType(this.scene,x,y,key,frame);this.scene.sys.displayList.add(child);if(child.preUpdate)
        {this.scene.sys.updateList.add(child);}
            child.visible=visible;child.setActive(active);this.add(child);return child;},createMultiple:function(config)
        {if(this.isFull())
        {return[];}
            if(!Array.isArray(config))
            {config=[config];}
            var output=[];if(config[0].key)
        {for(var i=0;i<config.length;i++)
        {var entries=this.createFromConfig(config[i]);output=output.concat(entries);}}
            return output;},createFromConfig:function(options)
        {if(this.isFull())
        {return[];}
            this.classType=GetFastValue(options,'classType',this.classType);var key=GetFastValue(options,'key',undefined);var frame=GetFastValue(options,'frame',null);var visible=GetFastValue(options,'visible',true);var active=GetFastValue(options,'active',true);var entries=[];if(key===undefined)
        {return entries;}
        else
        {if(!Array.isArray(key))
        {key=[key];}
            if(!Array.isArray(frame))
            {frame=[frame];}}
            var repeat=GetFastValue(options,'repeat',0);var randomKey=GetFastValue(options,'randomKey',false);var randomFrame=GetFastValue(options,'randomFrame',false);var yoyo=GetFastValue(options,'yoyo',false);var quantity=GetFastValue(options,'frameQuantity',1);var max=GetFastValue(options,'max',0);var range=Range(key,frame,{max:max,qty:quantity,random:randomKey,randomB:randomFrame,repeat:repeat,yoyo:yoyo});for(var c=0;c<range.length;c++)
        {var created=this.create(0,0,range[c].a,range[c].b,visible,active);if(!created)
        {break;}
            entries.push(created);}
            var x=GetValue(options,'setXY.x',0);var y=GetValue(options,'setXY.y',0);var stepX=GetValue(options,'setXY.stepX',0);var stepY=GetValue(options,'setXY.stepY',0);Actions.SetXY(entries,x,y,stepX,stepY);var rotation=GetValue(options,'setRotation.value',0);var stepRotation=GetValue(options,'setRotation.step',0);Actions.SetRotation(entries,rotation,stepRotation);var scaleX=GetValue(options,'setScale.x',1);var scaleY=GetValue(options,'setScale.y',scaleX);var stepScaleX=GetValue(options,'setScale.stepX',0);var stepScaleY=GetValue(options,'setScale.stepY',0);Actions.SetScale(entries,scaleX,scaleY,stepScaleX,stepScaleY);var alpha=GetValue(options,'setAlpha.value',1);var stepAlpha=GetValue(options,'setAlpha.step',0);Actions.SetAlpha(entries,alpha,stepAlpha);var hitArea=GetFastValue(options,'hitArea',null);var hitAreaCallback=GetFastValue(options,'hitAreaCallback',null);if(hitArea)
        {Actions.SetHitArea(entries,hitArea,hitAreaCallback);}
            var grid=GetFastValue(options,'gridAlign',false);if(grid)
        {Actions.GridAlign(entries,grid);}
            if(this.createMultipleCallback)
            {this.createMultipleCallback.call(this,entries);}
            return entries;},preUpdate:function(time,delta)
        {if(!this.runChildUpdate||this.children.size===0)
        {return;}
            var temp=this.children.entries.slice();for(var i=0;i<temp.length;i++)
        {var item=temp[i];if(item.active)
        {item.update(time,delta);}}},add:function(child,addToScene)
        {if(addToScene===undefined){addToScene=false;}
            if(this.isFull())
            {return this;}
            this.children.set(child);if(this.createCallback)
        {this.createCallback.call(this,child);}
            if(addToScene)
            {this.scene.sys.displayList.add(child);if(child.preUpdate)
            {this.scene.sys.updateList.add(child);}}
            child.on('destroy',this.remove,this);return this;},addMultiple:function(children,addToScene)
        {if(addToScene===undefined){addToScene=false;}
            if(Array.isArray(children))
            {for(var i=0;i<children.length;i++)
            {this.add(children[i],addToScene);}}
            return this;},remove:function(child,removeFromScene,destroyChild)
        {if(removeFromScene===undefined){removeFromScene=false;}
            if(destroyChild===undefined){destroyChild=false;}
            if(!this.children.contains(child))
            {return this;}
            this.children.delete(child);if(this.removeCallback)
        {this.removeCallback.call(this,child);}
            child.off('destroy',this.remove,this);if(destroyChild)
        {child.destroy();}
        else if(removeFromScene)
        {child.scene.sys.displayList.remove(child);if(child.preUpdate)
        {child.scene.sys.updateList.remove(child);}}
            return this;},clear:function(removeFromScene,destroyChild)
        {if(removeFromScene===undefined){removeFromScene=false;}
            if(destroyChild===undefined){destroyChild=false;}
            var children=this.children;for(var i=0;i<children.size;i++)
        {var gameObject=children.entries[i];gameObject.off('destroy',this.remove,this);if(destroyChild)
        {gameObject.destroy();}
        else if(removeFromScene)
        {gameObject.scene.sys.displayList.remove(gameObject);if(gameObject.preUpdate)
        {gameObject.scene.sys.updateList.remove(gameObject);}}}
            this.children.clear();return this;},contains:function(child)
        {return this.children.contains(child);},getChildren:function()
        {return this.children.entries;},getLength:function()
        {return this.children.size;},getFirst:function(state,createIfNull,x,y,key,frame,visible)
        {return this.getHandler(true,1,state,createIfNull,x,y,key,frame,visible);},getFirstNth:function(nth,state,createIfNull,x,y,key,frame,visible)
        {return this.getHandler(true,nth,state,createIfNull,x,y,key,frame,visible);},getLast:function(state,createIfNull,x,y,key,frame,visible)
        {return this.getHandler(false,1,state,createIfNull,x,y,key,frame,visible);},getLastNth:function(nth,state,createIfNull,x,y,key,frame,visible)
        {return this.getHandler(false,nth,state,createIfNull,x,y,key,frame,visible);},getHandler:function(forwards,nth,state,createIfNull,x,y,key,frame,visible)
        {if(state===undefined){state=false;}
            if(createIfNull===undefined){createIfNull=false;}
            var gameObject;var i;var total=0;var children=this.children.entries;if(forwards)
        {for(i=0;i<children.length;i++)
        {gameObject=children[i];if(gameObject.active===state)
        {total++;if(total===nth)
        {break;}}
        else
        {gameObject=null;}}}
        else
        {for(i=children.length-1;i>=0;i--)
        {gameObject=children[i];if(gameObject.active===state)
        {total++;if(total===nth)
        {break;}}
        else
        {gameObject=null;}}}
            if(gameObject)
            {if(typeof(x)==='number')
            {gameObject.x=x;}
                if(typeof(y)==='number')
                {gameObject.y=y;}
                return gameObject;}
            if(createIfNull)
            {return this.create(x,y,key,frame,visible);}
            else
            {return null;}},get:function(x,y,key,frame,visible)
        {return this.getFirst(false,true,x,y,key,frame,visible);},getFirstAlive:function(createIfNull,x,y,key,frame,visible)
        {return this.getFirst(true,createIfNull,x,y,key,frame,visible);},getFirstDead:function(createIfNull,x,y,key,frame,visible)
        {return this.getFirst(false,createIfNull,x,y,key,frame,visible);},playAnimation:function(key,startFrame)
        {Actions.PlayAnimation(this.children.entries,key,startFrame);return this;},isFull:function()
        {if(this.maxSize===-1)
        {return false;}
        else
        {return(this.children.size>=this.maxSize);}},countActive:function(value)
        {if(value===undefined){value=true;}
            var total=0;for(var i=0;i<this.children.size;i++)
        {if(this.children.entries[i].active===value)
        {total++;}}
            return total;},getTotalUsed:function()
        {return this.countActive();},getTotalFree:function()
        {var used=this.getTotalUsed();var capacity=(this.maxSize===-1)?999999999999:this.maxSize;return(capacity-used);},setDepth:function(value,step)
        {Actions.SetDepth(this.children.entries,value,step);return this;},kill:function(gameObject)
        {if(this.children.contains(gameObject))
        {gameObject.setActive(false);}},killAndHide:function(gameObject)
        {if(this.children.contains(gameObject))
        {gameObject.setActive(false);gameObject.setVisible(false);}},toggleVisible:function()
        {Actions.ToggleVisible(this.children.entries);return this;},destroy:function(destroyChildren)
        {if(destroyChildren===undefined){destroyChildren=false;}
            if(!this.scene||this.ignoreDestroy)
            {return;}
            if(destroyChildren)
            {var children=this.children;for(var i=0;i<children.size;i++)
            {var gameObject=children.entries[i];gameObject.off('destroy',this.remove,this);gameObject.destroy();}}
            this.children.clear();this.scene=undefined;this.children=undefined;}});module.exports=Group;}),"./gameobjects/group/GroupCreator.js":(function(module,exports,__webpack_require__){var GameObjectCreator=__webpack_require__("./gameobjects/GameObjectCreator.js");var Group=__webpack_require__("./gameobjects/group/Group.js");GameObjectCreator.register('group',function(config)
    {return new Group(this.scene,null,config);});}),"./gameobjects/group/GroupFactory.js":(function(module,exports,__webpack_require__){var Group=__webpack_require__("./gameobjects/group/Group.js");var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");GameObjectFactory.register('group',function(children,config)
    {return this.updateList.add(new Group(this.scene,children,config));});}),"./gameobjects/image/Image.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Components=__webpack_require__("./gameobjects/components/index.js");var GameObject=__webpack_require__("./gameobjects/GameObject.js");var ImageRender=__webpack_require__("./gameobjects/image/ImageRender.js");var Image=new Class({Extends:GameObject,Mixins:[Components.Alpha,Components.BlendMode,Components.Depth,Components.Flip,Components.GetBounds,Components.Mask,Components.Origin,Components.Pipeline,Components.ScaleMode,Components.ScrollFactor,Components.Size,Components.TextureCrop,Components.Tint,Components.Transform,Components.Visible,ImageRender],initialize:function Image(scene,x,y,texture,frame)
        {GameObject.call(this,scene,'Image');this._crop=this.resetCropObject();this.setTexture(texture,frame);this.setPosition(x,y);this.setSizeToFrame();this.setOriginFromFrame();this.initPipeline();}});module.exports=Image;}),"./gameobjects/image/ImageCanvasRenderer.js":(function(module,exports){var ImageCanvasRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {renderer.batchSprite(src,src.frame,camera,parentMatrix);};module.exports=ImageCanvasRenderer;}),"./gameobjects/image/ImageCreator.js":(function(module,exports,__webpack_require__){var BuildGameObject=__webpack_require__("./gameobjects/BuildGameObject.js");var GameObjectCreator=__webpack_require__("./gameobjects/GameObjectCreator.js");var GetAdvancedValue=__webpack_require__("./utils/object/GetAdvancedValue.js");var Image=__webpack_require__("./gameobjects/image/Image.js");GameObjectCreator.register('image',function(config,addToScene)
    {if(config===undefined){config={};}
        var key=GetAdvancedValue(config,'key',null);var frame=GetAdvancedValue(config,'frame',null);var image=new Image(this.scene,0,0,key,frame);if(addToScene!==undefined)
    {config.add=addToScene;}
        BuildGameObject(this.scene,image,config);return image;});}),"./gameobjects/image/ImageFactory.js":(function(module,exports,__webpack_require__){var Image=__webpack_require__("./gameobjects/image/Image.js");var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");GameObjectFactory.register('image',function(x,y,key,frame)
    {return this.displayList.add(new Image(this.scene,x,y,key,frame));});}),"./gameobjects/image/ImageRender.js":(function(module,exports,__webpack_require__){var renderWebGL=__webpack_require__("./utils/NOOP.js");var renderCanvas=__webpack_require__("./utils/NOOP.js");if(true)
    {renderWebGL=__webpack_require__("./gameobjects/image/ImageWebGLRenderer.js");}
        if(true)
        {renderCanvas=__webpack_require__("./gameobjects/image/ImageCanvasRenderer.js");}
        module.exports={renderWebGL:renderWebGL,renderCanvas:renderCanvas};}),"./gameobjects/image/ImageWebGLRenderer.js":(function(module,exports){var ImageWebGLRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {this.pipeline.batchSprite(src,camera,parentMatrix);};module.exports=ImageWebGLRenderer;}),"./gameobjects/index.js":(function(module,exports,__webpack_require__){var GameObjects={DisplayList:__webpack_require__("./gameobjects/DisplayList.js"),GameObjectCreator:__webpack_require__("./gameobjects/GameObjectCreator.js"),GameObjectFactory:__webpack_require__("./gameobjects/GameObjectFactory.js"),UpdateList:__webpack_require__("./gameobjects/UpdateList.js"),Components:__webpack_require__("./gameobjects/components/index.js"),BuildGameObject:__webpack_require__("./gameobjects/BuildGameObject.js"),BuildGameObjectAnimation:__webpack_require__("./gameobjects/BuildGameObjectAnimation.js"),GameObject:__webpack_require__("./gameobjects/GameObject.js"),BitmapText:__webpack_require__("./gameobjects/bitmaptext/static/BitmapText.js"),Blitter:__webpack_require__("./gameobjects/blitter/Blitter.js"),Container:__webpack_require__("./gameobjects/container/Container.js"),DynamicBitmapText:__webpack_require__("./gameobjects/bitmaptext/dynamic/DynamicBitmapText.js"),Extern:__webpack_require__("./gameobjects/extern/Extern.js"),Graphics:__webpack_require__("./gameobjects/graphics/Graphics.js"),Group:__webpack_require__("./gameobjects/group/Group.js"),Image:__webpack_require__("./gameobjects/image/Image.js"),Particles:__webpack_require__("./gameobjects/particles/index.js"),PathFollower:__webpack_require__("./gameobjects/pathfollower/PathFollower.js"),RenderTexture:__webpack_require__("./gameobjects/rendertexture/RenderTexture.js"),RetroFont:__webpack_require__("./gameobjects/bitmaptext/RetroFont.js"),Sprite:__webpack_require__("./gameobjects/sprite/Sprite.js"),Text:__webpack_require__("./gameobjects/text/static/Text.js"),TileSprite:__webpack_require__("./gameobjects/tilesprite/TileSprite.js"),Zone:__webpack_require__("./gameobjects/zone/Zone.js"),Shape:__webpack_require__("./gameobjects/shape/Shape.js"),Arc:__webpack_require__("./gameobjects/shape/arc/Arc.js"),Curve:__webpack_require__("./gameobjects/shape/curve/Curve.js"),Ellipse:__webpack_require__("./gameobjects/shape/ellipse/Ellipse.js"),Grid:__webpack_require__("./gameobjects/shape/grid/Grid.js"),IsoBox:__webpack_require__("./gameobjects/shape/isobox/IsoBox.js"),IsoTriangle:__webpack_require__("./gameobjects/shape/isotriangle/IsoTriangle.js"),Line:__webpack_require__("./gameobjects/shape/line/Line.js"),Polygon:__webpack_require__("./gameobjects/shape/polygon/Polygon.js"),Rectangle:__webpack_require__("./gameobjects/shape/rectangle/Rectangle.js"),Star:__webpack_require__("./gameobjects/shape/star/Star.js"),Triangle:__webpack_require__("./gameobjects/shape/triangle/Triangle.js"),Factories:{Blitter:__webpack_require__("./gameobjects/blitter/BlitterFactory.js"),Container:__webpack_require__("./gameobjects/container/ContainerFactory.js"),DynamicBitmapText:__webpack_require__("./gameobjects/bitmaptext/dynamic/DynamicBitmapTextFactory.js"),Extern:__webpack_require__("./gameobjects/extern/ExternFactory.js"),Graphics:__webpack_require__("./gameobjects/graphics/GraphicsFactory.js"),Group:__webpack_require__("./gameobjects/group/GroupFactory.js"),Image:__webpack_require__("./gameobjects/image/ImageFactory.js"),Particles:__webpack_require__("./gameobjects/particles/ParticleManagerFactory.js"),PathFollower:__webpack_require__("./gameobjects/pathfollower/PathFollowerFactory.js"),RenderTexture:__webpack_require__("./gameobjects/rendertexture/RenderTextureFactory.js"),Sprite:__webpack_require__("./gameobjects/sprite/SpriteFactory.js"),StaticBitmapText:__webpack_require__("./gameobjects/bitmaptext/static/BitmapTextFactory.js"),Text:__webpack_require__("./gameobjects/text/static/TextFactory.js"),TileSprite:__webpack_require__("./gameobjects/tilesprite/TileSpriteFactory.js"),Zone:__webpack_require__("./gameobjects/zone/ZoneFactory.js"),Arc:__webpack_require__("./gameobjects/shape/arc/ArcFactory.js"),Curve:__webpack_require__("./gameobjects/shape/curve/CurveFactory.js"),Ellipse:__webpack_require__("./gameobjects/shape/ellipse/EllipseFactory.js"),Grid:__webpack_require__("./gameobjects/shape/grid/GridFactory.js"),IsoBox:__webpack_require__("./gameobjects/shape/isobox/IsoBoxFactory.js"),IsoTriangle:__webpack_require__("./gameobjects/shape/isotriangle/IsoTriangleFactory.js"),Line:__webpack_require__("./gameobjects/shape/line/LineFactory.js"),Polygon:__webpack_require__("./gameobjects/shape/polygon/PolygonFactory.js"),Rectangle:__webpack_require__("./gameobjects/shape/rectangle/RectangleFactory.js"),Star:__webpack_require__("./gameobjects/shape/star/StarFactory.js"),Triangle:__webpack_require__("./gameobjects/shape/triangle/TriangleFactory.js")},Creators:{Blitter:__webpack_require__("./gameobjects/blitter/BlitterCreator.js"),Container:__webpack_require__("./gameobjects/container/ContainerCreator.js"),DynamicBitmapText:__webpack_require__("./gameobjects/bitmaptext/dynamic/DynamicBitmapTextCreator.js"),Graphics:__webpack_require__("./gameobjects/graphics/GraphicsCreator.js"),Group:__webpack_require__("./gameobjects/group/GroupCreator.js"),Image:__webpack_require__("./gameobjects/image/ImageCreator.js"),Particles:__webpack_require__("./gameobjects/particles/ParticleManagerCreator.js"),RenderTexture:__webpack_require__("./gameobjects/rendertexture/RenderTextureCreator.js"),Sprite:__webpack_require__("./gameobjects/sprite/SpriteCreator.js"),StaticBitmapText:__webpack_require__("./gameobjects/bitmaptext/static/BitmapTextCreator.js"),Text:__webpack_require__("./gameobjects/text/static/TextCreator.js"),TileSprite:__webpack_require__("./gameobjects/tilesprite/TileSpriteCreator.js"),Zone:__webpack_require__("./gameobjects/zone/ZoneCreator.js")}};if(true)
    {GameObjects.DOMElement=__webpack_require__("./gameobjects/domelement/DOMElement.js");GameObjects.Factories.DOMElement=__webpack_require__("./gameobjects/domelement/DOMElementFactory.js");}
        if(true)
        {GameObjects.Mesh=__webpack_require__("./gameobjects/mesh/Mesh.js");GameObjects.Quad=__webpack_require__("./gameobjects/quad/Quad.js");GameObjects.Factories.Mesh=__webpack_require__("./gameobjects/mesh/MeshFactory.js");GameObjects.Factories.Quad=__webpack_require__("./gameobjects/quad/QuadFactory.js");GameObjects.Creators.Mesh=__webpack_require__("./gameobjects/mesh/MeshCreator.js");GameObjects.Creators.Quad=__webpack_require__("./gameobjects/quad/QuadCreator.js");GameObjects.Light=__webpack_require__("./gameobjects/lights/Light.js");__webpack_require__("./gameobjects/lights/LightsManager.js");__webpack_require__("./gameobjects/lights/LightsPlugin.js");}
        module.exports=GameObjects;}),"./gameobjects/lights/Light.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Utils=__webpack_require__("./renderer/webgl/Utils.js");var Light=new Class({initialize:function Light(x,y,radius,r,g,b,intensity)
        {this.x=x;this.y=y;this.radius=radius;this.r=r;this.g=g;this.b=b;this.intensity=intensity;this.scrollFactorX=1.0;this.scrollFactorY=1.0;},set:function(x,y,radius,r,g,b,intensity)
        {this.x=x;this.y=y;this.radius=radius;this.r=r;this.g=g;this.b=b;this.intensity=intensity;this.scrollFactorX=1;this.scrollFactorY=1;return this;},setScrollFactor:function(x,y)
        {if(x===undefined){x=1;}
            if(y===undefined){y=x;}
            this.scrollFactorX=x;this.scrollFactorY=y;return this;},setColor:function(rgb)
        {var color=Utils.getFloatsFromUintRGB(rgb);this.r=color[0];this.g=color[1];this.b=color[2];return this;},setIntensity:function(intensity)
        {this.intensity=intensity;return this;},setPosition:function(x,y)
        {this.x=x;this.y=y;return this;},setRadius:function(radius)
        {this.radius=radius;return this;}});module.exports=Light;}),"./gameobjects/lights/LightsManager.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Light=__webpack_require__("./gameobjects/lights/Light.js");var Utils=__webpack_require__("./renderer/webgl/Utils.js");var LightsManager=new Class({initialize:function LightsManager()
        {this.lightPool=[];this.lights=[];this.culledLights=[];this.ambientColor={r:0.1,g:0.1,b:0.1};this.active=false;this.maxLights=-1;},enable:function()
        {if(this.maxLights===-1)
        {this.maxLights=this.scene.sys.game.renderer.config.maxLights;}
            this.active=true;return this;},disable:function()
        {this.active=false;return this;},cull:function(camera)
        {var lights=this.lights;var culledLights=this.culledLights;var length=lights.length;var cameraCenterX=camera.x+camera.width / 2.0;var cameraCenterY=camera.y+camera.height / 2.0;var cameraRadius=(camera.width+camera.height)/ 2.0;var point={x:0,y:0};var cameraMatrix=camera.matrix;var viewportHeight=this.systems.game.config.height;culledLights.length=0;for(var index=0;index<length&&culledLights.length<this.maxLights;index++)
        {var light=lights[index];cameraMatrix.transformPoint(light.x,light.y,point);var dx=cameraCenterX-(point.x-(camera.scrollX*light.scrollFactorX*camera.zoom));var dy=cameraCenterY-(viewportHeight-(point.y-(camera.scrollY*light.scrollFactorY)*camera.zoom));var distance=Math.sqrt(dx*dx+dy*dy);if(distance<light.radius+cameraRadius)
        {culledLights.push(lights[index]);}}
            return culledLights;},forEachLight:function(callback)
        {if(!callback)
        {return;}
            var lights=this.lights;var length=lights.length;for(var index=0;index<length;++index)
        {callback(lights[index]);}
            return this;},setAmbientColor:function(rgb)
        {var color=Utils.getFloatsFromUintRGB(rgb);this.ambientColor.r=color[0];this.ambientColor.g=color[1];this.ambientColor.b=color[2];return this;},getMaxVisibleLights:function()
        {return 10;},getLightCount:function()
        {return this.lights.length;},addLight:function(x,y,radius,rgb,intensity)
        {var color=null;var light=null;x=(x===undefined)?0.0:x;y=(y===undefined)?0.0:y;rgb=(rgb===undefined)?0xffffff:rgb;radius=(radius===undefined)?100.0:radius;intensity=(intensity===undefined)?1.0:intensity;color=Utils.getFloatsFromUintRGB(rgb);light=null;if(this.lightPool.length>0)
        {light=this.lightPool.pop();light.set(x,y,radius,color[0],color[1],color[2],intensity);}
        else
        {light=new Light(x,y,radius,color[0],color[1],color[2],intensity);}
            this.lights.push(light);return light;},removeLight:function(light)
        {var index=this.lights.indexOf(light);if(index>=0)
        {this.lightPool.push(light);this.lights.splice(index,1);}
            return this;},shutdown:function()
        {while(this.lights.length>0)
        {this.lightPool.push(this.lights.pop());}
            this.ambientColor={r:0.1,g:0.1,b:0.1};this.culledLights.length=0;this.lights.length=0;},destroy:function()
        {this.shutdown();}});module.exports=LightsManager;}),"./gameobjects/lights/LightsPlugin.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var LightsManager=__webpack_require__("./gameobjects/lights/LightsManager.js");var PluginCache=__webpack_require__("./plugins/PluginCache.js");var LightsPlugin=new Class({Extends:LightsManager,initialize:function LightsPlugin(scene)
        {this.scene=scene;this.systems=scene.sys;if(!scene.sys.settings.isBooted)
        {scene.sys.events.once('boot',this.boot,this);}
            LightsManager.call(this);},boot:function()
        {var eventEmitter=this.systems.events;eventEmitter.on('shutdown',this.shutdown,this);eventEmitter.on('destroy',this.destroy,this);},destroy:function()
        {this.shutdown();this.scene=undefined;this.systems=undefined;}});PluginCache.register('LightsPlugin',LightsPlugin,'lights');module.exports=LightsPlugin;}),"./gameobjects/mesh/Mesh.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Components=__webpack_require__("./gameobjects/components/index.js");var GameObject=__webpack_require__("./gameobjects/GameObject.js");var MeshRender=__webpack_require__("./gameobjects/mesh/MeshRender.js");var Mesh=new Class({Extends:GameObject,Mixins:[Components.BlendMode,Components.Depth,Components.GetBounds,Components.Mask,Components.Pipeline,Components.ScaleMode,Components.Size,Components.Texture,Components.Transform,Components.Visible,Components.ScrollFactor,MeshRender],initialize:function Mesh(scene,x,y,vertices,uv,colors,alphas,texture,frame)
        {GameObject.call(this,scene,'Mesh');if(vertices.length!==uv.length)
        {throw new Error('Mesh Vertex count must match UV count');}
            var verticesUB=(vertices.length / 2)|0;if(colors.length>0&&colors.length<verticesUB)
        {throw new Error('Mesh Color count must match Vertex count');}
            if(alphas.length>0&&alphas.length<verticesUB)
            {throw new Error('Mesh Alpha count must match Vertex count');}
            var i;if(colors.length===0)
        {for(i=0;i<verticesUB;++i)
        {colors[i]=0xFFFFFF;}}
            if(alphas.length===0)
            {for(i=0;i<verticesUB;++i)
            {alphas[i]=1.0;}}
            this.vertices=new Float32Array(vertices);this.uv=new Float32Array(uv);this.colors=new Uint32Array(colors);this.alphas=new Float32Array(alphas);this.tintFill=false;this.setTexture(texture,frame);this.setPosition(x,y);this.setSizeToFrame();this.initPipeline();}});module.exports=Mesh;}),"./gameobjects/mesh/MeshCanvasRenderer.js":(function(module,exports){var MeshCanvasRenderer=function()
    {};module.exports=MeshCanvasRenderer;}),"./gameobjects/mesh/MeshCreator.js":(function(module,exports,__webpack_require__){var BuildGameObject=__webpack_require__("./gameobjects/BuildGameObject.js");var GameObjectCreator=__webpack_require__("./gameobjects/GameObjectCreator.js");var GetAdvancedValue=__webpack_require__("./utils/object/GetAdvancedValue.js");var GetValue=__webpack_require__("./utils/object/GetValue.js");var Mesh=__webpack_require__("./gameobjects/mesh/Mesh.js");GameObjectCreator.register('mesh',function(config,addToScene)
    {if(config===undefined){config={};}
        var key=GetAdvancedValue(config,'key',null);var frame=GetAdvancedValue(config,'frame',null);var vertices=GetValue(config,'vertices',[]);var colors=GetValue(config,'colors',[]);var alphas=GetValue(config,'alphas',[]);var uv=GetValue(config,'uv',[]);var mesh=new Mesh(this.scene,0,0,vertices,uv,colors,alphas,key,frame);if(addToScene!==undefined)
    {config.add=addToScene;}
        BuildGameObject(this.scene,mesh,config);return mesh;});}),"./gameobjects/mesh/MeshFactory.js":(function(module,exports,__webpack_require__){var Mesh=__webpack_require__("./gameobjects/mesh/Mesh.js");var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");if(true)
    {GameObjectFactory.register('mesh',function(x,y,vertices,uv,colors,alphas,texture,frame)
    {return this.displayList.add(new Mesh(this.scene,x,y,vertices,uv,colors,alphas,texture,frame));});}}),"./gameobjects/mesh/MeshRender.js":(function(module,exports,__webpack_require__){var renderWebGL=__webpack_require__("./utils/NOOP.js");var renderCanvas=__webpack_require__("./utils/NOOP.js");if(true)
    {renderWebGL=__webpack_require__("./gameobjects/mesh/MeshWebGLRenderer.js");}
        if(true)
        {renderCanvas=__webpack_require__("./gameobjects/mesh/MeshCanvasRenderer.js");}
        module.exports={renderWebGL:renderWebGL,renderCanvas:renderCanvas};}),"./gameobjects/mesh/MeshWebGLRenderer.js":(function(module,exports,__webpack_require__){var Utils=__webpack_require__("./renderer/webgl/Utils.js");var MeshWebGLRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var pipeline=this.pipeline;renderer.setPipeline(pipeline,src);var camMatrix=pipeline._tempMatrix1;var spriteMatrix=pipeline._tempMatrix2;var calcMatrix=pipeline._tempMatrix3;spriteMatrix.applyITRS(src.x,src.y,src.rotation,src.scaleX,src.scaleY);camMatrix.copyFrom(camera.matrix);if(parentMatrix)
    {camMatrix.multiplyWithOffset(parentMatrix,-camera.scrollX*src.scrollFactorX,-camera.scrollY*src.scrollFactorY);spriteMatrix.e=src.x;spriteMatrix.f=src.y;camMatrix.multiply(spriteMatrix,calcMatrix);}
    else
    {spriteMatrix.e-=camera.scrollX*src.scrollFactorX;spriteMatrix.f-=camera.scrollY*src.scrollFactorY;camMatrix.multiply(spriteMatrix,calcMatrix);}
        var frame=src.frame;var texture=frame.glTexture;var vertices=src.vertices;var uvs=src.uv;var colors=src.colors;var alphas=src.alphas;var meshVerticesLength=vertices.length;var vertexCount=Math.floor(meshVerticesLength*0.5);if(pipeline.vertexCount+vertexCount>pipeline.vertexCapacity)
    {pipeline.flush();}
        pipeline.setTexture2D(texture,0);var vertexViewF32=pipeline.vertexViewF32;var vertexViewU32=pipeline.vertexViewU32;var vertexOffset=(pipeline.vertexCount*pipeline.vertexComponentCount)-1;var colorIndex=0;var tintEffect=src.tintFill;for(var i=0;i<meshVerticesLength;i+=2)
    {var x=vertices[i+0];var y=vertices[i+1];var tx=x*calcMatrix.a+y*calcMatrix.c+calcMatrix.e;var ty=x*calcMatrix.b+y*calcMatrix.d+calcMatrix.f;if(camera.roundPixels)
    {tx=Math.round(tx);ty=Math.round(ty);}
        vertexViewF32[++vertexOffset]=tx;vertexViewF32[++vertexOffset]=ty;vertexViewF32[++vertexOffset]=uvs[i+0];vertexViewF32[++vertexOffset]=uvs[i+1];vertexViewF32[++vertexOffset]=tintEffect;vertexViewU32[++vertexOffset]=Utils.getTintAppendFloatAlpha(colors[colorIndex],camera.alpha*alphas[colorIndex]);colorIndex++;}
        pipeline.vertexCount+=vertexCount;};module.exports=MeshWebGLRenderer;}),"./gameobjects/particles/EmitterOp.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var FloatBetween=__webpack_require__("./math/FloatBetween.js");var GetEaseFunction=__webpack_require__("./tweens/builders/GetEaseFunction.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var Wrap=__webpack_require__("./math/Wrap.js");var EmitterOp=new Class({initialize:function EmitterOp(config,key,defaultValue,emitOnly)
        {if(emitOnly===undefined)
        {emitOnly=false;}
            this.propertyKey=key;this.propertyValue=defaultValue;this.defaultValue=defaultValue;this.steps=0;this.counter=0;this.start=0;this.end=0;this.ease;this.emitOnly=emitOnly;this.onEmit=this.defaultEmit;this.onUpdate=this.defaultUpdate;this.loadConfig(config);},loadConfig:function(config,newKey)
        {if(config===undefined)
        {config={};}
            if(newKey)
            {this.propertyKey=newKey;}
            this.propertyValue=GetFastValue(config,this.propertyKey,this.defaultValue);this.setMethods();if(this.emitOnly)
        {this.onUpdate=this.defaultUpdate;}},toJSON:function()
        {return this.propertyValue;},onChange:function(value)
        {this.propertyValue=value;return this.setMethods();},setMethods:function()
        {var value=this.propertyValue;var t=typeof value;if(t==='number')
        {this.onEmit=this.staticValueEmit;this.onUpdate=this.staticValueUpdate;}
        else if(Array.isArray(value))
        {this.onEmit=this.randomStaticValueEmit;}
        else if(t==='function')
        {if(this.emitOnly)
        {this.onEmit=value;}
        else
        {this.onUpdate=value;}}
        else if(t==='object'&&(this.has(value,'random')||this.hasBoth(value,'start','end')||this.hasBoth(value,'min','max')))
        {this.start=this.has(value,'start')?value.start:value.min;this.end=this.has(value,'end')?value.end:value.max;var isRandom=(this.hasBoth(value,'min','max')||this.has(value,'random'));if(isRandom)
        {var rnd=value.random;if(Array.isArray(rnd))
        {this.start=rnd[0];this.end=rnd[1];}
            this.onEmit=this.randomRangedValueEmit;}
            if(this.has(value,'steps'))
            {this.steps=value.steps;this.counter=this.start;this.onEmit=this.steppedEmit;}
            else
            {var easeType=this.has(value,'ease')?value.ease:'Linear';this.ease=GetEaseFunction(easeType);if(!isRandom)
            {this.onEmit=this.easedValueEmit;}
                this.onUpdate=this.easeValueUpdate;}}
        else if(t==='object'&&this.hasEither(value,'onEmit','onUpdate'))
        {if(this.has(value,'onEmit'))
        {this.onEmit=value.onEmit;}
            if(this.has(value,'onUpdate'))
            {this.onUpdate=value.onUpdate;}}
            return this;},has:function(object,key)
        {return object.hasOwnProperty(key);},hasBoth:function(object,key1,key2)
        {return object.hasOwnProperty(key1)&&object.hasOwnProperty(key2);},hasEither:function(object,key1,key2)
        {return object.hasOwnProperty(key1)||object.hasOwnProperty(key2);},defaultEmit:function(particle,key,value)
        {return value;},defaultUpdate:function(particle,key,t,value)
        {return value;},staticValueEmit:function()
        {return this.propertyValue;},staticValueUpdate:function()
        {return this.propertyValue;},randomStaticValueEmit:function()
        {var randomIndex=Math.floor(Math.random()*this.propertyValue.length);return this.propertyValue[randomIndex];},randomRangedValueEmit:function(particle,key)
        {var value=FloatBetween(this.start,this.end);if(particle&&particle.data[key])
        {particle.data[key].min=value;}
            return value;},steppedEmit:function()
        {var current=this.counter;var next=this.counter+(this.end-this.start)/ this.steps;this.counter=Wrap(next,this.start,this.end);return current;},easedValueEmit:function(particle,key)
        {if(particle&&particle.data[key])
        {var data=particle.data[key];data.min=this.start;data.max=this.end;}
            return this.start;},easeValueUpdate:function(particle,key,t)
        {var data=particle.data[key];return(data.max-data.min)*this.ease(t)+data.min;}});module.exports=EmitterOp;}),"./gameobjects/particles/GravityWell.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var GravityWell=new Class({initialize:function GravityWell(x,y,power,epsilon,gravity)
        {if(typeof x==='object')
        {var config=x;x=GetFastValue(config,'x',0);y=GetFastValue(config,'y',0);power=GetFastValue(config,'power',0);epsilon=GetFastValue(config,'epsilon',100);gravity=GetFastValue(config,'gravity',50);}
        else
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            if(power===undefined){power=0;}
            if(epsilon===undefined){epsilon=100;}
            if(gravity===undefined){gravity=50;}}
            this.x=x;this.y=y;this.active=true;this._gravity=gravity;this._power=0;this._epsilon=0;this.power=power;this.epsilon=epsilon;},update:function(particle,delta)
        {var x=this.x-particle.x;var y=this.y-particle.y;var dSq=x*x+y*y;if(dSq===0)
        {return;}
            var d=Math.sqrt(dSq);if(dSq<this._epsilon)
        {dSq=this._epsilon;}
            var factor=((this._power*delta)/(dSq*d))*100;particle.velocityX+=x*factor;particle.velocityY+=y*factor;},epsilon:{get:function()
            {return Math.sqrt(this._epsilon);},set:function(value)
            {this._epsilon=value*value;}},power:{get:function()
            {return this._power / this._gravity;},set:function(value)
            {this._power=value*this._gravity;}},gravity:{get:function()
            {return this._gravity;},set:function(value)
            {var pwr=this.power;this._gravity=value;this.power=pwr;}}});module.exports=GravityWell;}),"./gameobjects/particles/Particle.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var DegToRad=__webpack_require__("./math/DegToRad.js");var DistanceBetween=__webpack_require__("./math/distance/DistanceBetween.js");var Particle=new Class({initialize:function Particle(emitter)
        {this.emitter=emitter;this.frame=null;this.x=0;this.y=0;this.velocityX=0;this.velocityY=0;this.accelerationX=0;this.accelerationY=0;this.maxVelocityX=10000;this.maxVelocityY=10000;this.bounce=0;this.scaleX=1;this.scaleY=1;this.alpha=1;this.angle=0;this.rotation=0;this.tint=0xffffff;this.life=1000;this.lifeCurrent=1000;this.delayCurrent=0;this.lifeT=0;this.data={tint:{min:0xffffff,max:0xffffff,current:0xffffff},alpha:{min:1,max:1},rotate:{min:0,max:0},scaleX:{min:1,max:1},scaleY:{min:1,max:1}};},isAlive:function()
        {return(this.lifeCurrent>0);},resetPosition:function()
        {this.x=0;this.y=0;},fire:function(x,y)
        {var emitter=this.emitter;this.frame=emitter.getFrame();if(emitter.emitZone)
        {emitter.emitZone.getPoint(this);}
            if(x===undefined)
            {if(emitter.follow)
            {this.x+=emitter.follow.x+emitter.followOffset.x;}
                this.x+=emitter.x.onEmit(this,'x');}
            else
            {this.x+=x;}
            if(y===undefined)
            {if(emitter.follow)
            {this.y+=emitter.follow.y+emitter.followOffset.y;}
                this.y+=emitter.y.onEmit(this,'y');}
            else
            {this.y+=y;}
            this.life=emitter.lifespan.onEmit(this,'lifespan');this.lifeCurrent=this.life;this.lifeT=0;var sx=emitter.speedX.onEmit(this,'speedX');var sy=(emitter.speedY)?emitter.speedY.onEmit(this,'speedY'):sx;if(emitter.radial)
        {var rad=DegToRad(emitter.angle.onEmit(this,'angle'));this.velocityX=Math.cos(rad)*Math.abs(sx);this.velocityY=Math.sin(rad)*Math.abs(sy);}
        else if(emitter.moveTo)
        {var mx=emitter.moveToX.onEmit(this,'moveToX');var my=(emitter.moveToY)?emitter.moveToY.onEmit(this,'moveToY'):mx;var angle=Math.atan2(my-this.y,mx-this.x);var speed=DistanceBetween(this.x,this.y,mx,my)/(this.life / 1000);this.velocityX=Math.cos(angle)*speed;this.velocityY=Math.sin(angle)*speed;}
        else
        {this.velocityX=sx;this.velocityY=sy;}
            if(emitter.acceleration)
            {this.accelerationX=emitter.accelerationX.onEmit(this,'accelerationX');this.accelerationY=emitter.accelerationY.onEmit(this,'accelerationY');}
            this.maxVelocityX=emitter.maxVelocityX.onEmit(this,'maxVelocityX');this.maxVelocityY=emitter.maxVelocityY.onEmit(this,'maxVelocityY');this.delayCurrent=emitter.delay.onEmit(this,'delay');this.scaleX=emitter.scaleX.onEmit(this,'scaleX');this.scaleY=(emitter.scaleY)?emitter.scaleY.onEmit(this,'scaleY'):this.scaleX;this.angle=emitter.rotate.onEmit(this,'rotate');this.rotation=DegToRad(this.angle);this.bounce=emitter.bounce.onEmit(this,'bounce');this.alpha=emitter.alpha.onEmit(this,'alpha');this.tint=emitter.tint.onEmit(this,'tint');},computeVelocity:function(emitter,delta,step,processors)
        {var vx=this.velocityX;var vy=this.velocityY;var ax=this.accelerationX;var ay=this.accelerationY;var mx=this.maxVelocityX;var my=this.maxVelocityY;vx+=(emitter.gravityX*step);vy+=(emitter.gravityY*step);if(ax)
        {vx+=(ax*step);}
            if(ay)
            {vy+=(ay*step);}
            if(vx>mx)
            {vx=mx;}
            else if(vx<-mx)
            {vx=-mx;}
            if(vy>my)
            {vy=my;}
            else if(vy<-my)
            {vy=-my;}
            this.velocityX=vx;this.velocityY=vy;for(var i=0;i<processors.length;i++)
        {processors[i].update(this,delta,step);}},checkBounds:function(emitter)
        {var bounds=emitter.bounds;var bounce=-this.bounce;if(this.x<bounds.x&&emitter.collideLeft)
        {this.x=bounds.x;this.velocityX*=bounce;}
        else if(this.x>bounds.right&&emitter.collideRight)
        {this.x=bounds.right;this.velocityX*=bounce;}
            if(this.y<bounds.y&&emitter.collideTop)
            {this.y=bounds.y;this.velocityY*=bounce;}
            else if(this.y>bounds.bottom&&emitter.collideBottom)
            {this.y=bounds.bottom;this.velocityY*=bounce;}},update:function(delta,step,processors)
        {if(this.delayCurrent>0)
        {this.delayCurrent-=delta;return false;}
            var emitter=this.emitter;var t=1-(this.lifeCurrent / this.life);this.lifeT=t;this.computeVelocity(emitter,delta,step,processors);this.x+=this.velocityX*step;this.y+=this.velocityY*step;if(emitter.bounds)
        {this.checkBounds(emitter);}
            if(emitter.deathZone&&emitter.deathZone.willKill(this))
            {this.lifeCurrent=0;return true;}
            this.scaleX=emitter.scaleX.onUpdate(this,'scaleX',t,this.scaleX);if(emitter.scaleY)
        {this.scaleY=emitter.scaleY.onUpdate(this,'scaleY',t,this.scaleY);}
        else
        {this.scaleY=this.scaleX;}
            this.angle=emitter.rotate.onUpdate(this,'rotate',t,this.angle);this.rotation=DegToRad(this.angle);this.alpha=emitter.alpha.onUpdate(this,'alpha',t,this.alpha);this.tint=emitter.tint.onUpdate(this,'tint',t,this.tint);this.lifeCurrent-=delta;return(this.lifeCurrent<=0);}});module.exports=Particle;}),"./gameobjects/particles/ParticleEmitter.js":(function(module,exports,__webpack_require__){var BlendModes=__webpack_require__("./renderer/BlendModes.js");var Class=__webpack_require__("./utils/Class.js");var Components=__webpack_require__("./gameobjects/components/index.js");var DeathZone=__webpack_require__("./gameobjects/particles/zones/DeathZone.js");var EdgeZone=__webpack_require__("./gameobjects/particles/zones/EdgeZone.js");var EmitterOp=__webpack_require__("./gameobjects/particles/EmitterOp.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var GetRandom=__webpack_require__("./utils/array/GetRandom.js");var HasAny=__webpack_require__("./utils/object/HasAny.js");var HasValue=__webpack_require__("./utils/object/HasValue.js");var Particle=__webpack_require__("./gameobjects/particles/Particle.js");var RandomZone=__webpack_require__("./gameobjects/particles/zones/RandomZone.js");var Rectangle=__webpack_require__("./geom/rectangle/Rectangle.js");var StableSort=__webpack_require__("./utils/array/StableSort.js");var Vector2=__webpack_require__("./math/Vector2.js");var Wrap=__webpack_require__("./math/Wrap.js");var ParticleEmitter=new Class({Mixins:[Components.BlendMode,Components.Mask,Components.ScrollFactor,Components.Visible],initialize:function ParticleEmitter(manager,config)
        {this.manager=manager;this.texture=manager.texture;this.frames=[manager.defaultFrame];this.defaultFrame=manager.defaultFrame;this.configFastMap=['active','blendMode','collideBottom','collideLeft','collideRight','collideTop','deathCallback','deathCallbackScope','emitCallback','emitCallbackScope','follow','frequency','gravityX','gravityY','maxParticles','name','on','particleBringToTop','particleClass','radial','timeScale','trackVisible','visible'];this.configOpMap=['accelerationX','accelerationY','angle','alpha','bounce','delay','lifespan','maxVelocityX','maxVelocityY','moveToX','moveToY','quantity','rotate','scaleX','scaleY','speedX','speedY','tint','x','y'];this.name='';this.particleClass=Particle;this.x=new EmitterOp(config,'x',0);this.y=new EmitterOp(config,'y',0);this.radial=true;this.gravityX=0;this.gravityY=0;this.acceleration=false;this.accelerationX=new EmitterOp(config,'accelerationX',0,true);this.accelerationY=new EmitterOp(config,'accelerationY',0,true);this.maxVelocityX=new EmitterOp(config,'maxVelocityX',10000,true);this.maxVelocityY=new EmitterOp(config,'maxVelocityY',10000,true);this.speedX=new EmitterOp(config,'speedX',0,true);this.speedY=new EmitterOp(config,'speedY',0,true);this.moveTo=false;this.moveToX=new EmitterOp(config,'moveToX',0,true);this.moveToY=new EmitterOp(config,'moveToY',0,true);this.bounce=new EmitterOp(config,'bounce',0,true);this.scaleX=new EmitterOp(config,'scaleX',1);this.scaleY=new EmitterOp(config,'scaleY',1);this.tint=new EmitterOp(config,'tint',0xffffffff);this.alpha=new EmitterOp(config,'alpha',1);this.lifespan=new EmitterOp(config,'lifespan',1000);this.angle=new EmitterOp(config,'angle',{min:0,max:360});this.rotate=new EmitterOp(config,'rotate',0);this.emitCallback=null;this.emitCallbackScope=null;this.deathCallback=null;this.deathCallbackScope=null;this.maxParticles=0;this.quantity=new EmitterOp(config,'quantity',1,true);this.delay=new EmitterOp(config,'delay',0,true);this.frequency=0;this.on=true;this.particleBringToTop=true;this.timeScale=1;this.emitZone=null;this.deathZone=null;this.bounds=null;this.collideLeft=true;this.collideRight=true;this.collideTop=true;this.collideBottom=true;this.active=true;this.visible=true;this.blendMode=BlendModes.NORMAL;this.follow=null;this.followOffset=new Vector2();this.trackVisible=false;this.currentFrame=0;this.randomFrame=true;this.frameQuantity=1;this.dead=[];this.alive=[];this._counter=0;this._frameCounter=0;if(config)
        {this.fromJSON(config);}},fromJSON:function(config)
        {if(!config)
        {return this;}
            var i=0;var key='';for(i=0;i<this.configFastMap.length;i++)
        {key=this.configFastMap[i];if(HasValue(config,key))
        {this[key]=GetFastValue(config,key);}}
            for(i=0;i<this.configOpMap.length;i++)
            {key=this.configOpMap[i];if(HasValue(config,key))
            {this[key].loadConfig(config);}}
            this.acceleration=(this.accelerationX.propertyValue!==0||this.accelerationY.propertyValue!==0);this.moveTo=(this.moveToX.propertyValue!==0||this.moveToY.propertyValue!==0);if(HasValue(config,'speed'))
        {this.speedX.loadConfig(config,'speed');this.speedY=null;}
            if(HasAny(config,['speedX','speedY'])||this.moveTo)
            {this.radial=false;}
            if(HasValue(config,'scale'))
            {this.scaleX.loadConfig(config,'scale');this.scaleY=null;}
            if(HasValue(config,'callbackScope'))
            {var callbackScope=GetFastValue(config,'callbackScope',null);this.emitCallbackScope=callbackScope;this.deathCallbackScope=callbackScope;}
            if(HasValue(config,'emitZone'))
            {this.setEmitZone(config.emitZone);}
            if(HasValue(config,'deathZone'))
            {this.setDeathZone(config.deathZone);}
            if(HasValue(config,'bounds'))
            {this.setBounds(config.bounds);}
            if(HasValue(config,'followOffset'))
            {this.followOffset.setFromObject(GetFastValue(config,'followOffset',0));}
            if(HasValue(config,'frame'))
            {this.setFrame(config.frame);}
            return this;},toJSON:function(output)
        {if(output===undefined){output={};}
            var i=0;var key='';for(i=0;i<this.configFastMap.length;i++)
        {key=this.configFastMap[i];output[key]=this[key];}
            for(i=0;i<this.configOpMap.length;i++)
            {key=this.configOpMap[i];if(this[key])
            {output[key]=this[key].toJSON();}}
            if(!this.speedY)
            {delete output.speedX;output.speed=this.speedX.toJSON();}
            if(!this.scaleY)
            {delete output.scaleX;output.scale=this.scaleX.toJSON();}
            return output;},startFollow:function(target,offsetX,offsetY,trackVisible)
        {if(offsetX===undefined){offsetX=0;}
            if(offsetY===undefined){offsetY=0;}
            if(trackVisible===undefined){trackVisible=false;}
            this.follow=target;this.followOffset.set(offsetX,offsetY);this.trackVisible=trackVisible;return this;},stopFollow:function()
        {this.follow=null;this.followOffset.set(0,0);this.trackVisible=false;return this;},getFrame:function()
        {if(this.frames.length===1)
        {return this.defaultFrame;}
        else if(this.randomFrame)
        {return GetRandom(this.frames);}
        else
        {var frame=this.frames[this.currentFrame];this._frameCounter++;if(this._frameCounter===this.frameQuantity)
        {this._frameCounter=0;this.currentFrame=Wrap(this.currentFrame+1,0,this._frameLength);}
            return frame;}},setFrame:function(frames,pickRandom,quantity)
        {if(pickRandom===undefined){pickRandom=true;}
            if(quantity===undefined){quantity=1;}
            this.randomFrame=pickRandom;this.frameQuantity=quantity;this.currentFrame=0;this._frameCounter=0;var t=typeof(frames);if(Array.isArray(frames)||t==='string'||t==='number')
        {this.manager.setEmitterFrames(frames,this);}
        else if(t==='object')
        {var frameConfig=frames;frames=GetFastValue(frameConfig,'frames',null);if(frames)
        {this.manager.setEmitterFrames(frames,this);}
            var isCycle=GetFastValue(frameConfig,'cycle',false);this.randomFrame=(isCycle)?false:true;this.frameQuantity=GetFastValue(frameConfig,'quantity',quantity);}
            this._frameLength=this.frames.length;if(this._frameLength===1)
        {this.frameQuantity=1;this.randomFrame=false;}
            return this;},setRadial:function(value)
        {if(value===undefined){value=true;}
            this.radial=value;return this;},setPosition:function(x,y)
        {this.x.onChange(x);this.y.onChange(y);return this;},setBounds:function(x,y,width,height)
        {if(typeof x==='object')
        {var obj=x;x=obj.x;y=obj.y;width=(HasValue(obj,'w'))?obj.w:obj.width;height=(HasValue(obj,'h'))?obj.h:obj.height;}
            if(this.bounds)
            {this.bounds.setTo(x,y,width,height);}
            else
            {this.bounds=new Rectangle(x,y,width,height);}
            return this;},setSpeedX:function(value)
        {this.speedX.onChange(value);this.radial=false;return this;},setSpeedY:function(value)
        {if(this.speedY)
        {this.speedY.onChange(value);this.radial=false;}
            return this;},setSpeed:function(value)
        {this.speedX.onChange(value);this.speedY=null;this.radial=true;return this;},setScaleX:function(value)
        {this.scaleX.onChange(value);return this;},setScaleY:function(value)
        {this.scaleY.onChange(value);return this;},setScale:function(value)
        {this.scaleX.onChange(value);this.scaleY=null;return this;},setGravityX:function(value)
        {this.gravityX=value;return this;},setGravityY:function(value)
        {this.gravityY=value;return this;},setGravity:function(x,y)
        {this.gravityX=x;this.gravityY=y;return this;},setAlpha:function(value)
        {this.alpha.onChange(value);return this;},setEmitterAngle:function(value)
        {this.angle.onChange(value);return this;},setAngle:function(value)
        {this.angle.onChange(value);return this;},setLifespan:function(value)
        {this.lifespan.onChange(value);return this;},setQuantity:function(quantity)
        {this.quantity.onChange(quantity);return this;},setFrequency:function(frequency,quantity)
        {this.frequency=frequency;this._counter=0;if(quantity)
        {this.quantity.onChange(quantity);}
            return this;},setEmitZone:function(zoneConfig)
        {if(zoneConfig===undefined)
        {this.emitZone=null;}
        else
        {var type=GetFastValue(zoneConfig,'type','random');var source=GetFastValue(zoneConfig,'source',null);switch(type)
        {case'random':this.emitZone=new RandomZone(source);break;case'edge':var quantity=GetFastValue(zoneConfig,'quantity',1);var stepRate=GetFastValue(zoneConfig,'stepRate',0);var yoyo=GetFastValue(zoneConfig,'yoyo',false);var seamless=GetFastValue(zoneConfig,'seamless',true);this.emitZone=new EdgeZone(source,quantity,stepRate,yoyo,seamless);break;}}
            return this;},setDeathZone:function(zoneConfig)
        {if(zoneConfig===undefined)
        {this.deathZone=null;}
        else
        {var type=GetFastValue(zoneConfig,'type','onEnter');var source=GetFastValue(zoneConfig,'source',null);if(source&&typeof source.contains==='function')
        {var killOnEnter=(type==='onEnter')?true:false;this.deathZone=new DeathZone(source,killOnEnter);}}
            return this;},reserve:function(particleCount)
        {var dead=this.dead;for(var i=0;i<particleCount;i++)
        {dead.push(new this.particleClass(this));}
            return this;},getAliveParticleCount:function()
        {return this.alive.length;},getDeadParticleCount:function()
        {return this.dead.length;},getParticleCount:function()
        {return this.getAliveParticleCount()+this.getDeadParticleCount();},atLimit:function()
        {return(this.maxParticles>0&&this.getParticleCount()===this.maxParticles);},onParticleEmit:function(callback,context)
        {if(callback===undefined)
        {this.emitCallback=null;this.emitCallbackScope=null;}
        else if(typeof callback==='function')
        {this.emitCallback=callback;if(context)
        {this.emitCallbackScope=context;}}
            return this;},onParticleDeath:function(callback,context)
        {if(callback===undefined)
        {this.deathCallback=null;this.deathCallbackScope=null;}
        else if(typeof callback==='function')
        {this.deathCallback=callback;if(context)
        {this.deathCallbackScope=context;}}
            return this;},killAll:function()
        {var dead=this.dead;var alive=this.alive;while(alive.length>0)
        {dead.push(alive.pop());}
            return this;},forEachAlive:function(callback,context)
        {var alive=this.alive;var length=alive.length;for(var index=0;index<length;++index)
        {callback.call(context,alive[index],this);}
            return this;},forEachDead:function(callback,context)
        {var dead=this.dead;var length=dead.length;for(var index=0;index<length;++index)
        {callback.call(context,dead[index],this);}
            return this;},start:function()
        {this.on=true;this._counter=0;return this;},stop:function()
        {this.on=false;return this;},pause:function()
        {this.active=false;return this;},resume:function()
        {this.active=true;return this;},depthSort:function()
        {StableSort.inplace(this.alive,this.depthSortCallback);return this;},flow:function(frequency,count)
        {if(count===undefined){count=1;}
            this.frequency=frequency;this.quantity.onChange(count);return this.start();},explode:function(count,x,y)
        {this.frequency=-1;return this.emitParticle(count,x,y);},emitParticleAt:function(x,y,count)
        {return this.emitParticle(count,x,y);},emitParticle:function(count,x,y)
        {if(this.atLimit())
        {return;}
            if(count===undefined)
            {count=this.quantity.onEmit();}
            var dead=this.dead;for(var i=0;i<count;i++)
        {var particle=dead.pop();if(!particle)
        {particle=new this.particleClass(this);}
            particle.fire(x,y);if(this.particleBringToTop)
        {this.alive.push(particle);}
        else
        {this.alive.unshift(particle);}
            if(this.emitCallback)
            {this.emitCallback.call(this.emitCallbackScope,particle,this);}
            if(this.atLimit())
            {break;}}
            return particle;},preUpdate:function(time,delta)
        {delta*=this.timeScale;var step=(delta / 1000);if(this.trackVisible)
        {this.visible=this.follow.visible;}
            var processors=this.manager.getProcessors();var particles=this.alive;var dead=this.dead;var i=0;var rip=[];var length=particles.length;for(i=0;i<length;i++)
        {var particle=particles[i];if(particle.update(delta,step,processors))
        {rip.push({index:i,particle:particle});}}
            length=rip.length;if(length>0)
        {var deathCallback=this.deathCallback;var deathCallbackScope=this.deathCallbackScope;for(i=length-1;i>=0;i--)
        {var entry=rip[i];particles.splice(entry.index,1);dead.push(entry.particle);if(deathCallback)
        {deathCallback.call(deathCallbackScope,entry.particle);}
            entry.particle.resetPosition();}}
            if(!this.on)
            {return;}
            if(this.frequency===0)
            {this.emitParticle();}
            else if(this.frequency>0)
            {this._counter-=delta;if(this._counter<=0)
            {this.emitParticle();this._counter=(this.frequency-Math.abs(this._counter));}}},depthSortCallback:function(a,b)
        {return a.y-b.y;}});module.exports=ParticleEmitter;}),"./gameobjects/particles/ParticleEmitterManager.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Components=__webpack_require__("./gameobjects/components/index.js");var GameObject=__webpack_require__("./gameobjects/GameObject.js");var GravityWell=__webpack_require__("./gameobjects/particles/GravityWell.js");var List=__webpack_require__("./structs/List.js");var ParticleEmitter=__webpack_require__("./gameobjects/particles/ParticleEmitter.js");var Render=__webpack_require__("./gameobjects/particles/ParticleManagerRender.js");var ParticleEmitterManager=new Class({Extends:GameObject,Mixins:[Components.Depth,Components.Pipeline,Components.Transform,Components.Visible,Render],initialize:function ParticleEmitterManager(scene,texture,frame,emitters)
        {GameObject.call(this,scene,'ParticleEmitterManager');this.blendMode=-1;this.timeScale=1;this.texture=null;this.frame=null;this.frameNames=[];if(frame!==null&&(typeof frame==='object'||Array.isArray(frame)))
        {emitters=frame;frame=null;}
            this.setTexture(texture,frame);this.initPipeline();this.emitters=new List(this);this.wells=new List(this);if(emitters)
        {if(!Array.isArray(emitters))
        {emitters=[emitters];}
            for(var i=0;i<emitters.length;i++)
            {this.createEmitter(emitters[i]);}}},setTexture:function(key,frame)
        {this.texture=this.scene.sys.textures.get(key);return this.setFrame(frame);},setFrame:function(frame)
        {this.frame=this.texture.get(frame);var frames=this.texture.getFramesFromTextureSource(this.frame.sourceIndex);var names=[];frames.forEach(function(sourceFrame)
        {names.push(sourceFrame.name);});this.frameNames=names;this.defaultFrame=this.frame;return this;},setEmitterFrames:function(frames,emitter)
        {if(!Array.isArray(frames))
        {frames=[frames];}
            var out=emitter.frames;out.length=0;for(var i=0;i<frames.length;i++)
        {var frame=frames[i];if(this.frameNames.indexOf(frame)!==-1)
        {out.push(this.texture.get(frame));}}
            if(out.length>0)
            {emitter.defaultFrame=out[0];}
            else
            {emitter.defaultFrame=this.defaultFrame;}
            return this;},addEmitter:function(emitter)
        {return this.emitters.add(emitter);},createEmitter:function(config)
        {return this.addEmitter(new ParticleEmitter(this,config));},addGravityWell:function(well)
        {return this.wells.add(well);},createGravityWell:function(config)
        {return this.addGravityWell(new GravityWell(config));},emitParticle:function(count,x,y)
        {var emitters=this.emitters.list;for(var i=0;i<emitters.length;i++)
        {var emitter=emitters[i];if(emitter.active)
        {emitter.emitParticle(count,x,y);}}
            return this;},emitParticleAt:function(x,y,count)
        {return this.emitParticle(count,x,y);},pause:function()
        {this.active=false;return this;},resume:function()
        {this.active=true;return this;},getProcessors:function()
        {return this.wells.getAll('active',true);},preUpdate:function(time,delta)
        {delta*=this.timeScale;var emitters=this.emitters.list;for(var i=0;i<emitters.length;i++)
        {var emitter=emitters[i];if(emitter.active)
        {emitter.preUpdate(time,delta);}}},setAlpha:function()
        {},setScrollFactor:function()
        {},setBlendMode:function()
        {}});module.exports=ParticleEmitterManager;}),"./gameobjects/particles/ParticleManagerCanvasRenderer.js":(function(module,exports){var ParticleManagerCanvasRenderer=function(renderer,emitterManager,interpolationPercentage,camera,parentMatrix)
    {var emitters=emitterManager.emitters.list;var emittersLength=emitters.length;if(emittersLength===0)
    {return;}
        var camMatrix=renderer._tempMatrix1.copyFrom(camera.matrix);var calcMatrix=renderer._tempMatrix2;var particleMatrix=renderer._tempMatrix3;var managerMatrix=renderer._tempMatrix4.applyITRS(emitterManager.x,emitterManager.y,emitterManager.rotation,emitterManager.scaleX,emitterManager.scaleY);camMatrix.multiply(managerMatrix);var roundPixels=camera.roundPixels;var ctx=renderer.currentContext;ctx.save();for(var e=0;e<emittersLength;e++)
    {var emitter=emitters[e];var particles=emitter.alive;var particleCount=particles.length;if(!emitter.visible||particleCount===0)
    {continue;}
        var scrollX=camera.scrollX*emitter.scrollFactorX;var scrollY=camera.scrollY*emitter.scrollFactorY;if(parentMatrix)
    {camMatrix.multiplyWithOffset(parentMatrix,-scrollX,-scrollY);scrollX=0;scrollY=0;}
        ctx.globalCompositeOperation=renderer.blendModes[emitter.blendMode];for(var i=0;i<particleCount;i++)
    {var particle=particles[i];var alpha=particle.alpha*camera.alpha;if(alpha<=0)
    {continue;}
        var frame=particle.frame;var cd=frame.canvasData;var x=-(frame.halfWidth);var y=-(frame.halfHeight);particleMatrix.applyITRS(0,0,particle.rotation,particle.scaleX,particle.scaleY);particleMatrix.e=particle.x-scrollX;particleMatrix.f=particle.y-scrollY;camMatrix.multiply(particleMatrix,calcMatrix);ctx.globalAlpha=alpha;ctx.save();calcMatrix.copyToContext(ctx);if(roundPixels)
    {x=Math.round(x);y=Math.round(y);}
        ctx.drawImage(frame.source.image,cd.x,cd.y,cd.width,cd.height,x,y,cd.width,cd.height);ctx.restore();}}
        ctx.restore();};module.exports=ParticleManagerCanvasRenderer;}),"./gameobjects/particles/ParticleManagerCreator.js":(function(module,exports,__webpack_require__){var GameObjectCreator=__webpack_require__("./gameobjects/GameObjectCreator.js");var GetAdvancedValue=__webpack_require__("./utils/object/GetAdvancedValue.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var ParticleEmitterManager=__webpack_require__("./gameobjects/particles/ParticleEmitterManager.js");GameObjectCreator.register('particles',function(config,addToScene)
    {if(config===undefined){config={};}
        var key=GetAdvancedValue(config,'key',null);var frame=GetAdvancedValue(config,'frame',null);var emitters=GetFastValue(config,'emitters',null);var manager=new ParticleEmitterManager(this.scene,key,frame,emitters);if(addToScene!==undefined)
    {config.add=addToScene;}
        var add=GetFastValue(config,'add',false);if(add)
    {this.displayList.add(manager);}
        this.updateList.add(manager);return manager;});}),"./gameobjects/particles/ParticleManagerFactory.js":(function(module,exports,__webpack_require__){var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");var ParticleEmitterManager=__webpack_require__("./gameobjects/particles/ParticleEmitterManager.js");GameObjectFactory.register('particles',function(key,frame,emitters)
    {var manager=new ParticleEmitterManager(this.scene,key,frame,emitters);this.displayList.add(manager);this.updateList.add(manager);return manager;});}),"./gameobjects/particles/ParticleManagerRender.js":(function(module,exports,__webpack_require__){var renderWebGL=__webpack_require__("./utils/NOOP.js");var renderCanvas=__webpack_require__("./utils/NOOP.js");if(true)
    {renderWebGL=__webpack_require__("./gameobjects/particles/ParticleManagerWebGLRenderer.js");}
        if(true)
        {renderCanvas=__webpack_require__("./gameobjects/particles/ParticleManagerCanvasRenderer.js");}
        module.exports={renderWebGL:renderWebGL,renderCanvas:renderCanvas};}),"./gameobjects/particles/ParticleManagerWebGLRenderer.js":(function(module,exports,__webpack_require__){var Utils=__webpack_require__("./renderer/webgl/Utils.js");var ParticleManagerWebGLRenderer=function(renderer,emitterManager,interpolationPercentage,camera,parentMatrix)
    {var emitters=emitterManager.emitters.list;var emittersLength=emitters.length;if(emittersLength===0)
    {return;}
        var pipeline=this.pipeline;var camMatrix=pipeline._tempMatrix1.copyFrom(camera.matrix);var calcMatrix=pipeline._tempMatrix2;var particleMatrix=pipeline._tempMatrix3;var managerMatrix=pipeline._tempMatrix4.applyITRS(emitterManager.x,emitterManager.y,emitterManager.rotation,emitterManager.scaleX,emitterManager.scaleY);camMatrix.multiply(managerMatrix);renderer.setPipeline(pipeline);var roundPixels=camera.roundPixels;var texture=emitterManager.defaultFrame.glTexture;var getTint=Utils.getTintAppendFloatAlphaAndSwap;pipeline.setTexture2D(texture,0);for(var e=0;e<emittersLength;e++)
    {var emitter=emitters[e];var particles=emitter.alive;var particleCount=particles.length;if(!emitter.visible||particleCount===0)
    {continue;}
        var scrollX=camera.scrollX*emitter.scrollFactorX;var scrollY=camera.scrollY*emitter.scrollFactorY;if(parentMatrix)
    {camMatrix.multiplyWithOffset(parentMatrix,-scrollX,-scrollY);scrollX=0;scrollY=0;}
        if(renderer.setBlendMode(emitter.blendMode))
        {pipeline.setTexture2D(texture,0);}
        var tintEffect=0;for(var i=0;i<particleCount;i++)
    {var particle=particles[i];var alpha=particle.alpha*camera.alpha;if(alpha<=0)
    {continue;}
        var frame=particle.frame;var x=-(frame.halfWidth);var y=-(frame.halfHeight);var xw=x+frame.width;var yh=y+frame.height;particleMatrix.applyITRS(0,0,particle.rotation,particle.scaleX,particle.scaleY);particleMatrix.e=particle.x-scrollX;particleMatrix.f=particle.y-scrollY;camMatrix.multiply(particleMatrix,calcMatrix);var tx0=calcMatrix.getX(x,y);var ty0=calcMatrix.getY(x,y);var tx1=calcMatrix.getX(x,yh);var ty1=calcMatrix.getY(x,yh);var tx2=calcMatrix.getX(xw,yh);var ty2=calcMatrix.getY(xw,yh);var tx3=calcMatrix.getX(xw,y);var ty3=calcMatrix.getY(xw,y);if(roundPixels)
    {tx0=Math.round(tx0);ty0=Math.round(ty0);tx1=Math.round(tx1);ty1=Math.round(ty1);tx2=Math.round(tx2);ty2=Math.round(ty2);tx3=Math.round(tx3);ty3=Math.round(ty3);}
        var tint=getTint(particle.tint,alpha);pipeline.batchQuad(tx0,ty0,tx1,ty1,tx2,ty2,tx3,ty3,frame.u0,frame.v0,frame.u1,frame.v1,tint,tint,tint,tint,tintEffect,texture,0);}}};module.exports=ParticleManagerWebGLRenderer;}),"./gameobjects/particles/index.js":(function(module,exports,__webpack_require__){module.exports={GravityWell:__webpack_require__("./gameobjects/particles/GravityWell.js"),Particle:__webpack_require__("./gameobjects/particles/Particle.js"),ParticleEmitter:__webpack_require__("./gameobjects/particles/ParticleEmitter.js"),ParticleEmitterManager:__webpack_require__("./gameobjects/particles/ParticleEmitterManager.js"),Zones:__webpack_require__("./gameobjects/particles/zones/index.js")};}),"./gameobjects/particles/zones/DeathZone.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var DeathZone=new Class({initialize:function DeathZone(source,killOnEnter)
        {this.source=source;this.killOnEnter=killOnEnter;},willKill:function(particle)
        {var withinZone=this.source.contains(particle.x,particle.y);return(withinZone&&this.killOnEnter||!withinZone&&!this.killOnEnter);}});module.exports=DeathZone;}),"./gameobjects/particles/zones/EdgeZone.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var EdgeZone=new Class({initialize:function EdgeZone(source,quantity,stepRate,yoyo,seamless)
        {if(yoyo===undefined){yoyo=false;}
            if(seamless===undefined){seamless=true;}
            this.source=source;this.points=[];this.quantity=quantity;this.stepRate=stepRate;this.yoyo=yoyo;this.counter=-1;this.seamless=seamless;this._length=0;this._direction=0;this.updateSource();},updateSource:function()
        {this.points=this.source.getPoints(this.quantity,this.stepRate);if(this.seamless)
        {var a=this.points[0];var b=this.points[this.points.length-1];if(a.x===b.x&&a.y===b.y)
        {this.points.pop();}}
            var oldLength=this._length;this._length=this.points.length;if(this._length<oldLength&&this.counter>this._length)
        {this.counter=this._length-1;}
            return this;},changeSource:function(source)
        {this.source=source;return this.updateSource();},getPoint:function(particle)
        {if(this._direction===0)
        {this.counter++;if(this.counter>=this._length)
        {if(this.yoyo)
        {this._direction=1;this.counter=this._length-1;}
        else
        {this.counter=0;}}}
        else
        {this.counter--;if(this.counter===-1)
        {if(this.yoyo)
        {this._direction=0;this.counter=0;}
        else
        {this.counter=this._length-1;}}}
            var point=this.points[this.counter];if(point)
        {particle.x=point.x;particle.y=point.y;}}});module.exports=EdgeZone;}),"./gameobjects/particles/zones/RandomZone.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Vector2=__webpack_require__("./math/Vector2.js");var RandomZone=new Class({initialize:function RandomZone(source)
        {this.source=source;this._tempVec=new Vector2();},getPoint:function(particle)
        {var vec=this._tempVec;this.source.getRandomPoint(vec);particle.x=vec.x;particle.y=vec.y;}});module.exports=RandomZone;}),"./gameobjects/particles/zones/index.js":(function(module,exports,__webpack_require__){module.exports={DeathZone:__webpack_require__("./gameobjects/particles/zones/DeathZone.js"),EdgeZone:__webpack_require__("./gameobjects/particles/zones/EdgeZone.js"),RandomZone:__webpack_require__("./gameobjects/particles/zones/RandomZone.js")};}),"./gameobjects/pathfollower/PathFollower.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var DegToRad=__webpack_require__("./math/DegToRad.js");var GetBoolean=__webpack_require__("./tweens/builders/GetBoolean.js");var GetValue=__webpack_require__("./utils/object/GetValue.js");var Sprite=__webpack_require__("./gameobjects/sprite/Sprite.js");var TWEEN_CONST=__webpack_require__("./tweens/tween/const.js");var Vector2=__webpack_require__("./math/Vector2.js");var PathFollower=new Class({Extends:Sprite,initialize:function PathFollower(scene,path,x,y,texture,frame)
        {Sprite.call(this,scene,x,y,texture,frame);this.path=path;this.rotateToPath=false;this.pathRotationOffset=0;this.pathOffset=new Vector2(x,y);this.pathVector=new Vector2();this.pathTween;this.pathConfig=null;this._prevDirection=TWEEN_CONST.PLAYING_FORWARD;},setPath:function(path,config)
        {if(config===undefined){config=this.pathConfig;}
            var tween=this.pathTween;if(tween&&tween.isPlaying())
        {tween.stop();}
            this.path=path;if(config)
        {this.startFollow(config);}
            return this;},setRotateToPath:function(value,offset)
        {if(offset===undefined){offset=0;}
            this.rotateToPath=value;this.pathRotationOffset=offset;return this;},isFollowing:function()
        {var tween=this.pathTween;return(tween&&tween.isPlaying());},startFollow:function(config,startAt)
        {if(config===undefined){config={};}
            if(startAt===undefined){startAt=0;}
            var tween=this.pathTween;if(tween&&tween.isPlaying())
        {tween.stop();}
            if(typeof config==='number')
            {config={duration:config};}
            config.from=0;config.to=1;var positionOnPath=GetBoolean(config,'positionOnPath',false);this.rotateToPath=GetBoolean(config,'rotateToPath',false);this.pathRotationOffset=GetValue(config,'rotationOffset',0);var seek=GetValue(config,'startAt',startAt);if(seek)
        {config.onStart=function(tween)
        {var tweenData=tween.data[0];tweenData.progress=seek;tweenData.elapsed=tweenData.duration*seek;var v=tweenData.ease(tweenData.progress);tweenData.current=tweenData.start+((tweenData.end-tweenData.start)*v);tweenData.target[tweenData.key]=tweenData.current;};}
            this.pathTween=this.scene.sys.tweens.addCounter(config);this.path.getStartPoint(this.pathOffset);if(positionOnPath)
        {this.x=this.pathOffset.x;this.y=this.pathOffset.y;}
            this.pathOffset.x=this.x-this.pathOffset.x;this.pathOffset.y=this.y-this.pathOffset.y;this._prevDirection=TWEEN_CONST.PLAYING_FORWARD;if(this.rotateToPath)
        {var nextPoint=this.path.getPoint(0.1);this.rotation=Math.atan2(nextPoint.y-this.y,nextPoint.x-this.x)+DegToRad(this.pathRotationOffset);}
            this.pathConfig=config;return this;},pauseFollow:function()
        {var tween=this.pathTween;if(tween&&tween.isPlaying())
        {tween.pause();}
            return this;},resumeFollow:function()
        {var tween=this.pathTween;if(tween&&tween.isPaused())
        {tween.resume();}
            return this;},stopFollow:function()
        {var tween=this.pathTween;if(tween&&tween.isPlaying())
        {tween.stop();}
            return this;},preUpdate:function(time,delta)
        {this.anims.update(time,delta);var tween=this.pathTween;if(tween)
        {var tweenData=tween.data[0];if(tweenData.state!==TWEEN_CONST.PLAYING_FORWARD&&tweenData.state!==TWEEN_CONST.PLAYING_BACKWARD)
        {return;}
            var pathVector=this.pathVector;this.path.getPoint(tween.getValue(),pathVector);pathVector.add(this.pathOffset);var oldX=this.x;var oldY=this.y;this.setPosition(pathVector.x,pathVector.y);var speedX=this.x-oldX;var speedY=this.y-oldY;if(speedX===0&&speedY===0)
        {return;}
            if(tweenData.state!==this._prevDirection)
            {this._prevDirection=tweenData.state;return;}
            if(this.rotateToPath)
            {this.rotation=Math.atan2(speedY,speedX)+DegToRad(this.pathRotationOffset);}}}});module.exports=PathFollower;}),"./gameobjects/pathfollower/PathFollowerFactory.js":(function(module,exports,__webpack_require__){var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");var PathFollower=__webpack_require__("./gameobjects/pathfollower/PathFollower.js");GameObjectFactory.register('follower',function(path,x,y,key,frame)
    {var sprite=new PathFollower(this.scene,path,x,y,key,frame);this.displayList.add(sprite);this.updateList.add(sprite);return sprite;});}),"./gameobjects/quad/Quad.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Mesh=__webpack_require__("./gameobjects/mesh/Mesh.js");var Quad=new Class({Extends:Mesh,initialize:function Quad(scene,x,y,texture,frame)
        {var vertices=[0,0,0,0,0,0,0,0,0,0,0,0];var uv=[0,0,0,1,1,1,0,0,1,1,1,0];var colors=[0xffffff,0xffffff,0xffffff,0xffffff,0xffffff,0xffffff];var alphas=[1,1,1,1,1,1];Mesh.call(this,scene,x,y,vertices,uv,colors,alphas,texture,frame);this.resetPosition();},setFrame:function(frame)
        {this.frame=this.texture.get(frame);if(!this.frame.cutWidth||!this.frame.cutHeight)
        {this.renderFlags&=~8;}
        else
        {this.renderFlags|=8;}
            frame=this.frame;this.uv[0]=frame.u0;this.uv[1]=frame.v0;this.uv[2]=frame.u0;this.uv[3]=frame.v1;this.uv[4]=frame.u1;this.uv[5]=frame.v1;this.uv[6]=frame.u0;this.uv[7]=frame.v0;this.uv[8]=frame.u1;this.uv[9]=frame.v1;this.uv[10]=frame.u1;this.uv[11]=frame.v0;return this;},topLeftX:{get:function()
            {return this.x+this.vertices[0];},set:function(value)
            {this.vertices[0]=value-this.x;this.vertices[6]=value-this.x;}},topLeftY:{get:function()
            {return this.y+this.vertices[1];},set:function(value)
            {this.vertices[1]=value-this.y;this.vertices[7]=value-this.y;}},topRightX:{get:function()
            {return this.x+this.vertices[10];},set:function(value)
            {this.vertices[10]=value-this.x;}},topRightY:{get:function()
            {return this.y+this.vertices[11];},set:function(value)
            {this.vertices[11]=value-this.y;}},bottomLeftX:{get:function()
            {return this.x+this.vertices[2];},set:function(value)
            {this.vertices[2]=value-this.x;}},bottomLeftY:{get:function()
            {return this.y+this.vertices[3];},set:function(value)
            {this.vertices[3]=value-this.y;}},bottomRightX:{get:function()
            {return this.x+this.vertices[4];},set:function(value)
            {this.vertices[4]=value-this.x;this.vertices[8]=value-this.x;}},bottomRightY:{get:function()
            {return this.y+this.vertices[5];},set:function(value)
            {this.vertices[5]=value-this.y;this.vertices[9]=value-this.y;}},topLeftAlpha:{get:function()
            {return this.alphas[0];},set:function(value)
            {this.alphas[0]=value;this.alphas[3]=value;}},topRightAlpha:{get:function()
            {return this.alphas[5];},set:function(value)
            {this.alphas[5]=value;}},bottomLeftAlpha:{get:function()
            {return this.alphas[1];},set:function(value)
            {this.alphas[1]=value;}},bottomRightAlpha:{get:function()
            {return this.alphas[2];},set:function(value)
            {this.alphas[2]=value;this.alphas[4]=value;}},topLeftColor:{get:function()
            {return this.colors[0];},set:function(value)
            {this.colors[0]=value;this.colors[3]=value;}},topRightColor:{get:function()
            {return this.colors[5];},set:function(value)
            {this.colors[5]=value;}},bottomLeftColor:{get:function()
            {return this.colors[1];},set:function(value)
            {this.colors[1]=value;}},bottomRightColor:{get:function()
            {return this.colors[2];},set:function(value)
            {this.colors[2]=value;this.colors[4]=value;}},setTopLeft:function(x,y)
        {this.topLeftX=x;this.topLeftY=y;return this;},setTopRight:function(x,y)
        {this.topRightX=x;this.topRightY=y;return this;},setBottomLeft:function(x,y)
        {this.bottomLeftX=x;this.bottomLeftY=y;return this;},setBottomRight:function(x,y)
        {this.bottomRightX=x;this.bottomRightY=y;return this;},resetPosition:function()
        {var x=this.x;var y=this.y;var halfWidth=Math.floor(this.width / 2);var halfHeight=Math.floor(this.height / 2);this.setTopLeft(x-halfWidth,y-halfHeight);this.setTopRight(x+halfWidth,y-halfHeight);this.setBottomLeft(x-halfWidth,y+halfHeight);this.setBottomRight(x+halfWidth,y+halfHeight);return this;},resetAlpha:function()
        {var alphas=this.alphas;alphas[0]=1;alphas[1]=1;alphas[2]=1;alphas[3]=1;alphas[4]=1;alphas[5]=1;return this;},resetColors:function()
        {var colors=this.colors;colors[0]=0xffffff;colors[1]=0xffffff;colors[2]=0xffffff;colors[3]=0xffffff;colors[4]=0xffffff;colors[5]=0xffffff;return this;},reset:function()
        {this.resetPosition();this.resetAlpha();return this.resetColors();}});module.exports=Quad;}),"./gameobjects/quad/QuadCreator.js":(function(module,exports,__webpack_require__){var BuildGameObject=__webpack_require__("./gameobjects/BuildGameObject.js");var GameObjectCreator=__webpack_require__("./gameobjects/GameObjectCreator.js");var GetAdvancedValue=__webpack_require__("./utils/object/GetAdvancedValue.js");var Quad=__webpack_require__("./gameobjects/quad/Quad.js");GameObjectCreator.register('quad',function(config,addToScene)
    {if(config===undefined){config={};}
        var x=GetAdvancedValue(config,'x',0);var y=GetAdvancedValue(config,'y',0);var key=GetAdvancedValue(config,'key',null);var frame=GetAdvancedValue(config,'frame',null);var quad=new Quad(this.scene,x,y,key,frame);if(addToScene!==undefined)
    {config.add=addToScene;}
        BuildGameObject(this.scene,quad,config);return quad;});}),"./gameobjects/quad/QuadFactory.js":(function(module,exports,__webpack_require__){var Quad=__webpack_require__("./gameobjects/quad/Quad.js");var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");if(true)
    {GameObjectFactory.register('quad',function(x,y,key,frame)
    {return this.displayList.add(new Quad(this.scene,x,y,key,frame));});}}),"./gameobjects/rendertexture/RenderTexture.js":(function(module,exports,__webpack_require__){var BlendModes=__webpack_require__("./renderer/BlendModes.js");var Camera=__webpack_require__("./cameras/2d/BaseCamera.js");var CanvasPool=__webpack_require__("./display/canvas/CanvasPool.js");var Class=__webpack_require__("./utils/Class.js");var Components=__webpack_require__("./gameobjects/components/index.js");var CONST=__webpack_require__("./const.js");var Frame=__webpack_require__("./textures/Frame.js");var GameObject=__webpack_require__("./gameobjects/GameObject.js");var Render=__webpack_require__("./gameobjects/rendertexture/RenderTextureRender.js");var Utils=__webpack_require__("./renderer/webgl/Utils.js");var UUID=__webpack_require__("./utils/string/UUID.js");var RenderTexture=new Class({Extends:GameObject,Mixins:[Components.Alpha,Components.BlendMode,Components.ComputedSize,Components.Crop,Components.Depth,Components.Flip,Components.GetBounds,Components.Mask,Components.Origin,Components.Pipeline,Components.ScaleMode,Components.ScrollFactor,Components.Tint,Components.Transform,Components.Visible,Render],initialize:function RenderTexture(scene,x,y,width,height)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            if(width===undefined){width=32;}
            if(height===undefined){height=32;}
            GameObject.call(this,scene,'RenderTexture');this.renderer=scene.sys.game.renderer;this.textureManager=scene.sys.textures;this.globalTint=0xffffff;this.globalAlpha=1;this.canvas=CanvasPool.create2D(this,width,height);this.context=this.canvas.getContext('2d');this.framebuffer=null;this._crop=this.resetCropObject();this.texture=scene.sys.textures.addCanvas(UUID(),this.canvas);this.frame=this.texture.get();this._saved=false;this._eraseMode=false;this.camera=new Camera(0,0,width,height);this.dirty=false;this.gl=null;var renderer=this.renderer;if(renderer.type===CONST.WEBGL)
        {var gl=renderer.gl;this.gl=gl;this.drawGameObject=this.batchGameObjectWebGL;this.framebuffer=renderer.createFramebuffer(width,height,this.frame.source.glTexture,false);}
        else if(renderer.type===CONST.CANVAS)
        {this.drawGameObject=this.batchGameObjectCanvas;}
            this.camera.setScene(scene);this.setPosition(x,y);this.setSize(width,height);this.setOrigin(0,0);this.initPipeline();},setSize:function(width,height)
        {return this.resize(width,height);},resize:function(width,height)
        {if(height===undefined){height=width;}
            if(width!==this.width||height!==this.height)
            {this.canvas.width=width;this.canvas.height=height;if(this.gl)
            {var gl=this.gl;this.renderer.deleteTexture(this.frame.source.glTexture);this.renderer.deleteFramebuffer(this.framebuffer);this.frame.source.glTexture=this.renderer.createTexture2D(0,gl.NEAREST,gl.NEAREST,gl.CLAMP_TO_EDGE,gl.CLAMP_TO_EDGE,gl.RGBA,null,width,height,false);this.framebuffer=this.renderer.createFramebuffer(width,height,this.frame.source.glTexture,false);this.frame.glTexture=this.frame.source.glTexture;}
                this.frame.source.width=width;this.frame.source.height=height;this.camera.setSize(width,height);this.frame.setSize(width,height);this.width=width;this.height=height;}
            return this;},setGlobalTint:function(tint)
        {this.globalTint=tint;return this;},setGlobalAlpha:function(alpha)
        {this.globalAlpha=alpha;return this;},saveTexture:function(key)
        {this.textureManager.renameTexture(this.texture.key,key);this._saved=true;return this.texture;},fill:function(rgb,alpha)
        {if(alpha===undefined){alpha=1;}
            var r=((rgb>>16)|0)&0xff;var g=((rgb>>8)|0)&0xff;var b=(rgb|0)&0xff;var gl=this.gl;if(gl)
        {var renderer=this.renderer;var bounds=this.getBounds();renderer.setFramebuffer(this.framebuffer,true);renderer.pipelines.TextureTintPipeline.drawFillRect(bounds.x,bounds.y,bounds.right,bounds.bottom,Utils.getTintFromFloats(r / 255,g / 255,b / 255,1),alpha);renderer.setFramebuffer(null,true);}
        else
        {this.context.fillStyle='rgba('+r+','+g+','+b+','+alpha+')';this.context.fillRect(0,0,this.canvas.width,this.canvas.height);}
            return this;},clear:function()
        {if(this.dirty)
        {var gl=this.gl;if(gl)
        {var renderer=this.renderer;renderer.setFramebuffer(this.framebuffer,true);gl.clearColor(0,0,0,0);gl.clear(gl.COLOR_BUFFER_BIT);renderer.setFramebuffer(null,true);}
        else
        {var ctx=this.context;ctx.save();ctx.setTransform(1,0,0,1,0,0);ctx.clearRect(0,0,this.canvas.width,this.canvas.height);ctx.restore();}
            this.dirty=false;}
            return this;},erase:function(entries,x,y)
        {this._eraseMode=true;var blendMode=this.renderer.currentBlendMode;this.renderer.setBlendMode(BlendModes.ERASE);this.draw(entries,x,y,1,16777215);this.renderer.setBlendMode(blendMode);this._eraseMode=false;return this;},draw:function(entries,x,y,alpha,tint)
        {if(alpha===undefined){alpha=this.globalAlpha;}
            if(tint===undefined)
            {tint=(this.globalTint>>16)+(this.globalTint&0xff00)+((this.globalTint&0xff)<<16);}
            else
            {tint=(tint>>16)+(tint&0xff00)+((tint&0xff)<<16);}
            if(!Array.isArray(entries))
            {entries=[entries];}
            var gl=this.gl;this.camera.preRender(1,1);if(gl)
        {var cx=this.camera._cx;var cy=this.camera._cy;var cw=this.camera._cw;var ch=this.camera._ch;this.renderer.setFramebuffer(this.framebuffer,false);this.renderer.pushScissor(cx,cy,cw,ch,ch);var pipeline=this.pipeline;pipeline.projOrtho(0,this.width,0,this.height,-1000.0,1000.0);this.batchList(entries,x,y,alpha,tint);pipeline.flush();this.renderer.setFramebuffer(null,false);this.renderer.popScissor();pipeline.projOrtho(0,pipeline.width,pipeline.height,0,-1000.0,1000.0);}
        else
        {this.renderer.setContext(this.context);this.batchList(entries,x,y,alpha,tint);this.renderer.setContext();}
            this.dirty=true;return this;},drawFrame:function(key,frame,x,y,alpha,tint)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            if(alpha===undefined){alpha=this.globalAlpha;}
            if(tint===undefined)
            {tint=(this.globalTint>>16)+(this.globalTint&0xff00)+((this.globalTint&0xff)<<16);}
            else
            {tint=(tint>>16)+(tint&0xff00)+((tint&0xff)<<16);}
            var gl=this.gl;var textureFrame=this.textureManager.getFrame(key,frame);if(textureFrame)
        {this.camera.preRender(1,1);if(gl)
        {var cx=this.camera._cx;var cy=this.camera._cy;var cw=this.camera._cw;var ch=this.camera._ch;this.renderer.setFramebuffer(this.framebuffer,false);this.renderer.pushScissor(cx,cy,cw,ch,ch);var pipeline=this.pipeline;pipeline.projOrtho(0,this.width,0,this.height,-1000.0,1000.0);pipeline.batchTextureFrame(textureFrame,x,y,tint,alpha,this.camera.matrix,null);pipeline.flush();this.renderer.setFramebuffer(null,false);this.renderer.popScissor();pipeline.projOrtho(0,pipeline.width,pipeline.height,0,-1000.0,1000.0);}
        else
        {this.batchTextureFrame(textureFrame,x,y,alpha,tint);}
            this.dirty=true;}
            return this;},batchList:function(children,x,y,alpha,tint)
        {for(var i=0;i<children.length;i++)
        {var entry=children[i];if(!entry||entry===this)
        {continue;}
            if(entry.renderWebGL||entry.renderCanvas)
            {this.drawGameObject(entry,x,y);}
            else if(entry.isParent||entry.list)
            {this.batchGroup(entry.getChildren(),x,y);}
            else if(typeof entry==='string')
            {this.batchTextureFrameKey(entry,null,x,y,alpha,tint);}
            else if(entry instanceof Frame)
            {this.batchTextureFrame(entry,x,y,alpha,tint);}
            else if(Array.isArray(entry))
            {this.batchList(entry,x,y,alpha,tint);}}},batchGroup:function(children,x,y)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            for(var i=0;i<children.length;i++)
            {var entry=children[i];if(entry.willRender())
            {var tx=entry.x+x;var ty=entry.y+y;this.drawGameObject(entry,tx,ty);}}},batchGameObjectWebGL:function(gameObject,x,y)
        {if(x===undefined){x=gameObject.x;}
            if(y===undefined){y=gameObject.y;}
            var prevX=gameObject.x;var prevY=gameObject.y;if(!this._eraseMode)
        {this.renderer.setBlendMode(gameObject.blendMode);}
            gameObject.setPosition(x,y);gameObject.renderWebGL(this.renderer,gameObject,0,this.camera,null);gameObject.setPosition(prevX,prevY);},batchGameObjectCanvas:function(gameObject,x,y)
        {if(x===undefined){x=gameObject.x;}
            if(y===undefined){y=gameObject.y;}
            var prevX=gameObject.x;var prevY=gameObject.y;if(this._eraseMode)
        {var blendMode=gameObject.blendMode;gameObject.blendMode=BlendModes.ERASE;}
            gameObject.setPosition(x,y);gameObject.renderCanvas(this.renderer,gameObject,0,this.camera,null);gameObject.setPosition(prevX,prevY);if(this._eraseMode)
        {gameObject.blendMode=blendMode;}},batchTextureFrameKey:function(key,frame,x,y,alpha,tint)
        {var textureFrame=this.textureManager.getFrame(key,frame);if(textureFrame)
        {this.batchTextureFrame(textureFrame,x,y,alpha,tint);}},batchTextureFrame:function(textureFrame,x,y,alpha,tint)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            if(this.gl)
            {this.pipeline.batchTextureFrame(textureFrame,x,y,tint,alpha,this.camera.matrix,null);}
            else
            {var ctx=this.context;var cd=textureFrame.canvasData;var source=textureFrame.source.image;var matrix=this.camera.matrix;ctx.globalAlpha=this.globalAlpha;ctx.setTransform(matrix[0],matrix[1],matrix[2],matrix[3],matrix[4],matrix[5]);ctx.drawImage(source,cd.x,cd.y,cd.width,cd.height,x,y,cd.width,cd.height);}},preDestroy:function()
        {if(!this._saved)
        {CanvasPool.remove(this.canvas);if(this.gl)
        {this.renderer.deleteFramebuffer(this.framebuffer);}
            this.texture.destroy();this.camera.destroy();this.canvas=null;this.context=null;this.framebuffer=null;this.texture=null;}}});module.exports=RenderTexture;}),"./gameobjects/rendertexture/RenderTextureCanvasRenderer.js":(function(module,exports){var RenderTextureCanvasRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {renderer.batchSprite(src,src.frame,camera,parentMatrix);};module.exports=RenderTextureCanvasRenderer;}),"./gameobjects/rendertexture/RenderTextureCreator.js":(function(module,exports,__webpack_require__){var BuildGameObject=__webpack_require__("./gameobjects/BuildGameObject.js");var GameObjectCreator=__webpack_require__("./gameobjects/GameObjectCreator.js");var GetAdvancedValue=__webpack_require__("./utils/object/GetAdvancedValue.js");var RenderTexture=__webpack_require__("./gameobjects/rendertexture/RenderTexture.js");GameObjectCreator.register('renderTexture',function(config,addToScene)
    {if(config===undefined){config={};}
        var x=GetAdvancedValue(config,'x',0);var y=GetAdvancedValue(config,'y',0);var width=GetAdvancedValue(config,'width',32);var height=GetAdvancedValue(config,'height',32);var renderTexture=new RenderTexture(this.scene,x,y,width,height);if(addToScene!==undefined)
    {config.add=addToScene;}
        BuildGameObject(this.scene,renderTexture,config);return renderTexture;});}),"./gameobjects/rendertexture/RenderTextureFactory.js":(function(module,exports,__webpack_require__){var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");var RenderTexture=__webpack_require__("./gameobjects/rendertexture/RenderTexture.js");GameObjectFactory.register('renderTexture',function(x,y,width,height)
    {return this.displayList.add(new RenderTexture(this.scene,x,y,width,height));});}),"./gameobjects/rendertexture/RenderTextureRender.js":(function(module,exports,__webpack_require__){var renderWebGL=__webpack_require__("./utils/NOOP.js");var renderCanvas=__webpack_require__("./utils/NOOP.js");if(true)
    {renderWebGL=__webpack_require__("./gameobjects/rendertexture/RenderTextureWebGLRenderer.js");}
        if(true)
        {renderCanvas=__webpack_require__("./gameobjects/rendertexture/RenderTextureCanvasRenderer.js");}
        module.exports={renderWebGL:renderWebGL,renderCanvas:renderCanvas};}),"./gameobjects/rendertexture/RenderTextureWebGLRenderer.js":(function(module,exports,__webpack_require__){var Utils=__webpack_require__("./renderer/webgl/Utils.js");var RenderTextureWebGLRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var frame=src.frame;var width=frame.width;var height=frame.height;var getTint=Utils.getTintAppendFloatAlpha;this.pipeline.batchTexture(src,frame.glTexture,width,height,src.x,src.y,width,height,src.scaleX,src.scaleY,src.rotation,src.flipX,!src.flipY,src.scrollFactorX,src.scrollFactorY,src.displayOriginX,src.displayOriginY,0,0,width,height,getTint(src._tintTL,camera.alpha*src._alphaTL),getTint(src._tintTR,camera.alpha*src._alphaTR),getTint(src._tintBL,camera.alpha*src._alphaBL),getTint(src._tintBR,camera.alpha*src._alphaBR),(src._isTinted&&src.tintFill),0,0,camera,parentMatrix);renderer.setBlankTexture(true);};module.exports=RenderTextureWebGLRenderer;}),"./gameobjects/shape/FillPathWebGL.js":(function(module,exports,__webpack_require__){var Utils=__webpack_require__("./renderer/webgl/Utils.js");var FillPathWebGL=function(pipeline,calcMatrix,src,alpha,dx,dy)
    {var fillTintColor=Utils.getTintAppendFloatAlphaAndSwap(src.fillColor,src.fillAlpha*alpha);var path=src.pathData;var pathIndexes=src.pathIndexes;for(var i=0;i<pathIndexes.length;i+=3)
    {var p0=pathIndexes[i]*2;var p1=pathIndexes[i+1]*2;var p2=pathIndexes[i+2]*2;var x0=path[p0+0]-dx;var y0=path[p0+1]-dy;var x1=path[p1+0]-dx;var y1=path[p1+1]-dy;var x2=path[p2+0]-dx;var y2=path[p2+1]-dy;var tx0=calcMatrix.getX(x0,y0);var ty0=calcMatrix.getY(x0,y0);var tx1=calcMatrix.getX(x1,y1);var ty1=calcMatrix.getY(x1,y1);var tx2=calcMatrix.getX(x2,y2);var ty2=calcMatrix.getY(x2,y2);pipeline.setTexture2D();pipeline.batchTri(tx0,ty0,tx1,ty1,tx2,ty2,0,0,1,1,fillTintColor,fillTintColor,fillTintColor,pipeline.tintEffect);}};module.exports=FillPathWebGL;}),"./gameobjects/shape/FillStyleCanvas.js":(function(module,exports){var FillStyleCanvas=function(ctx,src,altColor)
    {var fillColor=(altColor)?altColor:src.fillColor;var fillAlpha=src.fillAlpha;var red=((fillColor&0xFF0000)>>>16);var green=((fillColor&0xFF00)>>>8);var blue=(fillColor&0xFF);ctx.fillStyle='rgba('+red+','+green+','+blue+','+fillAlpha+')';};module.exports=FillStyleCanvas;}),"./gameobjects/shape/LineStyleCanvas.js":(function(module,exports){var LineStyleCanvas=function(ctx,src)
    {var strokeColor=src.strokeColor;var strokeAlpha=src.strokeAlpha;var red=((strokeColor&0xFF0000)>>>16);var green=((strokeColor&0xFF00)>>>8);var blue=(strokeColor&0xFF);ctx.strokeStyle='rgba('+red+','+green+','+blue+','+strokeAlpha+')';ctx.lineWidth=src.lineWidth;};module.exports=LineStyleCanvas;}),"./gameobjects/shape/Shape.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Components=__webpack_require__("./gameobjects/components/index.js");var GameObject=__webpack_require__("./gameobjects/GameObject.js");var Line=__webpack_require__("./geom/line/Line.js");var Shape=new Class({Extends:GameObject,Mixins:[Components.Alpha,Components.BlendMode,Components.ComputedSize,Components.Depth,Components.GetBounds,Components.Mask,Components.Origin,Components.Pipeline,Components.ScaleMode,Components.ScrollFactor,Components.Transform,Components.Visible],initialize:function Shape(scene,type,data)
        {if(type===undefined){type='Shape';}
            GameObject.call(this,scene,type);this.geom=data;this.pathData=[];this.pathIndexes=[];this.fillColor=0xffffff;this.fillAlpha=1;this.strokeColor=0xffffff;this.strokeAlpha=1;this.lineWidth=1;this.isFilled=false;this.isStroked=false;this.closePath=true;this._tempLine=new Line();this.initPipeline();},setFillStyle:function(color,alpha)
        {if(alpha===undefined){alpha=1;}
            if(color===undefined)
            {this.isFilled=false;}
            else
            {this.fillColor=color;this.fillAlpha=alpha;this.isFilled=true;}
            return this;},setStrokeStyle:function(lineWidth,color,alpha)
        {if(alpha===undefined){alpha=1;}
            if(lineWidth===undefined)
            {this.isStroked=false;}
            else
            {this.lineWidth=lineWidth;this.strokeColor=color;this.strokeAlpha=alpha;this.isStroked=true;}
            return this;},setClosePath:function(value)
        {this.closePath=value;return this;},preDestroy:function()
        {this.geom=null;this._tempLine=null;this.pathData=[];this.pathIndexes=[];}});module.exports=Shape;}),"./gameobjects/shape/StrokePathWebGL.js":(function(module,exports,__webpack_require__){var Utils=__webpack_require__("./renderer/webgl/Utils.js");var StrokePathWebGL=function(pipeline,src,alpha,dx,dy)
    {var strokeTint=pipeline.strokeTint;var strokeTintColor=Utils.getTintAppendFloatAlphaAndSwap(src.strokeColor,src.strokeAlpha*alpha);strokeTint.TL=strokeTintColor;strokeTint.TR=strokeTintColor;strokeTint.BL=strokeTintColor;strokeTint.BR=strokeTintColor;var path=src.pathData;var pathLength=path.length-1;var lineWidth=src.lineWidth;var halfLineWidth=lineWidth / 2;var px1=path[0]-dx;var py1=path[1]-dy;if(!src.closePath)
    {pathLength-=2;}
        for(var i=2;i<pathLength;i+=2)
        {var px2=path[i]-dx;var py2=path[i+1]-dy;pipeline.setTexture2D();pipeline.batchLine(px1,py1,px2,py2,halfLineWidth,halfLineWidth,lineWidth,i-2,(src.closePath)?(i===pathLength-1):false);px1=px2;py1=py2;}};module.exports=StrokePathWebGL;}),"./gameobjects/shape/arc/Arc.js":(function(module,exports,__webpack_require__){var ArcRender=__webpack_require__("./gameobjects/shape/arc/ArcRender.js");var Class=__webpack_require__("./utils/Class.js");var DegToRad=__webpack_require__("./math/DegToRad.js");var Earcut=__webpack_require__("./geom/polygon/Earcut.js");var GeomCircle=__webpack_require__("./geom/circle/Circle.js");var MATH_CONST=__webpack_require__("./math/const.js");var Shape=__webpack_require__("./gameobjects/shape/Shape.js");var Arc=new Class({Extends:Shape,Mixins:[ArcRender],initialize:function Arc(scene,x,y,radius,startAngle,endAngle,anticlockwise,fillColor,fillAlpha)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            if(radius===undefined){radius=128;}
            if(startAngle===undefined){startAngle=0;}
            if(endAngle===undefined){endAngle=360;}
            if(anticlockwise===undefined){anticlockwise=false;}
            Shape.call(this,scene,'Arc',new GeomCircle(0,0,radius));this._startAngle=startAngle;this._endAngle=endAngle;this._anticlockwise=anticlockwise;this._iterations=0.01;this.setPosition(x,y);this.setSize(this.geom.radius,this.geom.radius);if(fillColor!==undefined)
        {this.setFillStyle(fillColor,fillAlpha);}
            this.updateDisplayOrigin();this.updateData();},iterations:{get:function()
            {return this._iterations;},set:function(value)
            {this._iterations=value;this.updateData();}},radius:{get:function()
            {return this.geom.radius;},set:function(value)
            {this.geom.radius=value;this.updateData();}},startAngle:{get:function()
            {return this._startAngle;},set:function(value)
            {this._startAngle=value;this.updateData();}},endAngle:{get:function()
            {return this._endAngle;},set:function(value)
            {this._endAngle=value;this.updateData();}},anticlockwise:{get:function()
            {return this._anticlockwise;},set:function(value)
            {this._anticlockwise=value;this.updateData();}},setRadius:function(value)
        {this.radius=value;return this;},setIterations:function(value)
        {if(value===undefined){value=0.01;}
            this.iterations=value;return this;},setStartAngle:function(angle,anticlockwise)
        {this._startAngle=angle;if(anticlockwise!==undefined)
        {this._anticlockwise=anticlockwise;}
            return this.updateData();},setEndAngle:function(angle,anticlockwise)
        {this._endAngle=angle;if(anticlockwise!==undefined)
        {this._anticlockwise=anticlockwise;}
            return this.updateData();},updateData:function()
        {var step=this._iterations;var iteration=step;var radius=this.geom.radius;var startAngle=DegToRad(this._startAngle);var endAngle=DegToRad(this._endAngle);var anticlockwise=this._anticlockwise;var x=radius / 2;var y=radius / 2;endAngle-=startAngle;if(anticlockwise)
        {if(endAngle<-MATH_CONST.PI2)
        {endAngle=-MATH_CONST.PI2;}
        else if(endAngle>0)
        {endAngle=-MATH_CONST.PI2+endAngle%MATH_CONST.PI2;}}
        else if(endAngle>MATH_CONST.PI2)
        {endAngle=MATH_CONST.PI2;}
        else if(endAngle<0)
        {endAngle=MATH_CONST.PI2+endAngle%MATH_CONST.PI2;}
            var path=[x+Math.cos(startAngle)*radius,y+Math.sin(startAngle)*radius];var ta;while(iteration<1)
        {ta=endAngle*iteration+startAngle;path.push(x+Math.cos(ta)*radius,y+Math.sin(ta)*radius);iteration+=step;}
            ta=endAngle+startAngle;path.push(x+Math.cos(ta)*radius,y+Math.sin(ta)*radius);path.push(x+Math.cos(startAngle)*radius,y+Math.sin(startAngle)*radius);this.pathIndexes=Earcut(path);this.pathData=path;return this;}});module.exports=Arc;}),"./gameobjects/shape/arc/ArcCanvasRenderer.js":(function(module,exports,__webpack_require__){var DegToRad=__webpack_require__("./math/DegToRad.js");var FillStyleCanvas=__webpack_require__("./gameobjects/shape/FillStyleCanvas.js");var LineStyleCanvas=__webpack_require__("./gameobjects/shape/LineStyleCanvas.js");var SetTransform=__webpack_require__("./renderer/canvas/utils/SetTransform.js");var ArcCanvasRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var ctx=renderer.currentContext;if(SetTransform(renderer,ctx,src,camera,parentMatrix))
    {var radius=src.radius;ctx.beginPath();ctx.arc((radius)-src.originX*(radius*2),(radius)-src.originY*(radius*2),radius,DegToRad(src._startAngle),DegToRad(src._endAngle),src.anticlockwise);if(src.closePath)
    {ctx.closePath();}
        if(src.isFilled)
        {FillStyleCanvas(ctx,src);ctx.fill();}
        if(src.isStroked)
        {LineStyleCanvas(ctx,src);ctx.stroke();}
        ctx.restore();}};module.exports=ArcCanvasRenderer;}),"./gameobjects/shape/arc/ArcFactory.js":(function(module,exports,__webpack_require__){var Arc=__webpack_require__("./gameobjects/shape/arc/Arc.js");var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");GameObjectFactory.register('arc',function(x,y,radius,startAngle,endAngle,anticlockwise,fillColor,fillAlpha)
    {return this.displayList.add(new Arc(this.scene,x,y,radius,startAngle,endAngle,anticlockwise,fillColor,fillAlpha));});GameObjectFactory.register('circle',function(x,y,radius,fillColor,fillAlpha)
    {return this.displayList.add(new Arc(this.scene,x,y,radius,0,360,false,fillColor,fillAlpha));});}),"./gameobjects/shape/arc/ArcRender.js":(function(module,exports,__webpack_require__){var renderWebGL=__webpack_require__("./utils/NOOP.js");var renderCanvas=__webpack_require__("./utils/NOOP.js");if(true)
    {renderWebGL=__webpack_require__("./gameobjects/shape/arc/ArcWebGLRenderer.js");}
        if(true)
        {renderCanvas=__webpack_require__("./gameobjects/shape/arc/ArcCanvasRenderer.js");}
        module.exports={renderWebGL:renderWebGL,renderCanvas:renderCanvas};}),"./gameobjects/shape/arc/ArcWebGLRenderer.js":(function(module,exports,__webpack_require__){var FillPathWebGL=__webpack_require__("./gameobjects/shape/FillPathWebGL.js");var StrokePathWebGL=__webpack_require__("./gameobjects/shape/StrokePathWebGL.js");var ArcWebGLRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var pipeline=this.pipeline;var camMatrix=pipeline._tempMatrix1;var shapeMatrix=pipeline._tempMatrix2;var calcMatrix=pipeline._tempMatrix3;renderer.setPipeline(pipeline);shapeMatrix.applyITRS(src.x,src.y,src.rotation,src.scaleX,src.scaleY);camMatrix.copyFrom(camera.matrix);if(parentMatrix)
    {camMatrix.multiplyWithOffset(parentMatrix,-camera.scrollX*src.scrollFactorX,-camera.scrollY*src.scrollFactorY);shapeMatrix.e=src.x;shapeMatrix.f=src.y;}
    else
    {shapeMatrix.e-=camera.scrollX*src.scrollFactorX;shapeMatrix.f-=camera.scrollY*src.scrollFactorY;}
        camMatrix.multiply(shapeMatrix,calcMatrix);var dx=src._displayOriginX;var dy=src._displayOriginY;var alpha=camera.alpha*src.alpha;if(src.isFilled)
    {FillPathWebGL(pipeline,calcMatrix,src,alpha,dx,dy);}
        if(src.isStroked)
        {StrokePathWebGL(pipeline,src,alpha,dx,dy);}};module.exports=ArcWebGLRenderer;}),"./gameobjects/shape/curve/Curve.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var CurveRender=__webpack_require__("./gameobjects/shape/curve/CurveRender.js");var Earcut=__webpack_require__("./geom/polygon/Earcut.js");var Rectangle=__webpack_require__("./geom/rectangle/Rectangle.js");var Shape=__webpack_require__("./gameobjects/shape/Shape.js");var Curve=new Class({Extends:Shape,Mixins:[CurveRender],initialize:function Curve(scene,x,y,curve,fillColor,fillAlpha)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            Shape.call(this,scene,'Curve',curve);this._smoothness=32;this._curveBounds=new Rectangle();this.closePath=false;this.setPosition(x,y);if(fillColor!==undefined)
        {this.setFillStyle(fillColor,fillAlpha);}
            this.updateData();},smoothness:{get:function()
            {return this._smoothness;},set:function(value)
            {this._smoothness=value;this.updateData();}},setSmoothness:function(value)
        {this._smoothness=value;return this.updateData();},updateData:function()
        {var bounds=this._curveBounds;var smoothness=this._smoothness;this.geom.getBounds(bounds,smoothness);this.setSize(bounds.width,bounds.height);this.updateDisplayOrigin();var path=[];var points=this.geom.getPoints(smoothness);for(var i=0;i<points.length;i++)
        {path.push(points[i].x,points[i].y);}
            path.push(points[0].x,points[0].y);this.pathIndexes=Earcut(path);this.pathData=path;return this;}});module.exports=Curve;}),"./gameobjects/shape/curve/CurveCanvasRenderer.js":(function(module,exports,__webpack_require__){var FillStyleCanvas=__webpack_require__("./gameobjects/shape/FillStyleCanvas.js");var LineStyleCanvas=__webpack_require__("./gameobjects/shape/LineStyleCanvas.js");var SetTransform=__webpack_require__("./renderer/canvas/utils/SetTransform.js");var CurveCanvasRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var ctx=renderer.currentContext;if(SetTransform(renderer,ctx,src,camera,parentMatrix))
    {var dx=src._displayOriginX+src._curveBounds.x;var dy=src._displayOriginY+src._curveBounds.y;var path=src.pathData;var pathLength=path.length-1;var px1=path[0]-dx;var py1=path[1]-dy;ctx.beginPath();ctx.moveTo(px1,py1);if(!src.closePath)
    {pathLength-=2;}
        for(var i=2;i<pathLength;i+=2)
        {var px2=path[i]-dx;var py2=path[i+1]-dy;ctx.lineTo(px2,py2);}
        if(src.closePath)
        {ctx.closePath();}
        if(src.isFilled)
        {FillStyleCanvas(ctx,src);ctx.fill();}
        if(src.isStroked)
        {LineStyleCanvas(ctx,src);ctx.stroke();}
        ctx.restore();}};module.exports=CurveCanvasRenderer;}),"./gameobjects/shape/curve/CurveFactory.js":(function(module,exports,__webpack_require__){var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");var Curve=__webpack_require__("./gameobjects/shape/curve/Curve.js");GameObjectFactory.register('curve',function(x,y,curve,fillColor,fillAlpha)
    {return this.displayList.add(new Curve(this.scene,x,y,curve,fillColor,fillAlpha));});}),"./gameobjects/shape/curve/CurveRender.js":(function(module,exports,__webpack_require__){var renderWebGL=__webpack_require__("./utils/NOOP.js");var renderCanvas=__webpack_require__("./utils/NOOP.js");if(true)
    {renderWebGL=__webpack_require__("./gameobjects/shape/curve/CurveWebGLRenderer.js");}
        if(true)
        {renderCanvas=__webpack_require__("./gameobjects/shape/curve/CurveCanvasRenderer.js");}
        module.exports={renderWebGL:renderWebGL,renderCanvas:renderCanvas};}),"./gameobjects/shape/curve/CurveWebGLRenderer.js":(function(module,exports,__webpack_require__){var FillPathWebGL=__webpack_require__("./gameobjects/shape/FillPathWebGL.js");var StrokePathWebGL=__webpack_require__("./gameobjects/shape/StrokePathWebGL.js");var CurveWebGLRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var pipeline=this.pipeline;var camMatrix=pipeline._tempMatrix1;var shapeMatrix=pipeline._tempMatrix2;var calcMatrix=pipeline._tempMatrix3;renderer.setPipeline(pipeline);shapeMatrix.applyITRS(src.x,src.y,src.rotation,src.scaleX,src.scaleY);camMatrix.copyFrom(camera.matrix);if(parentMatrix)
    {camMatrix.multiplyWithOffset(parentMatrix,-camera.scrollX*src.scrollFactorX,-camera.scrollY*src.scrollFactorY);shapeMatrix.e=src.x;shapeMatrix.f=src.y;}
    else
    {shapeMatrix.e-=camera.scrollX*src.scrollFactorX;shapeMatrix.f-=camera.scrollY*src.scrollFactorY;}
        camMatrix.multiply(shapeMatrix,calcMatrix);var dx=src._displayOriginX+src._curveBounds.x;var dy=src._displayOriginY+src._curveBounds.y;var alpha=camera.alpha*src.alpha;if(src.isFilled)
    {FillPathWebGL(pipeline,calcMatrix,src,alpha,dx,dy);}
        if(src.isStroked)
        {StrokePathWebGL(pipeline,src,alpha,dx,dy);}};module.exports=CurveWebGLRenderer;}),"./gameobjects/shape/ellipse/Ellipse.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Earcut=__webpack_require__("./geom/polygon/Earcut.js");var EllipseRender=__webpack_require__("./gameobjects/shape/ellipse/EllipseRender.js");var GeomEllipse=__webpack_require__("./geom/ellipse/Ellipse.js");var Shape=__webpack_require__("./gameobjects/shape/Shape.js");var Ellipse=new Class({Extends:Shape,Mixins:[EllipseRender],initialize:function Ellipse(scene,x,y,width,height,fillColor,fillAlpha)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            if(width===undefined){width=128;}
            if(height===undefined){height=128;}
            Shape.call(this,scene,'Ellipse',new GeomEllipse(width / 2,height / 2,width,height));this._smoothness=64;this.setPosition(x,y);this.width=width;this.height=height;if(fillColor!==undefined)
        {this.setFillStyle(fillColor,fillAlpha);}
            this.updateDisplayOrigin();this.updateData();},smoothness:{get:function()
            {return this._smoothness;},set:function(value)
            {this._smoothness=value;this.updateData();}},setSize:function(width,height)
        {this.geom.setSize(width,height);return this.updateData();},setSmoothness:function(value)
        {this._smoothness=value;return this.updateData();},updateData:function()
        {var path=[];var points=this.geom.getPoints(this._smoothness);for(var i=0;i<points.length;i++)
        {path.push(points[i].x,points[i].y);}
            path.push(points[0].x,points[0].y);this.pathIndexes=Earcut(path);this.pathData=path;return this;}});module.exports=Ellipse;}),"./gameobjects/shape/ellipse/EllipseCanvasRenderer.js":(function(module,exports,__webpack_require__){var FillStyleCanvas=__webpack_require__("./gameobjects/shape/FillStyleCanvas.js");var LineStyleCanvas=__webpack_require__("./gameobjects/shape/LineStyleCanvas.js");var SetTransform=__webpack_require__("./renderer/canvas/utils/SetTransform.js");var EllipseCanvasRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var ctx=renderer.currentContext;if(SetTransform(renderer,ctx,src,camera,parentMatrix))
    {var dx=src._displayOriginX;var dy=src._displayOriginY;var path=src.pathData;var pathLength=path.length-1;var px1=path[0]-dx;var py1=path[1]-dy;ctx.beginPath();ctx.moveTo(px1,py1);if(!src.closePath)
    {pathLength-=2;}
        for(var i=2;i<pathLength;i+=2)
        {var px2=path[i]-dx;var py2=path[i+1]-dy;ctx.lineTo(px2,py2);}
        ctx.closePath();if(src.isFilled)
    {FillStyleCanvas(ctx,src);ctx.fill();}
        if(src.isStroked)
        {LineStyleCanvas(ctx,src);ctx.stroke();}
        ctx.restore();}};module.exports=EllipseCanvasRenderer;}),"./gameobjects/shape/ellipse/EllipseFactory.js":(function(module,exports,__webpack_require__){var Ellipse=__webpack_require__("./gameobjects/shape/ellipse/Ellipse.js");var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");GameObjectFactory.register('ellipse',function(x,y,width,height,fillColor,fillAlpha)
    {return this.displayList.add(new Ellipse(this.scene,x,y,width,height,fillColor,fillAlpha));});}),"./gameobjects/shape/ellipse/EllipseRender.js":(function(module,exports,__webpack_require__){var renderWebGL=__webpack_require__("./utils/NOOP.js");var renderCanvas=__webpack_require__("./utils/NOOP.js");if(true)
    {renderWebGL=__webpack_require__("./gameobjects/shape/ellipse/EllipseWebGLRenderer.js");}
        if(true)
        {renderCanvas=__webpack_require__("./gameobjects/shape/ellipse/EllipseCanvasRenderer.js");}
        module.exports={renderWebGL:renderWebGL,renderCanvas:renderCanvas};}),"./gameobjects/shape/ellipse/EllipseWebGLRenderer.js":(function(module,exports,__webpack_require__){var FillPathWebGL=__webpack_require__("./gameobjects/shape/FillPathWebGL.js");var StrokePathWebGL=__webpack_require__("./gameobjects/shape/StrokePathWebGL.js");var EllipseWebGLRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var pipeline=this.pipeline;var camMatrix=pipeline._tempMatrix1;var shapeMatrix=pipeline._tempMatrix2;var calcMatrix=pipeline._tempMatrix3;renderer.setPipeline(pipeline);shapeMatrix.applyITRS(src.x,src.y,src.rotation,src.scaleX,src.scaleY);camMatrix.copyFrom(camera.matrix);if(parentMatrix)
    {camMatrix.multiplyWithOffset(parentMatrix,-camera.scrollX*src.scrollFactorX,-camera.scrollY*src.scrollFactorY);shapeMatrix.e=src.x;shapeMatrix.f=src.y;}
    else
    {shapeMatrix.e-=camera.scrollX*src.scrollFactorX;shapeMatrix.f-=camera.scrollY*src.scrollFactorY;}
        camMatrix.multiply(shapeMatrix,calcMatrix);var dx=src._displayOriginX;var dy=src._displayOriginY;var alpha=camera.alpha*src.alpha;if(src.isFilled)
    {FillPathWebGL(pipeline,calcMatrix,src,alpha,dx,dy);}
        if(src.isStroked)
        {StrokePathWebGL(pipeline,src,alpha,dx,dy);}};module.exports=EllipseWebGLRenderer;}),"./gameobjects/shape/grid/Grid.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Shape=__webpack_require__("./gameobjects/shape/Shape.js");var GridRender=__webpack_require__("./gameobjects/shape/grid/GridRender.js");var Grid=new Class({Extends:Shape,Mixins:[GridRender],initialize:function Grid(scene,x,y,width,height,cellWidth,cellHeight,fillColor,fillAlpha,outlineFillColor,outlineFillAlpha)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            if(width===undefined){width=128;}
            if(height===undefined){height=128;}
            if(cellWidth===undefined){cellWidth=32;}
            if(cellHeight===undefined){cellHeight=32;}
            Shape.call(this,scene,'Grid',null);this.cellWidth=cellWidth;this.cellHeight=cellHeight;this.showCells=true;this.outlineFillColor=0;this.outlineFillAlpha=0;this.showOutline=true;this.showAltCells=false;this.altFillColor;this.altFillAlpha;this.setPosition(x,y);this.setSize(width,height);if(fillColor!==undefined)
        {this.setFillStyle(fillColor,fillAlpha);}
            if(outlineFillColor!==undefined)
            {this.setOutlineStyle(outlineFillColor,outlineFillAlpha);}
            this.updateDisplayOrigin();},setFillStyle:function(fillColor,fillAlpha)
        {if(fillAlpha===undefined){fillAlpha=1;}
            if(fillColor===undefined)
            {this.showCells=false;}
            else
            {this.fillColor=fillColor;this.fillAlpha=fillAlpha;this.showCells=true;}
            return this;},setAltFillStyle:function(fillColor,fillAlpha)
        {if(fillAlpha===undefined){fillAlpha=1;}
            if(fillColor===undefined)
            {this.showAltCells=false;}
            else
            {this.altFillColor=fillColor;this.altFillAlpha=fillAlpha;this.showAltCells=true;}
            return this;},setOutlineStyle:function(fillColor,fillAlpha)
        {if(fillAlpha===undefined){fillAlpha=1;}
            if(fillColor===undefined)
            {this.showOutline=false;}
            else
            {this.outlineFillColor=fillColor;this.outlineFillAlpha=fillAlpha;this.showOutline=true;}
            return this;}});module.exports=Grid;}),"./gameobjects/shape/grid/GridCanvasRenderer.js":(function(module,exports,__webpack_require__){var FillStyleCanvas=__webpack_require__("./gameobjects/shape/FillStyleCanvas.js");var LineStyleCanvas=__webpack_require__("./gameobjects/shape/LineStyleCanvas.js");var SetTransform=__webpack_require__("./renderer/canvas/utils/SetTransform.js");var RectangleCanvasRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var ctx=renderer.currentContext;if(SetTransform(renderer,ctx,src,camera,parentMatrix))
    {var dx=src._displayOriginX;var dy=src._displayOriginY;if(src.isFilled)
    {FillStyleCanvas(ctx,src);ctx.fillRect(-dx,-dy,src.width,src.height);}
        if(src.isStroked)
        {LineStyleCanvas(ctx,src);ctx.beginPath();ctx.rect(-dx,-dy,src.width,src.height);ctx.stroke();}
        ctx.restore();}};module.exports=RectangleCanvasRenderer;}),"./gameobjects/shape/grid/GridFactory.js":(function(module,exports,__webpack_require__){var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");var Grid=__webpack_require__("./gameobjects/shape/grid/Grid.js");GameObjectFactory.register('grid',function(x,y,width,height,cellWidth,cellHeight,fillColor,fillAlpha,outlineFillColor,outlineFillAlpha)
    {return this.displayList.add(new Grid(this.scene,x,y,width,height,cellWidth,cellHeight,fillColor,fillAlpha,outlineFillColor,outlineFillAlpha));});}),"./gameobjects/shape/grid/GridRender.js":(function(module,exports,__webpack_require__){var renderWebGL=__webpack_require__("./utils/NOOP.js");var renderCanvas=__webpack_require__("./utils/NOOP.js");if(true)
    {renderWebGL=__webpack_require__("./gameobjects/shape/grid/GridWebGLRenderer.js");}
        if(true)
        {renderCanvas=__webpack_require__("./gameobjects/shape/grid/GridCanvasRenderer.js");}
        module.exports={renderWebGL:renderWebGL,renderCanvas:renderCanvas};}),"./gameobjects/shape/grid/GridWebGLRenderer.js":(function(module,exports,__webpack_require__){var Utils=__webpack_require__("./renderer/webgl/Utils.js");var GridWebGLRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var pipeline=this.pipeline;var camMatrix=pipeline._tempMatrix1;var shapeMatrix=pipeline._tempMatrix2;var calcMatrix=pipeline._tempMatrix3;renderer.setPipeline(pipeline);shapeMatrix.applyITRS(src.x,src.y,src.rotation,src.scaleX,src.scaleY);camMatrix.copyFrom(camera.matrix);if(parentMatrix)
    {camMatrix.multiplyWithOffset(parentMatrix,-camera.scrollX*src.scrollFactorX,-camera.scrollY*src.scrollFactorY);shapeMatrix.e=src.x;shapeMatrix.f=src.y;}
    else
    {shapeMatrix.e-=camera.scrollX*src.scrollFactorX;shapeMatrix.f-=camera.scrollY*src.scrollFactorY;}
        camMatrix.multiply(shapeMatrix,calcMatrix);calcMatrix.translate(-src._displayOriginX,-src._displayOriginY);var alpha=camera.alpha*src.alpha;var width=src.width;var height=src.height;var cellWidth=src.cellWidth;var cellHeight=src.cellHeight;var gridWidth=Math.ceil(width / cellWidth);var gridHeight=Math.ceil(height / cellHeight);var cellWidthA=cellWidth;var cellHeightA=cellHeight;var cellWidthB=cellWidth-((gridWidth*cellWidth)-width);var cellHeightB=cellHeight-((gridHeight*cellHeight)-height);var fillTint;var fillTintColor;var showCells=src.showCells;var showAltCells=src.showAltCells;var showOutline=src.showOutline;var x=0;var y=0;var r=0;var cw=0;var ch=0;if(showOutline)
    {cellWidthA--;cellHeightA--;if(cellWidthB===cellWidth)
    {cellWidthB--;}
        if(cellHeightB===cellHeight)
        {cellHeightB--;}}
        if(showCells&&src.fillAlpha>0)
        {fillTint=pipeline.fillTint;fillTintColor=Utils.getTintAppendFloatAlphaAndSwap(src.fillColor,src.fillAlpha*alpha);fillTint.TL=fillTintColor;fillTint.TR=fillTintColor;fillTint.BL=fillTintColor;fillTint.BR=fillTintColor;for(y=0;y<gridHeight;y++)
        {if(showAltCells)
        {r=y%2;}
            for(x=0;x<gridWidth;x++)
            {if(showAltCells&&r)
            {r=0;continue;}
                r++;cw=(x<gridWidth-1)?cellWidthA:cellWidthB;ch=(y<gridHeight-1)?cellHeightA:cellHeightB;pipeline.setTexture2D();pipeline.batchFillRect(x*cellWidth,y*cellHeight,cw,ch);}}}
        if(showAltCells&&src.altFillAlpha>0)
        {fillTint=pipeline.fillTint;fillTintColor=Utils.getTintAppendFloatAlphaAndSwap(src.altFillColor,src.altFillAlpha*alpha);fillTint.TL=fillTintColor;fillTint.TR=fillTintColor;fillTint.BL=fillTintColor;fillTint.BR=fillTintColor;for(y=0;y<gridHeight;y++)
        {if(showAltCells)
        {r=y%2;}
            for(x=0;x<gridWidth;x++)
            {if(showAltCells&&!r)
            {r=1;continue;}
                r=0;cw=(x<gridWidth-1)?cellWidthA:cellWidthB;ch=(y<gridHeight-1)?cellHeightA:cellHeightB;pipeline.setTexture2D();pipeline.batchFillRect(x*cellWidth,y*cellHeight,cw,ch);}}}
        if(showOutline&&src.outlineFillAlpha>0)
        {var strokeTint=pipeline.strokeTint;var color=Utils.getTintAppendFloatAlphaAndSwap(src.outlineFillColor,src.outlineFillAlpha*alpha);strokeTint.TL=color;strokeTint.TR=color;strokeTint.BL=color;strokeTint.BR=color;for(x=1;x<gridWidth;x++)
        {var x1=x*cellWidth;pipeline.setTexture2D();pipeline.batchLine(x1,0,x1,height,1,1,1,0,false);}
            for(y=1;y<gridHeight;y++)
            {var y1=y*cellHeight;pipeline.setTexture2D();pipeline.batchLine(0,y1,width,y1,1,1,1,0,false);}}};module.exports=GridWebGLRenderer;}),"./gameobjects/shape/isobox/IsoBox.js":(function(module,exports,__webpack_require__){var IsoBoxRender=__webpack_require__("./gameobjects/shape/isobox/IsoBoxRender.js");var Class=__webpack_require__("./utils/Class.js");var Shape=__webpack_require__("./gameobjects/shape/Shape.js");var IsoBox=new Class({Extends:Shape,Mixins:[IsoBoxRender],initialize:function IsoBox(scene,x,y,size,height,fillTop,fillLeft,fillRight)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            if(size===undefined){size=48;}
            if(height===undefined){height=32;}
            if(fillTop===undefined){fillTop=0xeeeeee;}
            if(fillLeft===undefined){fillLeft=0x999999;}
            if(fillRight===undefined){fillRight=0xcccccc;}
            Shape.call(this,scene,'IsoBox',null);this.projection=4;this.fillTop=fillTop;this.fillLeft=fillLeft;this.fillRight=fillRight;this.showTop=true;this.showLeft=true;this.showRight=true;this.isFilled=true;this.setPosition(x,y);this.setSize(size,height);this.updateDisplayOrigin();},setProjection:function(value)
        {this.projection=value;return this;},setFaces:function(showTop,showLeft,showRight)
        {if(showTop===undefined){showTop=true;}
            if(showLeft===undefined){showLeft=true;}
            if(showRight===undefined){showRight=true;}
            this.showTop=showTop;this.showLeft=showLeft;this.showRight=showRight;return this;},setFillStyle:function(fillTop,fillLeft,fillRight)
        {this.fillTop=fillTop;this.fillLeft=fillLeft;this.fillRight=fillRight;this.isFilled=true;return this;}});module.exports=IsoBox;}),"./gameobjects/shape/isobox/IsoBoxCanvasRenderer.js":(function(module,exports,__webpack_require__){var FillStyleCanvas=__webpack_require__("./gameobjects/shape/FillStyleCanvas.js");var SetTransform=__webpack_require__("./renderer/canvas/utils/SetTransform.js");var IsoBoxCanvasRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var ctx=renderer.currentContext;if(SetTransform(renderer,ctx,src,camera,parentMatrix)&&src.isFilled)
    {var size=src.width;var height=src.height;var sizeA=size / 2;var sizeB=size / src.projection;if(src.showTop)
    {FillStyleCanvas(ctx,src,src.fillTop);ctx.beginPath();ctx.moveTo(-sizeA,-height);ctx.lineTo(0,-sizeB-height);ctx.lineTo(sizeA,-height);ctx.lineTo(sizeA,-1);ctx.lineTo(0,sizeB-1);ctx.lineTo(-sizeA,-1);ctx.lineTo(-sizeA,-height);ctx.fill();}
        if(src.showLeft)
        {FillStyleCanvas(ctx,src,src.fillLeft);ctx.beginPath();ctx.moveTo(-sizeA,0);ctx.lineTo(0,sizeB);ctx.lineTo(0,sizeB-height);ctx.lineTo(-sizeA,-height);ctx.lineTo(-sizeA,0);ctx.fill();}
        if(src.showRight)
        {FillStyleCanvas(ctx,src,src.fillRight);ctx.beginPath();ctx.moveTo(sizeA,0);ctx.lineTo(0,sizeB);ctx.lineTo(0,sizeB-height);ctx.lineTo(sizeA,-height);ctx.lineTo(sizeA,0);ctx.fill();}
        ctx.restore();}};module.exports=IsoBoxCanvasRenderer;}),"./gameobjects/shape/isobox/IsoBoxFactory.js":(function(module,exports,__webpack_require__){var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");var IsoBox=__webpack_require__("./gameobjects/shape/isobox/IsoBox.js");GameObjectFactory.register('isobox',function(x,y,size,height,fillTop,fillLeft,fillRight)
    {return this.displayList.add(new IsoBox(this.scene,x,y,size,height,fillTop,fillLeft,fillRight));});}),"./gameobjects/shape/isobox/IsoBoxRender.js":(function(module,exports,__webpack_require__){var renderWebGL=__webpack_require__("./utils/NOOP.js");var renderCanvas=__webpack_require__("./utils/NOOP.js");if(true)
    {renderWebGL=__webpack_require__("./gameobjects/shape/isobox/IsoBoxWebGLRenderer.js");}
        if(true)
        {renderCanvas=__webpack_require__("./gameobjects/shape/isobox/IsoBoxCanvasRenderer.js");}
        module.exports={renderWebGL:renderWebGL,renderCanvas:renderCanvas};}),"./gameobjects/shape/isobox/IsoBoxWebGLRenderer.js":(function(module,exports,__webpack_require__){var Utils=__webpack_require__("./renderer/webgl/Utils.js");var IsoBoxWebGLRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var pipeline=this.pipeline;var camMatrix=pipeline._tempMatrix1;var shapeMatrix=pipeline._tempMatrix2;var calcMatrix=pipeline._tempMatrix3;renderer.setPipeline(pipeline);shapeMatrix.applyITRS(src.x,src.y,src.rotation,src.scaleX,src.scaleY);camMatrix.copyFrom(camera.matrix);if(parentMatrix)
    {camMatrix.multiplyWithOffset(parentMatrix,-camera.scrollX*src.scrollFactorX,-camera.scrollY*src.scrollFactorY);shapeMatrix.e=src.x;shapeMatrix.f=src.y;}
    else
    {shapeMatrix.e-=camera.scrollX*src.scrollFactorX;shapeMatrix.f-=camera.scrollY*src.scrollFactorY;}
        camMatrix.multiply(shapeMatrix,calcMatrix);var size=src.width;var height=src.height;var sizeA=size / 2;var sizeB=size / src.projection;var alpha=camera.alpha*src.alpha;if(!src.isFilled)
    {return;}
        var tint;var x0;var y0;var x1;var y1;var x2;var y2;var x3;var y3;if(src.showTop)
    {tint=Utils.getTintAppendFloatAlphaAndSwap(src.fillTop,alpha);x0=calcMatrix.getX(-sizeA,-height);y0=calcMatrix.getY(-sizeA,-height);x1=calcMatrix.getX(0,-sizeB-height);y1=calcMatrix.getY(0,-sizeB-height);x2=calcMatrix.getX(sizeA,-height);y2=calcMatrix.getY(sizeA,-height);x3=calcMatrix.getX(0,sizeB-height);y3=calcMatrix.getY(0,sizeB-height);pipeline.setTexture2D();pipeline.batchQuad(x0,y0,x1,y1,x2,y2,x3,y3,0,0,1,1,tint,tint,tint,tint,2);}
        if(src.showLeft)
        {tint=Utils.getTintAppendFloatAlphaAndSwap(src.fillLeft,alpha);x0=calcMatrix.getX(-sizeA,0);y0=calcMatrix.getY(-sizeA,0);x1=calcMatrix.getX(0,sizeB);y1=calcMatrix.getY(0,sizeB);x2=calcMatrix.getX(0,sizeB-height);y2=calcMatrix.getY(0,sizeB-height);x3=calcMatrix.getX(-sizeA,-height);y3=calcMatrix.getY(-sizeA,-height);pipeline.setTexture2D();pipeline.batchQuad(x0,y0,x1,y1,x2,y2,x3,y3,0,0,1,1,tint,tint,tint,tint,2);}
        if(src.showRight)
        {tint=Utils.getTintAppendFloatAlphaAndSwap(src.fillRight,alpha);x0=calcMatrix.getX(sizeA,0);y0=calcMatrix.getY(sizeA,0);x1=calcMatrix.getX(0,sizeB);y1=calcMatrix.getY(0,sizeB);x2=calcMatrix.getX(0,sizeB-height);y2=calcMatrix.getY(0,sizeB-height);x3=calcMatrix.getX(sizeA,-height);y3=calcMatrix.getY(sizeA,-height);pipeline.setTexture2D();pipeline.batchQuad(x0,y0,x1,y1,x2,y2,x3,y3,0,0,1,1,tint,tint,tint,tint,2);}};module.exports=IsoBoxWebGLRenderer;}),"./gameobjects/shape/isotriangle/IsoTriangle.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var IsoTriangleRender=__webpack_require__("./gameobjects/shape/isotriangle/IsoTriangleRender.js");var Shape=__webpack_require__("./gameobjects/shape/Shape.js");var IsoTriangle=new Class({Extends:Shape,Mixins:[IsoTriangleRender],initialize:function IsoTriangle(scene,x,y,size,height,reversed,fillTop,fillLeft,fillRight)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            if(size===undefined){size=48;}
            if(height===undefined){height=32;}
            if(reversed===undefined){reversed=false;}
            if(fillTop===undefined){fillTop=0xeeeeee;}
            if(fillLeft===undefined){fillLeft=0x999999;}
            if(fillRight===undefined){fillRight=0xcccccc;}
            Shape.call(this,scene,'IsoTriangle',null);this.projection=4;this.fillTop=fillTop;this.fillLeft=fillLeft;this.fillRight=fillRight;this.showTop=true;this.showLeft=true;this.showRight=true;this.isReversed=reversed;this.isFilled=true;this.setPosition(x,y);this.setSize(size,height);this.updateDisplayOrigin();},setProjection:function(value)
        {this.projection=value;return this;},setReversed:function(reversed)
        {this.isReversed=reversed;return this;},setFaces:function(showTop,showLeft,showRight)
        {if(showTop===undefined){showTop=true;}
            if(showLeft===undefined){showLeft=true;}
            if(showRight===undefined){showRight=true;}
            this.showTop=showTop;this.showLeft=showLeft;this.showRight=showRight;return this;},setFillStyle:function(fillTop,fillLeft,fillRight)
        {this.fillTop=fillTop;this.fillLeft=fillLeft;this.fillRight=fillRight;this.isFilled=true;return this;}});module.exports=IsoTriangle;}),"./gameobjects/shape/isotriangle/IsoTriangleCanvasRenderer.js":(function(module,exports,__webpack_require__){var FillStyleCanvas=__webpack_require__("./gameobjects/shape/FillStyleCanvas.js");var SetTransform=__webpack_require__("./renderer/canvas/utils/SetTransform.js");var IsoTriangleCanvasRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var ctx=renderer.currentContext;if(SetTransform(renderer,ctx,src,camera,parentMatrix)&&src.isFilled)
    {var size=src.width;var height=src.height;var sizeA=size / 2;var sizeB=size / src.projection;var reversed=src.isReversed;if(src.showTop&&reversed)
    {FillStyleCanvas(ctx,src,src.fillTop);ctx.beginPath();ctx.moveTo(-sizeA,-height);ctx.lineTo(0,-sizeB-height);ctx.lineTo(sizeA,-height);ctx.lineTo(0,sizeB-height);ctx.fill();}
        if(src.showLeft)
        {FillStyleCanvas(ctx,src,src.fillLeft);ctx.beginPath();if(reversed)
        {ctx.moveTo(-sizeA,-height);ctx.lineTo(0,sizeB);ctx.lineTo(0,sizeB-height);}
        else
        {ctx.moveTo(-sizeA,0);ctx.lineTo(0,sizeB);ctx.lineTo(0,sizeB-height);}
            ctx.fill();}
        if(src.showRight)
        {FillStyleCanvas(ctx,src,src.fillRight);ctx.beginPath();if(reversed)
        {ctx.moveTo(sizeA,-height);ctx.lineTo(0,sizeB);ctx.lineTo(0,sizeB-height);}
        else
        {ctx.moveTo(sizeA,0);ctx.lineTo(0,sizeB);ctx.lineTo(0,sizeB-height);}
            ctx.fill();}
        ctx.restore();}};module.exports=IsoTriangleCanvasRenderer;}),"./gameobjects/shape/isotriangle/IsoTriangleFactory.js":(function(module,exports,__webpack_require__){var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");var IsoTriangle=__webpack_require__("./gameobjects/shape/isotriangle/IsoTriangle.js");GameObjectFactory.register('isotriangle',function(x,y,size,height,reversed,fillTop,fillLeft,fillRight)
    {return this.displayList.add(new IsoTriangle(this.scene,x,y,size,height,reversed,fillTop,fillLeft,fillRight));});}),"./gameobjects/shape/isotriangle/IsoTriangleRender.js":(function(module,exports,__webpack_require__){var renderWebGL=__webpack_require__("./utils/NOOP.js");var renderCanvas=__webpack_require__("./utils/NOOP.js");if(true)
    {renderWebGL=__webpack_require__("./gameobjects/shape/isotriangle/IsoTriangleWebGLRenderer.js");}
        if(true)
        {renderCanvas=__webpack_require__("./gameobjects/shape/isotriangle/IsoTriangleCanvasRenderer.js");}
        module.exports={renderWebGL:renderWebGL,renderCanvas:renderCanvas};}),"./gameobjects/shape/isotriangle/IsoTriangleWebGLRenderer.js":(function(module,exports,__webpack_require__){var Utils=__webpack_require__("./renderer/webgl/Utils.js");var IsoTriangleWebGLRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var pipeline=this.pipeline;var camMatrix=pipeline._tempMatrix1;var shapeMatrix=pipeline._tempMatrix2;var calcMatrix=pipeline._tempMatrix3;renderer.setPipeline(pipeline);shapeMatrix.applyITRS(src.x,src.y,src.rotation,src.scaleX,src.scaleY);camMatrix.copyFrom(camera.matrix);if(parentMatrix)
    {camMatrix.multiplyWithOffset(parentMatrix,-camera.scrollX*src.scrollFactorX,-camera.scrollY*src.scrollFactorY);shapeMatrix.e=src.x;shapeMatrix.f=src.y;}
    else
    {shapeMatrix.e-=camera.scrollX*src.scrollFactorX;shapeMatrix.f-=camera.scrollY*src.scrollFactorY;}
        camMatrix.multiply(shapeMatrix,calcMatrix);var size=src.width;var height=src.height;var sizeA=size / 2;var sizeB=size / src.projection;var reversed=src.isReversed;var alpha=camera.alpha*src.alpha;if(!src.isFilled)
    {return;}
        var tint;var x0;var y0;var x1;var y1;var x2;var y2;if(src.showTop&&reversed)
    {tint=Utils.getTintAppendFloatAlphaAndSwap(src.fillTop,alpha);x0=calcMatrix.getX(-sizeA,-height);y0=calcMatrix.getY(-sizeA,-height);x1=calcMatrix.getX(0,-sizeB-height);y1=calcMatrix.getY(0,-sizeB-height);x2=calcMatrix.getX(sizeA,-height);y2=calcMatrix.getY(sizeA,-height);var x3=calcMatrix.getX(0,sizeB-height);var y3=calcMatrix.getY(0,sizeB-height);pipeline.setTexture2D();pipeline.batchQuad(x0,y0,x1,y1,x2,y2,x3,y3,0,0,1,1,tint,tint,tint,tint,2);}
        if(src.showLeft)
        {tint=Utils.getTintAppendFloatAlphaAndSwap(src.fillLeft,alpha);if(reversed)
        {x0=calcMatrix.getX(-sizeA,-height);y0=calcMatrix.getY(-sizeA,-height);x1=calcMatrix.getX(0,sizeB);y1=calcMatrix.getY(0,sizeB);x2=calcMatrix.getX(0,sizeB-height);y2=calcMatrix.getY(0,sizeB-height);}
        else
        {x0=calcMatrix.getX(-sizeA,0);y0=calcMatrix.getY(-sizeA,0);x1=calcMatrix.getX(0,sizeB);y1=calcMatrix.getY(0,sizeB);x2=calcMatrix.getX(0,sizeB-height);y2=calcMatrix.getY(0,sizeB-height);}
            pipeline.batchTri(x0,y0,x1,y1,x2,y2,0,0,1,1,tint,tint,tint,2);}
        if(src.showRight)
        {tint=Utils.getTintAppendFloatAlphaAndSwap(src.fillRight,alpha);if(reversed)
        {x0=calcMatrix.getX(sizeA,-height);y0=calcMatrix.getY(sizeA,-height);x1=calcMatrix.getX(0,sizeB);y1=calcMatrix.getY(0,sizeB);x2=calcMatrix.getX(0,sizeB-height);y2=calcMatrix.getY(0,sizeB-height);}
        else
        {x0=calcMatrix.getX(sizeA,0);y0=calcMatrix.getY(sizeA,0);x1=calcMatrix.getX(0,sizeB);y1=calcMatrix.getY(0,sizeB);x2=calcMatrix.getX(0,sizeB-height);y2=calcMatrix.getY(0,sizeB-height);}
            pipeline.setTexture2D();pipeline.batchTri(x0,y0,x1,y1,x2,y2,0,0,1,1,tint,tint,tint,2);}};module.exports=IsoTriangleWebGLRenderer;}),"./gameobjects/shape/line/Line.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Shape=__webpack_require__("./gameobjects/shape/Shape.js");var GeomLine=__webpack_require__("./geom/line/Line.js");var LineRender=__webpack_require__("./gameobjects/shape/line/LineRender.js");var Line=new Class({Extends:Shape,Mixins:[LineRender],initialize:function Line(scene,x,y,x1,y1,x2,y2,strokeColor,strokeAlpha)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            if(x1===undefined){x1=0;}
            if(y1===undefined){y1=0;}
            if(x2===undefined){x2=128;}
            if(y2===undefined){y2=0;}
            Shape.call(this,scene,'Line',new GeomLine(x1,y1,x2,y2));var width=this.geom.right-this.geom.left;var height=this.geom.bottom-this.geom.top;this.lineWidth=1;this._startWidth=1;this._endWidth=1;this.setPosition(x,y);this.setSize(width,height);if(strokeColor!==undefined)
        {this.setStrokeStyle(1,strokeColor,strokeAlpha);}
            this.updateDisplayOrigin();},setLineWidth:function(startWidth,endWidth)
        {if(endWidth===undefined){endWidth=startWidth;}
            this._startWidth=startWidth;this._endWidth=endWidth;this.lineWidth=startWidth;return this;},setTo:function(x1,y1,x2,y2)
        {this.geom.setTo(x1,y1,x2,y2);return this;}});module.exports=Line;}),"./gameobjects/shape/line/LineCanvasRenderer.js":(function(module,exports,__webpack_require__){var LineStyleCanvas=__webpack_require__("./gameobjects/shape/LineStyleCanvas.js");var SetTransform=__webpack_require__("./renderer/canvas/utils/SetTransform.js");var LineCanvasRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var ctx=renderer.currentContext;if(SetTransform(renderer,ctx,src,camera,parentMatrix))
    {var dx=src._displayOriginX;var dy=src._displayOriginY;if(src.isStroked)
    {LineStyleCanvas(ctx,src);ctx.beginPath();ctx.moveTo(src.geom.x1-dx,src.geom.y1-dy);ctx.lineTo(src.geom.x2-dx,src.geom.y2-dy);ctx.stroke();}
        ctx.restore();}};module.exports=LineCanvasRenderer;}),"./gameobjects/shape/line/LineFactory.js":(function(module,exports,__webpack_require__){var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");var Line=__webpack_require__("./gameobjects/shape/line/Line.js");GameObjectFactory.register('line',function(x,y,x1,y1,x2,y2,strokeColor,strokeAlpha)
    {return this.displayList.add(new Line(this.scene,x,y,x1,y1,x2,y2,strokeColor,strokeAlpha));});}),"./gameobjects/shape/line/LineRender.js":(function(module,exports,__webpack_require__){var renderWebGL=__webpack_require__("./utils/NOOP.js");var renderCanvas=__webpack_require__("./utils/NOOP.js");if(true)
    {renderWebGL=__webpack_require__("./gameobjects/shape/line/LineWebGLRenderer.js");}
        if(true)
        {renderCanvas=__webpack_require__("./gameobjects/shape/line/LineCanvasRenderer.js");}
        module.exports={renderWebGL:renderWebGL,renderCanvas:renderCanvas};}),"./gameobjects/shape/line/LineWebGLRenderer.js":(function(module,exports,__webpack_require__){var Utils=__webpack_require__("./renderer/webgl/Utils.js");var LineWebGLRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var pipeline=this.pipeline;var camMatrix=pipeline._tempMatrix1;var shapeMatrix=pipeline._tempMatrix2;renderer.setPipeline(pipeline);shapeMatrix.applyITRS(src.x,src.y,src.rotation,src.scaleX,src.scaleY);camMatrix.copyFrom(camera.matrix);if(parentMatrix)
    {camMatrix.multiplyWithOffset(parentMatrix,-camera.scrollX*src.scrollFactorX,-camera.scrollY*src.scrollFactorY);shapeMatrix.e=src.x;shapeMatrix.f=src.y;}
    else
    {shapeMatrix.e-=camera.scrollX*src.scrollFactorX;shapeMatrix.f-=camera.scrollY*src.scrollFactorY;}
        var dx=src._displayOriginX;var dy=src._displayOriginY;var alpha=camera.alpha*src.alpha;if(src.isStroked)
    {var strokeTint=pipeline.strokeTint;var color=Utils.getTintAppendFloatAlphaAndSwap(src.strokeColor,src.strokeAlpha*alpha);strokeTint.TL=color;strokeTint.TR=color;strokeTint.BL=color;strokeTint.BR=color;var startWidth=src._startWidth;var endWidth=src._endWidth;pipeline.setTexture2D();pipeline.batchLine(src.geom.x1-dx,src.geom.y1-dy,src.geom.x2-dx,src.geom.y2-dy,startWidth,endWidth,1,0,false,shapeMatrix,camMatrix);}};module.exports=LineWebGLRenderer;}),"./gameobjects/shape/polygon/Polygon.js":(function(module,exports,__webpack_require__){var PolygonRender=__webpack_require__("./gameobjects/shape/polygon/PolygonRender.js");var Class=__webpack_require__("./utils/Class.js");var Earcut=__webpack_require__("./geom/polygon/Earcut.js");var GetAABB=__webpack_require__("./geom/polygon/GetAABB.js");var GeomPolygon=__webpack_require__("./geom/polygon/Polygon.js");var Shape=__webpack_require__("./gameobjects/shape/Shape.js");var Smooth=__webpack_require__("./geom/polygon/Smooth.js");var Polygon=new Class({Extends:Shape,Mixins:[PolygonRender],initialize:function Polygon(scene,x,y,points,fillColor,fillAlpha)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            Shape.call(this,scene,'Polygon',new GeomPolygon(points));var bounds=GetAABB(this.geom);this.setPosition(x,y);this.setSize(bounds.width,bounds.height);if(fillColor!==undefined)
        {this.setFillStyle(fillColor,fillAlpha);}
            this.updateDisplayOrigin();this.updateData();},smooth:function(iterations)
        {if(iterations===undefined){iterations=1;}
            for(var i=0;i<iterations;i++)
            {Smooth(this.geom);}
            return this.updateData();},updateData:function()
        {var path=[];var points=this.geom.points;for(var i=0;i<points.length;i++)
        {path.push(points[i].x,points[i].y);}
            path.push(points[0].x,points[0].y);this.pathIndexes=Earcut(path);this.pathData=path;return this;}});module.exports=Polygon;}),"./gameobjects/shape/polygon/PolygonCanvasRenderer.js":(function(module,exports,__webpack_require__){var FillStyleCanvas=__webpack_require__("./gameobjects/shape/FillStyleCanvas.js");var LineStyleCanvas=__webpack_require__("./gameobjects/shape/LineStyleCanvas.js");var SetTransform=__webpack_require__("./renderer/canvas/utils/SetTransform.js");var PolygonCanvasRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var ctx=renderer.currentContext;if(SetTransform(renderer,ctx,src,camera,parentMatrix))
    {var dx=src._displayOriginX;var dy=src._displayOriginY;var path=src.pathData;var pathLength=path.length-1;var px1=path[0]-dx;var py1=path[1]-dy;ctx.beginPath();ctx.moveTo(px1,py1);if(!src.closePath)
    {pathLength-=2;}
        for(var i=2;i<pathLength;i+=2)
        {var px2=path[i]-dx;var py2=path[i+1]-dy;ctx.lineTo(px2,py2);}
        ctx.closePath();if(src.isFilled)
    {FillStyleCanvas(ctx,src);ctx.fill();}
        if(src.isStroked)
        {LineStyleCanvas(ctx,src);ctx.stroke();}
        ctx.restore();}};module.exports=PolygonCanvasRenderer;}),"./gameobjects/shape/polygon/PolygonFactory.js":(function(module,exports,__webpack_require__){var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");var Polygon=__webpack_require__("./gameobjects/shape/polygon/Polygon.js");GameObjectFactory.register('polygon',function(x,y,points,fillColor,fillAlpha)
    {return this.displayList.add(new Polygon(this.scene,x,y,points,fillColor,fillAlpha));});}),"./gameobjects/shape/polygon/PolygonRender.js":(function(module,exports,__webpack_require__){var renderWebGL=__webpack_require__("./utils/NOOP.js");var renderCanvas=__webpack_require__("./utils/NOOP.js");if(true)
    {renderWebGL=__webpack_require__("./gameobjects/shape/polygon/PolygonWebGLRenderer.js");}
        if(true)
        {renderCanvas=__webpack_require__("./gameobjects/shape/polygon/PolygonCanvasRenderer.js");}
        module.exports={renderWebGL:renderWebGL,renderCanvas:renderCanvas};}),"./gameobjects/shape/polygon/PolygonWebGLRenderer.js":(function(module,exports,__webpack_require__){var FillPathWebGL=__webpack_require__("./gameobjects/shape/FillPathWebGL.js");var StrokePathWebGL=__webpack_require__("./gameobjects/shape/StrokePathWebGL.js");var PolygonWebGLRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var pipeline=this.pipeline;var camMatrix=pipeline._tempMatrix1;var shapeMatrix=pipeline._tempMatrix2;var calcMatrix=pipeline._tempMatrix3;renderer.setPipeline(pipeline);shapeMatrix.applyITRS(src.x,src.y,src.rotation,src.scaleX,src.scaleY);camMatrix.copyFrom(camera.matrix);if(parentMatrix)
    {camMatrix.multiplyWithOffset(parentMatrix,-camera.scrollX*src.scrollFactorX,-camera.scrollY*src.scrollFactorY);shapeMatrix.e=src.x;shapeMatrix.f=src.y;}
    else
    {shapeMatrix.e-=camera.scrollX*src.scrollFactorX;shapeMatrix.f-=camera.scrollY*src.scrollFactorY;}
        camMatrix.multiply(shapeMatrix,calcMatrix);var dx=src._displayOriginX;var dy=src._displayOriginY;var alpha=camera.alpha*src.alpha;if(src.isFilled)
    {FillPathWebGL(pipeline,calcMatrix,src,alpha,dx,dy);}
        if(src.isStroked)
        {StrokePathWebGL(pipeline,src,alpha,dx,dy);}};module.exports=PolygonWebGLRenderer;}),"./gameobjects/shape/rectangle/Rectangle.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var GeomRectangle=__webpack_require__("./geom/rectangle/Rectangle.js");var Shape=__webpack_require__("./gameobjects/shape/Shape.js");var RectangleRender=__webpack_require__("./gameobjects/shape/rectangle/RectangleRender.js");var Rectangle=new Class({Extends:Shape,Mixins:[RectangleRender],initialize:function Rectangle(scene,x,y,width,height,fillColor,fillAlpha)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            if(width===undefined){width=128;}
            if(height===undefined){height=128;}
            Shape.call(this,scene,'Rectangle',new GeomRectangle(0,0,width,height));this.setPosition(x,y);this.setSize(width,height);if(fillColor!==undefined)
        {this.setFillStyle(fillColor,fillAlpha);}
            this.updateDisplayOrigin();this.updateData();},updateData:function()
        {var path=[];var rect=this.geom;var line=this._tempLine;rect.getLineA(line);path.push(line.x1,line.y1,line.x2,line.y2);rect.getLineB(line);path.push(line.x2,line.y2);rect.getLineC(line);path.push(line.x2,line.y2);rect.getLineD(line);path.push(line.x2,line.y2);this.pathData=path;return this;}});module.exports=Rectangle;}),"./gameobjects/shape/rectangle/RectangleCanvasRenderer.js":(function(module,exports,__webpack_require__){var FillStyleCanvas=__webpack_require__("./gameobjects/shape/FillStyleCanvas.js");var LineStyleCanvas=__webpack_require__("./gameobjects/shape/LineStyleCanvas.js");var SetTransform=__webpack_require__("./renderer/canvas/utils/SetTransform.js");var RectangleCanvasRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var ctx=renderer.currentContext;if(SetTransform(renderer,ctx,src,camera,parentMatrix))
    {var dx=src._displayOriginX;var dy=src._displayOriginY;if(src.isFilled)
    {FillStyleCanvas(ctx,src);ctx.fillRect(-dx,-dy,src.width,src.height);}
        if(src.isStroked)
        {LineStyleCanvas(ctx,src);ctx.beginPath();ctx.rect(-dx,-dy,src.width,src.height);ctx.stroke();}
        ctx.restore();}};module.exports=RectangleCanvasRenderer;}),"./gameobjects/shape/rectangle/RectangleFactory.js":(function(module,exports,__webpack_require__){var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");var Rectangle=__webpack_require__("./gameobjects/shape/rectangle/Rectangle.js");GameObjectFactory.register('rectangle',function(x,y,width,height,fillColor,fillAlpha)
    {return this.displayList.add(new Rectangle(this.scene,x,y,width,height,fillColor,fillAlpha));});}),"./gameobjects/shape/rectangle/RectangleRender.js":(function(module,exports,__webpack_require__){var renderWebGL=__webpack_require__("./utils/NOOP.js");var renderCanvas=__webpack_require__("./utils/NOOP.js");if(true)
    {renderWebGL=__webpack_require__("./gameobjects/shape/rectangle/RectangleWebGLRenderer.js");}
        if(true)
        {renderCanvas=__webpack_require__("./gameobjects/shape/rectangle/RectangleCanvasRenderer.js");}
        module.exports={renderWebGL:renderWebGL,renderCanvas:renderCanvas};}),"./gameobjects/shape/rectangle/RectangleWebGLRenderer.js":(function(module,exports,__webpack_require__){var StrokePathWebGL=__webpack_require__("./gameobjects/shape/StrokePathWebGL.js");var Utils=__webpack_require__("./renderer/webgl/Utils.js");var RectangleWebGLRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var pipeline=this.pipeline;var camMatrix=pipeline._tempMatrix1;var shapeMatrix=pipeline._tempMatrix2;var calcMatrix=pipeline._tempMatrix3;renderer.setPipeline(pipeline);shapeMatrix.applyITRS(src.x,src.y,src.rotation,src.scaleX,src.scaleY);camMatrix.copyFrom(camera.matrix);if(parentMatrix)
    {camMatrix.multiplyWithOffset(parentMatrix,-camera.scrollX*src.scrollFactorX,-camera.scrollY*src.scrollFactorY);shapeMatrix.e=src.x;shapeMatrix.f=src.y;}
    else
    {shapeMatrix.e-=camera.scrollX*src.scrollFactorX;shapeMatrix.f-=camera.scrollY*src.scrollFactorY;}
        camMatrix.multiply(shapeMatrix,calcMatrix);var dx=src._displayOriginX;var dy=src._displayOriginY;var alpha=camera.alpha*src.alpha;if(src.isFilled)
    {var fillTint=pipeline.fillTint;var fillTintColor=Utils.getTintAppendFloatAlphaAndSwap(src.fillColor,src.fillAlpha*alpha);fillTint.TL=fillTintColor;fillTint.TR=fillTintColor;fillTint.BL=fillTintColor;fillTint.BR=fillTintColor;pipeline.setTexture2D();pipeline.batchFillRect(-dx,-dy,src.width,src.height);}
        if(src.isStroked)
        {StrokePathWebGL(pipeline,src,alpha,dx,dy);}};module.exports=RectangleWebGLRenderer;}),"./gameobjects/shape/star/Star.js":(function(module,exports,__webpack_require__){var StarRender=__webpack_require__("./gameobjects/shape/star/StarRender.js");var Class=__webpack_require__("./utils/Class.js");var Earcut=__webpack_require__("./geom/polygon/Earcut.js");var Shape=__webpack_require__("./gameobjects/shape/Shape.js");var Star=new Class({Extends:Shape,Mixins:[StarRender],initialize:function Star(scene,x,y,points,innerRadius,outerRadius,fillColor,fillAlpha)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            if(points===undefined){points=5;}
            if(innerRadius===undefined){innerRadius=32;}
            if(outerRadius===undefined){outerRadius=64;}
            Shape.call(this,scene,'Star',null);this._points=points;this._innerRadius=innerRadius;this._outerRadius=outerRadius;this.setPosition(x,y);this.setSize(outerRadius*2,outerRadius*2);if(fillColor!==undefined)
        {this.setFillStyle(fillColor,fillAlpha);}
            this.updateDisplayOrigin();this.updateData();},setPoints:function(value)
        {this._points=value;return this.updateData();},setInnerRadius:function(value)
        {this._innerRadius=value;return this.updateData();},setOuterRadius:function(value)
        {this._outerRadius=value;return this.updateData();},points:{get:function()
            {return this._points;},set:function(value)
            {this._points=value;this.updateData();}},innerRadius:{get:function()
            {return this._innerRadius;},set:function(value)
            {this._innerRadius=value;this.updateData();}},outerRadius:{get:function()
            {return this._outerRadius;},set:function(value)
            {this._outerRadius=value;this.updateData();}},updateData:function()
        {var path=[];var points=this._points;var innerRadius=this._innerRadius;var outerRadius=this._outerRadius;var rot=Math.PI / 2*3;var step=Math.PI / points;var x=outerRadius;var y=outerRadius;path.push(x,y+ -outerRadius);for(var i=0;i<points;i++)
        {path.push(x+Math.cos(rot)*outerRadius,y+Math.sin(rot)*outerRadius);rot+=step;path.push(x+Math.cos(rot)*innerRadius,y+Math.sin(rot)*innerRadius);rot+=step;}
            path.push(x,y+ -outerRadius);this.pathIndexes=Earcut(path);this.pathData=path;return this;}});module.exports=Star;}),"./gameobjects/shape/star/StarCanvasRenderer.js":(function(module,exports,__webpack_require__){var FillStyleCanvas=__webpack_require__("./gameobjects/shape/FillStyleCanvas.js");var LineStyleCanvas=__webpack_require__("./gameobjects/shape/LineStyleCanvas.js");var SetTransform=__webpack_require__("./renderer/canvas/utils/SetTransform.js");var StarCanvasRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var ctx=renderer.currentContext;if(SetTransform(renderer,ctx,src,camera,parentMatrix))
    {var dx=src._displayOriginX;var dy=src._displayOriginY;var path=src.pathData;var pathLength=path.length-1;var px1=path[0]-dx;var py1=path[1]-dy;ctx.beginPath();ctx.moveTo(px1,py1);if(!src.closePath)
    {pathLength-=2;}
        for(var i=2;i<pathLength;i+=2)
        {var px2=path[i]-dx;var py2=path[i+1]-dy;ctx.lineTo(px2,py2);}
        ctx.closePath();if(src.isFilled)
    {FillStyleCanvas(ctx,src);ctx.fill();}
        if(src.isStroked)
        {LineStyleCanvas(ctx,src);ctx.stroke();}
        ctx.restore();}};module.exports=StarCanvasRenderer;}),"./gameobjects/shape/star/StarFactory.js":(function(module,exports,__webpack_require__){var Star=__webpack_require__("./gameobjects/shape/star/Star.js");var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");GameObjectFactory.register('star',function(x,y,points,innerRadius,outerRadius,fillColor,fillAlpha)
    {return this.displayList.add(new Star(this.scene,x,y,points,innerRadius,outerRadius,fillColor,fillAlpha));});}),"./gameobjects/shape/star/StarRender.js":(function(module,exports,__webpack_require__){var renderWebGL=__webpack_require__("./utils/NOOP.js");var renderCanvas=__webpack_require__("./utils/NOOP.js");if(true)
    {renderWebGL=__webpack_require__("./gameobjects/shape/star/StarWebGLRenderer.js");}
        if(true)
        {renderCanvas=__webpack_require__("./gameobjects/shape/star/StarCanvasRenderer.js");}
        module.exports={renderWebGL:renderWebGL,renderCanvas:renderCanvas};}),"./gameobjects/shape/star/StarWebGLRenderer.js":(function(module,exports,__webpack_require__){var FillPathWebGL=__webpack_require__("./gameobjects/shape/FillPathWebGL.js");var StrokePathWebGL=__webpack_require__("./gameobjects/shape/StrokePathWebGL.js");var StarWebGLRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var pipeline=this.pipeline;var camMatrix=pipeline._tempMatrix1;var shapeMatrix=pipeline._tempMatrix2;var calcMatrix=pipeline._tempMatrix3;renderer.setPipeline(pipeline);shapeMatrix.applyITRS(src.x,src.y,src.rotation,src.scaleX,src.scaleY);camMatrix.copyFrom(camera.matrix);if(parentMatrix)
    {camMatrix.multiplyWithOffset(parentMatrix,-camera.scrollX*src.scrollFactorX,-camera.scrollY*src.scrollFactorY);shapeMatrix.e=src.x;shapeMatrix.f=src.y;}
    else
    {shapeMatrix.e-=camera.scrollX*src.scrollFactorX;shapeMatrix.f-=camera.scrollY*src.scrollFactorY;}
        camMatrix.multiply(shapeMatrix,calcMatrix);var dx=src._displayOriginX;var dy=src._displayOriginY;var alpha=camera.alpha*src.alpha;if(src.isFilled)
    {FillPathWebGL(pipeline,calcMatrix,src,alpha,dx,dy);}
        if(src.isStroked)
        {StrokePathWebGL(pipeline,src,alpha,dx,dy);}};module.exports=StarWebGLRenderer;}),"./gameobjects/shape/triangle/Triangle.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Shape=__webpack_require__("./gameobjects/shape/Shape.js");var GeomTriangle=__webpack_require__("./geom/triangle/Triangle.js");var TriangleRender=__webpack_require__("./gameobjects/shape/triangle/TriangleRender.js");var Triangle=new Class({Extends:Shape,Mixins:[TriangleRender],initialize:function Triangle(scene,x,y,x1,y1,x2,y2,x3,y3,fillColor,fillAlpha)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            if(x1===undefined){x1=0;}
            if(y1===undefined){y1=128;}
            if(x2===undefined){x2=64;}
            if(y2===undefined){y2=0;}
            if(x3===undefined){x3=128;}
            if(y3===undefined){y3=128;}
            Shape.call(this,scene,'Triangle',new GeomTriangle(x1,y1,x2,y2,x3,y3));var width=this.geom.right-this.geom.left;var height=this.geom.bottom-this.geom.top;this.setPosition(x,y);this.setSize(width,height);if(fillColor!==undefined)
        {this.setFillStyle(fillColor,fillAlpha);}
            this.updateDisplayOrigin();this.updateData();},setTo:function(x1,y1,x2,y2,x3,y3)
        {this.geom.setTo(x1,y1,x2,y2,x3,y3);return this.updateData();},updateData:function()
        {var path=[];var rect=this.geom;var line=this._tempLine;rect.getLineA(line);path.push(line.x1,line.y1,line.x2,line.y2);rect.getLineB(line);path.push(line.x2,line.y2);rect.getLineC(line);path.push(line.x2,line.y2);this.pathData=path;return this;}});module.exports=Triangle;}),"./gameobjects/shape/triangle/TriangleCanvasRenderer.js":(function(module,exports,__webpack_require__){var FillStyleCanvas=__webpack_require__("./gameobjects/shape/FillStyleCanvas.js");var LineStyleCanvas=__webpack_require__("./gameobjects/shape/LineStyleCanvas.js");var SetTransform=__webpack_require__("./renderer/canvas/utils/SetTransform.js");var TriangleCanvasRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var ctx=renderer.currentContext;if(SetTransform(renderer,ctx,src,camera,parentMatrix))
    {var dx=src._displayOriginX;var dy=src._displayOriginY;var x1=src.geom.x1-dx;var y1=src.geom.y1-dy;var x2=src.geom.x2-dx;var y2=src.geom.y2-dy;var x3=src.geom.x3-dx;var y3=src.geom.y3-dy;ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.lineTo(x3,y3);ctx.closePath();if(src.isFilled)
    {FillStyleCanvas(ctx,src);ctx.fill();}
        if(src.isStroked)
        {LineStyleCanvas(ctx,src);ctx.stroke();}
        ctx.restore();}};module.exports=TriangleCanvasRenderer;}),"./gameobjects/shape/triangle/TriangleFactory.js":(function(module,exports,__webpack_require__){var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");var Triangle=__webpack_require__("./gameobjects/shape/triangle/Triangle.js");GameObjectFactory.register('triangle',function(x,y,x1,y1,x2,y2,x3,y3,fillColor,fillAlpha)
    {return this.displayList.add(new Triangle(this.scene,x,y,x1,y1,x2,y2,x3,y3,fillColor,fillAlpha));});}),"./gameobjects/shape/triangle/TriangleRender.js":(function(module,exports,__webpack_require__){var renderWebGL=__webpack_require__("./utils/NOOP.js");var renderCanvas=__webpack_require__("./utils/NOOP.js");if(true)
    {renderWebGL=__webpack_require__("./gameobjects/shape/triangle/TriangleWebGLRenderer.js");}
        if(true)
        {renderCanvas=__webpack_require__("./gameobjects/shape/triangle/TriangleCanvasRenderer.js");}
        module.exports={renderWebGL:renderWebGL,renderCanvas:renderCanvas};}),"./gameobjects/shape/triangle/TriangleWebGLRenderer.js":(function(module,exports,__webpack_require__){var StrokePathWebGL=__webpack_require__("./gameobjects/shape/StrokePathWebGL.js");var Utils=__webpack_require__("./renderer/webgl/Utils.js");var TriangleWebGLRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {var pipeline=this.pipeline;var camMatrix=pipeline._tempMatrix1;var shapeMatrix=pipeline._tempMatrix2;var calcMatrix=pipeline._tempMatrix3;renderer.setPipeline(pipeline);shapeMatrix.applyITRS(src.x,src.y,src.rotation,src.scaleX,src.scaleY);camMatrix.copyFrom(camera.matrix);if(parentMatrix)
    {camMatrix.multiplyWithOffset(parentMatrix,-camera.scrollX*src.scrollFactorX,-camera.scrollY*src.scrollFactorY);shapeMatrix.e=src.x;shapeMatrix.f=src.y;}
    else
    {shapeMatrix.e-=camera.scrollX*src.scrollFactorX;shapeMatrix.f-=camera.scrollY*src.scrollFactorY;}
        camMatrix.multiply(shapeMatrix,calcMatrix);var dx=src._displayOriginX;var dy=src._displayOriginY;var alpha=camera.alpha*src.alpha;if(src.isFilled)
    {var fillTint=pipeline.fillTint;var fillTintColor=Utils.getTintAppendFloatAlphaAndSwap(src.fillColor,src.fillAlpha*alpha);fillTint.TL=fillTintColor;fillTint.TR=fillTintColor;fillTint.BL=fillTintColor;fillTint.BR=fillTintColor;var x1=src.geom.x1-dx;var y1=src.geom.y1-dy;var x2=src.geom.x2-dx;var y2=src.geom.y2-dy;var x3=src.geom.x3-dx;var y3=src.geom.y3-dy;pipeline.setTexture2D();pipeline.batchFillTriangle(x1,y1,x2,y2,x3,y3,shapeMatrix,camMatrix);}
        if(src.isStroked)
        {StrokePathWebGL(pipeline,src,alpha,dx,dy);}};module.exports=TriangleWebGLRenderer;}),"./gameobjects/sprite/Sprite.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Components=__webpack_require__("./gameobjects/components/index.js");var GameObject=__webpack_require__("./gameobjects/GameObject.js");var SpriteRender=__webpack_require__("./gameobjects/sprite/SpriteRender.js");var Sprite=new Class({Extends:GameObject,Mixins:[Components.Alpha,Components.BlendMode,Components.Depth,Components.Flip,Components.GetBounds,Components.Mask,Components.Origin,Components.Pipeline,Components.ScaleMode,Components.ScrollFactor,Components.Size,Components.TextureCrop,Components.Tint,Components.Transform,Components.Visible,SpriteRender],initialize:function Sprite(scene,x,y,texture,frame)
        {GameObject.call(this,scene,'Sprite');this._crop=this.resetCropObject();this.anims=new Components.Animation(this);this.setTexture(texture,frame);this.setPosition(x,y);this.setSizeToFrame();this.setOriginFromFrame();this.initPipeline();},preUpdate:function(time,delta)
        {this.anims.update(time,delta);},play:function(key,ignoreIfPlaying,startFrame)
        {this.anims.play(key,ignoreIfPlaying,startFrame);return this;},toJSON:function()
        {var data=Components.ToJSON(this);return data;},preDestroy:function()
        {this.anims.destroy();this.anims=undefined;}});module.exports=Sprite;}),"./gameobjects/sprite/SpriteCanvasRenderer.js":(function(module,exports){var SpriteCanvasRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {renderer.batchSprite(src,src.frame,camera,parentMatrix);};module.exports=SpriteCanvasRenderer;}),"./gameobjects/sprite/SpriteCreator.js":(function(module,exports,__webpack_require__){var BuildGameObject=__webpack_require__("./gameobjects/BuildGameObject.js");var BuildGameObjectAnimation=__webpack_require__("./gameobjects/BuildGameObjectAnimation.js");var GameObjectCreator=__webpack_require__("./gameobjects/GameObjectCreator.js");var GetAdvancedValue=__webpack_require__("./utils/object/GetAdvancedValue.js");var Sprite=__webpack_require__("./gameobjects/sprite/Sprite.js");GameObjectCreator.register('sprite',function(config,addToScene)
    {if(config===undefined){config={};}
        var key=GetAdvancedValue(config,'key',null);var frame=GetAdvancedValue(config,'frame',null);var sprite=new Sprite(this.scene,0,0,key,frame);if(addToScene!==undefined)
    {config.add=addToScene;}
        BuildGameObject(this.scene,sprite,config);BuildGameObjectAnimation(sprite,config);return sprite;});}),"./gameobjects/sprite/SpriteFactory.js":(function(module,exports,__webpack_require__){var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");var Sprite=__webpack_require__("./gameobjects/sprite/Sprite.js");GameObjectFactory.register('sprite',function(x,y,key,frame)
    {var sprite=new Sprite(this.scene,x,y,key,frame);this.displayList.add(sprite);this.updateList.add(sprite);return sprite;});}),"./gameobjects/sprite/SpriteRender.js":(function(module,exports,__webpack_require__){var renderWebGL=__webpack_require__("./utils/NOOP.js");var renderCanvas=__webpack_require__("./utils/NOOP.js");if(true)
    {renderWebGL=__webpack_require__("./gameobjects/sprite/SpriteWebGLRenderer.js");}
        if(true)
        {renderCanvas=__webpack_require__("./gameobjects/sprite/SpriteCanvasRenderer.js");}
        module.exports={renderWebGL:renderWebGL,renderCanvas:renderCanvas};}),"./gameobjects/sprite/SpriteWebGLRenderer.js":(function(module,exports){var SpriteWebGLRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {this.pipeline.batchSprite(src,camera,parentMatrix);};module.exports=SpriteWebGLRenderer;}),"./gameobjects/text/GetTextSize.js":(function(module,exports){var GetTextSize=function(text,size,lines)
    {var canvas=text.canvas;var context=text.context;var style=text.style;var lineWidths=[];var maxLineWidth=0;var drawnLines=lines.length;if(style.maxLines>0&&style.maxLines<lines.length)
    {drawnLines=style.maxLines;}
        style.syncFont(canvas,context);for(var i=0;i<drawnLines;i++)
    {var lineWidth=style.strokeThickness;lineWidth+=context.measureText(lines[i]).width;if(style.wordWrap)
    {lineWidth-=context.measureText(' ').width;}
        lineWidths[i]=Math.ceil(lineWidth);maxLineWidth=Math.max(maxLineWidth,lineWidths[i]);}
        var lineHeight=size.fontSize+style.strokeThickness;var height=lineHeight*drawnLines;var lineSpacing=text.lineSpacing;if(lines.length>1)
    {height+=lineSpacing*(lines.length-1);}
        return{width:maxLineWidth,height:height,lines:drawnLines,lineWidths:lineWidths,lineSpacing:lineSpacing,lineHeight:lineHeight};};module.exports=GetTextSize;}),"./gameobjects/text/MeasureText.js":(function(module,exports,__webpack_require__){var CanvasPool=__webpack_require__("./display/canvas/CanvasPool.js");var MeasureText=function(textStyle)
    {var canvas=CanvasPool.create(this);var context=canvas.getContext('2d');textStyle.syncFont(canvas,context);var width=Math.ceil(context.measureText(textStyle.testString).width*textStyle.baselineX);var baseline=width;var height=2*baseline;baseline=baseline*textStyle.baselineY|0;canvas.width=width;canvas.height=height;context.fillStyle='#f00';context.fillRect(0,0,width,height);context.font=textStyle._font;context.textBaseline='alphabetic';context.fillStyle='#000';context.fillText(textStyle.testString,0,baseline);var output={ascent:0,descent:0,fontSize:0};if(!context.getImageData(0,0,width,height))
    {output.ascent=baseline;output.descent=baseline+6;output.fontSize=output.ascent+output.descent;CanvasPool.remove(canvas);return output;}
        var imagedata=context.getImageData(0,0,width,height).data;var pixels=imagedata.length;var line=width*4;var i;var j;var idx=0;var stop=false;for(i=0;i<baseline;i++)
    {for(j=0;j<line;j+=4)
    {if(imagedata[idx+j]!==255)
    {stop=true;break;}}
        if(!stop)
        {idx+=line;}
        else
        {break;}}
        output.ascent=baseline-i;idx=pixels-line;stop=false;for(i=height;i>baseline;i--)
    {for(j=0;j<line;j+=4)
    {if(imagedata[idx+j]!==255)
    {stop=true;break;}}
        if(!stop)
        {idx-=line;}
        else
        {break;}}
        output.descent=(i-baseline);output.fontSize=output.ascent+output.descent;CanvasPool.remove(canvas);return output;};module.exports=MeasureText;}),"./gameobjects/text/TextStyle.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var GetAdvancedValue=__webpack_require__("./utils/object/GetAdvancedValue.js");var GetValue=__webpack_require__("./utils/object/GetValue.js");var MeasureText=__webpack_require__("./gameobjects/text/MeasureText.js");var propertyMap={fontFamily:['fontFamily','Courier'],fontSize:['fontSize','16px'],fontStyle:['fontStyle',''],backgroundColor:['backgroundColor',null],color:['color','#fff'],stroke:['stroke','#fff'],strokeThickness:['strokeThickness',0],shadowOffsetX:['shadow.offsetX',0],shadowOffsetY:['shadow.offsetY',0],shadowColor:['shadow.color','#000'],shadowBlur:['shadow.blur',0],shadowStroke:['shadow.stroke',false],shadowFill:['shadow.fill',false],align:['align','left'],maxLines:['maxLines',0],fixedWidth:['fixedWidth',0],fixedHeight:['fixedHeight',0],resolution:['resolution',0],rtl:['rtl',false],testString:['testString','|MÃ‰qgy'],baselineX:['baselineX',1.2],baselineY:['baselineY',1.4],wordWrapWidth:['wordWrap.width',null],wordWrapCallback:['wordWrap.callback',null],wordWrapCallbackScope:['wordWrap.callbackScope',null],wordWrapUseAdvanced:['wordWrap.useAdvancedWrap',false]};var TextStyle=new Class({initialize:function TextStyle(text,style)
        {this.parent=text;this.fontFamily;this.fontSize;this.fontStyle;this.backgroundColor;this.color;this.stroke;this.strokeThickness;this.shadowOffsetX;this.shadowOffsetY;this.shadowColor;this.shadowBlur;this.shadowStroke;this.shadowFill;this.align;this.maxLines;this.fixedWidth;this.fixedHeight;this.resolution;this.rtl;this.testString;this.baselineX;this.baselineY;this._font;this.setStyle(style,false,true);var metrics=GetValue(style,'metrics',false);if(metrics)
        {this.metrics={ascent:GetValue(metrics,'ascent',0),descent:GetValue(metrics,'descent',0),fontSize:GetValue(metrics,'fontSize',0)};}
        else
        {this.metrics=MeasureText(this);}},setStyle:function(style,updateText,setDefaults)
        {if(updateText===undefined){updateText=true;}
            if(setDefaults===undefined){setDefaults=false;}
            if(style&&style.hasOwnProperty('fontSize')&&typeof style.fontSize==='number')
            {style.fontSize=style.fontSize.toString()+'px';}
            for(var key in propertyMap)
            {var value=(setDefaults)?propertyMap[key][1]:this[key];if(key==='wordWrapCallback'||key==='wordWrapCallbackScope')
            {this[key]=GetValue(style,propertyMap[key][0],value);}
            else
            {this[key]=GetAdvancedValue(style,propertyMap[key][0],value);}}
            var font=GetValue(style,'font',null);if(font!==null)
        {this.setFont(font,false);}
            this._font=[this.fontStyle,this.fontSize,'"'+this.fontFamily+'"'].join(' ').trim();var fill=GetValue(style,'fill',null);if(fill!==null)
        {this.color=fill;}
            if(updateText)
            {return this.update(true);}
            else
            {return this.parent;}},syncFont:function(canvas,context)
        {context.font=this._font;},syncStyle:function(canvas,context)
        {context.textBaseline='alphabetic';context.fillStyle=this.color;context.strokeStyle=this.stroke;context.lineWidth=this.strokeThickness;context.lineCap='round';context.lineJoin='round';},syncShadow:function(context,enabled)
        {if(enabled)
        {context.shadowOffsetX=this.shadowOffsetX;context.shadowOffsetY=this.shadowOffsetY;context.shadowColor=this.shadowColor;context.shadowBlur=this.shadowBlur;}
        else
        {context.shadowOffsetX=0;context.shadowOffsetY=0;context.shadowColor=0;context.shadowBlur=0;}},update:function(recalculateMetrics)
        {if(recalculateMetrics)
        {this._font=[this.fontStyle,this.fontSize,'"'+this.fontFamily+'"'].join(' ').trim();this.metrics=MeasureText(this);}
            return this.parent.updateText();},setFont:function(font,updateText)
        {if(updateText===undefined){updateText=true;}
            var fontFamily=font;var fontSize='';var fontStyle='';if(typeof font!=='string')
        {fontFamily=GetValue(font,'fontFamily','Courier');fontSize=GetValue(font,'fontSize','16px');fontStyle=GetValue(font,'fontStyle','');}
        else
        {var fontSplit=font.split(' ');var i=0;fontStyle=(fontSplit.length>2)?fontSplit[i++]:'';fontSize=fontSplit[i++]||'16px';fontFamily=fontSplit[i++]||'Courier';}
            if(fontFamily!==this.fontFamily||fontSize!==this.fontSize||fontStyle!==this.fontStyle)
            {this.fontFamily=fontFamily;this.fontSize=fontSize;this.fontStyle=fontStyle;if(updateText)
            {this.update(true);}}
            return this.parent;},setFontFamily:function(family)
        {if(this.fontFamily!==family)
        {this.fontFamily=family;this.update(true);}
            return this.parent;},setFontStyle:function(style)
        {if(this.fontStyle!==style)
        {this.fontStyle=style;this.update(true);}
            return this.parent;},setFontSize:function(size)
        {if(typeof size==='number')
        {size=size.toString()+'px';}
            if(this.fontSize!==size)
            {this.fontSize=size;this.update(true);}
            return this.parent;},setTestString:function(string)
        {this.testString=string;return this.update(true);},setFixedSize:function(width,height)
        {this.fixedWidth=width;this.fixedHeight=height;if(width)
        {this.parent.width=width;}
            if(height)
            {this.parent.height=height;}
            return this.update(false);},setBackgroundColor:function(color)
        {this.backgroundColor=color;return this.update(false);},setFill:function(color)
        {this.color=color;return this.update(false);},setColor:function(color)
        {this.color=color;return this.update(false);},setResolution:function(value)
        {this.resolution=value;return this.update(false);},setStroke:function(color,thickness)
        {if(thickness===undefined){thickness=this.strokeThickness;}
            if(color===undefined&&this.strokeThickness!==0)
            {this.strokeThickness=0;this.update(true);}
            else if(this.stroke!==color||this.strokeThickness!==thickness)
            {this.stroke=color;this.strokeThickness=thickness;this.update(true);}
            return this.parent;},setShadow:function(x,y,color,blur,shadowStroke,shadowFill)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            if(color===undefined){color='#000';}
            if(blur===undefined){blur=0;}
            if(shadowStroke===undefined){shadowStroke=false;}
            if(shadowFill===undefined){shadowFill=true;}
            this.shadowOffsetX=x;this.shadowOffsetY=y;this.shadowColor=color;this.shadowBlur=blur;this.shadowStroke=shadowStroke;this.shadowFill=shadowFill;return this.update(false);},setShadowOffset:function(x,y)
        {if(x===undefined){x=0;}
            if(y===undefined){y=x;}
            this.shadowOffsetX=x;this.shadowOffsetY=y;return this.update(false);},setShadowColor:function(color)
        {if(color===undefined){color='#000';}
            this.shadowColor=color;return this.update(false);},setShadowBlur:function(blur)
        {if(blur===undefined){blur=0;}
            this.shadowBlur=blur;return this.update(false);},setShadowStroke:function(enabled)
        {this.shadowStroke=enabled;return this.update(false);},setShadowFill:function(enabled)
        {this.shadowFill=enabled;return this.update(false);},setWordWrapWidth:function(width,useAdvancedWrap)
        {if(useAdvancedWrap===undefined){useAdvancedWrap=false;}
            this.wordWrapWidth=width;this.wordWrapUseAdvanced=useAdvancedWrap;return this.update(false);},setWordWrapCallback:function(callback,scope)
        {if(scope===undefined){scope=null;}
            this.wordWrapCallback=callback;this.wordWrapCallbackScope=scope;return this.update(false);},setAlign:function(align)
        {if(align===undefined){align='left';}
            this.align=align;return this.update(false);},setMaxLines:function(max)
        {if(max===undefined){max=0;}
            this.maxLines=max;return this.update(false);},getTextMetrics:function()
        {var metrics=this.metrics;return{ascent:metrics.ascent,descent:metrics.descent,fontSize:metrics.fontSize};},toJSON:function()
        {var output={};for(var key in propertyMap)
        {output[key]=this[key];}
            output.metrics=this.getTextMetrics();return output;},destroy:function()
        {this.parent=undefined;}});module.exports=TextStyle;}),"./gameobjects/text/static/Text.js":(function(module,exports,__webpack_require__){var AddToDOM=__webpack_require__("./dom/AddToDOM.js");var CanvasPool=__webpack_require__("./display/canvas/CanvasPool.js");var Class=__webpack_require__("./utils/Class.js");var Components=__webpack_require__("./gameobjects/components/index.js");var CONST=__webpack_require__("./const.js");var GameObject=__webpack_require__("./gameobjects/GameObject.js");var GetTextSize=__webpack_require__("./gameobjects/text/GetTextSize.js");var GetValue=__webpack_require__("./utils/object/GetValue.js");var RemoveFromDOM=__webpack_require__("./dom/RemoveFromDOM.js");var TextRender=__webpack_require__("./gameobjects/text/static/TextRender.js");var TextStyle=__webpack_require__("./gameobjects/text/TextStyle.js");var Text=new Class({Extends:GameObject,Mixins:[Components.Alpha,Components.BlendMode,Components.ComputedSize,Components.Crop,Components.Depth,Components.Flip,Components.GetBounds,Components.Mask,Components.Origin,Components.Pipeline,Components.ScaleMode,Components.ScrollFactor,Components.Tint,Components.Transform,Components.Visible,TextRender],initialize:function Text(scene,x,y,text,style)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            GameObject.call(this,scene,'Text');this.renderer=scene.sys.game.renderer;this.setPosition(x,y);this.setOrigin(0,0);this.initPipeline();this.canvas=CanvasPool.create(this);this.context=this.canvas.getContext('2d');this.style=new TextStyle(this,style);this.autoRound=true;this.splitRegExp=/(?:\r\n|\r|\n)/;this._text='';this.padding={left:0,right:0,top:0,bottom:0};this.width=1;this.height=1;this.lineSpacing=0;this.dirty=false;if(this.style.resolution===0)
        {this.style.resolution=scene.sys.game.config.resolution;}
            this._crop=this.resetCropObject();this.texture=scene.sys.textures.addCanvas(null,this.canvas,true);this.frame=this.texture.get();this.frame.source.resolution=this.style.resolution;if(this.renderer&&this.renderer.gl)
        {this.renderer.deleteTexture(this.frame.source.glTexture);this.frame.source.glTexture=null;}
            this.initRTL();if(style&&style.padding)
        {this.setPadding(style.padding);}
            if(style&&style.lineSpacing)
            {this.lineSpacing=style.lineSpacing;}
            this.setText(text);if(scene.sys.game.config.renderType===CONST.WEBGL)
        {scene.sys.game.renderer.onContextRestored(function()
        {this.dirty=true;},this);}},initRTL:function()
        {if(!this.style.rtl)
        {return;}
            this.canvas.dir='rtl';this.context.direction='rtl';this.canvas.style.display='none';AddToDOM(this.canvas,this.scene.sys.canvas);this.originX=1;},runWordWrap:function(text)
        {var style=this.style;if(style.wordWrapCallback)
        {var wrappedLines=style.wordWrapCallback.call(style.wordWrapCallbackScope,text,this);if(Array.isArray(wrappedLines))
        {wrappedLines=wrappedLines.join('\n');}
            return wrappedLines;}
        else if(style.wordWrapWidth)
        {if(style.wordWrapUseAdvanced)
        {return this.advancedWordWrap(text,this.context,this.style.wordWrapWidth);}
        else
        {return this.basicWordWrap(text,this.context,this.style.wordWrapWidth);}}
        else
        {return text;}},advancedWordWrap:function(text,context,wordWrapWidth)
        {var output='';var lines=text.replace(/ +/gi,' ').split(this.splitRegExp);var linesCount=lines.length;for(var i=0;i<linesCount;i++)
        {var line=lines[i];var out='';line=line.replace(/^ *|\s*$/gi,'');var lineWidth=context.measureText(line).width;if(lineWidth<wordWrapWidth)
        {output+=line+'\n';continue;}
            var currentLineWidth=wordWrapWidth;var words=line.split(' ');for(var j=0;j<words.length;j++)
        {var word=words[j];var wordWithSpace=word+' ';var wordWidth=context.measureText(wordWithSpace).width;if(wordWidth>currentLineWidth)
        {if(j===0)
        {var newWord=wordWithSpace;while(newWord.length)
        {newWord=newWord.slice(0,-1);wordWidth=context.measureText(newWord).width;if(wordWidth<=currentLineWidth)
        {break;}}
            if(!newWord.length)
            {throw new Error('This text\'s wordWrapWidth setting is less than a single character!');}
            var secondPart=word.substr(newWord.length);words[j]=secondPart;out+=newWord;}
            var offset=(words[j].length)?j:j+1;var remainder=words.slice(offset).join(' ').replace(/[ \n]*$/gi,'');lines[i+1]=remainder+' '+(lines[i+1]||'');linesCount=lines.length;break;}
        else
        {out+=wordWithSpace;currentLineWidth-=wordWidth;}}
            output+=out.replace(/[ \n]*$/gi,'')+'\n';}
            output=output.replace(/[\s|\n]*$/gi,'');return output;},basicWordWrap:function(text,context,wordWrapWidth)
        {var result='';var lines=text.split(this.splitRegExp);for(var i=0;i<lines.length;i++)
        {var spaceLeft=wordWrapWidth;var words=lines[i].split(' ');for(var j=0;j<words.length;j++)
        {var wordWidth=context.measureText(words[j]).width;var wordWidthWithSpace=wordWidth+context.measureText(' ').width;if(wordWidthWithSpace>spaceLeft)
        {if(j>0)
        {result+='\n';}
            result+=words[j]+' ';spaceLeft=wordWrapWidth-wordWidth;}
        else
        {spaceLeft-=wordWidthWithSpace;result+=words[j];if(j<(words.length-1))
        {result+=' ';}}}
            if(i<lines.length-1)
            {result+='\n';}}
            return result;},getWrappedText:function(text)
        {if(text===undefined){text=this._text;}
            this.style.syncFont(this.canvas,this.context);var wrappedLines=this.runWordWrap(text);return wrappedLines.split(this.splitRegExp);},setText:function(value)
        {if(!value&&value!==0)
        {value='';}
            if(Array.isArray(value))
            {value=value.join('\n');}
            if(value!==this._text)
            {this._text=value.toString();this.updateText();}
            return this;},setStyle:function(style)
        {return this.style.setStyle(style);},setFont:function(font)
        {return this.style.setFont(font);},setFontFamily:function(family)
        {return this.style.setFontFamily(family);},setFontSize:function(size)
        {return this.style.setFontSize(size);},setFontStyle:function(style)
        {return this.style.setFontStyle(style);},setFixedSize:function(width,height)
        {return this.style.setFixedSize(width,height);},setBackgroundColor:function(color)
        {return this.style.setBackgroundColor(color);},setFill:function(fillStyle)
        {return this.style.setFill(fillStyle);},setColor:function(color)
        {return this.style.setColor(color);},setStroke:function(color,thickness)
        {return this.style.setStroke(color,thickness);},setShadow:function(x,y,color,blur,shadowStroke,shadowFill)
        {return this.style.setShadow(x,y,color,blur,shadowStroke,shadowFill);},setShadowOffset:function(x,y)
        {return this.style.setShadowOffset(x,y);},setShadowColor:function(color)
        {return this.style.setShadowColor(color);},setShadowBlur:function(blur)
        {return this.style.setShadowBlur(blur);},setShadowStroke:function(enabled)
        {return this.style.setShadowStroke(enabled);},setShadowFill:function(enabled)
        {return this.style.setShadowFill(enabled);},setWordWrapWidth:function(width,useAdvancedWrap)
        {return this.style.setWordWrapWidth(width,useAdvancedWrap);},setWordWrapCallback:function(callback,scope)
        {return this.style.setWordWrapCallback(callback,scope);},setAlign:function(align)
        {return this.style.setAlign(align);},setResolution:function(value)
        {return this.style.setResolution(value);},setLineSpacing:function(value)
        {this.lineSpacing=value;return this.updateText();},setPadding:function(left,top,right,bottom)
        {if(typeof left==='object')
        {var config=left;var x=GetValue(config,'x',null);if(x!==null)
        {left=x;right=x;}
        else
        {left=GetValue(config,'left',0);right=GetValue(config,'right',left);}
            var y=GetValue(config,'y',null);if(y!==null)
        {top=y;bottom=y;}
        else
        {top=GetValue(config,'top',0);bottom=GetValue(config,'bottom',top);}}
        else
        {if(left===undefined){left=0;}
            if(top===undefined){top=left;}
            if(right===undefined){right=left;}
            if(bottom===undefined){bottom=top;}}
            this.padding.left=left;this.padding.top=top;this.padding.right=right;this.padding.bottom=bottom;return this.updateText();},setMaxLines:function(max)
        {return this.style.setMaxLines(max);},updateText:function()
        {var canvas=this.canvas;var context=this.context;var style=this.style;var resolution=style.resolution;var size=style.metrics;style.syncFont(canvas,context);var outputText=this._text;if(style.wordWrapWidth||style.wordWrapCallback)
        {outputText=this.runWordWrap(this._text);}
            var lines=outputText.split(this.splitRegExp);var textSize=GetTextSize(this,size,lines);var padding=this.padding;var w=textSize.width+padding.left+padding.right;var h=textSize.height+padding.top+padding.bottom;if(style.fixedWidth===0)
        {this.width=w;}
            if(style.fixedHeight===0)
            {this.height=h;}
            this.updateDisplayOrigin();w*=resolution;h*=resolution;w=Math.max(w,1);h=Math.max(h,1);if(canvas.width!==w||canvas.height!==h)
        {canvas.width=w;canvas.height=h;this.frame.setSize(w,h);style.syncFont(canvas,context);}
        else
        {context.clearRect(0,0,w,h);}
            context.save();context.scale(resolution,resolution);if(style.backgroundColor)
        {context.fillStyle=style.backgroundColor;context.fillRect(0,0,w,h);}
            style.syncStyle(canvas,context);context.textBaseline='alphabetic';context.translate(padding.left,padding.top);var linePositionX;var linePositionY;for(var i=0;i<textSize.lines;i++)
        {linePositionX=style.strokeThickness / 2;linePositionY=(style.strokeThickness / 2+i*textSize.lineHeight)+size.ascent;if(i>0)
        {linePositionY+=(textSize.lineSpacing*i);}
            if(style.rtl)
            {linePositionX=w-linePositionX;}
            else if(style.align==='right')
            {linePositionX+=textSize.width-textSize.lineWidths[i];}
            else if(style.align==='center')
            {linePositionX+=(textSize.width-textSize.lineWidths[i])/ 2;}
            if(this.autoRound)
            {linePositionX=Math.round(linePositionX);linePositionY=Math.round(linePositionY);}
            if(style.strokeThickness)
            {this.style.syncShadow(context,style.shadowStroke);context.strokeText(lines[i],linePositionX,linePositionY);}
            if(style.color)
            {this.style.syncShadow(context,style.shadowFill);context.fillText(lines[i],linePositionX,linePositionY);}}
            context.restore();if(this.renderer.gl)
        {this.frame.source.glTexture=this.renderer.canvasToTexture(canvas,this.frame.source.glTexture,true);this.frame.glTexture=this.frame.source.glTexture;}
            this.dirty=true;return this;},getTextMetrics:function()
        {return this.style.getTextMetrics();},text:{get:function()
            {return this._text;},set:function(value)
            {this.setText(value);}},toJSON:function()
        {var out=Components.ToJSON(this);var data={autoRound:this.autoRound,text:this._text,style:this.style.toJSON(),padding:{left:this.padding.left,right:this.padding.right,top:this.padding.top,bottom:this.padding.bottom}};out.data=data;return out;},preDestroy:function()
        {if(this.style.rtl)
        {RemoveFromDOM(this.canvas);}
            CanvasPool.remove(this.canvas);this.texture.destroy();}});module.exports=Text;}),"./gameobjects/text/static/TextCanvasRenderer.js":(function(module,exports){var TextCanvasRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {if(src.text!=='')
    {renderer.batchSprite(src,src.frame,camera,parentMatrix);}};module.exports=TextCanvasRenderer;}),"./gameobjects/text/static/TextCreator.js":(function(module,exports,__webpack_require__){var BuildGameObject=__webpack_require__("./gameobjects/BuildGameObject.js");var GameObjectCreator=__webpack_require__("./gameobjects/GameObjectCreator.js");var GetAdvancedValue=__webpack_require__("./utils/object/GetAdvancedValue.js");var Text=__webpack_require__("./gameobjects/text/static/Text.js");GameObjectCreator.register('text',function(config,addToScene)
    {if(config===undefined){config={};}
        var content=GetAdvancedValue(config,'text','');var style=GetAdvancedValue(config,'style',null);var padding=GetAdvancedValue(config,'padding',null);if(padding!==null)
    {style.padding=padding;}
        var text=new Text(this.scene,0,0,content,style);if(addToScene!==undefined)
    {config.add=addToScene;}
        BuildGameObject(this.scene,text,config);text.autoRound=GetAdvancedValue(config,'autoRound',true);text.resolution=GetAdvancedValue(config,'resolution',1);return text;});}),"./gameobjects/text/static/TextFactory.js":(function(module,exports,__webpack_require__){var Text=__webpack_require__("./gameobjects/text/static/Text.js");var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");GameObjectFactory.register('text',function(x,y,text,style)
    {return this.displayList.add(new Text(this.scene,x,y,text,style));});}),"./gameobjects/text/static/TextRender.js":(function(module,exports,__webpack_require__){var renderWebGL=__webpack_require__("./utils/NOOP.js");var renderCanvas=__webpack_require__("./utils/NOOP.js");if(true)
    {renderWebGL=__webpack_require__("./gameobjects/text/static/TextWebGLRenderer.js");}
        if(true)
        {renderCanvas=__webpack_require__("./gameobjects/text/static/TextCanvasRenderer.js");}
        module.exports={renderWebGL:renderWebGL,renderCanvas:renderCanvas};}),"./gameobjects/text/static/TextWebGLRenderer.js":(function(module,exports,__webpack_require__){var Utils=__webpack_require__("./renderer/webgl/Utils.js");var TextWebGLRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {if(src.text==='')
    {return;}
        var frame=src.frame;var width=frame.width;var height=frame.height;var getTint=Utils.getTintAppendFloatAlpha;this.pipeline.batchTexture(src,frame.glTexture,width,height,src.x,src.y,width / src.style.resolution,height / src.style.resolution,src.scaleX,src.scaleY,src.rotation,src.flipX,src.flipY,src.scrollFactorX,src.scrollFactorY,src.displayOriginX,src.displayOriginY,0,0,width,height,getTint(src._tintTL,camera.alpha*src._alphaTL),getTint(src._tintTR,camera.alpha*src._alphaTR),getTint(src._tintBL,camera.alpha*src._alphaBL),getTint(src._tintBR,camera.alpha*src._alphaBR),(src._isTinted&&src.tintFill),0,0,camera,parentMatrix);};module.exports=TextWebGLRenderer;}),"./gameobjects/tilesprite/TileSprite.js":(function(module,exports,__webpack_require__){var CanvasPool=__webpack_require__("./display/canvas/CanvasPool.js");var Class=__webpack_require__("./utils/Class.js");var Components=__webpack_require__("./gameobjects/components/index.js");var CONST=__webpack_require__("./const.js");var GameObject=__webpack_require__("./gameobjects/GameObject.js");var GetPowerOfTwo=__webpack_require__("./math/pow2/GetPowerOfTwo.js");var Smoothing=__webpack_require__("./display/canvas/Smoothing.js");var TileSpriteRender=__webpack_require__("./gameobjects/tilesprite/TileSpriteRender.js");var Vector2=__webpack_require__("./math/Vector2.js");var _FLAG=8;var TileSprite=new Class({Extends:GameObject,Mixins:[Components.Alpha,Components.BlendMode,Components.ComputedSize,Components.Crop,Components.Depth,Components.Flip,Components.GetBounds,Components.Mask,Components.Origin,Components.Pipeline,Components.ScaleMode,Components.ScrollFactor,Components.Tint,Components.Transform,Components.Visible,TileSpriteRender],initialize:function TileSprite(scene,x,y,width,height,textureKey,frameKey)
        {var renderer=scene.sys.game.renderer;GameObject.call(this,scene,'TileSprite');var displayTexture=scene.sys.textures.get(textureKey);var displayFrame=displayTexture.get(frameKey);if(!width||!height)
        {width=displayFrame.width;height=displayFrame.height;}
        else
        {width=Math.floor(width);height=Math.floor(height);}
            this._tilePosition=new Vector2();this._tileScale=new Vector2(1,1);this.dirty=false;this.renderer=renderer;this.canvas=CanvasPool.create(this,width,height);this.context=this.canvas.getContext('2d');this.displayTexture=displayTexture;this.displayFrame=displayFrame;this._crop=this.resetCropObject();this.texture=scene.sys.textures.addCanvas(null,this.canvas,true);this.frame=this.texture.get();this.potWidth=GetPowerOfTwo(displayFrame.width);this.potHeight=GetPowerOfTwo(displayFrame.height);this.fillCanvas=CanvasPool.create2D(this,this.potWidth,this.potHeight);this.fillContext=this.fillCanvas.getContext('2d');this.fillPattern=null;this.setPosition(x,y);this.setSize(width,height);this.setFrame(frameKey);this.setOriginFromFrame();this.initPipeline();if(scene.sys.game.config.renderType===CONST.WEBGL)
        {scene.sys.game.renderer.onContextRestored(function(renderer)
        {var gl=renderer.gl;this.dirty=true;this.fillPattern=null;this.fillPattern=renderer.createTexture2D(0,gl.LINEAR,gl.LINEAR,gl.REPEAT,gl.REPEAT,gl.RGBA,this.fillCanvas,this.potWidth,this.potHeight);},this);}},setTexture:function(key,frame)
        {this.displayTexture=this.scene.sys.textures.get(key);return this.setFrame(frame);},setFrame:function(frame)
        {this.displayFrame=this.displayTexture.get(frame);if(!this.displayFrame.cutWidth||!this.displayFrame.cutHeight)
        {this.renderFlags&=~_FLAG;}
        else
        {this.renderFlags|=_FLAG;}
            this.dirty=true;this.updateTileTexture();return this;},setTilePosition:function(x,y)
        {if(x!==undefined)
        {this.tilePositionX=x;}
            if(y!==undefined)
            {this.tilePositionY=y;}
            return this;},setTileScale:function(x,y)
        {if(x!==undefined)
        {this.tileScaleX=x;}
            if(y!==undefined)
            {this.tileScaleY=y;}
            return this;},updateTileTexture:function()
        {if(!this.dirty)
        {return;}
            var frame=this.displayFrame;var ctx=this.fillContext;var canvas=this.fillCanvas;var fw=this.potWidth;var fh=this.potHeight;if(!this.renderer.gl)
        {fw=frame.cutWidth;fh=frame.cutHeight;}
            ctx.clearRect(0,0,fw,fh);canvas.width=fw;canvas.height=fh;ctx.drawImage(frame.source.image,frame.cutX,frame.cutY,frame.cutWidth,frame.cutHeight,0,0,fw,fh);if(this.renderer.gl)
        {this.fillPattern=this.renderer.canvasToTexture(canvas,this.fillPattern);}
        else
        {this.fillPattern=ctx.createPattern(canvas,'repeat');}
            this.updateCanvas();this.dirty=false;},updateCanvas:function()
        {var canvas=this.canvas;if(canvas.width!==this.width||canvas.height!==this.height)
        {canvas.width=this.width;canvas.height=this.height;this.frame.setSize(this.width,this.height);this.updateDisplayOrigin();this.dirty=true;}
            if(!this.dirty||this.renderer&&this.renderer.gl)
            {this.dirty=false;return;}
            var ctx=this.context;if(!this.scene.sys.game.config.antialias)
        {Smoothing.disable(ctx);}
            var scaleX=this._tileScale.x;var scaleY=this._tileScale.y;var positionX=this._tilePosition.x;var positionY=this._tilePosition.y;ctx.clearRect(0,0,this.width,this.height);ctx.save();ctx.scale(scaleX,scaleY);ctx.translate(-positionX,-positionY);ctx.fillStyle=this.fillPattern;ctx.fillRect(positionX,positionY,this.width / scaleX,this.height / scaleY);ctx.restore();this.dirty=false;},preDestroy:function()
        {if(this.renderer&&this.renderer.gl)
        {this.renderer.deleteTexture(this.fillPattern);}
            CanvasPool.remove(this.canvas);CanvasPool.remove(this.fillCanvas);this.fillPattern=null;this.fillContext=null;this.fillCanvas=null;this.displayTexture=null;this.displayFrame=null;this.texture.destroy();this.renderer=null;},tilePositionX:{get:function()
            {return this._tilePosition.x;},set:function(value)
            {this._tilePosition.x=value;this.dirty=true;}},tilePositionY:{get:function()
            {return this._tilePosition.y;},set:function(value)
            {this._tilePosition.y=value;this.dirty=true;}},tileScaleX:{get:function()
            {return this._tileScale.x;},set:function(value)
            {this._tileScale.x=value;this.dirty=true;}},tileScaleY:{get:function()
            {return this._tileScale.y;},set:function(value)
            {this._tileScale.y=value;this.dirty=true;}}});module.exports=TileSprite;}),"./gameobjects/tilesprite/TileSpriteCanvasRenderer.js":(function(module,exports){var TileSpriteCanvasRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {src.updateCanvas();renderer.batchSprite(src,src.frame,camera,parentMatrix);};module.exports=TileSpriteCanvasRenderer;}),"./gameobjects/tilesprite/TileSpriteCreator.js":(function(module,exports,__webpack_require__){var BuildGameObject=__webpack_require__("./gameobjects/BuildGameObject.js");var GameObjectCreator=__webpack_require__("./gameobjects/GameObjectCreator.js");var GetAdvancedValue=__webpack_require__("./utils/object/GetAdvancedValue.js");var TileSprite=__webpack_require__("./gameobjects/tilesprite/TileSprite.js");GameObjectCreator.register('tileSprite',function(config,addToScene)
    {if(config===undefined){config={};}
        var x=GetAdvancedValue(config,'x',0);var y=GetAdvancedValue(config,'y',0);var width=GetAdvancedValue(config,'width',512);var height=GetAdvancedValue(config,'height',512);var key=GetAdvancedValue(config,'key','');var frame=GetAdvancedValue(config,'frame','');var tile=new TileSprite(this.scene,x,y,width,height,key,frame);if(addToScene!==undefined)
    {config.add=addToScene;}
        BuildGameObject(this.scene,tile,config);return tile;});}),"./gameobjects/tilesprite/TileSpriteFactory.js":(function(module,exports,__webpack_require__){var TileSprite=__webpack_require__("./gameobjects/tilesprite/TileSprite.js");var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");GameObjectFactory.register('tileSprite',function(x,y,width,height,key,frame)
    {return this.displayList.add(new TileSprite(this.scene,x,y,width,height,key,frame));});}),"./gameobjects/tilesprite/TileSpriteRender.js":(function(module,exports,__webpack_require__){var renderWebGL=__webpack_require__("./utils/NOOP.js");var renderCanvas=__webpack_require__("./utils/NOOP.js");if(true)
    {renderWebGL=__webpack_require__("./gameobjects/tilesprite/TileSpriteWebGLRenderer.js");}
        if(true)
        {renderCanvas=__webpack_require__("./gameobjects/tilesprite/TileSpriteCanvasRenderer.js");}
        module.exports={renderWebGL:renderWebGL,renderCanvas:renderCanvas};}),"./gameobjects/tilesprite/TileSpriteWebGLRenderer.js":(function(module,exports,__webpack_require__){var Utils=__webpack_require__("./renderer/webgl/Utils.js");var TileSpriteWebGLRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {src.updateCanvas();var getTint=Utils.getTintAppendFloatAlpha;this.pipeline.batchTexture(src,src.fillPattern,src.displayFrame.width*src.tileScaleX,src.displayFrame.height*src.tileScaleY,src.x,src.y,src.width,src.height,src.scaleX,src.scaleY,src.rotation,src.flipX,src.flipY,src.scrollFactorX,src.scrollFactorY,src.originX*src.width,src.originY*src.height,0,0,src.width,src.height,getTint(src._tintTL,camera.alpha*src._alphaTL),getTint(src._tintTR,camera.alpha*src._alphaTR),getTint(src._tintBL,camera.alpha*src._alphaBL),getTint(src._tintBR,camera.alpha*src._alphaBR),(src._isTinted&&src.tintFill),(src.tilePositionX%src.displayFrame.width)/ src.displayFrame.width,(src.tilePositionY%src.displayFrame.height)/ src.displayFrame.height,camera,parentMatrix);};module.exports=TileSpriteWebGLRenderer;}),"./gameobjects/zone/Zone.js":(function(module,exports,__webpack_require__){var BlendModes=__webpack_require__("./renderer/BlendModes.js");var Circle=__webpack_require__("./geom/circle/Circle.js");var CircleContains=__webpack_require__("./geom/circle/Contains.js");var Class=__webpack_require__("./utils/Class.js");var Components=__webpack_require__("./gameobjects/components/index.js");var GameObject=__webpack_require__("./gameobjects/GameObject.js");var Rectangle=__webpack_require__("./geom/rectangle/Rectangle.js");var RectangleContains=__webpack_require__("./geom/rectangle/Contains.js");var Zone=new Class({Extends:GameObject,Mixins:[Components.Depth,Components.GetBounds,Components.Origin,Components.ScaleMode,Components.Transform,Components.ScrollFactor,Components.Visible],initialize:function Zone(scene,x,y,width,height)
        {if(width===undefined){width=1;}
            if(height===undefined){height=width;}
            GameObject.call(this,scene,'Zone');this.setPosition(x,y);this.width=width;this.height=height;this.blendMode=BlendModes.NORMAL;this.updateDisplayOrigin();},displayWidth:{get:function()
            {return this.scaleX*this.width;},set:function(value)
            {this.scaleX=value / this.width;}},displayHeight:{get:function()
            {return this.scaleY*this.height;},set:function(value)
            {this.scaleY=value / this.height;}},setSize:function(width,height,resizeInput)
        {if(resizeInput===undefined){resizeInput=true;}
            this.width=width;this.height=height;if(resizeInput&&this.input&&this.input.hitArea instanceof Rectangle)
        {this.input.hitArea.width=width;this.input.hitArea.height=height;}
            return this;},setDisplaySize:function(width,height)
        {this.displayWidth=width;this.displayHeight=height;return this;},setCircleDropZone:function(radius)
        {return this.setDropZone(new Circle(0,0,radius),CircleContains);},setRectangleDropZone:function(width,height)
        {return this.setDropZone(new Rectangle(0,0,width,height),RectangleContains);},setDropZone:function(shape,callback)
        {if(shape===undefined)
        {this.setRectangleDropZone(this.width,this.height);}
        else if(!this.input)
        {this.setInteractive(shape,callback,true);}
            return this;},setAlpha:function()
        {},renderCanvas:function()
        {},renderWebGL:function()
        {}});module.exports=Zone;}),"./gameobjects/zone/ZoneCreator.js":(function(module,exports,__webpack_require__){var GameObjectCreator=__webpack_require__("./gameobjects/GameObjectCreator.js");var GetAdvancedValue=__webpack_require__("./utils/object/GetAdvancedValue.js");var Zone=__webpack_require__("./gameobjects/zone/Zone.js");GameObjectCreator.register('zone',function(config)
    {var x=GetAdvancedValue(config,'x',0);var y=GetAdvancedValue(config,'y',0);var width=GetAdvancedValue(config,'width',1);var height=GetAdvancedValue(config,'height',width);return new Zone(this.scene,x,y,width,height);});}),"./gameobjects/zone/ZoneFactory.js":(function(module,exports,__webpack_require__){var Zone=__webpack_require__("./gameobjects/zone/Zone.js");var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");GameObjectFactory.register('zone',function(x,y,width,height)
    {return this.displayList.add(new Zone(this.scene,x,y,width,height));});}),"./geom/circle/Area.js":(function(module,exports){var Area=function(circle)
    {return(circle.radius>0)?Math.PI*circle.radius*circle.radius:0;};module.exports=Area;}),"./geom/circle/Circle.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Contains=__webpack_require__("./geom/circle/Contains.js");var GetPoint=__webpack_require__("./geom/circle/GetPoint.js");var GetPoints=__webpack_require__("./geom/circle/GetPoints.js");var Random=__webpack_require__("./geom/circle/Random.js");var Circle=new Class({initialize:function Circle(x,y,radius)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            if(radius===undefined){radius=0;}
            this.x=x;this.y=y;this._radius=radius;this._diameter=radius*2;},contains:function(x,y)
        {return Contains(this,x,y);},getPoint:function(position,point)
        {return GetPoint(this,position,point);},getPoints:function(quantity,stepRate,output)
        {return GetPoints(this,quantity,stepRate,output);},getRandomPoint:function(point)
        {return Random(this,point);},setTo:function(x,y,radius)
        {this.x=x;this.y=y;this._radius=radius;this._diameter=radius*2;return this;},setEmpty:function()
        {this._radius=0;this._diameter=0;return this;},setPosition:function(x,y)
        {if(y===undefined){y=x;}
            this.x=x;this.y=y;return this;},isEmpty:function()
        {return(this._radius<=0);},radius:{get:function()
            {return this._radius;},set:function(value)
            {this._radius=value;this._diameter=value*2;}},diameter:{get:function()
            {return this._diameter;},set:function(value)
            {this._diameter=value;this._radius=value*0.5;}},left:{get:function()
            {return this.x-this._radius;},set:function(value)
            {this.x=value+this._radius;}},right:{get:function()
            {return this.x+this._radius;},set:function(value)
            {this.x=value-this._radius;}},top:{get:function()
            {return this.y-this._radius;},set:function(value)
            {this.y=value+this._radius;}},bottom:{get:function()
            {return this.y+this._radius;},set:function(value)
            {this.y=value-this._radius;}}});module.exports=Circle;}),"./geom/circle/Circumference.js":(function(module,exports){var Circumference=function(circle)
    {return 2*(Math.PI*circle.radius);};module.exports=Circumference;}),"./geom/circle/CircumferencePoint.js":(function(module,exports,__webpack_require__){var Point=__webpack_require__("./geom/point/Point.js");var CircumferencePoint=function(circle,angle,out)
    {if(out===undefined){out=new Point();}
        out.x=circle.x+(circle.radius*Math.cos(angle));out.y=circle.y+(circle.radius*Math.sin(angle));return out;};module.exports=CircumferencePoint;}),"./geom/circle/Clone.js":(function(module,exports,__webpack_require__){var Circle=__webpack_require__("./geom/circle/Circle.js");var Clone=function(source)
    {return new Circle(source.x,source.y,source.radius);};module.exports=Clone;}),"./geom/circle/Contains.js":(function(module,exports){var Contains=function(circle,x,y)
    {if(circle.radius>0&&x>=circle.left&&x<=circle.right&&y>=circle.top&&y<=circle.bottom)
    {var dx=(circle.x-x)*(circle.x-x);var dy=(circle.y-y)*(circle.y-y);return(dx+dy)<=(circle.radius*circle.radius);}
    else
    {return false;}};module.exports=Contains;}),"./geom/circle/ContainsPoint.js":(function(module,exports,__webpack_require__){var Contains=__webpack_require__("./geom/circle/Contains.js");var ContainsPoint=function(circle,point)
    {return Contains(circle,point.x,point.y);};module.exports=ContainsPoint;}),"./geom/circle/ContainsRect.js":(function(module,exports,__webpack_require__){var Contains=__webpack_require__("./geom/circle/Contains.js");var ContainsRect=function(circle,rect)
    {return(Contains(circle,rect.x,rect.y)&&Contains(circle,rect.right,rect.y)&&Contains(circle,rect.x,rect.bottom)&&Contains(circle,rect.right,rect.bottom));};module.exports=ContainsRect;}),"./geom/circle/CopyFrom.js":(function(module,exports){var CopyFrom=function(source,dest)
    {return dest.setTo(source.x,source.y,source.radius);};module.exports=CopyFrom;}),"./geom/circle/Equals.js":(function(module,exports){var Equals=function(circle,toCompare)
    {return(circle.x===toCompare.x&&circle.y===toCompare.y&&circle.radius===toCompare.radius);};module.exports=Equals;}),"./geom/circle/GetBounds.js":(function(module,exports,__webpack_require__){var Rectangle=__webpack_require__("./geom/rectangle/Rectangle.js");var GetBounds=function(circle,out)
    {if(out===undefined){out=new Rectangle();}
        out.x=circle.left;out.y=circle.top;out.width=circle.diameter;out.height=circle.diameter;return out;};module.exports=GetBounds;}),"./geom/circle/GetPoint.js":(function(module,exports,__webpack_require__){var CircumferencePoint=__webpack_require__("./geom/circle/CircumferencePoint.js");var FromPercent=__webpack_require__("./math/FromPercent.js");var MATH_CONST=__webpack_require__("./math/const.js");var Point=__webpack_require__("./geom/point/Point.js");var GetPoint=function(circle,position,out)
    {if(out===undefined){out=new Point();}
        var angle=FromPercent(position,0,MATH_CONST.PI2);return CircumferencePoint(circle,angle,out);};module.exports=GetPoint;}),"./geom/circle/GetPoints.js":(function(module,exports,__webpack_require__){var Circumference=__webpack_require__("./geom/circle/Circumference.js");var CircumferencePoint=__webpack_require__("./geom/circle/CircumferencePoint.js");var FromPercent=__webpack_require__("./math/FromPercent.js");var MATH_CONST=__webpack_require__("./math/const.js");var GetPoints=function(circle,quantity,stepRate,out)
    {if(out===undefined){out=[];}
        if(!quantity)
        {quantity=Circumference(circle)/ stepRate;}
        for(var i=0;i<quantity;i++)
        {var angle=FromPercent(i / quantity,0,MATH_CONST.PI2);out.push(CircumferencePoint(circle,angle));}
        return out;};module.exports=GetPoints;}),"./geom/circle/Offset.js":(function(module,exports){var Offset=function(circle,x,y)
    {circle.x+=x;circle.y+=y;return circle;};module.exports=Offset;}),"./geom/circle/OffsetPoint.js":(function(module,exports){var OffsetPoint=function(circle,point)
    {circle.x+=point.x;circle.y+=point.y;return circle;};module.exports=OffsetPoint;}),"./geom/circle/Random.js":(function(module,exports,__webpack_require__){var Point=__webpack_require__("./geom/point/Point.js");var Random=function(circle,out)
    {if(out===undefined){out=new Point();}
        var t=2*Math.PI*Math.random();var u=Math.random()+Math.random();var r=(u>1)?2-u:u;var x=r*Math.cos(t);var y=r*Math.sin(t);out.x=circle.x+(x*circle.radius);out.y=circle.y+(y*circle.radius);return out;};module.exports=Random;}),"./geom/circle/index.js":(function(module,exports,__webpack_require__){var Circle=__webpack_require__("./geom/circle/Circle.js");Circle.Area=__webpack_require__("./geom/circle/Area.js");Circle.Circumference=__webpack_require__("./geom/circle/Circumference.js");Circle.CircumferencePoint=__webpack_require__("./geom/circle/CircumferencePoint.js");Circle.Clone=__webpack_require__("./geom/circle/Clone.js");Circle.Contains=__webpack_require__("./geom/circle/Contains.js");Circle.ContainsPoint=__webpack_require__("./geom/circle/ContainsPoint.js");Circle.ContainsRect=__webpack_require__("./geom/circle/ContainsRect.js");Circle.CopyFrom=__webpack_require__("./geom/circle/CopyFrom.js");Circle.Equals=__webpack_require__("./geom/circle/Equals.js");Circle.GetBounds=__webpack_require__("./geom/circle/GetBounds.js");Circle.GetPoint=__webpack_require__("./geom/circle/GetPoint.js");Circle.GetPoints=__webpack_require__("./geom/circle/GetPoints.js");Circle.Offset=__webpack_require__("./geom/circle/Offset.js");Circle.OffsetPoint=__webpack_require__("./geom/circle/OffsetPoint.js");Circle.Random=__webpack_require__("./geom/circle/Random.js");module.exports=Circle;}),"./geom/ellipse/Area.js":(function(module,exports){var Area=function(ellipse)
    {if(ellipse.isEmpty())
    {return 0;}
        return(ellipse.getMajorRadius()*ellipse.getMinorRadius()*Math.PI);};module.exports=Area;}),"./geom/ellipse/Circumference.js":(function(module,exports){var Circumference=function(ellipse)
    {var rx=ellipse.width / 2;var ry=ellipse.height / 2;var h=Math.pow((rx-ry),2)/ Math.pow((rx+ry),2);return(Math.PI*(rx+ry))*(1+((3*h)/(10+Math.sqrt(4-(3*h)))));};module.exports=Circumference;}),"./geom/ellipse/CircumferencePoint.js":(function(module,exports,__webpack_require__){var Point=__webpack_require__("./geom/point/Point.js");var CircumferencePoint=function(ellipse,angle,out)
    {if(out===undefined){out=new Point();}
        var halfWidth=ellipse.width / 2;var halfHeight=ellipse.height / 2;out.x=ellipse.x+halfWidth*Math.cos(angle);out.y=ellipse.y+halfHeight*Math.sin(angle);return out;};module.exports=CircumferencePoint;}),"./geom/ellipse/Clone.js":(function(module,exports,__webpack_require__){var Ellipse=__webpack_require__("./geom/ellipse/Ellipse.js");var Clone=function(source)
    {return new Ellipse(source.x,source.y,source.width,source.height);};module.exports=Clone;}),"./geom/ellipse/Contains.js":(function(module,exports){var Contains=function(ellipse,x,y)
    {if(ellipse.width<=0||ellipse.height<=0)
    {return false;}
        var normx=((x-ellipse.x)/ ellipse.width);var normy=((y-ellipse.y)/ ellipse.height);normx*=normx;normy*=normy;return(normx+normy<0.25);};module.exports=Contains;}),"./geom/ellipse/ContainsPoint.js":(function(module,exports,__webpack_require__){var Contains=__webpack_require__("./geom/ellipse/Contains.js");var ContainsPoint=function(ellipse,point)
    {return Contains(ellipse,point.x,point.y);};module.exports=ContainsPoint;}),"./geom/ellipse/ContainsRect.js":(function(module,exports,__webpack_require__){var Contains=__webpack_require__("./geom/ellipse/Contains.js");var ContainsRect=function(ellipse,rect)
    {return(Contains(ellipse,rect.x,rect.y)&&Contains(ellipse,rect.right,rect.y)&&Contains(ellipse,rect.x,rect.bottom)&&Contains(ellipse,rect.right,rect.bottom));};module.exports=ContainsRect;}),"./geom/ellipse/CopyFrom.js":(function(module,exports){var CopyFrom=function(source,dest)
    {return dest.setTo(source.x,source.y,source.width,source.height);};module.exports=CopyFrom;}),"./geom/ellipse/Ellipse.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Contains=__webpack_require__("./geom/ellipse/Contains.js");var GetPoint=__webpack_require__("./geom/ellipse/GetPoint.js");var GetPoints=__webpack_require__("./geom/ellipse/GetPoints.js");var Random=__webpack_require__("./geom/ellipse/Random.js");var Ellipse=new Class({initialize:function Ellipse(x,y,width,height)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            if(width===undefined){width=0;}
            if(height===undefined){height=0;}
            this.x=x;this.y=y;this.width=width;this.height=height;},contains:function(x,y)
        {return Contains(this,x,y);},getPoint:function(position,point)
        {return GetPoint(this,position,point);},getPoints:function(quantity,stepRate,output)
        {return GetPoints(this,quantity,stepRate,output);},getRandomPoint:function(point)
        {return Random(this,point);},setTo:function(x,y,width,height)
        {this.x=x;this.y=y;this.width=width;this.height=height;return this;},setEmpty:function()
        {this.width=0;this.height=0;return this;},setPosition:function(x,y)
        {if(y===undefined){y=x;}
            this.x=x;this.y=y;return this;},setSize:function(width,height)
        {if(height===undefined){height=width;}
            this.width=width;this.height=height;return this;},isEmpty:function()
        {return(this.width<=0||this.height<=0);},getMinorRadius:function()
        {return Math.min(this.width,this.height)/ 2;},getMajorRadius:function()
        {return Math.max(this.width,this.height)/ 2;},left:{get:function()
            {return this.x-(this.width / 2);},set:function(value)
            {this.x=value+(this.width / 2);}},right:{get:function()
            {return this.x+(this.width / 2);},set:function(value)
            {this.x=value-(this.width / 2);}},top:{get:function()
            {return this.y-(this.height / 2);},set:function(value)
            {this.y=value+(this.height / 2);}},bottom:{get:function()
            {return this.y+(this.height / 2);},set:function(value)
            {this.y=value-(this.height / 2);}}});module.exports=Ellipse;}),"./geom/ellipse/Equals.js":(function(module,exports){var Equals=function(ellipse,toCompare)
    {return(ellipse.x===toCompare.x&&ellipse.y===toCompare.y&&ellipse.width===toCompare.width&&ellipse.height===toCompare.height);};module.exports=Equals;}),"./geom/ellipse/GetBounds.js":(function(module,exports,__webpack_require__){var Rectangle=__webpack_require__("./geom/rectangle/Rectangle.js");var GetBounds=function(ellipse,out)
    {if(out===undefined){out=new Rectangle();}
        out.x=ellipse.left;out.y=ellipse.top;out.width=ellipse.width;out.height=ellipse.height;return out;};module.exports=GetBounds;}),"./geom/ellipse/GetPoint.js":(function(module,exports,__webpack_require__){var CircumferencePoint=__webpack_require__("./geom/ellipse/CircumferencePoint.js");var FromPercent=__webpack_require__("./math/FromPercent.js");var MATH_CONST=__webpack_require__("./math/const.js");var Point=__webpack_require__("./geom/point/Point.js");var GetPoint=function(ellipse,position,out)
    {if(out===undefined){out=new Point();}
        var angle=FromPercent(position,0,MATH_CONST.PI2);return CircumferencePoint(ellipse,angle,out);};module.exports=GetPoint;}),"./geom/ellipse/GetPoints.js":(function(module,exports,__webpack_require__){var Circumference=__webpack_require__("./geom/ellipse/Circumference.js");var CircumferencePoint=__webpack_require__("./geom/ellipse/CircumferencePoint.js");var FromPercent=__webpack_require__("./math/FromPercent.js");var MATH_CONST=__webpack_require__("./math/const.js");var GetPoints=function(ellipse,quantity,stepRate,out)
    {if(out===undefined){out=[];}
        if(!quantity)
        {quantity=Circumference(ellipse)/ stepRate;}
        for(var i=0;i<quantity;i++)
        {var angle=FromPercent(i / quantity,0,MATH_CONST.PI2);out.push(CircumferencePoint(ellipse,angle));}
        return out;};module.exports=GetPoints;}),"./geom/ellipse/Offset.js":(function(module,exports){var Offset=function(ellipse,x,y)
    {ellipse.x+=x;ellipse.y+=y;return ellipse;};module.exports=Offset;}),"./geom/ellipse/OffsetPoint.js":(function(module,exports){var OffsetPoint=function(ellipse,point)
    {ellipse.x+=point.x;ellipse.y+=point.y;return ellipse;};module.exports=OffsetPoint;}),"./geom/ellipse/Random.js":(function(module,exports,__webpack_require__){var Point=__webpack_require__("./geom/point/Point.js");var Random=function(ellipse,out)
    {if(out===undefined){out=new Point();}
        var p=Math.random()*Math.PI*2;var s=Math.sqrt(Math.random());out.x=ellipse.x+((s*Math.cos(p))*ellipse.width / 2);out.y=ellipse.y+((s*Math.sin(p))*ellipse.height / 2);return out;};module.exports=Random;}),"./geom/ellipse/index.js":(function(module,exports,__webpack_require__){var Ellipse=__webpack_require__("./geom/ellipse/Ellipse.js");Ellipse.Area=__webpack_require__("./geom/ellipse/Area.js");Ellipse.Circumference=__webpack_require__("./geom/ellipse/Circumference.js");Ellipse.CircumferencePoint=__webpack_require__("./geom/ellipse/CircumferencePoint.js");Ellipse.Clone=__webpack_require__("./geom/ellipse/Clone.js");Ellipse.Contains=__webpack_require__("./geom/ellipse/Contains.js");Ellipse.ContainsPoint=__webpack_require__("./geom/ellipse/ContainsPoint.js");Ellipse.ContainsRect=__webpack_require__("./geom/ellipse/ContainsRect.js");Ellipse.CopyFrom=__webpack_require__("./geom/ellipse/CopyFrom.js");Ellipse.Equals=__webpack_require__("./geom/ellipse/Equals.js");Ellipse.GetBounds=__webpack_require__("./geom/ellipse/GetBounds.js");Ellipse.GetPoint=__webpack_require__("./geom/ellipse/GetPoint.js");Ellipse.GetPoints=__webpack_require__("./geom/ellipse/GetPoints.js");Ellipse.Offset=__webpack_require__("./geom/ellipse/Offset.js");Ellipse.OffsetPoint=__webpack_require__("./geom/ellipse/OffsetPoint.js");Ellipse.Random=__webpack_require__("./geom/ellipse/Random.js");module.exports=Ellipse;}),"./geom/index.js":(function(module,exports,__webpack_require__){module.exports={Circle:__webpack_require__("./geom/circle/index.js"),Ellipse:__webpack_require__("./geom/ellipse/index.js"),Intersects:__webpack_require__("./geom/intersects/index.js"),Line:__webpack_require__("./geom/line/index.js"),Point:__webpack_require__("./geom/point/index.js"),Polygon:__webpack_require__("./geom/polygon/index.js"),Rectangle:__webpack_require__("./geom/rectangle/index.js"),Triangle:__webpack_require__("./geom/triangle/index.js")};}),"./geom/intersects/CircleToCircle.js":(function(module,exports,__webpack_require__){var DistanceBetween=__webpack_require__("./math/distance/DistanceBetween.js");var CircleToCircle=function(circleA,circleB)
    {return(DistanceBetween(circleA.x,circleA.y,circleB.x,circleB.y)<=(circleA.radius+circleB.radius));};module.exports=CircleToCircle;}),"./geom/intersects/CircleToRectangle.js":(function(module,exports){var CircleToRectangle=function(circle,rect)
    {var halfWidth=rect.width / 2;var halfHeight=rect.height / 2;var cx=Math.abs(circle.x-rect.x-halfWidth);var cy=Math.abs(circle.y-rect.y-halfHeight);var xDist=halfWidth+circle.radius;var yDist=halfHeight+circle.radius;if(cx>xDist||cy>yDist)
    {return false;}
    else if(cx<=halfWidth||cy<=halfHeight)
    {return true;}
    else
    {var xCornerDist=cx-halfWidth;var yCornerDist=cy-halfHeight;var xCornerDistSq=xCornerDist*xCornerDist;var yCornerDistSq=yCornerDist*yCornerDist;var maxCornerDistSq=circle.radius*circle.radius;return(xCornerDistSq+yCornerDistSq<=maxCornerDistSq);}};module.exports=CircleToRectangle;}),"./geom/intersects/GetRectangleIntersection.js":(function(module,exports,__webpack_require__){var Rectangle=__webpack_require__("./geom/rectangle/Rectangle.js");var RectangleToRectangle=__webpack_require__("./geom/intersects/RectangleToRectangle.js");var GetRectangleIntersection=function(rectA,rectB,output)
    {if(output===undefined){output=new Rectangle();}
        if(RectangleToRectangle(rectA,rectB))
        {output.x=Math.max(rectA.x,rectB.x);output.y=Math.max(rectA.y,rectB.y);output.width=Math.min(rectA.right,rectB.right)-output.x;output.height=Math.min(rectA.bottom,rectB.bottom)-output.y;}
        return output;};module.exports=GetRectangleIntersection;}),"./geom/intersects/LineToCircle.js":(function(module,exports,__webpack_require__){var Contains=__webpack_require__("./geom/circle/Contains.js");var Point=__webpack_require__("./geom/point/Point.js");var tmp=new Point();var LineToCircle=function(line,circle,nearest)
    {if(nearest===undefined){nearest=tmp;}
        if(Contains(circle,line.x1,line.y1))
        {nearest.x=line.x1;nearest.y=line.y1;return true;}
        if(Contains(circle,line.x2,line.y2))
        {nearest.x=line.x2;nearest.y=line.y2;return true;}
        var dx=line.x2-line.x1;var dy=line.y2-line.y1;var lcx=circle.x-line.x1;var lcy=circle.y-line.y1;var dLen2=(dx*dx)+(dy*dy);var px=dx;var py=dy;if(dLen2>0)
    {var dp=((lcx*dx)+(lcy*dy))/ dLen2;px*=dp;py*=dp;}
        nearest.x=line.x1+px;nearest.y=line.y1+py;var pLen2=(px*px)+(py*py);return(pLen2<=dLen2&&((px*dx)+(py*dy))>=0&&Contains(circle,nearest.x,nearest.y));};module.exports=LineToCircle;}),"./geom/intersects/LineToLine.js":(function(module,exports,__webpack_require__){var Point=__webpack_require__("./geom/point/Point.js");var LineToLine=function(line1,line2,out)
    {if(out===undefined){out=new Point();}
        var x1=line1.x1;var y1=line1.y1;var x2=line1.x2;var y2=line1.y2;var x3=line2.x1;var y3=line2.y1;var x4=line2.x2;var y4=line2.y2;var numA=(x4-x3)*(y1-y3)-(y4-y3)*(x1-x3);var numB=(x2-x1)*(y1-y3)-(y2-y1)*(x1-x3);var deNom=(y4-y3)*(x2-x1)-(x4-x3)*(y2-y1);if(deNom===0)
    {return false;}
        var uA=numA / deNom;var uB=numB / deNom;if(uA>=0&&uA<=1&&uB>=0&&uB<=1)
    {out.x=x1+(uA*(x2-x1));out.y=y1+(uA*(y2-y1));return true;}
        return false;};module.exports=LineToLine;}),"./geom/intersects/LineToRectangle.js":(function(module,exports){var LineToRectangle=function(line,rect)
    {var x1=line.x1;var y1=line.y1;var x2=line.x2;var y2=line.y2;var bx1=rect.x;var by1=rect.y;var bx2=rect.right;var by2=rect.bottom;var t=0;if((x1>=bx1&&x1<=bx2&&y1>=by1&&y1<=by2)||(x2>=bx1&&x2<=bx2&&y2>=by1&&y2<=by2))
    {return true;}
        if(x1<bx1&&x2>=bx1)
        {t=y1+(y2-y1)*(bx1-x1)/(x2-x1);if(t>by1&&t<=by2)
        {return true;}}
        else if(x1>bx2&&x2<=bx2)
        {t=y1+(y2-y1)*(bx2-x1)/(x2-x1);if(t>=by1&&t<=by2)
        {return true;}}
        if(y1<by1&&y2>=by1)
        {t=x1+(x2-x1)*(by1-y1)/(y2-y1);if(t>=bx1&&t<=bx2)
        {return true;}}
        else if(y1>by2&&y2<=by2)
        {t=x1+(x2-x1)*(by2-y1)/(y2-y1);if(t>=bx1&&t<=bx2)
        {return true;}}
        return false;};module.exports=LineToRectangle;}),"./geom/intersects/PointToLine.js":(function(module,exports){var PointToLine=function(point,line,lineThickness)
    {if(lineThickness===undefined){lineThickness=1;}
        var x1=line.x1;var y1=line.y1;var x2=line.x2;var y2=line.y2;var px=point.x;var py=point.y;var L2=(((x2-x1)*(x2-x1))+((y2-y1)*(y2-y1)));if(L2===0)
    {return false;}
        var r=(((px-x1)*(x2-x1))+((py-y1)*(y2-y1)))/ L2;if(r<0)
    {return(Math.sqrt(((x1-px)*(x1-px))+((y1-py)*(y1-py)))<=lineThickness);}
    else if((r>=0)&&(r<=1))
    {var s=(((y1-py)*(x2-x1))-((x1-px)*(y2-y1)))/ L2;return(Math.abs(s)*Math.sqrt(L2)<=lineThickness);}
    else
    {return(Math.sqrt(((x2-px)*(x2-px))+((y2-py)*(y2-py)))<=lineThickness);}};module.exports=PointToLine;}),"./geom/intersects/PointToLineSegment.js":(function(module,exports,__webpack_require__){var PointToLine=__webpack_require__("./geom/intersects/PointToLine.js");var PointToLineSegment=function(point,line)
    {if(!PointToLine(point,line))
    {return false;}
        var xMin=Math.min(line.x1,line.x2);var xMax=Math.max(line.x1,line.x2);var yMin=Math.min(line.y1,line.y2);var yMax=Math.max(line.y1,line.y2);return((point.x>=xMin&&point.x<=xMax)&&(point.y>=yMin&&point.y<=yMax));};module.exports=PointToLineSegment;}),"./geom/intersects/RectangleToRectangle.js":(function(module,exports){var RectangleToRectangle=function(rectA,rectB)
    {if(rectA.width<=0||rectA.height<=0||rectB.width<=0||rectB.height<=0)
    {return false;}
        return!(rectA.right<rectB.x||rectA.bottom<rectB.y||rectA.x>rectB.right||rectA.y>rectB.bottom);};module.exports=RectangleToRectangle;}),"./geom/intersects/RectangleToTriangle.js":(function(module,exports,__webpack_require__){var LineToLine=__webpack_require__("./geom/intersects/LineToLine.js");var Contains=__webpack_require__("./geom/rectangle/Contains.js");var ContainsArray=__webpack_require__("./geom/triangle/ContainsArray.js");var Decompose=__webpack_require__("./geom/rectangle/Decompose.js");var RectangleToTriangle=function(rect,triangle)
    {if(triangle.left>rect.right||triangle.right<rect.left||triangle.top>rect.bottom||triangle.bottom<rect.top)
    {return false;}
        var triA=triangle.getLineA();var triB=triangle.getLineB();var triC=triangle.getLineC();if(Contains(rect,triA.x1,triA.y1)||Contains(rect,triA.x2,triA.y2))
    {return true;}
        if(Contains(rect,triB.x1,triB.y1)||Contains(rect,triB.x2,triB.y2))
        {return true;}
        if(Contains(rect,triC.x1,triC.y1)||Contains(rect,triC.x2,triC.y2))
        {return true;}
        var rectA=rect.getLineA();var rectB=rect.getLineB();var rectC=rect.getLineC();var rectD=rect.getLineD();if(LineToLine(triA,rectA)||LineToLine(triA,rectB)||LineToLine(triA,rectC)||LineToLine(triA,rectD))
    {return true;}
        if(LineToLine(triB,rectA)||LineToLine(triB,rectB)||LineToLine(triB,rectC)||LineToLine(triB,rectD))
        {return true;}
        if(LineToLine(triC,rectA)||LineToLine(triC,rectB)||LineToLine(triC,rectC)||LineToLine(triC,rectD))
        {return true;}
        var points=Decompose(rect);var within=ContainsArray(triangle,points,true);return(within.length>0);};module.exports=RectangleToTriangle;}),"./geom/intersects/RectangleToValues.js":(function(module,exports){var RectangleToValues=function(rect,left,right,top,bottom,tolerance)
    {if(tolerance===undefined){tolerance=0;}
        return!(left>rect.right+tolerance||right<rect.left-tolerance||top>rect.bottom+tolerance||bottom<rect.top-tolerance);};module.exports=RectangleToValues;}),"./geom/intersects/TriangleToCircle.js":(function(module,exports,__webpack_require__){var LineToCircle=__webpack_require__("./geom/intersects/LineToCircle.js");var Contains=__webpack_require__("./geom/triangle/Contains.js");var TriangleToCircle=function(triangle,circle)
    {if(triangle.left>circle.right||triangle.right<circle.left||triangle.top>circle.bottom||triangle.bottom<circle.top)
    {return false;}
        if(Contains(triangle,circle.x,circle.y))
        {return true;}
        if(LineToCircle(triangle.getLineA(),circle))
        {return true;}
        if(LineToCircle(triangle.getLineB(),circle))
        {return true;}
        if(LineToCircle(triangle.getLineC(),circle))
        {return true;}
        return false;};module.exports=TriangleToCircle;}),"./geom/intersects/TriangleToLine.js":(function(module,exports,__webpack_require__){var Contains=__webpack_require__("./geom/triangle/Contains.js");var LineToLine=__webpack_require__("./geom/intersects/LineToLine.js");var TriangleToLine=function(triangle,line)
    {if(Contains(triangle,line.getPointA())||Contains(triangle,line.getPointB()))
    {return true;}
        if(LineToLine(triangle.getLineA(),line))
        {return true;}
        if(LineToLine(triangle.getLineB(),line))
        {return true;}
        if(LineToLine(triangle.getLineC(),line))
        {return true;}
        return false;};module.exports=TriangleToLine;}),"./geom/intersects/TriangleToTriangle.js":(function(module,exports,__webpack_require__){var ContainsArray=__webpack_require__("./geom/triangle/ContainsArray.js");var Decompose=__webpack_require__("./geom/triangle/Decompose.js");var LineToLine=__webpack_require__("./geom/intersects/LineToLine.js");var TriangleToTriangle=function(triangleA,triangleB)
    {if(triangleA.left>triangleB.right||triangleA.right<triangleB.left||triangleA.top>triangleB.bottom||triangleA.bottom<triangleB.top)
    {return false;}
        var lineAA=triangleA.getLineA();var lineAB=triangleA.getLineB();var lineAC=triangleA.getLineC();var lineBA=triangleB.getLineA();var lineBB=triangleB.getLineB();var lineBC=triangleB.getLineC();if(LineToLine(lineAA,lineBA)||LineToLine(lineAA,lineBB)||LineToLine(lineAA,lineBC))
    {return true;}
        if(LineToLine(lineAB,lineBA)||LineToLine(lineAB,lineBB)||LineToLine(lineAB,lineBC))
        {return true;}
        if(LineToLine(lineAC,lineBA)||LineToLine(lineAC,lineBB)||LineToLine(lineAC,lineBC))
        {return true;}
        var points=Decompose(triangleA);var within=ContainsArray(triangleB,points,true);if(within.length>0)
    {return true;}
        points=Decompose(triangleB);within=ContainsArray(triangleA,points,true);if(within.length>0)
    {return true;}
        return false;};module.exports=TriangleToTriangle;}),"./geom/intersects/index.js":(function(module,exports,__webpack_require__){module.exports={CircleToCircle:__webpack_require__("./geom/intersects/CircleToCircle.js"),CircleToRectangle:__webpack_require__("./geom/intersects/CircleToRectangle.js"),GetRectangleIntersection:__webpack_require__("./geom/intersects/GetRectangleIntersection.js"),LineToCircle:__webpack_require__("./geom/intersects/LineToCircle.js"),LineToLine:__webpack_require__("./geom/intersects/LineToLine.js"),LineToRectangle:__webpack_require__("./geom/intersects/LineToRectangle.js"),PointToLine:__webpack_require__("./geom/intersects/PointToLine.js"),PointToLineSegment:__webpack_require__("./geom/intersects/PointToLineSegment.js"),RectangleToRectangle:__webpack_require__("./geom/intersects/RectangleToRectangle.js"),RectangleToTriangle:__webpack_require__("./geom/intersects/RectangleToTriangle.js"),RectangleToValues:__webpack_require__("./geom/intersects/RectangleToValues.js"),TriangleToCircle:__webpack_require__("./geom/intersects/TriangleToCircle.js"),TriangleToLine:__webpack_require__("./geom/intersects/TriangleToLine.js"),TriangleToTriangle:__webpack_require__("./geom/intersects/TriangleToTriangle.js")};}),"./geom/line/Angle.js":(function(module,exports){var Angle=function(line)
    {return Math.atan2(line.y2-line.y1,line.x2-line.x1);};module.exports=Angle;}),"./geom/line/BresenhamPoints.js":(function(module,exports){var BresenhamPoints=function(line,stepRate,results)
    {if(stepRate===undefined){stepRate=1;}
        if(results===undefined){results=[];}
        var x1=Math.round(line.x1);var y1=Math.round(line.y1);var x2=Math.round(line.x2);var y2=Math.round(line.y2);var dx=Math.abs(x2-x1);var dy=Math.abs(y2-y1);var sx=(x1<x2)?1:-1;var sy=(y1<y2)?1:-1;var err=dx-dy;results.push({x:x1,y:y1});var i=1;while(!((x1===x2)&&(y1===y2)))
    {var e2=err<<1;if(e2>-dy)
    {err-=dy;x1+=sx;}
        if(e2<dx)
        {err+=dx;y1+=sy;}
        if(i%stepRate===0)
        {results.push({x:x1,y:y1});}
        i++;}
        return results;};module.exports=BresenhamPoints;}),"./geom/line/CenterOn.js":(function(module,exports){var CenterOn=function(line,x,y)
    {var tx=x-((line.x1+line.x2)/ 2);var ty=y-((line.y1+line.y2)/ 2);line.x1+=tx;line.y1+=ty;line.x2+=tx;line.y2+=ty;return line;};module.exports=CenterOn;}),"./geom/line/Clone.js":(function(module,exports,__webpack_require__){var Line=__webpack_require__("./geom/line/Line.js");var Clone=function(source)
    {return new Line(source.x1,source.y1,source.x2,source.y2);};module.exports=Clone;}),"./geom/line/CopyFrom.js":(function(module,exports){var CopyFrom=function(source,dest)
    {return dest.setTo(source.x1,source.y1,source.x2,source.y2);};module.exports=CopyFrom;}),"./geom/line/Equals.js":(function(module,exports){var Equals=function(line,toCompare)
    {return(line.x1===toCompare.x1&&line.y1===toCompare.y1&&line.x2===toCompare.x2&&line.y2===toCompare.y2);};module.exports=Equals;}),"./geom/line/Extend.js":(function(module,exports,__webpack_require__){var Length=__webpack_require__("./geom/line/Length.js");var Extend=function(line,left,right)
    {if(right===undefined){right=left;}
        var length=Length(line);var slopX=line.x2-line.x1;var slopY=line.y2-line.y1;if(left)
    {line.x1=line.x1-slopX / length*left;line.y1=line.y1-slopY / length*left;}
        if(right)
        {line.x2=line.x2+slopX / length*right;line.y2=line.y2+slopY / length*right;}
        return line;};module.exports=Extend;}),"./geom/line/GetMidPoint.js":(function(module,exports,__webpack_require__){var Point=__webpack_require__("./geom/point/Point.js");var GetMidPoint=function(line,out)
    {if(out===undefined){out=new Point();}
        out.x=(line.x1+line.x2)/ 2;out.y=(line.y1+line.y2)/ 2;return out;};module.exports=GetMidPoint;}),"./geom/line/GetNearestPoint.js":(function(module,exports,__webpack_require__){var Point=__webpack_require__("./geom/point/Point.js");var GetNearestPoint=function(line,point,out)
    {if(out===undefined){out=new Point();}
        var x1=line.x1;var y1=line.y1;var x2=line.x2;var y2=line.y2;var L2=(((x2-x1)*(x2-x1))+((y2-y1)*(y2-y1)));if(L2===0)
    {return out;}
        var r=(((point.x-x1)*(x2-x1))+((point.y-y1)*(y2-y1)))/ L2;out.x=x1+(r*(x2-x1));out.y=y1+(r*(y2-y1));return out;};module.exports=GetNearestPoint;}),"./geom/line/GetNormal.js":(function(module,exports,__webpack_require__){var MATH_CONST=__webpack_require__("./math/const.js");var Angle=__webpack_require__("./geom/line/Angle.js");var Point=__webpack_require__("./geom/point/Point.js");var GetNormal=function(line,out)
    {if(out===undefined){out=new Point();}
        var a=Angle(line)-MATH_CONST.TAU;out.x=Math.cos(a);out.y=Math.sin(a);return out;};module.exports=GetNormal;}),"./geom/line/GetPoint.js":(function(module,exports,__webpack_require__){var Point=__webpack_require__("./geom/point/Point.js");var GetPoint=function(line,position,out)
    {if(out===undefined){out=new Point();}
        out.x=line.x1+(line.x2-line.x1)*position;out.y=line.y1+(line.y2-line.y1)*position;return out;};module.exports=GetPoint;}),"./geom/line/GetPoints.js":(function(module,exports,__webpack_require__){var Length=__webpack_require__("./geom/line/Length.js");var Point=__webpack_require__("./geom/point/Point.js");var GetPoints=function(line,quantity,stepRate,out)
    {if(out===undefined){out=[];}
        if(!quantity)
        {quantity=Length(line)/ stepRate;}
        var x1=line.x1;var y1=line.y1;var x2=line.x2;var y2=line.y2;for(var i=0;i<quantity;i++)
    {var position=i / quantity;var x=x1+(x2-x1)*position;var y=y1+(y2-y1)*position;out.push(new Point(x,y));}
        return out;};module.exports=GetPoints;}),"./geom/line/GetShortestDistance.js":(function(module,exports){var GetShortestDistance=function(line,point)
    {var x1=line.x1;var y1=line.y1;var x2=line.x2;var y2=line.y2;var L2=(((x2-x1)*(x2-x1))+((y2-y1)*(y2-y1)));if(L2===0)
    {return false;}
        var s=(((y1-point.y)*(x2-x1))-((x1-point.x)*(y2-y1)))/ L2;return Math.abs(s)*Math.sqrt(L2);};module.exports=GetShortestDistance;}),"./geom/line/Height.js":(function(module,exports){var Height=function(line)
    {return Math.abs(line.y1-line.y2);};module.exports=Height;}),"./geom/line/Length.js":(function(module,exports){var Length=function(line)
    {return Math.sqrt((line.x2-line.x1)*(line.x2-line.x1)+(line.y2-line.y1)*(line.y2-line.y1));};module.exports=Length;}),"./geom/line/Line.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var GetPoint=__webpack_require__("./geom/line/GetPoint.js");var GetPoints=__webpack_require__("./geom/line/GetPoints.js");var Random=__webpack_require__("./geom/line/Random.js");var Vector2=__webpack_require__("./math/Vector2.js");var Line=new Class({initialize:function Line(x1,y1,x2,y2)
        {if(x1===undefined){x1=0;}
            if(y1===undefined){y1=0;}
            if(x2===undefined){x2=0;}
            if(y2===undefined){y2=0;}
            this.x1=x1;this.y1=y1;this.x2=x2;this.y2=y2;},getPoint:function(position,output)
        {return GetPoint(this,position,output);},getPoints:function(quantity,stepRate,output)
        {return GetPoints(this,quantity,stepRate,output);},getRandomPoint:function(point)
        {return Random(this,point);},setTo:function(x1,y1,x2,y2)
        {if(x1===undefined){x1=0;}
            if(y1===undefined){y1=0;}
            if(x2===undefined){x2=0;}
            if(y2===undefined){y2=0;}
            this.x1=x1;this.y1=y1;this.x2=x2;this.y2=y2;return this;},getPointA:function(vec2)
        {if(vec2===undefined){vec2=new Vector2();}
            vec2.set(this.x1,this.y1);return vec2;},getPointB:function(vec2)
        {if(vec2===undefined){vec2=new Vector2();}
            vec2.set(this.x2,this.y2);return vec2;},left:{get:function()
            {return Math.min(this.x1,this.x2);},set:function(value)
            {if(this.x1<=this.x2)
            {this.x1=value;}
            else
            {this.x2=value;}}},right:{get:function()
            {return Math.max(this.x1,this.x2);},set:function(value)
            {if(this.x1>this.x2)
            {this.x1=value;}
            else
            {this.x2=value;}}},top:{get:function()
            {return Math.min(this.y1,this.y2);},set:function(value)
            {if(this.y1<=this.y2)
            {this.y1=value;}
            else
            {this.y2=value;}}},bottom:{get:function()
            {return Math.max(this.y1,this.y2);},set:function(value)
            {if(this.y1>this.y2)
            {this.y1=value;}
            else
            {this.y2=value;}}}});module.exports=Line;}),"./geom/line/NormalAngle.js":(function(module,exports,__webpack_require__){var MATH_CONST=__webpack_require__("./math/const.js");var Wrap=__webpack_require__("./math/Wrap.js");var Angle=__webpack_require__("./geom/line/Angle.js");var NormalAngle=function(line)
    {var angle=Angle(line)-MATH_CONST.TAU;return Wrap(angle,-Math.PI,Math.PI);};module.exports=NormalAngle;}),"./geom/line/NormalX.js":(function(module,exports,__webpack_require__){var MATH_CONST=__webpack_require__("./math/const.js");var Angle=__webpack_require__("./geom/line/Angle.js");var NormalX=function(line)
    {return Math.cos(Angle(line)-MATH_CONST.TAU);};module.exports=NormalX;}),"./geom/line/NormalY.js":(function(module,exports,__webpack_require__){var MATH_CONST=__webpack_require__("./math/const.js");var Angle=__webpack_require__("./geom/line/Angle.js");var NormalY=function(line)
    {return Math.sin(Angle(line)-MATH_CONST.TAU);};module.exports=NormalY;}),"./geom/line/Offset.js":(function(module,exports){var Offset=function(line,x,y)
    {line.x1+=x;line.y1+=y;line.x2+=x;line.y2+=y;return line;};module.exports=Offset;}),"./geom/line/PerpSlope.js":(function(module,exports){var PerpSlope=function(line)
    {return-((line.x2-line.x1)/(line.y2-line.y1));};module.exports=PerpSlope;}),"./geom/line/Random.js":(function(module,exports,__webpack_require__){var Point=__webpack_require__("./geom/point/Point.js");var Random=function(line,out)
    {if(out===undefined){out=new Point();}
        var t=Math.random();out.x=line.x1+t*(line.x2-line.x1);out.y=line.y1+t*(line.y2-line.y1);return out;};module.exports=Random;}),"./geom/line/ReflectAngle.js":(function(module,exports,__webpack_require__){var Angle=__webpack_require__("./geom/line/Angle.js");var NormalAngle=__webpack_require__("./geom/line/NormalAngle.js");var ReflectAngle=function(lineA,lineB)
    {return(2*NormalAngle(lineB)-Math.PI-Angle(lineA));};module.exports=ReflectAngle;}),"./geom/line/Rotate.js":(function(module,exports,__webpack_require__){var RotateAroundXY=__webpack_require__("./geom/line/RotateAroundXY.js");var Rotate=function(line,angle)
    {var x=(line.x1+line.x2)/ 2;var y=(line.y1+line.y2)/ 2;return RotateAroundXY(line,x,y,angle);};module.exports=Rotate;}),"./geom/line/RotateAroundPoint.js":(function(module,exports,__webpack_require__){var RotateAroundXY=__webpack_require__("./geom/line/RotateAroundXY.js");var RotateAroundPoint=function(line,point,angle)
    {return RotateAroundXY(line,point.x,point.y,angle);};module.exports=RotateAroundPoint;}),"./geom/line/RotateAroundXY.js":(function(module,exports){var RotateAroundXY=function(line,x,y,angle)
    {var c=Math.cos(angle);var s=Math.sin(angle);var tx=line.x1-x;var ty=line.y1-y;line.x1=tx*c-ty*s+x;line.y1=tx*s+ty*c+y;tx=line.x2-x;ty=line.y2-y;line.x2=tx*c-ty*s+x;line.y2=tx*s+ty*c+y;return line;};module.exports=RotateAroundXY;}),"./geom/line/SetToAngle.js":(function(module,exports){var SetToAngle=function(line,x,y,angle,length)
    {line.x1=x;line.y1=y;line.x2=x+(Math.cos(angle)*length);line.y2=y+(Math.sin(angle)*length);return line;};module.exports=SetToAngle;}),"./geom/line/Slope.js":(function(module,exports){var Slope=function(line)
    {return(line.y2-line.y1)/(line.x2-line.x1);};module.exports=Slope;}),"./geom/line/Width.js":(function(module,exports){var Width=function(line)
    {return Math.abs(line.x1-line.x2);};module.exports=Width;}),"./geom/line/index.js":(function(module,exports,__webpack_require__){var Line=__webpack_require__("./geom/line/Line.js");Line.Angle=__webpack_require__("./geom/line/Angle.js");Line.BresenhamPoints=__webpack_require__("./geom/line/BresenhamPoints.js");Line.CenterOn=__webpack_require__("./geom/line/CenterOn.js");Line.Clone=__webpack_require__("./geom/line/Clone.js");Line.CopyFrom=__webpack_require__("./geom/line/CopyFrom.js");Line.Equals=__webpack_require__("./geom/line/Equals.js");Line.Extend=__webpack_require__("./geom/line/Extend.js");Line.GetMidPoint=__webpack_require__("./geom/line/GetMidPoint.js");Line.GetNearestPoint=__webpack_require__("./geom/line/GetNearestPoint.js");Line.GetNormal=__webpack_require__("./geom/line/GetNormal.js");Line.GetPoint=__webpack_require__("./geom/line/GetPoint.js");Line.GetPoints=__webpack_require__("./geom/line/GetPoints.js");Line.GetShortestDistance=__webpack_require__("./geom/line/GetShortestDistance.js");Line.Height=__webpack_require__("./geom/line/Height.js");Line.Length=__webpack_require__("./geom/line/Length.js");Line.NormalAngle=__webpack_require__("./geom/line/NormalAngle.js");Line.NormalX=__webpack_require__("./geom/line/NormalX.js");Line.NormalY=__webpack_require__("./geom/line/NormalY.js");Line.Offset=__webpack_require__("./geom/line/Offset.js");Line.PerpSlope=__webpack_require__("./geom/line/PerpSlope.js");Line.Random=__webpack_require__("./geom/line/Random.js");Line.ReflectAngle=__webpack_require__("./geom/line/ReflectAngle.js");Line.Rotate=__webpack_require__("./geom/line/Rotate.js");Line.RotateAroundPoint=__webpack_require__("./geom/line/RotateAroundPoint.js");Line.RotateAroundXY=__webpack_require__("./geom/line/RotateAroundXY.js");Line.SetToAngle=__webpack_require__("./geom/line/SetToAngle.js");Line.Slope=__webpack_require__("./geom/line/Slope.js");Line.Width=__webpack_require__("./geom/line/Width.js");module.exports=Line;}),"./geom/point/Ceil.js":(function(module,exports){var Ceil=function(point)
    {return point.setTo(Math.ceil(point.x),Math.ceil(point.y));};module.exports=Ceil;}),"./geom/point/Clone.js":(function(module,exports,__webpack_require__){var Point=__webpack_require__("./geom/point/Point.js");var Clone=function(source)
    {return new Point(source.x,source.y);};module.exports=Clone;}),"./geom/point/CopyFrom.js":(function(module,exports){var CopyFrom=function(source,dest)
    {return dest.setTo(source.x,source.y);};module.exports=CopyFrom;}),"./geom/point/Equals.js":(function(module,exports){var Equals=function(point,toCompare)
    {return(point.x===toCompare.x&&point.y===toCompare.y);};module.exports=Equals;}),"./geom/point/Floor.js":(function(module,exports){var Floor=function(point)
    {return point.setTo(Math.floor(point.x),Math.floor(point.y));};module.exports=Floor;}),"./geom/point/GetCentroid.js":(function(module,exports,__webpack_require__){var Point=__webpack_require__("./geom/point/Point.js");var GetCentroid=function(points,out)
    {if(out===undefined){out=new Point();}
        if(!Array.isArray(points))
        {throw new Error('GetCentroid points argument must be an array');}
        var len=points.length;if(len<1)
    {throw new Error('GetCentroid points array must not be empty');}
    else if(len===1)
    {out.x=points[0].x;out.y=points[0].y;}
    else
    {for(var i=0;i<len;i++)
    {out.x+=points[i].x;out.y+=points[i].y;}
        out.x /=len;out.y /=len;}
        return out;};module.exports=GetCentroid;}),"./geom/point/GetMagnitude.js":(function(module,exports){var GetMagnitude=function(point)
    {return Math.sqrt((point.x*point.x)+(point.y*point.y));};module.exports=GetMagnitude;}),"./geom/point/GetMagnitudeSq.js":(function(module,exports){var GetMagnitudeSq=function(point)
    {return(point.x*point.x)+(point.y*point.y);};module.exports=GetMagnitudeSq;}),"./geom/point/GetRectangleFromPoints.js":(function(module,exports,__webpack_require__){var Rectangle=__webpack_require__("./geom/rectangle/Rectangle.js");var GetRectangleFromPoints=function(points,out)
    {if(out===undefined){out=new Rectangle();}
        var xMax=Number.NEGATIVE_INFINITY;var xMin=Number.POSITIVE_INFINITY;var yMax=Number.NEGATIVE_INFINITY;var yMin=Number.POSITIVE_INFINITY;for(var i=0;i<points.length;i++)
    {var point=points[i];if(point.x>xMax)
    {xMax=point.x;}
        if(point.x<xMin)
        {xMin=point.x;}
        if(point.y>yMax)
        {yMax=point.y;}
        if(point.y<yMin)
        {yMin=point.y;}}
        out.x=xMin;out.y=yMin;out.width=xMax-xMin;out.height=yMax-yMin;return out;};module.exports=GetRectangleFromPoints;}),"./geom/point/Interpolate.js":(function(module,exports,__webpack_require__){var Point=__webpack_require__("./geom/point/Point.js");var Interpolate=function(pointA,pointB,t,out)
    {if(t===undefined){t=0;}
        if(out===undefined){out=new Point();}
        out.x=pointA.x+((pointB.x-pointA.x)*t);out.y=pointA.y+((pointB.y-pointA.y)*t);return out;};module.exports=Interpolate;}),"./geom/point/Invert.js":(function(module,exports){var Invert=function(point)
    {return point.setTo(point.y,point.x);};module.exports=Invert;}),"./geom/point/Negative.js":(function(module,exports,__webpack_require__){var Point=__webpack_require__("./geom/point/Point.js");var Negative=function(point,out)
    {if(out===undefined){out=new Point();}
        return out.setTo(-point.x,-point.y);};module.exports=Negative;}),"./geom/point/Point.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Point=new Class({initialize:function Point(x,y)
        {if(x===undefined){x=0;}
            if(y===undefined){y=x;}
            this.x=x;this.y=y;},setTo:function(x,y)
        {if(x===undefined){x=0;}
            if(y===undefined){y=x;}
            this.x=x;this.y=y;return this;}});module.exports=Point;}),"./geom/point/Project.js":(function(module,exports,__webpack_require__){var Point=__webpack_require__("./geom/point/Point.js");var GetMagnitudeSq=__webpack_require__("./geom/point/GetMagnitudeSq.js");var Project=function(pointA,pointB,out)
    {if(out===undefined){out=new Point();}
        var dot=((pointA.x*pointB.x)+(pointA.y*pointB.y));var amt=dot / GetMagnitudeSq(pointB);if(amt!==0)
    {out.x=amt*pointB.x;out.y=amt*pointB.y;}
        return out;};module.exports=Project;}),"./geom/point/ProjectUnit.js":(function(module,exports,__webpack_require__){var Point=__webpack_require__("./geom/point/Point.js");var ProjectUnit=function(pointA,pointB,out)
    {if(out===undefined){out=new Point();}
        var amt=((pointA.x*pointB.x)+(pointA.y*pointB.y));if(amt!==0)
    {out.x=amt*pointB.x;out.y=amt*pointB.y;}
        return out;};module.exports=ProjectUnit;}),"./geom/point/SetMagnitude.js":(function(module,exports,__webpack_require__){var GetMagnitude=__webpack_require__("./geom/point/GetMagnitude.js");var SetMagnitude=function(point,magnitude)
    {if(point.x!==0||point.y!==0)
    {var m=GetMagnitude(point);point.x /=m;point.y /=m;}
        point.x*=magnitude;point.y*=magnitude;return point;};module.exports=SetMagnitude;}),"./geom/point/index.js":(function(module,exports,__webpack_require__){var Point=__webpack_require__("./geom/point/Point.js");Point.Ceil=__webpack_require__("./geom/point/Ceil.js");Point.Clone=__webpack_require__("./geom/point/Clone.js");Point.CopyFrom=__webpack_require__("./geom/point/CopyFrom.js");Point.Equals=__webpack_require__("./geom/point/Equals.js");Point.Floor=__webpack_require__("./geom/point/Floor.js");Point.GetCentroid=__webpack_require__("./geom/point/GetCentroid.js");Point.GetMagnitude=__webpack_require__("./geom/point/GetMagnitude.js");Point.GetMagnitudeSq=__webpack_require__("./geom/point/GetMagnitudeSq.js");Point.GetRectangleFromPoints=__webpack_require__("./geom/point/GetRectangleFromPoints.js");Point.Interpolate=__webpack_require__("./geom/point/Interpolate.js");Point.Invert=__webpack_require__("./geom/point/Invert.js");Point.Negative=__webpack_require__("./geom/point/Negative.js");Point.Project=__webpack_require__("./geom/point/Project.js");Point.ProjectUnit=__webpack_require__("./geom/point/ProjectUnit.js");Point.SetMagnitude=__webpack_require__("./geom/point/SetMagnitude.js");module.exports=Point;}),"./geom/polygon/Clone.js":(function(module,exports,__webpack_require__){var Polygon=__webpack_require__("./geom/polygon/Polygon.js");var Clone=function(polygon)
    {return new Polygon(polygon.points);};module.exports=Clone;}),"./geom/polygon/Contains.js":(function(module,exports){var Contains=function(polygon,x,y)
    {var inside=false;for(var i=-1,j=polygon.points.length-1;++i<polygon.points.length;j=i)
    {var ix=polygon.points[i].x;var iy=polygon.points[i].y;var jx=polygon.points[j].x;var jy=polygon.points[j].y;if(((iy<=y&&y<jy)||(jy<=y&&y<iy))&&(x<(jx-ix)*(y-iy)/(jy-iy)+ix))
    {inside=!inside;}}
        return inside;};module.exports=Contains;}),"./geom/polygon/ContainsPoint.js":(function(module,exports,__webpack_require__){var Contains=__webpack_require__("./geom/polygon/Contains.js");var ContainsPoint=function(polygon,point)
    {return Contains(polygon,point.x,point.y);};module.exports=ContainsPoint;}),"./geom/polygon/Earcut.js":(function(module,exports,__webpack_require__){"use strict";module.exports=earcut;function earcut(data,holeIndices,dim){dim=dim||2;var hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=linkedList(data,0,outerLen,dim,true),triangles=[];if(!outerNode||outerNode.next===outerNode.prev)return triangles;var minX,minY,maxX,maxY,x,y,invSize;if(hasHoles)outerNode=eliminateHoles(data,holeIndices,outerNode,dim);if(data.length>80*dim){minX=maxX=data[0];minY=maxY=data[1];for(var i=dim;i<outerLen;i+=dim){x=data[i];y=data[i+1];if(x<minX)minX=x;if(y<minY)minY=y;if(x>maxX)maxX=x;if(y>maxY)maxY=y;}
        invSize=Math.max(maxX-minX,maxY-minY);invSize=invSize!==0?1 / invSize:0;}
        earcutLinked(outerNode,triangles,dim,minX,minY,invSize);return triangles;}
        function linkedList(data,start,end,dim,clockwise){var i,last;if(clockwise===(signedArea(data,start,end,dim)>0)){for(i=start;i<end;i+=dim)last=insertNode(i,data[i],data[i+1],last);}else{for(i=end-dim;i>=start;i-=dim)last=insertNode(i,data[i],data[i+1],last);}
            if(last&&equals(last,last.next)){removeNode(last);last=last.next;}
            return last;}
        function filterPoints(start,end){if(!start)return start;if(!end)end=start;var p=start,again;do{again=false;if(!p.steiner&&(equals(p,p.next)||area(p.prev,p,p.next)===0)){removeNode(p);p=end=p.prev;if(p===p.next)break;again=true;}else{p=p.next;}}while(again||p!==end);return end;}
        function earcutLinked(ear,triangles,dim,minX,minY,invSize,pass){if(!ear)return;if(!pass&&invSize)indexCurve(ear,minX,minY,invSize);var stop=ear,prev,next;while(ear.prev!==ear.next){prev=ear.prev;next=ear.next;if(invSize?isEarHashed(ear,minX,minY,invSize):isEar(ear)){triangles.push(prev.i / dim);triangles.push(ear.i / dim);triangles.push(next.i / dim);removeNode(ear);ear=next.next;stop=next.next;continue;}
            ear=next;if(ear===stop){if(!pass){earcutLinked(filterPoints(ear),triangles,dim,minX,minY,invSize,1);}else if(pass===1){ear=cureLocalIntersections(ear,triangles,dim);earcutLinked(ear,triangles,dim,minX,minY,invSize,2);}else if(pass===2){splitEarcut(ear,triangles,dim,minX,minY,invSize);}
                break;}}}
        function isEar(ear){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return false;var p=ear.next.next;while(p!==ear.prev){if(pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.next;}
            return true;}
        function isEarHashed(ear,minX,minY,invSize){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return false;var minTX=a.x<b.x?(a.x<c.x?a.x:c.x):(b.x<c.x?b.x:c.x),minTY=a.y<b.y?(a.y<c.y?a.y:c.y):(b.y<c.y?b.y:c.y),maxTX=a.x>b.x?(a.x>c.x?a.x:c.x):(b.x>c.x?b.x:c.x),maxTY=a.y>b.y?(a.y>c.y?a.y:c.y):(b.y>c.y?b.y:c.y);var minZ=zOrder(minTX,minTY,minX,minY,invSize),maxZ=zOrder(maxTX,maxTY,minX,minY,invSize);var p=ear.prevZ,n=ear.nextZ;while(p&&p.z>=minZ&&n&&n.z<=maxZ){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.prevZ;if(n!==ear.prev&&n!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,n.x,n.y)&&area(n.prev,n,n.next)>=0)return false;n=n.nextZ;}
            while(p&&p.z>=minZ){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.prevZ;}
            while(n&&n.z<=maxZ){if(n!==ear.prev&&n!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,n.x,n.y)&&area(n.prev,n,n.next)>=0)return false;n=n.nextZ;}
            return true;}
        function cureLocalIntersections(start,triangles,dim){var p=start;do{var a=p.prev,b=p.next.next;if(!equals(a,b)&&intersects(a,p,p.next,b)&&locallyInside(a,b)&&locallyInside(b,a)){triangles.push(a.i / dim);triangles.push(p.i / dim);triangles.push(b.i / dim);removeNode(p);removeNode(p.next);p=start=b;}
            p=p.next;}while(p!==start);return p;}
        function splitEarcut(start,triangles,dim,minX,minY,invSize){var a=start;do{var b=a.next.next;while(b!==a.prev){if(a.i!==b.i&&isValidDiagonal(a,b)){var c=splitPolygon(a,b);a=filterPoints(a,a.next);c=filterPoints(c,c.next);earcutLinked(a,triangles,dim,minX,minY,invSize);earcutLinked(c,triangles,dim,minX,minY,invSize);return;}
            b=b.next;}
            a=a.next;}while(a!==start);}
        function eliminateHoles(data,holeIndices,outerNode,dim){var queue=[],i,len,start,end,list;for(i=0,len=holeIndices.length;i<len;i++){start=holeIndices[i]*dim;end=i<len-1?holeIndices[i+1]*dim:data.length;list=linkedList(data,start,end,dim,false);if(list===list.next)list.steiner=true;queue.push(getLeftmost(list));}
            queue.sort(compareX);for(i=0;i<queue.length;i++){eliminateHole(queue[i],outerNode);outerNode=filterPoints(outerNode,outerNode.next);}
            return outerNode;}
        function compareX(a,b){return a.x-b.x;}
        function eliminateHole(hole,outerNode){outerNode=findHoleBridge(hole,outerNode);if(outerNode){var b=splitPolygon(outerNode,hole);filterPoints(b,b.next);}}
        function findHoleBridge(hole,outerNode){var p=outerNode,hx=hole.x,hy=hole.y,qx=-Infinity,m;do{if(hy<=p.y&&hy>=p.next.y&&p.next.y!==p.y){var x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x<=hx&&x>qx){qx=x;if(x===hx){if(hy===p.y)return p;if(hy===p.next.y)return p.next;}
            m=p.x<p.next.x?p:p.next;}}
            p=p.next;}while(p!==outerNode);if(!m)return null;if(hx===qx)return m.prev;var stop=m,mx=m.x,my=m.y,tanMin=Infinity,tan;p=m.next;while(p!==stop){if(hx>=p.x&&p.x>=mx&&hx!==p.x&&pointInTriangle(hy<my?hx:qx,hy,mx,my,hy<my?qx:hx,hy,p.x,p.y)){tan=Math.abs(hy-p.y)/(hx-p.x);if((tan<tanMin||(tan===tanMin&&p.x>m.x))&&locallyInside(p,hole)){m=p;tanMin=tan;}}
            p=p.next;}
            return m;}
        function indexCurve(start,minX,minY,invSize){var p=start;do{if(p.z===null)p.z=zOrder(p.x,p.y,minX,minY,invSize);p.prevZ=p.prev;p.nextZ=p.next;p=p.next;}while(p!==start);p.prevZ.nextZ=null;p.prevZ=null;sortLinked(p);}
        function sortLinked(list){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{p=list;list=null;tail=null;numMerges=0;while(p){numMerges++;q=p;pSize=0;for(i=0;i<inSize;i++){pSize++;q=q.nextZ;if(!q)break;}
            qSize=inSize;while(pSize>0||(qSize>0&&q)){if(pSize!==0&&(qSize===0||!q||p.z<=q.z)){e=p;p=p.nextZ;pSize--;}else{e=q;q=q.nextZ;qSize--;}
                if(tail)tail.nextZ=e;else list=e;e.prevZ=tail;tail=e;}
            p=q;}
            tail.nextZ=null;inSize*=2;}while(numMerges>1);return list;}
        function zOrder(x,y,minX,minY,invSize){x=32767*(x-minX)*invSize;y=32767*(y-minY)*invSize;x=(x|(x<<8))&0x00FF00FF;x=(x|(x<<4))&0x0F0F0F0F;x=(x|(x<<2))&0x33333333;x=(x|(x<<1))&0x55555555;y=(y|(y<<8))&0x00FF00FF;y=(y|(y<<4))&0x0F0F0F0F;y=(y|(y<<2))&0x33333333;y=(y|(y<<1))&0x55555555;return x|(y<<1);}
        function getLeftmost(start){var p=start,leftmost=start;do{if(p.x<leftmost.x)leftmost=p;p=p.next;}while(p!==start);return leftmost;}
        function pointInTriangle(ax,ay,bx,by,cx,cy,px,py){return(cx-px)*(ay-py)-(ax-px)*(cy-py)>=0&&(ax-px)*(by-py)-(bx-px)*(ay-py)>=0&&(bx-px)*(cy-py)-(cx-px)*(by-py)>=0;}
        function isValidDiagonal(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!intersectsPolygon(a,b)&&locallyInside(a,b)&&locallyInside(b,a)&&middleInside(a,b);}
        function area(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y);}
        function equals(p1,p2){return p1.x===p2.x&&p1.y===p2.y;}
        function intersects(p1,q1,p2,q2){if((equals(p1,q1)&&equals(p2,q2))||(equals(p1,q2)&&equals(p2,q1)))return true;return area(p1,q1,p2)>0!==area(p1,q1,q2)>0&&area(p2,q2,p1)>0!==area(p2,q2,q1)>0;}
        function intersectsPolygon(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&intersects(p,p.next,a,b))return true;p=p.next;}while(p!==a);return false;}
        function locallyInside(a,b){return area(a.prev,a,a.next)<0?area(a,b,a.next)>=0&&area(a,a.prev,b)>=0:area(a,b,a.prev)<0||area(a,a.next,b)<0;}
        function middleInside(a,b){var p=a,inside=false,px=(a.x+b.x)/ 2,py=(a.y+b.y)/ 2;do{if(((p.y>py)!==(p.next.y>py))&&p.next.y!==p.y&&(px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x))
            inside=!inside;p=p.next;}while(p!==a);return inside;}
        function splitPolygon(a,b){var a2=new Node(a.i,a.x,a.y),b2=new Node(b.i,b.x,b.y),an=a.next,bp=b.prev;a.next=b;b.prev=a;a2.next=an;an.prev=a2;b2.next=a2;a2.prev=b2;bp.next=b2;b2.prev=bp;return b2;}
        function insertNode(i,x,y,last){var p=new Node(i,x,y);if(!last){p.prev=p;p.next=p;}else{p.next=last.next;p.prev=last;last.next.prev=p;last.next=p;}
            return p;}
        function removeNode(p){p.next.prev=p.prev;p.prev.next=p.next;if(p.prevZ)p.prevZ.nextZ=p.nextZ;if(p.nextZ)p.nextZ.prevZ=p.prevZ;}
        function Node(i,x,y){this.i=i;this.x=x;this.y=y;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=false;}
        earcut.deviation=function(data,holeIndices,dim,triangles){var hasHoles=holeIndices&&holeIndices.length;var outerLen=hasHoles?holeIndices[0]*dim:data.length;var polygonArea=Math.abs(signedArea(data,0,outerLen,dim));if(hasHoles){for(var i=0,len=holeIndices.length;i<len;i++){var start=holeIndices[i]*dim;var end=i<len-1?holeIndices[i+1]*dim:data.length;polygonArea-=Math.abs(signedArea(data,start,end,dim));}}
            var trianglesArea=0;for(i=0;i<triangles.length;i+=3){var a=triangles[i]*dim;var b=triangles[i+1]*dim;var c=triangles[i+2]*dim;trianglesArea+=Math.abs((data[a]-data[c])*(data[b+1]-data[a+1])-
                (data[a]-data[b])*(data[c+1]-data[a+1]));}
            return polygonArea===0&&trianglesArea===0?0:Math.abs((trianglesArea-polygonArea)/ polygonArea);};function signedArea(data,start,end,dim){var sum=0;for(var i=start,j=end-dim;i<end;i+=dim){sum+=(data[j]-data[i])*(data[i+1]+data[j+1]);j=i;}
            return sum;}
        earcut.flatten=function(data){var dim=data[0][0].length,result={vertices:[],holes:[],dimensions:dim},holeIndex=0;for(var i=0;i<data.length;i++){for(var j=0;j<data[i].length;j++){for(var d=0;d<dim;d++)result.vertices.push(data[i][j][d]);}
            if(i>0){holeIndex+=data[i-1].length;result.holes.push(holeIndex);}}
            return result;};}),"./geom/polygon/GetAABB.js":(function(module,exports,__webpack_require__){var Rectangle=__webpack_require__("./geom/rectangle/Rectangle.js");var GetAABB=function(polygon,out)
    {if(out===undefined){out=new Rectangle();}
        var minX=Infinity;var minY=Infinity;var maxX=-minX;var maxY=-minY;var p;for(var i=0;i<polygon.points.length;i++)
    {p=polygon.points[i];minX=Math.min(minX,p.x);minY=Math.min(minY,p.y);maxX=Math.max(maxX,p.x);maxY=Math.max(maxY,p.y);}
        out.x=minX;out.y=minY;out.width=maxX-minX;out.height=maxY-minY;return out;};module.exports=GetAABB;}),"./geom/polygon/GetNumberArray.js":(function(module,exports){var GetNumberArray=function(polygon,output)
    {if(output===undefined){output=[];}
        for(var i=0;i<polygon.points.length;i++)
        {output.push(polygon.points[i].x);output.push(polygon.points[i].y);}
        return output;};module.exports=GetNumberArray;}),"./geom/polygon/GetPoints.js":(function(module,exports,__webpack_require__){var Length=__webpack_require__("./geom/line/Length.js");var Line=__webpack_require__("./geom/line/Line.js");var Perimeter=__webpack_require__("./geom/polygon/Perimeter.js");var GetPoints=function(polygon,quantity,stepRate,out)
    {if(out===undefined){out=[];}
        var points=polygon.points;var perimeter=Perimeter(polygon);if(!quantity)
    {quantity=perimeter / stepRate;}
        for(var i=0;i<quantity;i++)
        {var position=perimeter*(i / quantity);var accumulatedPerimeter=0;for(var j=0;j<points.length;j++)
        {var pointA=points[j];var pointB=points[(j+1)%points.length];var line=new Line(pointA.x,pointA.y,pointB.x,pointB.y);var length=Length(line);if(position<accumulatedPerimeter||position>accumulatedPerimeter+length)
        {accumulatedPerimeter+=length;continue;}
            var point=line.getPoint((position-accumulatedPerimeter)/ length);out.push(point);break;}}
        return out;};module.exports=GetPoints;}),"./geom/polygon/Perimeter.js":(function(module,exports,__webpack_require__){var Length=__webpack_require__("./geom/line/Length.js");var Line=__webpack_require__("./geom/line/Line.js");var Perimeter=function(polygon)
    {var points=polygon.points;var perimeter=0;for(var i=0;i<points.length;i++)
    {var pointA=points[i];var pointB=points[(i+1)%points.length];var line=new Line(pointA.x,pointA.y,pointB.x,pointB.y);perimeter+=Length(line);}
        return perimeter;};module.exports=Perimeter;}),"./geom/polygon/Polygon.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Contains=__webpack_require__("./geom/polygon/Contains.js");var GetPoints=__webpack_require__("./geom/polygon/GetPoints.js");var Polygon=new Class({initialize:function Polygon(points)
        {this.area=0;this.points=[];if(points)
        {this.setTo(points);}},contains:function(x,y)
        {return Contains(this,x,y);},setTo:function(points)
        {this.area=0;this.points=[];if(typeof points==='string')
        {points=points.split(' ');}
            if(!Array.isArray(points))
            {return this;}
            var p;var y0=Number.MAX_VALUE;for(var i=0;i<points.length;i++)
        {p={x:0,y:0};if(typeof points[i]==='number'||typeof points[i]==='string')
        {p.x=parseFloat(points[i]);p.y=parseFloat(points[i+1]);i++;}
        else if(Array.isArray(points[i]))
        {p.x=points[i][0];p.y=points[i][1];}
        else
        {p.x=points[i].x;p.y=points[i].y;}
            this.points.push(p);if(p.y<y0)
        {y0=p.y;}}
            this.calculateArea(y0);return this;},calculateArea:function()
        {if(this.points.length<3)
        {this.area=0;return this.area;}
            var sum=0;var p1;var p2;for(var i=0;i<this.points.length-1;i++)
        {p1=this.points[i];p2=this.points[i+1];sum+=(p2.x-p1.x)*(p1.y+p2.y);}
            p1=this.points[0];p2=this.points[this.points.length-1];sum+=(p1.x-p2.x)*(p2.y+p1.y);this.area=-sum*0.5;return this.area;},getPoints:function(quantity,step,output)
        {return GetPoints(this,quantity,step,output);}});module.exports=Polygon;}),"./geom/polygon/Reverse.js":(function(module,exports){var Reverse=function(polygon)
    {polygon.points.reverse();return polygon;};module.exports=Reverse;}),"./geom/polygon/Smooth.js":(function(module,exports){var copy=function(out,a)
    {out[0]=a[0];out[1]=a[1];return out;};var Smooth=function(polygon)
    {var i;var points=[];var data=polygon.points;for(i=0;i<data.length;i++)
    {points.push([data[i].x,data[i].y]);}
        var output=[];if(points.length>0)
    {output.push(copy([0,0],points[0]));}
        for(i=0;i<points.length-1;i++)
        {var p0=points[i];var p1=points[i+1];var p0x=p0[0];var p0y=p0[1];var p1x=p1[0];var p1y=p1[1];output.push([0.85*p0x+0.15*p1x,0.85*p0y+0.15*p1y]);output.push([0.15*p0x+0.85*p1x,0.15*p0y+0.85*p1y]);}
        if(points.length>1)
        {output.push(copy([0,0],points[points.length-1]));}
        return polygon.setTo(output);};module.exports=Smooth;}),"./geom/polygon/index.js":(function(module,exports,__webpack_require__){var Polygon=__webpack_require__("./geom/polygon/Polygon.js");Polygon.Clone=__webpack_require__("./geom/polygon/Clone.js");Polygon.Contains=__webpack_require__("./geom/polygon/Contains.js");Polygon.ContainsPoint=__webpack_require__("./geom/polygon/ContainsPoint.js");Polygon.GetAABB=__webpack_require__("./geom/polygon/GetAABB.js");Polygon.GetNumberArray=__webpack_require__("./geom/polygon/GetNumberArray.js");Polygon.GetPoints=__webpack_require__("./geom/polygon/GetPoints.js");Polygon.Perimeter=__webpack_require__("./geom/polygon/Perimeter.js");Polygon.Reverse=__webpack_require__("./geom/polygon/Reverse.js");Polygon.Smooth=__webpack_require__("./geom/polygon/Smooth.js");module.exports=Polygon;}),"./geom/rectangle/Area.js":(function(module,exports){var Area=function(rect)
    {return rect.width*rect.height;};module.exports=Area;}),"./geom/rectangle/Ceil.js":(function(module,exports){var Ceil=function(rect)
    {rect.x=Math.ceil(rect.x);rect.y=Math.ceil(rect.y);return rect;};module.exports=Ceil;}),"./geom/rectangle/CeilAll.js":(function(module,exports){var CeilAll=function(rect)
    {rect.x=Math.ceil(rect.x);rect.y=Math.ceil(rect.y);rect.width=Math.ceil(rect.width);rect.height=Math.ceil(rect.height);return rect;};module.exports=CeilAll;}),"./geom/rectangle/CenterOn.js":(function(module,exports){var CenterOn=function(rect,x,y)
    {rect.x=x-(rect.width / 2);rect.y=y-(rect.height / 2);return rect;};module.exports=CenterOn;}),"./geom/rectangle/Clone.js":(function(module,exports,__webpack_require__){var Rectangle=__webpack_require__("./geom/rectangle/Rectangle.js");var Clone=function(source)
    {return new Rectangle(source.x,source.y,source.width,source.height);};module.exports=Clone;}),"./geom/rectangle/Contains.js":(function(module,exports){var Contains=function(rect,x,y)
    {if(rect.width<=0||rect.height<=0)
    {return false;}
        return(rect.x<=x&&rect.x+rect.width>=x&&rect.y<=y&&rect.y+rect.height>=y);};module.exports=Contains;}),"./geom/rectangle/ContainsPoint.js":(function(module,exports,__webpack_require__){var Contains=__webpack_require__("./geom/rectangle/Contains.js");var ContainsPoint=function(rect,point)
    {return Contains(rect,point.x,point.y);};module.exports=ContainsPoint;}),"./geom/rectangle/ContainsRect.js":(function(module,exports){var ContainsRect=function(rectA,rectB)
    {if((rectB.width*rectB.height)>(rectA.width*rectA.height))
    {return false;}
        return((rectB.x>rectA.x&&rectB.x<rectA.right)&&(rectB.right>rectA.x&&rectB.right<rectA.right)&&(rectB.y>rectA.y&&rectB.y<rectA.bottom)&&(rectB.bottom>rectA.y&&rectB.bottom<rectA.bottom));};module.exports=ContainsRect;}),"./geom/rectangle/CopyFrom.js":(function(module,exports){var CopyFrom=function(source,dest)
    {return dest.setTo(source.x,source.y,source.width,source.height);};module.exports=CopyFrom;}),"./geom/rectangle/Decompose.js":(function(module,exports){var Decompose=function(rect,out)
    {if(out===undefined){out=[];}
        out.push({x:rect.x,y:rect.y});out.push({x:rect.right,y:rect.y});out.push({x:rect.right,y:rect.bottom});out.push({x:rect.x,y:rect.bottom});return out;};module.exports=Decompose;}),"./geom/rectangle/Equals.js":(function(module,exports){var Equals=function(rect,toCompare)
    {return(rect.x===toCompare.x&&rect.y===toCompare.y&&rect.width===toCompare.width&&rect.height===toCompare.height);};module.exports=Equals;}),"./geom/rectangle/FitInside.js":(function(module,exports,__webpack_require__){var GetAspectRatio=__webpack_require__("./geom/rectangle/GetAspectRatio.js");var FitInside=function(target,source)
    {var ratio=GetAspectRatio(target);if(ratio<GetAspectRatio(source))
    {target.setSize(source.height*ratio,source.height);}
    else
    {target.setSize(source.width,source.width / ratio);}
        return target.setPosition(source.centerX-(target.width / 2),source.centerY-(target.height / 2));};module.exports=FitInside;}),"./geom/rectangle/FitOutside.js":(function(module,exports,__webpack_require__){var GetAspectRatio=__webpack_require__("./geom/rectangle/GetAspectRatio.js");var FitOutside=function(target,source)
    {var ratio=GetAspectRatio(target);if(ratio>GetAspectRatio(source))
    {target.setSize(source.height*ratio,source.height);}
    else
    {target.setSize(source.width,source.width / ratio);}
        return target.setPosition(source.centerX-target.width / 2,source.centerY-target.height / 2);};module.exports=FitOutside;}),"./geom/rectangle/Floor.js":(function(module,exports){var Floor=function(rect)
    {rect.x=Math.floor(rect.x);rect.y=Math.floor(rect.y);return rect;};module.exports=Floor;}),"./geom/rectangle/FloorAll.js":(function(module,exports){var FloorAll=function(rect)
    {rect.x=Math.floor(rect.x);rect.y=Math.floor(rect.y);rect.width=Math.floor(rect.width);rect.height=Math.floor(rect.height);return rect;};module.exports=FloorAll;}),"./geom/rectangle/FromPoints.js":(function(module,exports,__webpack_require__){var Rectangle=__webpack_require__("./geom/rectangle/Rectangle.js");var FromPoints=function(points,out)
    {if(out===undefined){out=new Rectangle();}
        if(points.length===0)
        {return out;}
        var minX=Number.MAX_VALUE;var minY=Number.MAX_VALUE;var maxX=Number.MIN_SAFE_INTEGER;var maxY=Number.MIN_SAFE_INTEGER;var p;var px;var py;for(var i=0;i<points.length;i++)
    {p=points[i];if(Array.isArray(p))
    {px=p[0];py=p[1];}
    else
    {px=p.x;py=p.y;}
        minX=Math.min(minX,px);minY=Math.min(minY,py);maxX=Math.max(maxX,px);maxY=Math.max(maxY,py);}
        out.x=minX;out.y=minY;out.width=maxX-minX;out.height=maxY-minY;return out;};module.exports=FromPoints;}),"./geom/rectangle/GetAspectRatio.js":(function(module,exports){var GetAspectRatio=function(rect)
    {return(rect.height===0)?NaN:rect.width / rect.height;};module.exports=GetAspectRatio;}),"./geom/rectangle/GetCenter.js":(function(module,exports,__webpack_require__){var Point=__webpack_require__("./geom/point/Point.js");var GetCenter=function(rect,out)
    {if(out===undefined){out=new Point();}
        out.x=rect.centerX;out.y=rect.centerY;return out;};module.exports=GetCenter;}),"./geom/rectangle/GetPoint.js":(function(module,exports,__webpack_require__){var Perimeter=__webpack_require__("./geom/rectangle/Perimeter.js");var Point=__webpack_require__("./geom/point/Point.js");var GetPoint=function(rectangle,position,out)
    {if(out===undefined){out=new Point();}
        if(position<=0||position>=1)
        {out.x=rectangle.x;out.y=rectangle.y;return out;}
        var p=Perimeter(rectangle)*position;if(position>0.5)
    {p-=(rectangle.width+rectangle.height);if(p<=rectangle.width)
    {out.x=rectangle.right-p;out.y=rectangle.bottom;}
    else
    {out.x=rectangle.x;out.y=rectangle.bottom-(p-rectangle.width);}}
    else if(p<=rectangle.width)
    {out.x=rectangle.x+p;out.y=rectangle.y;}
    else
    {out.x=rectangle.right;out.y=rectangle.y+(p-rectangle.width);}
        return out;};module.exports=GetPoint;}),"./geom/rectangle/GetPoints.js":(function(module,exports,__webpack_require__){var GetPoint=__webpack_require__("./geom/rectangle/GetPoint.js");var Perimeter=__webpack_require__("./geom/rectangle/Perimeter.js");var GetPoints=function(rectangle,quantity,stepRate,out)
    {if(out===undefined){out=[];}
        if(!quantity)
        {quantity=Perimeter(rectangle)/ stepRate;}
        for(var i=0;i<quantity;i++)
        {var position=i / quantity;out.push(GetPoint(rectangle,position));}
        return out;};module.exports=GetPoints;}),"./geom/rectangle/GetSize.js":(function(module,exports,__webpack_require__){var Point=__webpack_require__("./geom/point/Point.js");var GetSize=function(rect,out)
    {if(out===undefined){out=new Point();}
        out.x=rect.width;out.y=rect.height;return out;};module.exports=GetSize;}),"./geom/rectangle/Inflate.js":(function(module,exports,__webpack_require__){var CenterOn=__webpack_require__("./geom/rectangle/CenterOn.js");var Inflate=function(rect,x,y)
    {var cx=rect.centerX;var cy=rect.centerY;rect.setSize(rect.width+(x*2),rect.height+(y*2));return CenterOn(rect,cx,cy);};module.exports=Inflate;}),"./geom/rectangle/Intersection.js":(function(module,exports,__webpack_require__){var Rectangle=__webpack_require__("./geom/rectangle/Rectangle.js");var Intersects=__webpack_require__("./geom/intersects/RectangleToRectangle.js");var Intersection=function(rectA,rectB,out)
    {if(out===undefined){out=new Rectangle();}
        if(Intersects(rectA,rectB))
        {out.x=Math.max(rectA.x,rectB.x);out.y=Math.max(rectA.y,rectB.y);out.width=Math.min(rectA.right,rectB.right)-out.x;out.height=Math.min(rectA.bottom,rectB.bottom)-out.y;}
        else
        {out.setEmpty();}
        return out;};module.exports=Intersection;}),"./geom/rectangle/MarchingAnts.js":(function(module,exports,__webpack_require__){var Perimeter=__webpack_require__("./geom/rectangle/Perimeter.js");var Point=__webpack_require__("./geom/point/Point.js");var MarchingAnts=function(rect,step,quantity,out)
    {if(out===undefined){out=[];}
        if(!step&&!quantity)
        {return out;}
        if(!step)
        {step=Perimeter(rect)/ quantity;}
        else
        {quantity=Math.round(Perimeter(rect)/ step);}
        var x=rect.x;var y=rect.y;var face=0;for(var i=0;i<quantity;i++)
    {out.push(new Point(x,y));switch(face)
    {case 0:x+=step;if(x>=rect.right)
        {face=1;y+=(x-rect.right);x=rect.right;}
            break;case 1:y+=step;if(y>=rect.bottom)
        {face=2;x-=(y-rect.bottom);y=rect.bottom;}
            break;case 2:x-=step;if(x<=rect.left)
        {face=3;y-=(rect.left-x);x=rect.left;}
            break;case 3:y-=step;if(y<=rect.top)
        {face=0;y=rect.top;}
            break;}}
        return out;};module.exports=MarchingAnts;}),"./geom/rectangle/MergePoints.js":(function(module,exports){var MergePoints=function(target,points)
    {var minX=target.x;var maxX=target.right;var minY=target.y;var maxY=target.bottom;for(var i=0;i<points.length;i++)
    {minX=Math.min(minX,points[i].x);maxX=Math.max(maxX,points[i].x);minY=Math.min(minY,points[i].y);maxY=Math.max(maxY,points[i].y);}
        target.x=minX;target.y=minY;target.width=maxX-minX;target.height=maxY-minY;return target;};module.exports=MergePoints;}),"./geom/rectangle/MergeRect.js":(function(module,exports){var MergeRect=function(target,source)
    {var minX=Math.min(target.x,source.x);var maxX=Math.max(target.right,source.right);target.x=minX;target.width=maxX-minX;var minY=Math.min(target.y,source.y);var maxY=Math.max(target.bottom,source.bottom);target.y=minY;target.height=maxY-minY;return target;};module.exports=MergeRect;}),"./geom/rectangle/MergeXY.js":(function(module,exports){var MergeXY=function(target,x,y)
    {var minX=Math.min(target.x,x);var maxX=Math.max(target.right,x);target.x=minX;target.width=maxX-minX;var minY=Math.min(target.y,y);var maxY=Math.max(target.bottom,y);target.y=minY;target.height=maxY-minY;return target;};module.exports=MergeXY;}),"./geom/rectangle/Offset.js":(function(module,exports){var Offset=function(rect,x,y)
    {rect.x+=x;rect.y+=y;return rect;};module.exports=Offset;}),"./geom/rectangle/OffsetPoint.js":(function(module,exports){var OffsetPoint=function(rect,point)
    {rect.x+=point.x;rect.y+=point.y;return rect;};module.exports=OffsetPoint;}),"./geom/rectangle/Overlaps.js":(function(module,exports){var Overlaps=function(rectA,rectB)
    {return(rectA.x<rectB.right&&rectA.right>rectB.x&&rectA.y<rectB.bottom&&rectA.bottom>rectB.y);};module.exports=Overlaps;}),"./geom/rectangle/Perimeter.js":(function(module,exports){var Perimeter=function(rect)
    {return 2*(rect.width+rect.height);};module.exports=Perimeter;}),"./geom/rectangle/PerimeterPoint.js":(function(module,exports,__webpack_require__){var Point=__webpack_require__("./geom/point/Point.js");var DegToRad=__webpack_require__("./math/DegToRad.js");var PerimeterPoint=function(rectangle,angle,out)
    {if(out===undefined){out=new Point();}
        angle=DegToRad(angle);var s=Math.sin(angle);var c=Math.cos(angle);var dx=(c>0)?rectangle.width / 2:rectangle.width /-2;var dy=(s>0)?rectangle.height / 2:rectangle.height /-2;if(Math.abs(dx*s)<Math.abs(dy*c))
    {dy=(dx*s)/ c;}
    else
    {dx=(dy*c)/ s;}
        out.x=dx+rectangle.centerX;out.y=dy+rectangle.centerY;return out;};module.exports=PerimeterPoint;}),"./geom/rectangle/Random.js":(function(module,exports,__webpack_require__){var Point=__webpack_require__("./geom/point/Point.js");var Random=function(rect,out)
    {if(out===undefined){out=new Point();}
        out.x=rect.x+(Math.random()*rect.width);out.y=rect.y+(Math.random()*rect.height);return out;};module.exports=Random;}),"./geom/rectangle/RandomOutside.js":(function(module,exports,__webpack_require__){var Between=__webpack_require__("./math/Between.js");var ContainsRect=__webpack_require__("./geom/rectangle/ContainsRect.js");var Point=__webpack_require__("./geom/point/Point.js");var RandomOutside=function(outer,inner,out)
    {if(out===undefined){out=new Point();}
        if(ContainsRect(outer,inner))
        {switch(Between(0,3))
        {case 0:out.x=outer.x+(Math.random()*(inner.right-outer.x));out.y=outer.y+(Math.random()*(inner.top-outer.y));break;case 1:out.x=inner.x+(Math.random()*(outer.right-inner.x));out.y=inner.bottom+(Math.random()*(outer.bottom-inner.bottom));break;case 2:out.x=outer.x+(Math.random()*(inner.x-outer.x));out.y=inner.y+(Math.random()*(outer.bottom-inner.y));break;case 3:out.x=inner.right+(Math.random()*(outer.right-inner.right));out.y=outer.y+(Math.random()*(inner.bottom-outer.y));break;}}
        return out;};module.exports=RandomOutside;}),"./geom/rectangle/Rectangle.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Contains=__webpack_require__("./geom/rectangle/Contains.js");var GetPoint=__webpack_require__("./geom/rectangle/GetPoint.js");var GetPoints=__webpack_require__("./geom/rectangle/GetPoints.js");var Line=__webpack_require__("./geom/line/Line.js");var Random=__webpack_require__("./geom/rectangle/Random.js");var Rectangle=new Class({initialize:function Rectangle(x,y,width,height)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            if(width===undefined){width=0;}
            if(height===undefined){height=0;}
            this.x=x;this.y=y;this.width=width;this.height=height;},contains:function(x,y)
        {return Contains(this,x,y);},getPoint:function(position,output)
        {return GetPoint(this,position,output);},getPoints:function(quantity,stepRate,output)
        {return GetPoints(this,quantity,stepRate,output);},getRandomPoint:function(point)
        {return Random(this,point);},setTo:function(x,y,width,height)
        {this.x=x;this.y=y;this.width=width;this.height=height;return this;},setEmpty:function()
        {return this.setTo(0,0,0,0);},setPosition:function(x,y)
        {if(y===undefined){y=x;}
            this.x=x;this.y=y;return this;},setSize:function(width,height)
        {if(height===undefined){height=width;}
            this.width=width;this.height=height;return this;},isEmpty:function()
        {return(this.width<=0||this.height<=0);},getLineA:function(line)
        {if(line===undefined){line=new Line();}
            line.setTo(this.x,this.y,this.right,this.y);return line;},getLineB:function(line)
        {if(line===undefined){line=new Line();}
            line.setTo(this.right,this.y,this.right,this.bottom);return line;},getLineC:function(line)
        {if(line===undefined){line=new Line();}
            line.setTo(this.right,this.bottom,this.x,this.bottom);return line;},getLineD:function(line)
        {if(line===undefined){line=new Line();}
            line.setTo(this.x,this.bottom,this.x,this.y);return line;},left:{get:function()
            {return this.x;},set:function(value)
            {if(value>=this.right)
            {this.width=0;}
            else
            {this.width=this.right-value;}
                this.x=value;}},right:{get:function()
            {return this.x+this.width;},set:function(value)
            {if(value<=this.x)
            {this.width=0;}
            else
            {this.width=value-this.x;}}},top:{get:function()
            {return this.y;},set:function(value)
            {if(value>=this.bottom)
            {this.height=0;}
            else
            {this.height=(this.bottom-value);}
                this.y=value;}},bottom:{get:function()
            {return this.y+this.height;},set:function(value)
            {if(value<=this.y)
            {this.height=0;}
            else
            {this.height=value-this.y;}}},centerX:{get:function()
            {return this.x+(this.width / 2);},set:function(value)
            {this.x=value-(this.width / 2);}},centerY:{get:function()
            {return this.y+(this.height / 2);},set:function(value)
            {this.y=value-(this.height / 2);}}});module.exports=Rectangle;}),"./geom/rectangle/SameDimensions.js":(function(module,exports){var SameDimensions=function(rect,toCompare)
    {return(rect.width===toCompare.width&&rect.height===toCompare.height);};module.exports=SameDimensions;}),"./geom/rectangle/Scale.js":(function(module,exports){var Scale=function(rect,x,y)
    {if(y===undefined){y=x;}
        rect.width*=x;rect.height*=y;return rect;};module.exports=Scale;}),"./geom/rectangle/Union.js":(function(module,exports,__webpack_require__){var Rectangle=__webpack_require__("./geom/rectangle/Rectangle.js");var Union=function(rectA,rectB,out)
    {if(out===undefined){out=new Rectangle();}
        var x=Math.min(rectA.x,rectB.x);var y=Math.min(rectA.y,rectB.y);var w=Math.max(rectA.right,rectB.right)-x;var h=Math.max(rectA.bottom,rectB.bottom)-y;return out.setTo(x,y,w,h);};module.exports=Union;}),"./geom/rectangle/index.js":(function(module,exports,__webpack_require__){var Rectangle=__webpack_require__("./geom/rectangle/Rectangle.js");Rectangle.Area=__webpack_require__("./geom/rectangle/Area.js");Rectangle.Ceil=__webpack_require__("./geom/rectangle/Ceil.js");Rectangle.CeilAll=__webpack_require__("./geom/rectangle/CeilAll.js");Rectangle.CenterOn=__webpack_require__("./geom/rectangle/CenterOn.js");Rectangle.Clone=__webpack_require__("./geom/rectangle/Clone.js");Rectangle.Contains=__webpack_require__("./geom/rectangle/Contains.js");Rectangle.ContainsPoint=__webpack_require__("./geom/rectangle/ContainsPoint.js");Rectangle.ContainsRect=__webpack_require__("./geom/rectangle/ContainsRect.js");Rectangle.CopyFrom=__webpack_require__("./geom/rectangle/CopyFrom.js");Rectangle.Decompose=__webpack_require__("./geom/rectangle/Decompose.js");Rectangle.Equals=__webpack_require__("./geom/rectangle/Equals.js");Rectangle.FitInside=__webpack_require__("./geom/rectangle/FitInside.js");Rectangle.FitOutside=__webpack_require__("./geom/rectangle/FitOutside.js");Rectangle.Floor=__webpack_require__("./geom/rectangle/Floor.js");Rectangle.FloorAll=__webpack_require__("./geom/rectangle/FloorAll.js");Rectangle.FromPoints=__webpack_require__("./geom/rectangle/FromPoints.js");Rectangle.GetAspectRatio=__webpack_require__("./geom/rectangle/GetAspectRatio.js");Rectangle.GetCenter=__webpack_require__("./geom/rectangle/GetCenter.js");Rectangle.GetPoint=__webpack_require__("./geom/rectangle/GetPoint.js");Rectangle.GetPoints=__webpack_require__("./geom/rectangle/GetPoints.js");Rectangle.GetSize=__webpack_require__("./geom/rectangle/GetSize.js");Rectangle.Inflate=__webpack_require__("./geom/rectangle/Inflate.js");Rectangle.Intersection=__webpack_require__("./geom/rectangle/Intersection.js");Rectangle.MarchingAnts=__webpack_require__("./geom/rectangle/MarchingAnts.js");Rectangle.MergePoints=__webpack_require__("./geom/rectangle/MergePoints.js");Rectangle.MergeRect=__webpack_require__("./geom/rectangle/MergeRect.js");Rectangle.MergeXY=__webpack_require__("./geom/rectangle/MergeXY.js");Rectangle.Offset=__webpack_require__("./geom/rectangle/Offset.js");Rectangle.OffsetPoint=__webpack_require__("./geom/rectangle/OffsetPoint.js");Rectangle.Overlaps=__webpack_require__("./geom/rectangle/Overlaps.js");Rectangle.Perimeter=__webpack_require__("./geom/rectangle/Perimeter.js");Rectangle.PerimeterPoint=__webpack_require__("./geom/rectangle/PerimeterPoint.js");Rectangle.Random=__webpack_require__("./geom/rectangle/Random.js");Rectangle.RandomOutside=__webpack_require__("./geom/rectangle/RandomOutside.js");Rectangle.SameDimensions=__webpack_require__("./geom/rectangle/SameDimensions.js");Rectangle.Scale=__webpack_require__("./geom/rectangle/Scale.js");Rectangle.Union=__webpack_require__("./geom/rectangle/Union.js");module.exports=Rectangle;}),"./geom/triangle/Area.js":(function(module,exports){var Area=function(triangle)
    {var x1=triangle.x1;var y1=triangle.y1;var x2=triangle.x2;var y2=triangle.y2;var x3=triangle.x3;var y3=triangle.y3;return Math.abs(((x3-x1)*(y2-y1)-(x2-x1)*(y3-y1))/ 2);};module.exports=Area;}),"./geom/triangle/BuildEquilateral.js":(function(module,exports,__webpack_require__){var Triangle=__webpack_require__("./geom/triangle/Triangle.js");var BuildEquilateral=function(x,y,length)
    {var height=length*(Math.sqrt(3)/ 2);var x1=x;var y1=y;var x2=x+(length / 2);var y2=y+height;var x3=x-(length / 2);var y3=y+height;return new Triangle(x1,y1,x2,y2,x3,y3);};module.exports=BuildEquilateral;}),"./geom/triangle/BuildFromPolygon.js":(function(module,exports,__webpack_require__){var EarCut=__webpack_require__("./geom/polygon/Earcut.js");var Triangle=__webpack_require__("./geom/triangle/Triangle.js");var BuildFromPolygon=function(data,holes,scaleX,scaleY,out)
    {if(holes===undefined){holes=null;}
        if(scaleX===undefined){scaleX=1;}
        if(scaleY===undefined){scaleY=1;}
        if(out===undefined){out=[];}
        var tris=EarCut(data,holes);var a;var b;var c;var x1;var y1;var x2;var y2;var x3;var y3;for(var i=0;i<tris.length;i+=3)
    {a=tris[i];b=tris[i+1];c=tris[i+2];x1=data[a*2]*scaleX;y1=data[(a*2)+1]*scaleY;x2=data[b*2]*scaleX;y2=data[(b*2)+1]*scaleY;x3=data[c*2]*scaleX;y3=data[(c*2)+1]*scaleY;out.push(new Triangle(x1,y1,x2,y2,x3,y3));}
        return out;};module.exports=BuildFromPolygon;}),"./geom/triangle/BuildRight.js":(function(module,exports,__webpack_require__){var Triangle=__webpack_require__("./geom/triangle/Triangle.js");var BuildRight=function(x,y,width,height)
    {if(height===undefined){height=width;}
        var x1=x;var y1=y;var x2=x;var y2=y-height;var x3=x+width;var y3=y;return new Triangle(x1,y1,x2,y2,x3,y3);};module.exports=BuildRight;}),"./geom/triangle/CenterOn.js":(function(module,exports,__webpack_require__){var Centroid=__webpack_require__("./geom/triangle/Centroid.js");var Offset=__webpack_require__("./geom/triangle/Offset.js");var CenterOn=function(triangle,x,y,centerFunc)
    {if(centerFunc===undefined){centerFunc=Centroid;}
        var center=centerFunc(triangle);var diffX=x-center.x;var diffY=y-center.y;return Offset(triangle,diffX,diffY);};module.exports=CenterOn;}),"./geom/triangle/Centroid.js":(function(module,exports,__webpack_require__){var Point=__webpack_require__("./geom/point/Point.js");var Centroid=function(triangle,out)
    {if(out===undefined){out=new Point();}
        out.x=(triangle.x1+triangle.x2+triangle.x3)/ 3;out.y=(triangle.y1+triangle.y2+triangle.y3)/ 3;return out;};module.exports=Centroid;}),"./geom/triangle/CircumCenter.js":(function(module,exports,__webpack_require__){var Vector2=__webpack_require__("./math/Vector2.js");function det(m00,m01,m10,m11)
    {return(m00*m11)-(m01*m10);}
        var CircumCenter=function(triangle,out)
        {if(out===undefined){out=new Vector2();}
            var cx=triangle.x3;var cy=triangle.y3;var ax=triangle.x1-cx;var ay=triangle.y1-cy;var bx=triangle.x2-cx;var by=triangle.y2-cy;var denom=2*det(ax,ay,bx,by);var numx=det(ay,ax*ax+ay*ay,by,bx*bx+by*by);var numy=det(ax,ax*ax+ay*ay,bx,bx*bx+by*by);out.x=cx-numx / denom;out.y=cy+numy / denom;return out;};module.exports=CircumCenter;}),"./geom/triangle/CircumCircle.js":(function(module,exports,__webpack_require__){var Circle=__webpack_require__("./geom/circle/Circle.js");var CircumCircle=function(triangle,out)
    {if(out===undefined){out=new Circle();}
        var x1=triangle.x1;var y1=triangle.y1;var x2=triangle.x2;var y2=triangle.y2;var x3=triangle.x3;var y3=triangle.y3;var A=x2-x1;var B=y2-y1;var C=x3-x1;var D=y3-y1;var E=A*(x1+x2)+B*(y1+y2);var F=C*(x1+x3)+D*(y1+y3);var G=2*(A*(y3-y2)-B*(x3-x2));var dx;var dy;if(Math.abs(G)<0.000001)
    {var minX=Math.min(x1,x2,x3);var minY=Math.min(y1,y2,y3);dx=(Math.max(x1,x2,x3)-minX)*0.5;dy=(Math.max(y1,y2,y3)-minY)*0.5;out.x=minX+dx;out.y=minY+dy;out.radius=Math.sqrt(dx*dx+dy*dy);}
    else
    {out.x=(D*E-B*F)/ G;out.y=(A*F-C*E)/ G;dx=out.x-x1;dy=out.y-y1;out.radius=Math.sqrt(dx*dx+dy*dy);}
        return out;};module.exports=CircumCircle;}),"./geom/triangle/Clone.js":(function(module,exports,__webpack_require__){var Triangle=__webpack_require__("./geom/triangle/Triangle.js");var Clone=function(source)
    {return new Triangle(source.x1,source.y1,source.x2,source.y2,source.x3,source.y3);};module.exports=Clone;}),"./geom/triangle/Contains.js":(function(module,exports){var Contains=function(triangle,x,y)
    {var v0x=triangle.x3-triangle.x1;var v0y=triangle.y3-triangle.y1;var v1x=triangle.x2-triangle.x1;var v1y=triangle.y2-triangle.y1;var v2x=x-triangle.x1;var v2y=y-triangle.y1;var dot00=(v0x*v0x)+(v0y*v0y);var dot01=(v0x*v1x)+(v0y*v1y);var dot02=(v0x*v2x)+(v0y*v2y);var dot11=(v1x*v1x)+(v1y*v1y);var dot12=(v1x*v2x)+(v1y*v2y);var b=((dot00*dot11)-(dot01*dot01));var inv=(b===0)?0:(1 / b);var u=((dot11*dot02)-(dot01*dot12))*inv;var v=((dot00*dot12)-(dot01*dot02))*inv;return(u>=0&&v>=0&&(u+v<1));};module.exports=Contains;}),"./geom/triangle/ContainsArray.js":(function(module,exports){var ContainsArray=function(triangle,points,returnFirst,out)
    {if(returnFirst===undefined){returnFirst=false;}
        if(out===undefined){out=[];}
        var v0x=triangle.x3-triangle.x1;var v0y=triangle.y3-triangle.y1;var v1x=triangle.x2-triangle.x1;var v1y=triangle.y2-triangle.y1;var dot00=(v0x*v0x)+(v0y*v0y);var dot01=(v0x*v1x)+(v0y*v1y);var dot11=(v1x*v1x)+(v1y*v1y);var b=((dot00*dot11)-(dot01*dot01));var inv=(b===0)?0:(1 / b);var u;var v;var v2x;var v2y;var dot02;var dot12;var x1=triangle.x1;var y1=triangle.y1;for(var i=0;i<points.length;i++)
    {v2x=points[i].x-x1;v2y=points[i].y-y1;dot02=(v0x*v2x)+(v0y*v2y);dot12=(v1x*v2x)+(v1y*v2y);u=((dot11*dot02)-(dot01*dot12))*inv;v=((dot00*dot12)-(dot01*dot02))*inv;if(u>=0&&v>=0&&(u+v<1))
    {out.push({x:points[i].x,y:points[i].y});if(returnFirst)
    {break;}}}
        return out;};module.exports=ContainsArray;}),"./geom/triangle/ContainsPoint.js":(function(module,exports,__webpack_require__){var Contains=__webpack_require__("./geom/triangle/Contains.js");var ContainsPoint=function(triangle,point)
    {return Contains(triangle,point.x,point.y);};module.exports=ContainsPoint;}),"./geom/triangle/CopyFrom.js":(function(module,exports){var CopyFrom=function(source,dest)
    {return dest.setTo(source.x1,source.y1,source.x2,source.y2,source.x3,source.y3);};module.exports=CopyFrom;}),"./geom/triangle/Decompose.js":(function(module,exports){var Decompose=function(triangle,out)
    {if(out===undefined){out=[];}
        out.push({x:triangle.x1,y:triangle.y1});out.push({x:triangle.x2,y:triangle.y2});out.push({x:triangle.x3,y:triangle.y3});return out;};module.exports=Decompose;}),"./geom/triangle/Equals.js":(function(module,exports){var Equals=function(triangle,toCompare)
    {return(triangle.x1===toCompare.x1&&triangle.y1===toCompare.y1&&triangle.x2===toCompare.x2&&triangle.y2===toCompare.y2&&triangle.x3===toCompare.x3&&triangle.y3===toCompare.y3);};module.exports=Equals;}),"./geom/triangle/GetPoint.js":(function(module,exports,__webpack_require__){var Point=__webpack_require__("./geom/point/Point.js");var Length=__webpack_require__("./geom/line/Length.js");var GetPoint=function(triangle,position,out)
    {if(out===undefined){out=new Point();}
        var line1=triangle.getLineA();var line2=triangle.getLineB();var line3=triangle.getLineC();if(position<=0||position>=1)
    {out.x=line1.x1;out.y=line1.y1;return out;}
        var length1=Length(line1);var length2=Length(line2);var length3=Length(line3);var perimeter=length1+length2+length3;var p=perimeter*position;var localPosition=0;if(p<length1)
    {localPosition=p / length1;out.x=line1.x1+(line1.x2-line1.x1)*localPosition;out.y=line1.y1+(line1.y2-line1.y1)*localPosition;}
    else if(p>length1+length2)
    {p-=length1+length2;localPosition=p / length3;out.x=line3.x1+(line3.x2-line3.x1)*localPosition;out.y=line3.y1+(line3.y2-line3.y1)*localPosition;}
    else
    {p-=length1;localPosition=p / length2;out.x=line2.x1+(line2.x2-line2.x1)*localPosition;out.y=line2.y1+(line2.y2-line2.y1)*localPosition;}
        return out;};module.exports=GetPoint;}),"./geom/triangle/GetPoints.js":(function(module,exports,__webpack_require__){var Length=__webpack_require__("./geom/line/Length.js");var Point=__webpack_require__("./geom/point/Point.js");var GetPoints=function(triangle,quantity,stepRate,out)
    {if(out===undefined){out=[];}
        var line1=triangle.getLineA();var line2=triangle.getLineB();var line3=triangle.getLineC();var length1=Length(line1);var length2=Length(line2);var length3=Length(line3);var perimeter=length1+length2+length3;if(!quantity)
    {quantity=perimeter / stepRate;}
        for(var i=0;i<quantity;i++)
        {var p=perimeter*(i / quantity);var localPosition=0;var point=new Point();if(p<length1)
        {localPosition=p / length1;point.x=line1.x1+(line1.x2-line1.x1)*localPosition;point.y=line1.y1+(line1.y2-line1.y1)*localPosition;}
        else if(p>length1+length2)
        {p-=length1+length2;localPosition=p / length3;point.x=line3.x1+(line3.x2-line3.x1)*localPosition;point.y=line3.y1+(line3.y2-line3.y1)*localPosition;}
        else
        {p-=length1;localPosition=p / length2;point.x=line2.x1+(line2.x2-line2.x1)*localPosition;point.y=line2.y1+(line2.y2-line2.y1)*localPosition;}
            out.push(point);}
        return out;};module.exports=GetPoints;}),"./geom/triangle/InCenter.js":(function(module,exports,__webpack_require__){var Point=__webpack_require__("./geom/point/Point.js");function getLength(x1,y1,x2,y2)
    {var x=x1-x2;var y=y1-y2;var magnitude=(x*x)+(y*y);return Math.sqrt(magnitude);}
        var InCenter=function(triangle,out)
        {if(out===undefined){out=new Point();}
            var x1=triangle.x1;var y1=triangle.y1;var x2=triangle.x2;var y2=triangle.y2;var x3=triangle.x3;var y3=triangle.y3;var d1=getLength(x3,y3,x2,y2);var d2=getLength(x1,y1,x3,y3);var d3=getLength(x2,y2,x1,y1);var p=d1+d2+d3;out.x=(x1*d1+x2*d2+x3*d3)/ p;out.y=(y1*d1+y2*d2+y3*d3)/ p;return out;};module.exports=InCenter;}),"./geom/triangle/Offset.js":(function(module,exports){var Offset=function(triangle,x,y)
    {triangle.x1+=x;triangle.y1+=y;triangle.x2+=x;triangle.y2+=y;triangle.x3+=x;triangle.y3+=y;return triangle;};module.exports=Offset;}),"./geom/triangle/Perimeter.js":(function(module,exports,__webpack_require__){var Length=__webpack_require__("./geom/line/Length.js");var Perimeter=function(triangle)
    {var line1=triangle.getLineA();var line2=triangle.getLineB();var line3=triangle.getLineC();return(Length(line1)+Length(line2)+Length(line3));};module.exports=Perimeter;}),"./geom/triangle/Random.js":(function(module,exports,__webpack_require__){var Point=__webpack_require__("./geom/point/Point.js");var Random=function(triangle,out)
    {if(out===undefined){out=new Point();}
        var ux=triangle.x2-triangle.x1;var uy=triangle.y2-triangle.y1;var vx=triangle.x3-triangle.x1;var vy=triangle.y3-triangle.y1;var r=Math.random();var s=Math.random();if(r+s>=1)
    {r=1-r;s=1-s;}
        out.x=triangle.x1+((ux*r)+(vx*s));out.y=triangle.y1+((uy*r)+(vy*s));return out;};module.exports=Random;}),"./geom/triangle/Rotate.js":(function(module,exports,__webpack_require__){var RotateAroundXY=__webpack_require__("./geom/triangle/RotateAroundXY.js");var InCenter=__webpack_require__("./geom/triangle/InCenter.js");var Rotate=function(triangle,angle)
    {var point=InCenter(triangle);return RotateAroundXY(triangle,point.x,point.y,angle);};module.exports=Rotate;}),"./geom/triangle/RotateAroundPoint.js":(function(module,exports,__webpack_require__){var RotateAroundXY=__webpack_require__("./geom/triangle/RotateAroundXY.js");var RotateAroundPoint=function(triangle,point,angle)
    {return RotateAroundXY(triangle,point.x,point.y,angle);};module.exports=RotateAroundPoint;}),"./geom/triangle/RotateAroundXY.js":(function(module,exports){var RotateAroundXY=function(triangle,x,y,angle)
    {var c=Math.cos(angle);var s=Math.sin(angle);var tx=triangle.x1-x;var ty=triangle.y1-y;triangle.x1=tx*c-ty*s+x;triangle.y1=tx*s+ty*c+y;tx=triangle.x2-x;ty=triangle.y2-y;triangle.x2=tx*c-ty*s+x;triangle.y2=tx*s+ty*c+y;tx=triangle.x3-x;ty=triangle.y3-y;triangle.x3=tx*c-ty*s+x;triangle.y3=tx*s+ty*c+y;return triangle;};module.exports=RotateAroundXY;}),"./geom/triangle/Triangle.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Contains=__webpack_require__("./geom/triangle/Contains.js");var GetPoint=__webpack_require__("./geom/triangle/GetPoint.js");var GetPoints=__webpack_require__("./geom/triangle/GetPoints.js");var Line=__webpack_require__("./geom/line/Line.js");var Random=__webpack_require__("./geom/triangle/Random.js");var Triangle=new Class({initialize:function Triangle(x1,y1,x2,y2,x3,y3)
        {if(x1===undefined){x1=0;}
            if(y1===undefined){y1=0;}
            if(x2===undefined){x2=0;}
            if(y2===undefined){y2=0;}
            if(x3===undefined){x3=0;}
            if(y3===undefined){y3=0;}
            this.x1=x1;this.y1=y1;this.x2=x2;this.y2=y2;this.x3=x3;this.y3=y3;},contains:function(x,y)
        {return Contains(this,x,y);},getPoint:function(position,output)
        {return GetPoint(this,position,output);},getPoints:function(quantity,stepRate,output)
        {return GetPoints(this,quantity,stepRate,output);},getRandomPoint:function(point)
        {return Random(this,point);},setTo:function(x1,y1,x2,y2,x3,y3)
        {if(x1===undefined){x1=0;}
            if(y1===undefined){y1=0;}
            if(x2===undefined){x2=0;}
            if(y2===undefined){y2=0;}
            if(x3===undefined){x3=0;}
            if(y3===undefined){y3=0;}
            this.x1=x1;this.y1=y1;this.x2=x2;this.y2=y2;this.x3=x3;this.y3=y3;return this;},getLineA:function(line)
        {if(line===undefined){line=new Line();}
            line.setTo(this.x1,this.y1,this.x2,this.y2);return line;},getLineB:function(line)
        {if(line===undefined){line=new Line();}
            line.setTo(this.x2,this.y2,this.x3,this.y3);return line;},getLineC:function(line)
        {if(line===undefined){line=new Line();}
            line.setTo(this.x3,this.y3,this.x1,this.y1);return line;},left:{get:function()
            {return Math.min(this.x1,this.x2,this.x3);},set:function(value)
            {var diff=0;if(this.x1<=this.x2&&this.x1<=this.x3)
            {diff=this.x1-value;}
            else if(this.x2<=this.x1&&this.x2<=this.x3)
            {diff=this.x2-value;}
            else
            {diff=this.x3-value;}
                this.x1-=diff;this.x2-=diff;this.x3-=diff;}},right:{get:function()
            {return Math.max(this.x1,this.x2,this.x3);},set:function(value)
            {var diff=0;if(this.x1>=this.x2&&this.x1>=this.x3)
            {diff=this.x1-value;}
            else if(this.x2>=this.x1&&this.x2>=this.x3)
            {diff=this.x2-value;}
            else
            {diff=this.x3-value;}
                this.x1-=diff;this.x2-=diff;this.x3-=diff;}},top:{get:function()
            {return Math.min(this.y1,this.y2,this.y3);},set:function(value)
            {var diff=0;if(this.y1<=this.y2&&this.y1<=this.y3)
            {diff=this.y1-value;}
            else if(this.y2<=this.y1&&this.y2<=this.y3)
            {diff=this.y2-value;}
            else
            {diff=this.y3-value;}
                this.y1-=diff;this.y2-=diff;this.y3-=diff;}},bottom:{get:function()
            {return Math.max(this.y1,this.y2,this.y3);},set:function(value)
            {var diff=0;if(this.y1>=this.y2&&this.y1>=this.y3)
            {diff=this.y1-value;}
            else if(this.y2>=this.y1&&this.y2>=this.y3)
            {diff=this.y2-value;}
            else
            {diff=this.y3-value;}
                this.y1-=diff;this.y2-=diff;this.y3-=diff;}}});module.exports=Triangle;}),"./geom/triangle/index.js":(function(module,exports,__webpack_require__){var Triangle=__webpack_require__("./geom/triangle/Triangle.js");Triangle.Area=__webpack_require__("./geom/triangle/Area.js");Triangle.BuildEquilateral=__webpack_require__("./geom/triangle/BuildEquilateral.js");Triangle.BuildFromPolygon=__webpack_require__("./geom/triangle/BuildFromPolygon.js");Triangle.BuildRight=__webpack_require__("./geom/triangle/BuildRight.js");Triangle.CenterOn=__webpack_require__("./geom/triangle/CenterOn.js");Triangle.Centroid=__webpack_require__("./geom/triangle/Centroid.js");Triangle.CircumCenter=__webpack_require__("./geom/triangle/CircumCenter.js");Triangle.CircumCircle=__webpack_require__("./geom/triangle/CircumCircle.js");Triangle.Clone=__webpack_require__("./geom/triangle/Clone.js");Triangle.Contains=__webpack_require__("./geom/triangle/Contains.js");Triangle.ContainsArray=__webpack_require__("./geom/triangle/ContainsArray.js");Triangle.ContainsPoint=__webpack_require__("./geom/triangle/ContainsPoint.js");Triangle.CopyFrom=__webpack_require__("./geom/triangle/CopyFrom.js");Triangle.Decompose=__webpack_require__("./geom/triangle/Decompose.js");Triangle.Equals=__webpack_require__("./geom/triangle/Equals.js");Triangle.GetPoint=__webpack_require__("./geom/triangle/GetPoint.js");Triangle.GetPoints=__webpack_require__("./geom/triangle/GetPoints.js");Triangle.InCenter=__webpack_require__("./geom/triangle/InCenter.js");Triangle.Perimeter=__webpack_require__("./geom/triangle/Perimeter.js");Triangle.Offset=__webpack_require__("./geom/triangle/Offset.js");Triangle.Random=__webpack_require__("./geom/triangle/Random.js");Triangle.Rotate=__webpack_require__("./geom/triangle/Rotate.js");Triangle.RotateAroundPoint=__webpack_require__("./geom/triangle/RotateAroundPoint.js");Triangle.RotateAroundXY=__webpack_require__("./geom/triangle/RotateAroundXY.js");module.exports=Triangle;}),"./input/CreateInteractiveObject.js":(function(module,exports){var CreateInteractiveObject=function(gameObject,hitArea,hitAreaCallback)
    {return{gameObject:gameObject,enabled:true,draggable:false,dropZone:false,cursor:false,target:null,camera:null,hitArea:hitArea,hitAreaCallback:hitAreaCallback,localX:0,localY:0,dragState:0,dragStartX:0,dragStartY:0,dragX:0,dragY:0};};module.exports=CreateInteractiveObject;}),"./input/CreatePixelPerfectHandler.js":(function(module,exports){var CreatePixelPerfectHandler=function(textureManager,alphaTolerance)
    {return function(hitArea,x,y,gameObject)
    {var alpha=textureManager.getPixelAlpha(x,y,gameObject.texture.key,gameObject.frame.name);return(alpha&&alpha>=alphaTolerance);};};module.exports=CreatePixelPerfectHandler;}),"./input/InputManager.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var CONST=__webpack_require__("./input/const.js");var EventEmitter=__webpack_require__("../node_modules/eventemitter3/index.js");var Keyboard=__webpack_require__("./input/keyboard/KeyboardManager.js");var Mouse=__webpack_require__("./input/mouse/MouseManager.js");var Pointer=__webpack_require__("./input/Pointer.js");var Rectangle=__webpack_require__("./geom/rectangle/Rectangle.js");var Touch=__webpack_require__("./input/touch/TouchManager.js");var TransformMatrix=__webpack_require__("./gameobjects/components/TransformMatrix.js");var TransformXY=__webpack_require__("./math/TransformXY.js");var InputManager=new Class({initialize:function InputManager(game,config)
        {this.game=game;this.scaleManager;this.canvas;this.config=config;this.enabled=true;this.events=new EventEmitter();this.queue=[];this.domCallbacks={up:[],down:[],move:[],upOnce:[],downOnce:[],moveOnce:[]};this.isOver=true;this._emitIsOverEvent=false;this._hasUpCallback=false;this._hasDownCallback=false;this._hasMoveCallback=false;this._customCursor='';this._setCursor=0;this.defaultCursor='';this.keyboard=(config.inputKeyboard)?new Keyboard(this):null;this.mouse=(config.inputMouse)?new Mouse(this):null;this.touch=(config.inputTouch)?new Touch(this):null;this.pointers=[];this.pointersTotal=config.inputActivePointers;if(config.inputTouch&&this.pointersTotal===1)
        {this.pointersTotal=2;}
            for(var i=0;i<=this.pointersTotal;i++)
            {var pointer=new Pointer(this,i);pointer.smoothFactor=config.inputSmoothFactor;this.pointers.push(pointer);}
            this.mousePointer=(config.inputMouse)?this.pointers[0]:null;this.activePointer=this.pointers[0];this.dirty=false;this.globalTopOnly=true;this.ignoreEvents=false;this.bounds=new Rectangle();this._tempPoint={x:0,y:0};this._tempHitTest=[];this._tempMatrix=new TransformMatrix();this._tempMatrix2=new TransformMatrix();game.events.once('boot',this.boot,this);},boot:function()
        {this.canvas=this.game.canvas;this.scaleManager=this.game.scale;this.events.emit('boot');this.game.events.on('prestep',this.update,this);this.game.events.on('poststep',this.postUpdate,this);this.game.events.once('destroy',this.destroy,this);},setCanvasOver:function(event)
        {this.isOver=true;this._emitIsOverEvent=event;},setCanvasOut:function(event)
        {this.isOver=false;this._emitIsOverEvent=event;},update:function(time)
        {var i;this._setCursor=0;this.events.emit('update');this.ignoreEvents=false;this.dirty=false;var len=this.queue.length;var pointers=this.pointers;for(i=0;i<this.pointersTotal;i++)
        {pointers[i].reset(time);}
            if(!this.enabled||len===0)
            {for(i=0;i<this.pointersTotal;i++)
            {pointers[i].updateMotion();}
                return;}
            this.dirty=true;var queue=this.queue.splice(0,len);var mouse=this.mousePointer;for(i=0;i<len;i+=2)
        {var type=queue[i];var event=queue[i+1];switch(type)
        {case CONST.MOUSE_DOWN:mouse.down(event,time);break;case CONST.MOUSE_MOVE:mouse.move(event,time);break;case CONST.MOUSE_UP:mouse.up(event,time);break;case CONST.TOUCH_START:this.startPointer(event,time);break;case CONST.TOUCH_MOVE:this.updatePointer(event,time);break;case CONST.TOUCH_END:this.stopPointer(event,time);break;case CONST.TOUCH_CANCEL:this.cancelPointer(event,time);break;case CONST.POINTER_LOCK_CHANGE:this.events.emit('pointerlockchange',event,this.mouse.locked);break;}}
            for(i=0;i<this.pointersTotal;i++)
            {pointers[i].updateMotion();}},postUpdate:function()
        {if(this._setCursor===1)
        {this.canvas.style.cursor=this._customCursor;}
        else if(this._setCursor===2)
        {this.canvas.style.cursor=this.defaultCursor;}
            this._emitIsOverEvent=null;},setDefaultCursor:function(cursor)
        {this.defaultCursor=cursor;if(this.canvas.style.cursor!==cursor)
        {this.canvas.style.cursor=cursor;}},setCursor:function(interactiveObject)
        {if(interactiveObject.cursor)
        {this._setCursor=1;this._customCursor=interactiveObject.cursor;}},resetCursor:function(interactiveObject)
        {if(interactiveObject.cursor)
        {this._setCursor=2;}},startPointer:function(event,time)
        {var pointers=this.pointers;for(var c=0;c<event.changedTouches.length;c++)
        {var changedTouch=event.changedTouches[c];for(var i=1;i<this.pointersTotal;i++)
        {var pointer=pointers[i];if(!pointer.active)
        {pointer.touchstart(changedTouch,time);this.activePointer=pointer;break;}}}},updatePointer:function(event,time)
        {var pointers=this.pointers;for(var c=0;c<event.changedTouches.length;c++)
        {var changedTouch=event.changedTouches[c];for(var i=1;i<this.pointersTotal;i++)
        {var pointer=pointers[i];if(pointer.active&&pointer.identifier===changedTouch.identifier)
        {pointer.touchmove(changedTouch,time);this.activePointer=pointer;break;}}}},stopPointer:function(event,time)
        {var pointers=this.pointers;for(var c=0;c<event.changedTouches.length;c++)
        {var changedTouch=event.changedTouches[c];for(var i=1;i<this.pointersTotal;i++)
        {var pointer=pointers[i];if(pointer.active&&pointer.identifier===changedTouch.identifier)
        {pointer.touchend(changedTouch,time);break;}}}},cancelPointer:function(event,time)
        {var pointers=this.pointers;for(var c=0;c<event.changedTouches.length;c++)
        {var changedTouch=event.changedTouches[c];for(var i=1;i<this.pointersTotal;i++)
        {var pointer=pointers[i];if(pointer.active&&pointer.identifier===changedTouch.identifier)
        {pointer.touchend(changedTouch,time);break;}}}},addPointer:function(quantity)
        {if(quantity===undefined){quantity=1;}
            var output=[];if(this.pointersTotal+quantity>10)
        {quantity=10-this.pointersTotal;}
            for(var i=0;i<quantity;i++)
            {var id=this.pointers.length;var pointer=new Pointer(this,id);pointer.smoothFactor=this.config.inputSmoothFactor;this.pointers.push(pointer);this.pointersTotal++;output.push(pointer);}
            return output;},processDomCallbacks:function(once,every,event)
        {var i=0;for(i=0;i<once.length;i++)
        {once[i](event);}
            for(i=0;i<every.length;i++)
            {every[i](event);}
            return(every.length>0);},queueTouchStart:function(event)
        {this.queue.push(CONST.TOUCH_START,event);if(this._hasDownCallback)
        {var callbacks=this.domCallbacks;this._hasDownCallback=this.processDomCallbacks(callbacks.downOnce,callbacks.down,event);callbacks.downOnce=[];}},queueTouchMove:function(event)
        {this.queue.push(CONST.TOUCH_MOVE,event);if(this._hasMoveCallback)
        {var callbacks=this.domCallbacks;this._hasMoveCallback=this.processDomCallbacks(callbacks.moveOnce,callbacks.move,event);callbacks.moveOnce=[];}},queueTouchEnd:function(event)
        {this.queue.push(CONST.TOUCH_END,event);if(this._hasUpCallback)
        {var callbacks=this.domCallbacks;this._hasUpCallback=this.processDomCallbacks(callbacks.upOnce,callbacks.up,event);callbacks.upOnce=[];}},queueTouchCancel:function(event)
        {this.queue.push(CONST.TOUCH_CANCEL,event);},queueMouseDown:function(event)
        {this.queue.push(CONST.MOUSE_DOWN,event);if(this._hasDownCallback)
        {var callbacks=this.domCallbacks;this._hasDownCallback=this.processDomCallbacks(callbacks.downOnce,callbacks.down,event);callbacks.downOnce=[];}},queueMouseMove:function(event)
        {this.queue.push(CONST.MOUSE_MOVE,event);if(this._hasMoveCallback)
        {var callbacks=this.domCallbacks;this._hasMoveCallback=this.processDomCallbacks(callbacks.moveOnce,callbacks.move,event);callbacks.moveOnce=[];}},queueMouseUp:function(event)
        {this.queue.push(CONST.MOUSE_UP,event);if(this._hasUpCallback)
        {var callbacks=this.domCallbacks;this._hasUpCallback=this.processDomCallbacks(callbacks.upOnce,callbacks.up,event);callbacks.upOnce=[];}},addUpCallback:function(callback,isOnce)
        {if(isOnce===undefined){isOnce=true;}
            if(isOnce)
            {this.domCallbacks.upOnce.push(callback);}
            else
            {this.domCallbacks.up.push(callback);}
            this._hasUpCallback=true;return this;},addDownCallback:function(callback,isOnce)
        {if(isOnce===undefined){isOnce=true;}
            if(isOnce)
            {this.domCallbacks.downOnce.push(callback);}
            else
            {this.domCallbacks.down.push(callback);}
            this._hasDownCallback=true;return this;},addMoveCallback:function(callback,isOnce)
        {if(isOnce===undefined){isOnce=false;}
            if(isOnce)
            {this.domCallbacks.moveOnce.push(callback);}
            else
            {this.domCallbacks.move.push(callback);}
            this._hasMoveCallback=true;return this;},inputCandidate:function(gameObject,camera)
        {var input=gameObject.input;if(!input||!input.enabled||!gameObject.willRender(camera))
        {return false;}
            var visible=true;var parent=gameObject.parentContainer;if(parent)
        {do
        {if(!parent.willRender(camera))
        {visible=false;break;}
            parent=parent.parentContainer;}while(parent);}
            return visible;},hitTest:function(pointer,gameObjects,camera,output)
        {if(output===undefined){output=this._tempHitTest;}
            var tempPoint=this._tempPoint;var csx=camera.scrollX;var csy=camera.scrollY;output.length=0;var x=pointer.x;var y=pointer.y;if(camera.resolution!==1)
        {x+=camera._x;y+=camera._y;}
            camera.getWorldPoint(x,y,tempPoint);pointer.worldX=tempPoint.x;pointer.worldY=tempPoint.y;var point={x:0,y:0};var matrix=this._tempMatrix;var parentMatrix=this._tempMatrix2;for(var i=0;i<gameObjects.length;i++)
        {var gameObject=gameObjects[i];if(!this.inputCandidate(gameObject,camera))
        {continue;}
            var px=tempPoint.x+(csx*gameObject.scrollFactorX)-csx;var py=tempPoint.y+(csy*gameObject.scrollFactorY)-csy;if(gameObject.parentContainer)
        {gameObject.getWorldTransformMatrix(matrix,parentMatrix);matrix.applyInverse(px,py,point);}
        else
        {TransformXY(px,py,gameObject.x,gameObject.y,gameObject.rotation,gameObject.scaleX,gameObject.scaleY,point);}
            if(this.pointWithinHitArea(gameObject,point.x,point.y))
            {output.push(gameObject);}}
            return output;},pointWithinHitArea:function(gameObject,x,y)
        {x+=gameObject.displayOriginX;y+=gameObject.displayOriginY;var input=gameObject.input;if(input&&input.hitAreaCallback(input.hitArea,x,y,gameObject))
        {input.localX=x;input.localY=y;return true;}
        else
        {return false;}},pointWithinInteractiveObject:function(object,x,y)
        {if(!object.hitArea)
        {return false;}
            x+=object.gameObject.displayOriginX;y+=object.gameObject.displayOriginY;object.localX=x;object.localY=y;return object.hitAreaCallback(object.hitArea,x,y,object);},transformPointer:function(pointer,pageX,pageY,wasMove)
        {var p0=pointer.position;var p1=pointer.prevPosition;p1.x=p0.x;p1.y=p0.y;var x=this.scaleManager.transformX(pageX);var y=this.scaleManager.transformY(pageY);var a=pointer.smoothFactor;if(!wasMove||a===0)
        {p0.x=x;p0.y=y;}
        else
        {p0.x=x*a+p1.x*(1-a);p0.y=y*a+p1.y*(1-a);}},destroy:function()
        {this.events.removeAllListeners();if(this.keyboard)
        {this.keyboard.destroy();}
            if(this.mouse)
            {this.mouse.destroy();}
            if(this.touch)
            {this.touch.destroy();}
            for(var i=0;i<this.pointers.length;i++)
            {this.pointers[i].destroy();}
            this.domCallbacks={};this.pointers=[];this.queue=[];this._tempHitTest=[];this._tempMatrix.destroy();this.canvas=null;this.game=null;}});module.exports=InputManager;}),"./input/InputPlugin.js":(function(module,exports,__webpack_require__){var Circle=__webpack_require__("./geom/circle/Circle.js");var CircleContains=__webpack_require__("./geom/circle/Contains.js");var Class=__webpack_require__("./utils/Class.js");var CreateInteractiveObject=__webpack_require__("./input/CreateInteractiveObject.js");var CreatePixelPerfectHandler=__webpack_require__("./input/CreatePixelPerfectHandler.js");var DistanceBetween=__webpack_require__("./math/distance/DistanceBetween.js");var Ellipse=__webpack_require__("./geom/ellipse/Ellipse.js");var EllipseContains=__webpack_require__("./geom/ellipse/Contains.js");var EventEmitter=__webpack_require__("../node_modules/eventemitter3/index.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var InputPluginCache=__webpack_require__("./input/InputPluginCache.js");var IsPlainObject=__webpack_require__("./utils/object/IsPlainObject.js");var PluginCache=__webpack_require__("./plugins/PluginCache.js");var Rectangle=__webpack_require__("./geom/rectangle/Rectangle.js");var RectangleContains=__webpack_require__("./geom/rectangle/Contains.js");var Triangle=__webpack_require__("./geom/triangle/Triangle.js");var TriangleContains=__webpack_require__("./geom/triangle/Contains.js");var InputPlugin=new Class({Extends:EventEmitter,initialize:function InputPlugin(scene)
        {EventEmitter.call(this);this.scene=scene;this.systems=scene.sys;this.settings=scene.sys.settings;this.manager=scene.sys.game.input;this.pluginEvents=new EventEmitter();this.enabled=true;this.displayList;this.cameras;InputPluginCache.install(this);this.mouse=this.manager.mouse;this.topOnly=true;this.pollRate=-1;this._pollTimer=0;var _eventData={cancelled:false};this._eventContainer={stopPropagation:function()
            {_eventData.cancelled=true;}};this._eventData=_eventData;this.dragDistanceThreshold=0;this.dragTimeThreshold=0;this._temp=[];this._tempZones=[];this._list=[];this._pendingInsertion=[];this._pendingRemoval=[];this._draggable=[];this._drag={0:[],1:[],2:[],3:[],4:[],5:[],6:[],7:[],8:[],9:[],10:[]};this._dragState=[];this._over={0:[],1:[],2:[],3:[],4:[],5:[],6:[],7:[],8:[],9:[],10:[]};this._validTypes=['onDown','onUp','onOver','onOut','onMove','onDragStart','onDrag','onDragEnd','onDragEnter','onDragLeave','onDragOver','onDrop'];scene.sys.events.once('boot',this.boot,this);scene.sys.events.on('start',this.start,this);},boot:function()
        {this.cameras=this.systems.cameras;this.displayList=this.systems.displayList;this.systems.events.once('destroy',this.destroy,this);this.pluginEvents.emit('boot');},start:function()
        {var eventEmitter=this.systems.events;eventEmitter.on('transitionstart',this.transitionIn,this);eventEmitter.on('transitionout',this.transitionOut,this);eventEmitter.on('transitioncomplete',this.transitionComplete,this);eventEmitter.on('preupdate',this.preUpdate,this);eventEmitter.on('update',this.update,this);eventEmitter.once('shutdown',this.shutdown,this);this.enabled=true;this._dragState=[0,0,0,0,0,0,0,0,0,0];this.pluginEvents.emit('start');},preUpdate:function()
        {this.pluginEvents.emit('preupdate');var removeList=this._pendingRemoval;var insertList=this._pendingInsertion;var toRemove=removeList.length;var toInsert=insertList.length;if(toRemove===0&&toInsert===0)
        {return;}
            var current=this._list;for(var i=0;i<toRemove;i++)
        {var gameObject=removeList[i];var index=current.indexOf(gameObject);if(index>-1)
        {current.splice(index,1);this.clear(gameObject);}}
            removeList.length=0;this._pendingRemoval.length=0;this._list=current.concat(insertList.splice(0));},isActive:function()
        {return(this.enabled&&this.scene.sys.isActive());},update:function(time,delta)
        {if(!this.isActive())
        {return;}
            var manager=this.manager;this.pluginEvents.emit('update',time,delta);if(manager.globalTopOnly&&manager.ignoreEvents)
        {return;}
            if(manager._emitIsOverEvent)
            {var event=(manager.isOver)?'gameover':'gameout';this.emit(event,time,manager._emitIsOverEvent);}
            var runUpdate=(manager.dirty||this.pollRate===0);if(this.pollRate>-1)
        {this._pollTimer-=delta;if(this._pollTimer<0)
        {runUpdate=true;this._pollTimer=this.pollRate;}}
            if(!runUpdate)
            {return;}
            var pointers=this.manager.pointers;for(var i=0;i<this.manager.pointersTotal;i++)
        {var pointer=pointers[i];this._tempZones=[];this._temp=this.hitTestPointer(pointer);this.sortGameObjects(this._temp);this.sortGameObjects(this._tempZones);if(this.topOnly)
        {if(this._temp.length)
        {this._temp.splice(1);}
            if(this._tempZones.length)
            {this._tempZones.splice(1);}}
            var total=this.processDragEvents(pointer,time);if(!pointer.wasTouch)
        {total+=this.processOverOutEvents(pointer);}
            if(pointer.justDown)
            {total+=this.processDownEvents(pointer);}
            if(pointer.justMoved)
            {total+=this.processMoveEvents(pointer);}
            if(pointer.justUp)
            {total+=this.processUpEvents(pointer);}
            if(total>0&&manager.globalTopOnly)
            {manager.ignoreEvents=true;}}},clear:function(gameObject)
        {var input=gameObject.input;if(!input)
        {return;}
            this.queueForRemoval(gameObject);input.gameObject=undefined;input.target=undefined;input.hitArea=undefined;input.hitAreaCallback=undefined;input.callbackContext=undefined;this.manager.resetCursor(input);gameObject.input=null;var index=this._draggable.indexOf(gameObject);if(index>-1)
        {this._draggable.splice(index,1);}
            index=this._drag[0].indexOf(gameObject);if(index>-1)
        {this._drag[0].splice(index,1);}
            index=this._over[0].indexOf(gameObject);if(index>-1)
        {this._over[0].splice(index,1);}
            return gameObject;},disable:function(gameObject)
        {gameObject.input.enabled=false;},enable:function(gameObject,shape,callback,dropZone)
        {if(dropZone===undefined){dropZone=false;}
            if(gameObject.input)
            {gameObject.input.enabled=true;}
            else
            {this.setHitArea(gameObject,shape,callback);}
            if(gameObject.input&&dropZone&&!gameObject.input.dropZone)
            {gameObject.input.dropZone=dropZone;}
            return this;},hitTestPointer:function(pointer)
        {var cameras=this.cameras.getCamerasBelowPointer(pointer);for(var c=0;c<cameras.length;c++)
        {var camera=cameras[c];var over=this.manager.hitTest(pointer,this._list,camera);for(var i=0;i<over.length;i++)
        {var obj=over[i];if(obj.input.dropZone)
        {this._tempZones.push(obj);}}
            if(over.length>0)
            {pointer.camera=camera;return over;}}
            pointer.camera=cameras[0];return[];},processDownEvents:function(pointer)
        {var total=0;var currentlyOver=this._temp;var _eventData=this._eventData;var _eventContainer=this._eventContainer;_eventData.cancelled=false;var aborted=false;for(var i=0;i<currentlyOver.length;i++)
        {var gameObject=currentlyOver[i];if(!gameObject.input)
        {continue;}
            total++;gameObject.emit('pointerdown',pointer,gameObject.input.localX,gameObject.input.localY,_eventContainer);if(_eventData.cancelled)
        {aborted=true;break;}
            this.emit('gameobjectdown',pointer,gameObject,_eventContainer);if(_eventData.cancelled)
        {aborted=true;break;}}
            if(!aborted)
            {var type=(pointer.downElement===this.manager.game.canvas)?'pointerdown':'pointerdownoutside';this.emit(type,pointer,currentlyOver);}
            return total;},getDragState:function(pointer)
        {return this._dragState[pointer.id];},setDragState:function(pointer,state)
        {this._dragState[pointer.id]=state;},processDragEvents:function(pointer,time)
        {if(this._draggable.length===0)
        {return 0;}
            var i;var gameObject;var list;var input;var currentlyOver=this._temp;if(this.getDragState(pointer)===0&&pointer.primaryDown&&pointer.justDown&&currentlyOver.length>0)
        {this.setDragState(pointer,1);}
        else if(this.getDragState(pointer)>0&&!pointer.primaryDown&&pointer.justUp)
        {this.setDragState(pointer,5);}
            if(this.getDragState(pointer)===1)
            {var draglist=[];for(i=0;i<currentlyOver.length;i++)
            {gameObject=currentlyOver[i];if(gameObject.input.draggable&&(gameObject.input.dragState===0))
            {draglist.push(gameObject);}}
                if(draglist.length===0)
                {this.setDragState(pointer,0);return 0;}
                else if(draglist.length>1)
                {this.sortGameObjects(draglist);if(this.topOnly)
                {draglist.splice(1);}}
                this._drag[pointer.id]=draglist;if(this.dragDistanceThreshold===0&&this.dragTimeThreshold===0)
            {this.setDragState(pointer,3);}
            else
            {this.setDragState(pointer,2);}}
            if(this.getDragState(pointer)===2)
            {if(this.dragDistanceThreshold>0&&DistanceBetween(pointer.x,pointer.y,pointer.downX,pointer.downY)>=this.dragDistanceThreshold)
            {this.setDragState(pointer,3);}
                if(this.dragTimeThreshold>0&&(time>=pointer.downTime+this.dragTimeThreshold))
                {this.setDragState(pointer,3);}}
            if(this.getDragState(pointer)===3)
            {list=this._drag[pointer.id];for(i=0;i<list.length;i++)
            {gameObject=list[i];input=gameObject.input;input.dragState=2;input.dragX=pointer.x-gameObject.x;input.dragY=pointer.y-gameObject.y;input.dragStartX=gameObject.x;input.dragStartY=gameObject.y;gameObject.emit('dragstart',pointer,input.dragX,input.dragY);this.emit('dragstart',pointer,gameObject);}
                this.setDragState(pointer,4);return list.length;}
            if(this.getDragState(pointer)===4&&pointer.justMoved&&!pointer.justUp)
            {var dropZones=this._tempZones;list=this._drag[pointer.id];for(i=0;i<list.length;i++)
            {gameObject=list[i];input=gameObject.input;if(input.target)
            {var index=dropZones.indexOf(input.target);if(index===0)
            {gameObject.emit('dragover',pointer,input.target);this.emit('dragover',pointer,gameObject,input.target);}
            else if(index>0)
            {gameObject.emit('dragleave',pointer,input.target);this.emit('dragleave',pointer,gameObject,input.target);input.target=dropZones[0];gameObject.emit('dragenter',pointer,input.target);this.emit('dragenter',pointer,gameObject,input.target);}
            else
            {gameObject.emit('dragleave',pointer,input.target);this.emit('dragleave',pointer,gameObject,input.target);if(dropZones[0])
            {input.target=dropZones[0];gameObject.emit('dragenter',pointer,input.target);this.emit('dragenter',pointer,gameObject,input.target);}
            else
            {input.target=null;}}}
            else if(!input.target&&dropZones[0])
            {input.target=dropZones[0];gameObject.emit('dragenter',pointer,input.target);this.emit('dragenter',pointer,gameObject,input.target);}
                var dragX=pointer.x-gameObject.input.dragX;var dragY=pointer.y-gameObject.input.dragY;gameObject.emit('drag',pointer,dragX,dragY);this.emit('drag',pointer,gameObject,dragX,dragY);}
                return list.length;}
            if(this.getDragState(pointer)===5)
            {list=this._drag[pointer.id];for(i=0;i<list.length;i++)
            {gameObject=list[i];input=gameObject.input;if(input.dragState===2)
            {input.dragState=0;input.dragX=input.localX-gameObject.displayOriginX;input.dragY=input.localY-gameObject.displayOriginY;var dropped=false;if(input.target)
            {gameObject.emit('drop',pointer,input.target);this.emit('drop',pointer,gameObject,input.target);input.target=null;dropped=true;}
                gameObject.emit('dragend',pointer,input.dragX,input.dragY,dropped);this.emit('dragend',pointer,gameObject,dropped);}}
                this.setDragState(pointer,0);list.splice(0);}
            return 0;},processMoveEvents:function(pointer)
        {var total=0;var currentlyOver=this._temp;var _eventData=this._eventData;var _eventContainer=this._eventContainer;_eventData.cancelled=false;var aborted=false;for(var i=0;i<currentlyOver.length;i++)
        {var gameObject=currentlyOver[i];if(!gameObject.input)
        {continue;}
            total++;gameObject.emit('pointermove',pointer,gameObject.input.localX,gameObject.input.localY,_eventContainer);if(_eventData.cancelled)
        {aborted=true;break;}
            this.emit('gameobjectmove',pointer,gameObject,_eventContainer);if(_eventData.cancelled)
        {aborted=true;break;}
            if(this.topOnly)
            {break;}}
            if(!aborted)
            {this.emit('pointermove',pointer,currentlyOver);}
            return total;},processOverOutEvents:function(pointer)
        {var currentlyOver=this._temp;var i;var gameObject;var justOut=[];var justOver=[];var stillOver=[];var previouslyOver=this._over[pointer.id];var currentlyDragging=this._drag[pointer.id];var manager=this.manager;for(i=0;i<previouslyOver.length;i++)
        {gameObject=previouslyOver[i];if(currentlyOver.indexOf(gameObject)===-1&&currentlyDragging.indexOf(gameObject)===-1)
        {justOut.push(gameObject);}
        else
        {stillOver.push(gameObject);}}
            for(i=0;i<currentlyOver.length;i++)
            {gameObject=currentlyOver[i];if(previouslyOver.indexOf(gameObject)===-1)
            {justOver.push(gameObject);}}
            var total=justOut.length;var totalInteracted=0;var _eventData=this._eventData;var _eventContainer=this._eventContainer;_eventData.cancelled=false;var aborted=false;if(total>0)
        {this.sortGameObjects(justOut);for(i=0;i<total;i++)
        {gameObject=justOut[i];if(!gameObject.input)
        {continue;}
            gameObject.emit('pointerout',pointer,_eventContainer);manager.resetCursor(gameObject.input);totalInteracted++;if(_eventData.cancelled)
        {aborted=true;break;}
            this.emit('gameobjectout',pointer,gameObject,_eventContainer);if(_eventData.cancelled)
        {aborted=true;break;}}
            if(!aborted)
            {this.emit('pointerout',pointer,justOut);}}
            total=justOver.length;_eventData.cancelled=false;aborted=false;if(total>0)
        {this.sortGameObjects(justOver);for(i=0;i<total;i++)
        {gameObject=justOver[i];if(!gameObject.input)
        {continue;}
            gameObject.emit('pointerover',pointer,gameObject.input.localX,gameObject.input.localY,_eventContainer);manager.setCursor(gameObject.input);totalInteracted++;if(_eventData.cancelled)
        {aborted=true;break;}
            this.emit('gameobjectover',pointer,gameObject,_eventContainer);if(_eventData.cancelled)
        {aborted=true;break;}}
            if(!aborted)
            {this.emit('pointerover',pointer,justOver);}}
            previouslyOver=stillOver.concat(justOver);this._over[pointer.id]=this.sortGameObjects(previouslyOver);return totalInteracted;},processUpEvents:function(pointer)
        {var currentlyOver=this._temp;var _eventData=this._eventData;var _eventContainer=this._eventContainer;_eventData.cancelled=false;var aborted=false;for(var i=0;i<currentlyOver.length;i++)
        {var gameObject=currentlyOver[i];if(!gameObject.input)
        {continue;}
            gameObject.emit('pointerup',pointer,gameObject.input.localX,gameObject.input.localY,_eventContainer);if(_eventData.cancelled)
        {aborted=true;break;}
            this.emit('gameobjectup',pointer,gameObject,_eventContainer);if(_eventData.cancelled)
        {aborted=true;break;}}
            if(!aborted)
            {var type=(pointer.upElement===this.manager.game.canvas)?'pointerup':'pointerupoutside';this.emit(type,pointer,currentlyOver);}
            return currentlyOver.length;},queueForInsertion:function(child)
        {if(this._pendingInsertion.indexOf(child)===-1&&this._list.indexOf(child)===-1)
        {this._pendingInsertion.push(child);}
            return this;},queueForRemoval:function(child)
        {this._pendingRemoval.push(child);return this;},setDraggable:function(gameObjects,value)
        {if(value===undefined){value=true;}
            if(!Array.isArray(gameObjects))
            {gameObjects=[gameObjects];}
            for(var i=0;i<gameObjects.length;i++)
            {var gameObject=gameObjects[i];gameObject.input.draggable=value;var index=this._draggable.indexOf(gameObject);if(value&&index===-1)
            {this._draggable.push(gameObject);}
            else if(!value&&index>-1)
            {this._draggable.splice(index,1);}}
            return this;},makePixelPerfect:function(alphaTolerance)
        {if(alphaTolerance===undefined){alphaTolerance=1;}
            var textureManager=this.systems.textures;return CreatePixelPerfectHandler(textureManager,alphaTolerance);},setHitArea:function(gameObjects,shape,callback)
        {if(shape===undefined)
        {return this.setHitAreaFromTexture(gameObjects);}
            if(!Array.isArray(gameObjects))
            {gameObjects=[gameObjects];}
            var draggable=false;var dropZone=false;var cursor=false;var useHandCursor=false;if(IsPlainObject(shape))
        {var config=shape;shape=GetFastValue(config,'hitArea',null);callback=GetFastValue(config,'hitAreaCallback',null);draggable=GetFastValue(config,'draggable',false);dropZone=GetFastValue(config,'dropZone',false);cursor=GetFastValue(config,'cursor',false);useHandCursor=GetFastValue(config,'useHandCursor',false);var pixelPerfect=GetFastValue(config,'pixelPerfect',false);var alphaTolerance=GetFastValue(config,'alphaTolerance',1);if(pixelPerfect)
        {shape={};callback=this.makePixelPerfect(alphaTolerance);}
            if(!shape||!callback)
            {this.setHitAreaFromTexture(gameObjects);}}
        else if(typeof shape==='function'&&!callback)
        {callback=shape;shape={};}
            for(var i=0;i<gameObjects.length;i++)
            {var gameObject=gameObjects[i];var io=(!gameObject.input)?CreateInteractiveObject(gameObject,shape,callback):gameObject.input;io.dropZone=dropZone;io.cursor=(useHandCursor)?'pointer':cursor;gameObject.input=io;if(draggable)
            {this.setDraggable(gameObject);}
                this.queueForInsertion(gameObject);}
            return this;},setHitAreaCircle:function(gameObjects,x,y,radius,callback)
        {if(callback===undefined){callback=CircleContains;}
            var shape=new Circle(x,y,radius);return this.setHitArea(gameObjects,shape,callback);},setHitAreaEllipse:function(gameObjects,x,y,width,height,callback)
        {if(callback===undefined){callback=EllipseContains;}
            var shape=new Ellipse(x,y,width,height);return this.setHitArea(gameObjects,shape,callback);},setHitAreaFromTexture:function(gameObjects,callback)
        {if(callback===undefined){callback=RectangleContains;}
            if(!Array.isArray(gameObjects))
            {gameObjects=[gameObjects];}
            for(var i=0;i<gameObjects.length;i++)
            {var gameObject=gameObjects[i];var frame=gameObject.frame;var width=0;var height=0;if(gameObject.width)
            {width=gameObject.width;height=gameObject.height;}
            else if(frame)
            {width=frame.realWidth;height=frame.realHeight;}
                if(gameObject.type==='Container'&&(width===0||height===0))
                {console.warn('Container.setInteractive must specify a Shape or call setSize() first');continue;}
                if(width!==0&&height!==0)
                {gameObject.input=CreateInteractiveObject(gameObject,new Rectangle(0,0,width,height),callback);this.queueForInsertion(gameObject);}}
            return this;},setHitAreaRectangle:function(gameObjects,x,y,width,height,callback)
        {if(callback===undefined){callback=RectangleContains;}
            var shape=new Rectangle(x,y,width,height);return this.setHitArea(gameObjects,shape,callback);},setHitAreaTriangle:function(gameObjects,x1,y1,x2,y2,x3,y3,callback)
        {if(callback===undefined){callback=TriangleContains;}
            var shape=new Triangle(x1,y1,x2,y2,x3,y3);return this.setHitArea(gameObjects,shape,callback);},setPollAlways:function()
        {this.pollRate=0;this._pollTimer=0;return this;},setPollOnMove:function()
        {this.pollRate=-1;this._pollTimer=0;return this;},setPollRate:function(value)
        {this.pollRate=value;this._pollTimer=0;return this;},setGlobalTopOnly:function(value)
        {this.manager.globalTopOnly=value;return this;},setTopOnly:function(value)
        {this.topOnly=value;return this;},sortGameObjects:function(gameObjects)
        {if(gameObjects.length<2)
        {return gameObjects;}
            this.scene.sys.depthSort();return gameObjects.sort(this.sortHandlerGO.bind(this));},sortHandlerGO:function(childA,childB)
        {if(!childA.parentContainer&&!childB.parentContainer)
        {return this.displayList.getIndex(childB)-this.displayList.getIndex(childA);}
        else if(childA.parentContainer===childB.parentContainer)
        {return childB.parentContainer.getIndex(childB)-childA.parentContainer.getIndex(childA);}
        else if(childA.parentContainer===childB)
        {return-1;}
        else if(childB.parentContainer===childA)
        {return 1;}
        else
        {var listA=childA.getIndexList();var listB=childB.getIndexList();var len=Math.min(listA.length,listB.length);for(var i=0;i<len;i++)
        {var indexA=listA[i];var indexB=listB[i];if(indexA===indexB)
        {continue;}
        else
        {return indexB-indexA;}}}
            return 0;},stopPropagation:function()
        {if(this.manager.globalTopOnly)
        {this.manager.ignoreEvents=true;}
            return this;},addUpCallback:function(callback,isOnce)
        {this.manager.addUpCallback(callback,isOnce);return this;},addDownCallback:function(callback,isOnce)
        {this.manager.addDownCallback(callback,isOnce);return this;},addMoveCallback:function(callback,isOnce)
        {this.manager.addMoveCallback(callback,isOnce);return this;},addPointer:function(quantity)
        {return this.manager.addPointer(quantity);},setDefaultCursor:function(cursor)
        {this.manager.setDefaultCursor(cursor);return this;},transitionIn:function()
        {this.enabled=this.settings.transitionAllowInput;},transitionComplete:function()
        {if(!this.settings.transitionAllowInput)
        {this.enabled=true;}},transitionOut:function()
        {this.enabled=this.settings.transitionAllowInput;},shutdown:function()
        {this.pluginEvents.emit('shutdown');this._temp.length=0;this._list.length=0;this._draggable.length=0;this._pendingRemoval.length=0;this._pendingInsertion.length=0;this._dragState.length=0;for(var i=0;i<10;i++)
        {this._drag[i]=[];this._over[i]=[];}
            this.removeAllListeners();var eventEmitter=this.systems.events;eventEmitter.off('transitionstart',this.transitionIn,this);eventEmitter.off('transitionout',this.transitionOut,this);eventEmitter.off('transitioncomplete',this.transitionComplete,this);eventEmitter.off('preupdate',this.preUpdate,this);eventEmitter.off('update',this.update,this);eventEmitter.off('shutdown',this.shutdown,this);},destroy:function()
        {this.shutdown();this.pluginEvents.emit('destroy');this.pluginEvents.removeAllListeners();this.scene.sys.events.off('start',this.start,this);this.scene=null;this.cameras=null;this.manager=null;this.events=null;this.mouse=null;},x:{get:function()
            {return this.manager.activePointer.x;}},y:{get:function()
            {return this.manager.activePointer.y;}},isOver:{get:function()
            {return this.manager.isOver;}},mousePointer:{get:function()
            {return this.manager.mousePointer;}},activePointer:{get:function()
            {return this.manager.activePointer;}},pointer1:{get:function()
            {return this.manager.pointers[1];}},pointer2:{get:function()
            {return this.manager.pointers[2];}},pointer3:{get:function()
            {return this.manager.pointers[3];}},pointer4:{get:function()
            {return this.manager.pointers[4];}},pointer5:{get:function()
            {return this.manager.pointers[5];}},pointer6:{get:function()
            {return this.manager.pointers[6];}},pointer7:{get:function()
            {return this.manager.pointers[7];}},pointer8:{get:function()
            {return this.manager.pointers[8];}},pointer9:{get:function()
            {return this.manager.pointers[9];}},pointer10:{get:function()
            {return this.manager.pointers[10];}}});PluginCache.register('InputPlugin',InputPlugin,'input');module.exports=InputPlugin;}),"./input/InputPluginCache.js":(function(module,exports,__webpack_require__){var GetValue=__webpack_require__("./utils/object/GetValue.js");var inputPlugins={};var InputPluginCache={};InputPluginCache.register=function(key,plugin,mapping,settingsKey,configKey)
    {inputPlugins[key]={plugin:plugin,mapping:mapping,settingsKey:settingsKey,configKey:configKey};};InputPluginCache.getPlugin=function(key)
    {return inputPlugins[key];};InputPluginCache.install=function(target)
    {var sys=target.scene.sys;var settings=sys.settings.input;var config=sys.game.config;for(var key in inputPlugins)
    {var source=inputPlugins[key].plugin;var mapping=inputPlugins[key].mapping;var settingsKey=inputPlugins[key].settingsKey;var configKey=inputPlugins[key].configKey;if(GetValue(settings,settingsKey,config[configKey]))
    {target[mapping]=new source(target);}}};InputPluginCache.remove=function(key)
    {if(inputPlugins.hasOwnProperty(key))
    {delete inputPlugins[key];}};module.exports=InputPluginCache;}),"./input/Pointer.js":(function(module,exports,__webpack_require__){var Angle=__webpack_require__("./math/angle/Between.js");var Class=__webpack_require__("./utils/Class.js");var Distance=__webpack_require__("./math/distance/DistanceBetween.js");var FuzzyEqual=__webpack_require__("./math/fuzzy/Equal.js");var SmoothStepInterpolation=__webpack_require__("./math/interpolation/SmoothStepInterpolation.js");var Vector2=__webpack_require__("./math/Vector2.js");var Pointer=new Class({initialize:function Pointer(manager,id)
        {this.manager=manager;this.id=id;this.event;this.downElement;this.upElement;this.camera=null;this.buttons=0;this.position=new Vector2();this.prevPosition=new Vector2();this.midPoint=new Vector2(-1,-1);this.velocity=new Vector2();this.angle=0;this.distance=0;this.smoothFactor=0;this.motionFactor=0.2;this.worldX=0;this.worldY=0;this.moveTime=0;this.downX=0;this.downY=0;this.downTime=0;this.upX=0;this.upY=0;this.upTime=0;this.primaryDown=false;this.isDown=false;this.dirty=false;this.justDown=false;this.justUp=false;this.justMoved=false;this.wasTouch=false;this.wasCanceled=false;this.movementX=0;this.movementY=0;this.identifier=0;this.pointerId=null;this.active=(id===0)?true:false;this.time=0;},positionToCamera:function(camera,output)
        {return camera.getWorldPoint(this.x,this.y,output);},reset:function(time)
        {this.dirty=false;this.justDown=false;this.justUp=false;this.justMoved=false;this.time=time;this.movementX=0;this.movementY=0;},updateMotion:function()
        {var cx=this.position.x;var cy=this.position.y;var mx=this.midPoint.x;var my=this.midPoint.y;if(cx===mx&&cy===my)
        {return;}
            var vx=SmoothStepInterpolation(this.motionFactor,mx,cx);var vy=SmoothStepInterpolation(this.motionFactor,my,cy);if(FuzzyEqual(vx,cx,0.1))
        {vx=cx;}
            if(FuzzyEqual(vy,cy,0.1))
            {vy=cy;}
            this.midPoint.set(vx,vy);var dx=cx-vx;var dy=cy-vy;this.velocity.set(dx,dy);this.angle=Angle(vx,vy,cx,cy);this.distance=Math.sqrt(dx*dx+dy*dy);},up:function(event,time)
        {if(event.buttons)
        {this.buttons=event.buttons;}
            this.event=event;this.upElement=event.target;this.manager.transformPointer(this,event.pageX,event.pageY,false);if(event.button===0)
        {this.primaryDown=false;this.upX=this.x;this.upY=this.y;this.upTime=time;}
            this.justUp=true;this.isDown=false;this.dirty=true;this.wasTouch=false;},down:function(event,time)
        {if(event.buttons)
        {this.buttons=event.buttons;}
            this.event=event;this.downElement=event.target;this.manager.transformPointer(this,event.pageX,event.pageY,false);if(event.button===0)
        {this.primaryDown=true;this.downX=this.x;this.downY=this.y;this.downTime=time;}
            this.justDown=true;this.isDown=true;this.dirty=true;this.wasTouch=false;},move:function(event,time)
        {if(event.buttons)
        {this.buttons=event.buttons;}
            this.event=event;this.manager.transformPointer(this,event.pageX,event.pageY,true);if(this.manager.mouse.locked)
        {this.movementX+=event.movementX||event.mozMovementX||event.webkitMovementX||0;this.movementY+=event.movementY||event.mozMovementY||event.webkitMovementY||0;}
            this.justMoved=true;this.moveTime=time;this.dirty=true;this.wasTouch=false;},touchstart:function(event,time)
        {if(event['pointerId'])
        {this.pointerId=event.pointerId;}
            this.identifier=event.identifier;this.target=event.target;this.active=true;this.buttons=1;this.event=event;this.downElement=event.target;this.manager.transformPointer(this,event.pageX,event.pageY,false);this.primaryDown=true;this.downX=this.x;this.downY=this.y;this.downTime=time;this.justDown=true;this.isDown=true;this.dirty=true;this.wasTouch=true;this.wasCanceled=false;},touchmove:function(event,time)
        {this.event=event;this.manager.transformPointer(this,event.pageX,event.pageY,true);this.justMoved=true;this.moveTime=time;this.dirty=true;this.wasTouch=true;},touchend:function(event,time)
        {this.buttons=0;this.event=event;this.upElement=event.target;this.manager.transformPointer(this,event.pageX,event.pageY,false);this.primaryDown=false;this.upX=this.x;this.upY=this.y;this.upTime=time;this.justUp=true;this.isDown=false;this.dirty=true;this.wasTouch=true;this.wasCanceled=false;this.active=false;},touchcancel:function(event)
        {this.buttons=0;this.event=event;this.primaryDown=false;this.justUp=false;this.isDown=false;this.dirty=true;this.wasTouch=true;this.wasCanceled=true;this.active=false;},noButtonDown:function()
        {return(this.buttons===0);},leftButtonDown:function()
        {return(this.buttons&1);},rightButtonDown:function()
        {return(this.buttons&2);},middleButtonDown:function()
        {return(this.buttons&4);},backButtonDown:function()
        {return(this.buttons&8);},forwardButtonDown:function()
        {return(this.buttons&16);},getDistance:function()
        {if(this.isDown)
        {return Distance(this.downX,this.downY,this.x,this.y);}
        else
        {return Distance(this.downX,this.downY,this.upX,this.upY);}},getDistanceX:function()
        {if(this.isDown)
        {return Math.abs(this.downX-this.x);}
        else
        {return Math.abs(this.downX-this.upX);}},getDistanceY:function()
        {if(this.isDown)
        {return Math.abs(this.downY-this.y);}
        else
        {return Math.abs(this.downY-this.upY);}},getDuration:function()
        {if(this.isDown)
        {return(this.time-this.downTime);}
        else
        {return(this.upTime-this.downTime);}},getAngle:function()
        {if(this.isDown)
        {return Angle(this.downX,this.downY,this.x,this.y);}
        else
        {return Angle(this.downX,this.downY,this.upX,this.upY);}},getInterpolatedPosition:function(steps,out)
        {if(steps===undefined){steps=10;}
            if(out===undefined){out=[];}
            var prevX=this.prevPosition.x;var prevY=this.prevPosition.y;var curX=this.position.x;var curY=this.position.y;for(var i=0;i<steps;i++)
        {var t=(1 / steps)*i;out[i]={x:SmoothStepInterpolation(t,prevX,curX),y:SmoothStepInterpolation(t,prevY,curY)};}
            return out;},destroy:function()
        {this.camera=null;this.manager=null;this.position=null;},x:{get:function()
            {return this.position.x;},set:function(value)
            {this.position.x=value;}},y:{get:function()
            {return this.position.y;},set:function(value)
            {this.position.y=value;}}});module.exports=Pointer;}),"./input/const.js":(function(module,exports){var INPUT_CONST={MOUSE_DOWN:0,MOUSE_MOVE:1,MOUSE_UP:2,TOUCH_START:3,TOUCH_MOVE:4,TOUCH_END:5,TOUCH_CANCEL:7,POINTER_LOCK_CHANGE:6};module.exports=INPUT_CONST;}),"./input/gamepad/Axis.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Axis=new Class({initialize:function Axis(pad,index)
        {this.pad=pad;this.events=pad.events;this.index=index;this.value=0;this.threshold=0.1;},update:function(value)
        {this.value=value;},getValue:function()
        {return(Math.abs(this.value)<this.threshold)?0:this.value;},destroy:function()
        {this.pad=null;this.events=null;}});module.exports=Axis;}),"./input/gamepad/Button.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Button=new Class({initialize:function Button(pad,index)
        {this.pad=pad;this.events=pad.manager;this.index=index;this.value=0;this.threshold=1;this.pressed=false;},update:function(value)
        {this.value=value;var pad=this.pad;var index=this.index;if(value>=this.threshold)
        {if(!this.pressed)
        {this.pressed=true;this.events.emit('down',pad,this,value);this.pad.emit('down',index,value,this);}}
        else if(this.pressed)
        {this.pressed=false;this.events.emit('up',pad,this,value);this.pad.emit('up',index,value,this);}},destroy:function()
        {this.pad=null;this.events=null;}});module.exports=Button;}),"./input/gamepad/Gamepad.js":(function(module,exports,__webpack_require__){var Axis=__webpack_require__("./input/gamepad/Axis.js");var Button=__webpack_require__("./input/gamepad/Button.js");var Class=__webpack_require__("./utils/Class.js");var EventEmitter=__webpack_require__("../node_modules/eventemitter3/index.js");var Vector2=__webpack_require__("./math/Vector2.js");var Gamepad=new Class({Extends:EventEmitter,initialize:function Gamepad(manager,pad)
        {EventEmitter.call(this);this.manager=manager;this.pad=pad;this.id=pad.id;this.index=pad.index;var buttons=[];for(var i=0;i<pad.buttons.length;i++)
        {buttons.push(new Button(this,i));}
            this.buttons=buttons;var axes=[];for(i=0;i<pad.axes.length;i++)
        {axes.push(new Axis(this,i));}
            this.axes=axes;this.vibration=pad.vibrationActuator;var _noButton={value:0,pressed:false};this._LCLeft=(buttons[14])?buttons[14]:_noButton;this._LCRight=(buttons[15])?buttons[15]:_noButton;this._LCTop=(buttons[12])?buttons[12]:_noButton;this._LCBottom=(buttons[13])?buttons[13]:_noButton;this._RCLeft=(buttons[2])?buttons[2]:_noButton;this._RCRight=(buttons[1])?buttons[1]:_noButton;this._RCTop=(buttons[3])?buttons[3]:_noButton;this._RCBottom=(buttons[0])?buttons[0]:_noButton;this._FBLeftTop=(buttons[4])?buttons[4]:_noButton;this._FBLeftBottom=(buttons[6])?buttons[6]:_noButton;this._FBRightTop=(buttons[5])?buttons[5]:_noButton;this._FBRightBottom=(buttons[7])?buttons[7]:_noButton;var _noAxis={value:0};this._HAxisLeft=(axes[0])?axes[0]:_noAxis;this._VAxisLeft=(axes[1])?axes[1]:_noAxis;this._HAxisRight=(axes[2])?axes[2]:_noAxis;this._VAxisRight=(axes[3])?axes[3]:_noAxis;this.leftStick=new Vector2();this.rightStick=new Vector2();},getAxisTotal:function()
        {return this.axes.length;},getAxisValue:function(index)
        {return this.axes[index].getValue();},setAxisThreshold:function(value)
        {for(var i=0;i<this.axes.length;i++)
        {this.axes[i].threshold=value;}},getButtonTotal:function()
        {return this.buttons.length;},getButtonValue:function(index)
        {return this.buttons[index].value;},isButtonDown:function(index)
        {return this.buttons[index].pressed;},update:function(pad)
        {var i;var localButtons=this.buttons;var gamepadButtons=pad.buttons;var len=localButtons.length;for(i=0;i<len;i++)
        {localButtons[i].update(gamepadButtons[i].value);}
            var localAxes=this.axes;var gamepadAxes=pad.axes;len=localAxes.length;for(i=0;i<len;i++)
        {localAxes[i].update(gamepadAxes[i]);}
            if(len>=2)
            {this.leftStick.set(localAxes[0].getValue(),localAxes[1].getValue());if(len>=4)
            {this.rightStick.set(localAxes[2].getValue(),localAxes[3].getValue());}}},destroy:function()
        {this.removeAllListeners();this.manager=null;this.pad=null;var i;for(i=0;i<this.buttons.length;i++)
        {this.buttons[i].destroy();}
            for(i=0;i<this.axes.length;i++)
            {this.axes[i].destroy();}
            this.buttons=[];this.axes=[];},connected:{get:function()
            {return this.pad.connected;}},timestamp:{get:function()
            {return this.pad.timestamp;}},left:{get:function()
            {return this._LCLeft.pressed;}},right:{get:function()
            {return this._LCRight.pressed;}},up:{get:function()
            {return this._LCTop.pressed;}},down:{get:function()
            {return this._LCBottom.pressed;}},A:{get:function()
            {return this._RCBottom.pressed;}},Y:{get:function()
            {return this._RCTop.pressed;}},X:{get:function()
            {return this._RCLeft.pressed;}},B:{get:function()
            {return this._RCRight.pressed;}},L1:{get:function()
            {return this._FBLeftTop.value;}},L2:{get:function()
            {return this._FBLeftBottom.value;}},R1:{get:function()
            {return this._FBRightTop.value;}},R2:{get:function()
            {return this._FBRightBottom.value;}}});module.exports=Gamepad;}),"./input/gamepad/GamepadPlugin.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var EventEmitter=__webpack_require__("../node_modules/eventemitter3/index.js");var Gamepad=__webpack_require__("./input/gamepad/Gamepad.js");var GetValue=__webpack_require__("./utils/object/GetValue.js");var InputPluginCache=__webpack_require__("./input/InputPluginCache.js");var GamepadPlugin=new Class({Extends:EventEmitter,initialize:function GamepadPlugin(sceneInputPlugin)
        {EventEmitter.call(this);this.scene=sceneInputPlugin.scene;this.settings=this.scene.sys.settings;this.sceneInputPlugin=sceneInputPlugin;this.enabled=true;this.target;this.gamepads=[];this.queue=[];this.onGamepadHandler;this._pad1;this._pad2;this._pad3;this._pad4;sceneInputPlugin.pluginEvents.once('boot',this.boot,this);sceneInputPlugin.pluginEvents.on('start',this.start,this);},boot:function()
        {var game=this.scene.sys.game;var settings=this.settings.input;var config=game.config;this.enabled=GetValue(settings,'gamepad',config.inputGamepad)&&game.device.input.gamepads;this.target=GetValue(settings,'gamepad.target',config.inputGamepadEventTarget);this.sceneInputPlugin.pluginEvents.once('destroy',this.destroy,this);},start:function()
        {if(this.enabled)
        {this.startListeners();}
            this.sceneInputPlugin.pluginEvents.once('shutdown',this.shutdown,this);},isActive:function()
        {return(this.enabled&&this.scene.sys.isActive());},startListeners:function()
        {var _this=this;var target=this.target;var handler=function(event)
        {if(event.defaultPrevented||!_this.isActive())
        {return;}
            _this.refreshPads();_this.queue.push(event);};this.onGamepadHandler=handler;target.addEventListener('gamepadconnected',handler,false);target.addEventListener('gamepaddisconnected',handler,false);this.sceneInputPlugin.pluginEvents.on('update',this.update,this);},stopListeners:function()
        {this.target.removeEventListener('gamepadconnected',this.onGamepadHandler);this.target.removeEventListener('gamepaddisconnected',this.onGamepadHandler);this.sceneInputPlugin.pluginEvents.off('update',this.update);},disconnectAll:function()
        {for(var i=0;i<this.gamepads.length;i++)
        {this.gamepads.connected=false;}},refreshPads:function()
        {var connectedPads=navigator.getGamepads();if(!connectedPads)
        {this.disconnectAll();}
        else
        {var currentPads=this.gamepads;for(var i=0;i<connectedPads.length;i++)
        {var livePad=connectedPads[i];if(!livePad)
        {continue;}
            var id=livePad.id;var index=livePad.index;var currentPad=currentPads[index];if(!currentPad)
        {var newPad=new Gamepad(this,livePad);currentPads[index]=newPad;if(!this._pad1)
        {this._pad1=newPad;}
        else if(!this._pad2)
        {this._pad2=newPad;}
        else if(!this._pad3)
        {this._pad3=newPad;}
        else if(!this._pad4)
        {this._pad4=newPad;}}
        else if(currentPad.id!==id)
        {currentPad.destroy();currentPads[index]=new Gamepad(this,livePad);}
        else
        {currentPad.update(livePad);}}}},getAll:function()
        {var out=[];var pads=this.gamepads;for(var i=0;i<pads.length;i++)
        {if(pads[i])
        {out.push(pads[i]);}}
            return out;},getPad:function(index)
        {var pads=this.gamepads;for(var i=0;i<pads.length;i++)
        {if(pads[i]&&pads[i].index===index)
        {return pads[i];}}},update:function()
        {if(!this.enabled)
        {return;}
            this.refreshPads();var len=this.queue.length;if(len===0)
        {return;}
            var queue=this.queue.splice(0,len);for(var i=0;i<len;i++)
        {var event=queue[i];var pad=this.getPad(event.gamepad.index);if(event.type==='gamepadconnected')
        {this.emit('connected',pad,event);}
        else if(event.type==='gamepaddisconnected')
        {this.emit('disconnected',pad,event);}}},shutdown:function()
        {this.stopListeners();this.disconnectAll();this.removeAllListeners();},destroy:function()
        {this.shutdown();for(var i=0;i<this.gamepads.length;i++)
        {if(this.gamepads[i])
        {this.gamepads[i].destroy();}}
            this.gamepads=[];this.scene=null;this.settings=null;this.sceneInputPlugin=null;this.target=null;},total:{get:function()
            {return this.gamepads.length;}},pad1:{get:function()
            {return this._pad1;}},pad2:{get:function()
            {return this._pad2;}},pad3:{get:function()
            {return this._pad3;}},pad4:{get:function()
            {return this._pad4;}}});InputPluginCache.register('GamepadPlugin',GamepadPlugin,'gamepad','gamepad','inputGamepad');module.exports=GamepadPlugin;}),"./input/gamepad/configs/SNES_USB_Controller.js":(function(module,exports){module.exports={UP:12,DOWN:13,LEFT:14,RIGHT:15,SELECT:8,START:9,B:0,A:1,Y:2,X:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5};}),"./input/gamepad/configs/Sony_PlayStation_DualShock_4.js":(function(module,exports){module.exports={UP:12,DOWN:13,LEFT:14,RIGHT:15,SHARE:8,OPTIONS:9,PS:16,TOUCHBAR:17,X:0,CIRCLE:1,SQUARE:2,TRIANGLE:3,L1:4,R1:5,L2:6,R2:7,L3:10,R3:11,LEFT_STICK_H:0,LEFT_STICK_V:1,RIGHT_STICK_H:2,RIGHT_STICK_V:3};}),"./input/gamepad/configs/XBox360_Controller.js":(function(module,exports){module.exports={UP:12,DOWN:13,LEFT:14,RIGHT:15,MENU:16,A:0,B:1,X:2,Y:3,LB:4,RB:5,LT:6,RT:7,BACK:8,START:9,LS:10,RS:11,LEFT_STICK_H:0,LEFT_STICK_V:1,RIGHT_STICK_H:2,RIGHT_STICK_V:3};}),"./input/gamepad/configs/index.js":(function(module,exports,__webpack_require__){module.exports={DUALSHOCK_4:__webpack_require__("./input/gamepad/configs/Sony_PlayStation_DualShock_4.js"),SNES_USB:__webpack_require__("./input/gamepad/configs/SNES_USB_Controller.js"),XBOX_360:__webpack_require__("./input/gamepad/configs/XBox360_Controller.js")};}),"./input/gamepad/index.js":(function(module,exports,__webpack_require__){module.exports={Axis:__webpack_require__("./input/gamepad/Axis.js"),Button:__webpack_require__("./input/gamepad/Button.js"),Gamepad:__webpack_require__("./input/gamepad/Gamepad.js"),GamepadPlugin:__webpack_require__("./input/gamepad/GamepadPlugin.js"),Configs:__webpack_require__("./input/gamepad/configs/index.js")};}),"./input/index.js":(function(module,exports,__webpack_require__){var CONST=__webpack_require__("./input/const.js");var Extend=__webpack_require__("./utils/object/Extend.js");var Input={CreateInteractiveObject:__webpack_require__("./input/CreateInteractiveObject.js"),Gamepad:__webpack_require__("./input/gamepad/index.js"),InputManager:__webpack_require__("./input/InputManager.js"),InputPlugin:__webpack_require__("./input/InputPlugin.js"),InputPluginCache:__webpack_require__("./input/InputPluginCache.js"),Keyboard:__webpack_require__("./input/keyboard/index.js"),Mouse:__webpack_require__("./input/mouse/index.js"),Pointer:__webpack_require__("./input/Pointer.js"),Touch:__webpack_require__("./input/touch/index.js")};Input=Extend(false,Input,CONST);module.exports=Input;}),"./input/keyboard/KeyboardManager.js":(function(module,exports,__webpack_require__){var ArrayRemove=__webpack_require__("./utils/array/Remove.js");var Class=__webpack_require__("./utils/Class.js");var KeyCodes=__webpack_require__("./input/keyboard/keys/KeyCodes.js");var NOOP=__webpack_require__("./utils/Class.js");var KeyboardManager=new Class({initialize:function KeyboardManager(inputManager)
        {this.manager=inputManager;this.queue=[];this.preventDefault=true;this.captures=[];this.enabled=false;this.target;this.onKeyDown=NOOP;this.onKeyUp=NOOP;inputManager.events.once('boot',this.boot,this);},boot:function()
        {var config=this.manager.config;this.enabled=config.inputKeyboard;this.target=config.inputKeyboardEventTarget;this.addCapture(config.inputKeyboardCapture);if(!this.target&&window)
        {this.target=window;}
            if(this.enabled&&this.target)
            {this.startListeners();}
            this.manager.game.events.on('poststep',this.postUpdate,this);},startListeners:function()
        {var _this=this;this.onKeyDown=function(event)
        {if(event.defaultPrevented||!_this.enabled||!_this.manager)
        {return;}
            _this.queue.push(event);var modified=(event.altKey||event.ctrlKey||event.shiftKey||event.metaKey);if(_this.preventDefault&&!modified&&_this.captures.indexOf(event.keyCode)>-1)
        {event.preventDefault();}};this.onKeyUp=function(event)
        {if(event.defaultPrevented||!_this.enabled||!_this.manager)
        {return;}
            _this.queue.push(event);var modified=(event.altKey||event.ctrlKey||event.shiftKey||event.metaKey);if(_this.preventDefault&&!modified&&_this.captures.indexOf(event.keyCode)>-1)
        {event.preventDefault();}};var target=this.target;if(target)
        {target.addEventListener('keydown',this.onKeyDown,false);target.addEventListener('keyup',this.onKeyUp,false);this.enabled=true;}},stopListeners:function()
        {var target=this.target;target.removeEventListener('keydown',this.onKeyDown,false);target.removeEventListener('keyup',this.onKeyUp,false);this.enabled=false;},postUpdate:function()
        {this.queue=[];},addCapture:function(keycode)
        {if(typeof keycode==='string')
        {keycode=keycode.split(',');}
            if(!Array.isArray(keycode))
            {keycode=[keycode];}
            var captures=this.captures;for(var i=0;i<keycode.length;i++)
        {var code=keycode[i];if(typeof code==='string')
        {code=KeyCodes[code.toUpperCase()];}
            if(captures.indexOf(code)===-1)
            {captures.push(code);}}
            this.preventDefault=captures.length>0;},removeCapture:function(keycode)
        {if(typeof keycode==='string')
        {keycode=keycode.split(',');}
            if(!Array.isArray(keycode))
            {keycode=[keycode];}
            var captures=this.captures;for(var i=0;i<keycode.length;i++)
        {var code=keycode[i];if(typeof code==='string')
        {code=KeyCodes[code.toUpperCase()];}
            ArrayRemove(captures,code);}
            this.preventDefault=captures.length>0;},clearCaptures:function()
        {this.captures=[];this.preventDefault=false;},destroy:function()
        {this.stopListeners();this.clearCaptures();this.queue=[];this.manager.game.events.off('poststep',this.postUpdate,this);this.target=null;this.enabled=false;this.manager=null;}});module.exports=KeyboardManager;}),"./input/keyboard/KeyboardPlugin.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var EventEmitter=__webpack_require__("../node_modules/eventemitter3/index.js");var GetValue=__webpack_require__("./utils/object/GetValue.js");var InputPluginCache=__webpack_require__("./input/InputPluginCache.js");var Key=__webpack_require__("./input/keyboard/keys/Key.js");var KeyCodes=__webpack_require__("./input/keyboard/keys/KeyCodes.js");var KeyCombo=__webpack_require__("./input/keyboard/combo/KeyCombo.js");var KeyMap=__webpack_require__("./input/keyboard/keys/KeyMap.js");var SnapFloor=__webpack_require__("./math/snap/SnapFloor.js");var KeyboardPlugin=new Class({Extends:EventEmitter,initialize:function KeyboardPlugin(sceneInputPlugin)
        {EventEmitter.call(this);this.scene=sceneInputPlugin.scene;this.settings=this.scene.sys.settings;this.sceneInputPlugin=sceneInputPlugin;this.manager=sceneInputPlugin.manager.keyboard;this.enabled=true;this.keys=[];this.combos=[];this.time=0;sceneInputPlugin.pluginEvents.once('boot',this.boot,this);sceneInputPlugin.pluginEvents.on('start',this.start,this);},boot:function()
        {var settings=this.settings.input;this.enabled=GetValue(settings,'keyboard',true);var captures=GetValue(settings,'keyboard.capture',null);if(captures)
        {this.addCaptures(captures);}
            this.sceneInputPlugin.pluginEvents.once('destroy',this.destroy,this);},start:function()
        {this.startListeners();this.sceneInputPlugin.pluginEvents.once('shutdown',this.shutdown,this);},isActive:function()
        {return(this.enabled&&this.scene.sys.isActive());},startListeners:function()
        {this.sceneInputPlugin.pluginEvents.on('update',this.update,this);},stopListeners:function()
        {this.sceneInputPlugin.pluginEvents.off('update',this.update);},addCapture:function(keycode)
        {this.manager.addCapture(keycode);return this;},removeCapture:function(keycode)
        {this.manager.removeCapture(keycode);return this;},getCaptures:function()
        {return this.manager.captures;},enableGlobalCapture:function()
        {this.manager.preventDefault=true;return this;},disableGlobalCapture:function()
        {this.manager.preventDefault=false;return this;},clearCaptures:function()
        {this.manager.clearCaptures();return this;},createCursorKeys:function()
        {return this.addKeys({up:KeyCodes.UP,down:KeyCodes.DOWN,left:KeyCodes.LEFT,right:KeyCodes.RIGHT,space:KeyCodes.SPACE,shift:KeyCodes.SHIFT});},addKeys:function(keys,enableCapture,emitOnRepeat)
        {if(enableCapture===undefined){enableCapture=true;}
            if(emitOnRepeat===undefined){emitOnRepeat=false;}
            var output={};if(typeof keys==='string')
        {keys=keys.split(',');for(var i=0;i<keys.length;i++)
        {var currentKey=keys[i].trim();if(currentKey)
        {output[currentKey]=this.addKey(currentKey,enableCapture,emitOnRepeat);}}}
        else
        {for(var key in keys)
        {output[key]=this.addKey(keys[key],enableCapture,emitOnRepeat);}}
            return output;},addKey:function(key,enableCapture,emitOnRepeat)
        {if(enableCapture===undefined){enableCapture=true;}
            if(emitOnRepeat===undefined){emitOnRepeat=false;}
            var keys=this.keys;if(key instanceof Key)
        {var idx=keys.indexOf(key);if(idx>-1)
        {keys[idx]=key;}
        else
        {keys[key.keyCode]=key;}
            if(enableCapture)
            {this.addCapture(key.keyCode);}
            key.setEmitOnRepeat(emitOnRepeat);return key;}
            if(typeof key==='string')
            {key=KeyCodes[key.toUpperCase()];}
            if(!keys[key])
            {keys[key]=new Key(key);if(enableCapture)
            {this.addCapture(key);}
                keys[key].setEmitOnRepeat(emitOnRepeat);}
            return keys[key];},removeKey:function(key)
        {var keys=this.keys;if(key instanceof Key)
        {var idx=keys.indexOf(key);if(idx>-1)
        {this.keys[idx]=undefined;}}
        else if(typeof key==='string')
        {key=KeyCodes[key.toUpperCase()];}
            if(keys[key])
            {keys[key]=undefined;}
            return this;},createCombo:function(keys,config)
        {return new KeyCombo(this,keys,config);},checkDown:function(key,duration)
        {if(this.enabled&&key.isDown)
        {var t=SnapFloor(this.time-key.timeDown,duration);if(t>key._tick)
        {key._tick=t;return true;}}
            return false;},update:function(time)
        {this.time=time;var queue=this.manager.queue;var len=queue.length;if(!this.isActive()||len===0)
        {return;}
            var keys=this.keys;for(var i=0;i<len;i++)
        {var event=queue[i];var code=event.keyCode;var key=keys[code];var repeat=false;if(event.cancelled===undefined)
        {event.cancelled=0;event.stopImmediatePropagation=function()
        {event.cancelled=1;};event.stopPropagation=function()
        {event.cancelled=-1;};}
            if(event.cancelled===-1)
            {continue;}
            if(event.type==='keydown')
            {if(key)
            {repeat=key.isDown;key.onDown(event);}
                if(!event.cancelled&&(!key||!repeat))
                {if(KeyMap[code])
                {this.emit('keydown_'+KeyMap[code],event);}
                    if(!event.cancelled)
                    {this.emit(event.type,event);}}}
            else
            {if(key)
            {key.onUp(event);}
                if(!event.cancelled)
                {if(KeyMap[code])
                {this.emit('keyup_'+KeyMap[code],event);}
                    if(!event.cancelled)
                    {this.emit(event.type,event);}}}
            if(event.cancelled===1)
            {event.cancelled=0;}}},resetKeys:function()
        {var keys=this.keys;for(var i=0;i<keys.length;i++)
        {if(keys[i])
        {keys[i].reset();}}
            return this;},shutdown:function()
        {this.resetKeys();this.stopListeners();this.removeAllListeners();this.queue=[];},destroy:function()
        {this.shutdown();var keys=this.keys;for(var i=0;i<keys.length;i++)
        {if(keys[i])
        {keys[i].destroy();}}
            this.keys=[];this.combos=[];this.queue=[];this.scene=null;this.settings=null;this.sceneInputPlugin=null;this.manager=null;}});InputPluginCache.register('KeyboardPlugin',KeyboardPlugin,'keyboard','keyboard','inputKeyboard');module.exports=KeyboardPlugin;}),"./input/keyboard/combo/AdvanceKeyCombo.js":(function(module,exports){var AdvanceKeyCombo=function(event,combo)
    {combo.timeLastMatched=event.timeStamp;combo.index++;if(combo.index===combo.size)
    {return true;}
    else
    {combo.current=combo.keyCodes[combo.index];return false;}};module.exports=AdvanceKeyCombo;}),"./input/keyboard/combo/KeyCombo.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var ProcessKeyCombo=__webpack_require__("./input/keyboard/combo/ProcessKeyCombo.js");var ResetKeyCombo=__webpack_require__("./input/keyboard/combo/ResetKeyCombo.js");var KeyCombo=new Class({initialize:function KeyCombo(keyboardPlugin,keys,config)
        {if(config===undefined){config={};}
            if(keys.length<2)
            {return false;}
            this.manager=keyboardPlugin;this.enabled=true;this.keyCodes=[];for(var i=0;i<keys.length;i++)
        {var char=keys[i];if(typeof char==='string')
        {this.keyCodes.push(char.toUpperCase().charCodeAt(0));}
        else if(typeof char==='number')
        {this.keyCodes.push(char);}
        else if(char.hasOwnProperty('keyCode'))
        {this.keyCodes.push(char.keyCode);}}
            this.current=this.keyCodes[0];this.index=0;this.size=this.keyCodes.length;this.timeLastMatched=0;this.matched=false;this.timeMatched=0;this.resetOnWrongKey=GetFastValue(config,'resetOnWrongKey',true);this.maxKeyDelay=GetFastValue(config,'maxKeyDelay',0);this.resetOnMatch=GetFastValue(config,'resetOnMatch',false);this.deleteOnMatch=GetFastValue(config,'deleteOnMatch',false);var _this=this;var onKeyDownHandler=function(event)
        {if(_this.matched||!_this.enabled)
        {return;}
            var matched=ProcessKeyCombo(event,_this);if(matched)
        {_this.manager.emit('keycombomatch',_this,event);if(_this.resetOnMatch)
        {ResetKeyCombo(_this);}
        else if(_this.deleteOnMatch)
        {_this.destroy();}}};this.onKeyDown=onKeyDownHandler;this.manager.on('keydown',onKeyDownHandler);},progress:{get:function()
            {return this.index / this.size;}},destroy:function()
        {this.enabled=false;this.keyCodes=[];this.manager.off('keydown',this.onKeyDown);this.manager=null;}});module.exports=KeyCombo;}),"./input/keyboard/combo/ProcessKeyCombo.js":(function(module,exports,__webpack_require__){var AdvanceKeyCombo=__webpack_require__("./input/keyboard/combo/AdvanceKeyCombo.js");var ProcessKeyCombo=function(event,combo)
    {if(combo.matched)
    {return true;}
        var comboMatched=false;var keyMatched=false;if(event.keyCode===combo.current)
    {if(combo.index>0&&combo.maxKeyDelay>0)
    {var timeLimit=combo.timeLastMatched+combo.maxKeyDelay;if(event.timeStamp<=timeLimit)
    {keyMatched=true;comboMatched=AdvanceKeyCombo(event,combo);}}
    else
    {keyMatched=true;comboMatched=AdvanceKeyCombo(event,combo);}}
        if(!keyMatched&&combo.resetOnWrongKey)
        {combo.index=0;combo.current=combo.keyCodes[0];}
        if(comboMatched)
        {combo.timeLastMatched=event.timeStamp;combo.matched=true;combo.timeMatched=event.timeStamp;}
        return comboMatched;};module.exports=ProcessKeyCombo;}),"./input/keyboard/combo/ResetKeyCombo.js":(function(module,exports){var ResetKeyCombo=function(combo)
    {combo.current=combo.keyCodes[0];combo.index=0;combo.timeLastMatched=0;combo.matched=false;combo.timeMatched=0;return combo;};module.exports=ResetKeyCombo;}),"./input/keyboard/index.js":(function(module,exports,__webpack_require__){module.exports={KeyboardManager:__webpack_require__("./input/keyboard/KeyboardManager.js"),KeyboardPlugin:__webpack_require__("./input/keyboard/KeyboardPlugin.js"),Key:__webpack_require__("./input/keyboard/keys/Key.js"),KeyCodes:__webpack_require__("./input/keyboard/keys/KeyCodes.js"),KeyCombo:__webpack_require__("./input/keyboard/combo/KeyCombo.js"),JustDown:__webpack_require__("./input/keyboard/keys/JustDown.js"),JustUp:__webpack_require__("./input/keyboard/keys/JustUp.js"),DownDuration:__webpack_require__("./input/keyboard/keys/DownDuration.js"),UpDuration:__webpack_require__("./input/keyboard/keys/UpDuration.js")};}),"./input/keyboard/keys/DownDuration.js":(function(module,exports){var DownDuration=function(key,duration)
    {if(duration===undefined){duration=50;}
        return(key.isDown&&key.duration<duration);};module.exports=DownDuration;}),"./input/keyboard/keys/JustDown.js":(function(module,exports){var JustDown=function(key)
    {if(key._justDown)
    {key._justDown=false;return true;}
    else
    {return false;}};module.exports=JustDown;}),"./input/keyboard/keys/JustUp.js":(function(module,exports){var JustUp=function(key)
    {if(key._justUp)
    {key._justUp=false;return true;}
    else
    {return false;}};module.exports=JustUp;}),"./input/keyboard/keys/Key.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var EventEmitter=__webpack_require__("../node_modules/eventemitter3/index.js");var Key=new Class({Extends:EventEmitter,initialize:function Key(keyCode)
        {EventEmitter.call(this);this.keyCode=keyCode;this.originalEvent=undefined;this.enabled=true;this.isDown=false;this.isUp=true;this.altKey=false;this.ctrlKey=false;this.shiftKey=false;this.metaKey=false;this.location=0;this.timeDown=0;this.duration=0;this.timeUp=0;this.emitOnRepeat=false;this.repeats=0;this._justDown=false;this._justUp=false;this._tick=-1;},setEmitOnRepeat:function(value)
        {this.emitOnRepeat=value;return this;},onDown:function(event)
        {this.originalEvent=event;if(!this.enabled)
        {return;}
            this.altKey=event.altKey;this.ctrlKey=event.ctrlKey;this.shiftKey=event.shiftKey;this.metaKey=event.metaKey;this.location=event.location;this.repeats++;if(!this.isDown)
        {this.isDown=true;this.isUp=false;this.timeDown=event.timeStamp;this.duration=0;this._justDown=true;this._justUp=false;this.emit('down',this,event);}
        else if(this.emitOnRepeat)
        {this.emit('down',this,event);}},onUp:function(event)
        {this.originalEvent=event;if(!this.enabled)
        {return;}
            this.isDown=false;this.isUp=true;this.timeUp=event.timeStamp;this.duration=this.timeUp-this.timeDown;this.repeats=0;this._justDown=false;this._justUp=true;this._tick=-1;this.emit('up',this,event);},reset:function()
        {this.preventDefault=true;this.enabled=true;this.isDown=false;this.isUp=true;this.altKey=false;this.ctrlKey=false;this.shiftKey=false;this.metaKey=false;this.timeDown=0;this.duration=0;this.timeUp=0;this.repeats=0;this._justDown=false;this._justUp=false;this._tick=-1;return this;},destroy:function()
        {this.removeAllListeners();this.originalEvent=null;}});module.exports=Key;}),"./input/keyboard/keys/KeyCodes.js":(function(module,exports){var KeyCodes={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:42,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,NUMPAD_ZERO:96,NUMPAD_ONE:97,NUMPAD_TWO:98,NUMPAD_THREE:99,NUMPAD_FOUR:100,NUMPAD_FIVE:101,NUMPAD_SIX:102,NUMPAD_SEVEN:103,NUMPAD_EIGHT:104,NUMPAD_NINE:105,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SEMICOLON:186,PLUS:187,COMMA:188,MINUS:189,PERIOD:190,FORWARD_SLASH:191,BACK_SLASH:220,QUOTES:222,BACKTICK:192,OPEN_BRACKET:219,CLOSED_BRACKET:221,SEMICOLON_FIREFOX:59,COLON:58,COMMA_FIREFOX_WINDOWS:60,COMMA_FIREFOX:62,BRACKET_RIGHT_FIREFOX:174,BRACKET_LEFT_FIREFOX:175};module.exports=KeyCodes;}),"./input/keyboard/keys/KeyMap.js":(function(module,exports,__webpack_require__){var KeyCodes=__webpack_require__("./input/keyboard/keys/KeyCodes.js");var KeyMap={};for(var key in KeyCodes)
    {KeyMap[KeyCodes[key]]=key;}
        module.exports=KeyMap;}),"./input/keyboard/keys/UpDuration.js":(function(module,exports){var UpDuration=function(key,duration)
    {if(duration===undefined){duration=50;}
        return(key.isUp&&key.duration<duration);};module.exports=UpDuration;}),"./input/mouse/MouseManager.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Features=__webpack_require__("./device/Features.js");var NOOP=__webpack_require__("./utils/Class.js");var MouseManager=new Class({initialize:function MouseManager(inputManager)
        {this.manager=inputManager;this.capture=true;this.enabled=false;this.target;this.locked=false;this.onMouseMove=NOOP;this.onMouseDown=NOOP;this.onMouseUp=NOOP;this.onMouseOver=NOOP;this.onMouseOut=NOOP;this.pointerLockChange=NOOP;inputManager.events.once('boot',this.boot,this);},boot:function()
        {var config=this.manager.config;this.enabled=config.inputMouse;this.target=config.inputMouseEventTarget;this.capture=config.inputMouseCapture;if(!this.target)
        {this.target=this.manager.game.canvas;}
            if(config.disableContextMenu)
            {this.disableContextMenu();}
            if(this.enabled&&this.target)
            {this.startListeners();}},disableContextMenu:function()
        {document.body.addEventListener('contextmenu',function(event)
        {event.preventDefault();return false;});return this;},requestPointerLock:function()
        {if(Features.pointerLock)
        {var element=this.target;element.requestPointerLock=element.requestPointerLock||element.mozRequestPointerLock||element.webkitRequestPointerLock;element.requestPointerLock();}},releasePointerLock:function()
        {if(Features.pointerLock)
        {document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock;document.exitPointerLock();}},startListeners:function()
        {var _this=this;var canvas=this.manager.canvas;var autoFocus=(window&&window.focus&&this.manager.game.config.autoFocus);this.onMouseMove=function(event)
        {if(event.defaultPrevented||!_this.enabled||!_this.manager)
        {return;}
            _this.manager.queueMouseMove(event);if(_this.capture)
        {event.preventDefault();}};this.onMouseDown=function(event)
        {if(autoFocus)
        {window.focus();}
            if(event.defaultPrevented||!_this.enabled||!_this.manager)
            {return;}
            _this.manager.queueMouseDown(event);if(_this.capture&&event.target===canvas)
        {event.preventDefault();}};this.onMouseUp=function(event)
        {if(event.defaultPrevented||!_this.enabled||!_this.manager)
        {return;}
            _this.manager.queueMouseUp(event);if(_this.capture&&event.target===canvas)
        {event.preventDefault();}};this.onMouseOver=function(event)
        {if(event.defaultPrevented||!_this.enabled||!_this.manager)
        {return;}
            _this.manager.setCanvasOver(event);};this.onMouseOut=function(event)
        {if(event.defaultPrevented||!_this.enabled||!_this.manager)
        {return;}
            _this.manager.setCanvasOut(event);};var target=this.target;if(!target)
        {return;}
            var passive={passive:true};var nonPassive={passive:false};target.addEventListener('mousemove',this.onMouseMove,(this.capture)?nonPassive:passive);target.addEventListener('mousedown',this.onMouseDown,(this.capture)?nonPassive:passive);target.addEventListener('mouseup',this.onMouseUp,(this.capture)?nonPassive:passive);target.addEventListener('mouseover',this.onMouseOver,(this.capture)?nonPassive:passive);target.addEventListener('mouseout',this.onMouseOut,(this.capture)?nonPassive:passive);if(window)
        {window.addEventListener('mousedown',this.onMouseDown,nonPassive);window.addEventListener('mouseup',this.onMouseUp,nonPassive);}
            if(Features.pointerLock)
            {this.pointerLockChange=function(event)
            {var element=_this.target;_this.locked=(document.pointerLockElement===element||document.mozPointerLockElement===element||document.webkitPointerLockElement===element)?true:false;_this.manager.queue.push(event);};document.addEventListener('pointerlockchange',this.pointerLockChange,true);document.addEventListener('mozpointerlockchange',this.pointerLockChange,true);document.addEventListener('webkitpointerlockchange',this.pointerLockChange,true);}
            this.enabled=true;},stopListeners:function()
        {var target=this.target;target.removeEventListener('mousemove',this.onMouseMove);target.removeEventListener('mousedown',this.onMouseDown);target.removeEventListener('mouseup',this.onMouseUp);target.removeEventListener('mouseover',this.onMouseOver);target.removeEventListener('mouseout',this.onMouseOut);if(window)
        {window.removeEventListener('mousedown',this.onMouseDown);window.removeEventListener('mouseup',this.onMouseUp);}
            if(Features.pointerLock)
            {document.removeEventListener('pointerlockchange',this.pointerLockChange,true);document.removeEventListener('mozpointerlockchange',this.pointerLockChange,true);document.removeEventListener('webkitpointerlockchange',this.pointerLockChange,true);}},destroy:function()
        {this.stopListeners();this.target=null;this.enabled=false;this.manager=null;}});module.exports=MouseManager;}),"./input/mouse/index.js":(function(module,exports,__webpack_require__){module.exports={MouseManager:__webpack_require__("./input/mouse/MouseManager.js")};}),"./input/touch/TouchManager.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var NOOP=__webpack_require__("./utils/NOOP.js");var TouchManager=new Class({initialize:function TouchManager(inputManager)
        {this.manager=inputManager;this.capture=true;this.enabled=false;this.target;this.onTouchStart=NOOP;this.onTouchMove=NOOP;this.onTouchEnd=NOOP;this.onTouchCancel=NOOP;this.onTouchOver=NOOP;this.onTouchOut=NOOP;inputManager.events.once('boot',this.boot,this);},boot:function()
        {var config=this.manager.config;this.enabled=config.inputTouch;this.target=config.inputTouchEventTarget;this.capture=config.inputTouchCapture;if(!this.target)
        {this.target=this.manager.game.canvas;}
            if(this.enabled&&this.target)
            {this.startListeners();}},startListeners:function()
        {var _this=this;var canvas=this.manager.canvas;var autoFocus=(window&&window.focus&&this.manager.game.config.autoFocus);this.onTouchStart=function(event)
        {if(autoFocus)
        {window.focus();}
            if(event.defaultPrevented||!_this.enabled||!_this.manager)
            {return;}
            _this.manager.queueTouchStart(event);if(_this.capture&&event.target===canvas)
        {event.preventDefault();}};this.onTouchMove=function(event)
        {if(event.defaultPrevented||!_this.enabled||!_this.manager)
        {return;}
            _this.manager.queueTouchMove(event);if(_this.capture)
        {event.preventDefault();}};this.onTouchEnd=function(event)
        {if(event.defaultPrevented||!_this.enabled||!_this.manager)
        {return;}
            _this.manager.queueTouchEnd(event);if(_this.capture&&event.target===canvas)
        {event.preventDefault();}};this.onTouchCancel=function(event)
        {if(event.defaultPrevented||!_this.enabled||!_this.manager)
        {return;}
            _this.manager.queueTouchCancel(event);if(_this.capture)
        {event.preventDefault();}};this.onTouchOver=function(event)
        {if(event.defaultPrevented||!_this.enabled||!_this.manager)
        {return;}
            _this.manager.setCanvasOver(event);};this.onTouchOut=function(event)
        {if(event.defaultPrevented||!_this.enabled||!_this.manager)
        {return;}
            _this.manager.setCanvasOut(event);};var target=this.target;if(!target)
        {return;}
            var passive={passive:true};var nonPassive={passive:false};target.addEventListener('touchstart',this.onTouchStart,(this.capture)?nonPassive:passive);target.addEventListener('touchmove',this.onTouchMove,(this.capture)?nonPassive:passive);target.addEventListener('touchend',this.onTouchEnd,(this.capture)?nonPassive:passive);target.addEventListener('touchcancel',this.onTouchCancel,(this.capture)?nonPassive:passive);target.addEventListener('touchover',this.onTouchOver,(this.capture)?nonPassive:passive);target.addEventListener('touchout',this.onTouchOut,(this.capture)?nonPassive:passive);if(window)
        {window.addEventListener('touchstart',this.onTouchStart,nonPassive);window.addEventListener('touchend',this.onTouchEnd,nonPassive);}
            this.enabled=true;},stopListeners:function()
        {var target=this.target;target.removeEventListener('touchstart',this.onTouchStart);target.removeEventListener('touchmove',this.onTouchMove);target.removeEventListener('touchend',this.onTouchEnd);target.removeEventListener('touchcancel',this.onTouchCancel);target.removeEventListener('touchover',this.onTouchOver);target.removeEventListener('touchout',this.onTouchOut);if(window)
        {window.removeEventListener('touchstart',this.onTouchStart);window.removeEventListener('touchend',this.onTouchEnd);}},destroy:function()
        {this.stopListeners();this.target=null;this.enabled=false;this.manager=null;}});module.exports=TouchManager;}),"./input/touch/index.js":(function(module,exports,__webpack_require__){module.exports={TouchManager:__webpack_require__("./input/touch/TouchManager.js")};}),"./loader/File.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var CONST=__webpack_require__("./loader/const.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var GetURL=__webpack_require__("./loader/GetURL.js");var MergeXHRSettings=__webpack_require__("./loader/MergeXHRSettings.js");var XHRLoader=__webpack_require__("./loader/XHRLoader.js");var XHRSettings=__webpack_require__("./loader/XHRSettings.js");var File=new Class({initialize:function File(loader,fileConfig)
        {this.loader=loader;this.cache=GetFastValue(fileConfig,'cache',false);this.type=GetFastValue(fileConfig,'type',false);this.key=GetFastValue(fileConfig,'key',false);var loadKey=this.key;if(loader.prefix&&loader.prefix!=='')
        {this.key=loader.prefix+loadKey;}
            if(!this.type||!this.key)
            {throw new Error('Error calling \'Loader.'+this.type+'\' invalid key provided.');}
            this.url=GetFastValue(fileConfig,'url');if(this.url===undefined)
        {this.url=loader.path+loadKey+'.'+GetFastValue(fileConfig,'extension','');}
        else if(typeof(this.url)!=='function')
        {this.url=loader.path+this.url;}
            this.src='';this.xhrSettings=XHRSettings(GetFastValue(fileConfig,'responseType',undefined));if(GetFastValue(fileConfig,'xhrSettings',false))
        {this.xhrSettings=MergeXHRSettings(this.xhrSettings,GetFastValue(fileConfig,'xhrSettings',{}));}
            this.xhrLoader=null;this.state=(typeof(this.url)==='function')?CONST.FILE_POPULATED:CONST.FILE_PENDING;this.bytesTotal=0;this.bytesLoaded=-1;this.percentComplete=-1;this.crossOrigin=undefined;this.data=undefined;this.config=GetFastValue(fileConfig,'config',{});this.multiFile;this.linkFile;},setLink:function(fileB)
        {this.linkFile=fileB;fileB.linkFile=this;},resetXHR:function()
        {if(this.xhrLoader)
        {this.xhrLoader.onload=undefined;this.xhrLoader.onerror=undefined;this.xhrLoader.onprogress=undefined;}},load:function()
        {if(this.state===CONST.FILE_POPULATED)
        {this.loader.nextFile(this,true);}
        else
        {this.src=GetURL(this,this.loader.baseURL);if(this.src.indexOf('data:')===0)
        {console.warn('Local data URIs are not supported: '+this.key);}
        else
        {this.xhrLoader=XHRLoader(this,this.loader.xhr);}}},onLoad:function(xhr,event)
        {var success=!(event.target&&event.target.status!==200);if(xhr.readyState===4&&xhr.status>=400&&xhr.status<=599)
        {success=false;}
            this.resetXHR();this.loader.nextFile(this,success);},onError:function()
        {this.resetXHR();this.loader.nextFile(this,false);},onProgress:function(event)
        {if(event.lengthComputable)
        {this.bytesLoaded=event.loaded;this.bytesTotal=event.total;this.percentComplete=Math.min((this.bytesLoaded / this.bytesTotal),1);this.loader.emit('fileprogress',this,this.percentComplete);}},onProcess:function()
        {this.state=CONST.FILE_PROCESSING;this.onProcessComplete();},onProcessComplete:function()
        {this.state=CONST.FILE_COMPLETE;if(this.multiFile)
        {this.multiFile.onFileComplete(this);}
            this.loader.fileProcessComplete(this);},onProcessError:function()
        {this.state=CONST.FILE_ERRORED;if(this.multiFile)
        {this.multiFile.onFileFailed(this);}
            this.loader.fileProcessComplete(this);},hasCacheConflict:function()
        {return(this.cache&&this.cache.exists(this.key));},addToCache:function()
        {if(this.cache)
        {this.cache.add(this.key,this.data);}
            this.pendingDestroy();},pendingDestroy:function(data)
        {if(data===undefined){data=this.data;}
            var key=this.key;var type=this.type;this.loader.emit('filecomplete',key,type,data);this.loader.emit('filecomplete-'+type+'-'+key,key,type,data);this.loader.flagForRemoval(this);},destroy:function()
        {this.loader=null;this.cache=null;this.xhrSettings=null;this.multiFile=null;this.linkFile=null;this.data=null;}});File.createObjectURL=function(image,blob,defaultType)
    {if(typeof URL==='function')
    {image.src=URL.createObjectURL(blob);}
    else
    {var reader=new FileReader();reader.onload=function()
    {image.removeAttribute('crossOrigin');image.src='data:'+(blob.type||defaultType)+';base64,'+reader.result.split(',')[1];};reader.onerror=image.onerror;reader.readAsDataURL(blob);}};File.revokeObjectURL=function(image)
    {if(typeof URL==='function')
    {URL.revokeObjectURL(image.src);}};module.exports=File;}),"./loader/FileTypesManager.js":(function(module,exports){var types={};var FileTypesManager={install:function(loader)
        {for(var key in types)
        {loader[key]=types[key];}},register:function(key,factoryFunction)
        {types[key]=factoryFunction;},destroy:function()
        {types={};}};module.exports=FileTypesManager;}),"./loader/GetURL.js":(function(module,exports){var GetURL=function(file,baseURL)
    {if(!file.url)
    {return false;}
        if(file.url.match(/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/))
        {return file.url;}
        else
        {return baseURL+file.url;}};module.exports=GetURL;}),"./loader/LoaderPlugin.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var CONST=__webpack_require__("./loader/const.js");var CustomSet=__webpack_require__("./structs/Set.js");var EventEmitter=__webpack_require__("../node_modules/eventemitter3/index.js");var FileTypesManager=__webpack_require__("./loader/FileTypesManager.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var PluginCache=__webpack_require__("./plugins/PluginCache.js");var XHRSettings=__webpack_require__("./loader/XHRSettings.js");var LoaderPlugin=new Class({Extends:EventEmitter,initialize:function LoaderPlugin(scene)
        {EventEmitter.call(this);var gameConfig=scene.sys.game.config;var sceneConfig=scene.sys.settings.loader;this.scene=scene;this.systems=scene.sys;this.cacheManager=scene.sys.cache;this.textureManager=scene.sys.textures;this.sceneManager=scene.sys.game.scene;FileTypesManager.install(this);this.prefix='';this.path='';this.baseURL='';this.setBaseURL(GetFastValue(sceneConfig,'baseURL',gameConfig.loaderBaseURL));this.setPath(GetFastValue(sceneConfig,'path',gameConfig.loaderPath));this.setPrefix(GetFastValue(sceneConfig,'prefix',gameConfig.loaderPrefix));this.maxParallelDownloads=GetFastValue(sceneConfig,'maxParallelDownloads',gameConfig.loaderMaxParallelDownloads);this.xhr=XHRSettings(GetFastValue(sceneConfig,'responseType',gameConfig.loaderResponseType),GetFastValue(sceneConfig,'async',gameConfig.loaderAsync),GetFastValue(sceneConfig,'user',gameConfig.loaderUser),GetFastValue(sceneConfig,'password',gameConfig.loaderPassword),GetFastValue(sceneConfig,'timeout',gameConfig.loaderTimeout));this.crossOrigin=GetFastValue(sceneConfig,'crossOrigin',gameConfig.loaderCrossOrigin);this.totalToLoad=0;this.progress=0;this.list=new CustomSet();this.inflight=new CustomSet();this.queue=new CustomSet();this._deleteQueue=new CustomSet();this.totalFailed=0;this.totalComplete=0;this.state=CONST.LOADER_IDLE;scene.sys.events.once('boot',this.boot,this);scene.sys.events.on('start',this.pluginStart,this);},boot:function()
        {this.systems.events.once('destroy',this.destroy,this);},pluginStart:function()
        {this.systems.events.once('shutdown',this.shutdown,this);},setBaseURL:function(url)
        {if(url===undefined){url='';}
            if(url!==''&&url.substr(-1)!=='/')
            {url=url.concat('/');}
            this.baseURL=url;return this;},setPath:function(path)
        {if(path===undefined){path='';}
            if(path!==''&&path.substr(-1)!=='/')
            {path=path.concat('/');}
            this.path=path;return this;},setPrefix:function(prefix)
        {if(prefix===undefined){prefix='';}
            this.prefix=prefix;return this;},setCORS:function(crossOrigin)
        {this.crossOrigin=crossOrigin;return this;},addFile:function(file)
        {if(!Array.isArray(file))
        {file=[file];}
            for(var i=0;i<file.length;i++)
            {var item=file[i];if(!this.keyExists(item))
            {this.list.set(item);this.emit('addfile',item.key,item.type,this,item);if(this.isLoading())
            {this.totalToLoad++;this.updateProgress();}}}},keyExists:function(file)
        {var keyConflict=file.hasCacheConflict();if(!keyConflict)
        {this.list.iterate(function(item)
        {if(item.type===file.type&&item.key===file.key)
        {keyConflict=true;return false;}});}
            if(!keyConflict&&this.isLoading())
            {this.inflight.iterate(function(item)
            {if(item.type===file.type&&item.key===file.key)
            {keyConflict=true;return false;}});this.queue.iterate(function(item)
            {if(item.type===file.type&&item.key===file.key)
            {keyConflict=true;return false;}});}
            return keyConflict;},addPack:function(pack,packKey)
        {if(packKey&&pack.hasOwnProperty(packKey))
        {pack={packKey:pack[packKey]};}
            var total=0;var currentBaseURL=this.baseURL;var currentPath=this.path;var currentPrefix=this.prefix;for(var key in pack)
        {var config=pack[key];var baseURL=GetFastValue(config,'baseURL',currentBaseURL);var path=GetFastValue(config,'path',currentPath);var prefix=GetFastValue(config,'prefix',currentPrefix);var files=GetFastValue(config,'files',null);var defaultType=GetFastValue(config,'defaultType','void');if(Array.isArray(files))
        {this.setBaseURL(baseURL);this.setPath(path);this.setPrefix(prefix);for(var i=0;i<files.length;i++)
        {var file=files[i];var type=(file.hasOwnProperty('type'))?file.type:defaultType;if(this[type])
        {this[type](file);total++;}}}}
            this.setBaseURL(currentBaseURL);this.setPath(currentPath);this.setPrefix(currentPrefix);return(total>0);},isLoading:function()
        {return(this.state===CONST.LOADER_LOADING||this.state===CONST.LOADER_PROCESSING);},isReady:function()
        {return(this.state===CONST.LOADER_IDLE||this.state===CONST.LOADER_COMPLETE);},start:function()
        {if(!this.isReady())
        {return;}
            this.progress=0;this.totalFailed=0;this.totalComplete=0;this.totalToLoad=this.list.size;this.emit('start',this);if(this.list.size===0)
        {this.loadComplete();}
        else
        {this.state=CONST.LOADER_LOADING;this.inflight.clear();this.queue.clear();this.updateProgress();this.checkLoadQueue();this.systems.events.on('update',this.update,this);}},updateProgress:function()
        {this.progress=1-((this.list.size+this.inflight.size)/ this.totalToLoad);this.emit('progress',this.progress);},update:function()
        {if(this.state===CONST.LOADER_LOADING&&this.list.size>0&&this.inflight.size<this.maxParallelDownloads)
        {this.checkLoadQueue();}},checkLoadQueue:function()
        {this.list.each(function(file)
        {if(file.state===CONST.FILE_POPULATED||(file.state===CONST.FILE_PENDING&&this.inflight.size<this.maxParallelDownloads))
        {this.inflight.set(file);this.list.delete(file);if(!file.crossOrigin)
        {file.crossOrigin=this.crossOrigin;}
            file.load();}
            if(this.inflight.size===this.maxParallelDownloads)
            {return false;}},this);},nextFile:function(file,success)
        {if(!this.inflight)
        {return;}
            this.inflight.delete(file);this.updateProgress();if(success)
        {this.totalComplete++;this.queue.set(file);this.emit('load',file);file.onProcess();}
        else
        {this.totalFailed++;this._deleteQueue.set(file);this.emit('loaderror',file);this.fileProcessComplete(file);}},fileProcessComplete:function(file)
        {if(!this.scene||!this.systems||!this.systems.game||this.systems.game.pendingDestroy)
        {return;}
            if(file.state===CONST.FILE_ERRORED)
            {if(file.multiFile)
            {file.multiFile.onFileFailed(file);}}
            else if(file.state===CONST.FILE_COMPLETE)
            {if(file.multiFile)
            {if(file.multiFile.isReadyToProcess())
            {file.multiFile.addToCache();}}
            else
            {file.addToCache();}}
            this.queue.delete(file);if(this.list.size===0&&this.inflight.size===0&&this.queue.size===0)
        {this.loadComplete();}},loadComplete:function()
        {this.emit('loadcomplete',this);this.list.clear();this.inflight.clear();this.queue.clear();this.progress=1;this.state=CONST.LOADER_COMPLETE;this.systems.events.off('update',this.update,this);this._deleteQueue.iterateLocal('destroy');this._deleteQueue.clear();this.emit('complete',this,this.totalComplete,this.totalFailed);},flagForRemoval:function(file)
        {this._deleteQueue.set(file);},saveJSON:function(data,filename)
        {return this.save(JSON.stringify(data),filename);},save:function(data,filename,filetype)
        {if(filename===undefined){filename='file.json';}
            if(filetype===undefined){filetype='application/json';}
            var blob=new Blob([data],{type:filetype});var url=URL.createObjectURL(blob);var a=document.createElement('a');a.download=filename;a.textContent='Download '+filename;a.href=url;a.click();return this;},reset:function()
        {this.list.clear();this.inflight.clear();this.queue.clear();var gameConfig=this.systems.game.config;var sceneConfig=this.systems.settings.loader;this.setBaseURL(GetFastValue(sceneConfig,'baseURL',gameConfig.loaderBaseURL));this.setPath(GetFastValue(sceneConfig,'path',gameConfig.loaderPath));this.setPrefix(GetFastValue(sceneConfig,'prefix',gameConfig.loaderPrefix));this.state=CONST.LOADER_IDLE;},shutdown:function()
        {this.reset();this.state=CONST.LOADER_SHUTDOWN;this.systems.events.off('update',this.update,this);this.systems.events.off('shutdown',this.shutdown,this);},destroy:function()
        {this.shutdown();this.state=CONST.LOADER_DESTROYED;this.systems.events.off('update',this.update,this);this.systems.events.off('start',this.pluginStart,this);this.list=null;this.inflight=null;this.queue=null;this.scene=null;this.systems=null;this.textureManager=null;this.cacheManager=null;this.sceneManager=null;}});PluginCache.register('Loader',LoaderPlugin,'load');module.exports=LoaderPlugin;}),"./loader/MergeXHRSettings.js":(function(module,exports,__webpack_require__){var Extend=__webpack_require__("./utils/object/Extend.js");var XHRSettings=__webpack_require__("./loader/XHRSettings.js");var MergeXHRSettings=function(global,local)
    {var output=(global===undefined)?XHRSettings():Extend({},global);if(local)
    {for(var setting in local)
    {if(local[setting]!==undefined)
    {output[setting]=local[setting];}}}
        return output;};module.exports=MergeXHRSettings;}),"./loader/MultiFile.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var MultiFile=new Class({initialize:function MultiFile(loader,type,key,files)
        {this.loader=loader;this.type=type;this.key=key;this.files=files;this.complete=false;this.pending=files.length;this.failed=0;this.config={};for(var i=0;i<files.length;i++)
        {files[i].multiFile=this;}},isReadyToProcess:function()
        {return(this.pending===0&&this.failed===0&&!this.complete);},addToMultiFile:function(file)
        {this.files.push(file);file.multiFile=this;this.pending++;this.complete=false;return this;},onFileComplete:function(file)
        {var index=this.files.indexOf(file);if(index!==-1)
        {this.pending--;}},onFileFailed:function(file)
        {var index=this.files.indexOf(file);if(index!==-1)
        {this.failed++;}}});module.exports=MultiFile;}),"./loader/XHRLoader.js":(function(module,exports,__webpack_require__){var MergeXHRSettings=__webpack_require__("./loader/MergeXHRSettings.js");var XHRLoader=function(file,globalXHRSettings)
    {var config=MergeXHRSettings(globalXHRSettings,file.xhrSettings);var xhr=new XMLHttpRequest();xhr.open('GET',file.src,config.async,config.user,config.password);xhr.responseType=file.xhrSettings.responseType;xhr.timeout=config.timeout;if(config.header&&config.headerValue)
    {xhr.setRequestHeader(config.header,config.headerValue);}
        if(config.requestedWith)
        {xhr.setRequestHeader('X-Requested-With',config.requestedWith);}
        if(config.overrideMimeType)
        {xhr.overrideMimeType(config.overrideMimeType);}
        xhr.onload=file.onLoad.bind(file,xhr);xhr.onerror=file.onError.bind(file);xhr.onprogress=file.onProgress.bind(file);xhr.send();return xhr;};module.exports=XHRLoader;}),"./loader/XHRSettings.js":(function(module,exports){var XHRSettings=function(responseType,async,user,password,timeout)
    {if(responseType===undefined){responseType='';}
        if(async===undefined){async=true;}
        if(user===undefined){user='';}
        if(password===undefined){password='';}
        if(timeout===undefined){timeout=0;}
        return{responseType:responseType,async:async,user:user,password:password,timeout:timeout,header:undefined,headerValue:undefined,requestedWith:false,overrideMimeType:undefined};};module.exports=XHRSettings;}),"./loader/const.js":(function(module,exports){var FILE_CONST={LOADER_IDLE:0,LOADER_LOADING:1,LOADER_PROCESSING:2,LOADER_COMPLETE:3,LOADER_SHUTDOWN:4,LOADER_DESTROYED:5,FILE_PENDING:10,FILE_LOADING:11,FILE_LOADED:12,FILE_FAILED:13,FILE_PROCESSING:14,FILE_ERRORED:16,FILE_COMPLETE:17,FILE_DESTROYED:18,FILE_POPULATED:19};module.exports=FILE_CONST;}),"./loader/filetypes/AnimationJSONFile.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var FileTypesManager=__webpack_require__("./loader/FileTypesManager.js");var JSONFile=__webpack_require__("./loader/filetypes/JSONFile.js");var AnimationJSONFile=new Class({Extends:JSONFile,initialize:function AnimationJSONFile(loader,key,url,xhrSettings,dataKey)
        {JSONFile.call(this,loader,key,url,xhrSettings,dataKey);this.type='animationJSON';},onProcess:function()
        {this.loader.once('loadcomplete',this.onLoadComplete,this);JSONFile.prototype.onProcess.call(this);},onLoadComplete:function()
        {this.loader.systems.anims.fromJSON(this.data);this.pendingDestroy();}});FileTypesManager.register('animation',function(key,url,dataKey,xhrSettings)
    {if(Array.isArray(key))
    {for(var i=0;i<key.length;i++)
    {this.addFile(new AnimationJSONFile(this,key[i]));}}
    else
    {this.addFile(new AnimationJSONFile(this,key,url,xhrSettings,dataKey));}
        return this;});module.exports=AnimationJSONFile;}),"./loader/filetypes/AtlasJSONFile.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var FileTypesManager=__webpack_require__("./loader/FileTypesManager.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var ImageFile=__webpack_require__("./loader/filetypes/ImageFile.js");var IsPlainObject=__webpack_require__("./utils/object/IsPlainObject.js");var JSONFile=__webpack_require__("./loader/filetypes/JSONFile.js");var MultiFile=__webpack_require__("./loader/MultiFile.js");var AtlasJSONFile=new Class({Extends:MultiFile,initialize:function AtlasJSONFile(loader,key,textureURL,atlasURL,textureXhrSettings,atlasXhrSettings)
        {var image;var data;if(IsPlainObject(key))
        {var config=key;key=GetFastValue(config,'key');image=new ImageFile(loader,{key:key,url:GetFastValue(config,'textureURL'),extension:GetFastValue(config,'textureExtension','png'),normalMap:GetFastValue(config,'normalMap'),xhrSettings:GetFastValue(config,'textureXhrSettings')});data=new JSONFile(loader,{key:key,url:GetFastValue(config,'atlasURL'),extension:GetFastValue(config,'atlasExtension','json'),xhrSettings:GetFastValue(config,'atlasXhrSettings')});}
        else
        {image=new ImageFile(loader,key,textureURL,textureXhrSettings);data=new JSONFile(loader,key,atlasURL,atlasXhrSettings);}
            if(image.linkFile)
            {MultiFile.call(this,loader,'atlasjson',key,[image,data,image.linkFile]);}
            else
            {MultiFile.call(this,loader,'atlasjson',key,[image,data]);}},addToCache:function()
        {if(this.isReadyToProcess())
        {var image=this.files[0];var json=this.files[1];var normalMap=(this.files[2])?this.files[2].data:null;this.loader.textureManager.addAtlas(image.key,image.data,json.data,normalMap);json.addToCache();this.complete=true;}}});FileTypesManager.register('atlas',function(key,textureURL,atlasURL,textureXhrSettings,atlasXhrSettings)
    {var multifile;if(Array.isArray(key))
    {for(var i=0;i<key.length;i++)
    {multifile=new AtlasJSONFile(this,key[i]);this.addFile(multifile.files);}}
    else
    {multifile=new AtlasJSONFile(this,key,textureURL,atlasURL,textureXhrSettings,atlasXhrSettings);this.addFile(multifile.files);}
        return this;});module.exports=AtlasJSONFile;}),"./loader/filetypes/AtlasXMLFile.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var FileTypesManager=__webpack_require__("./loader/FileTypesManager.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var ImageFile=__webpack_require__("./loader/filetypes/ImageFile.js");var IsPlainObject=__webpack_require__("./utils/object/IsPlainObject.js");var MultiFile=__webpack_require__("./loader/MultiFile.js");var XMLFile=__webpack_require__("./loader/filetypes/XMLFile.js");var AtlasXMLFile=new Class({Extends:MultiFile,initialize:function AtlasXMLFile(loader,key,textureURL,atlasURL,textureXhrSettings,atlasXhrSettings)
        {var image;var data;if(IsPlainObject(key))
        {var config=key;key=GetFastValue(config,'key');image=new ImageFile(loader,{key:key,url:GetFastValue(config,'textureURL'),extension:GetFastValue(config,'textureExtension','png'),normalMap:GetFastValue(config,'normalMap'),xhrSettings:GetFastValue(config,'textureXhrSettings')});data=new XMLFile(loader,{key:key,url:GetFastValue(config,'atlasURL'),extension:GetFastValue(config,'atlasExtension','xml'),xhrSettings:GetFastValue(config,'atlasXhrSettings')});}
        else
        {image=new ImageFile(loader,key,textureURL,textureXhrSettings);data=new XMLFile(loader,key,atlasURL,atlasXhrSettings);}
            if(image.linkFile)
            {MultiFile.call(this,loader,'atlasxml',key,[image,data,image.linkFile]);}
            else
            {MultiFile.call(this,loader,'atlasxml',key,[image,data]);}},addToCache:function()
        {if(this.isReadyToProcess())
        {var image=this.files[0];var xml=this.files[1];var normalMap=(this.files[2])?this.files[2].data:null;this.loader.textureManager.addAtlasXML(image.key,image.data,xml.data,normalMap);xml.addToCache();this.complete=true;}}});FileTypesManager.register('atlasXML',function(key,textureURL,atlasURL,textureXhrSettings,atlasXhrSettings)
    {var multifile;if(Array.isArray(key))
    {for(var i=0;i<key.length;i++)
    {multifile=new AtlasXMLFile(this,key[i]);this.addFile(multifile.files);}}
    else
    {multifile=new AtlasXMLFile(this,key,textureURL,atlasURL,textureXhrSettings,atlasXhrSettings);this.addFile(multifile.files);}
        return this;});module.exports=AtlasXMLFile;}),"./loader/filetypes/AudioFile.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var CONST=__webpack_require__("./const.js");var File=__webpack_require__("./loader/File.js");var FileTypesManager=__webpack_require__("./loader/FileTypesManager.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var HTML5AudioFile=__webpack_require__("./loader/filetypes/HTML5AudioFile.js");var IsPlainObject=__webpack_require__("./utils/object/IsPlainObject.js");var AudioFile=new Class({Extends:File,initialize:function AudioFile(loader,key,urlConfig,xhrSettings,audioContext)
        {if(IsPlainObject(key))
        {var config=key;key=GetFastValue(config,'key');xhrSettings=GetFastValue(config,'xhrSettings');audioContext=GetFastValue(config,'context',audioContext);}
            var fileConfig={type:'audio',cache:loader.cacheManager.audio,extension:urlConfig.type,responseType:'arraybuffer',key:key,url:urlConfig.url,xhrSettings:xhrSettings,config:{context:audioContext}};File.call(this,loader,fileConfig);},onProcess:function()
        {this.state=CONST.FILE_PROCESSING;var _this=this;this.config.context.decodeAudioData(this.xhrLoader.response,function(audioBuffer)
        {_this.data=audioBuffer;_this.onProcessComplete();},function(e)
        {console.error('Error decoding audio: '+this.key+' - ',e?e.message:null);_this.onProcessError();});this.config.context=null;}});AudioFile.create=function(loader,key,urls,config,xhrSettings)
    {var game=loader.systems.game;var audioConfig=game.config.audio;var deviceAudio=game.device.audio;if(IsPlainObject(key))
    {urls=GetFastValue(key,'url',[]);config=GetFastValue(key,'config',{});}
        var urlConfig=AudioFile.getAudioURL(game,urls);if(!urlConfig)
    {return null;}
        if(deviceAudio.webAudio&&!(audioConfig&&audioConfig.disableWebAudio))
        {return new AudioFile(loader,key,urlConfig,xhrSettings,game.sound.context);}
        else
        {return new HTML5AudioFile(loader,key,urlConfig,config);}};AudioFile.getAudioURL=function(game,urls)
    {if(!Array.isArray(urls))
    {urls=[urls];}
        for(var i=0;i<urls.length;i++)
        {var url=GetFastValue(urls[i],'url',urls[i]);if(url.indexOf('blob:')===0||url.indexOf('data:')===0)
        {return url;}
            var audioType=url.match(/\.([a-zA-Z0-9]+)($|\?)/);audioType=GetFastValue(urls[i],'type',(audioType)?audioType[1]:'').toLowerCase();if(game.device.audio[audioType])
        {return{url:url,type:audioType};}}
        return null;};FileTypesManager.register('audio',function(key,urls,config,xhrSettings)
    {var game=this.systems.game;var audioConfig=game.config.audio;var deviceAudio=game.device.audio;if((audioConfig&&audioConfig.noAudio)||(!deviceAudio.webAudio&&!deviceAudio.audioData))
    {return this;}
        var audioFile;if(Array.isArray(key))
    {for(var i=0;i<key.length;i++)
    {audioFile=AudioFile.create(this,key[i]);if(audioFile)
    {this.addFile(audioFile);}}}
    else
    {audioFile=AudioFile.create(this,key,urls,config,xhrSettings);if(audioFile)
    {this.addFile(audioFile);}}
        return this;});module.exports=AudioFile;}),"./loader/filetypes/AudioSpriteFile.js":(function(module,exports,__webpack_require__){var AudioFile=__webpack_require__("./loader/filetypes/AudioFile.js");var Class=__webpack_require__("./utils/Class.js");var FileTypesManager=__webpack_require__("./loader/FileTypesManager.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var IsPlainObject=__webpack_require__("./utils/object/IsPlainObject.js");var JSONFile=__webpack_require__("./loader/filetypes/JSONFile.js");var MultiFile=__webpack_require__("./loader/MultiFile.js");var AudioSpriteFile=new Class({Extends:MultiFile,initialize:function AudioSpriteFile(loader,key,jsonURL,audioURL,audioConfig,audioXhrSettings,jsonXhrSettings)
        {if(IsPlainObject(key))
        {var config=key;key=GetFastValue(config,'key');jsonURL=GetFastValue(config,'jsonURL');audioURL=GetFastValue(config,'audioURL');audioConfig=GetFastValue(config,'audioConfig');audioXhrSettings=GetFastValue(config,'audioXhrSettings');jsonXhrSettings=GetFastValue(config,'jsonXhrSettings');}
            var data;if(!audioURL)
        {data=new JSONFile(loader,key,jsonURL,jsonXhrSettings);MultiFile.call(this,loader,'audiosprite',key,[data]);this.config.resourceLoad=true;this.config.audioConfig=audioConfig;this.config.audioXhrSettings=audioXhrSettings;}
        else
        {var audio=AudioFile.create(loader,key,audioURL,audioConfig,audioXhrSettings);if(audio)
        {data=new JSONFile(loader,key,jsonURL,jsonXhrSettings);MultiFile.call(this,loader,'audiosprite',key,[audio,data]);this.config.resourceLoad=false;}}},onFileComplete:function(file)
        {var index=this.files.indexOf(file);if(index!==-1)
        {this.pending--;if(this.config.resourceLoad&&file.type==='json'&&file.data.hasOwnProperty('resources'))
        {var urls=file.data.resources;var audioConfig=GetFastValue(this.config,'audioConfig');var audioXhrSettings=GetFastValue(this.config,'audioXhrSettings');var audio=AudioFile.create(this.loader,file.key,urls,audioConfig,audioXhrSettings);if(audio)
        {this.addToMultiFile(audio);this.loader.addFile(audio);}}}},addToCache:function()
        {if(this.isReadyToProcess())
        {var fileA=this.files[0];var fileB=this.files[1];fileA.addToCache();fileB.addToCache();this.complete=true;}}});FileTypesManager.register('audioSprite',function(key,jsonURL,audioURL,audioConfig,audioXhrSettings,jsonXhrSettings)
    {var game=this.systems.game;var gameAudioConfig=game.config.audio;var deviceAudio=game.device.audio;if((gameAudioConfig&&gameAudioConfig.noAudio)||(!deviceAudio.webAudio&&!deviceAudio.audioData))
    {return this;}
        var multifile;if(Array.isArray(key))
    {for(var i=0;i<key.length;i++)
    {multifile=new AudioSpriteFile(this,key[i]);if(multifile.files)
    {this.addFile(multifile.files);}}}
    else
    {multifile=new AudioSpriteFile(this,key,jsonURL,audioURL,audioConfig,audioXhrSettings,jsonXhrSettings);if(multifile.files)
    {this.addFile(multifile.files);}}
        return this;});}),"./loader/filetypes/BinaryFile.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var CONST=__webpack_require__("./loader/const.js");var File=__webpack_require__("./loader/File.js");var FileTypesManager=__webpack_require__("./loader/FileTypesManager.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var IsPlainObject=__webpack_require__("./utils/object/IsPlainObject.js");var BinaryFile=new Class({Extends:File,initialize:function BinaryFile(loader,key,url,xhrSettings,dataType)
        {var extension='bin';if(IsPlainObject(key))
        {var config=key;key=GetFastValue(config,'key');url=GetFastValue(config,'url');xhrSettings=GetFastValue(config,'xhrSettings');extension=GetFastValue(config,'extension',extension);dataType=GetFastValue(config,'dataType',dataType);}
            var fileConfig={type:'binary',cache:loader.cacheManager.binary,extension:extension,responseType:'arraybuffer',key:key,url:url,xhrSettings:xhrSettings,config:{dataType:dataType}};File.call(this,loader,fileConfig);},onProcess:function()
        {this.state=CONST.FILE_PROCESSING;var ctor=this.config.dataType;this.data=(ctor)?new ctor(this.xhrLoader.response):this.xhrLoader.response;this.onProcessComplete();}});FileTypesManager.register('binary',function(key,url,dataType,xhrSettings)
    {if(Array.isArray(key))
    {for(var i=0;i<key.length;i++)
    {this.addFile(new BinaryFile(this,key[i]));}}
    else
    {this.addFile(new BinaryFile(this,key,url,xhrSettings,dataType));}
        return this;});module.exports=BinaryFile;}),"./loader/filetypes/BitmapFontFile.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var FileTypesManager=__webpack_require__("./loader/FileTypesManager.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var ImageFile=__webpack_require__("./loader/filetypes/ImageFile.js");var IsPlainObject=__webpack_require__("./utils/object/IsPlainObject.js");var MultiFile=__webpack_require__("./loader/MultiFile.js");var ParseXMLBitmapFont=__webpack_require__("./gameobjects/bitmaptext/ParseXMLBitmapFont.js");var XMLFile=__webpack_require__("./loader/filetypes/XMLFile.js");var BitmapFontFile=new Class({Extends:MultiFile,initialize:function BitmapFontFile(loader,key,textureURL,fontDataURL,textureXhrSettings,fontDataXhrSettings)
        {var image;var data;if(IsPlainObject(key))
        {var config=key;key=GetFastValue(config,'key');image=new ImageFile(loader,{key:key,url:GetFastValue(config,'textureURL'),extension:GetFastValue(config,'textureExtension','png'),normalMap:GetFastValue(config,'normalMap'),xhrSettings:GetFastValue(config,'textureXhrSettings')});data=new XMLFile(loader,{key:key,url:GetFastValue(config,'fontDataURL'),extension:GetFastValue(config,'fontDataExtension','xml'),xhrSettings:GetFastValue(config,'fontDataXhrSettings')});}
        else
        {image=new ImageFile(loader,key,textureURL,textureXhrSettings);data=new XMLFile(loader,key,fontDataURL,fontDataXhrSettings);}
            if(image.linkFile)
            {MultiFile.call(this,loader,'bitmapfont',key,[image,data,image.linkFile]);}
            else
            {MultiFile.call(this,loader,'bitmapfont',key,[image,data]);}},addToCache:function()
        {if(this.isReadyToProcess())
        {var image=this.files[0];var xml=this.files[1];image.addToCache();xml.addToCache();this.loader.cacheManager.bitmapFont.add(image.key,{data:ParseXMLBitmapFont(xml.data),texture:image.key,frame:null});this.complete=true;}}});FileTypesManager.register('bitmapFont',function(key,textureURL,fontDataURL,textureXhrSettings,fontDataXhrSettings)
    {var multifile;if(Array.isArray(key))
    {for(var i=0;i<key.length;i++)
    {multifile=new BitmapFontFile(this,key[i]);this.addFile(multifile.files);}}
    else
    {multifile=new BitmapFontFile(this,key,textureURL,fontDataURL,textureXhrSettings,fontDataXhrSettings);this.addFile(multifile.files);}
        return this;});module.exports=BitmapFontFile;}),"./loader/filetypes/GLSLFile.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var CONST=__webpack_require__("./loader/const.js");var File=__webpack_require__("./loader/File.js");var FileTypesManager=__webpack_require__("./loader/FileTypesManager.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var IsPlainObject=__webpack_require__("./utils/object/IsPlainObject.js");var GLSLFile=new Class({Extends:File,initialize:function GLSLFile(loader,key,url,xhrSettings)
        {var extension='glsl';if(IsPlainObject(key))
        {var config=key;key=GetFastValue(config,'key');url=GetFastValue(config,'url');xhrSettings=GetFastValue(config,'xhrSettings');extension=GetFastValue(config,'extension',extension);}
            var fileConfig={type:'glsl',cache:loader.cacheManager.shader,extension:extension,responseType:'text',key:key,url:url,xhrSettings:xhrSettings};File.call(this,loader,fileConfig);},onProcess:function()
        {this.state=CONST.FILE_PROCESSING;this.data=this.xhrLoader.responseText;this.onProcessComplete();}});FileTypesManager.register('glsl',function(key,url,xhrSettings)
    {if(Array.isArray(key))
    {for(var i=0;i<key.length;i++)
    {this.addFile(new GLSLFile(this,key[i]));}}
    else
    {this.addFile(new GLSLFile(this,key,url,xhrSettings));}
        return this;});module.exports=GLSLFile;}),"./loader/filetypes/HTML5AudioFile.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var File=__webpack_require__("./loader/File.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var GetURL=__webpack_require__("./loader/GetURL.js");var IsPlainObject=__webpack_require__("./utils/object/IsPlainObject.js");var HTML5AudioFile=new Class({Extends:File,initialize:function HTML5AudioFile(loader,key,urlConfig,audioConfig)
        {if(IsPlainObject(key))
        {var config=key;key=GetFastValue(config,'key');audioConfig=GetFastValue(config,'config',audioConfig);}
            var fileConfig={type:'audio',cache:loader.cacheManager.audio,extension:urlConfig.type,key:key,url:urlConfig.url,config:audioConfig};File.call(this,loader,fileConfig);this.locked='ontouchstart'in window;this.loaded=false;this.filesLoaded=0;this.filesTotal=0;},onLoad:function()
        {if(this.loaded)
        {return;}
            this.loaded=true;this.loader.nextFile(this,true);},onError:function()
        {for(var i=0;i<this.data.length;i++)
        {var audio=this.data[i];audio.oncanplaythrough=null;audio.onerror=null;}
            this.loader.nextFile(this,false);},onProgress:function(event)
        {var audio=event.target;audio.oncanplaythrough=null;audio.onerror=null;this.filesLoaded++;this.percentComplete=Math.min((this.filesLoaded / this.filesTotal),1);this.loader.emit('fileprogress',this,this.percentComplete);if(this.filesLoaded===this.filesTotal)
        {this.onLoad();}},load:function()
        {this.data=[];var instances=(this.config&&this.config.instances)||1;this.filesTotal=instances;this.filesLoaded=0;this.percentComplete=0;for(var i=0;i<instances;i++)
        {var audio=new Audio();audio.dataset.name=this.key+('0'+i).slice(-2);audio.dataset.used='false';if(this.locked)
        {audio.dataset.locked='true';}
        else
        {audio.dataset.locked='false';audio.preload='auto';audio.oncanplaythrough=this.onProgress.bind(this);audio.onerror=this.onError.bind(this);}
            this.data.push(audio);}
            for(i=0;i<this.data.length;i++)
            {audio=this.data[i];audio.src=GetURL(this,this.loader.baseURL);if(!this.locked)
            {audio.load();}}
            if(this.locked)
            {setTimeout(this.onLoad.bind(this));}}});module.exports=HTML5AudioFile;}),"./loader/filetypes/HTMLFile.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var CONST=__webpack_require__("./loader/const.js");var File=__webpack_require__("./loader/File.js");var FileTypesManager=__webpack_require__("./loader/FileTypesManager.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var IsPlainObject=__webpack_require__("./utils/object/IsPlainObject.js");var HTMLFile=new Class({Extends:File,initialize:function HTMLFile(loader,key,url,xhrSettings)
        {var extension='html';if(IsPlainObject(key))
        {var config=key;key=GetFastValue(config,'key');url=GetFastValue(config,'url');xhrSettings=GetFastValue(config,'xhrSettings');extension=GetFastValue(config,'extension',extension);}
            var fileConfig={type:'text',cache:loader.cacheManager.html,extension:extension,responseType:'text',key:key,url:url,xhrSettings:xhrSettings};File.call(this,loader,fileConfig);},onProcess:function()
        {this.state=CONST.FILE_PROCESSING;this.data=this.xhrLoader.responseText;this.onProcessComplete();}});FileTypesManager.register('html',function(key,url,xhrSettings)
    {if(Array.isArray(key))
    {for(var i=0;i<key.length;i++)
    {this.addFile(new HTMLFile(this,key[i]));}}
    else
    {this.addFile(new HTMLFile(this,key,url,xhrSettings));}
        return this;});module.exports=HTMLFile;}),"./loader/filetypes/HTMLTextureFile.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var CONST=__webpack_require__("./loader/const.js");var File=__webpack_require__("./loader/File.js");var FileTypesManager=__webpack_require__("./loader/FileTypesManager.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var IsPlainObject=__webpack_require__("./utils/object/IsPlainObject.js");var HTMLTextureFile=new Class({Extends:File,initialize:function HTMLTextureFile(loader,key,url,width,height,xhrSettings)
        {if(width===undefined){width=512;}
            if(height===undefined){height=512;}
            var extension='html';if(IsPlainObject(key))
        {var config=key;key=GetFastValue(config,'key');url=GetFastValue(config,'url');xhrSettings=GetFastValue(config,'xhrSettings');extension=GetFastValue(config,'extension',extension);width=GetFastValue(config,'width',width);height=GetFastValue(config,'height',height);}
            var fileConfig={type:'html',cache:loader.textureManager,extension:extension,responseType:'text',key:key,url:url,xhrSettings:xhrSettings,config:{width:width,height:height}};File.call(this,loader,fileConfig);},onProcess:function()
        {this.state=CONST.FILE_PROCESSING;var w=this.config.width;var h=this.config.height;var data=[];data.push('<svg width="'+w+'px" height="'+h+'px" viewBox="0 0 '+w+' '+h+'" xmlns="http://www.w3.org/2000/svg">');data.push('<foreignObject width="100%" height="100%">');data.push('<body xmlns="http://www.w3.org/1999/xhtml">');data.push(this.xhrLoader.responseText);data.push('</body>');data.push('</foreignObject>');data.push('</svg>');var svg=[data.join('\n')];var _this=this;try
        {var blob=new window.Blob(svg,{type:'image/svg+xml;charset=utf-8'});}
        catch(e)
        {_this.state=CONST.FILE_ERRORED;_this.onProcessComplete();return;}
            this.data=new Image();this.data.crossOrigin=this.crossOrigin;this.data.onload=function()
        {File.revokeObjectURL(_this.data);_this.onProcessComplete();};this.data.onerror=function()
        {File.revokeObjectURL(_this.data);_this.onProcessError();};File.createObjectURL(this.data,blob,'image/svg+xml');},addToCache:function()
        {var texture=this.cache.addImage(this.key,this.data);this.pendingDestroy(texture);}});FileTypesManager.register('htmlTexture',function(key,url,width,height,xhrSettings)
    {if(Array.isArray(key))
    {for(var i=0;i<key.length;i++)
    {this.addFile(new HTMLTextureFile(this,key[i]));}}
    else
    {this.addFile(new HTMLTextureFile(this,key,url,width,height,xhrSettings));}
        return this;});module.exports=HTMLTextureFile;}),"./loader/filetypes/ImageFile.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var CONST=__webpack_require__("./loader/const.js");var File=__webpack_require__("./loader/File.js");var FileTypesManager=__webpack_require__("./loader/FileTypesManager.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var IsPlainObject=__webpack_require__("./utils/object/IsPlainObject.js");var ImageFile=new Class({Extends:File,initialize:function ImageFile(loader,key,url,xhrSettings,frameConfig)
        {var extension='png';var normalMapURL;if(IsPlainObject(key))
        {var config=key;key=GetFastValue(config,'key');url=GetFastValue(config,'url');normalMapURL=GetFastValue(config,'normalMap');xhrSettings=GetFastValue(config,'xhrSettings');extension=GetFastValue(config,'extension',extension);frameConfig=GetFastValue(config,'frameConfig');}
            if(Array.isArray(url))
            {normalMapURL=url[1];url=url[0];}
            var fileConfig={type:'image',cache:loader.textureManager,extension:extension,responseType:'blob',key:key,url:url,xhrSettings:xhrSettings,config:frameConfig};File.call(this,loader,fileConfig);if(normalMapURL)
        {var normalMap=new ImageFile(loader,this.key,normalMapURL,xhrSettings,frameConfig);normalMap.type='normalMap';this.setLink(normalMap);loader.addFile(normalMap);}},onProcess:function()
        {this.state=CONST.FILE_PROCESSING;this.data=new Image();this.data.crossOrigin=this.crossOrigin;var _this=this;this.data.onload=function()
        {File.revokeObjectURL(_this.data);_this.onProcessComplete();};this.data.onerror=function()
        {File.revokeObjectURL(_this.data);_this.onProcessError();};File.createObjectURL(this.data,this.xhrLoader.response,'image/png');},addToCache:function()
        {var texture;var linkFile=this.linkFile;if(linkFile&&linkFile.state===CONST.FILE_COMPLETE)
        {if(this.type==='image')
        {texture=this.cache.addImage(this.key,this.data,linkFile.data);}
        else
        {texture=this.cache.addImage(linkFile.key,linkFile.data,this.data);}
            this.pendingDestroy(texture);linkFile.pendingDestroy(texture);}
        else if(!linkFile)
        {texture=this.cache.addImage(this.key,this.data);this.pendingDestroy(texture);}}});FileTypesManager.register('image',function(key,url,xhrSettings)
    {if(Array.isArray(key))
    {for(var i=0;i<key.length;i++)
    {this.addFile(new ImageFile(this,key[i]));}}
    else
    {this.addFile(new ImageFile(this,key,url,xhrSettings));}
        return this;});module.exports=ImageFile;}),"./loader/filetypes/JSONFile.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var CONST=__webpack_require__("./loader/const.js");var File=__webpack_require__("./loader/File.js");var FileTypesManager=__webpack_require__("./loader/FileTypesManager.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var GetValue=__webpack_require__("./utils/object/GetValue.js");var IsPlainObject=__webpack_require__("./utils/object/IsPlainObject.js");var JSONFile=new Class({Extends:File,initialize:function JSONFile(loader,key,url,xhrSettings,dataKey)
        {var extension='json';if(IsPlainObject(key))
        {var config=key;key=GetFastValue(config,'key');url=GetFastValue(config,'url');xhrSettings=GetFastValue(config,'xhrSettings');extension=GetFastValue(config,'extension',extension);dataKey=GetFastValue(config,'dataKey',dataKey);}
            var fileConfig={type:'json',cache:loader.cacheManager.json,extension:extension,responseType:'text',key:key,url:url,xhrSettings:xhrSettings,config:dataKey};File.call(this,loader,fileConfig);if(IsPlainObject(url))
        {if(dataKey)
        {this.data=GetValue(url,dataKey);}
        else
        {this.data=url;}
            this.state=CONST.FILE_POPULATED;}},onProcess:function()
        {if(this.state!==CONST.FILE_POPULATED)
        {this.state=CONST.FILE_PROCESSING;var json=JSON.parse(this.xhrLoader.responseText);var key=this.config;if(typeof key==='string')
        {this.data=GetValue(json,key,json);}
        else
        {this.data=json;}}
            this.onProcessComplete();}});FileTypesManager.register('json',function(key,url,dataKey,xhrSettings)
    {if(Array.isArray(key))
    {for(var i=0;i<key.length;i++)
    {this.addFile(new JSONFile(this,key[i]));}}
    else
    {this.addFile(new JSONFile(this,key,url,xhrSettings,dataKey));}
        return this;});module.exports=JSONFile;}),"./loader/filetypes/MultiAtlasFile.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var FileTypesManager=__webpack_require__("./loader/FileTypesManager.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var ImageFile=__webpack_require__("./loader/filetypes/ImageFile.js");var IsPlainObject=__webpack_require__("./utils/object/IsPlainObject.js");var JSONFile=__webpack_require__("./loader/filetypes/JSONFile.js");var MultiFile=__webpack_require__("./loader/MultiFile.js");var MultiAtlasFile=new Class({Extends:MultiFile,initialize:function MultiAtlasFile(loader,key,atlasURL,path,baseURL,atlasXhrSettings,textureXhrSettings)
        {if(IsPlainObject(key))
        {var config=key;key=GetFastValue(config,'key');atlasURL=GetFastValue(config,'url');atlasXhrSettings=GetFastValue(config,'xhrSettings');path=GetFastValue(config,'path');baseURL=GetFastValue(config,'baseURL');textureXhrSettings=GetFastValue(config,'textureXhrSettings');}
            var data=new JSONFile(loader,key,atlasURL,atlasXhrSettings);MultiFile.call(this,loader,'multiatlas',key,[data]);this.config.path=path;this.config.baseURL=baseURL;this.config.textureXhrSettings=textureXhrSettings;},onFileComplete:function(file)
        {var index=this.files.indexOf(file);if(index!==-1)
        {this.pending--;if(file.type==='json'&&file.data.hasOwnProperty('textures'))
        {var textures=file.data.textures;var config=this.config;var loader=this.loader;var currentBaseURL=loader.baseURL;var currentPath=loader.path;var currentPrefix=loader.prefix;var baseURL=GetFastValue(config,'baseURL',currentBaseURL);var path=GetFastValue(config,'path',currentPath);var prefix=GetFastValue(config,'prefix',currentPrefix);var textureXhrSettings=GetFastValue(config,'textureXhrSettings');loader.setBaseURL(baseURL);loader.setPath(path);loader.setPrefix(prefix);for(var i=0;i<textures.length;i++)
        {var textureURL=textures[i].image;var key='_MA_'+textureURL;var image=new ImageFile(loader,key,textureURL,textureXhrSettings);this.addToMultiFile(image);loader.addFile(image);if(textures[i].normalMap)
        {var normalMap=new ImageFile(loader,key,textures[i].normalMap,textureXhrSettings);normalMap.type='normalMap';image.setLink(normalMap);this.addToMultiFile(normalMap);loader.addFile(normalMap);}}
            loader.setBaseURL(currentBaseURL);loader.setPath(currentPath);loader.setPrefix(currentPrefix);}}},addToCache:function()
        {if(this.isReadyToProcess())
        {var fileJSON=this.files[0];fileJSON.addToCache();var data=[];var images=[];var normalMaps=[];for(var i=1;i<this.files.length;i++)
        {var file=this.files[i];if(file.type==='normalMap')
        {continue;}
            var key=file.key.substr(4);var image=file.data;for(var t=0;t<fileJSON.data.textures.length;t++)
        {var item=fileJSON.data.textures[t];if(item.image===key)
        {images.push(image);data.push(item);if(file.linkFile)
        {normalMaps.push(file.linkFile.data);}
            break;}}}
            if(normalMaps.length===0)
            {normalMaps=undefined;}
            this.loader.textureManager.addAtlasJSONArray(this.key,images,data,normalMaps);this.complete=true;for(i=0;i<this.files.length;i++)
        {this.files[i].pendingDestroy();}}}});FileTypesManager.register('multiatlas',function(key,atlasURL,path,baseURL,atlasXhrSettings)
    {var multifile;if(Array.isArray(key))
    {for(var i=0;i<key.length;i++)
    {multifile=new MultiAtlasFile(this,key[i]);this.addFile(multifile.files);}}
    else
    {multifile=new MultiAtlasFile(this,key,atlasURL,path,baseURL,atlasXhrSettings);this.addFile(multifile.files);}
        return this;});module.exports=MultiAtlasFile;}),"./loader/filetypes/PackFile.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var CONST=__webpack_require__("./loader/const.js");var FileTypesManager=__webpack_require__("./loader/FileTypesManager.js");var JSONFile=__webpack_require__("./loader/filetypes/JSONFile.js");var PackFile=new Class({Extends:JSONFile,initialize:function PackFile(loader,key,url,xhrSettings,dataKey)
        {JSONFile.call(this,loader,key,url,xhrSettings,dataKey);this.type='packfile';},onProcess:function()
        {if(this.state!==CONST.FILE_POPULATED)
        {this.state=CONST.FILE_PROCESSING;this.data=JSON.parse(this.xhrLoader.responseText);}
            this.loader.addPack(this.data,this.config);this.onProcessComplete();}});FileTypesManager.register('pack',function(key,url,packKey,xhrSettings)
    {if(Array.isArray(key))
    {for(var i=0;i<key.length;i++)
    {this.addFile(new PackFile(this,key[i]));}}
    else
    {this.addFile(new PackFile(this,key,url,xhrSettings,packKey));}
        return this;});module.exports=PackFile;}),"./loader/filetypes/PluginFile.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var CONST=__webpack_require__("./loader/const.js");var File=__webpack_require__("./loader/File.js");var FileTypesManager=__webpack_require__("./loader/FileTypesManager.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var IsPlainObject=__webpack_require__("./utils/object/IsPlainObject.js");var PluginFile=new Class({Extends:File,initialize:function PluginFile(loader,key,url,start,mapping,xhrSettings)
        {var extension='js';if(IsPlainObject(key))
        {var config=key;key=GetFastValue(config,'key');url=GetFastValue(config,'url');xhrSettings=GetFastValue(config,'xhrSettings');extension=GetFastValue(config,'extension',extension);start=GetFastValue(config,'start');mapping=GetFastValue(config,'mapping');}
            var fileConfig={type:'plugin',cache:false,extension:extension,responseType:'text',key:key,url:url,xhrSettings:xhrSettings,config:{start:start,mapping:mapping}};File.call(this,loader,fileConfig);if(typeof url==='function')
        {this.data=url;this.state=CONST.FILE_POPULATED;}},onProcess:function()
        {var pluginManager=this.loader.systems.plugins;var config=this.config;var start=GetFastValue(config,'start',false);var mapping=GetFastValue(config,'mapping',null);if(this.state===CONST.FILE_POPULATED)
        {pluginManager.install(this.key,this.data,start,mapping);}
        else
        {this.state=CONST.FILE_PROCESSING;this.data=document.createElement('script');this.data.language='javascript';this.data.type='text/javascript';this.data.defer=false;this.data.text=this.xhrLoader.responseText;document.head.appendChild(this.data);var plugin=pluginManager.install(this.key,window[this.key],start,mapping);if(start||mapping)
        {this.loader.systems[mapping]=plugin;this.loader.scene[mapping]=plugin;}}
            this.onProcessComplete();}});FileTypesManager.register('plugin',function(key,url,start,mapping,xhrSettings)
    {if(Array.isArray(key))
    {for(var i=0;i<key.length;i++)
    {this.addFile(new PluginFile(this,key[i]));}}
    else
    {this.addFile(new PluginFile(this,key,url,start,mapping,xhrSettings));}
        return this;});module.exports=PluginFile;}),"./loader/filetypes/SVGFile.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var CONST=__webpack_require__("./loader/const.js");var File=__webpack_require__("./loader/File.js");var FileTypesManager=__webpack_require__("./loader/FileTypesManager.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var IsPlainObject=__webpack_require__("./utils/object/IsPlainObject.js");var SVGFile=new Class({Extends:File,initialize:function SVGFile(loader,key,url,svgConfig,xhrSettings)
        {var extension='svg';if(IsPlainObject(key))
        {var config=key;key=GetFastValue(config,'key');url=GetFastValue(config,'url');svgConfig=GetFastValue(config,'svgConfig',{});xhrSettings=GetFastValue(config,'xhrSettings');extension=GetFastValue(config,'extension',extension);}
            var fileConfig={type:'svg',cache:loader.textureManager,extension:extension,responseType:'text',key:key,url:url,xhrSettings:xhrSettings,config:{width:GetFastValue(svgConfig,'width'),height:GetFastValue(svgConfig,'height'),scale:GetFastValue(svgConfig,'scale')}};File.call(this,loader,fileConfig);},onProcess:function()
        {this.state=CONST.FILE_PROCESSING;var text=this.xhrLoader.responseText;var svg=[text];var width=this.config.width;var height=this.config.height;var scale=this.config.scale;resize:if(width&&height||scale)
        {var xml=null;var parser=new DOMParser();xml=parser.parseFromString(text,'text/xml');var svgXML=xml.getElementsByTagName('svg')[0];var hasViewBox=svgXML.hasAttribute('viewBox');var svgWidth=parseFloat(svgXML.getAttribute('width'));var svgHeight=parseFloat(svgXML.getAttribute('height'));if(!hasViewBox&&svgWidth&&svgHeight)
        {svgXML.setAttribute('viewBox','0  0 '+svgWidth+' '+svgHeight);}
        else if(hasViewBox&&!svgWidth&&!svgHeight)
        {var viewBox=svgXML.getAttribute('viewBox').split(/\s+|,/);svgWidth=viewBox[2];svgHeight=viewBox[3];}
            if(scale)
            {if(svgWidth&&svgHeight)
            {width=svgWidth*scale;height=svgHeight*scale;}
            else
            {break resize;}}
            svgXML.setAttribute('width',width.toString()+'px');svgXML.setAttribute('height',height.toString()+'px');svg=[(new XMLSerializer()).serializeToString(svgXML)];}
            try
            {var blob=new window.Blob(svg,{type:'image/svg+xml;charset=utf-8'});}
            catch(e)
            {this.onProcessError();return;}
            this.data=new Image();this.data.crossOrigin=this.crossOrigin;var _this=this;var retry=false;this.data.onload=function()
        {if(!retry)
        {File.revokeObjectURL(_this.data);}
            _this.onProcessComplete();};this.data.onerror=function()
        {if(!retry)
        {retry=true;File.revokeObjectURL(_this.data);_this.data.src='data:image/svg+xml,'+encodeURIComponent(svg.join(''));}
        else
        {_this.onProcessError();}};File.createObjectURL(this.data,blob,'image/svg+xml');},addToCache:function()
        {var texture=this.cache.addImage(this.key,this.data);this.pendingDestroy(texture);}});FileTypesManager.register('svg',function(key,url,svgConfig,xhrSettings)
    {if(Array.isArray(key))
    {for(var i=0;i<key.length;i++)
    {this.addFile(new SVGFile(this,key[i]));}}
    else
    {this.addFile(new SVGFile(this,key,url,svgConfig,xhrSettings));}
        return this;});module.exports=SVGFile;}),"./loader/filetypes/SceneFile.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var CONST=__webpack_require__("./loader/const.js");var File=__webpack_require__("./loader/File.js");var FileTypesManager=__webpack_require__("./loader/FileTypesManager.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var IsPlainObject=__webpack_require__("./utils/object/IsPlainObject.js");var SceneFile=new Class({Extends:File,initialize:function SceneFile(loader,key,url,xhrSettings)
        {var extension='js';if(IsPlainObject(key))
        {var config=key;key=GetFastValue(config,'key');url=GetFastValue(config,'url');xhrSettings=GetFastValue(config,'xhrSettings');extension=GetFastValue(config,'extension',extension);}
            var fileConfig={type:'text',cache:loader.cacheManager.text,extension:extension,responseType:'text',key:key,url:url,xhrSettings:xhrSettings};File.call(this,loader,fileConfig);},onProcess:function()
        {this.state=CONST.FILE_PROCESSING;this.data=this.xhrLoader.responseText;this.onProcessComplete();},addToCache:function()
        {var code=this.data.concat('(function(){\n'+'return new '+this.key+'();\n'+'}).call(this);');this.loader.sceneManager.add(this.key,eval(code));this.complete=true;}});FileTypesManager.register('sceneFile',function(key,url,xhrSettings)
    {if(Array.isArray(key))
    {for(var i=0;i<key.length;i++)
    {this.addFile(new SceneFile(this,key[i]));}}
    else
    {this.addFile(new SceneFile(this,key,url,xhrSettings));}
        return this;});module.exports=SceneFile;}),"./loader/filetypes/ScenePluginFile.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var CONST=__webpack_require__("./loader/const.js");var File=__webpack_require__("./loader/File.js");var FileTypesManager=__webpack_require__("./loader/FileTypesManager.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var IsPlainObject=__webpack_require__("./utils/object/IsPlainObject.js");var ScenePluginFile=new Class({Extends:File,initialize:function ScenePluginFile(loader,key,url,systemKey,sceneKey,xhrSettings)
        {var extension='js';if(IsPlainObject(key))
        {var config=key;key=GetFastValue(config,'key');url=GetFastValue(config,'url');xhrSettings=GetFastValue(config,'xhrSettings');extension=GetFastValue(config,'extension',extension);systemKey=GetFastValue(config,'systemKey');sceneKey=GetFastValue(config,'sceneKey');}
            var fileConfig={type:'scenePlugin',cache:false,extension:extension,responseType:'text',key:key,url:url,xhrSettings:xhrSettings,config:{systemKey:systemKey,sceneKey:sceneKey}};File.call(this,loader,fileConfig);if(typeof url==='function')
        {this.data=url;this.state=CONST.FILE_POPULATED;}},onProcess:function()
        {var pluginManager=this.loader.systems.plugins;var config=this.config;var key=this.key;var systemKey=GetFastValue(config,'systemKey',key);var sceneKey=GetFastValue(config,'sceneKey',key);if(this.state===CONST.FILE_POPULATED)
        {pluginManager.installScenePlugin(systemKey,this.data,sceneKey,this.loader.scene);}
        else
        {this.state=CONST.FILE_PROCESSING;this.data=document.createElement('script');this.data.language='javascript';this.data.type='text/javascript';this.data.defer=false;this.data.text=this.xhrLoader.responseText;document.head.appendChild(this.data);pluginManager.installScenePlugin(systemKey,window[this.key],sceneKey,this.loader.scene);}
            this.onProcessComplete();}});FileTypesManager.register('scenePlugin',function(key,url,systemKey,sceneKey,xhrSettings)
    {if(Array.isArray(key))
    {for(var i=0;i<key.length;i++)
    {this.addFile(new ScenePluginFile(this,key[i]));}}
    else
    {this.addFile(new ScenePluginFile(this,key,url,systemKey,sceneKey,xhrSettings));}
        return this;});module.exports=ScenePluginFile;}),"./loader/filetypes/ScriptFile.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var CONST=__webpack_require__("./loader/const.js");var File=__webpack_require__("./loader/File.js");var FileTypesManager=__webpack_require__("./loader/FileTypesManager.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var IsPlainObject=__webpack_require__("./utils/object/IsPlainObject.js");var ScriptFile=new Class({Extends:File,initialize:function ScriptFile(loader,key,url,xhrSettings)
        {var extension='js';if(IsPlainObject(key))
        {var config=key;key=GetFastValue(config,'key');url=GetFastValue(config,'url');xhrSettings=GetFastValue(config,'xhrSettings');extension=GetFastValue(config,'extension',extension);}
            var fileConfig={type:'script',cache:false,extension:extension,responseType:'text',key:key,url:url,xhrSettings:xhrSettings};File.call(this,loader,fileConfig);},onProcess:function()
        {this.state=CONST.FILE_PROCESSING;this.data=document.createElement('script');this.data.language='javascript';this.data.type='text/javascript';this.data.defer=false;this.data.text=this.xhrLoader.responseText;document.head.appendChild(this.data);this.onProcessComplete();}});FileTypesManager.register('script',function(key,url,xhrSettings)
    {if(Array.isArray(key))
    {for(var i=0;i<key.length;i++)
    {this.addFile(new ScriptFile(this,key[i]));}}
    else
    {this.addFile(new ScriptFile(this,key,url,xhrSettings));}
        return this;});module.exports=ScriptFile;}),"./loader/filetypes/SpriteSheetFile.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var FileTypesManager=__webpack_require__("./loader/FileTypesManager.js");var ImageFile=__webpack_require__("./loader/filetypes/ImageFile.js");var SpriteSheetFile=new Class({Extends:ImageFile,initialize:function SpriteSheetFile(loader,key,url,frameConfig,xhrSettings)
        {ImageFile.call(this,loader,key,url,xhrSettings,frameConfig);this.type='spritesheet';},addToCache:function()
        {var texture=this.cache.addSpriteSheet(this.key,this.data,this.config);this.pendingDestroy(texture);}});FileTypesManager.register('spritesheet',function(key,url,frameConfig,xhrSettings)
    {if(Array.isArray(key))
    {for(var i=0;i<key.length;i++)
    {this.addFile(new SpriteSheetFile(this,key[i]));}}
    else
    {this.addFile(new SpriteSheetFile(this,key,url,frameConfig,xhrSettings));}
        return this;});module.exports=SpriteSheetFile;}),"./loader/filetypes/TextFile.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var CONST=__webpack_require__("./loader/const.js");var File=__webpack_require__("./loader/File.js");var FileTypesManager=__webpack_require__("./loader/FileTypesManager.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var IsPlainObject=__webpack_require__("./utils/object/IsPlainObject.js");var TextFile=new Class({Extends:File,initialize:function TextFile(loader,key,url,xhrSettings)
        {var extension='txt';if(IsPlainObject(key))
        {var config=key;key=GetFastValue(config,'key');url=GetFastValue(config,'url');xhrSettings=GetFastValue(config,'xhrSettings');extension=GetFastValue(config,'extension',extension);}
            var fileConfig={type:'text',cache:loader.cacheManager.text,extension:extension,responseType:'text',key:key,url:url,xhrSettings:xhrSettings};File.call(this,loader,fileConfig);},onProcess:function()
        {this.state=CONST.FILE_PROCESSING;this.data=this.xhrLoader.responseText;this.onProcessComplete();}});FileTypesManager.register('text',function(key,url,xhrSettings)
    {if(Array.isArray(key))
    {for(var i=0;i<key.length;i++)
    {this.addFile(new TextFile(this,key[i]));}}
    else
    {this.addFile(new TextFile(this,key,url,xhrSettings));}
        return this;});module.exports=TextFile;}),"./loader/filetypes/TilemapCSVFile.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var CONST=__webpack_require__("./loader/const.js");var File=__webpack_require__("./loader/File.js");var FileTypesManager=__webpack_require__("./loader/FileTypesManager.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var IsPlainObject=__webpack_require__("./utils/object/IsPlainObject.js");var TILEMAP_FORMATS=__webpack_require__("./tilemaps/Formats.js");var TilemapCSVFile=new Class({Extends:File,initialize:function TilemapCSVFile(loader,key,url,xhrSettings)
        {var extension='csv';if(IsPlainObject(key))
        {var config=key;key=GetFastValue(config,'key');url=GetFastValue(config,'url');xhrSettings=GetFastValue(config,'xhrSettings');extension=GetFastValue(config,'extension',extension);}
            var fileConfig={type:'tilemapCSV',cache:loader.cacheManager.tilemap,extension:extension,responseType:'text',key:key,url:url,xhrSettings:xhrSettings};File.call(this,loader,fileConfig);this.tilemapFormat=TILEMAP_FORMATS.CSV;},onProcess:function()
        {this.state=CONST.FILE_PROCESSING;this.data=this.xhrLoader.responseText;this.onProcessComplete();},addToCache:function()
        {var tiledata={format:this.tilemapFormat,data:this.data};this.cache.add(this.key,tiledata);this.pendingDestroy(tiledata);}});FileTypesManager.register('tilemapCSV',function(key,url,xhrSettings)
    {if(Array.isArray(key))
    {for(var i=0;i<key.length;i++)
    {this.addFile(new TilemapCSVFile(this,key[i]));}}
    else
    {this.addFile(new TilemapCSVFile(this,key,url,xhrSettings));}
        return this;});module.exports=TilemapCSVFile;}),"./loader/filetypes/TilemapImpactFile.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var FileTypesManager=__webpack_require__("./loader/FileTypesManager.js");var JSONFile=__webpack_require__("./loader/filetypes/JSONFile.js");var TILEMAP_FORMATS=__webpack_require__("./tilemaps/Formats.js");var TilemapImpactFile=new Class({Extends:JSONFile,initialize:function TilemapImpactFile(loader,key,url,xhrSettings)
        {JSONFile.call(this,loader,key,url,xhrSettings);this.type='tilemapJSON';this.cache=loader.cacheManager.tilemap;},addToCache:function()
        {var tiledata={format:TILEMAP_FORMATS.WELTMEISTER,data:this.data};this.cache.add(this.key,tiledata);this.pendingDestroy(tiledata);}});FileTypesManager.register('tilemapImpact',function(key,url,xhrSettings)
    {if(Array.isArray(key))
    {for(var i=0;i<key.length;i++)
    {this.addFile(new TilemapImpactFile(this,key[i]));}}
    else
    {this.addFile(new TilemapImpactFile(this,key,url,xhrSettings));}
        return this;});module.exports=TilemapImpactFile;}),"./loader/filetypes/TilemapJSONFile.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var FileTypesManager=__webpack_require__("./loader/FileTypesManager.js");var JSONFile=__webpack_require__("./loader/filetypes/JSONFile.js");var TILEMAP_FORMATS=__webpack_require__("./tilemaps/Formats.js");var TilemapJSONFile=new Class({Extends:JSONFile,initialize:function TilemapJSONFile(loader,key,url,xhrSettings)
        {JSONFile.call(this,loader,key,url,xhrSettings);this.type='tilemapJSON';this.cache=loader.cacheManager.tilemap;},addToCache:function()
        {var tiledata={format:TILEMAP_FORMATS.TILED_JSON,data:this.data};this.cache.add(this.key,tiledata);this.pendingDestroy(tiledata);}});FileTypesManager.register('tilemapTiledJSON',function(key,url,xhrSettings)
    {if(Array.isArray(key))
    {for(var i=0;i<key.length;i++)
    {this.addFile(new TilemapJSONFile(this,key[i]));}}
    else
    {this.addFile(new TilemapJSONFile(this,key,url,xhrSettings));}
        return this;});module.exports=TilemapJSONFile;}),"./loader/filetypes/UnityAtlasFile.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var FileTypesManager=__webpack_require__("./loader/FileTypesManager.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var ImageFile=__webpack_require__("./loader/filetypes/ImageFile.js");var IsPlainObject=__webpack_require__("./utils/object/IsPlainObject.js");var MultiFile=__webpack_require__("./loader/MultiFile.js");var TextFile=__webpack_require__("./loader/filetypes/TextFile.js");var UnityAtlasFile=new Class({Extends:MultiFile,initialize:function UnityAtlasFile(loader,key,textureURL,atlasURL,textureXhrSettings,atlasXhrSettings)
        {var image;var data;if(IsPlainObject(key))
        {var config=key;key=GetFastValue(config,'key');image=new ImageFile(loader,{key:key,url:GetFastValue(config,'textureURL'),extension:GetFastValue(config,'textureExtension','png'),normalMap:GetFastValue(config,'normalMap'),xhrSettings:GetFastValue(config,'textureXhrSettings')});data=new TextFile(loader,{key:key,url:GetFastValue(config,'atlasURL'),extension:GetFastValue(config,'atlasExtension','txt'),xhrSettings:GetFastValue(config,'atlasXhrSettings')});}
        else
        {image=new ImageFile(loader,key,textureURL,textureXhrSettings);data=new TextFile(loader,key,atlasURL,atlasXhrSettings);}
            if(image.linkFile)
            {MultiFile.call(this,loader,'unityatlas',key,[image,data,image.linkFile]);}
            else
            {MultiFile.call(this,loader,'unityatlas',key,[image,data]);}},addToCache:function()
        {if(this.isReadyToProcess())
        {var image=this.files[0];var text=this.files[1];var normalMap=(this.files[2])?this.files[2].data:null;this.loader.textureManager.addUnityAtlas(image.key,image.data,text.data,normalMap);text.addToCache();this.complete=true;}}});FileTypesManager.register('unityAtlas',function(key,textureURL,atlasURL,textureXhrSettings,atlasXhrSettings)
    {var multifile;if(Array.isArray(key))
    {for(var i=0;i<key.length;i++)
    {multifile=new UnityAtlasFile(this,key[i]);this.addFile(multifile.files);}}
    else
    {multifile=new UnityAtlasFile(this,key,textureURL,atlasURL,textureXhrSettings,atlasXhrSettings);this.addFile(multifile.files);}
        return this;});module.exports=UnityAtlasFile;}),"./loader/filetypes/XMLFile.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var CONST=__webpack_require__("./loader/const.js");var File=__webpack_require__("./loader/File.js");var FileTypesManager=__webpack_require__("./loader/FileTypesManager.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var IsPlainObject=__webpack_require__("./utils/object/IsPlainObject.js");var ParseXML=__webpack_require__("./dom/ParseXML.js");var XMLFile=new Class({Extends:File,initialize:function XMLFile(loader,key,url,xhrSettings)
        {var extension='xml';if(IsPlainObject(key))
        {var config=key;key=GetFastValue(config,'key');url=GetFastValue(config,'url');xhrSettings=GetFastValue(config,'xhrSettings');extension=GetFastValue(config,'extension',extension);}
            var fileConfig={type:'xml',cache:loader.cacheManager.xml,extension:extension,responseType:'text',key:key,url:url,xhrSettings:xhrSettings};File.call(this,loader,fileConfig);},onProcess:function()
        {this.state=CONST.FILE_PROCESSING;this.data=ParseXML(this.xhrLoader.responseText);if(this.data)
        {this.onProcessComplete();}
        else
        {console.warn('Invalid XMLFile: '+this.key);this.onProcessError();}}});FileTypesManager.register('xml',function(key,url,xhrSettings)
    {if(Array.isArray(key))
    {for(var i=0;i<key.length;i++)
    {this.addFile(new XMLFile(this,key[i]));}}
    else
    {this.addFile(new XMLFile(this,key,url,xhrSettings));}
        return this;});module.exports=XMLFile;}),"./loader/filetypes/index.js":(function(module,exports,__webpack_require__){module.exports={AnimationJSONFile:__webpack_require__("./loader/filetypes/AnimationJSONFile.js"),AtlasJSONFile:__webpack_require__("./loader/filetypes/AtlasJSONFile.js"),AtlasXMLFile:__webpack_require__("./loader/filetypes/AtlasXMLFile.js"),AudioFile:__webpack_require__("./loader/filetypes/AudioFile.js"),AudioSpriteFile:__webpack_require__("./loader/filetypes/AudioSpriteFile.js"),BinaryFile:__webpack_require__("./loader/filetypes/BinaryFile.js"),BitmapFontFile:__webpack_require__("./loader/filetypes/BitmapFontFile.js"),GLSLFile:__webpack_require__("./loader/filetypes/GLSLFile.js"),HTML5AudioFile:__webpack_require__("./loader/filetypes/HTML5AudioFile.js"),HTMLFile:__webpack_require__("./loader/filetypes/HTMLFile.js"),HTMLTextureFile:__webpack_require__("./loader/filetypes/HTMLTextureFile.js"),ImageFile:__webpack_require__("./loader/filetypes/ImageFile.js"),JSONFile:__webpack_require__("./loader/filetypes/JSONFile.js"),MultiAtlasFile:__webpack_require__("./loader/filetypes/MultiAtlasFile.js"),PackFile:__webpack_require__("./loader/filetypes/PackFile.js"),PluginFile:__webpack_require__("./loader/filetypes/PluginFile.js"),SceneFile:__webpack_require__("./loader/filetypes/SceneFile.js"),ScenePluginFile:__webpack_require__("./loader/filetypes/ScenePluginFile.js"),ScriptFile:__webpack_require__("./loader/filetypes/ScriptFile.js"),SpriteSheetFile:__webpack_require__("./loader/filetypes/SpriteSheetFile.js"),SVGFile:__webpack_require__("./loader/filetypes/SVGFile.js"),TextFile:__webpack_require__("./loader/filetypes/TextFile.js"),TilemapCSVFile:__webpack_require__("./loader/filetypes/TilemapCSVFile.js"),TilemapImpactFile:__webpack_require__("./loader/filetypes/TilemapImpactFile.js"),TilemapJSONFile:__webpack_require__("./loader/filetypes/TilemapJSONFile.js"),UnityAtlasFile:__webpack_require__("./loader/filetypes/UnityAtlasFile.js"),XMLFile:__webpack_require__("./loader/filetypes/XMLFile.js")};}),"./loader/index.js":(function(module,exports,__webpack_require__){var CONST=__webpack_require__("./loader/const.js");var Extend=__webpack_require__("./utils/object/Extend.js");var Loader={FileTypes:__webpack_require__("./loader/filetypes/index.js"),File:__webpack_require__("./loader/File.js"),FileTypesManager:__webpack_require__("./loader/FileTypesManager.js"),GetURL:__webpack_require__("./loader/GetURL.js"),LoaderPlugin:__webpack_require__("./loader/LoaderPlugin.js"),MergeXHRSettings:__webpack_require__("./loader/MergeXHRSettings.js"),MultiFile:__webpack_require__("./loader/MultiFile.js"),XHRLoader:__webpack_require__("./loader/XHRLoader.js"),XHRSettings:__webpack_require__("./loader/XHRSettings.js")};Loader=Extend(false,Loader,CONST);module.exports=Loader;}),"./math/Average.js":(function(module,exports){var Average=function(values)
    {var sum=0;for(var i=0;i<values.length;i++)
    {sum+=(+values[i]);}
        return sum / values.length;};module.exports=Average;}),"./math/Bernstein.js":(function(module,exports,__webpack_require__){var Factorial=__webpack_require__("./math/Factorial.js");var Bernstein=function(n,i)
    {return Factorial(n)/ Factorial(i)/ Factorial(n-i);};module.exports=Bernstein;}),"./math/Between.js":(function(module,exports){var Between=function(min,max)
    {return Math.floor(Math.random()*(max-min+1)+min);};module.exports=Between;}),"./math/CatmullRom.js":(function(module,exports){var CatmullRom=function(t,p0,p1,p2,p3)
    {var v0=(p2-p0)*0.5;var v1=(p3-p1)*0.5;var t2=t*t;var t3=t*t2;return(2*p1-2*p2+v0+v1)*t3+(-3*p1+3*p2-2*v0-v1)*t2+v0*t+p1;};module.exports=CatmullRom;}),"./math/CeilTo.js":(function(module,exports){var CeilTo=function(value,place,base)
    {if(place===undefined){place=0;}
        if(base===undefined){base=10;}
        var p=Math.pow(base,-place);return Math.ceil(value*p)/ p;};module.exports=CeilTo;}),"./math/Clamp.js":(function(module,exports){var Clamp=function(value,min,max)
    {return Math.max(min,Math.min(max,value));};module.exports=Clamp;}),"./math/DegToRad.js":(function(module,exports,__webpack_require__){var CONST=__webpack_require__("./math/const.js");var DegToRad=function(degrees)
    {return degrees*CONST.DEG_TO_RAD;};module.exports=DegToRad;}),"./math/Difference.js":(function(module,exports){var Difference=function(a,b)
    {return Math.abs(a-b);};module.exports=Difference;}),"./math/Factorial.js":(function(module,exports){var Factorial=function(value)
    {if(value===0)
    {return 1;}
        var res=value;while(--value)
    {res*=value;}
        return res;};module.exports=Factorial;}),"./math/FloatBetween.js":(function(module,exports){var FloatBetween=function(min,max)
    {return Math.random()*(max-min)+min;};module.exports=FloatBetween;}),"./math/FloorTo.js":(function(module,exports){var FloorTo=function(value,place,base)
    {if(place===undefined){place=0;}
        if(base===undefined){base=10;}
        var p=Math.pow(base,-place);return Math.floor(value*p)/ p;};module.exports=FloorTo;}),"./math/FromPercent.js":(function(module,exports,__webpack_require__){var Clamp=__webpack_require__("./math/Clamp.js");var FromPercent=function(percent,min,max)
    {percent=Clamp(percent,0,1);return(max-min)*percent;};module.exports=FromPercent;}),"./math/GetSpeed.js":(function(module,exports){var GetSpeed=function(distance,time)
    {return(distance / time)/ 1000;};module.exports=GetSpeed;}),"./math/IsEven.js":(function(module,exports){var IsEven=function(value)
    {return(value==parseFloat(value))?!(value%2):void 0;};module.exports=IsEven;}),"./math/IsEvenStrict.js":(function(module,exports){var IsEvenStrict=function(value)
    {return(value===parseFloat(value))?!(value%2):void 0;};module.exports=IsEvenStrict;}),"./math/Linear.js":(function(module,exports){var Linear=function(p0,p1,t)
    {return(p1-p0)*t+p0;};module.exports=Linear;}),"./math/Matrix3.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Matrix3=new Class({initialize:function Matrix3(m)
        {this.val=new Float32Array(9);if(m)
        {this.copy(m);}
        else
        {this.identity();}},clone:function()
        {return new Matrix3(this);},set:function(src)
        {return this.copy(src);},copy:function(src)
        {var out=this.val;var a=src.val;out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return this;},fromMat4:function(m)
        {var a=m.val;var out=this.val;out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[4];out[4]=a[5];out[5]=a[6];out[6]=a[8];out[7]=a[9];out[8]=a[10];return this;},fromArray:function(a)
        {var out=this.val;out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return this;},identity:function()
        {var out=this.val;out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=1;out[5]=0;out[6]=0;out[7]=0;out[8]=1;return this;},transpose:function()
        {var a=this.val;var a01=a[1];var a02=a[2];var a12=a[5];a[1]=a[3];a[2]=a[6];a[3]=a01;a[5]=a[7];a[6]=a02;a[7]=a12;return this;},invert:function()
        {var a=this.val;var a00=a[0];var a01=a[1];var a02=a[2];var a10=a[3];var a11=a[4];var a12=a[5];var a20=a[6];var a21=a[7];var a22=a[8];var b01=a22*a11-a12*a21;var b11=-a22*a10+a12*a20;var b21=a21*a10-a11*a20;var det=a00*b01+a01*b11+a02*b21;if(!det)
        {return null;}
            det=1 / det;a[0]=b01*det;a[1]=(-a22*a01+a02*a21)*det;a[2]=(a12*a01-a02*a11)*det;a[3]=b11*det;a[4]=(a22*a00-a02*a20)*det;a[5]=(-a12*a00+a02*a10)*det;a[6]=b21*det;a[7]=(-a21*a00+a01*a20)*det;a[8]=(a11*a00-a01*a10)*det;return this;},adjoint:function()
        {var a=this.val;var a00=a[0];var a01=a[1];var a02=a[2];var a10=a[3];var a11=a[4];var a12=a[5];var a20=a[6];var a21=a[7];var a22=a[8];a[0]=(a11*a22-a12*a21);a[1]=(a02*a21-a01*a22);a[2]=(a01*a12-a02*a11);a[3]=(a12*a20-a10*a22);a[4]=(a00*a22-a02*a20);a[5]=(a02*a10-a00*a12);a[6]=(a10*a21-a11*a20);a[7]=(a01*a20-a00*a21);a[8]=(a00*a11-a01*a10);return this;},determinant:function()
        {var a=this.val;var a00=a[0];var a01=a[1];var a02=a[2];var a10=a[3];var a11=a[4];var a12=a[5];var a20=a[6];var a21=a[7];var a22=a[8];return a00*(a22*a11-a12*a21)+a01*(-a22*a10+a12*a20)+a02*(a21*a10-a11*a20);},multiply:function(src)
        {var a=this.val;var a00=a[0];var a01=a[1];var a02=a[2];var a10=a[3];var a11=a[4];var a12=a[5];var a20=a[6];var a21=a[7];var a22=a[8];var b=src.val;var b00=b[0];var b01=b[1];var b02=b[2];var b10=b[3];var b11=b[4];var b12=b[5];var b20=b[6];var b21=b[7];var b22=b[8];a[0]=b00*a00+b01*a10+b02*a20;a[1]=b00*a01+b01*a11+b02*a21;a[2]=b00*a02+b01*a12+b02*a22;a[3]=b10*a00+b11*a10+b12*a20;a[4]=b10*a01+b11*a11+b12*a21;a[5]=b10*a02+b11*a12+b12*a22;a[6]=b20*a00+b21*a10+b22*a20;a[7]=b20*a01+b21*a11+b22*a21;a[8]=b20*a02+b21*a12+b22*a22;return this;},translate:function(v)
        {var a=this.val;var x=v.x;var y=v.y;a[6]=x*a[0]+y*a[3]+a[6];a[7]=x*a[1]+y*a[4]+a[7];a[8]=x*a[2]+y*a[5]+a[8];return this;},rotate:function(rad)
        {var a=this.val;var a00=a[0];var a01=a[1];var a02=a[2];var a10=a[3];var a11=a[4];var a12=a[5];var s=Math.sin(rad);var c=Math.cos(rad);a[0]=c*a00+s*a10;a[1]=c*a01+s*a11;a[2]=c*a02+s*a12;a[3]=c*a10-s*a00;a[4]=c*a11-s*a01;a[5]=c*a12-s*a02;return this;},scale:function(v)
        {var a=this.val;var x=v.x;var y=v.y;a[0]=x*a[0];a[1]=x*a[1];a[2]=x*a[2];a[3]=y*a[3];a[4]=y*a[4];a[5]=y*a[5];return this;},fromQuat:function(q)
        {var x=q.x;var y=q.y;var z=q.z;var w=q.w;var x2=x+x;var y2=y+y;var z2=z+z;var xx=x*x2;var xy=x*y2;var xz=x*z2;var yy=y*y2;var yz=y*z2;var zz=z*z2;var wx=w*x2;var wy=w*y2;var wz=w*z2;var out=this.val;out[0]=1-(yy+zz);out[3]=xy+wz;out[6]=xz-wy;out[1]=xy-wz;out[4]=1-(xx+zz);out[7]=yz+wx;out[2]=xz+wy;out[5]=yz-wx;out[8]=1-(xx+yy);return this;},normalFromMat4:function(m)
        {var a=m.val;var out=this.val;var a00=a[0];var a01=a[1];var a02=a[2];var a03=a[3];var a10=a[4];var a11=a[5];var a12=a[6];var a13=a[7];var a20=a[8];var a21=a[9];var a22=a[10];var a23=a[11];var a30=a[12];var a31=a[13];var a32=a[14];var a33=a[15];var b00=a00*a11-a01*a10;var b01=a00*a12-a02*a10;var b02=a00*a13-a03*a10;var b03=a01*a12-a02*a11;var b04=a01*a13-a03*a11;var b05=a02*a13-a03*a12;var b06=a20*a31-a21*a30;var b07=a20*a32-a22*a30;var b08=a20*a33-a23*a30;var b09=a21*a32-a22*a31;var b10=a21*a33-a23*a31;var b11=a22*a33-a23*a32;var det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det)
        {return null;}
            det=1 / det;out[0]=(a11*b11-a12*b10+a13*b09)*det;out[1]=(a12*b08-a10*b11-a13*b07)*det;out[2]=(a10*b10-a11*b08+a13*b06)*det;out[3]=(a02*b10-a01*b11-a03*b09)*det;out[4]=(a00*b11-a02*b08+a03*b07)*det;out[5]=(a01*b08-a00*b10-a03*b06)*det;out[6]=(a31*b05-a32*b04+a33*b03)*det;out[7]=(a32*b02-a30*b05-a33*b01)*det;out[8]=(a30*b04-a31*b02+a33*b00)*det;return this;}});module.exports=Matrix3;}),"./math/Matrix4.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var EPSILON=0.000001;var Matrix4=new Class({initialize:function Matrix4(m)
        {this.val=new Float32Array(16);if(m)
        {this.copy(m);}
        else
        {this.identity();}},clone:function()
        {return new Matrix4(this);},set:function(src)
        {return this.copy(src);},copy:function(src)
        {var out=this.val;var a=src.val;out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return this;},fromArray:function(a)
        {var out=this.val;out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return this;},zero:function()
        {var out=this.val;out[0]=0;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=0;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=0;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=0;return this;},xyz:function(x,y,z)
        {this.identity();var out=this.val;out[12]=x;out[13]=y;out[14]=z;return this;},scaling:function(x,y,z)
        {this.zero();var out=this.val;out[0]=x;out[5]=y;out[10]=z;out[15]=1;return this;},identity:function()
        {var out=this.val;out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return this;},transpose:function()
        {var a=this.val;var a01=a[1];var a02=a[2];var a03=a[3];var a12=a[6];var a13=a[7];var a23=a[11];a[1]=a[4];a[2]=a[8];a[3]=a[12];a[4]=a01;a[6]=a[9];a[7]=a[13];a[8]=a02;a[9]=a12;a[11]=a[14];a[12]=a03;a[13]=a13;a[14]=a23;return this;},invert:function()
        {var a=this.val;var a00=a[0];var a01=a[1];var a02=a[2];var a03=a[3];var a10=a[4];var a11=a[5];var a12=a[6];var a13=a[7];var a20=a[8];var a21=a[9];var a22=a[10];var a23=a[11];var a30=a[12];var a31=a[13];var a32=a[14];var a33=a[15];var b00=a00*a11-a01*a10;var b01=a00*a12-a02*a10;var b02=a00*a13-a03*a10;var b03=a01*a12-a02*a11;var b04=a01*a13-a03*a11;var b05=a02*a13-a03*a12;var b06=a20*a31-a21*a30;var b07=a20*a32-a22*a30;var b08=a20*a33-a23*a30;var b09=a21*a32-a22*a31;var b10=a21*a33-a23*a31;var b11=a22*a33-a23*a32;var det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det)
        {return null;}
            det=1 / det;a[0]=(a11*b11-a12*b10+a13*b09)*det;a[1]=(a02*b10-a01*b11-a03*b09)*det;a[2]=(a31*b05-a32*b04+a33*b03)*det;a[3]=(a22*b04-a21*b05-a23*b03)*det;a[4]=(a12*b08-a10*b11-a13*b07)*det;a[5]=(a00*b11-a02*b08+a03*b07)*det;a[6]=(a32*b02-a30*b05-a33*b01)*det;a[7]=(a20*b05-a22*b02+a23*b01)*det;a[8]=(a10*b10-a11*b08+a13*b06)*det;a[9]=(a01*b08-a00*b10-a03*b06)*det;a[10]=(a30*b04-a31*b02+a33*b00)*det;a[11]=(a21*b02-a20*b04-a23*b00)*det;a[12]=(a11*b07-a10*b09-a12*b06)*det;a[13]=(a00*b09-a01*b07+a02*b06)*det;a[14]=(a31*b01-a30*b03-a32*b00)*det;a[15]=(a20*b03-a21*b01+a22*b00)*det;return this;},adjoint:function()
        {var a=this.val;var a00=a[0];var a01=a[1];var a02=a[2];var a03=a[3];var a10=a[4];var a11=a[5];var a12=a[6];var a13=a[7];var a20=a[8];var a21=a[9];var a22=a[10];var a23=a[11];var a30=a[12];var a31=a[13];var a32=a[14];var a33=a[15];a[0]=(a11*(a22*a33-a23*a32)-a21*(a12*a33-a13*a32)+a31*(a12*a23-a13*a22));a[1]=-(a01*(a22*a33-a23*a32)-a21*(a02*a33-a03*a32)+a31*(a02*a23-a03*a22));a[2]=(a01*(a12*a33-a13*a32)-a11*(a02*a33-a03*a32)+a31*(a02*a13-a03*a12));a[3]=-(a01*(a12*a23-a13*a22)-a11*(a02*a23-a03*a22)+a21*(a02*a13-a03*a12));a[4]=-(a10*(a22*a33-a23*a32)-a20*(a12*a33-a13*a32)+a30*(a12*a23-a13*a22));a[5]=(a00*(a22*a33-a23*a32)-a20*(a02*a33-a03*a32)+a30*(a02*a23-a03*a22));a[6]=-(a00*(a12*a33-a13*a32)-a10*(a02*a33-a03*a32)+a30*(a02*a13-a03*a12));a[7]=(a00*(a12*a23-a13*a22)-a10*(a02*a23-a03*a22)+a20*(a02*a13-a03*a12));a[8]=(a10*(a21*a33-a23*a31)-a20*(a11*a33-a13*a31)+a30*(a11*a23-a13*a21));a[9]=-(a00*(a21*a33-a23*a31)-a20*(a01*a33-a03*a31)+a30*(a01*a23-a03*a21));a[10]=(a00*(a11*a33-a13*a31)-a10*(a01*a33-a03*a31)+a30*(a01*a13-a03*a11));a[11]=-(a00*(a11*a23-a13*a21)-a10*(a01*a23-a03*a21)+a20*(a01*a13-a03*a11));a[12]=-(a10*(a21*a32-a22*a31)-a20*(a11*a32-a12*a31)+a30*(a11*a22-a12*a21));a[13]=(a00*(a21*a32-a22*a31)-a20*(a01*a32-a02*a31)+a30*(a01*a22-a02*a21));a[14]=-(a00*(a11*a32-a12*a31)-a10*(a01*a32-a02*a31)+a30*(a01*a12-a02*a11));a[15]=(a00*(a11*a22-a12*a21)-a10*(a01*a22-a02*a21)+a20*(a01*a12-a02*a11));return this;},determinant:function()
        {var a=this.val;var a00=a[0];var a01=a[1];var a02=a[2];var a03=a[3];var a10=a[4];var a11=a[5];var a12=a[6];var a13=a[7];var a20=a[8];var a21=a[9];var a22=a[10];var a23=a[11];var a30=a[12];var a31=a[13];var a32=a[14];var a33=a[15];var b00=a00*a11-a01*a10;var b01=a00*a12-a02*a10;var b02=a00*a13-a03*a10;var b03=a01*a12-a02*a11;var b04=a01*a13-a03*a11;var b05=a02*a13-a03*a12;var b06=a20*a31-a21*a30;var b07=a20*a32-a22*a30;var b08=a20*a33-a23*a30;var b09=a21*a32-a22*a31;var b10=a21*a33-a23*a31;var b11=a22*a33-a23*a32;return b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;},multiply:function(src)
        {var a=this.val;var a00=a[0];var a01=a[1];var a02=a[2];var a03=a[3];var a10=a[4];var a11=a[5];var a12=a[6];var a13=a[7];var a20=a[8];var a21=a[9];var a22=a[10];var a23=a[11];var a30=a[12];var a31=a[13];var a32=a[14];var a33=a[15];var b=src.val;var b0=b[0];var b1=b[1];var b2=b[2];var b3=b[3];a[0]=b0*a00+b1*a10+b2*a20+b3*a30;a[1]=b0*a01+b1*a11+b2*a21+b3*a31;a[2]=b0*a02+b1*a12+b2*a22+b3*a32;a[3]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[4];b1=b[5];b2=b[6];b3=b[7];a[4]=b0*a00+b1*a10+b2*a20+b3*a30;a[5]=b0*a01+b1*a11+b2*a21+b3*a31;a[6]=b0*a02+b1*a12+b2*a22+b3*a32;a[7]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[8];b1=b[9];b2=b[10];b3=b[11];a[8]=b0*a00+b1*a10+b2*a20+b3*a30;a[9]=b0*a01+b1*a11+b2*a21+b3*a31;a[10]=b0*a02+b1*a12+b2*a22+b3*a32;a[11]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[12];b1=b[13];b2=b[14];b3=b[15];a[12]=b0*a00+b1*a10+b2*a20+b3*a30;a[13]=b0*a01+b1*a11+b2*a21+b3*a31;a[14]=b0*a02+b1*a12+b2*a22+b3*a32;a[15]=b0*a03+b1*a13+b2*a23+b3*a33;return this;},multiplyLocal:function(src)
        {var a=[];var m1=this.val;var m2=src.val;a[0]=m1[0]*m2[0]+m1[1]*m2[4]+m1[2]*m2[8]+m1[3]*m2[12];a[1]=m1[0]*m2[1]+m1[1]*m2[5]+m1[2]*m2[9]+m1[3]*m2[13];a[2]=m1[0]*m2[2]+m1[1]*m2[6]+m1[2]*m2[10]+m1[3]*m2[14];a[3]=m1[0]*m2[3]+m1[1]*m2[7]+m1[2]*m2[11]+m1[3]*m2[15];a[4]=m1[4]*m2[0]+m1[5]*m2[4]+m1[6]*m2[8]+m1[7]*m2[12];a[5]=m1[4]*m2[1]+m1[5]*m2[5]+m1[6]*m2[9]+m1[7]*m2[13];a[6]=m1[4]*m2[2]+m1[5]*m2[6]+m1[6]*m2[10]+m1[7]*m2[14];a[7]=m1[4]*m2[3]+m1[5]*m2[7]+m1[6]*m2[11]+m1[7]*m2[15];a[8]=m1[8]*m2[0]+m1[9]*m2[4]+m1[10]*m2[8]+m1[11]*m2[12];a[9]=m1[8]*m2[1]+m1[9]*m2[5]+m1[10]*m2[9]+m1[11]*m2[13];a[10]=m1[8]*m2[2]+m1[9]*m2[6]+m1[10]*m2[10]+m1[11]*m2[14];a[11]=m1[8]*m2[3]+m1[9]*m2[7]+m1[10]*m2[11]+m1[11]*m2[15];a[12]=m1[12]*m2[0]+m1[13]*m2[4]+m1[14]*m2[8]+m1[15]*m2[12];a[13]=m1[12]*m2[1]+m1[13]*m2[5]+m1[14]*m2[9]+m1[15]*m2[13];a[14]=m1[12]*m2[2]+m1[13]*m2[6]+m1[14]*m2[10]+m1[15]*m2[14];a[15]=m1[12]*m2[3]+m1[13]*m2[7]+m1[14]*m2[11]+m1[15]*m2[15];return this.fromArray(a);},translate:function(v)
        {var x=v.x;var y=v.y;var z=v.z;var a=this.val;a[12]=a[0]*x+a[4]*y+a[8]*z+a[12];a[13]=a[1]*x+a[5]*y+a[9]*z+a[13];a[14]=a[2]*x+a[6]*y+a[10]*z+a[14];a[15]=a[3]*x+a[7]*y+a[11]*z+a[15];return this;},translateXYZ:function(x,y,z)
        {var a=this.val;a[12]=a[0]*x+a[4]*y+a[8]*z+a[12];a[13]=a[1]*x+a[5]*y+a[9]*z+a[13];a[14]=a[2]*x+a[6]*y+a[10]*z+a[14];a[15]=a[3]*x+a[7]*y+a[11]*z+a[15];return this;},scale:function(v)
        {var x=v.x;var y=v.y;var z=v.z;var a=this.val;a[0]=a[0]*x;a[1]=a[1]*x;a[2]=a[2]*x;a[3]=a[3]*x;a[4]=a[4]*y;a[5]=a[5]*y;a[6]=a[6]*y;a[7]=a[7]*y;a[8]=a[8]*z;a[9]=a[9]*z;a[10]=a[10]*z;a[11]=a[11]*z;return this;},scaleXYZ:function(x,y,z)
        {var a=this.val;a[0]=a[0]*x;a[1]=a[1]*x;a[2]=a[2]*x;a[3]=a[3]*x;a[4]=a[4]*y;a[5]=a[5]*y;a[6]=a[6]*y;a[7]=a[7]*y;a[8]=a[8]*z;a[9]=a[9]*z;a[10]=a[10]*z;a[11]=a[11]*z;return this;},makeRotationAxis:function(axis,angle)
        {var c=Math.cos(angle);var s=Math.sin(angle);var t=1-c;var x=axis.x;var y=axis.y;var z=axis.z;var tx=t*x;var ty=t*y;this.fromArray([tx*x+c,tx*y-s*z,tx*z+s*y,0,tx*y+s*z,ty*y+c,ty*z-s*x,0,tx*z-s*y,ty*z+s*x,t*z*z+c,0,0,0,0,1]);return this;},rotate:function(rad,axis)
        {var a=this.val;var x=axis.x;var y=axis.y;var z=axis.z;var len=Math.sqrt(x*x+y*y+z*z);if(Math.abs(len)<EPSILON)
        {return null;}
            len=1 / len;x*=len;y*=len;z*=len;var s=Math.sin(rad);var c=Math.cos(rad);var t=1-c;var a00=a[0];var a01=a[1];var a02=a[2];var a03=a[3];var a10=a[4];var a11=a[5];var a12=a[6];var a13=a[7];var a20=a[8];var a21=a[9];var a22=a[10];var a23=a[11];var b00=x*x*t+c;var b01=y*x*t+z*s;var b02=z*x*t-y*s;var b10=x*y*t-z*s;var b11=y*y*t+c;var b12=z*y*t+x*s;var b20=x*z*t+y*s;var b21=y*z*t-x*s;var b22=z*z*t+c;a[0]=a00*b00+a10*b01+a20*b02;a[1]=a01*b00+a11*b01+a21*b02;a[2]=a02*b00+a12*b01+a22*b02;a[3]=a03*b00+a13*b01+a23*b02;a[4]=a00*b10+a10*b11+a20*b12;a[5]=a01*b10+a11*b11+a21*b12;a[6]=a02*b10+a12*b11+a22*b12;a[7]=a03*b10+a13*b11+a23*b12;a[8]=a00*b20+a10*b21+a20*b22;a[9]=a01*b20+a11*b21+a21*b22;a[10]=a02*b20+a12*b21+a22*b22;a[11]=a03*b20+a13*b21+a23*b22;return this;},rotateX:function(rad)
        {var a=this.val;var s=Math.sin(rad);var c=Math.cos(rad);var a10=a[4];var a11=a[5];var a12=a[6];var a13=a[7];var a20=a[8];var a21=a[9];var a22=a[10];var a23=a[11];a[4]=a10*c+a20*s;a[5]=a11*c+a21*s;a[6]=a12*c+a22*s;a[7]=a13*c+a23*s;a[8]=a20*c-a10*s;a[9]=a21*c-a11*s;a[10]=a22*c-a12*s;a[11]=a23*c-a13*s;return this;},rotateY:function(rad)
        {var a=this.val;var s=Math.sin(rad);var c=Math.cos(rad);var a00=a[0];var a01=a[1];var a02=a[2];var a03=a[3];var a20=a[8];var a21=a[9];var a22=a[10];var a23=a[11];a[0]=a00*c-a20*s;a[1]=a01*c-a21*s;a[2]=a02*c-a22*s;a[3]=a03*c-a23*s;a[8]=a00*s+a20*c;a[9]=a01*s+a21*c;a[10]=a02*s+a22*c;a[11]=a03*s+a23*c;return this;},rotateZ:function(rad)
        {var a=this.val;var s=Math.sin(rad);var c=Math.cos(rad);var a00=a[0];var a01=a[1];var a02=a[2];var a03=a[3];var a10=a[4];var a11=a[5];var a12=a[6];var a13=a[7];a[0]=a00*c+a10*s;a[1]=a01*c+a11*s;a[2]=a02*c+a12*s;a[3]=a03*c+a13*s;a[4]=a10*c-a00*s;a[5]=a11*c-a01*s;a[6]=a12*c-a02*s;a[7]=a13*c-a03*s;return this;},fromRotationTranslation:function(q,v)
        {var out=this.val;var x=q.x;var y=q.y;var z=q.z;var w=q.w;var x2=x+x;var y2=y+y;var z2=z+z;var xx=x*x2;var xy=x*y2;var xz=x*z2;var yy=y*y2;var yz=y*z2;var zz=z*z2;var wx=w*x2;var wy=w*y2;var wz=w*z2;out[0]=1-(yy+zz);out[1]=xy+wz;out[2]=xz-wy;out[3]=0;out[4]=xy-wz;out[5]=1-(xx+zz);out[6]=yz+wx;out[7]=0;out[8]=xz+wy;out[9]=yz-wx;out[10]=1-(xx+yy);out[11]=0;out[12]=v.x;out[13]=v.y;out[14]=v.z;out[15]=1;return this;},fromQuat:function(q)
        {var out=this.val;var x=q.x;var y=q.y;var z=q.z;var w=q.w;var x2=x+x;var y2=y+y;var z2=z+z;var xx=x*x2;var xy=x*y2;var xz=x*z2;var yy=y*y2;var yz=y*z2;var zz=z*z2;var wx=w*x2;var wy=w*y2;var wz=w*z2;out[0]=1-(yy+zz);out[1]=xy+wz;out[2]=xz-wy;out[3]=0;out[4]=xy-wz;out[5]=1-(xx+zz);out[6]=yz+wx;out[7]=0;out[8]=xz+wy;out[9]=yz-wx;out[10]=1-(xx+yy);out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return this;},frustum:function(left,right,bottom,top,near,far)
        {var out=this.val;var rl=1 /(right-left);var tb=1 /(top-bottom);var nf=1 /(near-far);out[0]=(near*2)*rl;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=(near*2)*tb;out[6]=0;out[7]=0;out[8]=(right+left)*rl;out[9]=(top+bottom)*tb;out[10]=(far+near)*nf;out[11]=-1;out[12]=0;out[13]=0;out[14]=(far*near*2)*nf;out[15]=0;return this;},perspective:function(fovy,aspect,near,far)
        {var out=this.val;var f=1.0 / Math.tan(fovy / 2);var nf=1 /(near-far);out[0]=f / aspect;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=f;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=(far+near)*nf;out[11]=-1;out[12]=0;out[13]=0;out[14]=(2*far*near)*nf;out[15]=0;return this;},perspectiveLH:function(width,height,near,far)
        {var out=this.val;out[0]=(2*near)/ width;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=(2*near)/ height;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=-far /(near-far);out[11]=1;out[12]=0;out[13]=0;out[14]=(near*far)/(near-far);out[15]=0;return this;},ortho:function(left,right,bottom,top,near,far)
        {var out=this.val;var lr=left-right;var bt=bottom-top;var nf=near-far;lr=(lr===0)?lr:1 / lr;bt=(bt===0)?bt:1 / bt;nf=(nf===0)?nf:1 / nf;out[0]=-2*lr;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=-2*bt;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=2*nf;out[11]=0;out[12]=(left+right)*lr;out[13]=(top+bottom)*bt;out[14]=(far+near)*nf;out[15]=1;return this;},lookAt:function(eye,center,up)
        {var out=this.val;var eyex=eye.x;var eyey=eye.y;var eyez=eye.z;var upx=up.x;var upy=up.y;var upz=up.z;var centerx=center.x;var centery=center.y;var centerz=center.z;if(Math.abs(eyex-centerx)<EPSILON&&Math.abs(eyey-centery)<EPSILON&&Math.abs(eyez-centerz)<EPSILON)
        {return this.identity();}
            var z0=eyex-centerx;var z1=eyey-centery;var z2=eyez-centerz;var len=1 / Math.sqrt(z0*z0+z1*z1+z2*z2);z0*=len;z1*=len;z2*=len;var x0=upy*z2-upz*z1;var x1=upz*z0-upx*z2;var x2=upx*z1-upy*z0;len=Math.sqrt(x0*x0+x1*x1+x2*x2);if(!len)
        {x0=0;x1=0;x2=0;}
        else
        {len=1 / len;x0*=len;x1*=len;x2*=len;}
            var y0=z1*x2-z2*x1;var y1=z2*x0-z0*x2;var y2=z0*x1-z1*x0;len=Math.sqrt(y0*y0+y1*y1+y2*y2);if(!len)
        {y0=0;y1=0;y2=0;}
        else
        {len=1 / len;y0*=len;y1*=len;y2*=len;}
            out[0]=x0;out[1]=y0;out[2]=z0;out[3]=0;out[4]=x1;out[5]=y1;out[6]=z1;out[7]=0;out[8]=x2;out[9]=y2;out[10]=z2;out[11]=0;out[12]=-(x0*eyex+x1*eyey+x2*eyez);out[13]=-(y0*eyex+y1*eyey+y2*eyez);out[14]=-(z0*eyex+z1*eyey+z2*eyez);out[15]=1;return this;},yawPitchRoll:function(yaw,pitch,roll)
        {this.zero();_tempMat1.zero();_tempMat2.zero();var m0=this.val;var m1=_tempMat1.val;var m2=_tempMat2.val;var s=Math.sin(roll);var c=Math.cos(roll);m0[10]=1;m0[15]=1;m0[0]=c;m0[1]=s;m0[4]=-s;m0[5]=c;s=Math.sin(pitch);c=Math.cos(pitch);m1[0]=1;m1[15]=1;m1[5]=c;m1[10]=c;m1[9]=-s;m1[6]=s;s=Math.sin(yaw);c=Math.cos(yaw);m2[5]=1;m2[15]=1;m2[0]=c;m2[2]=-s;m2[8]=s;m2[10]=c;this.multiplyLocal(_tempMat1);this.multiplyLocal(_tempMat2);return this;},setWorldMatrix:function(rotation,position,scale,viewMatrix,projectionMatrix)
        {this.yawPitchRoll(rotation.y,rotation.x,rotation.z);_tempMat1.scaling(scale.x,scale.y,scale.z);_tempMat2.xyz(position.x,position.y,position.z);this.multiplyLocal(_tempMat1);this.multiplyLocal(_tempMat2);if(viewMatrix!==undefined)
        {this.multiplyLocal(viewMatrix);}
            if(projectionMatrix!==undefined)
            {this.multiplyLocal(projectionMatrix);}
            return this;}});var _tempMat1=new Matrix4();var _tempMat2=new Matrix4();module.exports=Matrix4;}),"./math/MaxAdd.js":(function(module,exports){var MaxAdd=function(value,amount,max)
    {return Math.min(value+amount,max);};module.exports=MaxAdd;}),"./math/MinSub.js":(function(module,exports){var MinSub=function(value,amount,min)
    {return Math.max(value-amount,min);};module.exports=MinSub;}),"./math/Percent.js":(function(module,exports){var Percent=function(value,min,max,upperMax)
    {if(max===undefined){max=min+1;}
        var percentage=(value-min)/(max-min);if(percentage>1)
    {if(upperMax!==undefined)
    {percentage=((upperMax-value))/(upperMax-max);if(percentage<0)
    {percentage=0;}}
    else
    {percentage=1;}}
    else if(percentage<0)
    {percentage=0;}
        return percentage;};module.exports=Percent;}),"./math/Quaternion.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Vector3=__webpack_require__("./math/Vector3.js");var Matrix3=__webpack_require__("./math/Matrix3.js");var EPSILON=0.000001;var siNext=new Int8Array([1,2,0]);var tmp=new Float32Array([0,0,0]);var xUnitVec3=new Vector3(1,0,0);var yUnitVec3=new Vector3(0,1,0);var tmpvec=new Vector3();var tmpMat3=new Matrix3();var Quaternion=new Class({initialize:function Quaternion(x,y,z,w)
        {if(typeof x==='object')
        {this.x=x.x||0;this.y=x.y||0;this.z=x.z||0;this.w=x.w||0;}
        else
        {this.x=x||0;this.y=y||0;this.z=z||0;this.w=w||0;}},copy:function(src)
        {this.x=src.x;this.y=src.y;this.z=src.z;this.w=src.w;return this;},set:function(x,y,z,w)
        {if(typeof x==='object')
        {this.x=x.x||0;this.y=x.y||0;this.z=x.z||0;this.w=x.w||0;}
        else
        {this.x=x||0;this.y=y||0;this.z=z||0;this.w=w||0;}
            return this;},add:function(v)
        {this.x+=v.x;this.y+=v.y;this.z+=v.z;this.w+=v.w;return this;},subtract:function(v)
        {this.x-=v.x;this.y-=v.y;this.z-=v.z;this.w-=v.w;return this;},scale:function(scale)
        {this.x*=scale;this.y*=scale;this.z*=scale;this.w*=scale;return this;},length:function()
        {var x=this.x;var y=this.y;var z=this.z;var w=this.w;return Math.sqrt(x*x+y*y+z*z+w*w);},lengthSq:function()
        {var x=this.x;var y=this.y;var z=this.z;var w=this.w;return x*x+y*y+z*z+w*w;},normalize:function()
        {var x=this.x;var y=this.y;var z=this.z;var w=this.w;var len=x*x+y*y+z*z+w*w;if(len>0)
        {len=1 / Math.sqrt(len);this.x=x*len;this.y=y*len;this.z=z*len;this.w=w*len;}
            return this;},dot:function(v)
        {return this.x*v.x+this.y*v.y+this.z*v.z+this.w*v.w;},lerp:function(v,t)
        {if(t===undefined){t=0;}
            var ax=this.x;var ay=this.y;var az=this.z;var aw=this.w;this.x=ax+t*(v.x-ax);this.y=ay+t*(v.y-ay);this.z=az+t*(v.z-az);this.w=aw+t*(v.w-aw);return this;},rotationTo:function(a,b)
        {var dot=a.x*b.x+a.y*b.y+a.z*b.z;if(dot<-0.999999)
        {if(tmpvec.copy(xUnitVec3).cross(a).length()<EPSILON)
        {tmpvec.copy(yUnitVec3).cross(a);}
            tmpvec.normalize();return this.setAxisAngle(tmpvec,Math.PI);}
        else if(dot>0.999999)
        {this.x=0;this.y=0;this.z=0;this.w=1;return this;}
        else
        {tmpvec.copy(a).cross(b);this.x=tmpvec.x;this.y=tmpvec.y;this.z=tmpvec.z;this.w=1+dot;return this.normalize();}},setAxes:function(view,right,up)
        {var m=tmpMat3.val;m[0]=right.x;m[3]=right.y;m[6]=right.z;m[1]=up.x;m[4]=up.y;m[7]=up.z;m[2]=-view.x;m[5]=-view.y;m[8]=-view.z;return this.fromMat3(tmpMat3).normalize();},identity:function()
        {this.x=0;this.y=0;this.z=0;this.w=1;return this;},setAxisAngle:function(axis,rad)
        {rad=rad*0.5;var s=Math.sin(rad);this.x=s*axis.x;this.y=s*axis.y;this.z=s*axis.z;this.w=Math.cos(rad);return this;},multiply:function(b)
        {var ax=this.x;var ay=this.y;var az=this.z;var aw=this.w;var bx=b.x;var by=b.y;var bz=b.z;var bw=b.w;this.x=ax*bw+aw*bx+ay*bz-az*by;this.y=ay*bw+aw*by+az*bx-ax*bz;this.z=az*bw+aw*bz+ax*by-ay*bx;this.w=aw*bw-ax*bx-ay*by-az*bz;return this;},slerp:function(b,t)
        {var ax=this.x;var ay=this.y;var az=this.z;var aw=this.w;var bx=b.x;var by=b.y;var bz=b.z;var bw=b.w;var cosom=ax*bx+ay*by+az*bz+aw*bw;if(cosom<0)
        {cosom=-cosom;bx=-bx;by=-by;bz=-bz;bw=-bw;}
            var scale0=1-t;var scale1=t;if((1-cosom)>EPSILON)
        {var omega=Math.acos(cosom);var sinom=Math.sin(omega);scale0=Math.sin((1.0-t)*omega)/ sinom;scale1=Math.sin(t*omega)/ sinom;}
            this.x=scale0*ax+scale1*bx;this.y=scale0*ay+scale1*by;this.z=scale0*az+scale1*bz;this.w=scale0*aw+scale1*bw;return this;},invert:function()
        {var a0=this.x;var a1=this.y;var a2=this.z;var a3=this.w;var dot=a0*a0+a1*a1+a2*a2+a3*a3;var invDot=(dot)?1 / dot:0;this.x=-a0*invDot;this.y=-a1*invDot;this.z=-a2*invDot;this.w=a3*invDot;return this;},conjugate:function()
        {this.x=-this.x;this.y=-this.y;this.z=-this.z;return this;},rotateX:function(rad)
        {rad*=0.5;var ax=this.x;var ay=this.y;var az=this.z;var aw=this.w;var bx=Math.sin(rad);var bw=Math.cos(rad);this.x=ax*bw+aw*bx;this.y=ay*bw+az*bx;this.z=az*bw-ay*bx;this.w=aw*bw-ax*bx;return this;},rotateY:function(rad)
        {rad*=0.5;var ax=this.x;var ay=this.y;var az=this.z;var aw=this.w;var by=Math.sin(rad);var bw=Math.cos(rad);this.x=ax*bw-az*by;this.y=ay*bw+aw*by;this.z=az*bw+ax*by;this.w=aw*bw-ay*by;return this;},rotateZ:function(rad)
        {rad*=0.5;var ax=this.x;var ay=this.y;var az=this.z;var aw=this.w;var bz=Math.sin(rad);var bw=Math.cos(rad);this.x=ax*bw+ay*bz;this.y=ay*bw-ax*bz;this.z=az*bw+aw*bz;this.w=aw*bw-az*bz;return this;},calculateW:function()
        {var x=this.x;var y=this.y;var z=this.z;this.w=-Math.sqrt(1.0-x*x-y*y-z*z);return this;},fromMat3:function(mat)
        {var m=mat.val;var fTrace=m[0]+m[4]+m[8];var fRoot;if(fTrace>0)
        {fRoot=Math.sqrt(fTrace+1.0);this.w=0.5*fRoot;fRoot=0.5 / fRoot;this.x=(m[7]-m[5])*fRoot;this.y=(m[2]-m[6])*fRoot;this.z=(m[3]-m[1])*fRoot;}
        else
        {var i=0;if(m[4]>m[0])
        {i=1;}
            if(m[8]>m[i*3+i])
            {i=2;}
            var j=siNext[i];var k=siNext[j];fRoot=Math.sqrt(m[i*3+i]-m[j*3+j]-m[k*3+k]+1);tmp[i]=0.5*fRoot;fRoot=0.5 / fRoot;tmp[j]=(m[j*3+i]+m[i*3+j])*fRoot;tmp[k]=(m[k*3+i]+m[i*3+k])*fRoot;this.x=tmp[0];this.y=tmp[1];this.z=tmp[2];this.w=(m[k*3+j]-m[j*3+k])*fRoot;}
            return this;}});module.exports=Quaternion;}),"./math/RadToDeg.js":(function(module,exports,__webpack_require__){var CONST=__webpack_require__("./math/const.js");var RadToDeg=function(radians)
    {return radians*CONST.RAD_TO_DEG;};module.exports=RadToDeg;}),"./math/RandomXY.js":(function(module,exports){var RandomXY=function(vector,scale)
    {if(scale===undefined){scale=1;}
        var r=Math.random()*2*Math.PI;vector.x=Math.cos(r)*scale;vector.y=Math.sin(r)*scale;return vector;};module.exports=RandomXY;}),"./math/RandomXYZ.js":(function(module,exports){var RandomXYZ=function(vec3,radius)
    {if(radius===undefined){radius=1;}
        var r=Math.random()*2*Math.PI;var z=(Math.random()*2)-1;var zScale=Math.sqrt(1-z*z)*radius;vec3.x=Math.cos(r)*zScale;vec3.y=Math.sin(r)*zScale;vec3.z=z*radius;return vec3;};module.exports=RandomXYZ;}),"./math/RandomXYZW.js":(function(module,exports){var RandomXYZW=function(vec4,scale)
    {if(scale===undefined){scale=1;}
        vec4.x=(Math.random()*2-1)*scale;vec4.y=(Math.random()*2-1)*scale;vec4.z=(Math.random()*2-1)*scale;vec4.w=(Math.random()*2-1)*scale;return vec4;};module.exports=RandomXYZW;}),"./math/Rotate.js":(function(module,exports){var Rotate=function(point,angle)
    {var x=point.x;var y=point.y;point.x=(x*Math.cos(angle))-(y*Math.sin(angle));point.y=(x*Math.sin(angle))+(y*Math.cos(angle));return point;};module.exports=Rotate;}),"./math/RotateAround.js":(function(module,exports){var RotateAround=function(point,x,y,angle)
    {var c=Math.cos(angle);var s=Math.sin(angle);var tx=point.x-x;var ty=point.y-y;point.x=tx*c-ty*s+x;point.y=tx*s+ty*c+y;return point;};module.exports=RotateAround;}),"./math/RotateAroundDistance.js":(function(module,exports){var RotateAroundDistance=function(point,x,y,angle,distance)
    {var t=angle+Math.atan2(point.y-y,point.x-x);point.x=x+(distance*Math.cos(t));point.y=y+(distance*Math.sin(t));return point;};module.exports=RotateAroundDistance;}),"./math/RotateVec3.js":(function(module,exports,__webpack_require__){var Vector3=__webpack_require__("./math/Vector3.js");var Matrix4=__webpack_require__("./math/Matrix4.js");var Quaternion=__webpack_require__("./math/Quaternion.js");var tmpMat4=new Matrix4();var tmpQuat=new Quaternion();var tmpVec3=new Vector3();var RotateVec3=function(vec,axis,radians)
    {tmpQuat.setAxisAngle(axis,radians);tmpMat4.fromRotationTranslation(tmpQuat,tmpVec3.set(0,0,0));return vec.transformMat4(tmpMat4);};module.exports=RotateVec3;}),"./math/RoundAwayFromZero.js":(function(module,exports){var RoundAwayFromZero=function(value)
    {return(value>0)?Math.ceil(value):Math.floor(value);};module.exports=RoundAwayFromZero;}),"./math/RoundTo.js":(function(module,exports){var RoundTo=function(value,place,base)
    {if(place===undefined){place=0;}
        if(base===undefined){base=10;}
        var p=Math.pow(base,-place);return Math.round(value*p)/ p;};module.exports=RoundTo;}),"./math/SinCosTableGenerator.js":(function(module,exports){var SinCosTableGenerator=function(length,sinAmp,cosAmp,frequency)
    {if(sinAmp===undefined){sinAmp=1;}
        if(cosAmp===undefined){cosAmp=1;}
        if(frequency===undefined){frequency=1;}
        frequency*=Math.PI / length;var cos=[];var sin=[];for(var c=0;c<length;c++)
    {cosAmp-=sinAmp*frequency;sinAmp+=cosAmp*frequency;cos[c]=cosAmp;sin[c]=sinAmp;}
        return{sin:sin,cos:cos,length:length};};module.exports=SinCosTableGenerator;}),"./math/SmoothStep.js":(function(module,exports){var SmoothStep=function(x,min,max)
    {if(x<=min)
    {return 0;}
        if(x>=max)
        {return 1;}
        x=(x-min)/(max-min);return x*x*(3-2*x);};module.exports=SmoothStep;}),"./math/SmootherStep.js":(function(module,exports){var SmootherStep=function(x,min,max)
    {x=Math.max(0,Math.min(1,(x-min)/(max-min)));return x*x*x*(x*(x*6-15)+10);};module.exports=SmootherStep;}),"./math/TransformXY.js":(function(module,exports,__webpack_require__){var Vector2=__webpack_require__("./math/Vector2.js");var TransformXY=function(x,y,positionX,positionY,rotation,scaleX,scaleY,output)
    {if(output===undefined){output=new Vector2();}
        var radianSin=Math.sin(rotation);var radianCos=Math.cos(rotation);var a=radianCos*scaleX;var b=radianSin*scaleX;var c=-radianSin*scaleY;var d=radianCos*scaleY;var id=1 /((a*d)+(c*-b));output.x=(d*id*x)+(-c*id*y)+(((positionY*c)-(positionX*d))*id);output.y=(a*id*y)+(-b*id*x)+(((-positionY*a)+(positionX*b))*id);return output;};module.exports=TransformXY;}),"./math/Vector2.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Vector2=new Class({initialize:function Vector2(x,y)
        {this.x=0;this.y=0;if(typeof x==='object')
        {this.x=x.x||0;this.y=x.y||0;}
        else
        {if(y===undefined){y=x;}
            this.x=x||0;this.y=y||0;}},clone:function()
        {return new Vector2(this.x,this.y);},copy:function(src)
        {this.x=src.x||0;this.y=src.y||0;return this;},setFromObject:function(obj)
        {this.x=obj.x||0;this.y=obj.y||0;return this;},set:function(x,y)
        {if(y===undefined){y=x;}
            this.x=x;this.y=y;return this;},setTo:function(x,y)
        {return this.set(x,y);},setToPolar:function(azimuth,radius)
        {if(radius==null){radius=1;}
            this.x=Math.cos(azimuth)*radius;this.y=Math.sin(azimuth)*radius;return this;},equals:function(v)
        {return((this.x===v.x)&&(this.y===v.y));},angle:function()
        {var angle=Math.atan2(this.y,this.x);if(angle<0)
        {angle+=2*Math.PI;}
            return angle;},add:function(src)
        {this.x+=src.x;this.y+=src.y;return this;},subtract:function(src)
        {this.x-=src.x;this.y-=src.y;return this;},multiply:function(src)
        {this.x*=src.x;this.y*=src.y;return this;},scale:function(value)
        {if(isFinite(value))
        {this.x*=value;this.y*=value;}
        else
        {this.x=0;this.y=0;}
            return this;},divide:function(src)
        {this.x /=src.x;this.y /=src.y;return this;},negate:function()
        {this.x=-this.x;this.y=-this.y;return this;},distance:function(src)
        {var dx=src.x-this.x;var dy=src.y-this.y;return Math.sqrt(dx*dx+dy*dy);},distanceSq:function(src)
        {var dx=src.x-this.x;var dy=src.y-this.y;return dx*dx+dy*dy;},length:function()
        {var x=this.x;var y=this.y;return Math.sqrt(x*x+y*y);},lengthSq:function()
        {var x=this.x;var y=this.y;return x*x+y*y;},normalize:function()
        {var x=this.x;var y=this.y;var len=x*x+y*y;if(len>0)
        {len=1 / Math.sqrt(len);this.x=x*len;this.y=y*len;}
            return this;},normalizeRightHand:function()
        {var x=this.x;this.x=this.y*-1;this.y=x;return this;},dot:function(src)
        {return this.x*src.x+this.y*src.y;},cross:function(src)
        {return this.x*src.y-this.y*src.x;},lerp:function(src,t)
        {if(t===undefined){t=0;}
            var ax=this.x;var ay=this.y;this.x=ax+t*(src.x-ax);this.y=ay+t*(src.y-ay);return this;},transformMat3:function(mat)
        {var x=this.x;var y=this.y;var m=mat.val;this.x=m[0]*x+m[3]*y+m[6];this.y=m[1]*x+m[4]*y+m[7];return this;},transformMat4:function(mat)
        {var x=this.x;var y=this.y;var m=mat.val;this.x=m[0]*x+m[4]*y+m[12];this.y=m[1]*x+m[5]*y+m[13];return this;},reset:function()
        {this.x=0;this.y=0;return this;}});Vector2.ZERO=new Vector2();module.exports=Vector2;}),"./math/Vector3.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Vector3=new Class({initialize:function Vector3(x,y,z)
        {this.x=0;this.y=0;this.z=0;if(typeof x==='object')
        {this.x=x.x||0;this.y=x.y||0;this.z=x.z||0;}
        else
        {this.x=x||0;this.y=y||0;this.z=z||0;}},up:function()
        {this.x=0;this.y=1;this.z=0;return this;},clone:function()
        {return new Vector3(this.x,this.y,this.z);},crossVectors:function(a,b)
        {var ax=a.x;var ay=a.y;var az=a.z;var bx=b.x;var by=b.y;var bz=b.z;this.x=ay*bz-az*by;this.y=az*bx-ax*bz;this.z=ax*by-ay*bx;return this;},equals:function(v)
        {return((this.x===v.x)&&(this.y===v.y)&&(this.z===v.z));},copy:function(src)
        {this.x=src.x;this.y=src.y;this.z=src.z||0;return this;},set:function(x,y,z)
        {if(typeof x==='object')
        {this.x=x.x||0;this.y=x.y||0;this.z=x.z||0;}
        else
        {this.x=x||0;this.y=y||0;this.z=z||0;}
            return this;},add:function(v)
        {this.x+=v.x;this.y+=v.y;this.z+=v.z||0;return this;},subtract:function(v)
        {this.x-=v.x;this.y-=v.y;this.z-=v.z||0;return this;},multiply:function(v)
        {this.x*=v.x;this.y*=v.y;this.z*=v.z||1;return this;},scale:function(scale)
        {if(isFinite(scale))
        {this.x*=scale;this.y*=scale;this.z*=scale;}
        else
        {this.x=0;this.y=0;this.z=0;}
            return this;},divide:function(v)
        {this.x /=v.x;this.y /=v.y;this.z /=v.z||1;return this;},negate:function()
        {this.x=-this.x;this.y=-this.y;this.z=-this.z;return this;},distance:function(v)
        {var dx=v.x-this.x;var dy=v.y-this.y;var dz=v.z-this.z||0;return Math.sqrt(dx*dx+dy*dy+dz*dz);},distanceSq:function(v)
        {var dx=v.x-this.x;var dy=v.y-this.y;var dz=v.z-this.z||0;return dx*dx+dy*dy+dz*dz;},length:function()
        {var x=this.x;var y=this.y;var z=this.z;return Math.sqrt(x*x+y*y+z*z);},lengthSq:function()
        {var x=this.x;var y=this.y;var z=this.z;return x*x+y*y+z*z;},normalize:function()
        {var x=this.x;var y=this.y;var z=this.z;var len=x*x+y*y+z*z;if(len>0)
        {len=1 / Math.sqrt(len);this.x=x*len;this.y=y*len;this.z=z*len;}
            return this;},dot:function(v)
        {return this.x*v.x+this.y*v.y+this.z*v.z;},cross:function(v)
        {var ax=this.x;var ay=this.y;var az=this.z;var bx=v.x;var by=v.y;var bz=v.z;this.x=ay*bz-az*by;this.y=az*bx-ax*bz;this.z=ax*by-ay*bx;return this;},lerp:function(v,t)
        {if(t===undefined){t=0;}
            var ax=this.x;var ay=this.y;var az=this.z;this.x=ax+t*(v.x-ax);this.y=ay+t*(v.y-ay);this.z=az+t*(v.z-az);return this;},transformMat3:function(mat)
        {var x=this.x;var y=this.y;var z=this.z;var m=mat.val;this.x=x*m[0]+y*m[3]+z*m[6];this.y=x*m[1]+y*m[4]+z*m[7];this.z=x*m[2]+y*m[5]+z*m[8];return this;},transformMat4:function(mat)
        {var x=this.x;var y=this.y;var z=this.z;var m=mat.val;this.x=m[0]*x+m[4]*y+m[8]*z+m[12];this.y=m[1]*x+m[5]*y+m[9]*z+m[13];this.z=m[2]*x+m[6]*y+m[10]*z+m[14];return this;},transformCoordinates:function(mat)
        {var x=this.x;var y=this.y;var z=this.z;var m=mat.val;var tx=(x*m[0])+(y*m[4])+(z*m[8])+m[12];var ty=(x*m[1])+(y*m[5])+(z*m[9])+m[13];var tz=(x*m[2])+(y*m[6])+(z*m[10])+m[14];var tw=(x*m[3])+(y*m[7])+(z*m[11])+m[15];this.x=tx / tw;this.y=ty / tw;this.z=tz / tw;return this;},transformQuat:function(q)
        {var x=this.x;var y=this.y;var z=this.z;var qx=q.x;var qy=q.y;var qz=q.z;var qw=q.w;var ix=qw*x+qy*z-qz*y;var iy=qw*y+qz*x-qx*z;var iz=qw*z+qx*y-qy*x;var iw=-qx*x-qy*y-qz*z;this.x=ix*qw+iw*-qx+iy*-qz-iz*-qy;this.y=iy*qw+iw*-qy+iz*-qx-ix*-qz;this.z=iz*qw+iw*-qz+ix*-qy-iy*-qx;return this;},project:function(mat)
        {var x=this.x;var y=this.y;var z=this.z;var m=mat.val;var a00=m[0];var a01=m[1];var a02=m[2];var a03=m[3];var a10=m[4];var a11=m[5];var a12=m[6];var a13=m[7];var a20=m[8];var a21=m[9];var a22=m[10];var a23=m[11];var a30=m[12];var a31=m[13];var a32=m[14];var a33=m[15];var lw=1 /(x*a03+y*a13+z*a23+a33);this.x=(x*a00+y*a10+z*a20+a30)*lw;this.y=(x*a01+y*a11+z*a21+a31)*lw;this.z=(x*a02+y*a12+z*a22+a32)*lw;return this;},unproject:function(viewport,invProjectionView)
        {var viewX=viewport.x;var viewY=viewport.y;var viewWidth=viewport.z;var viewHeight=viewport.w;var x=this.x-viewX;var y=(viewHeight-this.y-1)-viewY;var z=this.z;this.x=(2*x)/ viewWidth-1;this.y=(2*y)/ viewHeight-1;this.z=2*z-1;return this.project(invProjectionView);},reset:function()
        {this.x=0;this.y=0;this.z=0;return this;}});module.exports=Vector3;}),"./math/Vector4.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Vector4=new Class({initialize:function Vector4(x,y,z,w)
        {this.x=0;this.y=0;this.z=0;this.w=0;if(typeof x==='object')
        {this.x=x.x||0;this.y=x.y||0;this.z=x.z||0;this.w=x.w||0;}
        else
        {this.x=x||0;this.y=y||0;this.z=z||0;this.w=w||0;}},clone:function()
        {return new Vector4(this.x,this.y,this.z,this.w);},copy:function(src)
        {this.x=src.x;this.y=src.y;this.z=src.z||0;this.w=src.w||0;return this;},equals:function(v)
        {return((this.x===v.x)&&(this.y===v.y)&&(this.z===v.z)&&(this.w===v.w));},set:function(x,y,z,w)
        {if(typeof x==='object')
        {this.x=x.x||0;this.y=x.y||0;this.z=x.z||0;this.w=x.w||0;}
        else
        {this.x=x||0;this.y=y||0;this.z=z||0;this.w=w||0;}
            return this;},add:function(v)
        {this.x+=v.x;this.y+=v.y;this.z+=v.z||0;this.w+=v.w||0;return this;},subtract:function(v)
        {this.x-=v.x;this.y-=v.y;this.z-=v.z||0;this.w-=v.w||0;return this;},scale:function(scale)
        {this.x*=scale;this.y*=scale;this.z*=scale;this.w*=scale;return this;},length:function()
        {var x=this.x;var y=this.y;var z=this.z;var w=this.w;return Math.sqrt(x*x+y*y+z*z+w*w);},lengthSq:function()
        {var x=this.x;var y=this.y;var z=this.z;var w=this.w;return x*x+y*y+z*z+w*w;},normalize:function()
        {var x=this.x;var y=this.y;var z=this.z;var w=this.w;var len=x*x+y*y+z*z+w*w;if(len>0)
        {len=1 / Math.sqrt(len);this.x=x*len;this.y=y*len;this.z=z*len;this.w=w*len;}
            return this;},dot:function(v)
        {return this.x*v.x+this.y*v.y+this.z*v.z+this.w*v.w;},lerp:function(v,t)
        {if(t===undefined){t=0;}
            var ax=this.x;var ay=this.y;var az=this.z;var aw=this.w;this.x=ax+t*(v.x-ax);this.y=ay+t*(v.y-ay);this.z=az+t*(v.z-az);this.w=aw+t*(v.w-aw);return this;},multiply:function(v)
        {this.x*=v.x;this.y*=v.y;this.z*=v.z||1;this.w*=v.w||1;return this;},divide:function(v)
        {this.x /=v.x;this.y /=v.y;this.z /=v.z||1;this.w /=v.w||1;return this;},distance:function(v)
        {var dx=v.x-this.x;var dy=v.y-this.y;var dz=v.z-this.z||0;var dw=v.w-this.w||0;return Math.sqrt(dx*dx+dy*dy+dz*dz+dw*dw);},distanceSq:function(v)
        {var dx=v.x-this.x;var dy=v.y-this.y;var dz=v.z-this.z||0;var dw=v.w-this.w||0;return dx*dx+dy*dy+dz*dz+dw*dw;},negate:function()
        {this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this;},transformMat4:function(mat)
        {var x=this.x;var y=this.y;var z=this.z;var w=this.w;var m=mat.val;this.x=m[0]*x+m[4]*y+m[8]*z+m[12]*w;this.y=m[1]*x+m[5]*y+m[9]*z+m[13]*w;this.z=m[2]*x+m[6]*y+m[10]*z+m[14]*w;this.w=m[3]*x+m[7]*y+m[11]*z+m[15]*w;return this;},transformQuat:function(q)
        {var x=this.x;var y=this.y;var z=this.z;var qx=q.x;var qy=q.y;var qz=q.z;var qw=q.w;var ix=qw*x+qy*z-qz*y;var iy=qw*y+qz*x-qx*z;var iz=qw*z+qx*y-qy*x;var iw=-qx*x-qy*y-qz*z;this.x=ix*qw+iw*-qx+iy*-qz-iz*-qy;this.y=iy*qw+iw*-qy+iz*-qx-ix*-qz;this.z=iz*qw+iw*-qz+ix*-qy-iy*-qx;return this;},reset:function()
        {this.x=0;this.y=0;this.z=0;this.w=0;return this;}});Vector4.prototype.sub=Vector4.prototype.subtract;Vector4.prototype.mul=Vector4.prototype.multiply;Vector4.prototype.div=Vector4.prototype.divide;Vector4.prototype.dist=Vector4.prototype.distance;Vector4.prototype.distSq=Vector4.prototype.distanceSq;Vector4.prototype.len=Vector4.prototype.length;Vector4.prototype.lenSq=Vector4.prototype.lengthSq;module.exports=Vector4;}),"./math/Within.js":(function(module,exports){var Within=function(a,b,tolerance)
    {return(Math.abs(a-b)<=tolerance);};module.exports=Within;}),"./math/Wrap.js":(function(module,exports){var Wrap=function(value,min,max)
    {var range=max-min;return(min+((((value-min)%range)+range)%range));};module.exports=Wrap;}),"./math/angle/Between.js":(function(module,exports){var Between=function(x1,y1,x2,y2)
    {return Math.atan2(y2-y1,x2-x1);};module.exports=Between;}),"./math/angle/BetweenPoints.js":(function(module,exports){var BetweenPoints=function(point1,point2)
    {return Math.atan2(point2.y-point1.y,point2.x-point1.x);};module.exports=BetweenPoints;}),"./math/angle/BetweenPointsY.js":(function(module,exports){var BetweenPointsY=function(point1,point2)
    {return Math.atan2(point2.x-point1.x,point2.y-point1.y);};module.exports=BetweenPointsY;}),"./math/angle/BetweenY.js":(function(module,exports){var BetweenY=function(x1,y1,x2,y2)
    {return Math.atan2(x2-x1,y2-y1);};module.exports=BetweenY;}),"./math/angle/CounterClockwise.js":(function(module,exports,__webpack_require__){var CONST=__webpack_require__("./math/const.js");var CounterClockwise=function(angle)
    {return Math.abs((((angle+CONST.TAU)%CONST.PI2)-CONST.PI2)%CONST.PI2);};module.exports=CounterClockwise;}),"./math/angle/Normalize.js":(function(module,exports){var Normalize=function(angle)
    {angle=angle%(2*Math.PI);if(angle>=0)
    {return angle;}
    else
    {return angle+2*Math.PI;}};module.exports=Normalize;}),"./math/angle/Reverse.js":(function(module,exports,__webpack_require__){var Normalize=__webpack_require__("./math/angle/Normalize.js");var Reverse=function(angle)
    {return Normalize(angle+Math.PI);};module.exports=Reverse;}),"./math/angle/RotateTo.js":(function(module,exports,__webpack_require__){var MATH_CONST=__webpack_require__("./math/const.js");var RotateTo=function(currentAngle,targetAngle,lerp)
    {if(lerp===undefined){lerp=0.05;}
        if(currentAngle===targetAngle)
        {return currentAngle;}
        if(Math.abs(targetAngle-currentAngle)<=lerp||Math.abs(targetAngle-currentAngle)>=(MATH_CONST.PI2-lerp))
        {currentAngle=targetAngle;}
        else
        {if(Math.abs(targetAngle-currentAngle)>Math.PI)
        {if(targetAngle<currentAngle)
        {targetAngle+=MATH_CONST.PI2;}
        else
        {targetAngle-=MATH_CONST.PI2;}}
            if(targetAngle>currentAngle)
            {currentAngle+=lerp;}
            else if(targetAngle<currentAngle)
            {currentAngle-=lerp;}}
        return currentAngle;};module.exports=RotateTo;}),"./math/angle/ShortestBetween.js":(function(module,exports){var ShortestBetween=function(angle1,angle2)
    {var difference=angle2-angle1;if(difference===0)
    {return 0;}
        var times=Math.floor((difference-(-180))/ 360);return difference-(times*360);};module.exports=ShortestBetween;}),"./math/angle/Wrap.js":(function(module,exports,__webpack_require__){var MathWrap=__webpack_require__("./math/Wrap.js");var Wrap=function(angle)
    {return MathWrap(angle,-Math.PI,Math.PI);};module.exports=Wrap;}),"./math/angle/WrapDegrees.js":(function(module,exports,__webpack_require__){var Wrap=__webpack_require__("./math/Wrap.js");var WrapDegrees=function(angle)
    {return Wrap(angle,-180,180);};module.exports=WrapDegrees;}),"./math/angle/index.js":(function(module,exports,__webpack_require__){module.exports={Between:__webpack_require__("./math/angle/Between.js"),BetweenPoints:__webpack_require__("./math/angle/BetweenPoints.js"),BetweenPointsY:__webpack_require__("./math/angle/BetweenPointsY.js"),BetweenY:__webpack_require__("./math/angle/BetweenY.js"),CounterClockwise:__webpack_require__("./math/angle/CounterClockwise.js"),Normalize:__webpack_require__("./math/angle/Normalize.js"),Reverse:__webpack_require__("./math/angle/Reverse.js"),RotateTo:__webpack_require__("./math/angle/RotateTo.js"),ShortestBetween:__webpack_require__("./math/angle/ShortestBetween.js"),Wrap:__webpack_require__("./math/angle/Wrap.js"),WrapDegrees:__webpack_require__("./math/angle/WrapDegrees.js")};}),"./math/const.js":(function(module,exports){var MATH_CONST={PI2:Math.PI*2,TAU:Math.PI*0.5,EPSILON:1.0e-6,DEG_TO_RAD:Math.PI / 180,RAD_TO_DEG:180 / Math.PI,RND:null};module.exports=MATH_CONST;}),"./math/distance/DistanceBetween.js":(function(module,exports){var DistanceBetween=function(x1,y1,x2,y2)
    {var dx=x1-x2;var dy=y1-y2;return Math.sqrt(dx*dx+dy*dy);};module.exports=DistanceBetween;}),"./math/distance/DistancePower.js":(function(module,exports){var DistancePower=function(x1,y1,x2,y2,pow)
    {if(pow===undefined){pow=2;}
        return Math.sqrt(Math.pow(x2-x1,pow)+Math.pow(y2-y1,pow));};module.exports=DistancePower;}),"./math/distance/DistanceSquared.js":(function(module,exports){var DistanceSquared=function(x1,y1,x2,y2)
    {var dx=x1-x2;var dy=y1-y2;return dx*dx+dy*dy;};module.exports=DistanceSquared;}),"./math/distance/index.js":(function(module,exports,__webpack_require__){module.exports={Between:__webpack_require__("./math/distance/DistanceBetween.js"),Power:__webpack_require__("./math/distance/DistancePower.js"),Squared:__webpack_require__("./math/distance/DistanceSquared.js")};}),"./math/easing/EaseMap.js":(function(module,exports,__webpack_require__){var Back=__webpack_require__("./math/easing/back/index.js");var Bounce=__webpack_require__("./math/easing/bounce/index.js");var Circular=__webpack_require__("./math/easing/circular/index.js");var Cubic=__webpack_require__("./math/easing/cubic/index.js");var Elastic=__webpack_require__("./math/easing/elastic/index.js");var Expo=__webpack_require__("./math/easing/expo/index.js");var Linear=__webpack_require__("./math/easing/linear/index.js");var Quadratic=__webpack_require__("./math/easing/quadratic/index.js");var Quartic=__webpack_require__("./math/easing/quartic/index.js");var Quintic=__webpack_require__("./math/easing/quintic/index.js");var Sine=__webpack_require__("./math/easing/sine/index.js");var Stepped=__webpack_require__("./math/easing/stepped/index.js");module.exports={Power0:Linear,Power1:Quadratic.Out,Power2:Cubic.Out,Power3:Quartic.Out,Power4:Quintic.Out,Linear:Linear,Quad:Quadratic.Out,Cubic:Cubic.Out,Quart:Quartic.Out,Quint:Quintic.Out,Sine:Sine.Out,Expo:Expo.Out,Circ:Circular.Out,Elastic:Elastic.Out,Back:Back.Out,Bounce:Bounce.Out,Stepped:Stepped,'Quad.easeIn':Quadratic.In,'Cubic.easeIn':Cubic.In,'Quart.easeIn':Quartic.In,'Quint.easeIn':Quintic.In,'Sine.easeIn':Sine.In,'Expo.easeIn':Expo.In,'Circ.easeIn':Circular.In,'Elastic.easeIn':Elastic.In,'Back.easeIn':Back.In,'Bounce.easeIn':Bounce.In,'Quad.easeOut':Quadratic.Out,'Cubic.easeOut':Cubic.Out,'Quart.easeOut':Quartic.Out,'Quint.easeOut':Quintic.Out,'Sine.easeOut':Sine.Out,'Expo.easeOut':Expo.Out,'Circ.easeOut':Circular.Out,'Elastic.easeOut':Elastic.Out,'Back.easeOut':Back.Out,'Bounce.easeOut':Bounce.Out,'Quad.easeInOut':Quadratic.InOut,'Cubic.easeInOut':Cubic.InOut,'Quart.easeInOut':Quartic.InOut,'Quint.easeInOut':Quintic.InOut,'Sine.easeInOut':Sine.InOut,'Expo.easeInOut':Expo.InOut,'Circ.easeInOut':Circular.InOut,'Elastic.easeInOut':Elastic.InOut,'Back.easeInOut':Back.InOut,'Bounce.easeInOut':Bounce.InOut};}),"./math/easing/back/In.js":(function(module,exports){var In=function(v,overshoot)
    {if(overshoot===undefined){overshoot=1.70158;}
        return v*v*((overshoot+1)*v-overshoot);};module.exports=In;}),"./math/easing/back/InOut.js":(function(module,exports){var InOut=function(v,overshoot)
    {if(overshoot===undefined){overshoot=1.70158;}
        var s=overshoot*1.525;if((v*=2)<1)
    {return 0.5*(v*v*((s+1)*v-s));}
    else
    {return 0.5*((v-=2)*v*((s+1)*v+s)+2);}};module.exports=InOut;}),"./math/easing/back/Out.js":(function(module,exports){var Out=function(v,overshoot)
    {if(overshoot===undefined){overshoot=1.70158;}
        return--v*v*((overshoot+1)*v+overshoot)+1;};module.exports=Out;}),"./math/easing/back/index.js":(function(module,exports,__webpack_require__){module.exports={In:__webpack_require__("./math/easing/back/In.js"),Out:__webpack_require__("./math/easing/back/Out.js"),InOut:__webpack_require__("./math/easing/back/InOut.js")};}),"./math/easing/bounce/In.js":(function(module,exports){var In=function(v)
    {v=1-v;if(v<1 / 2.75)
    {return 1-(7.5625*v*v);}
    else if(v<2 / 2.75)
    {return 1-(7.5625*(v-=1.5 / 2.75)*v+0.75);}
    else if(v<2.5 / 2.75)
    {return 1-(7.5625*(v-=2.25 / 2.75)*v+0.9375);}
    else
    {return 1-(7.5625*(v-=2.625 / 2.75)*v+0.984375);}};module.exports=In;}),"./math/easing/bounce/InOut.js":(function(module,exports){var InOut=function(v)
    {var reverse=false;if(v<0.5)
    {v=1-(v*2);reverse=true;}
    else
    {v=(v*2)-1;}
        if(v<1 / 2.75)
        {v=7.5625*v*v;}
        else if(v<2 / 2.75)
        {v=7.5625*(v-=1.5 / 2.75)*v+0.75;}
        else if(v<2.5 / 2.75)
        {v=7.5625*(v-=2.25 / 2.75)*v+0.9375;}
        else
        {v=7.5625*(v-=2.625 / 2.75)*v+0.984375;}
        if(reverse)
        {return(1-v)*0.5;}
        else
        {return v*0.5+0.5;}};module.exports=InOut;}),"./math/easing/bounce/Out.js":(function(module,exports){var Out=function(v)
    {if(v<1 / 2.75)
    {return 7.5625*v*v;}
    else if(v<2 / 2.75)
    {return 7.5625*(v-=1.5 / 2.75)*v+0.75;}
    else if(v<2.5 / 2.75)
    {return 7.5625*(v-=2.25 / 2.75)*v+0.9375;}
    else
    {return 7.5625*(v-=2.625 / 2.75)*v+0.984375;}};module.exports=Out;}),"./math/easing/bounce/index.js":(function(module,exports,__webpack_require__){module.exports={In:__webpack_require__("./math/easing/bounce/In.js"),Out:__webpack_require__("./math/easing/bounce/Out.js"),InOut:__webpack_require__("./math/easing/bounce/InOut.js")};}),"./math/easing/circular/In.js":(function(module,exports){var In=function(v)
    {return 1-Math.sqrt(1-v*v);};module.exports=In;}),"./math/easing/circular/InOut.js":(function(module,exports){var InOut=function(v)
    {if((v*=2)<1)
    {return-0.5*(Math.sqrt(1-v*v)-1);}
    else
    {return 0.5*(Math.sqrt(1-(v-=2)*v)+1);}};module.exports=InOut;}),"./math/easing/circular/Out.js":(function(module,exports){var Out=function(v)
    {return Math.sqrt(1-(--v*v));};module.exports=Out;}),"./math/easing/circular/index.js":(function(module,exports,__webpack_require__){module.exports={In:__webpack_require__("./math/easing/circular/In.js"),Out:__webpack_require__("./math/easing/circular/Out.js"),InOut:__webpack_require__("./math/easing/circular/InOut.js")};}),"./math/easing/cubic/In.js":(function(module,exports){var In=function(v)
    {return v*v*v;};module.exports=In;}),"./math/easing/cubic/InOut.js":(function(module,exports){var InOut=function(v)
    {if((v*=2)<1)
    {return 0.5*v*v*v;}
    else
    {return 0.5*((v-=2)*v*v+2);}};module.exports=InOut;}),"./math/easing/cubic/Out.js":(function(module,exports){var Out=function(v)
    {return--v*v*v+1;};module.exports=Out;}),"./math/easing/cubic/index.js":(function(module,exports,__webpack_require__){module.exports={In:__webpack_require__("./math/easing/cubic/In.js"),Out:__webpack_require__("./math/easing/cubic/Out.js"),InOut:__webpack_require__("./math/easing/cubic/InOut.js")};}),"./math/easing/elastic/In.js":(function(module,exports){var In=function(v,amplitude,period)
    {if(amplitude===undefined){amplitude=0.1;}
        if(period===undefined){period=0.1;}
        if(v===0)
        {return 0;}
        else if(v===1)
        {return 1;}
        else
        {var s=period / 4;if(amplitude<1)
        {amplitude=1;}
        else
        {s=period*Math.asin(1 / amplitude)/(2*Math.PI);}
            return-(amplitude*Math.pow(2,10*(v-=1))*Math.sin((v-s)*(2*Math.PI)/ period));}};module.exports=In;}),"./math/easing/elastic/InOut.js":(function(module,exports){var InOut=function(v,amplitude,period)
    {if(amplitude===undefined){amplitude=0.1;}
        if(period===undefined){period=0.1;}
        if(v===0)
        {return 0;}
        else if(v===1)
        {return 1;}
        else
        {var s=period / 4;if(amplitude<1)
        {amplitude=1;}
        else
        {s=period*Math.asin(1 / amplitude)/(2*Math.PI);}
            if((v*=2)<1)
            {return-0.5*(amplitude*Math.pow(2,10*(v-=1))*Math.sin((v-s)*(2*Math.PI)/ period));}
            else
            {return amplitude*Math.pow(2,-10*(v-=1))*Math.sin((v-s)*(2*Math.PI)/ period)*0.5+1;}}};module.exports=InOut;}),"./math/easing/elastic/Out.js":(function(module,exports){var Out=function(v,amplitude,period)
    {if(amplitude===undefined){amplitude=0.1;}
        if(period===undefined){period=0.1;}
        if(v===0)
        {return 0;}
        else if(v===1)
        {return 1;}
        else
        {var s=period / 4;if(amplitude<1)
        {amplitude=1;}
        else
        {s=period*Math.asin(1 / amplitude)/(2*Math.PI);}
            return(amplitude*Math.pow(2,-10*v)*Math.sin((v-s)*(2*Math.PI)/ period)+1);}};module.exports=Out;}),"./math/easing/elastic/index.js":(function(module,exports,__webpack_require__){module.exports={In:__webpack_require__("./math/easing/elastic/In.js"),Out:__webpack_require__("./math/easing/elastic/Out.js"),InOut:__webpack_require__("./math/easing/elastic/InOut.js")};}),"./math/easing/expo/In.js":(function(module,exports){var In=function(v)
    {return Math.pow(2,10*(v-1))-0.001;};module.exports=In;}),"./math/easing/expo/InOut.js":(function(module,exports){var InOut=function(v)
    {if((v*=2)<1)
    {return 0.5*Math.pow(2,10*(v-1));}
    else
    {return 0.5*(2-Math.pow(2,-10*(v-1)));}};module.exports=InOut;}),"./math/easing/expo/Out.js":(function(module,exports){var Out=function(v)
    {return 1-Math.pow(2,-10*v);};module.exports=Out;}),"./math/easing/expo/index.js":(function(module,exports,__webpack_require__){module.exports={In:__webpack_require__("./math/easing/expo/In.js"),Out:__webpack_require__("./math/easing/expo/Out.js"),InOut:__webpack_require__("./math/easing/expo/InOut.js")};}),"./math/easing/index.js":(function(module,exports,__webpack_require__){module.exports={Back:__webpack_require__("./math/easing/back/index.js"),Bounce:__webpack_require__("./math/easing/bounce/index.js"),Circular:__webpack_require__("./math/easing/circular/index.js"),Cubic:__webpack_require__("./math/easing/cubic/index.js"),Elastic:__webpack_require__("./math/easing/elastic/index.js"),Expo:__webpack_require__("./math/easing/expo/index.js"),Linear:__webpack_require__("./math/easing/linear/index.js"),Quadratic:__webpack_require__("./math/easing/quadratic/index.js"),Quartic:__webpack_require__("./math/easing/quartic/index.js"),Quintic:__webpack_require__("./math/easing/quintic/index.js"),Sine:__webpack_require__("./math/easing/sine/index.js"),Stepped:__webpack_require__("./math/easing/stepped/index.js")};}),"./math/easing/linear/Linear.js":(function(module,exports){var Linear=function(v)
    {return v;};module.exports=Linear;}),"./math/easing/linear/index.js":(function(module,exports,__webpack_require__){module.exports=__webpack_require__("./math/easing/linear/Linear.js");}),"./math/easing/quadratic/In.js":(function(module,exports){var In=function(v)
    {return v*v;};module.exports=In;}),"./math/easing/quadratic/InOut.js":(function(module,exports){var InOut=function(v)
    {if((v*=2)<1)
    {return 0.5*v*v;}
    else
    {return-0.5*(--v*(v-2)-1);}};module.exports=InOut;}),"./math/easing/quadratic/Out.js":(function(module,exports){var Out=function(v)
    {return v*(2-v);};module.exports=Out;}),"./math/easing/quadratic/index.js":(function(module,exports,__webpack_require__){module.exports={In:__webpack_require__("./math/easing/quadratic/In.js"),Out:__webpack_require__("./math/easing/quadratic/Out.js"),InOut:__webpack_require__("./math/easing/quadratic/InOut.js")};}),"./math/easing/quartic/In.js":(function(module,exports){var In=function(v)
    {return v*v*v*v;};module.exports=In;}),"./math/easing/quartic/InOut.js":(function(module,exports){var InOut=function(v)
    {if((v*=2)<1)
    {return 0.5*v*v*v*v;}
    else
    {return-0.5*((v-=2)*v*v*v-2);}};module.exports=InOut;}),"./math/easing/quartic/Out.js":(function(module,exports){var Out=function(v)
    {return 1-(--v*v*v*v);};module.exports=Out;}),"./math/easing/quartic/index.js":(function(module,exports,__webpack_require__){module.exports={In:__webpack_require__("./math/easing/quartic/In.js"),Out:__webpack_require__("./math/easing/quartic/Out.js"),InOut:__webpack_require__("./math/easing/quartic/InOut.js")};}),"./math/easing/quintic/In.js":(function(module,exports){var In=function(v)
    {return v*v*v*v*v;};module.exports=In;}),"./math/easing/quintic/InOut.js":(function(module,exports){var InOut=function(v)
    {if((v*=2)<1)
    {return 0.5*v*v*v*v*v;}
    else
    {return 0.5*((v-=2)*v*v*v*v+2);}};module.exports=InOut;}),"./math/easing/quintic/Out.js":(function(module,exports){var Out=function(v)
    {return--v*v*v*v*v+1;};module.exports=Out;}),"./math/easing/quintic/index.js":(function(module,exports,__webpack_require__){module.exports={In:__webpack_require__("./math/easing/quintic/In.js"),Out:__webpack_require__("./math/easing/quintic/Out.js"),InOut:__webpack_require__("./math/easing/quintic/InOut.js")};}),"./math/easing/sine/In.js":(function(module,exports){var In=function(v)
    {if(v===0)
    {return 0;}
    else if(v===1)
    {return 1;}
    else
    {return 1-Math.cos(v*Math.PI / 2);}};module.exports=In;}),"./math/easing/sine/InOut.js":(function(module,exports){var InOut=function(v)
    {if(v===0)
    {return 0;}
    else if(v===1)
    {return 1;}
    else
    {return 0.5*(1-Math.cos(Math.PI*v));}};module.exports=InOut;}),"./math/easing/sine/Out.js":(function(module,exports){var Out=function(v)
    {if(v===0)
    {return 0;}
    else if(v===1)
    {return 1;}
    else
    {return Math.sin(v*Math.PI / 2);}};module.exports=Out;}),"./math/easing/sine/index.js":(function(module,exports,__webpack_require__){module.exports={In:__webpack_require__("./math/easing/sine/In.js"),Out:__webpack_require__("./math/easing/sine/Out.js"),InOut:__webpack_require__("./math/easing/sine/InOut.js")};}),"./math/easing/stepped/Stepped.js":(function(module,exports){var Stepped=function(v,steps)
    {if(steps===undefined){steps=1;}
        if(v<=0)
        {return 0;}
        else if(v>=1)
        {return 1;}
        else
        {return(((steps*v)|0)+1)*(1 / steps);}};module.exports=Stepped;}),"./math/easing/stepped/index.js":(function(module,exports,__webpack_require__){module.exports=__webpack_require__("./math/easing/stepped/Stepped.js");}),"./math/fuzzy/Ceil.js":(function(module,exports){var Ceil=function(value,epsilon)
    {if(epsilon===undefined){epsilon=0.0001;}
        return Math.ceil(value-epsilon);};module.exports=Ceil;}),"./math/fuzzy/Equal.js":(function(module,exports){var Equal=function(a,b,epsilon)
    {if(epsilon===undefined){epsilon=0.0001;}
        return Math.abs(a-b)<epsilon;};module.exports=Equal;}),"./math/fuzzy/Floor.js":(function(module,exports){var Floor=function(value,epsilon)
    {if(epsilon===undefined){epsilon=0.0001;}
        return Math.floor(value+epsilon);};module.exports=Floor;}),"./math/fuzzy/GreaterThan.js":(function(module,exports){var GreaterThan=function(a,b,epsilon)
    {if(epsilon===undefined){epsilon=0.0001;}
        return a>b-epsilon;};module.exports=GreaterThan;}),"./math/fuzzy/LessThan.js":(function(module,exports){var LessThan=function(a,b,epsilon)
    {if(epsilon===undefined){epsilon=0.0001;}
        return a<b+epsilon;};module.exports=LessThan;}),"./math/fuzzy/index.js":(function(module,exports,__webpack_require__){module.exports={Ceil:__webpack_require__("./math/fuzzy/Ceil.js"),Equal:__webpack_require__("./math/fuzzy/Equal.js"),Floor:__webpack_require__("./math/fuzzy/Floor.js"),GreaterThan:__webpack_require__("./math/fuzzy/GreaterThan.js"),LessThan:__webpack_require__("./math/fuzzy/LessThan.js")};}),"./math/index.js":(function(module,exports,__webpack_require__){var CONST=__webpack_require__("./math/const.js");var Extend=__webpack_require__("./utils/object/Extend.js");var PhaserMath={Angle:__webpack_require__("./math/angle/index.js"),Distance:__webpack_require__("./math/distance/index.js"),Easing:__webpack_require__("./math/easing/index.js"),Fuzzy:__webpack_require__("./math/fuzzy/index.js"),Interpolation:__webpack_require__("./math/interpolation/index.js"),Pow2:__webpack_require__("./math/pow2/index.js"),Snap:__webpack_require__("./math/snap/index.js"),RandomDataGenerator:__webpack_require__("./math/random-data-generator/RandomDataGenerator.js"),Average:__webpack_require__("./math/Average.js"),Bernstein:__webpack_require__("./math/Bernstein.js"),Between:__webpack_require__("./math/Between.js"),CatmullRom:__webpack_require__("./math/CatmullRom.js"),CeilTo:__webpack_require__("./math/CeilTo.js"),Clamp:__webpack_require__("./math/Clamp.js"),DegToRad:__webpack_require__("./math/DegToRad.js"),Difference:__webpack_require__("./math/Difference.js"),Factorial:__webpack_require__("./math/Factorial.js"),FloatBetween:__webpack_require__("./math/FloatBetween.js"),FloorTo:__webpack_require__("./math/FloorTo.js"),FromPercent:__webpack_require__("./math/FromPercent.js"),GetSpeed:__webpack_require__("./math/GetSpeed.js"),IsEven:__webpack_require__("./math/IsEven.js"),IsEvenStrict:__webpack_require__("./math/IsEvenStrict.js"),Linear:__webpack_require__("./math/Linear.js"),MaxAdd:__webpack_require__("./math/MaxAdd.js"),MinSub:__webpack_require__("./math/MinSub.js"),Percent:__webpack_require__("./math/Percent.js"),RadToDeg:__webpack_require__("./math/RadToDeg.js"),RandomXY:__webpack_require__("./math/RandomXY.js"),RandomXYZ:__webpack_require__("./math/RandomXYZ.js"),RandomXYZW:__webpack_require__("./math/RandomXYZW.js"),Rotate:__webpack_require__("./math/Rotate.js"),RotateAround:__webpack_require__("./math/RotateAround.js"),RotateAroundDistance:__webpack_require__("./math/RotateAroundDistance.js"),RoundAwayFromZero:__webpack_require__("./math/RoundAwayFromZero.js"),RoundTo:__webpack_require__("./math/RoundTo.js"),SinCosTableGenerator:__webpack_require__("./math/SinCosTableGenerator.js"),SmootherStep:__webpack_require__("./math/SmootherStep.js"),SmoothStep:__webpack_require__("./math/SmoothStep.js"),TransformXY:__webpack_require__("./math/TransformXY.js"),Within:__webpack_require__("./math/Within.js"),Wrap:__webpack_require__("./math/Wrap.js"),Vector2:__webpack_require__("./math/Vector2.js"),Vector3:__webpack_require__("./math/Vector3.js"),Vector4:__webpack_require__("./math/Vector4.js"),Matrix3:__webpack_require__("./math/Matrix3.js"),Matrix4:__webpack_require__("./math/Matrix4.js"),Quaternion:__webpack_require__("./math/Quaternion.js"),RotateVec3:__webpack_require__("./math/RotateVec3.js")};PhaserMath=Extend(false,PhaserMath,CONST);module.exports=PhaserMath;}),"./math/interpolation/BezierInterpolation.js":(function(module,exports,__webpack_require__){var Bernstein=__webpack_require__("./math/Bernstein.js");var BezierInterpolation=function(v,k)
    {var b=0;var n=v.length-1;for(var i=0;i<=n;i++)
    {b+=Math.pow(1-k,n-i)*Math.pow(k,i)*v[i]*Bernstein(n,i);}
        return b;};module.exports=BezierInterpolation;}),"./math/interpolation/CatmullRomInterpolation.js":(function(module,exports,__webpack_require__){var CatmullRom=__webpack_require__("./math/CatmullRom.js");var CatmullRomInterpolation=function(v,k)
    {var m=v.length-1;var f=m*k;var i=Math.floor(f);if(v[0]===v[m])
    {if(k<0)
    {i=Math.floor(f=m*(1+k));}
        return CatmullRom(f-i,v[(i-1+m)%m],v[i],v[(i+1)%m],v[(i+2)%m]);}
    else
    {if(k<0)
    {return v[0]-(CatmullRom(-f,v[0],v[0],v[1],v[1])-v[0]);}
        if(k>1)
        {return v[m]-(CatmullRom(f-m,v[m],v[m],v[m-1],v[m-1])-v[m]);}
        return CatmullRom(f-i,v[i?i-1:0],v[i],v[m<i+1?m:i+1],v[m<i+2?m:i+2]);}};module.exports=CatmullRomInterpolation;}),"./math/interpolation/CubicBezierInterpolation.js":(function(module,exports){function P0(t,p)
    {var k=1-t;return k*k*k*p;}
        function P1(t,p)
        {var k=1-t;return 3*k*k*t*p;}
        function P2(t,p)
        {return 3*(1-t)*t*t*p;}
        function P3(t,p)
        {return t*t*t*p;}
        var CubicBezierInterpolation=function(t,p0,p1,p2,p3)
        {return P0(t,p0)+P1(t,p1)+P2(t,p2)+P3(t,p3);};module.exports=CubicBezierInterpolation;}),"./math/interpolation/LinearInterpolation.js":(function(module,exports,__webpack_require__){var Linear=__webpack_require__("./math/Linear.js");var LinearInterpolation=function(v,k)
    {var m=v.length-1;var f=m*k;var i=Math.floor(f);if(k<0)
    {return Linear(v[0],v[1],f);}
    else if(k>1)
    {return Linear(v[m],v[m-1],m-f);}
    else
    {return Linear(v[i],v[(i+1>m)?m:i+1],f-i);}};module.exports=LinearInterpolation;}),"./math/interpolation/QuadraticBezierInterpolation.js":(function(module,exports){function P0(t,p)
    {var k=1-t;return k*k*p;}
        function P1(t,p)
        {return 2*(1-t)*t*p;}
        function P2(t,p)
        {return t*t*p;}
        var QuadraticBezierInterpolation=function(t,p0,p1,p2)
        {return P0(t,p0)+P1(t,p1)+P2(t,p2);};module.exports=QuadraticBezierInterpolation;}),"./math/interpolation/SmoothStepInterpolation.js":(function(module,exports,__webpack_require__){var SmoothStep=__webpack_require__("./math/SmoothStep.js");var SmoothStepInterpolation=function(t,min,max)
    {return min+(max-min)*SmoothStep(t,0,1);};module.exports=SmoothStepInterpolation;}),"./math/interpolation/SmootherStepInterpolation.js":(function(module,exports,__webpack_require__){var SmootherStep=__webpack_require__("./math/SmootherStep.js");var SmootherStepInterpolation=function(t,min,max)
    {return min+(max-min)*SmootherStep(t,0,1);};module.exports=SmootherStepInterpolation;}),"./math/interpolation/index.js":(function(module,exports,__webpack_require__){module.exports={Bezier:__webpack_require__("./math/interpolation/BezierInterpolation.js"),CatmullRom:__webpack_require__("./math/interpolation/CatmullRomInterpolation.js"),CubicBezier:__webpack_require__("./math/interpolation/CubicBezierInterpolation.js"),Linear:__webpack_require__("./math/interpolation/LinearInterpolation.js"),QuadraticBezier:__webpack_require__("./math/interpolation/QuadraticBezierInterpolation.js"),SmoothStep:__webpack_require__("./math/interpolation/SmoothStepInterpolation.js"),SmootherStep:__webpack_require__("./math/interpolation/SmootherStepInterpolation.js")};}),"./math/pow2/GetPowerOfTwo.js":(function(module,exports){var GetPowerOfTwo=function(value)
    {var index=Math.log(value)/ 0.6931471805599453;return(1<<Math.ceil(index));};module.exports=GetPowerOfTwo;}),"./math/pow2/IsSizePowerOfTwo.js":(function(module,exports){var IsSizePowerOfTwo=function(width,height)
    {return(width>0&&(width&(width-1))===0&&height>0&&(height&(height-1))===0);};module.exports=IsSizePowerOfTwo;}),"./math/pow2/IsValuePowerOfTwo.js":(function(module,exports){var IsValuePowerOfTwo=function(value)
    {return(value>0&&(value&(value-1))===0);};module.exports=IsValuePowerOfTwo;}),"./math/pow2/index.js":(function(module,exports,__webpack_require__){module.exports={GetNext:__webpack_require__("./math/pow2/GetPowerOfTwo.js"),IsSize:__webpack_require__("./math/pow2/IsSizePowerOfTwo.js"),IsValue:__webpack_require__("./math/pow2/IsValuePowerOfTwo.js")};}),"./math/random-data-generator/RandomDataGenerator.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var RandomDataGenerator=new Class({initialize:function RandomDataGenerator(seeds)
        {if(seeds===undefined){seeds=[(Date.now()*Math.random()).toString()];}
            this.c=1;this.s0=0;this.s1=0;this.s2=0;this.n=0;this.signs=[-1,1];if(seeds)
        {this.init(seeds);}},rnd:function()
        {var t=2091639*this.s0+this.c*2.3283064365386963e-10;this.c=t|0;this.s0=this.s1;this.s1=this.s2;this.s2=t-this.c;return this.s2;},hash:function(data)
        {var h;var n=this.n;data=data.toString();for(var i=0;i<data.length;i++)
        {n+=data.charCodeAt(i);h=0.02519603282416938*n;n=h>>>0;h-=n;h*=n;n=h>>>0;h-=n;n+=h*0x100000000;}
            this.n=n;return(n>>>0)*2.3283064365386963e-10;},init:function(seeds)
        {if(typeof seeds==='string')
        {this.state(seeds);}
        else
        {this.sow(seeds);}},sow:function(seeds)
        {this.n=0xefc8249d;this.s0=this.hash(' ');this.s1=this.hash(' ');this.s2=this.hash(' ');this.c=1;if(!seeds)
        {return;}
            for(var i=0;i<seeds.length&&(seeds[i]!=null);i++)
            {var seed=seeds[i];this.s0-=this.hash(seed);this.s0+=~~(this.s0<0);this.s1-=this.hash(seed);this.s1+=~~(this.s1<0);this.s2-=this.hash(seed);this.s2+=~~(this.s2<0);}},integer:function()
        {return this.rnd()*0x100000000;},frac:function()
        {return this.rnd()+(this.rnd()*0x200000|0)*1.1102230246251565e-16;},real:function()
        {return this.integer()+this.frac();},integerInRange:function(min,max)
        {return Math.floor(this.realInRange(0,max-min+1)+min);},between:function(min,max)
        {return Math.floor(this.realInRange(0,max-min+1)+min);},realInRange:function(min,max)
        {return this.frac()*(max-min)+min;},normal:function()
        {return 1-(2*this.frac());},uuid:function()
        {var a='';var b='';for(b=a='';a++<36;b+=~a%5|a*3&4?(a^15?8^this.frac()*(a^20?16:4):4).toString(16):'-')
        {}
            return b;},pick:function(array)
        {return array[this.integerInRange(0,array.length-1)];},sign:function()
        {return this.pick(this.signs);},weightedPick:function(array)
        {return array[~~(Math.pow(this.frac(),2)*(array.length-1)+0.5)];},timestamp:function(min,max)
        {return this.realInRange(min||946684800000,max||1577862000000);},angle:function()
        {return this.integerInRange(-180,180);},rotation:function()
        {return this.realInRange(-3.1415926,3.1415926);},state:function(state)
        {if(typeof state==='string'&&state.match(/^!rnd/))
        {state=state.split(',');this.c=parseFloat(state[1]);this.s0=parseFloat(state[2]);this.s1=parseFloat(state[3]);this.s2=parseFloat(state[4]);}
            return['!rnd',this.c,this.s0,this.s1,this.s2].join(',');},shuffle:function(array)
        {var len=array.length-1;for(var i=len;i>0;i--)
        {var randomIndex=Math.floor(this.frac()*(i+1));var itemAtIndex=array[randomIndex];array[randomIndex]=array[i];array[i]=itemAtIndex;}
            return array;}});module.exports=RandomDataGenerator;}),"./math/snap/SnapCeil.js":(function(module,exports){var SnapCeil=function(value,gap,start,divide)
    {if(start===undefined){start=0;}
        if(gap===0)
        {return value;}
        value-=start;value=gap*Math.ceil(value / gap);return(divide)?(start+value)/ gap:start+value;};module.exports=SnapCeil;}),"./math/snap/SnapFloor.js":(function(module,exports){var SnapFloor=function(value,gap,start,divide)
    {if(start===undefined){start=0;}
        if(gap===0)
        {return value;}
        value-=start;value=gap*Math.floor(value / gap);return(divide)?(start+value)/ gap:start+value;};module.exports=SnapFloor;}),"./math/snap/SnapTo.js":(function(module,exports){var SnapTo=function(value,gap,start,divide)
    {if(start===undefined){start=0;}
        if(gap===0)
        {return value;}
        value-=start;value=gap*Math.round(value / gap);return(divide)?(start+value)/ gap:start+value;};module.exports=SnapTo;}),"./math/snap/index.js":(function(module,exports,__webpack_require__){module.exports={Ceil:__webpack_require__("./math/snap/SnapCeil.js"),Floor:__webpack_require__("./math/snap/SnapFloor.js"),To:__webpack_require__("./math/snap/SnapTo.js")};}),"./phaser.js":(function(module,exports,__webpack_require__){(function(global){__webpack_require__("./polyfills/index.js");var CONST=__webpack_require__("./const.js");var Extend=__webpack_require__("./utils/object/Extend.js");var Phaser={Actions:__webpack_require__("./actions/index.js"),Animation:__webpack_require__("./animations/index.js"),Cache:__webpack_require__("./cache/index.js"),Cameras:__webpack_require__("./cameras/index.js"),Class:__webpack_require__("./utils/Class.js"),Create:__webpack_require__("./create/index.js"),Curves:__webpack_require__("./curves/index.js"),Data:__webpack_require__("./data/index.js"),Display:__webpack_require__("./display/index.js"),DOM:__webpack_require__("./dom/index.js"),Events:__webpack_require__("./events/index.js"),Game:__webpack_require__("./boot/Game.js"),GameObjects:__webpack_require__("./gameobjects/index.js"),Geom:__webpack_require__("./geom/index.js"),Input:__webpack_require__("./input/index.js"),Loader:__webpack_require__("./loader/index.js"),Math:__webpack_require__("./math/index.js"),Physics:__webpack_require__("./physics/index.js"),Plugins:__webpack_require__("./plugins/index.js"),Renderer:__webpack_require__("./renderer/index.js"),Scene:__webpack_require__("./scene/Scene.js"),Scenes:__webpack_require__("./scene/index.js"),Sound:__webpack_require__("./sound/index.js"),Structs:__webpack_require__("./structs/index.js"),Textures:__webpack_require__("./textures/index.js"),Tilemaps:__webpack_require__("./tilemaps/index.js"),Time:__webpack_require__("./time/index.js"),Tweens:__webpack_require__("./tweens/index.js"),Utils:__webpack_require__("./utils/index.js")};if(false)
    {}
        if(false)
        {}
        Phaser=Extend(false,Phaser,CONST);module.exports=Phaser;global.Phaser=Phaser;}.call(this,__webpack_require__("../node_modules/webpack/buildin/global.js")))}),"./physics/arcade/ArcadeImage.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Components=__webpack_require__("./physics/arcade/components/index.js");var Image=__webpack_require__("./gameobjects/image/Image.js");var ArcadeImage=new Class({Extends:Image,Mixins:[Components.Acceleration,Components.Angular,Components.Bounce,Components.Debug,Components.Drag,Components.Enable,Components.Friction,Components.Gravity,Components.Immovable,Components.Mass,Components.Size,Components.Velocity],initialize:function ArcadeImage(scene,x,y,texture,frame)
        {Image.call(this,scene,x,y,texture,frame);this.body=null;}});module.exports=ArcadeImage;}),"./physics/arcade/ArcadePhysics.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var DegToRad=__webpack_require__("./math/DegToRad.js");var DistanceBetween=__webpack_require__("./math/distance/DistanceBetween.js");var DistanceSquared=__webpack_require__("./math/distance/DistanceSquared.js");var Factory=__webpack_require__("./physics/arcade/Factory.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var Merge=__webpack_require__("./utils/object/Merge.js");var PluginCache=__webpack_require__("./plugins/PluginCache.js");var Vector2=__webpack_require__("./math/Vector2.js");var World=__webpack_require__("./physics/arcade/World.js");var ArcadePhysics=new Class({initialize:function ArcadePhysics(scene)
        {this.scene=scene;this.systems=scene.sys;this.config=this.getConfig();this.world;this.add;scene.sys.events.once('boot',this.boot,this);scene.sys.events.on('start',this.start,this);},boot:function()
        {this.world=new World(this.scene,this.config);this.add=new Factory(this.world);this.systems.events.once('destroy',this.destroy,this);},start:function()
        {if(!this.world)
        {this.world=new World(this.scene,this.config);this.add=new Factory(this.world);}
            var eventEmitter=this.systems.events;eventEmitter.on('update',this.world.update,this.world);eventEmitter.on('postupdate',this.world.postUpdate,this.world);eventEmitter.once('shutdown',this.shutdown,this);},getConfig:function()
        {var gameConfig=this.systems.game.config.physics;var sceneConfig=this.systems.settings.physics;var config=Merge(GetFastValue(sceneConfig,'arcade',{}),GetFastValue(gameConfig,'arcade',{}));return config;},overlap:function(object1,object2,overlapCallback,processCallback,callbackContext)
        {if(overlapCallback===undefined){overlapCallback=null;}
            if(processCallback===undefined){processCallback=null;}
            if(callbackContext===undefined){callbackContext=overlapCallback;}
            return this.world.collideObjects(object1,object2,overlapCallback,processCallback,callbackContext,true);},collide:function(object1,object2,collideCallback,processCallback,callbackContext)
        {if(collideCallback===undefined){collideCallback=null;}
            if(processCallback===undefined){processCallback=null;}
            if(callbackContext===undefined){callbackContext=collideCallback;}
            return this.world.collideObjects(object1,object2,collideCallback,processCallback,callbackContext,false);},pause:function()
        {return this.world.pause();},resume:function()
        {return this.world.resume();},accelerateTo:function(gameObject,x,y,speed,xSpeedMax,ySpeedMax)
        {if(speed===undefined){speed=60;}
            var angle=Math.atan2(y-gameObject.y,x-gameObject.x);gameObject.body.acceleration.setToPolar(angle,speed);if(xSpeedMax!==undefined&&ySpeedMax!==undefined)
        {gameObject.body.maxVelocity.set(xSpeedMax,ySpeedMax);}
            return angle;},accelerateToObject:function(gameObject,destination,speed,xSpeedMax,ySpeedMax)
        {return this.accelerateTo(gameObject,destination.x,destination.y,speed,xSpeedMax,ySpeedMax);},closest:function(source)
        {var bodies=this.world.tree.all();var min=Number.MAX_VALUE;var closest=null;var x=source.x;var y=source.y;for(var i=bodies.length-1;i>=0;i--)
        {var target=bodies[i];var distance=DistanceSquared(x,y,target.x,target.y);if(distance<min)
        {closest=target;min=distance;}}
            return closest;},furthest:function(source)
        {var bodies=this.world.tree.all();var max=-1;var farthest=null;var x=source.x;var y=source.y;for(var i=bodies.length-1;i>=0;i--)
        {var target=bodies[i];var distance=DistanceSquared(x,y,target.x,target.y);if(distance>max)
        {farthest=target;max=distance;}}
            return farthest;},moveTo:function(gameObject,x,y,speed,maxTime)
        {if(speed===undefined){speed=60;}
            if(maxTime===undefined){maxTime=0;}
            var angle=Math.atan2(y-gameObject.y,x-gameObject.x);if(maxTime>0)
        {speed=DistanceBetween(gameObject.x,gameObject.y,x,y)/(maxTime / 1000);}
            gameObject.body.velocity.setToPolar(angle,speed);return angle;},moveToObject:function(gameObject,destination,speed,maxTime)
        {return this.moveTo(gameObject,destination.x,destination.y,speed,maxTime);},velocityFromAngle:function(angle,speed,vec2)
        {if(speed===undefined){speed=60;}
            if(vec2===undefined){vec2=new Vector2();}
            return vec2.setToPolar(DegToRad(angle),speed);},velocityFromRotation:function(rotation,speed,vec2)
        {if(speed===undefined){speed=60;}
            if(vec2===undefined){vec2=new Vector2();}
            return vec2.setToPolar(rotation,speed);},shutdown:function()
        {if(!this.world)
        {return;}
            var eventEmitter=this.systems.events;eventEmitter.off('update',this.world.update,this.world);eventEmitter.off('postupdate',this.world.postUpdate,this.world);eventEmitter.off('shutdown',this.shutdown,this);this.add.destroy();this.world.destroy();this.add=null;this.world=null;},destroy:function()
        {this.shutdown();this.scene.sys.events.off('start',this.start,this);this.scene=null;this.systems=null;}});PluginCache.register('ArcadePhysics',ArcadePhysics,'arcadePhysics');module.exports=ArcadePhysics;}),"./physics/arcade/ArcadeSprite.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Components=__webpack_require__("./physics/arcade/components/index.js");var Sprite=__webpack_require__("./gameobjects/sprite/Sprite.js");var ArcadeSprite=new Class({Extends:Sprite,Mixins:[Components.Acceleration,Components.Angular,Components.Bounce,Components.Debug,Components.Drag,Components.Enable,Components.Friction,Components.Gravity,Components.Immovable,Components.Mass,Components.Size,Components.Velocity],initialize:function ArcadeSprite(scene,x,y,texture,frame)
        {Sprite.call(this,scene,x,y,texture,frame);this.body=null;}});module.exports=ArcadeSprite;}),"./physics/arcade/Body.js":(function(module,exports,__webpack_require__){var CircleContains=__webpack_require__("./geom/circle/Contains.js");var Class=__webpack_require__("./utils/Class.js");var CONST=__webpack_require__("./physics/arcade/const.js");var RadToDeg=__webpack_require__("./math/RadToDeg.js");var Rectangle=__webpack_require__("./geom/rectangle/Rectangle.js");var RectangleContains=__webpack_require__("./geom/rectangle/Contains.js");var Vector2=__webpack_require__("./math/Vector2.js");var Body=new Class({initialize:function Body(world,gameObject)
        {var width=(gameObject.width)?gameObject.width:64;var height=(gameObject.height)?gameObject.height:64;this.world=world;this.gameObject=gameObject;this.transform={x:gameObject.x,y:gameObject.y,rotation:gameObject.angle,scaleX:gameObject.scaleX,scaleY:gameObject.scaleY,displayOriginX:gameObject.displayOriginX,displayOriginY:gameObject.displayOriginY};this.debugShowBody=world.defaults.debugShowBody;this.debugShowVelocity=world.defaults.debugShowVelocity;this.debugBodyColor=world.defaults.bodyDebugColor;this.enable=true;this.isCircle=false;this.radius=0;this.offset=new Vector2();this.position=new Vector2(gameObject.x,gameObject.y);this.prev=new Vector2(gameObject.x,gameObject.y);this.allowRotation=true;this.rotation=gameObject.angle;this.preRotation=gameObject.angle;this.width=width;this.height=height;this.sourceWidth=width;this.sourceHeight=height;if(gameObject.frame)
        {this.sourceWidth=gameObject.frame.realWidth;this.sourceHeight=gameObject.frame.realHeight;}
            this.halfWidth=Math.abs(width / 2);this.halfHeight=Math.abs(height / 2);this.center=new Vector2(gameObject.x+this.halfWidth,gameObject.y+this.halfHeight);this.velocity=new Vector2();this.newVelocity=new Vector2();this.deltaMax=new Vector2();this.acceleration=new Vector2();this.allowDrag=true;this.drag=new Vector2();this.allowGravity=true;this.gravity=new Vector2();this.bounce=new Vector2();this.worldBounce=null;this.onWorldBounds=false;this.onCollide=false;this.onOverlap=false;this.maxVelocity=new Vector2(10000,10000);this.friction=new Vector2(1,0);this.useDamping=false;this.angularVelocity=0;this.angularAcceleration=0;this.angularDrag=0;this.maxAngular=1000;this.mass=1;this.angle=0;this.speed=0;this.facing=CONST.FACING_NONE;this.immovable=false;this.moves=true;this.customSeparateX=false;this.customSeparateY=false;this.overlapX=0;this.overlapY=0;this.overlapR=0;this.embedded=false;this.collideWorldBounds=false;this.checkCollision={none:false,up:true,down:true,left:true,right:true};this.touching={none:true,up:false,down:false,left:false,right:false};this.wasTouching={none:true,up:false,down:false,left:false,right:false};this.blocked={none:true,up:false,down:false,left:false,right:false};this.syncBounds=false;this.isMoving=false;this.stopVelocityOnCollide=true;this.physicsType=CONST.DYNAMIC_BODY;this._reset=true;this._sx=gameObject.scaleX;this._sy=gameObject.scaleY;this._dx=0;this._dy=0;this._bounds=new Rectangle();},updateBounds:function()
        {var sprite=this.gameObject;var transform=this.transform;if(sprite.parentContainer)
        {var matrix=sprite.getWorldTransformMatrix(this.world._tempMatrix,this.world._tempMatrix2);transform.x=matrix.tx;transform.y=matrix.ty;transform.rotation=RadToDeg(matrix.rotation);transform.scaleX=matrix.scaleX;transform.scaleY=matrix.scaleY;transform.displayOriginX=sprite.displayOriginX;transform.displayOriginY=sprite.displayOriginY;}
        else
        {transform.x=sprite.x;transform.y=sprite.y;transform.rotation=sprite.angle;transform.scaleX=sprite.scaleX;transform.scaleY=sprite.scaleY;transform.displayOriginX=sprite.displayOriginX;transform.displayOriginY=sprite.displayOriginY;}
            var recalc=false;if(this.syncBounds)
        {var b=sprite.getBounds(this._bounds);this.width=b.width;this.height=b.height;recalc=true;}
        else
        {var asx=Math.abs(transform.scaleX);var asy=Math.abs(transform.scaleY);if(this._sx!==asx||this._sy!==asy)
        {this.width=this.sourceWidth*asx;this.height=this.sourceHeight*asy;this._sx=asx;this._sy=asy;recalc=true;}}
            if(recalc)
            {this.halfWidth=Math.floor(this.width / 2);this.halfHeight=Math.floor(this.height / 2);this.updateCenter();}},updateCenter:function()
        {this.center.set(this.position.x+this.halfWidth,this.position.y+this.halfHeight);},update:function(delta)
        {this.wasTouching.none=this.touching.none;this.wasTouching.up=this.touching.up;this.wasTouching.down=this.touching.down;this.wasTouching.left=this.touching.left;this.wasTouching.right=this.touching.right;this.touching.none=true;this.touching.up=false;this.touching.down=false;this.touching.left=false;this.touching.right=false;this.blocked.none=true;this.blocked.up=false;this.blocked.down=false;this.blocked.left=false;this.blocked.right=false;this.overlapR=0;this.overlapX=0;this.overlapY=0;this.embedded=false;this.updateBounds();var sprite=this.transform;this.position.x=sprite.x+sprite.scaleX*(this.offset.x-sprite.displayOriginX);this.position.y=sprite.y+sprite.scaleY*(this.offset.y-sprite.displayOriginY);this.updateCenter();this.rotation=sprite.rotation;this.preRotation=this.rotation;if(this._reset)
        {this.prev.x=this.position.x;this.prev.y=this.position.y;}
            if(this.moves)
            {this.world.updateMotion(this,delta);var vx=this.velocity.x;var vy=this.velocity.y;this.newVelocity.set(vx*delta,vy*delta);this.position.add(this.newVelocity);this.updateCenter();this.angle=Math.atan2(vy,vx);this.speed=Math.sqrt(vx*vx+vy*vy);if(this.collideWorldBounds&&this.checkWorldBounds()&&this.onWorldBounds)
            {this.world.emit('worldbounds',this,this.blocked.up,this.blocked.down,this.blocked.left,this.blocked.right);}}
            this._dx=this.position.x-this.prev.x;this._dy=this.position.y-this.prev.y;},postUpdate:function()
        {this._dx=this.position.x-this.prev.x;this._dy=this.position.y-this.prev.y;if(this.moves)
        {if(this.deltaMax.x!==0&&this._dx!==0)
        {if(this._dx<0&&this._dx<-this.deltaMax.x)
        {this._dx=-this.deltaMax.x;}
        else if(this._dx>0&&this._dx>this.deltaMax.x)
        {this._dx=this.deltaMax.x;}}
            if(this.deltaMax.y!==0&&this._dy!==0)
            {if(this._dy<0&&this._dy<-this.deltaMax.y)
            {this._dy=-this.deltaMax.y;}
            else if(this._dy>0&&this._dy>this.deltaMax.y)
            {this._dy=this.deltaMax.y;}}
            this.gameObject.x+=this._dx;this.gameObject.y+=this._dy;this._reset=true;}
            if(this._dx<0)
            {this.facing=CONST.FACING_LEFT;}
            else if(this._dx>0)
            {this.facing=CONST.FACING_RIGHT;}
            if(this._dy<0)
            {this.facing=CONST.FACING_UP;}
            else if(this._dy>0)
            {this.facing=CONST.FACING_DOWN;}
            if(this.allowRotation)
            {this.gameObject.angle+=this.deltaZ();}
            this.prev.x=this.position.x;this.prev.y=this.position.y;},checkWorldBounds:function()
        {var pos=this.position;var bounds=this.world.bounds;var check=this.world.checkCollision;var bx=(this.worldBounce)?-this.worldBounce.x:-this.bounce.x;var by=(this.worldBounce)?-this.worldBounce.y:-this.bounce.y;if(pos.x<bounds.x&&check.left)
        {pos.x=bounds.x;this.velocity.x*=bx;this.blocked.left=true;this.blocked.none=false;}
        else if(this.right>bounds.right&&check.right)
        {pos.x=bounds.right-this.width;this.velocity.x*=bx;this.blocked.right=true;this.blocked.none=false;}
            if(pos.y<bounds.y&&check.up)
            {pos.y=bounds.y;this.velocity.y*=by;this.blocked.up=true;this.blocked.none=false;}
            else if(this.bottom>bounds.bottom&&check.down)
            {pos.y=bounds.bottom-this.height;this.velocity.y*=by;this.blocked.down=true;this.blocked.none=false;}
            return!this.blocked.none;},setOffset:function(x,y)
        {if(y===undefined){y=x;}
            this.offset.set(x,y);return this;},setSize:function(width,height,center)
        {if(center===undefined){center=true;}
            var gameObject=this.gameObject;if(!width&&gameObject.frame)
        {width=gameObject.frame.realWidth;}
            if(!height&&gameObject.frame)
            {height=gameObject.frame.realHeight;}
            this.sourceWidth=width;this.sourceHeight=height;this.width=this.sourceWidth*this._sx;this.height=this.sourceHeight*this._sy;this.halfWidth=Math.floor(this.width / 2);this.halfHeight=Math.floor(this.height / 2);this.updateCenter();if(center&&gameObject.getCenter)
        {var ox=gameObject.displayWidth / 2;var oy=gameObject.displayHeight / 2;this.offset.set(ox-this.halfWidth,oy-this.halfHeight);}
            this.isCircle=false;this.radius=0;return this;},setCircle:function(radius,offsetX,offsetY)
        {if(offsetX===undefined){offsetX=this.offset.x;}
            if(offsetY===undefined){offsetY=this.offset.y;}
            if(radius>0)
            {this.isCircle=true;this.radius=radius;this.sourceWidth=radius*2;this.sourceHeight=radius*2;this.width=this.sourceWidth*this._sx;this.height=this.sourceHeight*this._sy;this.halfWidth=Math.floor(this.width / 2);this.halfHeight=Math.floor(this.height / 2);this.offset.set(offsetX,offsetY);this.updateCenter();}
            else
            {this.isCircle=false;}
            return this;},reset:function(x,y)
        {this.stop();var gameObject=this.gameObject;gameObject.setPosition(x,y);gameObject.getTopLeft(this.position);this.prev.copy(this.position);this.rotation=gameObject.angle;this.preRotation=gameObject.angle;this.updateBounds();this.updateCenter();},stop:function()
        {this.velocity.set(0);this.acceleration.set(0);this.speed=0;this.angularVelocity=0;this.angularAcceleration=0;return this;},getBounds:function(obj)
        {obj.x=this.x;obj.y=this.y;obj.right=this.right;obj.bottom=this.bottom;return obj;},hitTest:function(x,y)
        {return(this.isCircle)?CircleContains(this,x,y):RectangleContains(this,x,y);},onFloor:function()
        {return this.blocked.down;},onCeiling:function()
        {return this.blocked.up;},onWall:function()
        {return(this.blocked.left||this.blocked.right);},deltaAbsX:function()
        {return(this._dx>0)?this._dx:-this._dx;},deltaAbsY:function()
        {return(this._dy>0)?this._dy:-this._dy;},deltaX:function()
        {return this._dx;},deltaY:function()
        {return this._dy;},deltaZ:function()
        {return this.rotation-this.preRotation;},destroy:function()
        {this.enable=false;if(this.world)
        {this.world.pendingDestroy.set(this);}},drawDebug:function(graphic)
        {var pos=this.position;var x=pos.x+this.halfWidth;var y=pos.y+this.halfHeight;if(this.debugShowBody)
        {graphic.lineStyle(graphic.defaultStrokeWidth,this.debugBodyColor);if(this.isCircle)
        {graphic.strokeCircle(x,y,this.width / 2);}
        else
        {graphic.strokeRect(pos.x,pos.y,this.width,this.height);}}
            if(this.debugShowVelocity)
            {graphic.lineStyle(graphic.defaultStrokeWidth,this.world.defaults.velocityDebugColor,1);graphic.lineBetween(x,y,x+this.velocity.x / 2,y+this.velocity.y / 2);}},willDrawDebug:function()
        {return(this.debugShowBody||this.debugShowVelocity);},setCollideWorldBounds:function(value)
        {if(value===undefined){value=true;}
            this.collideWorldBounds=value;return this;},setVelocity:function(x,y)
        {this.velocity.set(x,y);this.speed=Math.sqrt(x*x+y*y);return this;},setVelocityX:function(value)
        {this.velocity.x=value;var vx=value;var vy=this.velocity.y;this.speed=Math.sqrt(vx*vx+vy*vy);return this;},setVelocityY:function(value)
        {this.velocity.y=value;var vx=this.velocity.x;var vy=value;this.speed=Math.sqrt(vx*vx+vy*vy);return this;},setMaxVelocity:function(x,y)
        {this.maxVelocity.set(x,y);return this;},setBounce:function(x,y)
        {this.bounce.set(x,y);return this;},setBounceX:function(value)
        {this.bounce.x=value;return this;},setBounceY:function(value)
        {this.bounce.y=value;return this;},setAcceleration:function(x,y)
        {this.acceleration.set(x,y);return this;},setAccelerationX:function(value)
        {this.acceleration.x=value;return this;},setAccelerationY:function(value)
        {this.acceleration.y=value;return this;},setAllowDrag:function(value)
        {if(value===undefined){value=true;}
            this.allowDrag=value;return this;},setAllowGravity:function(value)
        {if(value===undefined){value=true;}
            this.allowGravity=value;return this;},setAllowRotation:function(value)
        {if(value===undefined){value=true;}
            this.allowRotation=value;return this;},setDrag:function(x,y)
        {this.drag.set(x,y);return this;},setDragX:function(value)
        {this.drag.x=value;return this;},setDragY:function(value)
        {this.drag.y=value;return this;},setGravity:function(x,y)
        {this.gravity.set(x,y);return this;},setGravityX:function(value)
        {this.gravity.x=value;return this;},setGravityY:function(value)
        {this.gravity.y=value;return this;},setFriction:function(x,y)
        {this.friction.set(x,y);return this;},setFrictionX:function(value)
        {this.friction.x=value;return this;},setFrictionY:function(value)
        {this.friction.y=value;return this;},setAngularVelocity:function(value)
        {this.angularVelocity=value;return this;},setAngularAcceleration:function(value)
        {this.angularAcceleration=value;return this;},setAngularDrag:function(value)
        {this.angularDrag=value;return this;},setMass:function(value)
        {this.mass=value;return this;},setImmovable:function(value)
        {if(value===undefined){value=true;}
            this.immovable=value;return this;},setEnable:function(value)
        {if(value===undefined){value=true;}
            this.enable=value;return this;},x:{get:function()
            {return this.position.x;},set:function(value)
            {this.position.x=value;}},y:{get:function()
            {return this.position.y;},set:function(value)
            {this.position.y=value;}},left:{get:function()
            {return this.position.x;}},right:{get:function()
            {return this.position.x+this.width;}},top:{get:function()
            {return this.position.y;}},bottom:{get:function()
            {return this.position.y+this.height;}}});module.exports=Body;}),"./physics/arcade/Collider.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Collider=new Class({initialize:function Collider(world,overlapOnly,object1,object2,collideCallback,processCallback,callbackContext)
        {this.world=world;this.name='';this.active=true;this.overlapOnly=overlapOnly;this.object1=object1;this.object2=object2;this.collideCallback=collideCallback;this.processCallback=processCallback;this.callbackContext=callbackContext;},setName:function(name)
        {this.name=name;return this;},update:function()
        {this.world.collideObjects(this.object1,this.object2,this.collideCallback,this.processCallback,this.callbackContext,this.overlapOnly);},destroy:function()
        {this.world.removeCollider(this);this.active=false;this.world=null;this.object1=null;this.object2=null;this.collideCallback=null;this.processCallback=null;this.callbackContext=null;}});module.exports=Collider;}),"./physics/arcade/Factory.js":(function(module,exports,__webpack_require__){var ArcadeImage=__webpack_require__("./physics/arcade/ArcadeImage.js");var ArcadeSprite=__webpack_require__("./physics/arcade/ArcadeSprite.js");var Class=__webpack_require__("./utils/Class.js");var CONST=__webpack_require__("./physics/arcade/const.js");var PhysicsGroup=__webpack_require__("./physics/arcade/PhysicsGroup.js");var StaticPhysicsGroup=__webpack_require__("./physics/arcade/StaticPhysicsGroup.js");var Factory=new Class({initialize:function Factory(world)
        {this.world=world;this.scene=world.scene;this.sys=world.scene.sys;},collider:function(object1,object2,collideCallback,processCallback,callbackContext)
        {return this.world.addCollider(object1,object2,collideCallback,processCallback,callbackContext);},overlap:function(object1,object2,collideCallback,processCallback,callbackContext)
        {return this.world.addOverlap(object1,object2,collideCallback,processCallback,callbackContext);},existing:function(gameObject,isStatic)
        {var type=(isStatic)?CONST.STATIC_BODY:CONST.DYNAMIC_BODY;this.world.enableBody(gameObject,type);return gameObject;},staticImage:function(x,y,key,frame)
        {var image=new ArcadeImage(this.scene,x,y,key,frame);this.sys.displayList.add(image);this.world.enableBody(image,CONST.STATIC_BODY);return image;},image:function(x,y,key,frame)
        {var image=new ArcadeImage(this.scene,x,y,key,frame);this.sys.displayList.add(image);this.world.enableBody(image,CONST.DYNAMIC_BODY);return image;},staticSprite:function(x,y,key,frame)
        {var sprite=new ArcadeSprite(this.scene,x,y,key,frame);this.sys.displayList.add(sprite);this.sys.updateList.add(sprite);this.world.enableBody(sprite,CONST.STATIC_BODY);return sprite;},sprite:function(x,y,key,frame)
        {var sprite=new ArcadeSprite(this.scene,x,y,key,frame);this.sys.displayList.add(sprite);this.sys.updateList.add(sprite);this.world.enableBody(sprite,CONST.DYNAMIC_BODY);return sprite;},staticGroup:function(children,config)
        {return this.sys.updateList.add(new StaticPhysicsGroup(this.world,this.world.scene,children,config));},group:function(children,config)
        {return this.sys.updateList.add(new PhysicsGroup(this.world,this.world.scene,children,config));},destroy:function()
        {this.world=null;this.scene=null;this.sys=null;}});module.exports=Factory;}),"./physics/arcade/GetOverlapX.js":(function(module,exports,__webpack_require__){var CONST=__webpack_require__("./physics/arcade/const.js");var GetOverlapX=function(body1,body2,overlapOnly,bias)
    {var overlap=0;var maxOverlap=body1.deltaAbsX()+body2.deltaAbsX()+bias;if(body1._dx===0&&body2._dx===0)
    {body1.embedded=true;body2.embedded=true;}
    else if(body1._dx>body2._dx)
    {overlap=body1.right-body2.x;if((overlap>maxOverlap&&!overlapOnly)||body1.checkCollision.right===false||body2.checkCollision.left===false)
    {overlap=0;}
    else
    {body1.touching.none=false;body1.touching.right=true;body2.touching.none=false;body2.touching.left=true;if(body2.physicsType===CONST.STATIC_BODY)
    {body1.blocked.none=false;body1.blocked.right=true;}
        if(body1.physicsType===CONST.STATIC_BODY)
        {body2.blocked.none=false;body2.blocked.left=true;}}}
    else if(body1._dx<body2._dx)
    {overlap=body1.x-body2.width-body2.x;if((-overlap>maxOverlap&&!overlapOnly)||body1.checkCollision.left===false||body2.checkCollision.right===false)
    {overlap=0;}
    else
    {body1.touching.none=false;body1.touching.left=true;body2.touching.none=false;body2.touching.right=true;if(body2.physicsType===CONST.STATIC_BODY)
    {body1.blocked.none=false;body1.blocked.left=true;}
        if(body1.physicsType===CONST.STATIC_BODY)
        {body2.blocked.none=false;body2.blocked.right=true;}}}
        body1.overlapX=overlap;body2.overlapX=overlap;return overlap;};module.exports=GetOverlapX;}),"./physics/arcade/GetOverlapY.js":(function(module,exports,__webpack_require__){var CONST=__webpack_require__("./physics/arcade/const.js");var GetOverlapY=function(body1,body2,overlapOnly,bias)
    {var overlap=0;var maxOverlap=body1.deltaAbsY()+body2.deltaAbsY()+bias;if(body1._dy===0&&body2._dy===0)
    {body1.embedded=true;body2.embedded=true;}
    else if(body1._dy>body2._dy)
    {overlap=body1.bottom-body2.y;if((overlap>maxOverlap&&!overlapOnly)||body1.checkCollision.down===false||body2.checkCollision.up===false)
    {overlap=0;}
    else
    {body1.touching.none=false;body1.touching.down=true;body2.touching.none=false;body2.touching.up=true;if(body2.physicsType===CONST.STATIC_BODY)
    {body1.blocked.none=false;body1.blocked.down=true;}
        if(body1.physicsType===CONST.STATIC_BODY)
        {body2.blocked.none=false;body2.blocked.up=true;}}}
    else if(body1._dy<body2._dy)
    {overlap=body1.y-body2.bottom;if((-overlap>maxOverlap&&!overlapOnly)||body1.checkCollision.up===false||body2.checkCollision.down===false)
    {overlap=0;}
    else
    {body1.touching.none=false;body1.touching.up=true;body2.touching.none=false;body2.touching.down=true;if(body2.physicsType===CONST.STATIC_BODY)
    {body1.blocked.none=false;body1.blocked.up=true;}
        if(body1.physicsType===CONST.STATIC_BODY)
        {body2.blocked.none=false;body2.blocked.down=true;}}}
        body1.overlapY=overlap;body2.overlapY=overlap;return overlap;};module.exports=GetOverlapY;}),"./physics/arcade/PhysicsGroup.js":(function(module,exports,__webpack_require__){var ArcadeSprite=__webpack_require__("./physics/arcade/ArcadeSprite.js");var Class=__webpack_require__("./utils/Class.js");var CONST=__webpack_require__("./physics/arcade/const.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var Group=__webpack_require__("./gameobjects/group/Group.js");var IsPlainObject=__webpack_require__("./utils/object/IsPlainObject.js");var PhysicsGroup=new Class({Extends:Group,initialize:function PhysicsGroup(world,scene,children,config)
        {if(!children&&!config)
        {config={createCallback:this.createCallbackHandler,removeCallback:this.removeCallbackHandler};}
        else if(IsPlainObject(children))
        {config=children;children=null;config.createCallback=this.createCallbackHandler;config.removeCallback=this.removeCallbackHandler;}
        else if(Array.isArray(children)&&IsPlainObject(children[0]))
        {config=children;children=null;config.forEach(function(singleConfig)
        {singleConfig.createCallback=this.createCallbackHandler;singleConfig.removeCallback=this.removeCallbackHandler;});}
        else
        {config={createCallback:this.createCallbackHandler,removeCallback:this.removeCallbackHandler};}
            this.world=world;config.classType=GetFastValue(config,'classType',ArcadeSprite);this.physicsType=CONST.DYNAMIC_BODY;this.defaults={setCollideWorldBounds:GetFastValue(config,'collideWorldBounds',false),setAccelerationX:GetFastValue(config,'accelerationX',0),setAccelerationY:GetFastValue(config,'accelerationY',0),setAllowDrag:GetFastValue(config,'allowDrag',true),setAllowGravity:GetFastValue(config,'allowGravity',true),setAllowRotation:GetFastValue(config,'allowRotation',true),setBounceX:GetFastValue(config,'bounceX',0),setBounceY:GetFastValue(config,'bounceY',0),setDragX:GetFastValue(config,'dragX',0),setDragY:GetFastValue(config,'dragY',0),setEnable:GetFastValue(config,'enable',true),setGravityX:GetFastValue(config,'gravityX',0),setGravityY:GetFastValue(config,'gravityY',0),setFrictionX:GetFastValue(config,'frictionX',0),setFrictionY:GetFastValue(config,'frictionY',0),setVelocityX:GetFastValue(config,'velocityX',0),setVelocityY:GetFastValue(config,'velocityY',0),setAngularVelocity:GetFastValue(config,'angularVelocity',0),setAngularAcceleration:GetFastValue(config,'angularAcceleration',0),setAngularDrag:GetFastValue(config,'angularDrag',0),setMass:GetFastValue(config,'mass',1),setImmovable:GetFastValue(config,'immovable',false)};Group.call(this,scene,children,config);},createCallbackHandler:function(child)
        {if(!child.body)
        {this.world.enableBody(child,CONST.DYNAMIC_BODY);}
            var body=child.body;for(var key in this.defaults)
        {body[key](this.defaults[key]);}},removeCallbackHandler:function(child)
        {if(child.body)
        {this.world.disableBody(child);}},setVelocity:function(x,y,step)
        {if(step===undefined){step=0;}
            var items=this.getChildren();for(var i=0;i<items.length;i++)
        {items[i].body.velocity.set(x+(i*step),y+(i*step));}
            return this;},setVelocityX:function(value,step)
        {if(step===undefined){step=0;}
            var items=this.getChildren();for(var i=0;i<items.length;i++)
        {items[i].body.velocity.x=value+(i*step);}
            return this;},setVelocityY:function(value,step)
        {if(step===undefined){step=0;}
            var items=this.getChildren();for(var i=0;i<items.length;i++)
        {items[i].body.velocity.y=value+(i*step);}
            return this;}});module.exports=PhysicsGroup;}),"./physics/arcade/SeparateX.js":(function(module,exports,__webpack_require__){var GetOverlapX=__webpack_require__("./physics/arcade/GetOverlapX.js");var SeparateX=function(body1,body2,overlapOnly,bias)
    {var overlap=GetOverlapX(body1,body2,overlapOnly,bias);if(overlapOnly||overlap===0||(body1.immovable&&body2.immovable)||body1.customSeparateX||body2.customSeparateX)
    {return(overlap!==0)||(body1.embedded&&body2.embedded);}
        var v1=body1.velocity.x;var v2=body2.velocity.x;if(!body1.immovable&&!body2.immovable)
    {overlap*=0.5;body1.x-=overlap;body2.x+=overlap;var nv1=Math.sqrt((v2*v2*body2.mass)/ body1.mass)*((v2>0)?1:-1);var nv2=Math.sqrt((v1*v1*body1.mass)/ body2.mass)*((v1>0)?1:-1);var avg=(nv1+nv2)*0.5;nv1-=avg;nv2-=avg;body1.velocity.x=avg+nv1*body1.bounce.x;body2.velocity.x=avg+nv2*body2.bounce.x;}
    else if(!body1.immovable)
    {body1.x-=overlap;body1.velocity.x=v2-v1*body1.bounce.x;if(body2.moves)
    {body1.y+=(body2.y-body2.prev.y)*body2.friction.y;}}
    else
    {body2.x+=overlap;body2.velocity.x=v1-v2*body2.bounce.x;if(body1.moves)
    {body2.y+=(body1.y-body1.prev.y)*body1.friction.y;}}
        return true;};module.exports=SeparateX;}),"./physics/arcade/SeparateY.js":(function(module,exports,__webpack_require__){var GetOverlapY=__webpack_require__("./physics/arcade/GetOverlapY.js");var SeparateY=function(body1,body2,overlapOnly,bias)
    {var overlap=GetOverlapY(body1,body2,overlapOnly,bias);if(overlapOnly||overlap===0||(body1.immovable&&body2.immovable)||body1.customSeparateY||body2.customSeparateY)
    {return(overlap!==0)||(body1.embedded&&body2.embedded);}
        var v1=body1.velocity.y;var v2=body2.velocity.y;if(!body1.immovable&&!body2.immovable)
    {overlap*=0.5;body1.y-=overlap;body2.y+=overlap;var nv1=Math.sqrt((v2*v2*body2.mass)/ body1.mass)*((v2>0)?1:-1);var nv2=Math.sqrt((v1*v1*body1.mass)/ body2.mass)*((v1>0)?1:-1);var avg=(nv1+nv2)*0.5;nv1-=avg;nv2-=avg;body1.velocity.y=avg+nv1*body1.bounce.y;body2.velocity.y=avg+nv2*body2.bounce.y;}
    else if(!body1.immovable)
    {body1.y-=overlap;body1.velocity.y=v2-v1*body1.bounce.y;if(body2.moves)
    {body1.x+=(body2.x-body2.prev.x)*body2.friction.x;}}
    else
    {body2.y+=overlap;body2.velocity.y=v1-v2*body2.bounce.y;if(body1.moves)
    {body2.x+=(body1.x-body1.prev.x)*body1.friction.x;}}
        return true;};module.exports=SeparateY;}),"./physics/arcade/StaticBody.js":(function(module,exports,__webpack_require__){var CircleContains=__webpack_require__("./geom/circle/Contains.js");var Class=__webpack_require__("./utils/Class.js");var CONST=__webpack_require__("./physics/arcade/const.js");var RectangleContains=__webpack_require__("./geom/rectangle/Contains.js");var Vector2=__webpack_require__("./math/Vector2.js");var StaticBody=new Class({initialize:function StaticBody(world,gameObject)
        {var width=(gameObject.width)?gameObject.width:64;var height=(gameObject.height)?gameObject.height:64;this.world=world;this.gameObject=gameObject;this.debugShowBody=world.defaults.debugShowStaticBody;this.debugBodyColor=world.defaults.staticBodyDebugColor;this.enable=true;this.isCircle=false;this.radius=0;this.offset=new Vector2();this.position=new Vector2(gameObject.x-gameObject.displayOriginX,gameObject.y-gameObject.displayOriginY);this.width=width;this.height=height;this.halfWidth=Math.abs(this.width / 2);this.halfHeight=Math.abs(this.height / 2);this.center=new Vector2(gameObject.x+this.halfWidth,gameObject.y+this.halfHeight);this.velocity=Vector2.ZERO;this.allowGravity=false;this.gravity=Vector2.ZERO;this.bounce=Vector2.ZERO;this.onWorldBounds=false;this.onCollide=false;this.onOverlap=false;this.mass=1;this.immovable=true;this.customSeparateX=false;this.customSeparateY=false;this.overlapX=0;this.overlapY=0;this.overlapR=0;this.embedded=false;this.collideWorldBounds=false;this.checkCollision={none:false,up:true,down:true,left:true,right:true};this.touching={none:true,up:false,down:false,left:false,right:false};this.wasTouching={none:true,up:false,down:false,left:false,right:false};this.blocked={none:true,up:false,down:false,left:false,right:false};this.physicsType=CONST.STATIC_BODY;this._dx=0;this._dy=0;},setGameObject:function(gameObject,update)
        {if(gameObject&&gameObject!==this.gameObject)
        {this.gameObject.body=null;gameObject.body=this;this.gameObject=gameObject;}
            if(update)
            {this.updateFromGameObject();}
            return this;},updateFromGameObject:function()
        {this.world.staticTree.remove(this);var gameObject=this.gameObject;gameObject.getTopLeft(this.position);this.width=gameObject.displayWidth;this.height=gameObject.displayHeight;this.halfWidth=Math.abs(this.width / 2);this.halfHeight=Math.abs(this.height / 2);this.center.set(this.position.x+this.halfWidth,this.position.y+this.halfHeight);this.world.staticTree.insert(this);return this;},setOffset:function(x,y)
        {if(y===undefined){y=x;}
            this.world.staticTree.remove(this);this.position.x-=this.offset.x;this.position.y-=this.offset.y;this.offset.set(x,y);this.position.x+=this.offset.x;this.position.y+=this.offset.y;this.updateCenter();this.world.staticTree.insert(this);return this;},setSize:function(width,height,offsetX,offsetY)
        {if(offsetX===undefined){offsetX=this.offset.x;}
            if(offsetY===undefined){offsetY=this.offset.y;}
            var gameObject=this.gameObject;if(!width&&gameObject.frame)
        {width=gameObject.frame.realWidth;}
            if(!height&&gameObject.frame)
            {height=gameObject.frame.realHeight;}
            this.world.staticTree.remove(this);this.width=width;this.height=height;this.halfWidth=Math.floor(width / 2);this.halfHeight=Math.floor(height / 2);this.offset.set(offsetX,offsetY);this.updateCenter();this.isCircle=false;this.radius=0;this.world.staticTree.insert(this);return this;},setCircle:function(radius,offsetX,offsetY)
        {if(offsetX===undefined){offsetX=this.offset.x;}
            if(offsetY===undefined){offsetY=this.offset.y;}
            if(radius>0)
            {this.world.staticTree.remove(this);this.isCircle=true;this.radius=radius;this.width=radius*2;this.height=radius*2;this.halfWidth=Math.floor(this.width / 2);this.halfHeight=Math.floor(this.height / 2);this.offset.set(offsetX,offsetY);this.updateCenter();this.world.staticTree.insert(this);}
            else
            {this.isCircle=false;}
            return this;},updateCenter:function()
        {this.center.set(this.position.x+this.halfWidth,this.position.y+this.halfHeight);},reset:function(x,y)
        {var gameObject=this.gameObject;if(x===undefined){x=gameObject.x;}
            if(y===undefined){y=gameObject.y;}
            this.world.staticTree.remove(this);gameObject.setPosition(x,y);gameObject.getTopLeft(this.position);this.updateCenter();this.world.staticTree.insert(this);},stop:function()
        {return this;},getBounds:function(obj)
        {obj.x=this.x;obj.y=this.y;obj.right=this.right;obj.bottom=this.bottom;return obj;},hitTest:function(x,y)
        {return(this.isCircle)?CircleContains(this,x,y):RectangleContains(this,x,y);},postUpdate:function()
        {},deltaAbsX:function()
        {return 0;},deltaAbsY:function()
        {return 0;},deltaX:function()
        {return 0;},deltaY:function()
        {return 0;},deltaZ:function()
        {return 0;},destroy:function()
        {this.enable=false;this.world.pendingDestroy.set(this);},drawDebug:function(graphic)
        {var pos=this.position;var x=pos.x+this.halfWidth;var y=pos.y+this.halfHeight;if(this.debugShowBody)
        {graphic.lineStyle(1,this.debugBodyColor,1);if(this.isCircle)
        {graphic.strokeCircle(x,y,this.width / 2);}
        else
        {graphic.strokeRect(pos.x,pos.y,this.width,this.height);}}},willDrawDebug:function()
        {return this.debugShowBody;},setMass:function(value)
        {if(value<=0)
        {value=0.1;}
            this.mass=value;return this;},x:{get:function()
            {return this.position.x;},set:function(value)
            {this.world.staticTree.remove(this);this.position.x=value;this.world.staticTree.insert(this);}},y:{get:function()
            {return this.position.y;},set:function(value)
            {this.world.staticTree.remove(this);this.position.y=value;this.world.staticTree.insert(this);}},left:{get:function()
            {return this.position.x;}},right:{get:function()
            {return this.position.x+this.width;}},top:{get:function()
            {return this.position.y;}},bottom:{get:function()
            {return this.position.y+this.height;}}});module.exports=StaticBody;}),"./physics/arcade/StaticPhysicsGroup.js":(function(module,exports,__webpack_require__){var ArcadeSprite=__webpack_require__("./physics/arcade/ArcadeSprite.js");var Class=__webpack_require__("./utils/Class.js");var CONST=__webpack_require__("./physics/arcade/const.js");var Group=__webpack_require__("./gameobjects/group/Group.js");var IsPlainObject=__webpack_require__("./utils/object/IsPlainObject.js");var StaticPhysicsGroup=new Class({Extends:Group,initialize:function StaticPhysicsGroup(world,scene,children,config)
        {if(!children&&!config)
        {config={createCallback:this.createCallbackHandler,removeCallback:this.removeCallbackHandler,createMultipleCallback:this.createMultipleCallbackHandler,classType:ArcadeSprite};}
        else if(IsPlainObject(children))
        {config=children;children=null;config.createCallback=this.createCallbackHandler;config.removeCallback=this.removeCallbackHandler;config.createMultipleCallback=this.createMultipleCallbackHandler;config.classType=ArcadeSprite;}
        else if(Array.isArray(children)&&IsPlainObject(children[0]))
        {config=children;children=null;config.forEach(function(singleConfig)
        {singleConfig.createCallback=this.createCallbackHandler;singleConfig.removeCallback=this.removeCallbackHandler;singleConfig.createMultipleCallback=this.createMultipleCallbackHandler;singleConfig.classType=ArcadeSprite;});}
            this.world=world;this.physicsType=CONST.STATIC_BODY;Group.call(this,scene,children,config);},createCallbackHandler:function(child)
        {if(!child.body)
        {this.world.enableBody(child,CONST.STATIC_BODY);}},removeCallbackHandler:function(child)
        {if(child.body)
        {this.world.disableBody(child);}},createMultipleCallbackHandler:function()
        {this.refresh();},refresh:function()
        {var children=this.children.entries;for(var i=0;i<children.length;i++)
        {children[i].body.reset();}
            return this;}});module.exports=StaticPhysicsGroup;}),"./physics/arcade/World.js":(function(module,exports,__webpack_require__){var Body=__webpack_require__("./physics/arcade/Body.js");var Clamp=__webpack_require__("./math/Clamp.js");var Class=__webpack_require__("./utils/Class.js");var Collider=__webpack_require__("./physics/arcade/Collider.js");var CONST=__webpack_require__("./physics/arcade/const.js");var DistanceBetween=__webpack_require__("./math/distance/DistanceBetween.js");var EventEmitter=__webpack_require__("../node_modules/eventemitter3/index.js");var FuzzyEqual=__webpack_require__("./math/fuzzy/Equal.js");var FuzzyGreaterThan=__webpack_require__("./math/fuzzy/GreaterThan.js");var FuzzyLessThan=__webpack_require__("./math/fuzzy/LessThan.js");var GetOverlapX=__webpack_require__("./physics/arcade/GetOverlapX.js");var GetOverlapY=__webpack_require__("./physics/arcade/GetOverlapY.js");var GetValue=__webpack_require__("./utils/object/GetValue.js");var ProcessQueue=__webpack_require__("./structs/ProcessQueue.js");var ProcessTileCallbacks=__webpack_require__("./physics/arcade/tilemap/ProcessTileCallbacks.js");var Rectangle=__webpack_require__("./geom/rectangle/Rectangle.js");var RTree=__webpack_require__("./structs/RTree.js");var SeparateTile=__webpack_require__("./physics/arcade/tilemap/SeparateTile.js");var SeparateX=__webpack_require__("./physics/arcade/SeparateX.js");var SeparateY=__webpack_require__("./physics/arcade/SeparateY.js");var Set=__webpack_require__("./structs/Set.js");var StaticBody=__webpack_require__("./physics/arcade/StaticBody.js");var TileIntersectsBody=__webpack_require__("./physics/arcade/tilemap/TileIntersectsBody.js");var TransformMatrix=__webpack_require__("./gameobjects/components/TransformMatrix.js");var Vector2=__webpack_require__("./math/Vector2.js");var Wrap=__webpack_require__("./math/Wrap.js");var World=new Class({Extends:EventEmitter,initialize:function World(scene,config)
        {EventEmitter.call(this);this.scene=scene;this.bodies=new Set();this.staticBodies=new Set();this.pendingDestroy=new Set();this.colliders=new ProcessQueue();this.gravity=new Vector2(GetValue(config,'gravity.x',0),GetValue(config,'gravity.y',0));this.bounds=new Rectangle(GetValue(config,'x',0),GetValue(config,'y',0),GetValue(config,'width',scene.sys.scale.width),GetValue(config,'height',scene.sys.scale.height));this.checkCollision={up:GetValue(config,'checkCollision.up',true),down:GetValue(config,'checkCollision.down',true),left:GetValue(config,'checkCollision.left',true),right:GetValue(config,'checkCollision.right',true)};this.fps=GetValue(config,'fps',60);this._elapsed=0;this._frameTime=1 / this.fps;this._frameTimeMS=1000*this._frameTime;this.stepsLastFrame=0;this.timeScale=GetValue(config,'timeScale',1);this.OVERLAP_BIAS=GetValue(config,'overlapBias',4);this.TILE_BIAS=GetValue(config,'tileBias',16);this.forceX=GetValue(config,'forceX',false);this.isPaused=GetValue(config,'isPaused',false);this._total=0;this.drawDebug=GetValue(config,'debug',false);this.debugGraphic;this.defaults={debugShowBody:GetValue(config,'debugShowBody',true),debugShowStaticBody:GetValue(config,'debugShowStaticBody',true),debugShowVelocity:GetValue(config,'debugShowVelocity',true),bodyDebugColor:GetValue(config,'debugBodyColor',0xff00ff),staticBodyDebugColor:GetValue(config,'debugStaticBodyColor',0x0000ff),velocityDebugColor:GetValue(config,'debugVelocityColor',0x00ff00)};this.maxEntries=GetValue(config,'maxEntries',16);this.useTree=GetValue(config,'useTree',true);this.tree=new RTree(this.maxEntries);this.staticTree=new RTree(this.maxEntries);this.treeMinMax={minX:0,minY:0,maxX:0,maxY:0};this._tempMatrix=new TransformMatrix();this._tempMatrix2=new TransformMatrix();if(this.drawDebug)
        {this.createDebugGraphic();}},enable:function(object,bodyType)
        {if(bodyType===undefined){bodyType=CONST.DYNAMIC_BODY;}
            if(!Array.isArray(object))
            {object=[object];}
            for(var i=0;i<object.length;i++)
            {var entry=object[i];if(entry.isParent)
            {var children=entry.getChildren();for(var c=0;c<children.length;c++)
            {var child=children[c];if(child.isParent)
            {this.enable(child,bodyType);}
            else
            {this.enableBody(child,bodyType);}}}
            else
            {this.enableBody(entry,bodyType);}}},enableBody:function(object,bodyType)
        {if(bodyType===undefined){bodyType=CONST.DYNAMIC_BODY;}
            if(!object.body)
            {if(bodyType===CONST.DYNAMIC_BODY)
            {object.body=new Body(this,object);}
            else if(bodyType===CONST.STATIC_BODY)
            {object.body=new StaticBody(this,object);}}
            this.add(object.body);return object;},add:function(body)
        {if(body.physicsType===CONST.DYNAMIC_BODY)
        {this.bodies.set(body);}
        else if(body.physicsType===CONST.STATIC_BODY)
        {this.staticBodies.set(body);this.staticTree.insert(body);}
            body.enable=true;return body;},disable:function(object)
        {if(!Array.isArray(object))
        {object=[object];}
            for(var i=0;i<object.length;i++)
            {var entry=object[i];if(entry.isParent)
            {var children=entry.getChildren();for(var c=0;c<children.length;c++)
            {var child=children[c];if(child.isParent)
            {this.disable(child);}
            else
            {this.disableBody(child.body);}}}
            else
            {this.disableBody(entry.body);}}},disableBody:function(body)
        {this.remove(body);body.enable=false;},remove:function(body)
        {if(body.physicsType===CONST.DYNAMIC_BODY)
        {this.tree.remove(body);this.bodies.delete(body);}
        else if(body.physicsType===CONST.STATIC_BODY)
        {this.staticBodies.delete(body);this.staticTree.remove(body);}},createDebugGraphic:function()
        {var graphic=this.scene.sys.add.graphics({x:0,y:0});graphic.setDepth(Number.MAX_VALUE);this.debugGraphic=graphic;this.drawDebug=true;return graphic;},setBounds:function(x,y,width,height,checkLeft,checkRight,checkUp,checkDown)
        {this.bounds.setTo(x,y,width,height);if(checkLeft!==undefined)
        {this.setBoundsCollision(checkLeft,checkRight,checkUp,checkDown);}
            return this;},setBoundsCollision:function(left,right,up,down)
        {if(left===undefined){left=true;}
            if(right===undefined){right=true;}
            if(up===undefined){up=true;}
            if(down===undefined){down=true;}
            this.checkCollision.left=left;this.checkCollision.right=right;this.checkCollision.up=up;this.checkCollision.down=down;return this;},pause:function()
        {this.isPaused=true;this.emit('pause');return this;},resume:function()
        {this.isPaused=false;this.emit('resume');return this;},addCollider:function(object1,object2,collideCallback,processCallback,callbackContext)
        {if(collideCallback===undefined){collideCallback=null;}
            if(processCallback===undefined){processCallback=null;}
            if(callbackContext===undefined){callbackContext=collideCallback;}
            var collider=new Collider(this,false,object1,object2,collideCallback,processCallback,callbackContext);this.colliders.add(collider);return collider;},addOverlap:function(object1,object2,collideCallback,processCallback,callbackContext)
        {if(collideCallback===undefined){collideCallback=null;}
            if(processCallback===undefined){processCallback=null;}
            if(callbackContext===undefined){callbackContext=collideCallback;}
            var collider=new Collider(this,true,object1,object2,collideCallback,processCallback,callbackContext);this.colliders.add(collider);return collider;},removeCollider:function(collider)
        {this.colliders.remove(collider);return this;},setFPS:function(framerate)
        {this.fps=framerate;this._frameTime=1 / this.fps;this._frameTimeMS=1000*this._frameTime;return this;},update:function(time,delta)
        {if(this.isPaused||this.bodies.size===0)
        {return;}
            var stepsThisFrame=0;var fixedDelta=this._frameTime;var msPerFrame=this._frameTimeMS*this.timeScale;this._elapsed+=delta;while(this._elapsed>=msPerFrame)
        {this._elapsed-=msPerFrame;stepsThisFrame++;this.step(fixedDelta);}
            this.stepsLastFrame=stepsThisFrame;},step:function(delta)
        {var i;var body;var bodies=this.bodies.entries;var len=bodies.length;for(i=0;i<len;i++)
        {body=bodies[i];if(body.enable)
        {body.update(delta);}}
            if(this.useTree)
            {this.tree.clear();this.tree.load(bodies);}
            var colliders=this.colliders.update();for(i=0;i<colliders.length;i++)
        {var collider=colliders[i];if(collider.active)
        {collider.update();}}
            len=bodies.length;for(i=0;i<len;i++)
        {body=bodies[i];if(body.enable)
        {body.postUpdate();}}},postUpdate:function()
        {var i;var body;var dynamic=this.bodies;var staticBodies=this.staticBodies;var pending=this.pendingDestroy;var bodies=dynamic.entries;var len=bodies.length;if(this.drawDebug)
        {var graphics=this.debugGraphic;graphics.clear();for(i=0;i<len;i++)
        {body=bodies[i];if(body.willDrawDebug())
        {body.drawDebug(graphics);}}
            bodies=staticBodies.entries;len=bodies.length;for(i=0;i<len;i++)
        {body=bodies[i];if(body.willDrawDebug())
        {body.drawDebug(graphics);}}}
            if(pending.size>0)
            {var dynamicTree=this.tree;var staticTree=this.staticTree;bodies=pending.entries;len=bodies.length;for(i=0;i<len;i++)
            {body=bodies[i];if(body.physicsType===CONST.DYNAMIC_BODY)
            {dynamicTree.remove(body);dynamic.delete(body);}
            else if(body.physicsType===CONST.STATIC_BODY)
            {staticTree.remove(body);staticBodies.delete(body);}
                body.world=undefined;body.gameObject=undefined;}
                pending.clear();}},updateMotion:function(body,delta)
        {if(body.allowRotation)
        {this.computeAngularVelocity(body,delta);}
            this.computeVelocity(body,delta);},computeAngularVelocity:function(body,delta)
        {var velocity=body.angularVelocity;var acceleration=body.angularAcceleration;var drag=body.angularDrag;var max=body.maxAngular;if(acceleration)
        {velocity+=acceleration*delta;}
        else if(body.allowDrag&&drag)
        {drag*=delta;if(FuzzyGreaterThan(velocity-drag,0,0.1))
        {velocity-=drag;}
        else if(FuzzyLessThan(velocity+drag,0,0.1))
        {velocity+=drag;}
        else
        {velocity=0;}}
            velocity=Clamp(velocity,-max,max);var velocityDelta=velocity-body.angularVelocity;body.angularVelocity+=velocityDelta;body.rotation+=(body.angularVelocity*delta);},computeVelocity:function(body,delta)
        {var velocityX=body.velocity.x;var accelerationX=body.acceleration.x;var dragX=body.drag.x;var maxX=body.maxVelocity.x;var velocityY=body.velocity.y;var accelerationY=body.acceleration.y;var dragY=body.drag.y;var maxY=body.maxVelocity.y;var speed=body.speed;var allowDrag=body.allowDrag;var useDamping=body.useDamping;if(body.allowGravity)
        {velocityX+=(this.gravity.x+body.gravity.x)*delta;velocityY+=(this.gravity.y+body.gravity.y)*delta;}
            if(accelerationX)
            {velocityX+=accelerationX*delta;}
            else if(allowDrag&&dragX)
            {if(useDamping)
            {velocityX*=dragX;if(FuzzyEqual(speed,0,0.001))
            {velocityX=0;}}
            else
            {dragX*=delta;if(FuzzyGreaterThan(velocityX-dragX,0,0.01))
            {velocityX-=dragX;}
            else if(FuzzyLessThan(velocityX+dragX,0,0.01))
            {velocityX+=dragX;}
            else
            {velocityX=0;}}}
            if(accelerationY)
            {velocityY+=accelerationY*delta;}
            else if(allowDrag&&dragY)
            {if(useDamping)
            {velocityY*=dragY;if(FuzzyEqual(speed,0,0.001))
            {velocityY=0;}}
            else
            {dragY*=delta;if(FuzzyGreaterThan(velocityY-dragY,0,0.01))
            {velocityY-=dragY;}
            else if(FuzzyLessThan(velocityY+dragY,0,0.01))
            {velocityY+=dragY;}
            else
            {velocityY=0;}}}
            velocityX=Clamp(velocityX,-maxX,maxX);velocityY=Clamp(velocityY,-maxY,maxY);body.velocity.set(velocityX,velocityY);},separate:function(body1,body2,processCallback,callbackContext,overlapOnly)
        {if(!body1.enable||!body2.enable||body1.checkCollision.none||body2.checkCollision.none||!this.intersects(body1,body2))
        {return false;}
            if(processCallback&&processCallback.call(callbackContext,body1.gameObject,body2.gameObject)===false)
            {return false;}
            if(body1.isCircle&&body2.isCircle)
            {return this.separateCircle(body1,body2,overlapOnly);}
            if(body1.isCircle!==body2.isCircle)
            {var bodyRect=(body1.isCircle)?body2:body1;var bodyCircle=(body1.isCircle)?body1:body2;var rect={x:bodyRect.x,y:bodyRect.y,right:bodyRect.right,bottom:bodyRect.bottom};var circle=bodyCircle.center;if(circle.y<rect.y||circle.y>rect.bottom)
            {if(circle.x<rect.x||circle.x>rect.right)
            {return this.separateCircle(body1,body2,overlapOnly);}}}
            var resultX=false;var resultY=false;if(this.forceX||Math.abs(this.gravity.y+body1.gravity.y)<Math.abs(this.gravity.x+body1.gravity.x))
        {resultX=SeparateX(body1,body2,overlapOnly,this.OVERLAP_BIAS);if(this.intersects(body1,body2))
        {resultY=SeparateY(body1,body2,overlapOnly,this.OVERLAP_BIAS);}}
        else
        {resultY=SeparateY(body1,body2,overlapOnly,this.OVERLAP_BIAS);if(this.intersects(body1,body2))
        {resultX=SeparateX(body1,body2,overlapOnly,this.OVERLAP_BIAS);}}
            var result=(resultX||resultY);if(result)
        {if(overlapOnly&&(body1.onOverlap||body2.onOverlap))
        {this.emit('overlap',body1.gameObject,body2.gameObject,body1,body2);}
        else
        {body1.postUpdate();body2.postUpdate();if(body1.onCollide||body2.onCollide)
        {this.emit('collide',body1.gameObject,body2.gameObject,body1,body2);}}}
            return result;},separateCircle:function(body1,body2,overlapOnly,bias)
        {GetOverlapX(body1,body2,false,bias);GetOverlapY(body1,body2,false,bias);var dx=body2.center.x-body1.center.x;var dy=body2.center.y-body1.center.y;var angleCollision=Math.atan2(dy,dx);var overlap=0;if(body1.isCircle!==body2.isCircle)
        {var rect={x:(body2.isCircle)?body1.position.x:body2.position.x,y:(body2.isCircle)?body1.position.y:body2.position.y,right:(body2.isCircle)?body1.right:body2.right,bottom:(body2.isCircle)?body1.bottom:body2.bottom};var circle={x:(body1.isCircle)?body1.center.x:body2.center.x,y:(body1.isCircle)?body1.center.y:body2.center.y,radius:(body1.isCircle)?body1.halfWidth:body2.halfWidth};if(circle.y<rect.y)
        {if(circle.x<rect.x)
        {overlap=DistanceBetween(circle.x,circle.y,rect.x,rect.y)-circle.radius;}
        else if(circle.x>rect.right)
        {overlap=DistanceBetween(circle.x,circle.y,rect.right,rect.y)-circle.radius;}}
        else if(circle.y>rect.bottom)
        {if(circle.x<rect.x)
        {overlap=DistanceBetween(circle.x,circle.y,rect.x,rect.bottom)-circle.radius;}
        else if(circle.x>rect.right)
        {overlap=DistanceBetween(circle.x,circle.y,rect.right,rect.bottom)-circle.radius;}}
            overlap*=-1;}
        else
        {overlap=(body1.halfWidth+body2.halfWidth)-DistanceBetween(body1.center.x,body1.center.y,body2.center.x,body2.center.y);}
            if(overlapOnly||overlap===0||(body1.immovable&&body2.immovable)||body1.customSeparateX||body2.customSeparateX)
            {if(overlap!==0&&(body1.onOverlap||body2.onOverlap))
            {this.emit('overlap',body1.gameObject,body2.gameObject,body1,body2);}
                return(overlap!==0);}
            var b1vx=body1.velocity.x;var b1vy=body1.velocity.y;var b1mass=body1.mass;var b2vx=body2.velocity.x;var b2vy=body2.velocity.y;var b2mass=body2.mass;var v1={x:b1vx*Math.cos(angleCollision)+b1vy*Math.sin(angleCollision),y:b1vx*Math.sin(angleCollision)-b1vy*Math.cos(angleCollision)};var v2={x:b2vx*Math.cos(angleCollision)+b2vy*Math.sin(angleCollision),y:b2vx*Math.sin(angleCollision)-b2vy*Math.cos(angleCollision)};var tempVel1=((b1mass-b2mass)*v1.x+2*b2mass*v2.x)/(b1mass+b2mass);var tempVel2=(2*b1mass*v1.x+(b2mass-b1mass)*v2.x)/(b1mass+b2mass);if(!body1.immovable)
        {body1.velocity.x=(tempVel1*Math.cos(angleCollision)-v1.y*Math.sin(angleCollision))*body1.bounce.x;body1.velocity.y=(v1.y*Math.cos(angleCollision)+tempVel1*Math.sin(angleCollision))*body1.bounce.y;b1vx=body1.velocity.x;b1vy=body1.velocity.y;}
            if(!body2.immovable)
            {body2.velocity.x=(tempVel2*Math.cos(angleCollision)-v2.y*Math.sin(angleCollision))*body2.bounce.x;body2.velocity.y=(v2.y*Math.cos(angleCollision)+tempVel2*Math.sin(angleCollision))*body2.bounce.y;b2vx=body2.velocity.x;b2vy=body2.velocity.y;}
            if(Math.abs(angleCollision)<Math.PI / 2)
            {if((b1vx>0)&&!body1.immovable&&(b2vx>b1vx))
            {body1.velocity.x*=-1;}
            else if((b2vx<0)&&!body2.immovable&&(b1vx<b2vx))
            {body2.velocity.x*=-1;}
            else if((b1vy>0)&&!body1.immovable&&(b2vy>b1vy))
            {body1.velocity.y*=-1;}
            else if((b2vy<0)&&!body2.immovable&&(b1vy<b2vy))
            {body2.velocity.y*=-1;}}
            else if(Math.abs(angleCollision)>Math.PI / 2)
            {if((b1vx<0)&&!body1.immovable&&(b2vx<b1vx))
            {body1.velocity.x*=-1;}
            else if((b2vx>0)&&!body2.immovable&&(b1vx>b2vx))
            {body2.velocity.x*=-1;}
            else if((b1vy<0)&&!body1.immovable&&(b2vy<b1vy))
            {body1.velocity.y*=-1;}
            else if((b2vy>0)&&!body2.immovable&&(b1vx>b2vy))
            {body2.velocity.y*=-1;}}
            var delta=this._frameTime;if(!body1.immovable)
        {body1.x+=(body1.velocity.x*delta)-overlap*Math.cos(angleCollision);body1.y+=(body1.velocity.y*delta)-overlap*Math.sin(angleCollision);}
            if(!body2.immovable)
            {body2.x+=(body2.velocity.x*delta)+overlap*Math.cos(angleCollision);body2.y+=(body2.velocity.y*delta)+overlap*Math.sin(angleCollision);}
            if(body1.onCollide||body2.onCollide)
            {this.emit('collide',body1.gameObject,body2.gameObject,body1,body2);}
            body1.postUpdate();body2.postUpdate();return true;},intersects:function(body1,body2)
        {if(body1===body2)
        {return false;}
            if(!body1.isCircle&&!body2.isCircle)
            {return!(body1.right<=body2.position.x||body1.bottom<=body2.position.y||body1.position.x>=body2.right||body1.position.y>=body2.bottom);}
            else if(body1.isCircle)
            {if(body2.isCircle)
            {return DistanceBetween(body1.center.x,body1.center.y,body2.center.x,body2.center.y)<=(body1.halfWidth+body2.halfWidth);}
            else
            {return this.circleBodyIntersects(body1,body2);}}
            else
            {return this.circleBodyIntersects(body2,body1);}},circleBodyIntersects:function(circle,body)
        {var x=Clamp(circle.center.x,body.left,body.right);var y=Clamp(circle.center.y,body.top,body.bottom);var dx=(circle.center.x-x)*(circle.center.x-x);var dy=(circle.center.y-y)*(circle.center.y-y);return(dx+dy)<=(circle.halfWidth*circle.halfWidth);},overlap:function(object1,object2,overlapCallback,processCallback,callbackContext)
        {if(overlapCallback===undefined){overlapCallback=null;}
            if(processCallback===undefined){processCallback=null;}
            if(callbackContext===undefined){callbackContext=overlapCallback;}
            return this.collideObjects(object1,object2,overlapCallback,processCallback,callbackContext,true);},collide:function(object1,object2,collideCallback,processCallback,callbackContext)
        {if(collideCallback===undefined){collideCallback=null;}
            if(processCallback===undefined){processCallback=null;}
            if(callbackContext===undefined){callbackContext=collideCallback;}
            return this.collideObjects(object1,object2,collideCallback,processCallback,callbackContext,false);},collideObjects:function(object1,object2,collideCallback,processCallback,callbackContext,overlapOnly)
        {var i;if(object1.isParent&&object1.physicsType===undefined)
        {object1=object1.children.entries;}
            if(object2&&object2.isParent&&object2.physicsType===undefined)
            {object2=object2.children.entries;}
            var object1isArray=Array.isArray(object1);var object2isArray=Array.isArray(object2);this._total=0;if(!object1isArray&&!object2isArray)
        {this.collideHandler(object1,object2,collideCallback,processCallback,callbackContext,overlapOnly);}
        else if(!object1isArray&&object2isArray)
        {for(i=0;i<object2.length;i++)
        {this.collideHandler(object1,object2[i],collideCallback,processCallback,callbackContext,overlapOnly);}}
        else if(object1isArray&&!object2isArray)
        {for(i=0;i<object1.length;i++)
        {this.collideHandler(object1[i],object2,collideCallback,processCallback,callbackContext,overlapOnly);}}
        else
        {for(i=0;i<object1.length;i++)
        {for(var j=0;j<object2.length;j++)
        {this.collideHandler(object1[i],object2[j],collideCallback,processCallback,callbackContext,overlapOnly);}}}
            return(this._total>0);},collideHandler:function(object1,object2,collideCallback,processCallback,callbackContext,overlapOnly)
        {if(object2===undefined&&object1.isParent)
        {return this.collideGroupVsGroup(object1,object1,collideCallback,processCallback,callbackContext,overlapOnly);}
            if(!object1||!object2)
            {return false;}
            if(object1.body)
            {if(object2.body)
            {return this.collideSpriteVsSprite(object1,object2,collideCallback,processCallback,callbackContext,overlapOnly);}
            else if(object2.isParent)
            {return this.collideSpriteVsGroup(object1,object2,collideCallback,processCallback,callbackContext,overlapOnly);}
            else if(object2.isTilemap)
            {return this.collideSpriteVsTilemapLayer(object1,object2,collideCallback,processCallback,callbackContext,overlapOnly);}}
            else if(object1.isParent)
            {if(object2.body)
            {return this.collideSpriteVsGroup(object2,object1,collideCallback,processCallback,callbackContext,overlapOnly);}
            else if(object2.isParent)
            {return this.collideGroupVsGroup(object1,object2,collideCallback,processCallback,callbackContext,overlapOnly);}
            else if(object2.isTilemap)
            {return this.collideGroupVsTilemapLayer(object1,object2,collideCallback,processCallback,callbackContext,overlapOnly);}}
            else if(object1.isTilemap)
            {if(object2.body)
            {return this.collideSpriteVsTilemapLayer(object2,object1,collideCallback,processCallback,callbackContext,overlapOnly);}
            else if(object2.isParent)
            {return this.collideGroupVsTilemapLayer(object2,object1,collideCallback,processCallback,callbackContext,overlapOnly);}}},collideSpriteVsSprite:function(sprite1,sprite2,collideCallback,processCallback,callbackContext,overlapOnly)
        {if(!sprite1.body||!sprite2.body)
        {return false;}
            if(this.separate(sprite1.body,sprite2.body,processCallback,callbackContext,overlapOnly))
            {if(collideCallback)
            {collideCallback.call(callbackContext,sprite1,sprite2);}
                this._total++;}
            return true;},collideSpriteVsGroup:function(sprite,group,collideCallback,processCallback,callbackContext,overlapOnly)
        {var bodyA=sprite.body;if(group.length===0||!bodyA||!bodyA.enable)
        {return;}
            var i;var len;var bodyB;if(this.useTree)
        {var minMax=this.treeMinMax;minMax.minX=bodyA.left;minMax.minY=bodyA.top;minMax.maxX=bodyA.right;minMax.maxY=bodyA.bottom;var results=(group.physicsType===CONST.DYNAMIC_BODY)?this.tree.search(minMax):this.staticTree.search(minMax);len=results.length;for(i=0;i<len;i++)
        {bodyB=results[i];if(bodyA===bodyB||!group.contains(bodyB.gameObject))
        {continue;}
            if(this.separate(bodyA,bodyB,processCallback,callbackContext,overlapOnly))
            {if(collideCallback)
            {collideCallback.call(callbackContext,bodyA.gameObject,bodyB.gameObject);}
                this._total++;}}}
        else
        {var children=group.getChildren();var skipIndex=group.children.entries.indexOf(sprite);len=children.length;for(i=0;i<len;i++)
        {bodyB=children[i].body;if(!bodyB||i===skipIndex||!bodyB.enable)
        {continue;}
            if(this.separate(bodyA,bodyB,processCallback,callbackContext,overlapOnly))
            {if(collideCallback)
            {collideCallback.call(callbackContext,bodyA.gameObject,bodyB.gameObject);}
                this._total++;}}}},collideGroupVsTilemapLayer:function(group,tilemapLayer,collideCallback,processCallback,callbackContext,overlapOnly)
        {var children=group.getChildren();if(children.length===0)
        {return false;}
            var didCollide=false;for(var i=0;i<children.length;i++)
        {if(children[i].body)
        {if(this.collideSpriteVsTilemapLayer(children[i],tilemapLayer,collideCallback,processCallback,callbackContext,overlapOnly))
        {didCollide=true;}}}
            return didCollide;},collideSpriteVsTilemapLayer:function(sprite,tilemapLayer,collideCallback,processCallback,callbackContext,overlapOnly)
        {var body=sprite.body;if(!body.enable)
        {return false;}
            var x=body.position.x;var y=body.position.y;var w=body.width;var h=body.height;var layerData=tilemapLayer.layer;if(layerData.tileWidth>layerData.baseTileWidth)
        {var xDiff=(layerData.tileWidth-layerData.baseTileWidth)*tilemapLayer.scaleX;x-=xDiff;w+=xDiff;}
            if(layerData.tileHeight>layerData.baseTileHeight)
            {var yDiff=(layerData.tileHeight-layerData.baseTileHeight)*tilemapLayer.scaleY;h+=yDiff;}
            var mapData=tilemapLayer.getTilesWithinWorldXY(x,y,w,h);if(mapData.length===0)
        {return false;}
            var tile;var tileWorldRect={left:0,right:0,top:0,bottom:0};for(var i=0;i<mapData.length;i++)
        {tile=mapData[i];tileWorldRect.left=tilemapLayer.tileToWorldX(tile.x);tileWorldRect.top=tilemapLayer.tileToWorldY(tile.y);if(tile.baseHeight!==tile.height)
        {tileWorldRect.top-=(tile.height-tile.baseHeight)*tilemapLayer.scaleY;}
            tileWorldRect.right=tileWorldRect.left+tile.width*tilemapLayer.scaleX;tileWorldRect.bottom=tileWorldRect.top+tile.height*tilemapLayer.scaleY;if(TileIntersectsBody(tileWorldRect,body)&&(!processCallback||processCallback.call(callbackContext,sprite,tile))&&ProcessTileCallbacks(tile,sprite)&&(overlapOnly||SeparateTile(i,body,tile,tileWorldRect,tilemapLayer,this.TILE_BIAS)))
        {this._total++;if(collideCallback)
        {collideCallback.call(callbackContext,sprite,tile);}
            if(overlapOnly&&body.onOverlap)
            {sprite.emit('overlap',body.gameObject,tile,body,null);}
            else if(body.onCollide)
            {sprite.emit('collide',body.gameObject,tile,body,null);}
            body.postUpdate();}}},collideGroupVsGroup:function(group1,group2,collideCallback,processCallback,callbackContext,overlapOnly)
        {if(group1.length===0||group2.length===0)
        {return;}
            var children=group1.getChildren();for(var i=0;i<children.length;i++)
        {this.collideSpriteVsGroup(children[i],group2,collideCallback,processCallback,callbackContext,overlapOnly);}},wrap:function(object,padding)
        {if(object.body)
        {this.wrapObject(object,padding);}
        else if(object.getChildren)
        {this.wrapArray(object.getChildren(),padding);}
        else if(Array.isArray(object))
        {this.wrapArray(object,padding);}
        else
        {this.wrapObject(object,padding);}},wrapArray:function(objects,padding)
        {for(var i=0;i<objects.length;i++)
        {this.wrapObject(objects[i],padding);}},wrapObject:function(object,padding)
        {if(padding===undefined){padding=0;}
            object.x=Wrap(object.x,this.bounds.left-padding,this.bounds.right+padding);object.y=Wrap(object.y,this.bounds.top-padding,this.bounds.bottom+padding);},shutdown:function()
        {this.tree.clear();this.staticTree.clear();this.bodies.clear();this.staticBodies.clear();this.colliders.destroy();this.removeAllListeners();},destroy:function()
        {this.shutdown();this.scene=null;}});module.exports=World;}),"./physics/arcade/components/Acceleration.js":(function(module,exports){var Acceleration={setAcceleration:function(x,y)
        {this.body.acceleration.set(x,y);return this;},setAccelerationX:function(value)
        {this.body.acceleration.x=value;return this;},setAccelerationY:function(value)
        {this.body.acceleration.y=value;return this;}};module.exports=Acceleration;}),"./physics/arcade/components/Angular.js":(function(module,exports){var Angular={setAngularVelocity:function(value)
        {this.body.angularVelocity=value;return this;},setAngularAcceleration:function(value)
        {this.body.angularAcceleration=value;return this;},setAngularDrag:function(value)
        {this.body.angularDrag=value;return this;}};module.exports=Angular;}),"./physics/arcade/components/Bounce.js":(function(module,exports){var Bounce={setBounce:function(x,y)
        {this.body.bounce.set(x,y);return this;},setBounceX:function(value)
        {this.body.bounce.x=value;return this;},setBounceY:function(value)
        {this.body.bounce.y=value;return this;},setCollideWorldBounds:function(value)
        {this.body.collideWorldBounds=value;return this;}};module.exports=Bounce;}),"./physics/arcade/components/Debug.js":(function(module,exports){var Debug={setDebug:function(showBody,showVelocity,bodyColor)
        {this.debugShowBody=showBody;this.debugShowVelocity=showVelocity;this.debugBodyColor=bodyColor;return this;},setDebugBodyColor:function(value)
        {this.body.debugBodyColor=value;return this;},debugShowBody:{get:function()
            {return this.body.debugShowBody;},set:function(value)
            {this.body.debugShowBody=value;}},debugShowVelocity:{get:function()
            {return this.body.debugShowVelocity;},set:function(value)
            {this.body.debugShowVelocity=value;}},debugBodyColor:{get:function()
            {return this.body.debugBodyColor;},set:function(value)
            {this.body.debugBodyColor=value;}}};module.exports=Debug;}),"./physics/arcade/components/Drag.js":(function(module,exports){var Drag={setDrag:function(x,y)
        {this.body.drag.set(x,y);return this;},setDragX:function(value)
        {this.body.drag.x=value;return this;},setDragY:function(value)
        {this.body.drag.y=value;return this;},setDamping:function(value)
        {this.body.useDamping=value;return this;}};module.exports=Drag;}),"./physics/arcade/components/Enable.js":(function(module,exports){var Enable={enableBody:function(reset,x,y,enableGameObject,showGameObject)
        {if(reset)
        {this.body.reset(x,y);}
            if(enableGameObject)
            {this.body.gameObject.active=true;}
            if(showGameObject)
            {this.body.gameObject.visible=true;}
            this.body.enable=true;return this;},disableBody:function(disableGameObject,hideGameObject)
        {if(disableGameObject===undefined){disableGameObject=false;}
            if(hideGameObject===undefined){hideGameObject=false;}
            this.body.stop();this.body.enable=false;if(disableGameObject)
        {this.body.gameObject.active=false;}
            if(hideGameObject)
            {this.body.gameObject.visible=false;}
            return this;},refreshBody:function()
        {this.body.updateFromGameObject();return this;}};module.exports=Enable;}),"./physics/arcade/components/Friction.js":(function(module,exports){var Friction={setFriction:function(x,y)
        {this.body.friction.set(x,y);return this;},setFrictionX:function(x)
        {this.body.friction.x=x;return this;},setFrictionY:function(y)
        {this.body.friction.y=y;return this;}};module.exports=Friction;}),"./physics/arcade/components/Gravity.js":(function(module,exports){var Gravity={setGravity:function(x,y)
        {this.body.gravity.set(x,y);return this;},setGravityX:function(x)
        {this.body.gravity.x=x;return this;},setGravityY:function(y)
        {this.body.gravity.y=y;return this;}};module.exports=Gravity;}),"./physics/arcade/components/Immovable.js":(function(module,exports){var Immovable={setImmovable:function(value)
        {if(value===undefined){value=true;}
            this.body.immovable=value;return this;}};module.exports=Immovable;}),"./physics/arcade/components/Mass.js":(function(module,exports){var Mass={setMass:function(value)
        {this.body.mass=value;return this;}};module.exports=Mass;}),"./physics/arcade/components/Size.js":(function(module,exports){var Size={setOffset:function(x,y)
        {this.body.setOffset(x,y);return this;},setSize:function(width,height,center)
        {this.body.setSize(width,height,center);return this;},setCircle:function(radius,offsetX,offsetY)
        {this.body.setCircle(radius,offsetX,offsetY);return this;}};module.exports=Size;}),"./physics/arcade/components/Velocity.js":(function(module,exports){var Velocity={setVelocity:function(x,y)
        {this.body.setVelocity(x,y);return this;},setVelocityX:function(x)
        {this.body.setVelocityX(x);return this;},setVelocityY:function(y)
        {this.body.setVelocityY(y);return this;},setMaxVelocity:function(x,y)
        {this.body.maxVelocity.set(x,y);return this;}};module.exports=Velocity;}),"./physics/arcade/components/index.js":(function(module,exports,__webpack_require__){module.exports={Acceleration:__webpack_require__("./physics/arcade/components/Acceleration.js"),Angular:__webpack_require__("./physics/arcade/components/Angular.js"),Bounce:__webpack_require__("./physics/arcade/components/Bounce.js"),Debug:__webpack_require__("./physics/arcade/components/Debug.js"),Drag:__webpack_require__("./physics/arcade/components/Drag.js"),Enable:__webpack_require__("./physics/arcade/components/Enable.js"),Friction:__webpack_require__("./physics/arcade/components/Friction.js"),Gravity:__webpack_require__("./physics/arcade/components/Gravity.js"),Immovable:__webpack_require__("./physics/arcade/components/Immovable.js"),Mass:__webpack_require__("./physics/arcade/components/Mass.js"),Size:__webpack_require__("./physics/arcade/components/Size.js"),Velocity:__webpack_require__("./physics/arcade/components/Velocity.js")};}),"./physics/arcade/const.js":(function(module,exports){var CONST={DYNAMIC_BODY:0,STATIC_BODY:1,GROUP:2,TILEMAPLAYER:3,FACING_NONE:10,FACING_UP:11,FACING_DOWN:12,FACING_LEFT:13,FACING_RIGHT:14};module.exports=CONST;}),"./physics/arcade/index.js":(function(module,exports,__webpack_require__){var CONST=__webpack_require__("./physics/arcade/const.js");var Extend=__webpack_require__("./utils/object/Extend.js");var Arcade={ArcadePhysics:__webpack_require__("./physics/arcade/ArcadePhysics.js"),Body:__webpack_require__("./physics/arcade/Body.js"),Collider:__webpack_require__("./physics/arcade/Collider.js"),Factory:__webpack_require__("./physics/arcade/Factory.js"),Group:__webpack_require__("./physics/arcade/PhysicsGroup.js"),Image:__webpack_require__("./physics/arcade/ArcadeImage.js"),Sprite:__webpack_require__("./physics/arcade/ArcadeSprite.js"),StaticBody:__webpack_require__("./physics/arcade/StaticBody.js"),StaticGroup:__webpack_require__("./physics/arcade/StaticPhysicsGroup.js"),World:__webpack_require__("./physics/arcade/World.js")};Arcade=Extend(false,Arcade,CONST);module.exports=Arcade;}),"./physics/arcade/tilemap/ProcessTileCallbacks.js":(function(module,exports){var ProcessTileCallbacks=function(tile,sprite)
    {if(tile.collisionCallback)
    {return!tile.collisionCallback.call(tile.collisionCallbackContext,sprite,tile);}
    else if(tile.layer.callbacks[tile.index])
    {return!tile.layer.callbacks[tile.index].callback.call(tile.layer.callbacks[tile.index].callbackContext,sprite,tile);}
        return true;};module.exports=ProcessTileCallbacks;}),"./physics/arcade/tilemap/ProcessTileSeparationX.js":(function(module,exports){var ProcessTileSeparationX=function(body,x)
    {if(x<0)
    {body.blocked.none=false;body.blocked.left=true;}
    else if(x>0)
    {body.blocked.none=false;body.blocked.right=true;}
        body.position.x-=x;if(body.bounce.x===0)
    {body.velocity.x=0;}
    else
    {body.velocity.x=-body.velocity.x*body.bounce.x;}};module.exports=ProcessTileSeparationX;}),"./physics/arcade/tilemap/ProcessTileSeparationY.js":(function(module,exports){var ProcessTileSeparationY=function(body,y)
    {if(y<0)
    {body.blocked.none=false;body.blocked.up=true;}
    else if(y>0)
    {body.blocked.none=false;body.blocked.down=true;}
        body.position.y-=y;if(body.bounce.y===0)
    {body.velocity.y=0;}
    else
    {body.velocity.y=-body.velocity.y*body.bounce.y;}};module.exports=ProcessTileSeparationY;}),"./physics/arcade/tilemap/SeparateTile.js":(function(module,exports,__webpack_require__){var TileCheckX=__webpack_require__("./physics/arcade/tilemap/TileCheckX.js");var TileCheckY=__webpack_require__("./physics/arcade/tilemap/TileCheckY.js");var TileIntersectsBody=__webpack_require__("./physics/arcade/tilemap/TileIntersectsBody.js");var SeparateTile=function(i,body,tile,tileWorldRect,tilemapLayer,tileBias)
    {var tileLeft=tileWorldRect.left;var tileTop=tileWorldRect.top;var tileRight=tileWorldRect.right;var tileBottom=tileWorldRect.bottom;var faceHorizontal=tile.faceLeft||tile.faceRight;var faceVertical=tile.faceTop||tile.faceBottom;if(!faceHorizontal&&!faceVertical)
    {return false;}
        var ox=0;var oy=0;var minX=0;var minY=1;if(body.deltaAbsX()>body.deltaAbsY())
    {minX=-1;}
    else if(body.deltaAbsX()<body.deltaAbsY())
    {minY=-1;}
        if(body.deltaX()!==0&&body.deltaY()!==0&&faceHorizontal&&faceVertical)
        {minX=Math.min(Math.abs(body.position.x-tileRight),Math.abs(body.right-tileLeft));minY=Math.min(Math.abs(body.position.y-tileBottom),Math.abs(body.bottom-tileTop));}
        if(minX<minY)
        {if(faceHorizontal)
        {ox=TileCheckX(body,tile,tileLeft,tileRight,tileBias);if(ox!==0&&!TileIntersectsBody(tileWorldRect,body))
        {return true;}}
            if(faceVertical)
            {oy=TileCheckY(body,tile,tileTop,tileBottom,tileBias);}}
        else
        {if(faceVertical)
        {oy=TileCheckY(body,tile,tileTop,tileBottom,tileBias);if(oy!==0&&!TileIntersectsBody(tileWorldRect,body))
        {return true;}}
            if(faceHorizontal)
            {ox=TileCheckX(body,tile,tileLeft,tileRight,tileBias);}}
        return(ox!==0||oy!==0);};module.exports=SeparateTile;}),"./physics/arcade/tilemap/TileCheckX.js":(function(module,exports,__webpack_require__){var ProcessTileSeparationX=__webpack_require__("./physics/arcade/tilemap/ProcessTileSeparationX.js");var TileCheckX=function(body,tile,tileLeft,tileRight,tileBias)
    {var ox=0;if(body.deltaX()<0&&!body.blocked.left&&tile.collideRight&&body.checkCollision.left)
    {if(tile.faceRight&&body.x<tileRight)
    {ox=body.x-tileRight;if(ox<-tileBias)
    {ox=0;}}}
    else if(body.deltaX()>0&&!body.blocked.right&&tile.collideLeft&&body.checkCollision.right)
    {if(tile.faceLeft&&body.right>tileLeft)
    {ox=body.right-tileLeft;if(ox>tileBias)
    {ox=0;}}}
        if(ox!==0)
        {if(body.customSeparateX)
        {body.overlapX=ox;}
        else
        {ProcessTileSeparationX(body,ox);}}
        return ox;};module.exports=TileCheckX;}),"./physics/arcade/tilemap/TileCheckY.js":(function(module,exports,__webpack_require__){var ProcessTileSeparationY=__webpack_require__("./physics/arcade/tilemap/ProcessTileSeparationY.js");var TileCheckY=function(body,tile,tileTop,tileBottom,tileBias)
    {var oy=0;if(body.deltaY()<0&&!body.blocked.up&&tile.collideDown&&body.checkCollision.up)
    {if(tile.faceBottom&&body.y<tileBottom)
    {oy=body.y-tileBottom;if(oy<-tileBias)
    {oy=0;}}}
    else if(body.deltaY()>0&&!body.blocked.down&&tile.collideUp&&body.checkCollision.down)
    {if(tile.faceTop&&body.bottom>tileTop)
    {oy=body.bottom-tileTop;if(oy>tileBias)
    {oy=0;}}}
        if(oy!==0)
        {if(body.customSeparateY)
        {body.overlapY=oy;}
        else
        {ProcessTileSeparationY(body,oy);}}
        return oy;};module.exports=TileCheckY;}),"./physics/arcade/tilemap/TileIntersectsBody.js":(function(module,exports){var TileIntersectsBody=function(tileWorldRect,body)
    {return!(body.right<=tileWorldRect.left||body.bottom<=tileWorldRect.top||body.position.x>=tileWorldRect.right||body.position.y>=tileWorldRect.bottom);};module.exports=TileIntersectsBody;}),"./physics/impact/Body.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var COLLIDES=__webpack_require__("./physics/impact/COLLIDES.js");var GetVelocity=__webpack_require__("./physics/impact/GetVelocity.js");var TYPE=__webpack_require__("./physics/impact/TYPE.js");var UpdateMotion=__webpack_require__("./physics/impact/UpdateMotion.js");var Body=new Class({initialize:function Body(world,x,y,sx,sy)
        {if(sx===undefined){sx=16;}
            if(sy===undefined){sy=sx;}
            this.world=world;this.gameObject=null;this.enabled=true;this.parent;this.id=world.getNextID();this.name='';this.size={x:sx,y:sy};this.offset={x:0,y:0};this.pos={x:x,y:y};this.last={x:x,y:y};this.vel={x:0,y:0};this.accel={x:0,y:0};this.friction={x:0,y:0};this.maxVel={x:world.defaults.maxVelocityX,y:world.defaults.maxVelocityY};this.standing=false;this.gravityFactor=world.defaults.gravityFactor;this.bounciness=world.defaults.bounciness;this.minBounceVelocity=world.defaults.minBounceVelocity;this.accelGround=0;this.accelAir=0;this.jumpSpeed=0;this.type=TYPE.NONE;this.checkAgainst=TYPE.NONE;this.collides=COLLIDES.NEVER;this.debugShowBody=world.defaults.debugShowBody;this.debugShowVelocity=world.defaults.debugShowVelocity;this.debugBodyColor=world.defaults.bodyDebugColor;this.updateCallback;this.slopeStanding={min:0.767944870877505,max:2.3736477827122884};},reset:function(x,y)
        {this.pos={x:x,y:y};this.last={x:x,y:y};this.vel={x:0,y:0};this.accel={x:0,y:0};this.friction={x:0,y:0};this.maxVel={x:100,y:100};this.standing=false;this.gravityFactor=1;this.bounciness=0;this.minBounceVelocity=40;this.accelGround=0;this.accelAir=0;this.jumpSpeed=0;this.type=TYPE.NONE;this.checkAgainst=TYPE.NONE;this.collides=COLLIDES.NEVER;},update:function(delta)
        {var pos=this.pos;this.last.x=pos.x;this.last.y=pos.y;this.vel.y+=this.world.gravity*delta*this.gravityFactor;this.vel.x=GetVelocity(delta,this.vel.x,this.accel.x,this.friction.x,this.maxVel.x);this.vel.y=GetVelocity(delta,this.vel.y,this.accel.y,this.friction.y,this.maxVel.y);var mx=this.vel.x*delta;var my=this.vel.y*delta;var res=this.world.collisionMap.trace(pos.x,pos.y,mx,my,this.size.x,this.size.y);if(this.handleMovementTrace(res))
        {UpdateMotion(this,res);}
            var go=this.gameObject;if(go)
        {go.x=(pos.x-this.offset.x)+go.displayOriginX*go.scaleX;go.y=(pos.y-this.offset.y)+go.displayOriginY*go.scaleY;}
            if(this.updateCallback)
            {this.updateCallback(this);}},drawDebug:function(graphic)
        {var pos=this.pos;if(this.debugShowBody)
        {graphic.lineStyle(1,this.debugBodyColor,1);graphic.strokeRect(pos.x,pos.y,this.size.x,this.size.y);}
            if(this.debugShowVelocity)
            {var x=pos.x+this.size.x / 2;var y=pos.y+this.size.y / 2;graphic.lineStyle(1,this.world.defaults.velocityDebugColor,1);graphic.lineBetween(x,y,x+this.vel.x,y+this.vel.y);}},willDrawDebug:function()
        {return(this.debugShowBody||this.debugShowVelocity);},skipHash:function()
        {return(!this.enabled||(this.type===0&&this.checkAgainst===0&&this.collides===0));},touches:function(other)
        {return!(this.pos.x>=other.pos.x+other.size.x||this.pos.x+this.size.x<=other.pos.x||this.pos.y>=other.pos.y+other.size.y||this.pos.y+this.size.y<=other.pos.y);},resetSize:function(x,y,width,height)
        {this.pos.x=x;this.pos.y=y;this.size.x=width;this.size.y=height;return this;},toJSON:function()
        {var output={name:this.name,size:{x:this.size.x,y:this.size.y},pos:{x:this.pos.x,y:this.pos.y},vel:{x:this.vel.x,y:this.vel.y},accel:{x:this.accel.x,y:this.accel.y},friction:{x:this.friction.x,y:this.friction.y},maxVel:{x:this.maxVel.x,y:this.maxVel.y},gravityFactor:this.gravityFactor,bounciness:this.bounciness,minBounceVelocity:this.minBounceVelocity,type:this.type,checkAgainst:this.checkAgainst,collides:this.collides};return output;},fromJSON:function()
        {},check:function()
        {},collideWith:function(other,axis)
        {if(this.parent&&this.parent._collideCallback)
        {this.parent._collideCallback.call(this.parent._callbackScope,this,other,axis);}},handleMovementTrace:function()
        {return true;},destroy:function()
        {this.world.remove(this);this.enabled=false;this.world=null;this.gameObject=null;this.parent=null;}});module.exports=Body;}),"./physics/impact/COLLIDES.js":(function(module,exports){module.exports={NEVER:0,LITE:1,PASSIVE:2,ACTIVE:4,FIXED:8};}),"./physics/impact/CollisionMap.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var DefaultDefs=__webpack_require__("./physics/impact/DefaultDefs.js");var CollisionMap=new Class({initialize:function CollisionMap(tilesize,data)
        {if(tilesize===undefined){tilesize=32;}
            this.tilesize=tilesize;this.data=(Array.isArray(data))?data:[];this.width=(Array.isArray(data))?data[0].length:0;this.height=(Array.isArray(data))?data.length:0;this.lastSlope=55;this.tiledef=DefaultDefs;},trace:function(x,y,vx,vy,objectWidth,objectHeight)
        {var res={collision:{x:false,y:false,slope:false},pos:{x:x+vx,y:y+vy},tile:{x:0,y:0}};if(!this.data)
        {return res;}
            var steps=Math.ceil(Math.max(Math.abs(vx),Math.abs(vy))/ this.tilesize);if(steps>1)
        {var sx=vx / steps;var sy=vy / steps;for(var i=0;i<steps&&(sx||sy);i++)
        {this.step(res,x,y,sx,sy,objectWidth,objectHeight,vx,vy,i);x=res.pos.x;y=res.pos.y;if(res.collision.x)
        {sx=0;vx=0;}
            if(res.collision.y)
            {sy=0;vy=0;}
            if(res.collision.slope)
            {break;}}}
        else
        {this.step(res,x,y,vx,vy,objectWidth,objectHeight,vx,vy,0);}
            return res;},step:function(res,x,y,vx,vy,width,height,rvx,rvy,step)
        {var t=0;var tileX;var tileY;var tilesize=this.tilesize;var mapWidth=this.width;var mapHeight=this.height;if(vx)
        {var pxOffsetX=(vx>0?width:0);var tileOffsetX=(vx<0?tilesize:0);var firstTileY=Math.max(Math.floor(y / tilesize),0);var lastTileY=Math.min(Math.ceil((y+height)/ tilesize),mapHeight);tileX=Math.floor((res.pos.x+pxOffsetX)/ tilesize);var prevTileX=Math.floor((x+pxOffsetX)/ tilesize);if(step>0||tileX===prevTileX||prevTileX<0||prevTileX>=mapWidth)
        {prevTileX=-1;}
            if(tileX>=0&&tileX<mapWidth)
            {for(tileY=firstTileY;tileY<lastTileY;tileY++)
            {if(prevTileX!==-1)
            {t=this.data[tileY][prevTileX];if(t>1&&t<=this.lastSlope&&this.checkDef(res,t,x,y,rvx,rvy,width,height,prevTileX,tileY))
            {break;}}
                t=this.data[tileY][tileX];if(t===1||t>this.lastSlope||(t>1&&this.checkDef(res,t,x,y,rvx,rvy,width,height,tileX,tileY)))
            {if(t>1&&t<=this.lastSlope&&res.collision.slope)
            {break;}
                res.collision.x=true;res.tile.x=t;res.pos.x=(tileX*tilesize)-pxOffsetX+tileOffsetX;x=res.pos.x;rvx=0;break;}}}}
            if(vy)
            {var pxOffsetY=(vy>0?height:0);var tileOffsetY=(vy<0?tilesize:0);var firstTileX=Math.max(Math.floor(res.pos.x / tilesize),0);var lastTileX=Math.min(Math.ceil((res.pos.x+width)/ tilesize),mapWidth);tileY=Math.floor((res.pos.y+pxOffsetY)/ tilesize);var prevTileY=Math.floor((y+pxOffsetY)/ tilesize);if(step>0||tileY===prevTileY||prevTileY<0||prevTileY>=mapHeight)
            {prevTileY=-1;}
                if(tileY>=0&&tileY<mapHeight)
                {for(tileX=firstTileX;tileX<lastTileX;tileX++)
                {if(prevTileY!==-1)
                {t=this.data[prevTileY][tileX];if(t>1&&t<=this.lastSlope&&this.checkDef(res,t,x,y,rvx,rvy,width,height,tileX,prevTileY))
                {break;}}
                    t=this.data[tileY][tileX];if(t===1||t>this.lastSlope||(t>1&&this.checkDef(res,t,x,y,rvx,rvy,width,height,tileX,tileY)))
                {if(t>1&&t<=this.lastSlope&&res.collision.slope)
                {break;}
                    res.collision.y=true;res.tile.y=t;res.pos.y=tileY*tilesize-pxOffsetY+tileOffsetY;break;}}}}},checkDef:function(res,t,x,y,vx,vy,width,height,tileX,tileY)
        {var def=this.tiledef[t];if(!def)
        {return false;}
            var tilesize=this.tilesize;var lx=(tileX+def[0])*tilesize;var ly=(tileY+def[1])*tilesize;var lvx=(def[2]-def[0])*tilesize;var lvy=(def[3]-def[1])*tilesize;var solid=def[4];var tx=x+vx+(lvy<0?width:0)-lx;var ty=y+vy+(lvx>0?height:0)-ly;if(lvx*ty-lvy*tx>0)
        {if(vx*-lvy+vy*lvx<0)
        {return solid;}
            var length=Math.sqrt(lvx*lvx+lvy*lvy);var nx=lvy / length;var ny=-lvx / length;var proj=tx*nx+ty*ny;var px=nx*proj;var py=ny*proj;if(px*px+py*py>=vx*vx+vy*vy)
        {return solid||(lvx*(ty-vy)-lvy*(tx-vx)<0.5);}
            res.pos.x=x+vx-px;res.pos.y=y+vy-py;res.collision.slope={x:lvx,y:lvy,nx:nx,ny:ny};return true;}
            return false;}});module.exports=CollisionMap;}),"./physics/impact/DefaultDefs.js":(function(module,exports){var H=0.5;var N=1 / 3;var M=2 / 3;module.exports={2:[0,1,1,0,true],3:[0,1,1,H,true],4:[0,H,1,0,true],5:[0,1,1,M,true],6:[0,M,1,N,true],7:[0,N,1,0,true],8:[H,1,0,0,true],9:[1,0,H,1,true],10:[H,1,1,0,true],11:[0,0,H,1,true],12:[0,0,1,0,false],13:[1,1,0,0,true],14:[1,H,0,0,true],15:[1,1,0,H,true],16:[1,N,0,0,true],17:[1,M,0,N,true],18:[1,1,0,M,true],19:[1,1,H,0,true],20:[H,0,0,1,true],21:[0,1,H,0,true],22:[H,0,1,1,true],23:[1,1,0,1,false],24:[0,0,1,1,true],25:[0,0,1,H,true],26:[0,H,1,1,true],27:[0,0,1,N,true],28:[0,N,1,M,true],29:[0,M,1,1,true],30:[N,1,0,0,true],31:[1,0,M,1,true],32:[M,1,1,0,true],33:[0,0,N,1,true],34:[1,0,1,1,false],35:[1,0,0,1,true],36:[1,H,0,1,true],37:[1,0,0,H,true],38:[1,M,0,1,true],39:[1,N,0,M,true],40:[1,0,0,N,true],41:[M,1,N,0,true],42:[M,0,N,1,true],43:[N,1,M,0,true],44:[N,0,M,1,true],45:[0,1,0,0,false],52:[1,1,M,0,true],53:[N,0,0,1,true],54:[0,1,N,0,true],55:[M,0,1,1,true]};}),"./physics/impact/Factory.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var ImpactBody=__webpack_require__("./physics/impact/ImpactBody.js");var ImpactImage=__webpack_require__("./physics/impact/ImpactImage.js");var ImpactSprite=__webpack_require__("./physics/impact/ImpactSprite.js");var Factory=new Class({initialize:function Factory(world)
        {this.world=world;this.sys=world.scene.sys;},body:function(x,y,width,height)
        {return new ImpactBody(this.world,x,y,width,height);},existing:function(gameObject)
        {var x=gameObject.x-gameObject.frame.centerX;var y=gameObject.y-gameObject.frame.centerY;var w=gameObject.width;var h=gameObject.height;gameObject.body=this.world.create(x,y,w,h);gameObject.body.parent=gameObject;gameObject.body.gameObject=gameObject;return gameObject;},image:function(x,y,key,frame)
        {var image=new ImpactImage(this.world,x,y,key,frame);this.sys.displayList.add(image);return image;},sprite:function(x,y,key,frame)
        {var sprite=new ImpactSprite(this.world,x,y,key,frame);this.sys.displayList.add(sprite);this.sys.updateList.add(sprite);return sprite;},destroy:function()
        {this.world=null;this.sys=null;}});module.exports=Factory;}),"./physics/impact/GetVelocity.js":(function(module,exports,__webpack_require__){var Clamp=__webpack_require__("./math/Clamp.js");var GetVelocity=function(delta,vel,accel,friction,max)
    {if(accel)
    {return Clamp(vel+accel*delta,-max,max);}
    else if(friction)
    {var frictionDelta=friction*delta;if(vel-frictionDelta>0)
    {return vel-frictionDelta;}
    else if(vel+frictionDelta<0)
    {return vel+frictionDelta;}
    else
    {return 0;}}
        return Clamp(vel,-max,max);};module.exports=GetVelocity;}),"./physics/impact/ImpactBody.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Components=__webpack_require__("./physics/impact/components/index.js");var ImpactBody=new Class({Mixins:[Components.Acceleration,Components.BodyScale,Components.BodyType,Components.Bounce,Components.CheckAgainst,Components.Collides,Components.Debug,Components.Friction,Components.Gravity,Components.Offset,Components.SetGameObject,Components.Velocity],initialize:function ImpactBody(world,x,y,width,height)
        {this.body=world.create(x,y,width,height);this.body.parent=this;this.size=this.body.size;this.offset=this.body.offset;this.vel=this.body.vel;this.accel=this.body.accel;this.friction=this.body.friction;this.maxVel=this.body.maxVel;}});module.exports=ImpactBody;}),"./physics/impact/ImpactImage.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Components=__webpack_require__("./physics/impact/components/index.js");var Image=__webpack_require__("./gameobjects/image/Image.js");var ImpactImage=new Class({Extends:Image,Mixins:[Components.Acceleration,Components.BodyScale,Components.BodyType,Components.Bounce,Components.CheckAgainst,Components.Collides,Components.Debug,Components.Friction,Components.Gravity,Components.Offset,Components.SetGameObject,Components.Velocity],initialize:function ImpactImage(world,x,y,texture,frame)
        {Image.call(this,world.scene,x,y,texture,frame);this.body=world.create(x-this.frame.centerX,y-this.frame.centerY,this.width,this.height);this.body.parent=this;this.body.gameObject=this;this.size=this.body.size;this.offset=this.body.offset;this.vel=this.body.vel;this.accel=this.body.accel;this.friction=this.body.friction;this.maxVel=this.body.maxVel;}});module.exports=ImpactImage;}),"./physics/impact/ImpactPhysics.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Factory=__webpack_require__("./physics/impact/Factory.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var Merge=__webpack_require__("./utils/object/Merge.js");var PluginCache=__webpack_require__("./plugins/PluginCache.js");var World=__webpack_require__("./physics/impact/World.js");var ImpactPhysics=new Class({initialize:function ImpactPhysics(scene)
        {this.scene=scene;this.systems=scene.sys;this.config=this.getConfig();this.world;this.add;scene.sys.events.once('boot',this.boot,this);scene.sys.events.on('start',this.start,this);},boot:function()
        {this.world=new World(this.scene,this.config);this.add=new Factory(this.world);this.systems.events.once('destroy',this.destroy,this);},start:function()
        {if(!this.world)
        {this.world=new World(this.scene,this.config);this.add=new Factory(this.world);}
            var eventEmitter=this.systems.events;eventEmitter.on('update',this.world.update,this.world);eventEmitter.once('shutdown',this.shutdown,this);},getConfig:function()
        {var gameConfig=this.systems.game.config.physics;var sceneConfig=this.systems.settings.physics;var config=Merge(GetFastValue(sceneConfig,'impact',{}),GetFastValue(gameConfig,'impact',{}));return config;},pause:function()
        {return this.world.pause();},resume:function()
        {return this.world.resume();},shutdown:function()
        {var eventEmitter=this.systems.events;eventEmitter.off('update',this.world.update,this.world);eventEmitter.off('shutdown',this.shutdown,this);this.add.destroy();this.world.destroy();this.add=null;this.world=null;},destroy:function()
        {this.shutdown();this.scene.sys.events.off('start',this.start,this);this.scene=null;this.systems=null;}});PluginCache.register('ImpactPhysics',ImpactPhysics,'impactPhysics');module.exports=ImpactPhysics;}),"./physics/impact/ImpactSprite.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Components=__webpack_require__("./physics/impact/components/index.js");var Sprite=__webpack_require__("./gameobjects/sprite/Sprite.js");var ImpactSprite=new Class({Extends:Sprite,Mixins:[Components.Acceleration,Components.BodyScale,Components.BodyType,Components.Bounce,Components.CheckAgainst,Components.Collides,Components.Debug,Components.Friction,Components.Gravity,Components.Offset,Components.SetGameObject,Components.Velocity],initialize:function ImpactSprite(world,x,y,texture,frame)
        {Sprite.call(this,world.scene,x,y,texture,frame);this.body=world.create(x-this.frame.centerX,y-this.frame.centerY,this.width,this.height);this.body.parent=this;this.body.gameObject=this;this.size=this.body.size;this.offset=this.body.offset;this.vel=this.body.vel;this.accel=this.body.accel;this.friction=this.body.friction;this.maxVel=this.body.maxVel;}});module.exports=ImpactSprite;}),"./physics/impact/SeperateX.js":(function(module,exports){var SeperateX=function(world,left,right,weak)
    {var nudge=left.pos.x+left.size.x-right.pos.x;if(weak)
    {var strong=(left===weak)?right:left;weak.vel.x=-weak.vel.x*weak.bounciness+strong.vel.x;var resWeak=world.collisionMap.trace(weak.pos.x,weak.pos.y,weak===left?-nudge:nudge,0,weak.size.x,weak.size.y);weak.pos.x=resWeak.pos.x;}
    else
    {var v2=(left.vel.x-right.vel.x)/ 2;left.vel.x=-v2;right.vel.x=v2;var resLeft=world.collisionMap.trace(left.pos.x,left.pos.y,-nudge / 2,0,left.size.x,left.size.y);left.pos.x=Math.floor(resLeft.pos.x);var resRight=world.collisionMap.trace(right.pos.x,right.pos.y,nudge / 2,0,right.size.x,right.size.y);right.pos.x=Math.ceil(resRight.pos.x);}};module.exports=SeperateX;}),"./physics/impact/SeperateY.js":(function(module,exports){var SeperateY=function(world,top,bottom,weak)
    {var nudge=(top.pos.y+top.size.y-bottom.pos.y);var nudgeX;var resTop;if(weak)
    {var strong=(top===weak)?bottom:top;weak.vel.y=-weak.vel.y*weak.bounciness+strong.vel.y;nudgeX=0;if(weak===top&&Math.abs(weak.vel.y-strong.vel.y)<weak.minBounceVelocity)
    {weak.standing=true;nudgeX=strong.vel.x*world.delta;}
        var resWeak=world.collisionMap.trace(weak.pos.x,weak.pos.y,nudgeX,weak===top?-nudge:nudge,weak.size.x,weak.size.y);weak.pos.y=resWeak.pos.y;weak.pos.x=resWeak.pos.x;}
    else if(world.gravity&&(bottom.standing||top.vel.y>0))
    {resTop=world.collisionMap.trace(top.pos.x,top.pos.y,0,-(top.pos.y+top.size.y-bottom.pos.y),top.size.x,top.size.y);top.pos.y=resTop.pos.y;if(top.bounciness>0&&top.vel.y>top.minBounceVelocity)
    {top.vel.y*=-top.bounciness;}
    else
    {top.standing=true;top.vel.y=0;}}
    else
    {var v2=(top.vel.y-bottom.vel.y)/ 2;top.vel.y=-v2;bottom.vel.y=v2;nudgeX=bottom.vel.x*world.delta;resTop=world.collisionMap.trace(top.pos.x,top.pos.y,nudgeX,-nudge / 2,top.size.x,top.size.y);top.pos.y=resTop.pos.y;var resBottom=world.collisionMap.trace(bottom.pos.x,bottom.pos.y,0,nudge / 2,bottom.size.x,bottom.size.y);bottom.pos.y=resBottom.pos.y;}};module.exports=SeperateY;}),"./physics/impact/Solver.js":(function(module,exports,__webpack_require__){var COLLIDES=__webpack_require__("./physics/impact/COLLIDES.js");var SeperateX=__webpack_require__("./physics/impact/SeperateX.js");var SeperateY=__webpack_require__("./physics/impact/SeperateY.js");var Solver=function(world,bodyA,bodyB)
    {var weak=null;if(bodyA.collides===COLLIDES.LITE||bodyB.collides===COLLIDES.FIXED)
    {weak=bodyA;}
    else if(bodyB.collides===COLLIDES.LITE||bodyA.collides===COLLIDES.FIXED)
    {weak=bodyB;}
        if(bodyA.last.x+bodyA.size.x>bodyB.last.x&&bodyA.last.x<bodyB.last.x+bodyB.size.x)
        {if(bodyA.last.y<bodyB.last.y)
        {SeperateY(world,bodyA,bodyB,weak);}
        else
        {SeperateY(world,bodyB,bodyA,weak);}
            bodyA.collideWith(bodyB,'y');bodyB.collideWith(bodyA,'y');world.emit('collide',bodyA,bodyB,'y');}
        else if(bodyA.last.y+bodyA.size.y>bodyB.last.y&&bodyA.last.y<bodyB.last.y+bodyB.size.y)
        {if(bodyA.last.x<bodyB.last.x)
        {SeperateX(world,bodyA,bodyB,weak);}
        else
        {SeperateX(world,bodyB,bodyA,weak);}
            bodyA.collideWith(bodyB,'x');bodyB.collideWith(bodyA,'x');world.emit('collide',bodyA,bodyB,'x');}};module.exports=Solver;}),"./physics/impact/TYPE.js":(function(module,exports){module.exports={NONE:0,A:1,B:2,BOTH:3};}),"./physics/impact/UpdateMotion.js":(function(module,exports){var UpdateMotion=function(body,res)
    {body.standing=false;if(res.collision.y)
    {if(body.bounciness>0&&Math.abs(body.vel.y)>body.minBounceVelocity)
    {body.vel.y*=-body.bounciness;}
    else
    {if(body.vel.y>0)
    {body.standing=true;}
        body.vel.y=0;}}
        if(res.collision.x)
        {if(body.bounciness>0&&Math.abs(body.vel.x)>body.minBounceVelocity)
        {body.vel.x*=-body.bounciness;}
        else
        {body.vel.x=0;}}
        if(res.collision.slope)
        {var s=res.collision.slope;if(body.bounciness>0)
        {var proj=body.vel.x*s.nx+body.vel.y*s.ny;body.vel.x=(body.vel.x-s.nx*proj*2)*body.bounciness;body.vel.y=(body.vel.y-s.ny*proj*2)*body.bounciness;}
        else
        {var lengthSquared=s.x*s.x+s.y*s.y;var dot=(body.vel.x*s.x+body.vel.y*s.y)/ lengthSquared;body.vel.x=s.x*dot;body.vel.y=s.y*dot;var angle=Math.atan2(s.x,s.y);if(angle>body.slopeStanding.min&&angle<body.slopeStanding.max)
        {body.standing=true;}}}
        body.pos.x=res.pos.x;body.pos.y=res.pos.y;};module.exports=UpdateMotion;}),"./physics/impact/World.js":(function(module,exports,__webpack_require__){var Body=__webpack_require__("./physics/impact/Body.js");var Class=__webpack_require__("./utils/Class.js");var COLLIDES=__webpack_require__("./physics/impact/COLLIDES.js");var CollisionMap=__webpack_require__("./physics/impact/CollisionMap.js");var EventEmitter=__webpack_require__("../node_modules/eventemitter3/index.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var HasValue=__webpack_require__("./utils/object/HasValue.js");var Set=__webpack_require__("./structs/Set.js");var Solver=__webpack_require__("./physics/impact/Solver.js");var TILEMAP_FORMATS=__webpack_require__("./tilemaps/Formats.js");var TYPE=__webpack_require__("./physics/impact/TYPE.js");var World=new Class({Extends:EventEmitter,initialize:function World(scene,config)
        {EventEmitter.call(this);this.scene=scene;this.bodies=new Set();this.gravity=GetFastValue(config,'gravity',0);this.cellSize=GetFastValue(config,'cellSize',64);this.collisionMap=new CollisionMap();this.timeScale=GetFastValue(config,'timeScale',1);this.maxStep=GetFastValue(config,'maxStep',0.05);this.enabled=true;this.drawDebug=GetFastValue(config,'debug',false);this.debugGraphic;var _maxVelocity=GetFastValue(config,'maxVelocity',100);this.defaults={debugShowBody:GetFastValue(config,'debugShowBody',true),debugShowVelocity:GetFastValue(config,'debugShowVelocity',true),bodyDebugColor:GetFastValue(config,'debugBodyColor',0xff00ff),velocityDebugColor:GetFastValue(config,'debugVelocityColor',0x00ff00),maxVelocityX:GetFastValue(config,'maxVelocityX',_maxVelocity),maxVelocityY:GetFastValue(config,'maxVelocityY',_maxVelocity),minBounceVelocity:GetFastValue(config,'minBounceVelocity',40),gravityFactor:GetFastValue(config,'gravityFactor',1),bounciness:GetFastValue(config,'bounciness',0)};this.walls={left:null,right:null,top:null,bottom:null};this.delta=0;this._lastId=0;if(GetFastValue(config,'setBounds',false))
        {var boundsConfig=config['setBounds'];if(typeof boundsConfig==='boolean')
        {this.setBounds();}
        else
        {var x=GetFastValue(boundsConfig,'x',0);var y=GetFastValue(boundsConfig,'y',0);var width=GetFastValue(boundsConfig,'width',scene.sys.scale.width);var height=GetFastValue(boundsConfig,'height',scene.sys.scale.height);var thickness=GetFastValue(boundsConfig,'thickness',64);var left=GetFastValue(boundsConfig,'left',true);var right=GetFastValue(boundsConfig,'right',true);var top=GetFastValue(boundsConfig,'top',true);var bottom=GetFastValue(boundsConfig,'bottom',true);this.setBounds(x,y,width,height,thickness,left,right,top,bottom);}}
            if(this.drawDebug)
            {this.createDebugGraphic();}},setCollisionMap:function(key,tileSize)
        {if(typeof key==='string')
        {var tilemapData=this.scene.cache.tilemap.get(key);if(!tilemapData||tilemapData.format!==TILEMAP_FORMATS.WELTMEISTER)
        {console.warn('The specified key does not correspond to a Weltmeister tilemap: '+key);return null;}
            var layers=tilemapData.data.layer;var collisionLayer;for(var i=0;i<layers.length;i++)
        {if(layers[i].name==='collision')
        {collisionLayer=layers[i];break;}}
            if(tileSize===undefined){tileSize=collisionLayer.tilesize;}
            this.collisionMap=new CollisionMap(tileSize,collisionLayer.data);}
        else if(Array.isArray(key))
        {this.collisionMap=new CollisionMap(tileSize,key);}
        else
        {console.warn('Invalid Weltmeister collision map data: '+key);}
            return this.collisionMap;},setCollisionMapFromTilemapLayer:function(tilemapLayer,options)
        {if(options===undefined){options={};}
            var slopeProperty=GetFastValue(options,'slopeProperty',null);var slopeMap=GetFastValue(options,'slopeMap',null);var collidingSlope=GetFastValue(options,'defaultCollidingSlope',null);var nonCollidingSlope=GetFastValue(options,'defaultNonCollidingSlope',0);var layerData=tilemapLayer.layer;var tileSize=layerData.baseTileWidth;var collisionData=[];for(var ty=0;ty<layerData.height;ty++)
        {collisionData[ty]=[];for(var tx=0;tx<layerData.width;tx++)
        {var tile=layerData.data[ty][tx];if(tile&&tile.collides)
        {if(slopeProperty!==null&&HasValue(tile.properties,slopeProperty))
        {collisionData[ty][tx]=parseInt(tile.properties[slopeProperty],10);}
        else if(slopeMap!==null&&HasValue(slopeMap,tile.index))
        {collisionData[ty][tx]=slopeMap[tile.index];}
        else if(collidingSlope!==null)
        {collisionData[ty][tx]=collidingSlope;}
        else
        {collisionData[ty][tx]=tile.index;}}
        else
        {collisionData[ty][tx]=nonCollidingSlope;}}}
            this.collisionMap=new CollisionMap(tileSize,collisionData);return this.collisionMap;},setBounds:function(x,y,width,height,thickness,left,right,top,bottom)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            if(width===undefined){width=this.scene.sys.scale.width;}
            if(height===undefined){height=this.scene.sys.scale.height;}
            if(thickness===undefined){thickness=64;}
            if(left===undefined){left=true;}
            if(right===undefined){right=true;}
            if(top===undefined){top=true;}
            if(bottom===undefined){bottom=true;}
            this.updateWall(left,'left',x-thickness,y,thickness,height);this.updateWall(right,'right',x+width,y,thickness,height);this.updateWall(top,'top',x,y-thickness,width,thickness);this.updateWall(bottom,'bottom',x,y+height,width,thickness);return this;},updateWall:function(add,position,x,y,width,height)
        {var wall=this.walls[position];if(add)
        {if(wall)
        {wall.resetSize(x,y,width,height);}
        else
        {this.walls[position]=this.create(x,y,width,height);this.walls[position].name=position;this.walls[position].gravityFactor=0;this.walls[position].collides=COLLIDES.FIXED;}}
        else
        {if(wall)
        {this.bodies.remove(wall);}
            this.walls[position]=null;}},createDebugGraphic:function()
        {var graphic=this.scene.sys.add.graphics({x:0,y:0});graphic.setDepth(Number.MAX_VALUE);this.debugGraphic=graphic;this.drawDebug=true;return graphic;},getNextID:function()
        {return this._lastId++;},create:function(x,y,sizeX,sizeY)
        {var body=new Body(this,x,y,sizeX,sizeY);this.bodies.set(body);return body;},remove:function(object)
        {this.bodies.delete(object);},pause:function()
        {this.enabled=false;this.emit('pause');return this;},resume:function()
        {this.enabled=true;this.emit('resume');return this;},update:function(time,delta)
        {if(!this.enabled||this.bodies.size===0)
        {return;}
            var clampedDelta=Math.min(delta / 1000,this.maxStep)*this.timeScale;this.delta=clampedDelta;var i;var body;var bodies=this.bodies.entries;var len=bodies.length;var hash={};var size=this.cellSize;for(i=0;i<len;i++)
        {body=bodies[i];if(body.enabled)
        {body.update(clampedDelta);}}
            for(i=0;i<len;i++)
            {body=bodies[i];if(body&&!body.skipHash())
            {this.checkHash(body,hash,size);}}
            if(this.drawDebug)
            {var graphics=this.debugGraphic;graphics.clear();for(i=0;i<len;i++)
            {body=bodies[i];if(body&&body.willDrawDebug())
            {body.drawDebug(graphics);}}}},checkHash:function(body,hash,size)
        {var checked={};var xmin=Math.floor(body.pos.x / size);var ymin=Math.floor(body.pos.y / size);var xmax=Math.floor((body.pos.x+body.size.x)/ size)+1;var ymax=Math.floor((body.pos.y+body.size.y)/ size)+1;for(var x=xmin;x<xmax;x++)
        {for(var y=ymin;y<ymax;y++)
        {if(!hash[x])
        {hash[x]={};hash[x][y]=[body];}
        else if(!hash[x][y])
        {hash[x][y]=[body];}
        else
        {var cell=hash[x][y];for(var c=0;c<cell.length;c++)
        {if(body.touches(cell[c])&&!checked[cell[c].id])
        {checked[cell[c].id]=true;this.checkBodies(body,cell[c]);}}
            cell.push(body);}}}},checkBodies:function(bodyA,bodyB)
        {if(bodyA.collides===COLLIDES.FIXED&&bodyB.collides===COLLIDES.FIXED)
        {return;}
            if(bodyA.checkAgainst&bodyB.type)
            {bodyA.check(bodyB);}
            if(bodyB.checkAgainst&bodyA.type)
            {bodyB.check(bodyA);}
            if(bodyA.collides&&bodyB.collides&&bodyA.collides+bodyB.collides>COLLIDES.ACTIVE)
            {Solver(this,bodyA,bodyB);}},setCollidesNever:function(bodies)
        {for(var i=0;i<bodies.length;i++)
        {bodies[i].collides=COLLIDES.NEVER;}
            return this;},setLite:function(bodies)
        {for(var i=0;i<bodies.length;i++)
        {bodies[i].collides=COLLIDES.LITE;}
            return this;},setPassive:function(bodies)
        {for(var i=0;i<bodies.length;i++)
        {bodies[i].collides=COLLIDES.PASSIVE;}
            return this;},setActive:function(bodies)
        {for(var i=0;i<bodies.length;i++)
        {bodies[i].collides=COLLIDES.ACTIVE;}
            return this;},setFixed:function(bodies)
        {for(var i=0;i<bodies.length;i++)
        {bodies[i].collides=COLLIDES.FIXED;}
            return this;},setTypeNone:function(bodies)
        {for(var i=0;i<bodies.length;i++)
        {bodies[i].type=TYPE.NONE;}
            return this;},setTypeA:function(bodies)
        {for(var i=0;i<bodies.length;i++)
        {bodies[i].type=TYPE.A;}
            return this;},setTypeB:function(bodies)
        {for(var i=0;i<bodies.length;i++)
        {bodies[i].type=TYPE.B;}
            return this;},setAvsB:function(bodies)
        {for(var i=0;i<bodies.length;i++)
        {bodies[i].type=TYPE.A;bodies[i].checkAgainst=TYPE.B;}
            return this;},setBvsA:function(bodies)
        {for(var i=0;i<bodies.length;i++)
        {bodies[i].type=TYPE.B;bodies[i].checkAgainst=TYPE.A;}
            return this;},setCheckAgainstNone:function(bodies)
        {for(var i=0;i<bodies.length;i++)
        {bodies[i].checkAgainst=TYPE.NONE;}
            return this;},setCheckAgainstA:function(bodies)
        {for(var i=0;i<bodies.length;i++)
        {bodies[i].checkAgainst=TYPE.A;}
            return this;},setCheckAgainstB:function(bodies)
        {for(var i=0;i<bodies.length;i++)
        {bodies[i].checkAgainst=TYPE.B;}
            return this;},shutdown:function()
        {this.removeAllListeners();},destroy:function()
        {this.removeAllListeners();this.scene=null;this.bodies.clear();this.bodies=null;this.collisionMap=null;}});module.exports=World;}),"./physics/impact/components/Acceleration.js":(function(module,exports){var Acceleration={setAccelerationX:function(x)
        {this.accel.x=x;return this;},setAccelerationY:function(y)
        {this.accel.y=y;return this;},setAcceleration:function(x,y)
        {this.accel.x=x;this.accel.y=y;return this;}};module.exports=Acceleration;}),"./physics/impact/components/BodyScale.js":(function(module,exports){var BodyScale={setBodySize:function(width,height)
        {if(height===undefined){height=width;}
            this.body.size.x=Math.round(width);this.body.size.y=Math.round(height);return this;},setBodyScale:function(scaleX,scaleY)
        {if(scaleY===undefined){scaleY=scaleX;}
            var gameObject=this.body.gameObject;if(gameObject)
        {gameObject.setScale(scaleX,scaleY);return this.setBodySize(gameObject.width*gameObject.scaleX,gameObject.height*gameObject.scaleY);}
        else
        {return this.setBodySize(this.body.size.x*scaleX,this.body.size.y*scaleY);}}};module.exports=BodyScale;}),"./physics/impact/components/BodyType.js":(function(module,exports,__webpack_require__){var TYPE=__webpack_require__("./physics/impact/TYPE.js");var BodyType={getBodyType:function()
        {return this.body.type;},setTypeNone:function()
        {this.body.type=TYPE.NONE;return this;},setTypeA:function()
        {this.body.type=TYPE.A;return this;},setTypeB:function()
        {this.body.type=TYPE.B;return this;}};module.exports=BodyType;}),"./physics/impact/components/Bounce.js":(function(module,exports){var Bounce={setBounce:function(value)
        {this.body.bounciness=value;return this;},setMinBounceVelocity:function(value)
        {this.body.minBounceVelocity=value;return this;},bounce:{get:function()
            {return this.body.bounciness;},set:function(value)
            {this.body.bounciness=value;}}};module.exports=Bounce;}),"./physics/impact/components/CheckAgainst.js":(function(module,exports,__webpack_require__){var TYPE=__webpack_require__("./physics/impact/TYPE.js");var CheckAgainst={setAvsB:function()
        {this.setTypeA();return this.setCheckAgainstB();},setBvsA:function()
        {this.setTypeB();return this.setCheckAgainstA();},setCheckAgainstNone:function()
        {this.body.checkAgainst=TYPE.NONE;return this;},setCheckAgainstA:function()
        {this.body.checkAgainst=TYPE.A;return this;},setCheckAgainstB:function()
        {this.body.checkAgainst=TYPE.B;return this;},checkAgainst:{get:function()
            {return this.body.checkAgainst;},set:function(value)
            {this.body.checkAgainst=value;}}};module.exports=CheckAgainst;}),"./physics/impact/components/Collides.js":(function(module,exports,__webpack_require__){var COLLIDES=__webpack_require__("./physics/impact/COLLIDES.js");var Collides={_collideCallback:null,_callbackScope:null,setCollideCallback:function(callback,scope)
        {this._collideCallback=callback;if(scope)
        {this._callbackScope=scope;}
            return this;},setCollidesNever:function()
        {this.body.collides=COLLIDES.NEVER;return this;},setLiteCollision:function()
        {this.body.collides=COLLIDES.LITE;return this;},setPassiveCollision:function()
        {this.body.collides=COLLIDES.PASSIVE;return this;},setActiveCollision:function()
        {this.body.collides=COLLIDES.ACTIVE;return this;},setFixedCollision:function()
        {this.body.collides=COLLIDES.FIXED;return this;},collides:{get:function()
            {return this.body.collides;},set:function(value)
            {this.body.collides=value;}}};module.exports=Collides;}),"./physics/impact/components/Debug.js":(function(module,exports){var Debug={setDebug:function(showBody,showVelocity,bodyColor)
        {this.debugShowBody=showBody;this.debugShowVelocity=showVelocity;this.debugBodyColor=bodyColor;return this;},setDebugBodyColor:function(value)
        {this.body.debugBodyColor=value;return this;},debugShowBody:{get:function()
            {return this.body.debugShowBody;},set:function(value)
            {this.body.debugShowBody=value;}},debugShowVelocity:{get:function()
            {return this.body.debugShowVelocity;},set:function(value)
            {this.body.debugShowVelocity=value;}},debugBodyColor:{get:function()
            {return this.body.debugBodyColor;},set:function(value)
            {this.body.debugBodyColor=value;}}};module.exports=Debug;}),"./physics/impact/components/Friction.js":(function(module,exports){var Friction={setFrictionX:function(x)
        {this.friction.x=x;return this;},setFrictionY:function(y)
        {this.friction.y=y;return this;},setFriction:function(x,y)
        {this.friction.x=x;this.friction.y=y;return this;}};module.exports=Friction;}),"./physics/impact/components/Gravity.js":(function(module,exports){var Gravity={setGravity:function(value)
        {this.body.gravityFactor=value;return this;},gravity:{get:function()
            {return this.body.gravityFactor;},set:function(value)
            {this.body.gravityFactor=value;}}};module.exports=Gravity;}),"./physics/impact/components/Offset.js":(function(module,exports){var Offset={setOffset:function(x,y,width,height)
        {this.body.offset.x=x;this.body.offset.y=y;if(width)
        {this.setBodySize(width,height);}
            return this;}};module.exports=Offset;}),"./physics/impact/components/SetGameObject.js":(function(module,exports){var SetGameObject={setGameObject:function(gameObject,sync)
        {if(sync===undefined){sync=true;}
            if(gameObject)
            {this.body.gameObject=gameObject;if(sync)
            {this.syncGameObject();}}
            else
            {this.body.gameObject=null;}
            return this;},syncGameObject:function()
        {var gameObject=this.body.gameObject;if(gameObject)
        {this.setBodySize(gameObject.width*gameObject.scaleX,gameObject.height*gameObject.scaleY);}
            return this;}};module.exports=SetGameObject;}),"./physics/impact/components/Velocity.js":(function(module,exports){var Velocity={setVelocityX:function(x)
        {this.vel.x=x;return this;},setVelocityY:function(y)
        {this.vel.y=y;return this;},setVelocity:function(x,y)
        {if(y===undefined){y=x;}
            this.vel.x=x;this.vel.y=y;return this;},setMaxVelocity:function(x,y)
        {if(y===undefined){y=x;}
            this.maxVel.x=x;this.maxVel.y=y;return this;}};module.exports=Velocity;}),"./physics/impact/components/index.js":(function(module,exports,__webpack_require__){module.exports={Acceleration:__webpack_require__("./physics/impact/components/Acceleration.js"),BodyScale:__webpack_require__("./physics/impact/components/BodyScale.js"),BodyType:__webpack_require__("./physics/impact/components/BodyType.js"),Bounce:__webpack_require__("./physics/impact/components/Bounce.js"),CheckAgainst:__webpack_require__("./physics/impact/components/CheckAgainst.js"),Collides:__webpack_require__("./physics/impact/components/Collides.js"),Debug:__webpack_require__("./physics/impact/components/Debug.js"),Friction:__webpack_require__("./physics/impact/components/Friction.js"),Gravity:__webpack_require__("./physics/impact/components/Gravity.js"),Offset:__webpack_require__("./physics/impact/components/Offset.js"),SetGameObject:__webpack_require__("./physics/impact/components/SetGameObject.js"),Velocity:__webpack_require__("./physics/impact/components/Velocity.js")};}),"./physics/impact/index.js":(function(module,exports,__webpack_require__){module.exports={Body:__webpack_require__("./physics/impact/Body.js"),COLLIDES:__webpack_require__("./physics/impact/COLLIDES.js"),CollisionMap:__webpack_require__("./physics/impact/CollisionMap.js"),Factory:__webpack_require__("./physics/impact/Factory.js"),Image:__webpack_require__("./physics/impact/ImpactImage.js"),ImpactBody:__webpack_require__("./physics/impact/ImpactBody.js"),ImpactPhysics:__webpack_require__("./physics/impact/ImpactPhysics.js"),Sprite:__webpack_require__("./physics/impact/ImpactSprite.js"),TYPE:__webpack_require__("./physics/impact/TYPE.js"),World:__webpack_require__("./physics/impact/World.js")};}),"./physics/index.js":(function(module,exports,__webpack_require__){module.exports={Arcade:__webpack_require__("./physics/arcade/index.js"),Impact:__webpack_require__("./physics/impact/index.js"),Matter:__webpack_require__("./physics/matter-js/index.js")};}),"./physics/matter-js/CustomMain.js":(function(module,exports,__webpack_require__){var Matter=__webpack_require__("./physics/matter-js/lib/core/Matter.js");Matter.Body=__webpack_require__("./physics/matter-js/lib/body/Body.js");Matter.Composite=__webpack_require__("./physics/matter-js/lib/body/Composite.js");Matter.World=__webpack_require__("./physics/matter-js/lib/body/World.js");Matter.Detector=__webpack_require__("./physics/matter-js/lib/collision/Detector.js");Matter.Grid=__webpack_require__("./physics/matter-js/lib/collision/Grid.js");Matter.Pairs=__webpack_require__("./physics/matter-js/lib/collision/Pairs.js");Matter.Pair=__webpack_require__("./physics/matter-js/lib/collision/Pair.js");Matter.Query=__webpack_require__("./physics/matter-js/lib/collision/Query.js");Matter.Resolver=__webpack_require__("./physics/matter-js/lib/collision/Resolver.js");Matter.SAT=__webpack_require__("./physics/matter-js/lib/collision/SAT.js");Matter.Constraint=__webpack_require__("./physics/matter-js/lib/constraint/Constraint.js");Matter.Common=__webpack_require__("./physics/matter-js/lib/core/Common.js");Matter.Engine=__webpack_require__("./physics/matter-js/lib/core/Engine.js");Matter.Events=__webpack_require__("./physics/matter-js/lib/core/Events.js");Matter.Sleeping=__webpack_require__("./physics/matter-js/lib/core/Sleeping.js");Matter.Plugin=__webpack_require__("./physics/matter-js/lib/core/Plugin.js");Matter.Bodies=__webpack_require__("./physics/matter-js/lib/factory/Bodies.js");Matter.Composites=__webpack_require__("./physics/matter-js/lib/factory/Composites.js");Matter.Axes=__webpack_require__("./physics/matter-js/lib/geometry/Axes.js");Matter.Bounds=__webpack_require__("./physics/matter-js/lib/geometry/Bounds.js");Matter.Svg=__webpack_require__("./physics/matter-js/lib/geometry/Svg.js");Matter.Vector=__webpack_require__("./physics/matter-js/lib/geometry/Vector.js");Matter.Vertices=__webpack_require__("./physics/matter-js/lib/geometry/Vertices.js");Matter.World.add=Matter.Composite.add;Matter.World.remove=Matter.Composite.remove;Matter.World.addComposite=Matter.Composite.addComposite;Matter.World.addBody=Matter.Composite.addBody;Matter.World.addConstraint=Matter.Composite.addConstraint;Matter.World.clear=Matter.Composite.clear;module.exports=Matter;}),"./physics/matter-js/Factory.js":(function(module,exports,__webpack_require__){var Bodies=__webpack_require__("./physics/matter-js/lib/factory/Bodies.js");var Class=__webpack_require__("./utils/Class.js");var Composites=__webpack_require__("./physics/matter-js/lib/factory/Composites.js");var Constraint=__webpack_require__("./physics/matter-js/lib/constraint/Constraint.js");var MatterGameObject=__webpack_require__("./physics/matter-js/MatterGameObject.js");var MatterImage=__webpack_require__("./physics/matter-js/MatterImage.js");var MatterSprite=__webpack_require__("./physics/matter-js/MatterSprite.js");var MatterTileBody=__webpack_require__("./physics/matter-js/MatterTileBody.js");var PointerConstraint=__webpack_require__("./physics/matter-js/PointerConstraint.js");var Factory=new Class({initialize:function Factory(world)
        {this.world=world;this.scene=world.scene;this.sys=world.scene.sys;},rectangle:function(x,y,width,height,options)
        {var body=Bodies.rectangle(x,y,width,height,options);this.world.add(body);return body;},trapezoid:function(x,y,width,height,slope,options)
        {var body=Bodies.trapezoid(x,y,width,height,slope,options);this.world.add(body);return body;},circle:function(x,y,radius,options,maxSides)
        {var body=Bodies.circle(x,y,radius,options,maxSides);this.world.add(body);return body;},polygon:function(x,y,sides,radius,options)
        {var body=Bodies.polygon(x,y,sides,radius,options);this.world.add(body);return body;},fromVertices:function(x,y,vertexSets,options,flagInternal,removeCollinear,minimumArea)
        {var body=Bodies.fromVertices(x,y,vertexSets,options,flagInternal,removeCollinear,minimumArea);this.world.add(body);return body;},imageStack:function(key,frame,x,y,columns,rows,columnGap,rowGap,options)
        {if(columnGap===undefined){columnGap=0;}
            if(rowGap===undefined){rowGap=0;}
            if(options===undefined){options={};}
            var world=this.world;var displayList=this.sys.displayList;options.addToWorld=false;var stack=Composites.stack(x,y,columns,rows,columnGap,rowGap,function(x,y)
        {var image=new MatterImage(world,x,y,key,frame,options);displayList.add(image);return image.body;});world.add(stack);return stack;},stack:function(x,y,columns,rows,columnGap,rowGap,callback)
        {var stack=Composites.stack(x,y,columns,rows,columnGap,rowGap,callback);this.world.add(stack);return stack;},pyramid:function(x,y,columns,rows,columnGap,rowGap,callback)
        {var stack=Composites.pyramid(x,y,columns,rows,columnGap,rowGap,callback);this.world.add(stack);return stack;},chain:function(composite,xOffsetA,yOffsetA,xOffsetB,yOffsetB,options)
        {return Composites.chain(composite,xOffsetA,yOffsetA,xOffsetB,yOffsetB,options);},mesh:function(composite,columns,rows,crossBrace,options)
        {return Composites.mesh(composite,columns,rows,crossBrace,options);},newtonsCradle:function(x,y,number,size,length)
        {var composite=Composites.newtonsCradle(x,y,number,size,length);this.world.add(composite);return composite;},car:function(x,y,width,height,wheelSize)
        {var composite=Composites.car(x,y,width,height,wheelSize);this.world.add(composite);return composite;},softBody:function(x,y,columns,rows,columnGap,rowGap,crossBrace,particleRadius,particleOptions,constraintOptions)
        {var composite=Composites.softBody(x,y,columns,rows,columnGap,rowGap,crossBrace,particleRadius,particleOptions,constraintOptions);this.world.add(composite);return composite;},joint:function(bodyA,bodyB,length,stiffness,options)
        {return this.constraint(bodyA,bodyB,length,stiffness,options);},spring:function(bodyA,bodyB,length,stiffness,options)
        {return this.constraint(bodyA,bodyB,length,stiffness,options);},constraint:function(bodyA,bodyB,length,stiffness,options)
        {if(stiffness===undefined){stiffness=1;}
            if(options===undefined){options={};}
            options.bodyA=(bodyA.type==='body')?bodyA:bodyA.body;options.bodyB=(bodyB.type==='body')?bodyB:bodyB.body;options.length=length;options.stiffness=stiffness;var constraint=Constraint.create(options);this.world.add(constraint);return constraint;},worldConstraint:function(bodyB,length,stiffness,options)
        {if(stiffness===undefined){stiffness=1;}
            if(options===undefined){options={};}
            options.bodyB=(bodyB.type==='body')?bodyB:bodyB.body;options.length=length;options.stiffness=stiffness;var constraint=Constraint.create(options);this.world.add(constraint);return constraint;},mouseSpring:function(options)
        {return this.pointerConstraint(options);},pointerConstraint:function(options)
        {if(options===undefined){options={};}
            if(!options.hasOwnProperty('render'))
            {options.render={visible:false};}
            var pointerConstraint=new PointerConstraint(this.scene,this.world,options);this.world.add(pointerConstraint.constraint);return pointerConstraint;},image:function(x,y,key,frame,options)
        {var image=new MatterImage(this.world,x,y,key,frame,options);this.sys.displayList.add(image);return image;},tileBody:function(tile,options)
        {var tileBody=new MatterTileBody(this.world,tile,options);return tileBody;},sprite:function(x,y,key,frame,options)
        {var sprite=new MatterSprite(this.world,x,y,key,frame,options);this.sys.displayList.add(sprite);this.sys.updateList.add(sprite);return sprite;},gameObject:function(gameObject,options)
        {return MatterGameObject(this.world,gameObject,options);},destroy:function()
        {this.world=null;this.scene=null;this.sys=null;}});module.exports=Factory;}),"./physics/matter-js/MatterGameObject.js":(function(module,exports,__webpack_require__){var Components=__webpack_require__("./physics/matter-js/components/index.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var Vector2=__webpack_require__("./math/Vector2.js");function hasGetterOrSetter(def)
    {return(!!def.get&&typeof def.get==='function')||(!!def.set&&typeof def.set==='function');}
        var MatterGameObject=function(world,gameObject,options)
        {if(options===undefined){options={};}
            var x=gameObject.x;var y=gameObject.y;gameObject.body={temp:true,position:{x:x,y:y}};var mixins=[Components.Bounce,Components.Collision,Components.Force,Components.Friction,Components.Gravity,Components.Mass,Components.Sensor,Components.SetBody,Components.Sleep,Components.Static,Components.Transform,Components.Velocity];mixins.forEach(function(mixin)
        {for(var key in mixin)
        {if(hasGetterOrSetter(mixin[key]))
        {Object.defineProperty(gameObject,key,{get:mixin[key].get,set:mixin[key].set});}
        else
        {Object.defineProperty(gameObject,key,{value:mixin[key]});}}});gameObject.world=world;gameObject._tempVec2=new Vector2(x,y);var shape=GetFastValue(options,'shape',null);if(!shape)
        {shape='rectangle';}
            gameObject.setBody(shape,options);return gameObject;};module.exports=MatterGameObject;}),"./physics/matter-js/MatterImage.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Components=__webpack_require__("./physics/matter-js/components/index.js");var GameObject=__webpack_require__("./gameobjects/GameObject.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var Image=__webpack_require__("./gameobjects/image/Image.js");var Pipeline=__webpack_require__("./gameobjects/components/Pipeline.js");var Vector2=__webpack_require__("./math/Vector2.js");var MatterImage=new Class({Extends:Image,Mixins:[Components.Bounce,Components.Collision,Components.Force,Components.Friction,Components.Gravity,Components.Mass,Components.Sensor,Components.SetBody,Components.Sleep,Components.Static,Components.Transform,Components.Velocity,Pipeline],initialize:function MatterImage(world,x,y,texture,frame,options)
        {GameObject.call(this,world.scene,'Image');this.setTexture(texture,frame);this.setSizeToFrame();this.setOrigin();this.world=world;this._tempVec2=new Vector2(x,y);var shape=GetFastValue(options,'shape',null);if(shape)
        {this.setBody(shape,options);}
        else
        {this.setRectangle(this.width,this.height,options);}
            this.setPosition(x,y);this.initPipeline('TextureTintPipeline');}});module.exports=MatterImage;}),"./physics/matter-js/MatterPhysics.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Factory=__webpack_require__("./physics/matter-js/Factory.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var GetValue=__webpack_require__("./utils/object/GetValue.js");var MatterAttractors=__webpack_require__("./physics/matter-js/lib/plugins/MatterAttractors.js");var MatterLib=__webpack_require__("./physics/matter-js/lib/core/Matter.js");var MatterWrap=__webpack_require__("./physics/matter-js/lib/plugins/MatterWrap.js");var Merge=__webpack_require__("./utils/object/Merge.js");var Plugin=__webpack_require__("./physics/matter-js/lib/core/Plugin.js");var PluginCache=__webpack_require__("./plugins/PluginCache.js");var World=__webpack_require__("./physics/matter-js/World.js");var Vertices=__webpack_require__("./physics/matter-js/lib/geometry/Vertices.js");var MatterPhysics=new Class({initialize:function MatterPhysics(scene)
        {this.scene=scene;this.systems=scene.sys;this.config=this.getConfig();this.world;this.add;this.verts=Vertices;if(GetValue(this.config,'plugins.attractors',false))
        {Plugin.register(MatterAttractors);Plugin.use(MatterLib,MatterAttractors);}
            if(GetValue(this.config,'plugins.wrap',false))
            {Plugin.register(MatterWrap);Plugin.use(MatterLib,MatterWrap);}
            scene.sys.events.once('boot',this.boot,this);scene.sys.events.on('start',this.start,this);},boot:function()
        {this.world=new World(this.scene,this.config);this.add=new Factory(this.world);this.systems.events.once('destroy',this.destroy,this);},start:function()
        {if(!this.world)
        {this.world=new World(this.scene,this.config);this.add=new Factory(this.world);}
            var eventEmitter=this.systems.events;eventEmitter.on('update',this.world.update,this.world);eventEmitter.on('postupdate',this.world.postUpdate,this.world);eventEmitter.once('shutdown',this.shutdown,this);},getConfig:function()
        {var gameConfig=this.systems.game.config.physics;var sceneConfig=this.systems.settings.physics;var config=Merge(GetFastValue(sceneConfig,'matter',{}),GetFastValue(gameConfig,'matter',{}));return config;},enableAttractorPlugin:function()
        {Plugin.register(MatterAttractors);Plugin.use(MatterLib,MatterAttractors);return this;},enableWrapPlugin:function()
        {Plugin.register(MatterWrap);Plugin.use(MatterLib,MatterWrap);return this;},pause:function()
        {return this.world.pause();},resume:function()
        {return this.world.resume();},set60Hz:function()
        {this.world.getDelta=this.world.update60Hz;this.world.autoUpdate=true;return this;},set30Hz:function()
        {this.world.getDelta=this.world.update30Hz;this.world.autoUpdate=true;return this;},step:function(delta,correction)
        {this.world.step(delta,correction);},shutdown:function()
        {var eventEmitter=this.systems.events;eventEmitter.off('update',this.world.update,this.world);eventEmitter.off('postupdate',this.world.postUpdate,this.world);eventEmitter.off('shutdown',this.shutdown,this);this.add.destroy();this.world.destroy();this.add=null;this.world=null;},destroy:function()
        {this.shutdown();this.scene.sys.events.off('start',this.start,this);this.scene=null;this.systems=null;}});PluginCache.register('MatterPhysics',MatterPhysics,'matterPhysics');module.exports=MatterPhysics;}),"./physics/matter-js/MatterSprite.js":(function(module,exports,__webpack_require__){var AnimationComponent=__webpack_require__("./gameobjects/components/Animation.js");var Class=__webpack_require__("./utils/Class.js");var Components=__webpack_require__("./physics/matter-js/components/index.js");var GameObject=__webpack_require__("./gameobjects/GameObject.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var Pipeline=__webpack_require__("./gameobjects/components/Pipeline.js");var Sprite=__webpack_require__("./gameobjects/sprite/Sprite.js");var Vector2=__webpack_require__("./math/Vector2.js");var MatterSprite=new Class({Extends:Sprite,Mixins:[Components.Bounce,Components.Collision,Components.Force,Components.Friction,Components.Gravity,Components.Mass,Components.Sensor,Components.SetBody,Components.Sleep,Components.Static,Components.Transform,Components.Velocity,Pipeline],initialize:function MatterSprite(world,x,y,texture,frame,options)
        {GameObject.call(this,world.scene,'Sprite');this.anims=new AnimationComponent(this);this.setTexture(texture,frame);this.setSizeToFrame();this.setOrigin();this.world=world;this._tempVec2=new Vector2(x,y);var shape=GetFastValue(options,'shape',null);if(shape)
        {this.setBody(shape,options);}
        else
        {this.setRectangle(this.width,this.height,options);}
            this.setPosition(x,y);this.initPipeline('TextureTintPipeline');}});module.exports=MatterSprite;}),"./physics/matter-js/MatterTileBody.js":(function(module,exports,__webpack_require__){var Bodies=__webpack_require__("./physics/matter-js/lib/factory/Bodies.js");var Body=__webpack_require__("./physics/matter-js/lib/body/Body.js");var Class=__webpack_require__("./utils/Class.js");var Components=__webpack_require__("./physics/matter-js/components/index.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var HasValue=__webpack_require__("./utils/object/HasValue.js");var Vertices=__webpack_require__("./physics/matter-js/lib/geometry/Vertices.js");var MatterTileBody=new Class({Mixins:[Components.Bounce,Components.Collision,Components.Friction,Components.Gravity,Components.Mass,Components.Sensor,Components.Sleep,Components.Static],initialize:function MatterTileBody(world,tile,options)
        {this.tile=tile;this.world=world;if(tile.physics.matterBody)
        {tile.physics.matterBody.destroy();}
            tile.physics.matterBody=this;var body=GetFastValue(options,'body',null);var addToWorld=GetFastValue(options,'addToWorld',true);if(!body)
        {var collisionGroup=tile.getCollisionGroup();var collisionObjects=GetFastValue(collisionGroup,'objects',[]);if(collisionObjects.length>0)
        {this.setFromTileCollision(options);}
        else
        {this.setFromTileRectangle(options);}}
        else
        {this.setBody(body,addToWorld);}},setFromTileRectangle:function(options)
        {if(options===undefined){options={};}
            if(!HasValue(options,'isStatic')){options.isStatic=true;}
            if(!HasValue(options,'addToWorld')){options.addToWorld=true;}
            var bounds=this.tile.getBounds();var cx=bounds.x+(bounds.width / 2);var cy=bounds.y+(bounds.height / 2);var body=Bodies.rectangle(cx,cy,bounds.width,bounds.height,options);this.setBody(body,options.addToWorld);return this;},setFromTileCollision:function(options)
        {if(options===undefined){options={};}
            if(!HasValue(options,'isStatic')){options.isStatic=true;}
            if(!HasValue(options,'addToWorld')){options.addToWorld=true;}
            var sx=this.tile.tilemapLayer.scaleX;var sy=this.tile.tilemapLayer.scaleY;var tileX=this.tile.getLeft();var tileY=this.tile.getTop();var collisionGroup=this.tile.getCollisionGroup();var collisionObjects=GetFastValue(collisionGroup,'objects',[]);var parts=[];for(var i=0;i<collisionObjects.length;i++)
        {var object=collisionObjects[i];var ox=tileX+(object.x*sx);var oy=tileY+(object.y*sy);var ow=object.width*sx;var oh=object.height*sy;var body=null;if(object.rectangle)
        {body=Bodies.rectangle(ox+ow / 2,oy+oh / 2,ow,oh,options);}
        else if(object.ellipse)
        {body=Bodies.circle(ox+ow / 2,oy+oh / 2,ow / 2,options);}
        else if(object.polygon||object.polyline)
        {var originalPoints=object.polygon?object.polygon:object.polyline;var points=originalPoints.map(function(p)
        {return{x:p.x*sx,y:p.y*sy};});var vertices=Vertices.create(points);var center=Vertices.centre(vertices);ox+=center.x;oy+=center.y;body=Bodies.fromVertices(ox,oy,vertices,options);}
            if(body)
            {parts.push(body);}}
            if(parts.length===1)
            {this.setBody(parts[0],options.addToWorld);}
            else if(parts.length>1)
            {options.parts=parts;this.setBody(Body.create(options),options.addToWorld);}
            return this;},setBody:function(body,addToWorld)
        {if(addToWorld===undefined){addToWorld=true;}
            if(this.body)
            {this.removeBody();}
            this.body=body;this.body.gameObject=this;if(addToWorld)
        {this.world.add(this.body);}
            return this;},removeBody:function()
        {if(this.body)
        {this.world.remove(this.body);this.body.gameObject=undefined;this.body=undefined;}
            return this;},destroy:function()
        {this.removeBody();this.tile.physics.matterBody=undefined;}});module.exports=MatterTileBody;}),"./physics/matter-js/PhysicsEditorParser.js":(function(module,exports,__webpack_require__){var Bodies=__webpack_require__("./physics/matter-js/lib/factory/Bodies.js");var Body=__webpack_require__("./physics/matter-js/lib/body/Body.js");var Bounds=__webpack_require__("./physics/matter-js/lib/geometry/Bounds.js");var Common=__webpack_require__("./physics/matter-js/lib/core/Common.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var Vector=__webpack_require__("./physics/matter-js/lib/geometry/Vector.js");var Vertices=__webpack_require__("./physics/matter-js/lib/geometry/Vertices.js");var PhysicsEditorParser={parseBody:function(x,y,w,h,config)
        {var fixtureConfigs=GetFastValue(config,'fixtures',[]);var fixtures=[];for(var fc=0;fc<fixtureConfigs.length;fc++)
        {var fixtureParts=this.parseFixture(fixtureConfigs[fc]);for(var i=0;i<fixtureParts.length;i++)
        {fixtures.push(fixtureParts[i]);}}
            var matterConfig=Common.extend({},false,config);delete matterConfig.fixtures;delete matterConfig.type;var body=Body.create(matterConfig);Body.setParts(body,fixtures);body.render.sprite.xOffset=body.position.x / w;body.render.sprite.yOffset=body.position.y / h;Body.setPosition(body,{x:x,y:y});return body;},parseFixture:function(fixtureConfig)
        {var matterConfig=Common.extend({},false,fixtureConfig);delete matterConfig.circle;delete matterConfig.vertices;var fixtures;if(fixtureConfig.circle)
        {var x=GetFastValue(fixtureConfig.circle,'x');var y=GetFastValue(fixtureConfig.circle,'y');var r=GetFastValue(fixtureConfig.circle,'radius');fixtures=[Bodies.circle(x,y,r,matterConfig)];}
        else if(fixtureConfig.vertices)
        {fixtures=this.parseVertices(fixtureConfig.vertices,matterConfig);}
            return fixtures;},parseVertices:function(vertexSets,options)
        {var i,j,k,v,z;var parts=[];options=options||{};for(v=0;v<vertexSets.length;v+=1)
        {parts.push(Body.create(Common.extend({position:Vertices.centre(vertexSets[v]),vertices:vertexSets[v]},options)));}
            var coincidentMaxDist=5;for(i=0;i<parts.length;i++)
        {var partA=parts[i];for(j=i+1;j<parts.length;j++)
        {var partB=parts[j];if(Bounds.overlaps(partA.bounds,partB.bounds))
        {var pav=partA.vertices,pbv=partB.vertices;for(k=0;k<partA.vertices.length;k++)
        {for(z=0;z<partB.vertices.length;z++)
        {var da=Vector.magnitudeSquared(Vector.sub(pav[(k+1)%pav.length],pbv[z])),db=Vector.magnitudeSquared(Vector.sub(pav[k],pbv[(z+1)%pbv.length]));if(da<coincidentMaxDist&&db<coincidentMaxDist)
        {pav[k].isInternal=true;pbv[z].isInternal=true;}}}}}}
            return parts;}};module.exports=PhysicsEditorParser;}),"./physics/matter-js/PointerConstraint.js":(function(module,exports,__webpack_require__){var Bounds=__webpack_require__("./physics/matter-js/lib/geometry/Bounds.js");var Class=__webpack_require__("./utils/Class.js");var Composite=__webpack_require__("./physics/matter-js/lib/body/Composite.js");var Constraint=__webpack_require__("./physics/matter-js/lib/constraint/Constraint.js");var Detector=__webpack_require__("./physics/matter-js/lib/collision/Detector.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var Merge=__webpack_require__("./utils/object/Merge.js");var Sleeping=__webpack_require__("./physics/matter-js/lib/core/Sleeping.js");var Vector2=__webpack_require__("./math/Vector2.js");var Vertices=__webpack_require__("./physics/matter-js/lib/geometry/Vertices.js");var PointerConstraint=new Class({initialize:function PointerConstraint(scene,world,options)
        {if(options===undefined){options={};}
            var defaults={label:'Pointer Constraint',pointA:{x:0,y:0},pointB:{x:0,y:0},damping:0,length:0.01,stiffness:0.1,angularStiffness:1,collisionFilter:{category:0x0001,mask:0xFFFFFFFF,group:0}};this.scene=scene;this.world=world;var camera=GetFastValue(options,'camera',null);if(!camera)
        {this.camera=scene.sys.cameras.main;}
        else
        {this.camera=camera;delete options.camera;}
            this.pointer=null;this.active=true;this.position=new Vector2();this.constraint=Constraint.create(Merge(options,defaults));this.world.on('beforeupdate',this.update,this);scene.sys.input.on('pointerdown',this.onDown,this);scene.sys.input.on('pointerup',this.onUp,this);},onDown:function(pointer)
        {this.pointer=pointer;},onUp:function()
        {this.pointer=null;},getBodyPart:function(body,position)
        {var constraint=this.constraint;var start=(body.parts.length>1)?1:0;for(var i=start;i<body.parts.length;i++)
        {var part=body.parts[i];if(Vertices.contains(part.vertices,position))
        {constraint.bodyB=body;constraint.pointA.x=position.x;constraint.pointA.y=position.y;constraint.pointB.x=position.x-body.position.x;constraint.pointB.y=position.y-body.position.y;constraint.angleB=body.angle;Sleeping.set(body,false);return true;}}
            return false;},update:function()
        {if(!this.active)
        {return;}
            var pointer=this.pointer;var constraint=this.constraint;if(!pointer)
        {if(constraint.bodyB)
        {constraint.bodyB=null;}}
        else
        {var pos=this.position;this.camera.getWorldPoint(pointer.x,pointer.y,pos);if(constraint.bodyB)
        {Sleeping.set(constraint.bodyB,false);constraint.pointA.x=pos.x;constraint.pointA.y=pos.y;}
        else
        {var bodies=Composite.allBodies(this.world.localWorld);for(var i=0;i<bodies.length;i++)
        {var body=bodies[i];if(!body.ignorePointer&&Bounds.contains(body.bounds,pos)&&Detector.canCollide(body.collisionFilter,constraint.collisionFilter))
        {if(this.getBodyPart(body,pos))
        {break;}}}}}},destroy:function()
        {this.world.removeConstraint(this.constraint);this.constraint=null;this.world.off('beforeupdate',this.update);this.scene.sys.input.off('pointerdown',this.onDown,this);this.scene.sys.input.off('pointerup',this.onUp,this);}});module.exports=PointerConstraint;}),"./physics/matter-js/World.js":(function(module,exports,__webpack_require__){var Bodies=__webpack_require__("./physics/matter-js/lib/factory/Bodies.js");var Class=__webpack_require__("./utils/Class.js");var Common=__webpack_require__("./physics/matter-js/lib/core/Common.js");var Composite=__webpack_require__("./physics/matter-js/lib/body/Composite.js");var Engine=__webpack_require__("./physics/matter-js/lib/core/Engine.js");var EventEmitter=__webpack_require__("../node_modules/eventemitter3/index.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var GetValue=__webpack_require__("./utils/object/GetValue.js");var MatterBody=__webpack_require__("./physics/matter-js/lib/body/Body.js");var MatterEvents=__webpack_require__("./physics/matter-js/lib/core/Events.js");var MatterTileBody=__webpack_require__("./physics/matter-js/MatterTileBody.js");var MatterWorld=__webpack_require__("./physics/matter-js/lib/body/World.js");var Vector=__webpack_require__("./physics/matter-js/lib/geometry/Vector.js");var World=new Class({Extends:EventEmitter,initialize:function World(scene,config)
        {EventEmitter.call(this);this.scene=scene;this.engine=Engine.create(config);this.localWorld=this.engine.world;var gravity=GetValue(config,'gravity',null);if(gravity)
        {this.setGravity(gravity.x,gravity.y,gravity.scale);}
            this.walls={left:null,right:null,top:null,bottom:null};if(GetFastValue(config,'setBounds',false))
        {var boundsConfig=config['setBounds'];if(typeof boundsConfig==='boolean')
        {this.setBounds();}
        else
        {var x=GetFastValue(boundsConfig,'x',0);var y=GetFastValue(boundsConfig,'y',0);var width=GetFastValue(boundsConfig,'width',scene.sys.scale.width);var height=GetFastValue(boundsConfig,'height',scene.sys.scale.height);var thickness=GetFastValue(boundsConfig,'thickness',64);var left=GetFastValue(boundsConfig,'left',true);var right=GetFastValue(boundsConfig,'right',true);var top=GetFastValue(boundsConfig,'top',true);var bottom=GetFastValue(boundsConfig,'bottom',true);this.setBounds(x,y,width,height,thickness,left,right,top,bottom);}}
            this.enabled=GetValue(config,'enabled',true);this.correction=GetValue(config,'correction',1);this.getDelta=GetValue(config,'getDelta',this.update60Hz);this.autoUpdate=GetValue(config,'autoUpdate',true);this.drawDebug=GetValue(config,'debug',false);this.debugGraphic;this.defaults={debugShowBody:GetFastValue(config,'debugShowBody',true),debugShowStaticBody:GetFastValue(config,'debugShowStaticBody',true),debugShowVelocity:GetFastValue(config,'debugShowVelocity',true),bodyDebugColor:GetFastValue(config,'debugBodyColor',0xff00ff),bodyDebugFillColor:GetFastValue(config,'bodyDebugFillColor',0xe3a7e3),staticBodyDebugColor:GetFastValue(config,'debugBodyColor',0x0000ff),velocityDebugColor:GetFastValue(config,'debugVelocityColor',0x00ff00),debugShowJoint:GetFastValue(config,'debugShowJoint',true),jointDebugColor:GetFastValue(config,'debugJointColor',0x000000),debugWireframes:GetFastValue(config,'debugWireframes',true),debugShowInternalEdges:GetFastValue(config,'debugShowInternalEdges',false),debugShowConvexHulls:GetFastValue(config,'debugShowConvexHulls',false),debugConvexHullColor:GetFastValue(config,'debugConvexHullColor',0xaaaaaa),debugShowSleeping:GetFastValue(config,'debugShowSleeping',false)};if(this.drawDebug)
        {this.createDebugGraphic();}
            this.setEventsProxy();},setEventsProxy:function()
        {var _this=this;var engine=this.engine;MatterEvents.on(engine,'beforeUpdate',function(event)
        {_this.emit('beforeupdate',event);});MatterEvents.on(engine,'afterUpdate',function(event)
        {_this.emit('afterupdate',event);});MatterEvents.on(engine,'collisionStart',function(event)
        {var pairs=event.pairs;var bodyA;var bodyB;if(pairs.length>0)
        {bodyA=pairs[0].bodyA;bodyB=pairs[0].bodyB;}
            _this.emit('collisionstart',event,bodyA,bodyB);});MatterEvents.on(engine,'collisionActive',function(event)
        {var pairs=event.pairs;var bodyA;var bodyB;if(pairs.length>0)
        {bodyA=pairs[0].bodyA;bodyB=pairs[0].bodyB;}
            _this.emit('collisionactive',event,bodyA,bodyB);});MatterEvents.on(engine,'collisionEnd',function(event)
        {var pairs=event.pairs;var bodyA;var bodyB;if(pairs.length>0)
        {bodyA=pairs[0].bodyA;bodyB=pairs[0].bodyB;}
            _this.emit('collisionend',event,bodyA,bodyB);});},setBounds:function(x,y,width,height,thickness,left,right,top,bottom)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            if(width===undefined){width=this.scene.sys.scale.width;}
            if(height===undefined){height=this.scene.sys.scale.height;}
            if(thickness===undefined){thickness=128;}
            if(left===undefined){left=true;}
            if(right===undefined){right=true;}
            if(top===undefined){top=true;}
            if(bottom===undefined){bottom=true;}
            this.updateWall(left,'left',x-thickness,y,thickness,height);this.updateWall(right,'right',x+width,y,thickness,height);this.updateWall(top,'top',x,y-thickness,width,thickness);this.updateWall(bottom,'bottom',x,y+height,width,thickness);return this;},updateWall:function(add,position,x,y,width,height)
        {var wall=this.walls[position];if(add)
        {if(wall)
        {MatterWorld.remove(this.localWorld,wall);}
            x+=(width / 2);y+=(height / 2);this.walls[position]=this.create(x,y,width,height,{isStatic:true,friction:0,frictionStatic:0});}
        else
        {if(wall)
        {MatterWorld.remove(this.localWorld,wall);}
            this.walls[position]=null;}},createDebugGraphic:function()
        {var graphic=this.scene.sys.add.graphics({x:0,y:0});graphic.setDepth(Number.MAX_VALUE);this.debugGraphic=graphic;this.drawDebug=true;return graphic;},disableGravity:function()
        {this.localWorld.gravity.x=0;this.localWorld.gravity.y=0;this.localWorld.gravity.scale=0;return this;},setGravity:function(x,y,scale)
        {if(x===undefined){x=0;}
            if(y===undefined){y=1;}
            this.localWorld.gravity.x=x;this.localWorld.gravity.y=y;if(scale!==undefined)
        {this.localWorld.gravity.scale=scale;}
            return this;},create:function(x,y,width,height,options)
        {var body=Bodies.rectangle(x,y,width,height,options);MatterWorld.add(this.localWorld,body);return body;},add:function(object)
        {MatterWorld.add(this.localWorld,object);return this;},remove:function(object,deep)
        {var body=(object.body)?object.body:object;Composite.removeBody(this.localWorld,body,deep);return this;},removeConstraint:function(constraint,deep)
        {Composite.remove(this.localWorld,constraint,deep);return this;},convertTilemapLayer:function(tilemapLayer,options)
        {var layerData=tilemapLayer.layer;var tiles=tilemapLayer.getTilesWithin(0,0,layerData.width,layerData.height,{isColliding:true});this.convertTiles(tiles,options);return this;},convertTiles:function(tiles,options)
        {if(tiles.length===0)
        {return this;}
            for(var i=0;i<tiles.length;i++)
            {new MatterTileBody(this,tiles[i],options);}
            return this;},nextGroup:function(isNonColliding)
        {return MatterBody.nextGroup(isNonColliding);},nextCategory:function()
        {return MatterBody.nextCategory();},pause:function()
        {this.enabled=false;this.emit('pause');return this;},resume:function()
        {this.enabled=true;this.emit('resume');return this;},update:function(time,delta)
        {if(this.enabled&&this.autoUpdate)
        {Engine.update(this.engine,this.getDelta(time,delta),this.correction);}},step:function(delta,correction)
        {Engine.update(this.engine,delta,correction);},update60Hz:function()
        {return 1000 / 60;},update30Hz:function()
        {return 1000 / 30;},postUpdate:function()
        {if(!this.drawDebug)
        {return;}
            this.debugGraphic.clear();var bodies=Composite.allBodies(this.localWorld);if(this.defaults.debugWireframes)
        {if(this.defaults.debugShowConvexHulls)
        {this.renderConvexHulls(bodies);}
            this.renderWireframes(bodies);}
        else
        {this.renderBodies(bodies);}
            if(this.defaults.debugShowJoint)
            {this.renderJoints();}},renderConvexHulls:function(bodies)
        {var graphics=this.debugGraphic;graphics.lineStyle(1,this.defaults.debugConvexHullColor);graphics.beginPath();for(var i=0;i<bodies.length;i++)
        {var body=bodies[i];if(!body.render.visible||body.parts.length===1)
        {continue;}
            graphics.moveTo(body.vertices[0].x,body.vertices[0].y);for(var j=1;j<body.vertices.length;j++)
        {graphics.lineTo(body.vertices[j].x,body.vertices[j].y);}
            graphics.lineTo(body.vertices[0].x,body.vertices[0].y);}
            graphics.strokePath();},renderWireframes:function(bodies)
        {var graphics=this.debugGraphic;var showInternalEdges=this.defaults.debugShowInternalEdges;graphics.lineStyle(1,this.defaults.bodyDebugColor);graphics.beginPath();for(var i=0;i<bodies.length;i++)
        {var body=bodies[i];if(!body.render.visible)
        {continue;}
            for(var k=(body.parts.length>1)?1:0;k<body.parts.length;k++)
            {var part=body.parts[k];var vertLength=part.vertices.length;graphics.moveTo(part.vertices[0].x,part.vertices[0].y);for(var j=1;j<vertLength;j++)
            {if(!part.vertices[j-1].isInternal||showInternalEdges)
            {graphics.lineTo(part.vertices[j].x,part.vertices[j].y);}
            else
            {graphics.moveTo(part.vertices[j].x,part.vertices[j].y);}
                if(part.vertices[j].isInternal&&!showInternalEdges)
                {graphics.moveTo(part.vertices[(j+1)%vertLength].x,part.vertices[(j+1)%vertLength].y);}}
                graphics.lineTo(part.vertices[0].x,part.vertices[0].y);}}
            graphics.strokePath();},renderBodies:function(bodies)
        {var graphics=this.debugGraphic;var showInternalEdges=this.defaults.debugShowInternalEdges||!this.defaults.debugWireframes;var showSleeping=this.defaults.debugShowSleeping;var wireframes=this.defaults.debugWireframes;var body;var part;var i;var k;for(i=0;i<bodies.length;i++)
        {body=bodies[i];if(!body.render.visible)
        {continue;}
            for(k=body.parts.length>1?1:0;k<body.parts.length;k++)
            {part=body.parts[k];if(!part.render.visible)
            {continue;}
                if(showSleeping&&body.isSleeping)
                {graphics.lineStyle(1,this.defaults.bodyDebugColor,0.5*part.render.opacity);graphics.fillStyle(this.defaults.bodyDebugColor,0.5*part.render.opacity);}
                else
                {graphics.lineStyle(1,this.defaults.bodyDebugColor,part.render.opacity);graphics.fillStyle(this.defaults.bodyDebugColor,part.render.opacity);}
                if(part.circleRadius)
                {graphics.beginPath();graphics.arc(part.position.x,part.position.y,part.circleRadius,0,2*Math.PI);}
                else
                {graphics.beginPath();graphics.moveTo(part.vertices[0].x,part.vertices[0].y);var vertLength=part.vertices.length;for(var j=1;j<vertLength;j++)
                {if(!part.vertices[j-1].isInternal||showInternalEdges)
                {graphics.lineTo(part.vertices[j].x,part.vertices[j].y);}
                else
                {graphics.moveTo(part.vertices[j].x,part.vertices[j].y);}
                    if(part.vertices[j].isInternal&&!showInternalEdges)
                    {graphics.moveTo(part.vertices[(j+1)%part.vertices.length].x,part.vertices[(j+1)%part.vertices.length].y);}}
                    graphics.lineTo(part.vertices[0].x,part.vertices[0].y);graphics.closePath();}
                if(!wireframes)
                {graphics.fillPath();}
                else
                {graphics.strokePath();}}}},renderJoints:function()
        {var graphics=this.debugGraphic;graphics.lineStyle(2,this.defaults.jointDebugColor);var constraints=Composite.allConstraints(this.localWorld);for(var i=0;i<constraints.length;i++)
        {var constraint=constraints[i];if(!constraint.render.visible||!constraint.pointA||!constraint.pointB)
        {continue;}
            if(constraint.render.lineWidth)
            {graphics.lineStyle(constraint.render.lineWidth,Common.colorToNumber(constraint.render.strokeStyle));}
            var bodyA=constraint.bodyA;var bodyB=constraint.bodyB;var start;var end;if(bodyA)
        {start=Vector.add(bodyA.position,constraint.pointA);}
        else
        {start=constraint.pointA;}
            if(constraint.render.type==='pin')
            {graphics.beginPath();graphics.arc(start.x,start.y,3,0,2*Math.PI);graphics.closePath();}
            else
            {if(bodyB)
            {end=Vector.add(bodyB.position,constraint.pointB);}
            else
            {end=constraint.pointB;}
                graphics.beginPath();graphics.moveTo(start.x,start.y);if(constraint.render.type==='spring')
            {var delta=Vector.sub(end,start);var normal=Vector.perp(Vector.normalise(delta));var coils=Math.ceil(Common.clamp(constraint.length / 5,12,20));var offset;for(var j=1;j<coils;j+=1)
            {offset=(j%2===0)?1:-1;graphics.lineTo(start.x+delta.x*(j / coils)+normal.x*offset*4,start.y+delta.y*(j / coils)+normal.y*offset*4);}}
                graphics.lineTo(end.x,end.y);}
            if(constraint.render.lineWidth)
            {graphics.strokePath();}
            if(constraint.render.anchors)
            {graphics.fillStyle(Common.colorToNumber(constraint.render.strokeStyle));graphics.beginPath();graphics.arc(start.x,start.y,6,0,2*Math.PI);graphics.arc(end.x,end.y,6,0,2*Math.PI);graphics.closePath();graphics.fillPath();}}},fromPath:function(path,points)
        {if(points===undefined){points=[];}
            var pathPattern=/L?\s*([\-\d\.e]+)[\s,]*([\-\d\.e]+)*/ig;path.replace(pathPattern,function(match,x,y)
        {points.push({x:parseFloat(x),y:parseFloat(y)});});return points;},shutdown:function()
        {MatterEvents.off(this.engine);this.removeAllListeners();MatterWorld.clear(this.localWorld,false);Engine.clear(this.engine);if(this.drawDebug)
        {this.debugGraphic.destroy();}},destroy:function()
        {this.shutdown();}});module.exports=World;}),"./physics/matter-js/components/Bounce.js":(function(module,exports){var Bounce={setBounce:function(value)
        {this.body.restitution=value;return this;}};module.exports=Bounce;}),"./physics/matter-js/components/Collision.js":(function(module,exports){var Collision={setCollisionCategory:function(value)
        {this.body.collisionFilter.category=value;return this;},setCollisionGroup:function(value)
        {this.body.collisionFilter.group=value;return this;},setCollidesWith:function(categories)
        {var flags=0;if(!Array.isArray(categories))
        {flags=categories;}
        else
        {for(var i=0;i<categories.length;i++)
        {flags|=categories[i];}}
            this.body.collisionFilter.mask=flags;return this;}};module.exports=Collision;}),"./physics/matter-js/components/Force.js":(function(module,exports,__webpack_require__){var Body=__webpack_require__("./physics/matter-js/lib/body/Body.js");var Force={applyForce:function(force)
        {this._tempVec2.set(this.body.position.x,this.body.position.y);Body.applyForce(this.body,this._tempVec2,force);return this;},applyForceFrom:function(position,force)
        {Body.applyForce(this.body,position,force);return this;},thrust:function(speed)
        {var angle=this.body.angle;this._tempVec2.set(speed*Math.cos(angle),speed*Math.sin(angle));Body.applyForce(this.body,{x:this.body.position.x,y:this.body.position.y},this._tempVec2);return this;},thrustLeft:function(speed)
        {var angle=this.body.angle-Math.PI / 2;this._tempVec2.set(speed*Math.cos(angle),speed*Math.sin(angle));Body.applyForce(this.body,{x:this.body.position.x,y:this.body.position.y},this._tempVec2);return this;},thrustRight:function(speed)
        {var angle=this.body.angle+Math.PI / 2;this._tempVec2.set(speed*Math.cos(angle),speed*Math.sin(angle));Body.applyForce(this.body,{x:this.body.position.x,y:this.body.position.y},this._tempVec2);return this;},thrustBack:function(speed)
        {var angle=this.body.angle-Math.PI;this._tempVec2.set(speed*Math.cos(angle),speed*Math.sin(angle));Body.applyForce(this.body,{x:this.body.position.x,y:this.body.position.y},this._tempVec2);return this;}};module.exports=Force;}),"./physics/matter-js/components/Friction.js":(function(module,exports){var Friction={setFriction:function(value,air,fstatic)
        {this.body.friction=value;if(air!==undefined)
        {this.body.frictionAir=air;}
            if(fstatic!==undefined)
            {this.body.frictionStatic=fstatic;}
            return this;},setFrictionAir:function(value)
        {this.body.frictionAir=value;return this;},setFrictionStatic:function(value)
        {this.body.frictionStatic=value;return this;}};module.exports=Friction;}),"./physics/matter-js/components/Gravity.js":(function(module,exports){var Gravity={setIgnoreGravity:function(value)
        {this.body.ignoreGravity=value;return this;}};module.exports=Gravity;}),"./physics/matter-js/components/Mass.js":(function(module,exports,__webpack_require__){var Body=__webpack_require__("./physics/matter-js/lib/body/Body.js");var Vector2=__webpack_require__("./math/Vector2.js");var Mass={setMass:function(value)
        {Body.setMass(this.body,value);return this;},setDensity:function(value)
        {Body.setDensity(this.body,value);return this;},centerOfMass:{get:function()
            {return new Vector2(this.body.render.sprite.xOffset*this.width,this.body.render.sprite.yOffset*this.height);}}};module.exports=Mass;}),"./physics/matter-js/components/Sensor.js":(function(module,exports){var Sensor={setSensor:function(value)
        {this.body.isSensor=value;return this;},isSensor:function()
        {return this.body.isSensor;}};module.exports=Sensor;}),"./physics/matter-js/components/SetBody.js":(function(module,exports,__webpack_require__){var Bodies=__webpack_require__("./physics/matter-js/lib/factory/Bodies.js");var Body=__webpack_require__("./physics/matter-js/lib/body/Body.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var PhysicsEditorParser=__webpack_require__("./physics/matter-js/PhysicsEditorParser.js");var Vertices=__webpack_require__("./physics/matter-js/lib/geometry/Vertices.js");var SetBody={setRectangle:function(width,height,options)
        {return this.setBody({type:'rectangle',width:width,height:height},options);},setCircle:function(radius,options)
        {return this.setBody({type:'circle',radius:radius},options);},setPolygon:function(radius,sides,options)
        {return this.setBody({type:'polygon',sides:sides,radius:radius},options);},setTrapezoid:function(width,height,slope,options)
        {return this.setBody({type:'trapezoid',width:width,height:height,slope:slope},options);},setExistingBody:function(body,addToWorld)
        {if(addToWorld===undefined)
        {addToWorld=true;}
            if(this.body)
            {this.world.remove(this.body);}
            this.body=body;for(var i=0;i<body.parts.length;i++)
        {body.parts[i].gameObject=this;}
            var _this=this;body.destroy=function destroy()
        {_this.world.remove(_this.body);_this.body.gameObject=null;};if(addToWorld)
        {this.world.add(body);}
            if(this._originComponent)
            {this.setOrigin(body.render.sprite.xOffset,body.render.sprite.yOffset);}
            return this;},setBody:function(config,options)
        {if(!config)
        {return this;}
            var body;if(typeof config==='string')
        {config={type:config};}
            var shapeType=GetFastValue(config,'type','rectangle');var bodyX=GetFastValue(config,'x',this._tempVec2.x);var bodyY=GetFastValue(config,'y',this._tempVec2.y);var bodyWidth=GetFastValue(config,'width',this.width);var bodyHeight=GetFastValue(config,'height',this.height);switch(shapeType)
        {case'rectangle':body=Bodies.rectangle(bodyX,bodyY,bodyWidth,bodyHeight,options);break;case'circle':var radius=GetFastValue(config,'radius',Math.max(bodyWidth,bodyHeight)/ 2);var maxSides=GetFastValue(config,'maxSides',25);body=Bodies.circle(bodyX,bodyY,radius,options,maxSides);break;case'trapezoid':var slope=GetFastValue(config,'slope',0.5);body=Bodies.trapezoid(bodyX,bodyY,bodyWidth,bodyHeight,slope,options);break;case'polygon':var sides=GetFastValue(config,'sides',5);var pRadius=GetFastValue(config,'radius',Math.max(bodyWidth,bodyHeight)/ 2);body=Bodies.polygon(bodyX,bodyY,sides,pRadius,options);break;case'fromVertices':case'fromVerts':var verts=GetFastValue(config,'verts',null);if(verts)
            {if(typeof verts==='string')
            {verts=Vertices.fromPath(verts);}
                if(this.body&&!this.body.hasOwnProperty('temp'))
                {Body.setVertices(this.body,verts);body=this.body;}
                else
                {var flagInternal=GetFastValue(config,'flagInternal',false);var removeCollinear=GetFastValue(config,'removeCollinear',0.01);var minimumArea=GetFastValue(config,'minimumArea',10);body=Bodies.fromVertices(bodyX,bodyY,verts,options,flagInternal,removeCollinear,minimumArea);}}
                break;case'fromPhysicsEditor':body=PhysicsEditorParser.parseBody(bodyX,bodyY,bodyWidth,bodyHeight,config);break;}
            if(body)
            {this.setExistingBody(body,config.addToWorld);}
            return this;}};module.exports=SetBody;}),"./physics/matter-js/components/Sleep.js":(function(module,exports,__webpack_require__){var MatterEvents=__webpack_require__("./physics/matter-js/lib/core/Events.js");var Sleep={setSleepThreshold:function(value)
        {if(value===undefined){value=60;}
            this.body.sleepThreshold=value;return this;},setSleepEvents:function(start,end)
        {this.setSleepStartEvent(start);this.setSleepEndEvent(end);return this;},setSleepStartEvent:function(value)
        {if(value)
        {var world=this.world;MatterEvents.on(this.body,'sleepStart',function(event)
        {world.emit('sleepstart',event,this);});}
        else
        {MatterEvents.off(this.body,'sleepStart');}
            return this;},setSleepEndEvent:function(value)
        {if(value)
        {var world=this.world;MatterEvents.on(this.body,'sleepEnd',function(event)
        {world.emit('sleepend',event,this);});}
        else
        {MatterEvents.off(this.body,'sleepEnd');}
            return this;}};module.exports=Sleep;}),"./physics/matter-js/components/Static.js":(function(module,exports,__webpack_require__){var Body=__webpack_require__("./physics/matter-js/lib/body/Body.js");var Static={setStatic:function(value)
        {Body.setStatic(this.body,value);return this;},isStatic:function()
        {return this.body.isStatic;}};module.exports=Static;}),"./physics/matter-js/components/Transform.js":(function(module,exports,__webpack_require__){var Body=__webpack_require__("./physics/matter-js/lib/body/Body.js");var MATH_CONST=__webpack_require__("./math/const.js");var WrapAngle=__webpack_require__("./math/angle/Wrap.js");var WrapAngleDegrees=__webpack_require__("./math/angle/WrapDegrees.js");var _FLAG=4;var Transform={x:{get:function()
            {return this.body.position.x;},set:function(value)
            {this._tempVec2.set(value,this.y);Body.setPosition(this.body,this._tempVec2);}},y:{get:function()
            {return this.body.position.y;},set:function(value)
            {this._tempVec2.set(this.x,value);Body.setPosition(this.body,this._tempVec2);}},scaleX:{get:function()
            {return this._scaleX;},set:function(value)
            {var factorX=1 / this._scaleX;var factorY=1 / this._scaleY;this._scaleX=value;if(this._scaleX===0)
            {this.renderFlags&=~_FLAG;}
            else
            {this.renderFlags|=_FLAG;}
                Body.scale(this.body,factorX,factorY);Body.scale(this.body,value,this._scaleY);}},scaleY:{get:function()
            {return this._scaleY;},set:function(value)
            {var factorX=1 / this._scaleX;var factorY=1 / this._scaleY;this._scaleY=value;if(this._scaleY===0)
            {this.renderFlags&=~_FLAG;}
            else
            {this.renderFlags|=_FLAG;}
                Body.scale(this.body,factorX,factorY);Body.scale(this.body,this._scaleX,value);}},angle:{get:function()
            {return WrapAngleDegrees(this.body.angle*MATH_CONST.RAD_TO_DEG);},set:function(value)
            {this.rotation=WrapAngleDegrees(value)*MATH_CONST.DEG_TO_RAD;}},rotation:{get:function()
            {return this.body.angle;},set:function(value)
            {this._rotation=WrapAngle(value);Body.setAngle(this.body,this._rotation);}},setPosition:function(x,y)
        {if(x===undefined){x=0;}
            if(y===undefined){y=x;}
            this._tempVec2.set(x,y);Body.setPosition(this.body,this._tempVec2);return this;},setRotation:function(radians)
        {if(radians===undefined){radians=0;}
            this._rotation=WrapAngle(radians);Body.setAngle(this.body,radians);return this;},setFixedRotation:function()
        {Body.setInertia(this.body,Infinity);return this;},setAngle:function(degrees)
        {if(degrees===undefined){degrees=0;}
            this.angle=degrees;Body.setAngle(this.body,this.rotation);return this;},setScale:function(x,y,point)
        {if(x===undefined){x=1;}
            if(y===undefined){y=x;}
            var factorX=1 / this._scaleX;var factorY=1 / this._scaleY;this._scaleX=x;this._scaleY=y;Body.scale(this.body,factorX,factorY,point);Body.scale(this.body,x,y,point);return this;}};module.exports=Transform;}),"./physics/matter-js/components/Velocity.js":(function(module,exports,__webpack_require__){var Body=__webpack_require__("./physics/matter-js/lib/body/Body.js");var Velocity={setAngularVelocity:function(value)
        {Body.setAngularVelocity(this.body,value);return this;},setVelocityX:function(x)
        {this._tempVec2.set(x,this.body.velocity.y);Body.setVelocity(this.body,this._tempVec2);return this;},setVelocityY:function(y)
        {this._tempVec2.set(this.body.velocity.x,y);Body.setVelocity(this.body,this._tempVec2);return this;},setVelocity:function(x,y)
        {this._tempVec2.set(x,y);Body.setVelocity(this.body,this._tempVec2);return this;}};module.exports=Velocity;}),"./physics/matter-js/components/index.js":(function(module,exports,__webpack_require__){module.exports={Bounce:__webpack_require__("./physics/matter-js/components/Bounce.js"),Collision:__webpack_require__("./physics/matter-js/components/Collision.js"),Force:__webpack_require__("./physics/matter-js/components/Force.js"),Friction:__webpack_require__("./physics/matter-js/components/Friction.js"),Gravity:__webpack_require__("./physics/matter-js/components/Gravity.js"),Mass:__webpack_require__("./physics/matter-js/components/Mass.js"),Static:__webpack_require__("./physics/matter-js/components/Static.js"),Sensor:__webpack_require__("./physics/matter-js/components/Sensor.js"),SetBody:__webpack_require__("./physics/matter-js/components/SetBody.js"),Sleep:__webpack_require__("./physics/matter-js/components/Sleep.js"),Transform:__webpack_require__("./physics/matter-js/components/Transform.js"),Velocity:__webpack_require__("./physics/matter-js/components/Velocity.js")};}),"./physics/matter-js/index.js":(function(module,exports,__webpack_require__){module.exports={Factory:__webpack_require__("./physics/matter-js/Factory.js"),Image:__webpack_require__("./physics/matter-js/MatterImage.js"),Matter:__webpack_require__("./physics/matter-js/CustomMain.js"),MatterPhysics:__webpack_require__("./physics/matter-js/MatterPhysics.js"),PolyDecomp:__webpack_require__("./physics/matter-js/poly-decomp/index.js"),Sprite:__webpack_require__("./physics/matter-js/MatterSprite.js"),TileBody:__webpack_require__("./physics/matter-js/MatterTileBody.js"),World:__webpack_require__("./physics/matter-js/World.js")};}),"./physics/matter-js/lib/body/Body.js":(function(module,exports,__webpack_require__){var Body={};module.exports=Body;var Vertices=__webpack_require__("./physics/matter-js/lib/geometry/Vertices.js");var Vector=__webpack_require__("./physics/matter-js/lib/geometry/Vector.js");var Sleeping=__webpack_require__("./physics/matter-js/lib/core/Sleeping.js");var Common=__webpack_require__("./physics/matter-js/lib/core/Common.js");var Bounds=__webpack_require__("./physics/matter-js/lib/geometry/Bounds.js");var Axes=__webpack_require__("./physics/matter-js/lib/geometry/Axes.js");(function(){Body._inertiaScale=4;Body._nextCollidingGroupId=1;Body._nextNonCollidingGroupId=-1;Body._nextCategory=0x0001;Body.create=function(options){var defaults={id:Common.nextId(),type:'body',label:'Body',gameObject:null,parts:[],plugin:{},angle:0,vertices:Vertices.fromPath('L 0 0 L 40 0 L 40 40 L 0 40'),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},previousPositionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:false,isStatic:false,isSleeping:false,ignoreGravity:false,ignorePointer:false,motion:0,sleepThreshold:60,density:0.001,restitution:0,friction:0.1,frictionStatic:0.5,frictionAir:0.01,collisionFilter:{category:0x0001,mask:0xFFFFFFFF,group:0},slop:0.05,timeScale:1,render:{visible:true,opacity:1,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0},lineWidth:0},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,_original:null};var body=Common.extend(defaults,options);_initProperties(body,options);return body;};Body.nextGroup=function(isNonColliding){if(isNonColliding)
        return Body._nextNonCollidingGroupId--;return Body._nextCollidingGroupId++;};Body.nextCategory=function(){Body._nextCategory=Body._nextCategory<<1;return Body._nextCategory;};var _initProperties=function(body,options){options=options||{};Body.set(body,{bounds:body.bounds||Bounds.create(body.vertices),positionPrev:body.positionPrev||Vector.clone(body.position),anglePrev:body.anglePrev||body.angle,vertices:body.vertices,parts:body.parts||[body],isStatic:body.isStatic,isSleeping:body.isSleeping,parent:body.parent||body});Vertices.rotate(body.vertices,body.angle,body.position);Axes.rotate(body.axes,body.angle);Bounds.update(body.bounds,body.vertices,body.velocity);Body.set(body,{axes:options.axes||body.axes,area:options.area||body.area,mass:options.mass||body.mass,inertia:options.inertia||body.inertia});var defaultFillStyle=(body.isStatic?'#2e2b44':Common.choose(['#006BA6','#0496FF','#FFBC42','#D81159','#8F2D56'])),defaultStrokeStyle='#000';body.render.fillStyle=body.render.fillStyle||defaultFillStyle;body.render.strokeStyle=body.render.strokeStyle||defaultStrokeStyle;body.render.sprite.xOffset+=-(body.bounds.min.x-body.position.x)/(body.bounds.max.x-body.bounds.min.x);body.render.sprite.yOffset+=-(body.bounds.min.y-body.position.y)/(body.bounds.max.y-body.bounds.min.y);};Body.set=function(body,settings,value){var property;if(typeof settings==='string'){property=settings;settings={};settings[property]=value;}
        for(property in settings){if(!settings.hasOwnProperty(property))
            continue;value=settings[property];switch(property){case'isStatic':Body.setStatic(body,value);break;case'isSleeping':Sleeping.set(body,value);break;case'mass':Body.setMass(body,value);break;case'density':Body.setDensity(body,value);break;case'inertia':Body.setInertia(body,value);break;case'vertices':Body.setVertices(body,value);break;case'position':Body.setPosition(body,value);break;case'angle':Body.setAngle(body,value);break;case'velocity':Body.setVelocity(body,value);break;case'angularVelocity':Body.setAngularVelocity(body,value);break;case'parts':Body.setParts(body,value);break;default:body[property]=value;}}};Body.setStatic=function(body,isStatic){for(var i=0;i<body.parts.length;i++){var part=body.parts[i];part.isStatic=isStatic;if(isStatic){part._original={restitution:part.restitution,friction:part.friction,mass:part.mass,inertia:part.inertia,density:part.density,inverseMass:part.inverseMass,inverseInertia:part.inverseInertia};part.restitution=0;part.friction=1;part.mass=part.inertia=part.density=Infinity;part.inverseMass=part.inverseInertia=0;part.positionPrev.x=part.position.x;part.positionPrev.y=part.position.y;part.anglePrev=part.angle;part.angularVelocity=0;part.speed=0;part.angularSpeed=0;part.motion=0;}else if(part._original){part.restitution=part._original.restitution;part.friction=part._original.friction;part.mass=part._original.mass;part.inertia=part._original.inertia;part.density=part._original.density;part.inverseMass=part._original.inverseMass;part.inverseInertia=part._original.inverseInertia;part._original=null;}}};Body.setMass=function(body,mass){var moment=body.inertia /(body.mass / 6);body.inertia=moment*(mass / 6);body.inverseInertia=1 / body.inertia;body.mass=mass;body.inverseMass=1 / body.mass;body.density=body.mass / body.area;};Body.setDensity=function(body,density){Body.setMass(body,density*body.area);body.density=density;};Body.setInertia=function(body,inertia){body.inertia=inertia;body.inverseInertia=1 / body.inertia;};Body.setVertices=function(body,vertices){if(vertices[0].body===body){body.vertices=vertices;}else{body.vertices=Vertices.create(vertices,body);}
        body.axes=Axes.fromVertices(body.vertices);body.area=Vertices.area(body.vertices);Body.setMass(body,body.density*body.area);var centre=Vertices.centre(body.vertices);Vertices.translate(body.vertices,centre,-1);Body.setInertia(body,Body._inertiaScale*Vertices.inertia(body.vertices,body.mass));Vertices.translate(body.vertices,body.position);Bounds.update(body.bounds,body.vertices,body.velocity);};Body.setParts=function(body,parts,autoHull){var i;parts=parts.slice(0);body.parts.length=0;body.parts.push(body);body.parent=body;for(i=0;i<parts.length;i++){var part=parts[i];if(part!==body){part.parent=body;body.parts.push(part);}}
        if(body.parts.length===1)
            return;autoHull=typeof autoHull!=='undefined'?autoHull:true;if(autoHull){var vertices=[];for(i=0;i<parts.length;i++){vertices=vertices.concat(parts[i].vertices);}
            Vertices.clockwiseSort(vertices);var hull=Vertices.hull(vertices),hullCentre=Vertices.centre(hull);Body.setVertices(body,hull);Vertices.translate(body.vertices,hullCentre);}
        var total=Body._totalProperties(body);body.area=total.area;body.parent=body;body.position.x=total.centre.x;body.position.y=total.centre.y;body.positionPrev.x=total.centre.x;body.positionPrev.y=total.centre.y;Body.setMass(body,total.mass);Body.setInertia(body,total.inertia);Body.setPosition(body,total.centre);};Body.setPosition=function(body,position){var delta=Vector.sub(position,body.position);body.positionPrev.x+=delta.x;body.positionPrev.y+=delta.y;for(var i=0;i<body.parts.length;i++){var part=body.parts[i];part.position.x+=delta.x;part.position.y+=delta.y;Vertices.translate(part.vertices,delta);Bounds.update(part.bounds,part.vertices,body.velocity);}};Body.setAngle=function(body,angle){var delta=angle-body.angle;body.anglePrev+=delta;for(var i=0;i<body.parts.length;i++){var part=body.parts[i];part.angle+=delta;Vertices.rotate(part.vertices,delta,body.position);Axes.rotate(part.axes,delta);Bounds.update(part.bounds,part.vertices,body.velocity);if(i>0){Vector.rotateAbout(part.position,delta,body.position,part.position);}}};Body.setVelocity=function(body,velocity){body.positionPrev.x=body.position.x-velocity.x;body.positionPrev.y=body.position.y-velocity.y;body.velocity.x=velocity.x;body.velocity.y=velocity.y;body.speed=Vector.magnitude(body.velocity);};Body.setAngularVelocity=function(body,velocity){body.anglePrev=body.angle-velocity;body.angularVelocity=velocity;body.angularSpeed=Math.abs(body.angularVelocity);};Body.translate=function(body,translation){Body.setPosition(body,Vector.add(body.position,translation));};Body.rotate=function(body,rotation,point){if(!point){Body.setAngle(body,body.angle+rotation);}else{var cos=Math.cos(rotation),sin=Math.sin(rotation),dx=body.position.x-point.x,dy=body.position.y-point.y;Body.setPosition(body,{x:point.x+(dx*cos-dy*sin),y:point.y+(dx*sin+dy*cos)});Body.setAngle(body,body.angle+rotation);}};Body.scale=function(body,scaleX,scaleY,point){var totalArea=0,totalInertia=0;point=point||body.position;for(var i=0;i<body.parts.length;i++){var part=body.parts[i];Vertices.scale(part.vertices,scaleX,scaleY,point);part.axes=Axes.fromVertices(part.vertices);part.area=Vertices.area(part.vertices);Body.setMass(part,body.density*part.area);Vertices.translate(part.vertices,{x:-part.position.x,y:-part.position.y});Body.setInertia(part,Body._inertiaScale*Vertices.inertia(part.vertices,part.mass));Vertices.translate(part.vertices,{x:part.position.x,y:part.position.y});if(i>0){totalArea+=part.area;totalInertia+=part.inertia;}
        part.position.x=point.x+(part.position.x-point.x)*scaleX;part.position.y=point.y+(part.position.y-point.y)*scaleY;Bounds.update(part.bounds,part.vertices,body.velocity);}
        if(body.parts.length>1){body.area=totalArea;if(!body.isStatic){Body.setMass(body,body.density*totalArea);Body.setInertia(body,totalInertia);}}
        if(body.circleRadius){if(scaleX===scaleY){body.circleRadius*=scaleX;}else{body.circleRadius=null;}}};Body.update=function(body,deltaTime,timeScale,correction){var deltaTimeSquared=Math.pow(deltaTime*timeScale*body.timeScale,2);var frictionAir=1-body.frictionAir*timeScale*body.timeScale,velocityPrevX=body.position.x-body.positionPrev.x,velocityPrevY=body.position.y-body.positionPrev.y;body.velocity.x=(velocityPrevX*frictionAir*correction)+(body.force.x / body.mass)*deltaTimeSquared;body.velocity.y=(velocityPrevY*frictionAir*correction)+(body.force.y / body.mass)*deltaTimeSquared;body.positionPrev.x=body.position.x;body.positionPrev.y=body.position.y;body.position.x+=body.velocity.x;body.position.y+=body.velocity.y;body.angularVelocity=((body.angle-body.anglePrev)*frictionAir*correction)+(body.torque / body.inertia)*deltaTimeSquared;body.anglePrev=body.angle;body.angle+=body.angularVelocity;body.speed=Vector.magnitude(body.velocity);body.angularSpeed=Math.abs(body.angularVelocity);for(var i=0;i<body.parts.length;i++){var part=body.parts[i];Vertices.translate(part.vertices,body.velocity);if(i>0){part.position.x+=body.velocity.x;part.position.y+=body.velocity.y;}
        if(body.angularVelocity!==0){Vertices.rotate(part.vertices,body.angularVelocity,body.position);Axes.rotate(part.axes,body.angularVelocity);if(i>0){Vector.rotateAbout(part.position,body.angularVelocity,body.position,part.position);}}
        Bounds.update(part.bounds,part.vertices,body.velocity);}};Body.applyForce=function(body,position,force){body.force.x+=force.x;body.force.y+=force.y;var offset={x:position.x-body.position.x,y:position.y-body.position.y};body.torque+=offset.x*force.y-offset.y*force.x;};Body._totalProperties=function(body){var properties={mass:0,area:0,inertia:0,centre:{x:0,y:0}};for(var i=body.parts.length===1?0:1;i<body.parts.length;i++){var part=body.parts[i],mass=part.mass!==Infinity?part.mass:1;properties.mass+=mass;properties.area+=part.area;properties.inertia+=part.inertia;properties.centre=Vector.add(properties.centre,Vector.mult(part.position,mass));}
        properties.centre=Vector.div(properties.centre,properties.mass);return properties;};})();}),"./physics/matter-js/lib/body/Composite.js":(function(module,exports,__webpack_require__){var Composite={};module.exports=Composite;var Events=__webpack_require__("./physics/matter-js/lib/core/Events.js");var Common=__webpack_require__("./physics/matter-js/lib/core/Common.js");var Bounds=__webpack_require__("./physics/matter-js/lib/geometry/Bounds.js");var Body=__webpack_require__("./physics/matter-js/lib/body/Body.js");(function(){Composite.create=function(options){return Common.extend({id:Common.nextId(),type:'composite',parent:null,isModified:false,bodies:[],constraints:[],composites:[],label:'Composite',plugin:{}},options);};Composite.setModified=function(composite,isModified,updateParents,updateChildren){composite.isModified=isModified;if(updateParents&&composite.parent){Composite.setModified(composite.parent,isModified,updateParents,updateChildren);}
        if(updateChildren){for(var i=0;i<composite.composites.length;i++){var childComposite=composite.composites[i];Composite.setModified(childComposite,isModified,updateParents,updateChildren);}}};Composite.add=function(composite,object){var objects=[].concat(object);Events.trigger(composite,'beforeAdd',{object:object});for(var i=0;i<objects.length;i++){var obj=objects[i];switch(obj.type){case'body':if(obj.parent!==obj){Common.warn('Composite.add: skipped adding a compound body part (you must add its parent instead)');break;}
        Composite.addBody(composite,obj);break;case'constraint':Composite.addConstraint(composite,obj);break;case'composite':Composite.addComposite(composite,obj);break;case'mouseConstraint':Composite.addConstraint(composite,obj.constraint);break;}}
        Events.trigger(composite,'afterAdd',{object:object});return composite;};Composite.remove=function(composite,object,deep){var objects=[].concat(object);Events.trigger(composite,'beforeRemove',{object:object});for(var i=0;i<objects.length;i++){var obj=objects[i];switch(obj.type){case'body':Composite.removeBody(composite,obj,deep);break;case'constraint':Composite.removeConstraint(composite,obj,deep);break;case'composite':Composite.removeComposite(composite,obj,deep);break;case'mouseConstraint':Composite.removeConstraint(composite,obj.constraint);break;}}
        Events.trigger(composite,'afterRemove',{object:object});return composite;};Composite.addComposite=function(compositeA,compositeB){compositeA.composites.push(compositeB);compositeB.parent=compositeA;Composite.setModified(compositeA,true,true,false);return compositeA;};Composite.removeComposite=function(compositeA,compositeB,deep){var position=compositeA.composites.indexOf(compositeB);if(position!==-1){Composite.removeCompositeAt(compositeA,position);Composite.setModified(compositeA,true,true,false);}
        if(deep){for(var i=0;i<compositeA.composites.length;i++){Composite.removeComposite(compositeA.composites[i],compositeB,true);}}
        return compositeA;};Composite.removeCompositeAt=function(composite,position){composite.composites.splice(position,1);Composite.setModified(composite,true,true,false);return composite;};Composite.addBody=function(composite,body){composite.bodies.push(body);Composite.setModified(composite,true,true,false);return composite;};Composite.removeBody=function(composite,body,deep){var position=composite.bodies.indexOf(body);if(position!==-1){Composite.removeBodyAt(composite,position);Composite.setModified(composite,true,true,false);}
        if(deep){for(var i=0;i<composite.composites.length;i++){Composite.removeBody(composite.composites[i],body,true);}}
        return composite;};Composite.removeBodyAt=function(composite,position){composite.bodies.splice(position,1);Composite.setModified(composite,true,true,false);return composite;};Composite.addConstraint=function(composite,constraint){composite.constraints.push(constraint);Composite.setModified(composite,true,true,false);return composite;};Composite.removeConstraint=function(composite,constraint,deep){var position=composite.constraints.indexOf(constraint);if(position!==-1){Composite.removeConstraintAt(composite,position);}
        if(deep){for(var i=0;i<composite.composites.length;i++){Composite.removeConstraint(composite.composites[i],constraint,true);}}
        return composite;};Composite.removeConstraintAt=function(composite,position){composite.constraints.splice(position,1);Composite.setModified(composite,true,true,false);return composite;};Composite.clear=function(composite,keepStatic,deep){if(deep){for(var i=0;i<composite.composites.length;i++){Composite.clear(composite.composites[i],keepStatic,true);}}
        if(keepStatic){composite.bodies=composite.bodies.filter(function(body){return body.isStatic;});}else{composite.bodies.length=0;}
        composite.constraints.length=0;composite.composites.length=0;Composite.setModified(composite,true,true,false);return composite;};Composite.allBodies=function(composite){var bodies=[].concat(composite.bodies);for(var i=0;i<composite.composites.length;i++)
        bodies=bodies.concat(Composite.allBodies(composite.composites[i]));return bodies;};Composite.allConstraints=function(composite){var constraints=[].concat(composite.constraints);for(var i=0;i<composite.composites.length;i++)
        constraints=constraints.concat(Composite.allConstraints(composite.composites[i]));return constraints;};Composite.allComposites=function(composite){var composites=[].concat(composite.composites);for(var i=0;i<composite.composites.length;i++)
        composites=composites.concat(Composite.allComposites(composite.composites[i]));return composites;};Composite.get=function(composite,id,type){var objects,object;switch(type){case'body':objects=Composite.allBodies(composite);break;case'constraint':objects=Composite.allConstraints(composite);break;case'composite':objects=Composite.allComposites(composite).concat(composite);break;}
        if(!objects)
            return null;object=objects.filter(function(object){return object.id.toString()===id.toString();});return object.length===0?null:object[0];};Composite.move=function(compositeA,objects,compositeB){Composite.remove(compositeA,objects);Composite.add(compositeB,objects);return compositeA;};Composite.rebase=function(composite){var objects=Composite.allBodies(composite).concat(Composite.allConstraints(composite)).concat(Composite.allComposites(composite));for(var i=0;i<objects.length;i++){objects[i].id=Common.nextId();}
        Composite.setModified(composite,true,true,false);return composite;};Composite.translate=function(composite,translation,recursive){var bodies=recursive?Composite.allBodies(composite):composite.bodies;for(var i=0;i<bodies.length;i++){Body.translate(bodies[i],translation);}
        Composite.setModified(composite,true,true,false);return composite;};Composite.rotate=function(composite,rotation,point,recursive){var cos=Math.cos(rotation),sin=Math.sin(rotation),bodies=recursive?Composite.allBodies(composite):composite.bodies;for(var i=0;i<bodies.length;i++){var body=bodies[i],dx=body.position.x-point.x,dy=body.position.y-point.y;Body.setPosition(body,{x:point.x+(dx*cos-dy*sin),y:point.y+(dx*sin+dy*cos)});Body.rotate(body,rotation);}
        Composite.setModified(composite,true,true,false);return composite;};Composite.scale=function(composite,scaleX,scaleY,point,recursive){var bodies=recursive?Composite.allBodies(composite):composite.bodies;for(var i=0;i<bodies.length;i++){var body=bodies[i],dx=body.position.x-point.x,dy=body.position.y-point.y;Body.setPosition(body,{x:point.x+dx*scaleX,y:point.y+dy*scaleY});Body.scale(body,scaleX,scaleY);}
        Composite.setModified(composite,true,true,false);return composite;};Composite.bounds=function(composite){var bodies=Composite.allBodies(composite),vertices=[];for(var i=0;i<bodies.length;i+=1){var body=bodies[i];vertices.push(body.bounds.min,body.bounds.max);}
        return Bounds.create(vertices);};})();}),"./physics/matter-js/lib/body/World.js":(function(module,exports,__webpack_require__){var World={};module.exports=World;var Composite=__webpack_require__("./physics/matter-js/lib/body/Composite.js");var Constraint=__webpack_require__("./physics/matter-js/lib/constraint/Constraint.js");var Common=__webpack_require__("./physics/matter-js/lib/core/Common.js");(function(){World.create=function(options){var composite=Composite.create();var defaults={label:'World',gravity:{x:0,y:1,scale:0.001},bounds:{min:{x:-Infinity,y:-Infinity},max:{x:Infinity,y:Infinity}}};return Common.extend(composite,defaults,options);};})();}),"./physics/matter-js/lib/collision/Detector.js":(function(module,exports,__webpack_require__){var Detector={};module.exports=Detector;var SAT=__webpack_require__("./physics/matter-js/lib/collision/SAT.js");var Pair=__webpack_require__("./physics/matter-js/lib/collision/Pair.js");var Bounds=__webpack_require__("./physics/matter-js/lib/geometry/Bounds.js");(function(){Detector.collisions=function(broadphasePairs,engine){var collisions=[],pairsTable=engine.pairs.table;var metrics=engine.metrics;for(var i=0;i<broadphasePairs.length;i++){var bodyA=broadphasePairs[i][0],bodyB=broadphasePairs[i][1];if((bodyA.isStatic||bodyA.isSleeping)&&(bodyB.isStatic||bodyB.isSleeping))
        continue;if(!Detector.canCollide(bodyA.collisionFilter,bodyB.collisionFilter))
        continue;metrics.midphaseTests+=1;if(Bounds.overlaps(bodyA.bounds,bodyB.bounds)){for(var j=bodyA.parts.length>1?1:0;j<bodyA.parts.length;j++){var partA=bodyA.parts[j];for(var k=bodyB.parts.length>1?1:0;k<bodyB.parts.length;k++){var partB=bodyB.parts[k];if((partA===bodyA&&partB===bodyB)||Bounds.overlaps(partA.bounds,partB.bounds)){var pairId=Pair.id(partA,partB),pair=pairsTable[pairId],previousCollision;if(pair&&pair.isActive){previousCollision=pair.collision;}else{previousCollision=null;}
        var collision=SAT.collides(partA,partB,previousCollision);metrics.narrowphaseTests+=1;if(collision.reused)
            metrics.narrowReuseCount+=1;if(collision.collided){collisions.push(collision);metrics.narrowDetections+=1;}}}}}}
        return collisions;};Detector.canCollide=function(filterA,filterB){if(filterA.group===filterB.group&&filterA.group!==0)
        return filterA.group>0;return(filterA.mask&filterB.category)!==0&&(filterB.mask&filterA.category)!==0;};})();}),"./physics/matter-js/lib/collision/Grid.js":(function(module,exports,__webpack_require__){var Grid={};module.exports=Grid;var Pair=__webpack_require__("./physics/matter-js/lib/collision/Pair.js");var Detector=__webpack_require__("./physics/matter-js/lib/collision/Detector.js");var Common=__webpack_require__("./physics/matter-js/lib/core/Common.js");(function(){Grid.create=function(options){var defaults={controller:Grid,detector:Detector.collisions,buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return Common.extend(defaults,options);};Grid.update=function(grid,bodies,engine,forceUpdate){var i,col,row,world=engine.world,buckets=grid.buckets,bucket,bucketId,gridChanged=false;var metrics=engine.metrics;metrics.broadphaseTests=0;for(i=0;i<bodies.length;i++){var body=bodies[i];if(body.isSleeping&&!forceUpdate)
        continue;if(body.bounds.max.x<world.bounds.min.x||body.bounds.min.x>world.bounds.max.x||body.bounds.max.y<world.bounds.min.y||body.bounds.min.y>world.bounds.max.y)
        continue;var newRegion=Grid._getRegion(grid,body);if(!body.region||newRegion.id!==body.region.id||forceUpdate){metrics.broadphaseTests+=1;if(!body.region||forceUpdate)
        body.region=newRegion;var union=Grid._regionUnion(newRegion,body.region);for(col=union.startCol;col<=union.endCol;col++){for(row=union.startRow;row<=union.endRow;row++){bucketId=Grid._getBucketId(col,row);bucket=buckets[bucketId];var isInsideNewRegion=(col>=newRegion.startCol&&col<=newRegion.endCol&&row>=newRegion.startRow&&row<=newRegion.endRow);var isInsideOldRegion=(col>=body.region.startCol&&col<=body.region.endCol&&row>=body.region.startRow&&row<=body.region.endRow);if(!isInsideNewRegion&&isInsideOldRegion){if(isInsideOldRegion){if(bucket)
        Grid._bucketRemoveBody(grid,bucket,body);}}
        if(body.region===newRegion||(isInsideNewRegion&&!isInsideOldRegion)||forceUpdate){if(!bucket)
            bucket=Grid._createBucket(buckets,bucketId);Grid._bucketAddBody(grid,bucket,body);}}}
        body.region=newRegion;gridChanged=true;}}
        if(gridChanged)
            grid.pairsList=Grid._createActivePairsList(grid);};Grid.clear=function(grid){grid.buckets={};grid.pairs={};grid.pairsList=[];};Grid._regionUnion=function(regionA,regionB){var startCol=Math.min(regionA.startCol,regionB.startCol),endCol=Math.max(regionA.endCol,regionB.endCol),startRow=Math.min(regionA.startRow,regionB.startRow),endRow=Math.max(regionA.endRow,regionB.endRow);return Grid._createRegion(startCol,endCol,startRow,endRow);};Grid._getRegion=function(grid,body){var bounds=body.bounds,startCol=Math.floor(bounds.min.x / grid.bucketWidth),endCol=Math.floor(bounds.max.x / grid.bucketWidth),startRow=Math.floor(bounds.min.y / grid.bucketHeight),endRow=Math.floor(bounds.max.y / grid.bucketHeight);return Grid._createRegion(startCol,endCol,startRow,endRow);};Grid._createRegion=function(startCol,endCol,startRow,endRow){return{id:startCol+','+endCol+','+startRow+','+endRow,startCol:startCol,endCol:endCol,startRow:startRow,endRow:endRow};};Grid._getBucketId=function(column,row){return'C'+column+'R'+row;};Grid._createBucket=function(buckets,bucketId){var bucket=buckets[bucketId]=[];return bucket;};Grid._bucketAddBody=function(grid,bucket,body){for(var i=0;i<bucket.length;i++){var bodyB=bucket[i];if(body.id===bodyB.id||(body.isStatic&&bodyB.isStatic))
        continue;var pairId=Pair.id(body,bodyB),pair=grid.pairs[pairId];if(pair){pair[2]+=1;}else{grid.pairs[pairId]=[body,bodyB,1];}}
        bucket.push(body);};Grid._bucketRemoveBody=function(grid,bucket,body){bucket.splice(Common.indexOf(bucket,body),1);for(var i=0;i<bucket.length;i++){var bodyB=bucket[i],pairId=Pair.id(body,bodyB),pair=grid.pairs[pairId];if(pair)
        pair[2]-=1;}};Grid._createActivePairsList=function(grid){var pairKeys,pair,pairs=[];pairKeys=Common.keys(grid.pairs);for(var k=0;k<pairKeys.length;k++){pair=grid.pairs[pairKeys[k]];if(pair[2]>0){pairs.push(pair);}else{delete grid.pairs[pairKeys[k]];}}
        return pairs;};})();}),"./physics/matter-js/lib/collision/Pair.js":(function(module,exports){var Pair={};module.exports=Pair;(function(){Pair.create=function(collision,timestamp){var bodyA=collision.bodyA,bodyB=collision.bodyB;var pair={id:Pair.id(bodyA,bodyB),bodyA:bodyA,bodyB:bodyB,activeContacts:[],separation:0,isActive:true,confirmedActive:true,isSensor:bodyA.isSensor||bodyB.isSensor,timeCreated:timestamp,timeUpdated:timestamp,collision:null,inverseMass:0,friction:0,frictionStatic:0,restitution:0,slop:0};Pair.update(pair,collision,timestamp);return pair;};Pair.update=function(pair,collision,timestamp){pair.collision=collision;if(collision.collided){var supports=collision.supports,activeContacts=pair.activeContacts,parentA=collision.parentA,parentB=collision.parentB;pair.inverseMass=parentA.inverseMass+parentB.inverseMass;pair.friction=Math.min(parentA.friction,parentB.friction);pair.frictionStatic=Math.max(parentA.frictionStatic,parentB.frictionStatic);pair.restitution=Math.max(parentA.restitution,parentB.restitution);pair.slop=Math.max(parentA.slop,parentB.slop);for(var i=0;i<supports.length;i++){activeContacts[i]=supports[i].contact;}
        var supportCount=supports.length;if(supportCount<activeContacts.length){activeContacts.length=supportCount;}
        pair.separation=collision.depth;Pair.setActive(pair,true,timestamp);}else{if(pair.isActive===true)
        Pair.setActive(pair,false,timestamp);}};Pair.setActive=function(pair,isActive,timestamp){if(isActive){pair.isActive=true;pair.timeUpdated=timestamp;}else{pair.isActive=false;pair.activeContacts.length=0;}};Pair.id=function(bodyA,bodyB){if(bodyA.id<bodyB.id){return'A'+bodyA.id+'B'+bodyB.id;}else{return'A'+bodyB.id+'B'+bodyA.id;}};})();}),"./physics/matter-js/lib/collision/Pairs.js":(function(module,exports,__webpack_require__){var Pairs={};module.exports=Pairs;var Pair=__webpack_require__("./physics/matter-js/lib/collision/Pair.js");var Common=__webpack_require__("./physics/matter-js/lib/core/Common.js");(function(){Pairs._pairMaxIdleLife=1000;Pairs.create=function(options){return Common.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},options);};Pairs.update=function(pairs,collisions,timestamp){var pairsList=pairs.list,pairsTable=pairs.table,collisionStart=pairs.collisionStart,collisionEnd=pairs.collisionEnd,collisionActive=pairs.collisionActive,collision,pairId,pair,i;collisionStart.length=0;collisionEnd.length=0;collisionActive.length=0;for(i=0;i<pairsList.length;i++){pairsList[i].confirmedActive=false;}
        for(i=0;i<collisions.length;i++){collision=collisions[i];if(collision.collided){pairId=Pair.id(collision.bodyA,collision.bodyB);pair=pairsTable[pairId];if(pair){if(pair.isActive){collisionActive.push(pair);}else{collisionStart.push(pair);}
            Pair.update(pair,collision,timestamp);pair.confirmedActive=true;}else{pair=Pair.create(collision,timestamp);pairsTable[pairId]=pair;collisionStart.push(pair);pairsList.push(pair);}}}
        for(i=0;i<pairsList.length;i++){pair=pairsList[i];if(pair.isActive&&!pair.confirmedActive){Pair.setActive(pair,false,timestamp);collisionEnd.push(pair);}}};Pairs.removeOld=function(pairs,timestamp){var pairsList=pairs.list,pairsTable=pairs.table,indexesToRemove=[],pair,collision,pairIndex,i;for(i=0;i<pairsList.length;i++){pair=pairsList[i];collision=pair.collision;if(collision.bodyA.isSleeping||collision.bodyB.isSleeping){pair.timeUpdated=timestamp;continue;}
        if(timestamp-pair.timeUpdated>Pairs._pairMaxIdleLife){indexesToRemove.push(i);}}
        for(i=0;i<indexesToRemove.length;i++){pairIndex=indexesToRemove[i]-i;pair=pairsList[pairIndex];delete pairsTable[pair.id];pairsList.splice(pairIndex,1);}};Pairs.clear=function(pairs){pairs.table={};pairs.list.length=0;pairs.collisionStart.length=0;pairs.collisionActive.length=0;pairs.collisionEnd.length=0;return pairs;};})();}),"./physics/matter-js/lib/collision/Query.js":(function(module,exports,__webpack_require__){var Query={};module.exports=Query;var Vector=__webpack_require__("./physics/matter-js/lib/geometry/Vector.js");var SAT=__webpack_require__("./physics/matter-js/lib/collision/SAT.js");var Bounds=__webpack_require__("./physics/matter-js/lib/geometry/Bounds.js");var Bodies=__webpack_require__("./physics/matter-js/lib/factory/Bodies.js");var Vertices=__webpack_require__("./physics/matter-js/lib/geometry/Vertices.js");(function(){Query.collides=function(body,bodies){var collisions=[];for(var i=0;i<bodies.length;i++){var bodyA=bodies[i];if(Bounds.overlaps(bodyA.bounds,body.bounds)){for(var j=bodyA.parts.length===1?0:1;j<bodyA.parts.length;j++){var part=bodyA.parts[j];if(Bounds.overlaps(part.bounds,body.bounds)){var collision=SAT.collides(part,body);if(collision.collided){collisions.push(collision);break;}}}}}
        return collisions;};Query.ray=function(bodies,startPoint,endPoint,rayWidth){rayWidth=rayWidth||1e-100;var rayAngle=Vector.angle(startPoint,endPoint),rayLength=Vector.magnitude(Vector.sub(startPoint,endPoint)),rayX=(endPoint.x+startPoint.x)*0.5,rayY=(endPoint.y+startPoint.y)*0.5,ray=Bodies.rectangle(rayX,rayY,rayLength,rayWidth,{angle:rayAngle}),collisions=Query.collides(ray,bodies);for(var i=0;i<collisions.length;i+=1){var collision=collisions[i];collision.body=collision.bodyB=collision.bodyA;}
        return collisions;};Query.region=function(bodies,bounds,outside){var result=[];for(var i=0;i<bodies.length;i++){var body=bodies[i],overlaps=Bounds.overlaps(body.bounds,bounds);if((overlaps&&!outside)||(!overlaps&&outside))
        result.push(body);}
        return result;};Query.point=function(bodies,point){var result=[];for(var i=0;i<bodies.length;i++){var body=bodies[i];if(Bounds.contains(body.bounds,point)){for(var j=body.parts.length===1?0:1;j<body.parts.length;j++){var part=body.parts[j];if(Bounds.contains(part.bounds,point)&&Vertices.contains(part.vertices,point)){result.push(body);break;}}}}
        return result;};})();}),"./physics/matter-js/lib/collision/Resolver.js":(function(module,exports,__webpack_require__){var Resolver={};module.exports=Resolver;var Vertices=__webpack_require__("./physics/matter-js/lib/geometry/Vertices.js");var Vector=__webpack_require__("./physics/matter-js/lib/geometry/Vector.js");var Common=__webpack_require__("./physics/matter-js/lib/core/Common.js");var Bounds=__webpack_require__("./physics/matter-js/lib/geometry/Bounds.js");(function(){Resolver._restingThresh=4;Resolver._restingThreshTangent=6;Resolver._positionDampen=0.9;Resolver._positionWarming=0.8;Resolver._frictionNormalMultiplier=5;Resolver.preSolvePosition=function(pairs){var i,pair,activeCount;for(i=0;i<pairs.length;i++){pair=pairs[i];if(!pair.isActive)
        continue;activeCount=pair.activeContacts.length;pair.collision.parentA.totalContacts+=activeCount;pair.collision.parentB.totalContacts+=activeCount;}};Resolver.solvePosition=function(pairs,bodies,timeScale){var i,normalX,normalY,pair,collision,bodyA,bodyB,normal,separation,penetration,positionImpulseA,positionImpulseB,contactShare,bodyBtoAX,bodyBtoAY,positionImpulse,impulseCoefficient=timeScale*Resolver._positionDampen;for(i=0;i<bodies.length;i++){var body=bodies[i];body.previousPositionImpulse.x=body.positionImpulse.x;body.previousPositionImpulse.y=body.positionImpulse.y;}
        for(i=0;i<pairs.length;i++){pair=pairs[i];if(!pair.isActive||pair.isSensor)
            continue;collision=pair.collision;bodyA=collision.parentA;bodyB=collision.parentB;normal=collision.normal;positionImpulseA=bodyA.previousPositionImpulse;positionImpulseB=bodyB.previousPositionImpulse;penetration=collision.penetration;bodyBtoAX=positionImpulseB.x-positionImpulseA.x+penetration.x;bodyBtoAY=positionImpulseB.y-positionImpulseA.y+penetration.y;normalX=normal.x;normalY=normal.y;separation=normalX*bodyBtoAX+normalY*bodyBtoAY;pair.separation=separation;positionImpulse=(separation-pair.slop)*impulseCoefficient;if(bodyA.isStatic||bodyB.isStatic)
            positionImpulse*=2;if(!(bodyA.isStatic||bodyA.isSleeping)){contactShare=positionImpulse / bodyA.totalContacts;bodyA.positionImpulse.x+=normalX*contactShare;bodyA.positionImpulse.y+=normalY*contactShare;}
            if(!(bodyB.isStatic||bodyB.isSleeping)){contactShare=positionImpulse / bodyB.totalContacts;bodyB.positionImpulse.x-=normalX*contactShare;bodyB.positionImpulse.y-=normalY*contactShare;}}};Resolver.postSolvePosition=function(bodies){for(var i=0;i<bodies.length;i++){var body=bodies[i];body.totalContacts=0;if(body.positionImpulse.x!==0||body.positionImpulse.y!==0){for(var j=0;j<body.parts.length;j++){var part=body.parts[j];Vertices.translate(part.vertices,body.positionImpulse);Bounds.update(part.bounds,part.vertices,body.velocity);part.position.x+=body.positionImpulse.x;part.position.y+=body.positionImpulse.y;}
        body.positionPrev.x+=body.positionImpulse.x;body.positionPrev.y+=body.positionImpulse.y;if(Vector.dot(body.positionImpulse,body.velocity)<0){body.positionImpulse.x=0;body.positionImpulse.y=0;}else{body.positionImpulse.x*=Resolver._positionWarming;body.positionImpulse.y*=Resolver._positionWarming;}}}};Resolver.preSolveVelocity=function(pairs){var i,j,pair,contacts,collision,bodyA,bodyB,normal,tangent,contact,contactVertex,normalImpulse,tangentImpulse,offset,impulse=Vector._temp[0],tempA=Vector._temp[1];for(i=0;i<pairs.length;i++){pair=pairs[i];if(!pair.isActive||pair.isSensor)
        continue;contacts=pair.activeContacts;collision=pair.collision;bodyA=collision.parentA;bodyB=collision.parentB;normal=collision.normal;tangent=collision.tangent;for(j=0;j<contacts.length;j++){contact=contacts[j];contactVertex=contact.vertex;normalImpulse=contact.normalImpulse;tangentImpulse=contact.tangentImpulse;if(normalImpulse!==0||tangentImpulse!==0){impulse.x=(normal.x*normalImpulse)+(tangent.x*tangentImpulse);impulse.y=(normal.y*normalImpulse)+(tangent.y*tangentImpulse);if(!(bodyA.isStatic||bodyA.isSleeping)){offset=Vector.sub(contactVertex,bodyA.position,tempA);bodyA.positionPrev.x+=impulse.x*bodyA.inverseMass;bodyA.positionPrev.y+=impulse.y*bodyA.inverseMass;bodyA.anglePrev+=Vector.cross(offset,impulse)*bodyA.inverseInertia;}
        if(!(bodyB.isStatic||bodyB.isSleeping)){offset=Vector.sub(contactVertex,bodyB.position,tempA);bodyB.positionPrev.x-=impulse.x*bodyB.inverseMass;bodyB.positionPrev.y-=impulse.y*bodyB.inverseMass;bodyB.anglePrev-=Vector.cross(offset,impulse)*bodyB.inverseInertia;}}}}};Resolver.solveVelocity=function(pairs,timeScale){var timeScaleSquared=timeScale*timeScale,impulse=Vector._temp[0],tempA=Vector._temp[1],tempB=Vector._temp[2],tempC=Vector._temp[3],tempD=Vector._temp[4],tempE=Vector._temp[5];for(var i=0;i<pairs.length;i++){var pair=pairs[i];if(!pair.isActive||pair.isSensor)
        continue;var collision=pair.collision,bodyA=collision.parentA,bodyB=collision.parentB,normal=collision.normal,tangent=collision.tangent,contacts=pair.activeContacts,contactShare=1 / contacts.length;bodyA.velocity.x=bodyA.position.x-bodyA.positionPrev.x;bodyA.velocity.y=bodyA.position.y-bodyA.positionPrev.y;bodyB.velocity.x=bodyB.position.x-bodyB.positionPrev.x;bodyB.velocity.y=bodyB.position.y-bodyB.positionPrev.y;bodyA.angularVelocity=bodyA.angle-bodyA.anglePrev;bodyB.angularVelocity=bodyB.angle-bodyB.anglePrev;for(var j=0;j<contacts.length;j++){var contact=contacts[j],contactVertex=contact.vertex,offsetA=Vector.sub(contactVertex,bodyA.position,tempA),offsetB=Vector.sub(contactVertex,bodyB.position,tempB),velocityPointA=Vector.add(bodyA.velocity,Vector.mult(Vector.perp(offsetA),bodyA.angularVelocity),tempC),velocityPointB=Vector.add(bodyB.velocity,Vector.mult(Vector.perp(offsetB),bodyB.angularVelocity),tempD),relativeVelocity=Vector.sub(velocityPointA,velocityPointB,tempE),normalVelocity=Vector.dot(normal,relativeVelocity);var tangentVelocity=Vector.dot(tangent,relativeVelocity),tangentSpeed=Math.abs(tangentVelocity),tangentVelocityDirection=Common.sign(tangentVelocity);var normalImpulse=(1+pair.restitution)*normalVelocity,normalForce=Common.clamp(pair.separation+normalVelocity,0,1)*Resolver._frictionNormalMultiplier;var tangentImpulse=tangentVelocity,maxFriction=Infinity;if(tangentSpeed>pair.friction*pair.frictionStatic*normalForce*timeScaleSquared){maxFriction=tangentSpeed;tangentImpulse=Common.clamp(pair.friction*tangentVelocityDirection*timeScaleSquared,-maxFriction,maxFriction);}
        var oAcN=Vector.cross(offsetA,normal),oBcN=Vector.cross(offsetB,normal),share=contactShare /(bodyA.inverseMass+bodyB.inverseMass+bodyA.inverseInertia*oAcN*oAcN+bodyB.inverseInertia*oBcN*oBcN);normalImpulse*=share;tangentImpulse*=share;if(normalVelocity<0&&normalVelocity*normalVelocity>Resolver._restingThresh*timeScaleSquared){contact.normalImpulse=0;}else{var contactNormalImpulse=contact.normalImpulse;contact.normalImpulse=Math.min(contact.normalImpulse+normalImpulse,0);normalImpulse=contact.normalImpulse-contactNormalImpulse;}
        if(tangentVelocity*tangentVelocity>Resolver._restingThreshTangent*timeScaleSquared){contact.tangentImpulse=0;}else{var contactTangentImpulse=contact.tangentImpulse;contact.tangentImpulse=Common.clamp(contact.tangentImpulse+tangentImpulse,-maxFriction,maxFriction);tangentImpulse=contact.tangentImpulse-contactTangentImpulse;}
        impulse.x=(normal.x*normalImpulse)+(tangent.x*tangentImpulse);impulse.y=(normal.y*normalImpulse)+(tangent.y*tangentImpulse);if(!(bodyA.isStatic||bodyA.isSleeping)){bodyA.positionPrev.x+=impulse.x*bodyA.inverseMass;bodyA.positionPrev.y+=impulse.y*bodyA.inverseMass;bodyA.anglePrev+=Vector.cross(offsetA,impulse)*bodyA.inverseInertia;}
        if(!(bodyB.isStatic||bodyB.isSleeping)){bodyB.positionPrev.x-=impulse.x*bodyB.inverseMass;bodyB.positionPrev.y-=impulse.y*bodyB.inverseMass;bodyB.anglePrev-=Vector.cross(offsetB,impulse)*bodyB.inverseInertia;}}}};})();}),"./physics/matter-js/lib/collision/SAT.js":(function(module,exports,__webpack_require__){var SAT={};module.exports=SAT;var Vertices=__webpack_require__("./physics/matter-js/lib/geometry/Vertices.js");var Vector=__webpack_require__("./physics/matter-js/lib/geometry/Vector.js");(function(){SAT.collides=function(bodyA,bodyB,previousCollision){var overlapAB,overlapBA,minOverlap,collision,canReusePrevCol=false;if(previousCollision){var parentA=bodyA.parent,parentB=bodyB.parent,motion=parentA.speed*parentA.speed+parentA.angularSpeed*parentA.angularSpeed
        +parentB.speed*parentB.speed+parentB.angularSpeed*parentB.angularSpeed;canReusePrevCol=previousCollision&&previousCollision.collided&&motion<0.2;collision=previousCollision;}else{collision={collided:false,bodyA:bodyA,bodyB:bodyB};}
        if(previousCollision&&canReusePrevCol){var axisBodyA=collision.axisBody,axisBodyB=axisBodyA===bodyA?bodyB:bodyA,axes=[axisBodyA.axes[previousCollision.axisNumber]];minOverlap=SAT._overlapAxes(axisBodyA.vertices,axisBodyB.vertices,axes);collision.reused=true;if(minOverlap.overlap<=0){collision.collided=false;return collision;}}else{overlapAB=SAT._overlapAxes(bodyA.vertices,bodyB.vertices,bodyA.axes);if(overlapAB.overlap<=0){collision.collided=false;return collision;}
            overlapBA=SAT._overlapAxes(bodyB.vertices,bodyA.vertices,bodyB.axes);if(overlapBA.overlap<=0){collision.collided=false;return collision;}
            if(overlapAB.overlap<overlapBA.overlap){minOverlap=overlapAB;collision.axisBody=bodyA;}else{minOverlap=overlapBA;collision.axisBody=bodyB;}
            collision.axisNumber=minOverlap.axisNumber;}
        collision.bodyA=bodyA.id<bodyB.id?bodyA:bodyB;collision.bodyB=bodyA.id<bodyB.id?bodyB:bodyA;collision.collided=true;collision.depth=minOverlap.overlap;collision.parentA=collision.bodyA.parent;collision.parentB=collision.bodyB.parent;bodyA=collision.bodyA;bodyB=collision.bodyB;if(Vector.dot(minOverlap.axis,Vector.sub(bodyB.position,bodyA.position))<0){collision.normal={x:minOverlap.axis.x,y:minOverlap.axis.y};}else{collision.normal={x:-minOverlap.axis.x,y:-minOverlap.axis.y};}
        collision.tangent=Vector.perp(collision.normal);collision.penetration=collision.penetration||{};collision.penetration.x=collision.normal.x*collision.depth;collision.penetration.y=collision.normal.y*collision.depth;var verticesB=SAT._findSupports(bodyA,bodyB,collision.normal),supports=[];if(Vertices.contains(bodyA.vertices,verticesB[0]))
            supports.push(verticesB[0]);if(Vertices.contains(bodyA.vertices,verticesB[1]))
            supports.push(verticesB[1]);if(supports.length<2){var verticesA=SAT._findSupports(bodyB,bodyA,Vector.neg(collision.normal));if(Vertices.contains(bodyB.vertices,verticesA[0]))
            supports.push(verticesA[0]);if(supports.length<2&&Vertices.contains(bodyB.vertices,verticesA[1]))
            supports.push(verticesA[1]);}
        if(supports.length<1)
            supports=[verticesB[0]];collision.supports=supports;return collision;};SAT._overlapAxes=function(verticesA,verticesB,axes){var projectionA=Vector._temp[0],projectionB=Vector._temp[1],result={overlap:Number.MAX_VALUE},overlap,axis;for(var i=0;i<axes.length;i++){axis=axes[i];SAT._projectToAxis(projectionA,verticesA,axis);SAT._projectToAxis(projectionB,verticesB,axis);overlap=Math.min(projectionA.max-projectionB.min,projectionB.max-projectionA.min);if(overlap<=0){result.overlap=overlap;return result;}
        if(overlap<result.overlap){result.overlap=overlap;result.axis=axis;result.axisNumber=i;}}
        return result;};SAT._projectToAxis=function(projection,vertices,axis){var min=Vector.dot(vertices[0],axis),max=min;for(var i=1;i<vertices.length;i+=1){var dot=Vector.dot(vertices[i],axis);if(dot>max){max=dot;}else if(dot<min){min=dot;}}
        projection.min=min;projection.max=max;};SAT._findSupports=function(bodyA,bodyB,normal){var nearestDistance=Number.MAX_VALUE,vertexToBody=Vector._temp[0],vertices=bodyB.vertices,bodyAPosition=bodyA.position,distance,vertex,vertexA,vertexB;for(var i=0;i<vertices.length;i++){vertex=vertices[i];vertexToBody.x=vertex.x-bodyAPosition.x;vertexToBody.y=vertex.y-bodyAPosition.y;distance=-Vector.dot(normal,vertexToBody);if(distance<nearestDistance){nearestDistance=distance;vertexA=vertex;}}
        var prevIndex=vertexA.index-1>=0?vertexA.index-1:vertices.length-1;vertex=vertices[prevIndex];vertexToBody.x=vertex.x-bodyAPosition.x;vertexToBody.y=vertex.y-bodyAPosition.y;nearestDistance=-Vector.dot(normal,vertexToBody);vertexB=vertex;var nextIndex=(vertexA.index+1)%vertices.length;vertex=vertices[nextIndex];vertexToBody.x=vertex.x-bodyAPosition.x;vertexToBody.y=vertex.y-bodyAPosition.y;distance=-Vector.dot(normal,vertexToBody);if(distance<nearestDistance){vertexB=vertex;}
        return[vertexA,vertexB];};})();}),"./physics/matter-js/lib/constraint/Constraint.js":(function(module,exports,__webpack_require__){var Constraint={};module.exports=Constraint;var Vertices=__webpack_require__("./physics/matter-js/lib/geometry/Vertices.js");var Vector=__webpack_require__("./physics/matter-js/lib/geometry/Vector.js");var Sleeping=__webpack_require__("./physics/matter-js/lib/core/Sleeping.js");var Bounds=__webpack_require__("./physics/matter-js/lib/geometry/Bounds.js");var Axes=__webpack_require__("./physics/matter-js/lib/geometry/Axes.js");var Common=__webpack_require__("./physics/matter-js/lib/core/Common.js");(function(){Constraint._warming=0.4;Constraint._torqueDampen=1;Constraint._minLength=0.000001;Constraint.create=function(options){var constraint=options;if(constraint.bodyA&&!constraint.pointA)
        constraint.pointA={x:0,y:0};if(constraint.bodyB&&!constraint.pointB)
        constraint.pointB={x:0,y:0};var initialPointA=constraint.bodyA?Vector.add(constraint.bodyA.position,constraint.pointA):constraint.pointA,initialPointB=constraint.bodyB?Vector.add(constraint.bodyB.position,constraint.pointB):constraint.pointB,length=Vector.magnitude(Vector.sub(initialPointA,initialPointB));constraint.length=typeof constraint.length!=='undefined'?constraint.length:length;constraint.id=constraint.id||Common.nextId();constraint.label=constraint.label||'Constraint';constraint.type='constraint';constraint.stiffness=constraint.stiffness||(constraint.length>0?1:0.7);constraint.damping=constraint.damping||0;constraint.angularStiffness=constraint.angularStiffness||0;constraint.angleA=constraint.bodyA?constraint.bodyA.angle:constraint.angleA;constraint.angleB=constraint.bodyB?constraint.bodyB.angle:constraint.angleB;constraint.plugin={};var render={visible:true,lineWidth:2,strokeStyle:'#ffffff',type:'line',anchors:true};if(constraint.length===0&&constraint.stiffness>0.1){render.type='pin';render.anchors=false;}else if(constraint.stiffness<0.9){render.type='spring';}
        constraint.render=Common.extend(render,constraint.render);return constraint;};Constraint.preSolveAll=function(bodies){for(var i=0;i<bodies.length;i+=1){var body=bodies[i],impulse=body.constraintImpulse;if(body.isStatic||(impulse.x===0&&impulse.y===0&&impulse.angle===0)){continue;}
        body.position.x+=impulse.x;body.position.y+=impulse.y;body.angle+=impulse.angle;}};Constraint.solveAll=function(constraints,timeScale){for(var i=0;i<constraints.length;i+=1){var constraint=constraints[i],fixedA=!constraint.bodyA||(constraint.bodyA&&constraint.bodyA.isStatic),fixedB=!constraint.bodyB||(constraint.bodyB&&constraint.bodyB.isStatic);if(fixedA||fixedB){Constraint.solve(constraints[i],timeScale);}}
        for(i=0;i<constraints.length;i+=1){constraint=constraints[i];fixedA=!constraint.bodyA||(constraint.bodyA&&constraint.bodyA.isStatic);fixedB=!constraint.bodyB||(constraint.bodyB&&constraint.bodyB.isStatic);if(!fixedA&&!fixedB){Constraint.solve(constraints[i],timeScale);}}};Constraint.solve=function(constraint,timeScale){var bodyA=constraint.bodyA,bodyB=constraint.bodyB,pointA=constraint.pointA,pointB=constraint.pointB;if(!bodyA&&!bodyB)
        return;if(bodyA&&!bodyA.isStatic){Vector.rotate(pointA,bodyA.angle-constraint.angleA,pointA);constraint.angleA=bodyA.angle;}
        if(bodyB&&!bodyB.isStatic){Vector.rotate(pointB,bodyB.angle-constraint.angleB,pointB);constraint.angleB=bodyB.angle;}
        var pointAWorld=pointA,pointBWorld=pointB;if(bodyA)pointAWorld=Vector.add(bodyA.position,pointA);if(bodyB)pointBWorld=Vector.add(bodyB.position,pointB);if(!pointAWorld||!pointBWorld)
            return;var delta=Vector.sub(pointAWorld,pointBWorld),currentLength=Vector.magnitude(delta);if(currentLength<Constraint._minLength){currentLength=Constraint._minLength;}
        var difference=(currentLength-constraint.length)/ currentLength,stiffness=constraint.stiffness<1?constraint.stiffness*timeScale:constraint.stiffness,force=Vector.mult(delta,difference*stiffness),massTotal=(bodyA?bodyA.inverseMass:0)+(bodyB?bodyB.inverseMass:0),inertiaTotal=(bodyA?bodyA.inverseInertia:0)+(bodyB?bodyB.inverseInertia:0),resistanceTotal=massTotal+inertiaTotal,torque,share,normal,normalVelocity,relativeVelocity;if(constraint.damping){var zero=Vector.create();normal=Vector.div(delta,currentLength);relativeVelocity=Vector.sub(bodyB&&Vector.sub(bodyB.position,bodyB.positionPrev)||zero,bodyA&&Vector.sub(bodyA.position,bodyA.positionPrev)||zero);normalVelocity=Vector.dot(normal,relativeVelocity);}
        if(bodyA&&!bodyA.isStatic){share=bodyA.inverseMass / massTotal;bodyA.constraintImpulse.x-=force.x*share;bodyA.constraintImpulse.y-=force.y*share;bodyA.position.x-=force.x*share;bodyA.position.y-=force.y*share;if(constraint.damping){bodyA.positionPrev.x-=constraint.damping*normal.x*normalVelocity*share;bodyA.positionPrev.y-=constraint.damping*normal.y*normalVelocity*share;}
            torque=(Vector.cross(pointA,force)/ resistanceTotal)*Constraint._torqueDampen*bodyA.inverseInertia*(1-constraint.angularStiffness);bodyA.constraintImpulse.angle-=torque;bodyA.angle-=torque;}
        if(bodyB&&!bodyB.isStatic){share=bodyB.inverseMass / massTotal;bodyB.constraintImpulse.x+=force.x*share;bodyB.constraintImpulse.y+=force.y*share;bodyB.position.x+=force.x*share;bodyB.position.y+=force.y*share;if(constraint.damping){bodyB.positionPrev.x+=constraint.damping*normal.x*normalVelocity*share;bodyB.positionPrev.y+=constraint.damping*normal.y*normalVelocity*share;}
            torque=(Vector.cross(pointB,force)/ resistanceTotal)*Constraint._torqueDampen*bodyB.inverseInertia*(1-constraint.angularStiffness);bodyB.constraintImpulse.angle+=torque;bodyB.angle+=torque;}};Constraint.postSolveAll=function(bodies){for(var i=0;i<bodies.length;i++){var body=bodies[i],impulse=body.constraintImpulse;if(body.isStatic||(impulse.x===0&&impulse.y===0&&impulse.angle===0)){continue;}
        Sleeping.set(body,false);for(var j=0;j<body.parts.length;j++){var part=body.parts[j];Vertices.translate(part.vertices,impulse);if(j>0){part.position.x+=impulse.x;part.position.y+=impulse.y;}
            if(impulse.angle!==0){Vertices.rotate(part.vertices,impulse.angle,body.position);Axes.rotate(part.axes,impulse.angle);if(j>0){Vector.rotateAbout(part.position,impulse.angle,body.position,part.position);}}
            Bounds.update(part.bounds,part.vertices,body.velocity);}
        impulse.angle*=Constraint._warming;impulse.x*=Constraint._warming;impulse.y*=Constraint._warming;}};})();}),"./physics/matter-js/lib/core/Common.js":(function(module,exports,__webpack_require__){(function(global){var Common={};module.exports=Common;(function(){Common._nextId=0;Common._seed=0;Common._nowStartTime=+(new Date());Common.extend=function(obj,deep){var argsStart,args,deepClone;if(typeof deep==='boolean'){argsStart=2;deepClone=deep;}else{argsStart=1;deepClone=true;}
        for(var i=argsStart;i<arguments.length;i++){var source=arguments[i];if(source){for(var prop in source){if(deepClone&&source[prop]&&source[prop].constructor===Object){if(!obj[prop]||obj[prop].constructor===Object){obj[prop]=obj[prop]||{};Common.extend(obj[prop],deepClone,source[prop]);}else{obj[prop]=source[prop];}}else{obj[prop]=source[prop];}}}}
        return obj;};Common.clone=function(obj,deep){return Common.extend({},deep,obj);};Common.keys=function(obj){if(Object.keys)
        return Object.keys(obj);var keys=[];for(var key in obj)
        keys.push(key);return keys;};Common.values=function(obj){var values=[];if(Object.keys){var keys=Object.keys(obj);for(var i=0;i<keys.length;i++){values.push(obj[keys[i]]);}
        return values;}
        for(var key in obj)
            values.push(obj[key]);return values;};Common.get=function(obj,path,begin,end){path=path.split('.').slice(begin,end);for(var i=0;i<path.length;i+=1){obj=obj[path[i]];}
        return obj;};Common.set=function(obj,path,val,begin,end){var parts=path.split('.').slice(begin,end);Common.get(obj,path,0,-1)[parts[parts.length-1]]=val;return val;};Common.shuffle=function(array){for(var i=array.length-1;i>0;i--){var j=Math.floor(Common.random()*(i+1));var temp=array[i];array[i]=array[j];array[j]=temp;}
        return array;};Common.choose=function(choices){return choices[Math.floor(Common.random()*choices.length)];};Common.isElement=function(obj){if(typeof HTMLElement!=='undefined'){return obj instanceof HTMLElement;}
        return!!(obj&&obj.nodeType&&obj.nodeName);};Common.isArray=function(obj){return Object.prototype.toString.call(obj)==='[object Array]';};Common.isFunction=function(obj){return typeof obj==="function";};Common.isPlainObject=function(obj){return typeof obj==='object'&&obj.constructor===Object;};Common.isString=function(obj){return toString.call(obj)==='[object String]';};Common.clamp=function(value,min,max){if(value<min)
        return min;if(value>max)
        return max;return value;};Common.sign=function(value){return value<0?-1:1;};Common.now=function(){if(window.performance){if(window.performance.now){return window.performance.now();}else if(window.performance.webkitNow){return window.performance.webkitNow();}}
        return(new Date())-Common._nowStartTime;};Common.random=function(min,max){min=(typeof min!=="undefined")?min:0;max=(typeof max!=="undefined")?max:1;return min+_seededRandom()*(max-min);};var _seededRandom=function(){Common._seed=(Common._seed*9301+49297)%233280;return Common._seed / 233280;};Common.colorToNumber=function(colorString){colorString=colorString.replace('#','');if(colorString.length==3){colorString=colorString.charAt(0)+colorString.charAt(0)
        +colorString.charAt(1)+colorString.charAt(1)
        +colorString.charAt(2)+colorString.charAt(2);}
        return parseInt(colorString,16);};Common.logLevel=1;Common.log=function(){if(console&&Common.logLevel>0&&Common.logLevel<=3){console.log.apply(console,['matter-js:'].concat(Array.prototype.slice.call(arguments)));}};Common.info=function(){if(console&&Common.logLevel>0&&Common.logLevel<=2){console.info.apply(console,['matter-js:'].concat(Array.prototype.slice.call(arguments)));}};Common.warn=function(){if(console&&Common.logLevel>0&&Common.logLevel<=3){console.warn.apply(console,['matter-js:'].concat(Array.prototype.slice.call(arguments)));}};Common.nextId=function(){return Common._nextId++;};Common.indexOf=function(haystack,needle){if(haystack.indexOf)
        return haystack.indexOf(needle);for(var i=0;i<haystack.length;i++){if(haystack[i]===needle)
        return i;}
        return-1;};Common.map=function(list,func){if(list.map){return list.map(func);}
        var mapped=[];for(var i=0;i<list.length;i+=1){mapped.push(func(list[i]));}
        return mapped;};Common.topologicalSort=function(graph){var result=[],visited=[],temp=[];for(var node in graph){if(!visited[node]&&!temp[node]){Common._topologicalSort(node,visited,temp,graph,result);}}
        return result;};Common._topologicalSort=function(node,visited,temp,graph,result){var neighbors=graph[node]||[];temp[node]=true;for(var i=0;i<neighbors.length;i+=1){var neighbor=neighbors[i];if(temp[neighbor]){continue;}
        if(!visited[neighbor]){Common._topologicalSort(neighbor,visited,temp,graph,result);}}
        temp[node]=false;visited[node]=true;result.push(node);};Common.chain=function(){var funcs=[];for(var i=0;i<arguments.length;i+=1){var func=arguments[i];if(func._chained){funcs.push.apply(funcs,func._chained);}else{funcs.push(func);}}
        var chain=function(){var lastResult,args=new Array(arguments.length);for(var i=0,l=arguments.length;i<l;i++){args[i]=arguments[i];}
            for(i=0;i<funcs.length;i+=1){var result=funcs[i].apply(lastResult,args);if(typeof result!=='undefined'){lastResult=result;}}
            return lastResult;};chain._chained=funcs;return chain;};Common.chainPathBefore=function(base,path,func){return Common.set(base,path,Common.chain(func,Common.get(base,path)));};Common.chainPathAfter=function(base,path,func){return Common.set(base,path,Common.chain(Common.get(base,path),func));};Common._requireGlobal=function(globalName,moduleName){var obj=(typeof window!=='undefined'?window[globalName]:typeof global!=='undefined'?global[globalName]:null);return obj;};})();}.call(this,__webpack_require__("../node_modules/webpack/buildin/global.js")))}),"./physics/matter-js/lib/core/Engine.js":(function(module,exports,__webpack_require__){var Engine={};module.exports=Engine;var World=__webpack_require__("./physics/matter-js/lib/body/World.js");var Sleeping=__webpack_require__("./physics/matter-js/lib/core/Sleeping.js");var Resolver=__webpack_require__("./physics/matter-js/lib/collision/Resolver.js");var Pairs=__webpack_require__("./physics/matter-js/lib/collision/Pairs.js");var Metrics=__webpack_require__("./physics/matter-js/lib/core/Metrics.js");var Grid=__webpack_require__("./physics/matter-js/lib/collision/Grid.js");var Events=__webpack_require__("./physics/matter-js/lib/core/Events.js");var Composite=__webpack_require__("./physics/matter-js/lib/body/Composite.js");var Constraint=__webpack_require__("./physics/matter-js/lib/constraint/Constraint.js");var Common=__webpack_require__("./physics/matter-js/lib/core/Common.js");var Body=__webpack_require__("./physics/matter-js/lib/body/Body.js");(function(){Engine.create=function(element,options){options=Common.isElement(element)?options:element;element=Common.isElement(element)?element:null;options=options||{};if(element||options.render){Common.warn('Engine.create: engine.render is deprecated (see docs)');}
        var defaults={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:false,events:[],plugin:{},timing:{timestamp:0,timeScale:1},broadphase:{controller:Grid}};var engine=Common.extend(defaults,options);if(element||engine.render){var renderDefaults={element:element,controller:Render};engine.render=Common.extend(renderDefaults,engine.render);}
        if(engine.render&&engine.render.controller){engine.render=engine.render.controller.create(engine.render);}
        if(engine.render){engine.render.engine=engine;}
        engine.world=options.world||World.create(engine.world);engine.pairs=Pairs.create();engine.broadphase=engine.broadphase.controller.create(engine.broadphase);engine.metrics=engine.metrics||{extended:false};engine.metrics=Metrics.create(engine.metrics);return engine;};Engine.update=function(engine,delta,correction){delta=delta||1000 / 60;correction=correction||1;var world=engine.world,timing=engine.timing,broadphase=engine.broadphase,broadphasePairs=[],i;timing.timestamp+=delta*timing.timeScale;var event={timestamp:timing.timestamp};Events.trigger(engine,'beforeUpdate',event);var allBodies=Composite.allBodies(world),allConstraints=Composite.allConstraints(world);Metrics.reset(engine.metrics);if(engine.enableSleeping)
        Sleeping.update(allBodies,timing.timeScale);Engine._bodiesApplyGravity(allBodies,world.gravity);Engine._bodiesUpdate(allBodies,delta,timing.timeScale,correction,world.bounds);Constraint.preSolveAll(allBodies);for(i=0;i<engine.constraintIterations;i++){Constraint.solveAll(allConstraints,timing.timeScale);}
        Constraint.postSolveAll(allBodies);if(broadphase.controller){if(world.isModified)
            broadphase.controller.clear(broadphase);broadphase.controller.update(broadphase,allBodies,engine,world.isModified);broadphasePairs=broadphase.pairsList;}else{broadphasePairs=allBodies;}
        if(world.isModified){Composite.setModified(world,false,false,true);}
        var collisions=broadphase.detector(broadphasePairs,engine);var pairs=engine.pairs,timestamp=timing.timestamp;Pairs.update(pairs,collisions,timestamp);Pairs.removeOld(pairs,timestamp);if(engine.enableSleeping)
            Sleeping.afterCollisions(pairs.list,timing.timeScale);if(pairs.collisionStart.length>0)
            Events.trigger(engine,'collisionStart',{pairs:pairs.collisionStart});Resolver.preSolvePosition(pairs.list);for(i=0;i<engine.positionIterations;i++){Resolver.solvePosition(pairs.list,allBodies,timing.timeScale);}
        Resolver.postSolvePosition(allBodies);Constraint.preSolveAll(allBodies);for(i=0;i<engine.constraintIterations;i++){Constraint.solveAll(allConstraints,timing.timeScale);}
        Constraint.postSolveAll(allBodies);Resolver.preSolveVelocity(pairs.list);for(i=0;i<engine.velocityIterations;i++){Resolver.solveVelocity(pairs.list,timing.timeScale);}
        if(pairs.collisionActive.length>0)
            Events.trigger(engine,'collisionActive',{pairs:pairs.collisionActive});if(pairs.collisionEnd.length>0)
            Events.trigger(engine,'collisionEnd',{pairs:pairs.collisionEnd});Metrics.update(engine.metrics,engine);Engine._bodiesClearForces(allBodies);Events.trigger(engine,'afterUpdate',event);return engine;};Engine.merge=function(engineA,engineB){Common.extend(engineA,engineB);if(engineB.world){engineA.world=engineB.world;Engine.clear(engineA);var bodies=Composite.allBodies(engineA.world);for(var i=0;i<bodies.length;i++){var body=bodies[i];Sleeping.set(body,false);body.id=Common.nextId();}}};Engine.clear=function(engine){var world=engine.world;Pairs.clear(engine.pairs);var broadphase=engine.broadphase;if(broadphase.controller){var bodies=Composite.allBodies(world);broadphase.controller.clear(broadphase);broadphase.controller.update(broadphase,bodies,engine,true);}};Engine._bodiesClearForces=function(bodies){for(var i=0;i<bodies.length;i++){var body=bodies[i];body.force.x=0;body.force.y=0;body.torque=0;}};Engine._bodiesApplyGravity=function(bodies,gravity){var gravityScale=typeof gravity.scale!=='undefined'?gravity.scale:0.001;if((gravity.x===0&&gravity.y===0)||gravityScale===0){return;}
        for(var i=0;i<bodies.length;i++){var body=bodies[i];if(body.ignoreGravity||body.isStatic||body.isSleeping)
            continue;body.force.y+=body.mass*gravity.y*gravityScale;body.force.x+=body.mass*gravity.x*gravityScale;}};Engine._bodiesUpdate=function(bodies,deltaTime,timeScale,correction,worldBounds){for(var i=0;i<bodies.length;i++){var body=bodies[i];if(body.isStatic||body.isSleeping)
        continue;Body.update(body,deltaTime,timeScale,correction);}};})();}),"./physics/matter-js/lib/core/Events.js":(function(module,exports,__webpack_require__){var Events={};module.exports=Events;var Common=__webpack_require__("./physics/matter-js/lib/core/Common.js");(function(){Events.on=function(object,eventNames,callback){var names=eventNames.split(' '),name;for(var i=0;i<names.length;i++){name=names[i];object.events=object.events||{};object.events[name]=object.events[name]||[];object.events[name].push(callback);}
        return callback;};Events.off=function(object,eventNames,callback){if(!eventNames){object.events={};return;}
        if(typeof eventNames==='function'){callback=eventNames;eventNames=Common.keys(object.events).join(' ');}
        var names=eventNames.split(' ');for(var i=0;i<names.length;i++){var callbacks=object.events[names[i]],newCallbacks=[];if(callback&&callbacks){for(var j=0;j<callbacks.length;j++){if(callbacks[j]!==callback)
            newCallbacks.push(callbacks[j]);}}
            object.events[names[i]]=newCallbacks;}};Events.trigger=function(object,eventNames,event){var names,name,callbacks,eventClone;var events=object.events;if(events&&Common.keys(events).length>0){if(!event)
        event={};names=eventNames.split(' ');for(var i=0;i<names.length;i++){name=names[i];callbacks=events[name];if(callbacks){eventClone=Common.clone(event,false);eventClone.name=name;eventClone.source=object;for(var j=0;j<callbacks.length;j++){callbacks[j].apply(object,[eventClone]);}}}}};})();}),"./physics/matter-js/lib/core/Matter.js":(function(module,exports,__webpack_require__){var Matter={};module.exports=Matter;var Plugin=__webpack_require__("./physics/matter-js/lib/core/Plugin.js");var Common=__webpack_require__("./physics/matter-js/lib/core/Common.js");(function(){Matter.name='matter-js';Matter.version='0.14.2';Matter.uses=[];Matter.used=[];Matter.use=function(){Plugin.use(Matter,Array.prototype.slice.call(arguments));};Matter.before=function(path,func){path=path.replace(/^Matter./,'');return Common.chainPathBefore(Matter,path,func);};Matter.after=function(path,func){path=path.replace(/^Matter./,'');return Common.chainPathAfter(Matter,path,func);};})();}),"./physics/matter-js/lib/core/Metrics.js":(function(module,exports,__webpack_require__){var Metrics={};module.exports=Metrics;var Composite=__webpack_require__("./physics/matter-js/lib/body/Composite.js");var Common=__webpack_require__("./physics/matter-js/lib/core/Common.js");(function(){Metrics.create=function(options){var defaults={extended:false,narrowDetections:0,narrowphaseTests:0,narrowReuse:0,narrowReuseCount:0,midphaseTests:0,broadphaseTests:0,narrowEff:0.0001,midEff:0.0001,broadEff:0.0001,collisions:0,buckets:0,bodies:0,pairs:0};return Common.extend(defaults,false,options);};Metrics.reset=function(metrics){if(metrics.extended){metrics.narrowDetections=0;metrics.narrowphaseTests=0;metrics.narrowReuse=0;metrics.narrowReuseCount=0;metrics.midphaseTests=0;metrics.broadphaseTests=0;metrics.narrowEff=0;metrics.midEff=0;metrics.broadEff=0;metrics.collisions=0;metrics.buckets=0;metrics.pairs=0;metrics.bodies=0;}};Metrics.update=function(metrics,engine){if(metrics.extended){var world=engine.world,bodies=Composite.allBodies(world);metrics.collisions=metrics.narrowDetections;metrics.pairs=engine.pairs.list.length;metrics.bodies=bodies.length;metrics.midEff=(metrics.narrowDetections /(metrics.midphaseTests||1)).toFixed(2);metrics.narrowEff=(metrics.narrowDetections /(metrics.narrowphaseTests||1)).toFixed(2);metrics.broadEff=(1-(metrics.broadphaseTests /(bodies.length||1))).toFixed(2);metrics.narrowReuse=(metrics.narrowReuseCount /(metrics.narrowphaseTests||1)).toFixed(2);}};})();}),"./physics/matter-js/lib/core/Plugin.js":(function(module,exports,__webpack_require__){var Plugin={};module.exports=Plugin;var Common=__webpack_require__("./physics/matter-js/lib/core/Common.js");(function(){Plugin._registry={};Plugin.register=function(plugin){if(!Plugin.isPlugin(plugin)){Common.warn('Plugin.register:',Plugin.toString(plugin),'does not implement all required fields.');}
        if(plugin.name in Plugin._registry){var registered=Plugin._registry[plugin.name],pluginVersion=Plugin.versionParse(plugin.version).number,registeredVersion=Plugin.versionParse(registered.version).number;if(pluginVersion>registeredVersion){Common.warn('Plugin.register:',Plugin.toString(registered),'was upgraded to',Plugin.toString(plugin));Plugin._registry[plugin.name]=plugin;}else if(pluginVersion<registeredVersion){Common.warn('Plugin.register:',Plugin.toString(registered),'can not be downgraded to',Plugin.toString(plugin));}else if(plugin!==registered){Common.warn('Plugin.register:',Plugin.toString(plugin),'is already registered to different plugin object');}}else{Plugin._registry[plugin.name]=plugin;}
        return plugin;};Plugin.resolve=function(dependency){return Plugin._registry[Plugin.dependencyParse(dependency).name];};Plugin.toString=function(plugin){return typeof plugin==='string'?plugin:(plugin.name||'anonymous')+'@'+(plugin.version||plugin.range||'0.0.0');};Plugin.isPlugin=function(obj){return obj&&obj.name&&obj.version&&obj.install;};Plugin.isUsed=function(module,name){return module.used.indexOf(name)>-1;};Plugin.isFor=function(plugin,module){var parsed=plugin.for&&Plugin.dependencyParse(plugin.for);return!plugin.for||(module.name===parsed.name&&Plugin.versionSatisfies(module.version,parsed.range));};Plugin.use=function(module,plugins){module.uses=(module.uses||[]).concat(plugins||[]);if(module.uses.length===0){Common.warn('Plugin.use:',Plugin.toString(module),'does not specify any dependencies to install.');return;}
        var dependencies=Plugin.dependencies(module),sortedDependencies=Common.topologicalSort(dependencies),status=[];for(var i=0;i<sortedDependencies.length;i+=1){if(sortedDependencies[i]===module.name){continue;}
            var plugin=Plugin.resolve(sortedDependencies[i]);if(!plugin){status.push('❌ '+sortedDependencies[i]);continue;}
            if(Plugin.isUsed(module,plugin.name)){continue;}
            if(!Plugin.isFor(plugin,module)){Common.warn('Plugin.use:',Plugin.toString(plugin),'is for',plugin.for,'but installed on',Plugin.toString(module)+'.');plugin._warned=true;}
            if(plugin.install){plugin.install(module);}else{Common.warn('Plugin.use:',Plugin.toString(plugin),'does not specify an install function.');plugin._warned=true;}
            if(plugin._warned){status.push('🔶 '+Plugin.toString(plugin));delete plugin._warned;}else{status.push('✅ '+Plugin.toString(plugin));}
            module.used.push(plugin.name);}
        if(status.length>0&&!plugin.silent){Common.info(status.join('  '));}};Plugin.dependencies=function(module,tracked){var parsedBase=Plugin.dependencyParse(module),name=parsedBase.name;tracked=tracked||{};if(name in tracked){return;}
        module=Plugin.resolve(module)||module;tracked[name]=Common.map(module.uses||[],function(dependency){if(Plugin.isPlugin(dependency)){Plugin.register(dependency);}
            var parsed=Plugin.dependencyParse(dependency),resolved=Plugin.resolve(dependency);if(resolved&&!Plugin.versionSatisfies(resolved.version,parsed.range)){Common.warn('Plugin.dependencies:',Plugin.toString(resolved),'does not satisfy',Plugin.toString(parsed),'used by',Plugin.toString(parsedBase)+'.');resolved._warned=true;module._warned=true;}else if(!resolved){Common.warn('Plugin.dependencies:',Plugin.toString(dependency),'used by',Plugin.toString(parsedBase),'could not be resolved.');module._warned=true;}
            return parsed.name;});for(var i=0;i<tracked[name].length;i+=1){Plugin.dependencies(tracked[name][i],tracked);}
        return tracked;};Plugin.dependencyParse=function(dependency){if(Common.isString(dependency)){var pattern=/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-]+)?))?$/;if(!pattern.test(dependency)){Common.warn('Plugin.dependencyParse:',dependency,'is not a valid dependency string.');}
        return{name:dependency.split('@')[0],range:dependency.split('@')[1]||'*'};}
        return{name:dependency.name,range:dependency.range||dependency.version};};Plugin.versionParse=function(range){var pattern=/^\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-]+)?$/;if(!pattern.test(range)){Common.warn('Plugin.versionParse:',range,'is not a valid version or range.');}
        var identifiers=range.split('-');range=identifiers[0];var isRange=isNaN(Number(range[0])),version=isRange?range.substr(1):range,parts=Common.map(version.split('.'),function(part){return Number(part);});return{isRange:isRange,version:version,range:range,operator:isRange?range[0]:'',parts:parts,prerelease:identifiers[1],number:parts[0]*1e8+parts[1]*1e4+parts[2]};};Plugin.versionSatisfies=function(version,range){range=range||'*';var rangeParsed=Plugin.versionParse(range),rangeParts=rangeParsed.parts,versionParsed=Plugin.versionParse(version),versionParts=versionParsed.parts;if(rangeParsed.isRange){if(rangeParsed.operator==='*'||version==='*'){return true;}
        if(rangeParsed.operator==='~'){return versionParts[0]===rangeParts[0]&&versionParts[1]===rangeParts[1]&&versionParts[2]>=rangeParts[2];}
        if(rangeParsed.operator==='^'){if(rangeParts[0]>0){return versionParts[0]===rangeParts[0]&&versionParsed.number>=rangeParsed.number;}
            if(rangeParts[1]>0){return versionParts[1]===rangeParts[1]&&versionParts[2]>=rangeParts[2];}
            return versionParts[2]===rangeParts[2];}}
        return version===range||version==='*';};})();}),"./physics/matter-js/lib/core/Sleeping.js":(function(module,exports,__webpack_require__){var Sleeping={};module.exports=Sleeping;var Events=__webpack_require__("./physics/matter-js/lib/core/Events.js");(function(){Sleeping._motionWakeThreshold=0.18;Sleeping._motionSleepThreshold=0.08;Sleeping._minBias=0.9;Sleeping.update=function(bodies,timeScale){var timeFactor=timeScale*timeScale*timeScale;for(var i=0;i<bodies.length;i++){var body=bodies[i],motion=body.speed*body.speed+body.angularSpeed*body.angularSpeed;if(body.force.x!==0||body.force.y!==0){Sleeping.set(body,false);continue;}
        var minMotion=Math.min(body.motion,motion),maxMotion=Math.max(body.motion,motion);body.motion=Sleeping._minBias*minMotion+(1-Sleeping._minBias)*maxMotion;if(body.sleepThreshold>0&&body.motion<Sleeping._motionSleepThreshold*timeFactor){body.sleepCounter+=1;if(body.sleepCounter>=body.sleepThreshold)
            Sleeping.set(body,true);}else if(body.sleepCounter>0){body.sleepCounter-=1;}}};Sleeping.afterCollisions=function(pairs,timeScale){var timeFactor=timeScale*timeScale*timeScale;for(var i=0;i<pairs.length;i++){var pair=pairs[i];if(!pair.isActive)
        continue;var collision=pair.collision,bodyA=collision.bodyA.parent,bodyB=collision.bodyB.parent;if((bodyA.isSleeping&&bodyB.isSleeping)||bodyA.isStatic||bodyB.isStatic)
        continue;if(bodyA.isSleeping||bodyB.isSleeping){var sleepingBody=(bodyA.isSleeping&&!bodyA.isStatic)?bodyA:bodyB,movingBody=sleepingBody===bodyA?bodyB:bodyA;if(!sleepingBody.isStatic&&movingBody.motion>Sleeping._motionWakeThreshold*timeFactor){Sleeping.set(sleepingBody,false);}}}};Sleeping.set=function(body,isSleeping){var wasSleeping=body.isSleeping;if(isSleeping){body.isSleeping=true;body.sleepCounter=body.sleepThreshold;body.positionImpulse.x=0;body.positionImpulse.y=0;body.positionPrev.x=body.position.x;body.positionPrev.y=body.position.y;body.anglePrev=body.angle;body.speed=0;body.angularSpeed=0;body.motion=0;if(!wasSleeping){Events.trigger(body,'sleepStart');}}else{body.isSleeping=false;body.sleepCounter=0;if(wasSleeping){Events.trigger(body,'sleepEnd');}}};})();}),"./physics/matter-js/lib/factory/Bodies.js":(function(module,exports,__webpack_require__){var Bodies={};module.exports=Bodies;var Vertices=__webpack_require__("./physics/matter-js/lib/geometry/Vertices.js");var Common=__webpack_require__("./physics/matter-js/lib/core/Common.js");var Body=__webpack_require__("./physics/matter-js/lib/body/Body.js");var Bounds=__webpack_require__("./physics/matter-js/lib/geometry/Bounds.js");var Vector=__webpack_require__("./physics/matter-js/lib/geometry/Vector.js");var decomp=__webpack_require__("./physics/matter-js/poly-decomp/index.js");(function(){Bodies.rectangle=function(x,y,width,height,options){options=options||{};var rectangle={label:'Rectangle Body',position:{x:x,y:y},vertices:Vertices.fromPath('L 0 0 L '+width+' 0 L '+width+' '+height+' L 0 '+height)};if(options.chamfer){var chamfer=options.chamfer;rectangle.vertices=Vertices.chamfer(rectangle.vertices,chamfer.radius,chamfer.quality,chamfer.qualityMin,chamfer.qualityMax);delete options.chamfer;}
        return Body.create(Common.extend({},rectangle,options));};Bodies.trapezoid=function(x,y,width,height,slope,options){options=options||{};slope*=0.5;var roof=(1-(slope*2))*width;var x1=width*slope,x2=x1+roof,x3=x2+x1,verticesPath;if(slope<0.5){verticesPath='L 0 0 L '+x1+' '+(-height)+' L '+x2+' '+(-height)+' L '+x3+' 0';}else{verticesPath='L 0 0 L '+x2+' '+(-height)+' L '+x3+' 0';}
        var trapezoid={label:'Trapezoid Body',position:{x:x,y:y},vertices:Vertices.fromPath(verticesPath)};if(options.chamfer){var chamfer=options.chamfer;trapezoid.vertices=Vertices.chamfer(trapezoid.vertices,chamfer.radius,chamfer.quality,chamfer.qualityMin,chamfer.qualityMax);delete options.chamfer;}
        return Body.create(Common.extend({},trapezoid,options));};Bodies.circle=function(x,y,radius,options,maxSides){options=options||{};var circle={label:'Circle Body',circleRadius:radius};maxSides=maxSides||25;var sides=Math.ceil(Math.max(10,Math.min(maxSides,radius)));if(sides%2===1)
        sides+=1;return Bodies.polygon(x,y,sides,radius,Common.extend({},circle,options));};Bodies.polygon=function(x,y,sides,radius,options){options=options||{};if(sides<3)
        return Bodies.circle(x,y,radius,options);var theta=2*Math.PI / sides,path='',offset=theta*0.5;for(var i=0;i<sides;i+=1){var angle=offset+(i*theta),xx=Math.cos(angle)*radius,yy=Math.sin(angle)*radius;path+='L '+xx.toFixed(3)+' '+yy.toFixed(3)+' ';}
        var polygon={label:'Polygon Body',position:{x:x,y:y},vertices:Vertices.fromPath(path)};if(options.chamfer){var chamfer=options.chamfer;polygon.vertices=Vertices.chamfer(polygon.vertices,chamfer.radius,chamfer.quality,chamfer.qualityMin,chamfer.qualityMax);delete options.chamfer;}
        return Body.create(Common.extend({},polygon,options));};Bodies.fromVertices=function(x,y,vertexSets,options,flagInternal,removeCollinear,minimumArea){var body,parts,isConvex,vertices,i,j,k,v,z;options=options||{};parts=[];flagInternal=typeof flagInternal!=='undefined'?flagInternal:false;removeCollinear=typeof removeCollinear!=='undefined'?removeCollinear:0.01;minimumArea=typeof minimumArea!=='undefined'?minimumArea:10;if(!decomp){Common.warn('Bodies.fromVertices: poly-decomp.js required. Could not decompose vertices. Fallback to convex hull.');}
        if(!Common.isArray(vertexSets[0])){vertexSets=[vertexSets];}
        for(v=0;v<vertexSets.length;v+=1){vertices=vertexSets[v];isConvex=Vertices.isConvex(vertices);if(isConvex||!decomp){if(isConvex){vertices=Vertices.clockwiseSort(vertices);}else{vertices=Vertices.hull(vertices);}
            parts.push({position:{x:x,y:y},vertices:vertices});}else{var concave=vertices.map(function(vertex){return[vertex.x,vertex.y];});decomp.makeCCW(concave);if(removeCollinear!==false)
            decomp.removeCollinearPoints(concave,removeCollinear);var decomposed=decomp.quickDecomp(concave);for(i=0;i<decomposed.length;i++){var chunk=decomposed[i];var chunkVertices=chunk.map(function(vertices){return{x:vertices[0],y:vertices[1]};});if(minimumArea>0&&Vertices.area(chunkVertices)<minimumArea)
            continue;parts.push({position:Vertices.centre(chunkVertices),vertices:chunkVertices});}}}
        for(i=0;i<parts.length;i++){parts[i]=Body.create(Common.extend(parts[i],options));}
        if(flagInternal){var coincident_max_dist=5;for(i=0;i<parts.length;i++){var partA=parts[i];for(j=i+1;j<parts.length;j++){var partB=parts[j];if(Bounds.overlaps(partA.bounds,partB.bounds)){var pav=partA.vertices,pbv=partB.vertices;for(k=0;k<partA.vertices.length;k++){for(z=0;z<partB.vertices.length;z++){var da=Vector.magnitudeSquared(Vector.sub(pav[(k+1)%pav.length],pbv[z])),db=Vector.magnitudeSquared(Vector.sub(pav[k],pbv[(z+1)%pbv.length]));if(da<coincident_max_dist&&db<coincident_max_dist){pav[k].isInternal=true;pbv[z].isInternal=true;}}}}}}}
        if(parts.length>1){body=Body.create(Common.extend({parts:parts.slice(0)},options));Body.setPosition(body,{x:x,y:y});return body;}else{return parts[0];}};})();}),"./physics/matter-js/lib/factory/Composites.js":(function(module,exports,__webpack_require__){var Composites={};module.exports=Composites;var Composite=__webpack_require__("./physics/matter-js/lib/body/Composite.js");var Constraint=__webpack_require__("./physics/matter-js/lib/constraint/Constraint.js");var Common=__webpack_require__("./physics/matter-js/lib/core/Common.js");var Body=__webpack_require__("./physics/matter-js/lib/body/Body.js");var Bodies=__webpack_require__("./physics/matter-js/lib/factory/Bodies.js");(function(){Composites.stack=function(xx,yy,columns,rows,columnGap,rowGap,callback){var stack=Composite.create({label:'Stack'}),x=xx,y=yy,lastBody,i=0;for(var row=0;row<rows;row++){var maxHeight=0;for(var column=0;column<columns;column++){var body=callback(x,y,column,row,lastBody,i);if(body){var bodyHeight=body.bounds.max.y-body.bounds.min.y,bodyWidth=body.bounds.max.x-body.bounds.min.x;if(bodyHeight>maxHeight)
        maxHeight=bodyHeight;Body.translate(body,{x:bodyWidth*0.5,y:bodyHeight*0.5});x=body.bounds.max.x+columnGap;Composite.addBody(stack,body);lastBody=body;i+=1;}else{x+=columnGap;}}
        y+=maxHeight+rowGap;x=xx;}
        return stack;};Composites.chain=function(composite,xOffsetA,yOffsetA,xOffsetB,yOffsetB,options){var bodies=composite.bodies;for(var i=1;i<bodies.length;i++){var bodyA=bodies[i-1],bodyB=bodies[i],bodyAHeight=bodyA.bounds.max.y-bodyA.bounds.min.y,bodyAWidth=bodyA.bounds.max.x-bodyA.bounds.min.x,bodyBHeight=bodyB.bounds.max.y-bodyB.bounds.min.y,bodyBWidth=bodyB.bounds.max.x-bodyB.bounds.min.x;var defaults={bodyA:bodyA,pointA:{x:bodyAWidth*xOffsetA,y:bodyAHeight*yOffsetA},bodyB:bodyB,pointB:{x:bodyBWidth*xOffsetB,y:bodyBHeight*yOffsetB}};var constraint=Common.extend(defaults,options);Composite.addConstraint(composite,Constraint.create(constraint));}
        composite.label+=' Chain';return composite;};Composites.mesh=function(composite,columns,rows,crossBrace,options){var bodies=composite.bodies,row,col,bodyA,bodyB,bodyC;for(row=0;row<rows;row++){for(col=1;col<columns;col++){bodyA=bodies[(col-1)+(row*columns)];bodyB=bodies[col+(row*columns)];Composite.addConstraint(composite,Constraint.create(Common.extend({bodyA:bodyA,bodyB:bodyB},options)));}
        if(row>0){for(col=0;col<columns;col++){bodyA=bodies[col+((row-1)*columns)];bodyB=bodies[col+(row*columns)];Composite.addConstraint(composite,Constraint.create(Common.extend({bodyA:bodyA,bodyB:bodyB},options)));if(crossBrace&&col>0){bodyC=bodies[(col-1)+((row-1)*columns)];Composite.addConstraint(composite,Constraint.create(Common.extend({bodyA:bodyC,bodyB:bodyB},options)));}
            if(crossBrace&&col<columns-1){bodyC=bodies[(col+1)+((row-1)*columns)];Composite.addConstraint(composite,Constraint.create(Common.extend({bodyA:bodyC,bodyB:bodyB},options)));}}}}
        composite.label+=' Mesh';return composite;};Composites.pyramid=function(xx,yy,columns,rows,columnGap,rowGap,callback){return Composites.stack(xx,yy,columns,rows,columnGap,rowGap,function(x,y,column,row,lastBody,i){var actualRows=Math.min(rows,Math.ceil(columns / 2)),lastBodyWidth=lastBody?lastBody.bounds.max.x-lastBody.bounds.min.x:0;if(row>actualRows)
        return;row=actualRows-row;var start=row,end=columns-1-row;if(column<start||column>end)
        return;if(i===1){Body.translate(lastBody,{x:(column+(columns%2===1?1:-1))*lastBodyWidth,y:0});}
        var xOffset=lastBody?column*lastBodyWidth:0;return callback(xx+xOffset+column*columnGap,y,column,row,lastBody,i);});};Composites.newtonsCradle=function(xx,yy,number,size,length){var newtonsCradle=Composite.create({label:'Newtons Cradle'});for(var i=0;i<number;i++){var separation=1.9,circle=Bodies.circle(xx+i*(size*separation),yy+length,size,{inertia:Infinity,restitution:1,friction:0,frictionAir:0.0001,slop:1}),constraint=Constraint.create({pointA:{x:xx+i*(size*separation),y:yy},bodyB:circle});Composite.addBody(newtonsCradle,circle);Composite.addConstraint(newtonsCradle,constraint);}
        return newtonsCradle;};Composites.car=function(xx,yy,width,height,wheelSize){var group=Body.nextGroup(true),wheelBase=20,wheelAOffset=-width*0.5+wheelBase,wheelBOffset=width*0.5-wheelBase,wheelYOffset=0;var car=Composite.create({label:'Car'}),body=Bodies.rectangle(xx,yy,width,height,{collisionFilter:{group:group},chamfer:{radius:height*0.5},density:0.0002});var wheelA=Bodies.circle(xx+wheelAOffset,yy+wheelYOffset,wheelSize,{collisionFilter:{group:group},friction:0.8});var wheelB=Bodies.circle(xx+wheelBOffset,yy+wheelYOffset,wheelSize,{collisionFilter:{group:group},friction:0.8});var axelA=Constraint.create({bodyB:body,pointB:{x:wheelAOffset,y:wheelYOffset},bodyA:wheelA,stiffness:1,length:0});var axelB=Constraint.create({bodyB:body,pointB:{x:wheelBOffset,y:wheelYOffset},bodyA:wheelB,stiffness:1,length:0});Composite.addBody(car,body);Composite.addBody(car,wheelA);Composite.addBody(car,wheelB);Composite.addConstraint(car,axelA);Composite.addConstraint(car,axelB);return car;};Composites.softBody=function(xx,yy,columns,rows,columnGap,rowGap,crossBrace,particleRadius,particleOptions,constraintOptions){particleOptions=Common.extend({inertia:Infinity},particleOptions);constraintOptions=Common.extend({stiffness:0.2,render:{type:'line',anchors:false}},constraintOptions);var softBody=Composites.stack(xx,yy,columns,rows,columnGap,rowGap,function(x,y){return Bodies.circle(x,y,particleRadius,particleOptions);});Composites.mesh(softBody,columns,rows,crossBrace,constraintOptions);softBody.label='Soft Body';return softBody;};})();}),"./physics/matter-js/lib/geometry/Axes.js":(function(module,exports,__webpack_require__){var Axes={};module.exports=Axes;var Vector=__webpack_require__("./physics/matter-js/lib/geometry/Vector.js");var Common=__webpack_require__("./physics/matter-js/lib/core/Common.js");(function(){Axes.fromVertices=function(vertices){var axes={};for(var i=0;i<vertices.length;i++){var j=(i+1)%vertices.length,normal=Vector.normalise({x:vertices[j].y-vertices[i].y,y:vertices[i].x-vertices[j].x}),gradient=(normal.y===0)?Infinity:(normal.x / normal.y);gradient=gradient.toFixed(3).toString();axes[gradient]=normal;}
        return Common.values(axes);};Axes.rotate=function(axes,angle){if(angle===0)
        return;var cos=Math.cos(angle),sin=Math.sin(angle);for(var i=0;i<axes.length;i++){var axis=axes[i],xx;xx=axis.x*cos-axis.y*sin;axis.y=axis.x*sin+axis.y*cos;axis.x=xx;}};})();}),"./physics/matter-js/lib/geometry/Bounds.js":(function(module,exports){var Bounds={};module.exports=Bounds;(function(){Bounds.create=function(vertices){var bounds={min:{x:0,y:0},max:{x:0,y:0}};if(vertices)
        Bounds.update(bounds,vertices);return bounds;};Bounds.update=function(bounds,vertices,velocity){bounds.min.x=Infinity;bounds.max.x=-Infinity;bounds.min.y=Infinity;bounds.max.y=-Infinity;for(var i=0;i<vertices.length;i++){var vertex=vertices[i];if(vertex.x>bounds.max.x)bounds.max.x=vertex.x;if(vertex.x<bounds.min.x)bounds.min.x=vertex.x;if(vertex.y>bounds.max.y)bounds.max.y=vertex.y;if(vertex.y<bounds.min.y)bounds.min.y=vertex.y;}
        if(velocity){if(velocity.x>0){bounds.max.x+=velocity.x;}else{bounds.min.x+=velocity.x;}
            if(velocity.y>0){bounds.max.y+=velocity.y;}else{bounds.min.y+=velocity.y;}}};Bounds.contains=function(bounds,point){return point.x>=bounds.min.x&&point.x<=bounds.max.x&&point.y>=bounds.min.y&&point.y<=bounds.max.y;};Bounds.overlaps=function(boundsA,boundsB){return(boundsA.min.x<=boundsB.max.x&&boundsA.max.x>=boundsB.min.x&&boundsA.max.y>=boundsB.min.y&&boundsA.min.y<=boundsB.max.y);};Bounds.translate=function(bounds,vector){bounds.min.x+=vector.x;bounds.max.x+=vector.x;bounds.min.y+=vector.y;bounds.max.y+=vector.y;};Bounds.shift=function(bounds,position){var deltaX=bounds.max.x-bounds.min.x,deltaY=bounds.max.y-bounds.min.y;bounds.min.x=position.x;bounds.max.x=position.x+deltaX;bounds.min.y=position.y;bounds.max.y=position.y+deltaY;};})();}),"./physics/matter-js/lib/geometry/Svg.js":(function(module,exports,__webpack_require__){var Svg={};module.exports=Svg;var Bounds=__webpack_require__("./physics/matter-js/lib/geometry/Bounds.js");var Common=__webpack_require__("./physics/matter-js/lib/core/Common.js");(function(){Svg.pathToVertices=function(path,sampleLength){if(typeof window!=='undefined'&&!('SVGPathSeg'in window)){Common.warn('Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.');}
        var i,il,total,point,segment,segments,segmentsQueue,lastSegment,lastPoint,segmentIndex,points=[],lx,ly,length=0,x=0,y=0;sampleLength=sampleLength||15;var addPoint=function(px,py,pathSegType){var isRelative=pathSegType%2===1&&pathSegType>1;if(!lastPoint||px!=lastPoint.x||py!=lastPoint.y){if(lastPoint&&isRelative){lx=lastPoint.x;ly=lastPoint.y;}else{lx=0;ly=0;}
            var point={x:lx+px,y:ly+py};if(isRelative||!lastPoint){lastPoint=point;}
            points.push(point);x=lx+px;y=ly+py;}};var addSegmentPoint=function(segment){var segType=segment.pathSegTypeAsLetter.toUpperCase();if(segType==='Z')
            return;switch(segType){case'M':case'L':case'T':case'C':case'S':case'Q':x=segment.x;y=segment.y;break;case'H':x=segment.x;break;case'V':y=segment.y;break;}
            addPoint(x,y,segment.pathSegType);};Svg._svgPathToAbsolute(path);total=path.getTotalLength();segments=[];for(i=0;i<path.pathSegList.numberOfItems;i+=1)
            segments.push(path.pathSegList.getItem(i));segmentsQueue=segments.concat();while(length<total){segmentIndex=path.getPathSegAtLength(length);segment=segments[segmentIndex];if(segment!=lastSegment){while(segmentsQueue.length&&segmentsQueue[0]!=segment)
            addSegmentPoint(segmentsQueue.shift());lastSegment=segment;}
            switch(segment.pathSegTypeAsLetter.toUpperCase()){case'C':case'T':case'S':case'Q':case'A':point=path.getPointAtLength(length);addPoint(point.x,point.y,0);break;}
            length+=sampleLength;}
        for(i=0,il=segmentsQueue.length;i<il;++i)
            addSegmentPoint(segmentsQueue[i]);return points;};Svg._svgPathToAbsolute=function(path){var x0,y0,x1,y1,x2,y2,segs=path.pathSegList,x=0,y=0,len=segs.numberOfItems;for(var i=0;i<len;++i){var seg=segs.getItem(i),segType=seg.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(segType)){if('x'in seg)x=seg.x;if('y'in seg)y=seg.y;}else{if('x1'in seg)x1=x+seg.x1;if('x2'in seg)x2=x+seg.x2;if('y1'in seg)y1=y+seg.y1;if('y2'in seg)y2=y+seg.y2;if('x'in seg)x+=seg.x;if('y'in seg)y+=seg.y;switch(segType){case'm':segs.replaceItem(path.createSVGPathSegMovetoAbs(x,y),i);break;case'l':segs.replaceItem(path.createSVGPathSegLinetoAbs(x,y),i);break;case'h':segs.replaceItem(path.createSVGPathSegLinetoHorizontalAbs(x),i);break;case'v':segs.replaceItem(path.createSVGPathSegLinetoVerticalAbs(y),i);break;case'c':segs.replaceItem(path.createSVGPathSegCurvetoCubicAbs(x,y,x1,y1,x2,y2),i);break;case's':segs.replaceItem(path.createSVGPathSegCurvetoCubicSmoothAbs(x,y,x2,y2),i);break;case'q':segs.replaceItem(path.createSVGPathSegCurvetoQuadraticAbs(x,y,x1,y1),i);break;case't':segs.replaceItem(path.createSVGPathSegCurvetoQuadraticSmoothAbs(x,y),i);break;case'a':segs.replaceItem(path.createSVGPathSegArcAbs(x,y,seg.r1,seg.r2,seg.angle,seg.largeArcFlag,seg.sweepFlag),i);break;case'z':case'Z':x=x0;y=y0;break;}}
        if(segType=='M'||segType=='m'){x0=x;y0=y;}}};})();}),"./physics/matter-js/lib/geometry/Vector.js":(function(module,exports){var Vector={};module.exports=Vector;(function(){Vector.create=function(x,y){return{x:x||0,y:y||0};};Vector.clone=function(vector){return{x:vector.x,y:vector.y};};Vector.magnitude=function(vector){return Math.sqrt((vector.x*vector.x)+(vector.y*vector.y));};Vector.magnitudeSquared=function(vector){return(vector.x*vector.x)+(vector.y*vector.y);};Vector.rotate=function(vector,angle,output){var cos=Math.cos(angle),sin=Math.sin(angle);if(!output)output={};var x=vector.x*cos-vector.y*sin;output.y=vector.x*sin+vector.y*cos;output.x=x;return output;};Vector.rotateAbout=function(vector,angle,point,output){var cos=Math.cos(angle),sin=Math.sin(angle);if(!output)output={};var x=point.x+((vector.x-point.x)*cos-(vector.y-point.y)*sin);output.y=point.y+((vector.x-point.x)*sin+(vector.y-point.y)*cos);output.x=x;return output;};Vector.normalise=function(vector){var magnitude=Vector.magnitude(vector);if(magnitude===0)
        return{x:0,y:0};return{x:vector.x / magnitude,y:vector.y / magnitude};};Vector.dot=function(vectorA,vectorB){return(vectorA.x*vectorB.x)+(vectorA.y*vectorB.y);};Vector.cross=function(vectorA,vectorB){return(vectorA.x*vectorB.y)-(vectorA.y*vectorB.x);};Vector.cross3=function(vectorA,vectorB,vectorC){return(vectorB.x-vectorA.x)*(vectorC.y-vectorA.y)-(vectorB.y-vectorA.y)*(vectorC.x-vectorA.x);};Vector.add=function(vectorA,vectorB,output){if(!output)output={};output.x=vectorA.x+vectorB.x;output.y=vectorA.y+vectorB.y;return output;};Vector.sub=function(vectorA,vectorB,output){if(!output)output={};output.x=vectorA.x-vectorB.x;output.y=vectorA.y-vectorB.y;return output;};Vector.mult=function(vector,scalar){return{x:vector.x*scalar,y:vector.y*scalar};};Vector.div=function(vector,scalar){return{x:vector.x / scalar,y:vector.y / scalar};};Vector.perp=function(vector,negate){negate=negate===true?-1:1;return{x:negate*-vector.y,y:negate*vector.x};};Vector.neg=function(vector){return{x:-vector.x,y:-vector.y};};Vector.angle=function(vectorA,vectorB){return Math.atan2(vectorB.y-vectorA.y,vectorB.x-vectorA.x);};Vector._temp=[Vector.create(),Vector.create(),Vector.create(),Vector.create(),Vector.create(),Vector.create()];})();}),"./physics/matter-js/lib/geometry/Vertices.js":(function(module,exports,__webpack_require__){var Vertices={};module.exports=Vertices;var Vector=__webpack_require__("./physics/matter-js/lib/geometry/Vector.js");var Common=__webpack_require__("./physics/matter-js/lib/core/Common.js");(function(){Vertices.create=function(points,body){var vertices=[];for(var i=0;i<points.length;i++){var point=points[i],vertex={x:point.x,y:point.y,index:i,body:body,isInternal:false,contact:null};vertex.contact={vertex:vertex,normalImpulse:0,tangentImpulse:0};vertices.push(vertex);}
        return vertices;};Vertices.fromPath=function(path,body){var pathPattern=/L?\s*([\-\d\.e]+)[\s,]*([\-\d\.e]+)*/ig,points=[];path.replace(pathPattern,function(match,x,y){points.push({x:parseFloat(x),y:parseFloat(y)});});return Vertices.create(points,body);};Vertices.centre=function(vertices){var area=Vertices.area(vertices,true),centre={x:0,y:0},cross,temp,j;for(var i=0;i<vertices.length;i++){j=(i+1)%vertices.length;cross=Vector.cross(vertices[i],vertices[j]);temp=Vector.mult(Vector.add(vertices[i],vertices[j]),cross);centre=Vector.add(centre,temp);}
        return Vector.div(centre,6*area);};Vertices.mean=function(vertices){var average={x:0,y:0};for(var i=0;i<vertices.length;i++){average.x+=vertices[i].x;average.y+=vertices[i].y;}
        return Vector.div(average,vertices.length);};Vertices.area=function(vertices,signed){var area=0,j=vertices.length-1;for(var i=0;i<vertices.length;i++){area+=(vertices[j].x-vertices[i].x)*(vertices[j].y+vertices[i].y);j=i;}
        if(signed)
            return area / 2;return Math.abs(area)/ 2;};Vertices.inertia=function(vertices,mass){var numerator=0,denominator=0,v=vertices,cross,j;for(var n=0;n<v.length;n++){j=(n+1)%v.length;cross=Math.abs(Vector.cross(v[j],v[n]));numerator+=cross*(Vector.dot(v[j],v[j])+Vector.dot(v[j],v[n])+Vector.dot(v[n],v[n]));denominator+=cross;}
        return(mass / 6)*(numerator / denominator);};Vertices.translate=function(vertices,vector,scalar){var i;if(scalar){for(i=0;i<vertices.length;i++){vertices[i].x+=vector.x*scalar;vertices[i].y+=vector.y*scalar;}}else{for(i=0;i<vertices.length;i++){vertices[i].x+=vector.x;vertices[i].y+=vector.y;}}
        return vertices;};Vertices.rotate=function(vertices,angle,point){if(angle===0)
        return;var cos=Math.cos(angle),sin=Math.sin(angle);for(var i=0;i<vertices.length;i++){var vertice=vertices[i],dx=vertice.x-point.x,dy=vertice.y-point.y;vertice.x=point.x+(dx*cos-dy*sin);vertice.y=point.y+(dx*sin+dy*cos);}
        return vertices;};Vertices.contains=function(vertices,point){for(var i=0;i<vertices.length;i++){var vertice=vertices[i],nextVertice=vertices[(i+1)%vertices.length];if((point.x-vertice.x)*(nextVertice.y-vertice.y)+(point.y-vertice.y)*(vertice.x-nextVertice.x)>0){return false;}}
        return true;};Vertices.scale=function(vertices,scaleX,scaleY,point){if(scaleX===1&&scaleY===1)
        return vertices;point=point||Vertices.centre(vertices);var vertex,delta;for(var i=0;i<vertices.length;i++){vertex=vertices[i];delta=Vector.sub(vertex,point);vertices[i].x=point.x+delta.x*scaleX;vertices[i].y=point.y+delta.y*scaleY;}
        return vertices;};Vertices.chamfer=function(vertices,radius,quality,qualityMin,qualityMax){if(typeof radius==='number'){radius=[radius];}else{radius=radius||[8];}
        quality=(typeof quality!=='undefined')?quality:-1;qualityMin=qualityMin||2;qualityMax=qualityMax||14;var newVertices=[];for(var i=0;i<vertices.length;i++){var prevVertex=vertices[i-1>=0?i-1:vertices.length-1],vertex=vertices[i],nextVertex=vertices[(i+1)%vertices.length],currentRadius=radius[i<radius.length?i:radius.length-1];if(currentRadius===0){newVertices.push(vertex);continue;}
            var prevNormal=Vector.normalise({x:vertex.y-prevVertex.y,y:prevVertex.x-vertex.x});var nextNormal=Vector.normalise({x:nextVertex.y-vertex.y,y:vertex.x-nextVertex.x});var diagonalRadius=Math.sqrt(2*Math.pow(currentRadius,2)),radiusVector=Vector.mult(Common.clone(prevNormal),currentRadius),midNormal=Vector.normalise(Vector.mult(Vector.add(prevNormal,nextNormal),0.5)),scaledVertex=Vector.sub(vertex,Vector.mult(midNormal,diagonalRadius));var precision=quality;if(quality===-1){precision=Math.pow(currentRadius,0.32)*1.75;}
            precision=Common.clamp(precision,qualityMin,qualityMax);if(precision%2===1)
                precision+=1;var alpha=Math.acos(Vector.dot(prevNormal,nextNormal)),theta=alpha / precision;for(var j=0;j<precision;j++){newVertices.push(Vector.add(Vector.rotate(radiusVector,theta*j),scaledVertex));}}
        return newVertices;};Vertices.clockwiseSort=function(vertices){var centre=Vertices.mean(vertices);vertices.sort(function(vertexA,vertexB){return Vector.angle(centre,vertexA)-Vector.angle(centre,vertexB);});return vertices;};Vertices.isConvex=function(vertices){var flag=0,n=vertices.length,i,j,k,z;if(n<3)
        return null;for(i=0;i<n;i++){j=(i+1)%n;k=(i+2)%n;z=(vertices[j].x-vertices[i].x)*(vertices[k].y-vertices[j].y);z-=(vertices[j].y-vertices[i].y)*(vertices[k].x-vertices[j].x);if(z<0){flag|=1;}else if(z>0){flag|=2;}
        if(flag===3){return false;}}
        if(flag!==0){return true;}else{return null;}};Vertices.hull=function(vertices){var upper=[],lower=[],vertex,i;vertices=vertices.slice(0);vertices.sort(function(vertexA,vertexB){var dx=vertexA.x-vertexB.x;return dx!==0?dx:vertexA.y-vertexB.y;});for(i=0;i<vertices.length;i+=1){vertex=vertices[i];while(lower.length>=2&&Vector.cross3(lower[lower.length-2],lower[lower.length-1],vertex)<=0){lower.pop();}
        lower.push(vertex);}
        for(i=vertices.length-1;i>=0;i-=1){vertex=vertices[i];while(upper.length>=2&&Vector.cross3(upper[upper.length-2],upper[upper.length-1],vertex)<=0){upper.pop();}
            upper.push(vertex);}
        upper.pop();lower.pop();return upper.concat(lower);};})();}),"./physics/matter-js/lib/plugins/MatterAttractors.js":(function(module,exports,__webpack_require__){var Matter=__webpack_require__("./physics/matter-js/CustomMain.js");var MatterAttractors={name:'matter-attractors',version:'0.1.7',for:'matter-js@^0.13.1',silent:true,install:function(base){base.after('Body.create',function(){MatterAttractors.Body.init(this);});base.before('Engine.update',function(engine){MatterAttractors.Engine.update(engine);});},Body:{init:function(body){body.plugin.attractors=body.plugin.attractors||[];}},Engine:{update:function(engine){var world=engine.world,bodies=Matter.Composite.allBodies(world);for(var i=0;i<bodies.length;i+=1){var bodyA=bodies[i],attractors=bodyA.plugin.attractors;if(attractors&&attractors.length>0){for(var j=i+1;j<bodies.length;j+=1){var bodyB=bodies[j];for(var k=0;k<attractors.length;k+=1){var attractor=attractors[k],forceVector=attractor;if(Matter.Common.isFunction(attractor)){forceVector=attractor(bodyA,bodyB);}
                if(forceVector){Matter.Body.applyForce(bodyB,bodyB.position,forceVector);}}}}}}},Attractors:{gravityConstant:0.001,gravity:function(bodyA,bodyB){var bToA=Matter.Vector.sub(bodyB.position,bodyA.position),distanceSq=Matter.Vector.magnitudeSquared(bToA)||0.0001,normal=Matter.Vector.normalise(bToA),magnitude=-MatterAttractors.Attractors.gravityConstant*(bodyA.mass*bodyB.mass / distanceSq),force=Matter.Vector.mult(normal,magnitude);Matter.Body.applyForce(bodyA,bodyA.position,Matter.Vector.neg(force));Matter.Body.applyForce(bodyB,bodyB.position,force);}}};module.exports=MatterAttractors;}),"./physics/matter-js/lib/plugins/MatterWrap.js":(function(module,exports,__webpack_require__){var Matter=__webpack_require__("./physics/matter-js/CustomMain.js");var MatterWrap={name:'matter-wrap',version:'0.1.4',for:'matter-js@^0.13.1',silent:true,install:function(base){base.after('Engine.update',function(){MatterWrap.Engine.update(this);});},Engine:{update:function(engine){var world=engine.world,bodies=Matter.Composite.allBodies(world),composites=Matter.Composite.allComposites(world);for(var i=0;i<bodies.length;i+=1){var body=bodies[i];if(body.plugin.wrap){MatterWrap.Body.wrap(body,body.plugin.wrap);}}
                for(i=0;i<composites.length;i+=1){var composite=composites[i];if(composite.plugin.wrap){MatterWrap.Composite.wrap(composite,composite.plugin.wrap);}}}},Bounds:{wrap:function(objectBounds,bounds){var x=null,y=null;if(typeof bounds.min.x!=='undefined'&&typeof bounds.max.x!=='undefined'){if(objectBounds.min.x>bounds.max.x){x=bounds.min.x-objectBounds.max.x;}else if(objectBounds.max.x<bounds.min.x){x=bounds.max.x-objectBounds.min.x;}}
                if(typeof bounds.min.y!=='undefined'&&typeof bounds.max.y!=='undefined'){if(objectBounds.min.y>bounds.max.y){y=bounds.min.y-objectBounds.max.y;}else if(objectBounds.max.y<bounds.min.y){y=bounds.max.y-objectBounds.min.y;}}
                if(x!==null||y!==null){return{x:x||0,y:y||0};}}},Body:{wrap:function(body,bounds){var translation=MatterWrap.Bounds.wrap(body.bounds,bounds);if(translation){Matter.Body.translate(body,translation);}
                return translation;}},Composite:{bounds:function(composite){var bodies=Matter.Composite.allBodies(composite),vertices=[];for(var i=0;i<bodies.length;i+=1){var body=bodies[i];vertices.push(body.bounds.min,body.bounds.max);}
                return Matter.Bounds.create(vertices);},wrap:function(composite,bounds){var translation=MatterWrap.Bounds.wrap(MatterWrap.Composite.bounds(composite),bounds);if(translation){Matter.Composite.translate(composite,translation);}
                return translation;}}};module.exports=MatterWrap;}),"./physics/matter-js/poly-decomp/index.js":(function(module,exports){module.exports={decomp:polygonDecomp,quickDecomp:polygonQuickDecomp,isSimple:polygonIsSimple,removeCollinearPoints:polygonRemoveCollinearPoints,removeDuplicatePoints:polygonRemoveDuplicatePoints,makeCCW:polygonMakeCCW};function lineInt(l1,l2,precision){precision=precision||0;var i=[0,0];var a1,b1,c1,a2,b2,c2,det;a1=l1[1][1]-l1[0][1];b1=l1[0][0]-l1[1][0];c1=a1*l1[0][0]+b1*l1[0][1];a2=l2[1][1]-l2[0][1];b2=l2[0][0]-l2[1][0];c2=a2*l2[0][0]+b2*l2[0][1];det=a1*b2-a2*b1;if(!scalar_eq(det,0,precision)){i[0]=(b2*c1-b1*c2)/ det;i[1]=(a1*c2-a2*c1)/ det;}
        return i;}
        function lineSegmentsIntersect(p1,p2,q1,q2){var dx=p2[0]-p1[0];var dy=p2[1]-p1[1];var da=q2[0]-q1[0];var db=q2[1]-q1[1];if((da*dy-db*dx)===0){return false;}
            var s=(dx*(q1[1]-p1[1])+dy*(p1[0]-q1[0]))/(da*dy-db*dx);var t=(da*(p1[1]-q1[1])+db*(q1[0]-p1[0]))/(db*dx-da*dy);return(s>=0&&s<=1&&t>=0&&t<=1);}
        function triangleArea(a,b,c){return(((b[0]-a[0])*(c[1]-a[1]))-((c[0]-a[0])*(b[1]-a[1])));}
        function isLeft(a,b,c){return triangleArea(a,b,c)>0;}
        function isLeftOn(a,b,c){return triangleArea(a,b,c)>=0;}
        function isRight(a,b,c){return triangleArea(a,b,c)<0;}
        function isRightOn(a,b,c){return triangleArea(a,b,c)<=0;}
        var tmpPoint1=[],tmpPoint2=[];function collinear(a,b,c,thresholdAngle){if(!thresholdAngle){return triangleArea(a,b,c)===0;}else{var ab=tmpPoint1,bc=tmpPoint2;ab[0]=b[0]-a[0];ab[1]=b[1]-a[1];bc[0]=c[0]-b[0];bc[1]=c[1]-b[1];var dot=ab[0]*bc[0]+ab[1]*bc[1],magA=Math.sqrt(ab[0]*ab[0]+ab[1]*ab[1]),magB=Math.sqrt(bc[0]*bc[0]+bc[1]*bc[1]),angle=Math.acos(dot/(magA*magB));return angle<thresholdAngle;}}
        function sqdist(a,b){var dx=b[0]-a[0];var dy=b[1]-a[1];return dx*dx+dy*dy;}
        function polygonAt(polygon,i){var s=polygon.length;return polygon[i<0?i%s+s:i%s];}
        function polygonClear(polygon){polygon.length=0;}
        function polygonAppend(polygon,poly,from,to){for(var i=from;i<to;i++){polygon.push(poly[i]);}}
        function polygonMakeCCW(polygon){var br=0,v=polygon;for(var i=1;i<polygon.length;++i){if(v[i][1]<v[br][1]||(v[i][1]===v[br][1]&&v[i][0]>v[br][0])){br=i;}}
            if(!isLeft(polygonAt(polygon,br-1),polygonAt(polygon,br),polygonAt(polygon,br+1))){polygonReverse(polygon);return true;}else{return false;}}
        function polygonReverse(polygon){var tmp=[];var N=polygon.length;for(var i=0;i!==N;i++){tmp.push(polygon.pop());}
            for(var i=0;i!==N;i++){polygon[i]=tmp[i];}}
        function polygonIsReflex(polygon,i){return isRight(polygonAt(polygon,i-1),polygonAt(polygon,i),polygonAt(polygon,i+1));}
        var tmpLine1=[],tmpLine2=[];function polygonCanSee(polygon,a,b){var p,dist,l1=tmpLine1,l2=tmpLine2;if(isLeftOn(polygonAt(polygon,a+1),polygonAt(polygon,a),polygonAt(polygon,b))&&isRightOn(polygonAt(polygon,a-1),polygonAt(polygon,a),polygonAt(polygon,b))){return false;}
            dist=sqdist(polygonAt(polygon,a),polygonAt(polygon,b));for(var i=0;i!==polygon.length;++i){if((i+1)%polygon.length===a||i===a){continue;}
                if(isLeftOn(polygonAt(polygon,a),polygonAt(polygon,b),polygonAt(polygon,i+1))&&isRightOn(polygonAt(polygon,a),polygonAt(polygon,b),polygonAt(polygon,i))){l1[0]=polygonAt(polygon,a);l1[1]=polygonAt(polygon,b);l2[0]=polygonAt(polygon,i);l2[1]=polygonAt(polygon,i+1);p=lineInt(l1,l2);if(sqdist(polygonAt(polygon,a),p)<dist){return false;}}}
            return true;}
        function polygonCanSee2(polygon,a,b){for(var i=0;i!==polygon.length;++i){if(i===a||i===b||(i+1)%polygon.length===a||(i+1)%polygon.length===b){continue;}
            if(lineSegmentsIntersect(polygonAt(polygon,a),polygonAt(polygon,b),polygonAt(polygon,i),polygonAt(polygon,i+1))){return false;}}
            return true;}
        function polygonCopy(polygon,i,j,targetPoly){var p=targetPoly||[];polygonClear(p);if(i<j){for(var k=i;k<=j;k++){p.push(polygon[k]);}}else{for(var k=0;k<=j;k++){p.push(polygon[k]);}
            for(var k=i;k<polygon.length;k++){p.push(polygon[k]);}}
            return p;}
        function polygonGetCutEdges(polygon){var min=[],tmp1=[],tmp2=[],tmpPoly=[];var nDiags=Number.MAX_VALUE;for(var i=0;i<polygon.length;++i){if(polygonIsReflex(polygon,i)){for(var j=0;j<polygon.length;++j){if(polygonCanSee(polygon,i,j)){tmp1=polygonGetCutEdges(polygonCopy(polygon,i,j,tmpPoly));tmp2=polygonGetCutEdges(polygonCopy(polygon,j,i,tmpPoly));for(var k=0;k<tmp2.length;k++){tmp1.push(tmp2[k]);}
            if(tmp1.length<nDiags){min=tmp1;nDiags=tmp1.length;min.push([polygonAt(polygon,i),polygonAt(polygon,j)]);}}}}}
            return min;}
        function polygonDecomp(polygon){var edges=polygonGetCutEdges(polygon);if(edges.length>0){return polygonSlice(polygon,edges);}else{return[polygon];}}
        function polygonSlice(polygon,cutEdges){if(cutEdges.length===0){return[polygon];}
            if(cutEdges instanceof Array&&cutEdges.length&&cutEdges[0]instanceof Array&&cutEdges[0].length===2&&cutEdges[0][0]instanceof Array){var polys=[polygon];for(var i=0;i<cutEdges.length;i++){var cutEdge=cutEdges[i];for(var j=0;j<polys.length;j++){var poly=polys[j];var result=polygonSlice(poly,cutEdge);if(result){polys.splice(j,1);polys.push(result[0],result[1]);break;}}}
                return polys;}else{var cutEdge=cutEdges;var i=polygon.indexOf(cutEdge[0]);var j=polygon.indexOf(cutEdge[1]);if(i!==-1&&j!==-1){return[polygonCopy(polygon,i,j),polygonCopy(polygon,j,i)];}else{return false;}}}
        function polygonIsSimple(polygon){var path=polygon,i;for(i=0;i<path.length-1;i++){for(var j=0;j<i-1;j++){if(lineSegmentsIntersect(path[i],path[i+1],path[j],path[j+1])){return false;}}}
            for(i=1;i<path.length-2;i++){if(lineSegmentsIntersect(path[0],path[path.length-1],path[i],path[i+1])){return false;}}
            return true;}
        function getIntersectionPoint(p1,p2,q1,q2,delta){delta=delta||0;var a1=p2[1]-p1[1];var b1=p1[0]-p2[0];var c1=(a1*p1[0])+(b1*p1[1]);var a2=q2[1]-q1[1];var b2=q1[0]-q2[0];var c2=(a2*q1[0])+(b2*q1[1]);var det=(a1*b2)-(a2*b1);if(!scalar_eq(det,0,delta)){return[((b2*c1)-(b1*c2))/ det,((a1*c2)-(a2*c1))/ det];}else{return[0,0];}}
        function polygonQuickDecomp(polygon,result,reflexVertices,steinerPoints,delta,maxlevel,level){maxlevel=maxlevel||100;level=level||0;delta=delta||25;result=typeof(result)!=="undefined"?result:[];reflexVertices=reflexVertices||[];steinerPoints=steinerPoints||[];var upperInt=[0,0],lowerInt=[0,0],p=[0,0];var upperDist=0,lowerDist=0,d=0,closestDist=0;var upperIndex=0,lowerIndex=0,closestIndex=0;var lowerPoly=[],upperPoly=[];var poly=polygon,v=polygon;if(v.length<3){return result;}
            level++;if(level>maxlevel){console.warn("quickDecomp: max level ("+maxlevel+") reached.");return result;}
            for(var i=0;i<polygon.length;++i){if(polygonIsReflex(poly,i)){reflexVertices.push(poly[i]);upperDist=lowerDist=Number.MAX_VALUE;for(var j=0;j<polygon.length;++j){if(isLeft(polygonAt(poly,i-1),polygonAt(poly,i),polygonAt(poly,j))&&isRightOn(polygonAt(poly,i-1),polygonAt(poly,i),polygonAt(poly,j-1))){p=getIntersectionPoint(polygonAt(poly,i-1),polygonAt(poly,i),polygonAt(poly,j),polygonAt(poly,j-1));if(isRight(polygonAt(poly,i+1),polygonAt(poly,i),p)){d=sqdist(poly[i],p);if(d<lowerDist){lowerDist=d;lowerInt=p;lowerIndex=j;}}}
                if(isLeft(polygonAt(poly,i+1),polygonAt(poly,i),polygonAt(poly,j+1))&&isRightOn(polygonAt(poly,i+1),polygonAt(poly,i),polygonAt(poly,j))){p=getIntersectionPoint(polygonAt(poly,i+1),polygonAt(poly,i),polygonAt(poly,j),polygonAt(poly,j+1));if(isLeft(polygonAt(poly,i-1),polygonAt(poly,i),p)){d=sqdist(poly[i],p);if(d<upperDist){upperDist=d;upperInt=p;upperIndex=j;}}}}
                if(lowerIndex===(upperIndex+1)%polygon.length){p[0]=(lowerInt[0]+upperInt[0])/ 2;p[1]=(lowerInt[1]+upperInt[1])/ 2;steinerPoints.push(p);if(i<upperIndex){polygonAppend(lowerPoly,poly,i,upperIndex+1);lowerPoly.push(p);upperPoly.push(p);if(lowerIndex!==0){polygonAppend(upperPoly,poly,lowerIndex,poly.length);}
                    polygonAppend(upperPoly,poly,0,i+1);}else{if(i!==0){polygonAppend(lowerPoly,poly,i,poly.length);}
                    polygonAppend(lowerPoly,poly,0,upperIndex+1);lowerPoly.push(p);upperPoly.push(p);polygonAppend(upperPoly,poly,lowerIndex,i+1);}}else{if(lowerIndex>upperIndex){upperIndex+=polygon.length;}
                    closestDist=Number.MAX_VALUE;if(upperIndex<lowerIndex){return result;}
                    for(var j=lowerIndex;j<=upperIndex;++j){if(isLeftOn(polygonAt(poly,i-1),polygonAt(poly,i),polygonAt(poly,j))&&isRightOn(polygonAt(poly,i+1),polygonAt(poly,i),polygonAt(poly,j))){d=sqdist(polygonAt(poly,i),polygonAt(poly,j));if(d<closestDist&&polygonCanSee2(poly,i,j)){closestDist=d;closestIndex=j%polygon.length;}}}
                    if(i<closestIndex){polygonAppend(lowerPoly,poly,i,closestIndex+1);if(closestIndex!==0){polygonAppend(upperPoly,poly,closestIndex,v.length);}
                        polygonAppend(upperPoly,poly,0,i+1);}else{if(i!==0){polygonAppend(lowerPoly,poly,i,v.length);}
                        polygonAppend(lowerPoly,poly,0,closestIndex+1);polygonAppend(upperPoly,poly,closestIndex,i+1);}}
                if(lowerPoly.length<upperPoly.length){polygonQuickDecomp(lowerPoly,result,reflexVertices,steinerPoints,delta,maxlevel,level);polygonQuickDecomp(upperPoly,result,reflexVertices,steinerPoints,delta,maxlevel,level);}else{polygonQuickDecomp(upperPoly,result,reflexVertices,steinerPoints,delta,maxlevel,level);polygonQuickDecomp(lowerPoly,result,reflexVertices,steinerPoints,delta,maxlevel,level);}
                return result;}}
            result.push(polygon);return result;}
        function polygonRemoveCollinearPoints(polygon,precision){var num=0;for(var i=polygon.length-1;polygon.length>3&&i>=0;--i){if(collinear(polygonAt(polygon,i-1),polygonAt(polygon,i),polygonAt(polygon,i+1),precision)){polygon.splice(i%polygon.length,1);num++;}}
            return num;}
        function polygonRemoveDuplicatePoints(polygon,precision){for(var i=polygon.length-1;i>=1;--i){var pi=polygon[i];for(var j=i-1;j>=0;--j){if(points_eq(pi,polygon[j],precision)){polygon.splice(i,1);continue;}}}}
        function scalar_eq(a,b,precision){precision=precision||0;return Math.abs(a-b)<=precision;}
        function points_eq(a,b,precision){return scalar_eq(a[0],b[0],precision)&&scalar_eq(a[1],b[1],precision);}}),"./plugins/BasePlugin.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var BasePlugin=new Class({initialize:function BasePlugin(pluginManager)
        {this.pluginManager=pluginManager;this.game=pluginManager.game;this.scene;this.systems;},init:function()
        {},start:function()
        {},stop:function()
        {},boot:function()
        {},destroy:function()
        {this.pluginManager=null;this.game=null;this.scene=null;this.systems=null;}});module.exports=BasePlugin;}),"./plugins/DefaultPlugins.js":(function(module,exports,__webpack_require__){var DefaultPlugins={Global:['game','anims','cache','plugins','registry','scale','sound','textures'],CoreScene:['EventEmitter','CameraManager','GameObjectCreator','GameObjectFactory','ScenePlugin','DisplayList','UpdateList'],DefaultScene:['Clock','DataManagerPlugin','InputPlugin','Loader','TweenManager','LightsPlugin']};if(false)
    {}
        if(false)
        {}
        module.exports=DefaultPlugins;}),"./plugins/PluginCache.js":(function(module,exports){var corePlugins={};var customPlugins={};var PluginCache={};PluginCache.register=function(key,plugin,mapping,custom)
    {if(custom===undefined){custom=false;}
        corePlugins[key]={plugin:plugin,mapping:mapping,custom:custom};};PluginCache.registerCustom=function(key,plugin,mapping,data)
    {customPlugins[key]={plugin:plugin,mapping:mapping,data:data};};PluginCache.hasCore=function(key)
    {return corePlugins.hasOwnProperty(key);};PluginCache.hasCustom=function(key)
    {return customPlugins.hasOwnProperty(key);};PluginCache.getCore=function(key)
    {return corePlugins[key];};PluginCache.getCustom=function(key)
    {return customPlugins[key];};PluginCache.getCustomClass=function(key)
    {return(customPlugins.hasOwnProperty(key))?customPlugins[key].plugin:null;};PluginCache.remove=function(key)
    {if(corePlugins.hasOwnProperty(key))
    {delete corePlugins[key];}};PluginCache.removeCustom=function(key)
    {if(customPlugins.hasOwnProperty(key))
    {delete customPlugins[key];}};PluginCache.destroyCorePlugins=function()
    {for(var key in corePlugins)
    {if(corePlugins.hasOwnProperty(key))
    {delete corePlugins[key];}}};PluginCache.destroyCustomPlugins=function()
    {for(var key in customPlugins)
    {if(customPlugins.hasOwnProperty(key))
    {delete customPlugins[key];}}};module.exports=PluginCache;}),"./plugins/PluginManager.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var EventEmitter=__webpack_require__("../node_modules/eventemitter3/index.js");var FileTypesManager=__webpack_require__("./loader/FileTypesManager.js");var GameObjectCreator=__webpack_require__("./gameobjects/GameObjectCreator.js");var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var PluginCache=__webpack_require__("./plugins/PluginCache.js");var Remove=__webpack_require__("./utils/array/Remove.js");var PluginManager=new Class({Extends:EventEmitter,initialize:function PluginManager(game)
        {EventEmitter.call(this);this.game=game;this.plugins=[];this.scenePlugins=[];this._pendingGlobal=[];this._pendingScene=[];if(game.isBooted)
        {this.boot();}
        else
        {game.events.once('boot',this.boot,this);}},boot:function()
        {var i;var entry;var key;var plugin;var start;var mapping;var data;var config=this.game.config;var list=config.installGlobalPlugins;list=list.concat(this._pendingGlobal);for(i=0;i<list.length;i++)
        {entry=list[i];key=GetFastValue(entry,'key',null);plugin=GetFastValue(entry,'plugin',null);start=GetFastValue(entry,'start',false);mapping=GetFastValue(entry,'mapping',null);data=GetFastValue(entry,'data',null);if(key&&plugin)
        {this.install(key,plugin,start,mapping,data);}}
            list=config.installScenePlugins;list=list.concat(this._pendingScene);for(i=0;i<list.length;i++)
        {entry=list[i];key=GetFastValue(entry,'key',null);plugin=GetFastValue(entry,'plugin',null);mapping=GetFastValue(entry,'mapping',null);if(key&&plugin)
        {this.installScenePlugin(key,plugin,mapping);}}
            this._pendingGlobal=[];this._pendingScene=[];this.game.events.once('destroy',this.destroy,this);},addToScene:function(sys,globalPlugins,scenePlugins)
        {var i;var pluginKey;var pluginList;var game=this.game;var scene=sys.scene;var map=sys.settings.map;var isBooted=sys.settings.isBooted;for(i=0;i<globalPlugins.length;i++)
        {pluginKey=globalPlugins[i];if(game[pluginKey])
        {sys[pluginKey]=game[pluginKey];if(map.hasOwnProperty(pluginKey))
        {scene[map[pluginKey]]=sys[pluginKey];}}
        else if(pluginKey==='game'&&map.hasOwnProperty(pluginKey))
        {scene[map[pluginKey]]=game;}}
            for(var s=0;s<scenePlugins.length;s++)
            {pluginList=scenePlugins[s];for(i=0;i<pluginList.length;i++)
            {pluginKey=pluginList[i];if(!PluginCache.hasCore(pluginKey))
            {continue;}
                var source=PluginCache.getCore(pluginKey);var plugin=new source.plugin(scene,this);sys[source.mapping]=plugin;if(source.custom)
            {scene[source.mapping]=plugin;}
            else if(map.hasOwnProperty(source.mapping))
            {scene[map[source.mapping]]=plugin;}
                if(isBooted)
                {plugin.boot();}}}
            pluginList=this.plugins;for(i=0;i<pluginList.length;i++)
        {var entry=pluginList[i];if(entry.mapping)
        {scene[entry.mapping]=entry.plugin;}}},getDefaultScenePlugins:function()
        {var list=this.game.config.defaultPlugins;list=list.concat(this.scenePlugins);return list;},installScenePlugin:function(key,plugin,mapping,addToScene)
        {if(typeof plugin!=='function')
        {console.warn('Invalid Scene Plugin: '+key);return;}
            if(PluginCache.hasCore(key))
            {console.warn('Scene Plugin key in use: '+key);return;}
            PluginCache.register(key,plugin,mapping,true);this.scenePlugins.push(key);if(addToScene)
        {var instance=new plugin(addToScene,this);addToScene.sys[key]=instance;if(mapping&&mapping!=='')
        {addToScene[mapping]=instance;}
            instance.boot();}},install:function(key,plugin,start,mapping,data)
        {if(start===undefined){start=false;}
            if(mapping===undefined){mapping=null;}
            if(data===undefined){data=null;}
            if(typeof plugin!=='function')
            {console.warn('Invalid Plugin: '+key);return null;}
            if(PluginCache.hasCustom(key))
            {console.warn('Plugin key in use: '+key);return null;}
            if(mapping!==null)
            {start=true;}
            if(!this.game.isBooted)
            {this._pendingGlobal.push({key:key,plugin:plugin,start:start,mapping:mapping,data:data});}
            else
            {PluginCache.registerCustom(key,plugin,mapping,data);if(start)
            {return this.start(key);}}
            return null;},getIndex:function(key)
        {var list=this.plugins;for(var i=0;i<list.length;i++)
        {var entry=list[i];if(entry.key===key)
        {return i;}}
            return-1;},getEntry:function(key)
        {var idx=this.getIndex(key);if(idx!==-1)
        {return this.plugins[idx];}},isActive:function(key)
        {var entry=this.getEntry(key);return(entry&&entry.active);},start:function(key,runAs)
        {if(runAs===undefined){runAs=key;}
            var entry=this.getEntry(runAs);if(entry&&!entry.active)
        {entry.active=true;entry.plugin.start();}
        else if(!entry)
        {entry=this.createEntry(key,runAs);}
            return(entry)?entry.plugin:null;},createEntry:function(key,runAs)
        {var entry=PluginCache.getCustom(key);if(entry)
        {var instance=new entry.plugin(this);entry={key:runAs,plugin:instance,active:true,mapping:entry.mapping,data:entry.data};this.plugins.push(entry);instance.init(entry.data);instance.start();}
            return entry;},stop:function(key)
        {var entry=this.getEntry(key);if(entry&&entry.active)
        {entry.active=false;entry.plugin.stop();}
            return this;},get:function(key,autoStart)
        {if(autoStart===undefined){autoStart=true;}
            var entry=this.getEntry(key);if(entry)
        {return entry.plugin;}
        else
        {var plugin=this.getClass(key);if(plugin&&autoStart)
        {entry=this.createEntry(key,key);return(entry)?entry.plugin:null;}
        else if(plugin)
        {return plugin;}}
            return null;},getClass:function(key)
        {return PluginCache.getCustomClass(key);},removeGlobalPlugin:function(key)
        {var entry=this.getEntry(key);if(entry)
        {Remove(this.plugins,entry);}
            PluginCache.removeCustom(key);},removeScenePlugin:function(key)
        {Remove(this.scenePlugins,key);PluginCache.remove(key);},registerGameObject:function(key,factoryCallback,creatorCallback)
        {if(factoryCallback)
        {GameObjectFactory.register(key,factoryCallback);}
            if(creatorCallback)
            {GameObjectCreator.register(key,creatorCallback);}
            return this;},registerFileType:function(key,callback,addToScene)
        {FileTypesManager.register(key,callback);if(addToScene&&addToScene.sys.load)
        {addToScene.sys.load[key]=callback;}},destroy:function()
        {for(var i=0;i<this.plugins.length;i++)
        {this.plugins[i].plugin.destroy();}
            PluginCache.destroyCustomPlugins();if(this.game.noReturn)
        {PluginCache.destroyCorePlugins();}
            this.game=null;this.plugins=[];this.scenePlugins=[];}});module.exports=PluginManager;}),"./plugins/ScenePlugin.js":(function(module,exports,__webpack_require__){var BasePlugin=__webpack_require__("./plugins/BasePlugin.js");var Class=__webpack_require__("./utils/Class.js");var ScenePlugin=new Class({Extends:BasePlugin,initialize:function ScenePlugin(scene,pluginManager)
        {BasePlugin.call(this,pluginManager);this.scene=scene;this.systems=scene.sys;scene.sys.events.once('boot',this.boot,this);},boot:function()
        {}});module.exports=ScenePlugin;}),"./plugins/index.js":(function(module,exports,__webpack_require__){module.exports={BasePlugin:__webpack_require__("./plugins/BasePlugin.js"),DefaultPlugins:__webpack_require__("./plugins/DefaultPlugins.js"),PluginCache:__webpack_require__("./plugins/PluginCache.js"),PluginManager:__webpack_require__("./plugins/PluginManager.js"),ScenePlugin:__webpack_require__("./plugins/ScenePlugin.js")};}),"./polyfills/Array.forEach.js":(function(module,exports){if(!Array.prototype.forEach)
    {Array.prototype.forEach=function(fun)
    {'use strict';if(this===void 0||this===null)
    {throw new TypeError();}
        var t=Object(this);var len=t.length>>>0;if(typeof fun!=='function')
    {throw new TypeError();}
        var thisArg=arguments.length>=2?arguments[1]:void 0;for(var i=0;i<len;i++)
    {if(i in t)
    {fun.call(thisArg,t[i],i,t);}}};}}),"./polyfills/Array.isArray.js":(function(module,exports){if(!Array.isArray)
    {Array.isArray=function(arg)
    {return Object.prototype.toString.call(arg)==='[object Array]';};}}),"./polyfills/AudioContextMonkeyPatch.js":(function(module,exports){(function(){function fixSetTarget(param){if(!param)
        return;if(!param.setTargetAtTime)
        param.setTargetAtTime=param.setTargetValueAtTime;}
        if(window.hasOwnProperty('webkitAudioContext')&&!window.hasOwnProperty('AudioContext')){window.AudioContext=webkitAudioContext;if(!AudioContext.prototype.hasOwnProperty('createGain'))
            AudioContext.prototype.createGain=AudioContext.prototype.createGainNode;if(!AudioContext.prototype.hasOwnProperty('createDelay'))
            AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode;if(!AudioContext.prototype.hasOwnProperty('createScriptProcessor'))
            AudioContext.prototype.createScriptProcessor=AudioContext.prototype.createJavaScriptNode;if(!AudioContext.prototype.hasOwnProperty('createPeriodicWave'))
            AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable;AudioContext.prototype.internal_createGain=AudioContext.prototype.createGain;AudioContext.prototype.createGain=function(){var node=this.internal_createGain();fixSetTarget(node.gain);return node;};AudioContext.prototype.internal_createDelay=AudioContext.prototype.createDelay;AudioContext.prototype.createDelay=function(maxDelayTime){var node=maxDelayTime?this.internal_createDelay(maxDelayTime):this.internal_createDelay();fixSetTarget(node.delayTime);return node;};AudioContext.prototype.internal_createBufferSource=AudioContext.prototype.createBufferSource;AudioContext.prototype.createBufferSource=function(){var node=this.internal_createBufferSource();if(!node.start){node.start=function(when,offset,duration){if(offset||duration)
            this.noteGrainOn(when||0,offset,duration);else
            this.noteOn(when||0);};}else{node.internal_start=node.start;node.start=function(when,offset,duration){if(typeof duration!=='undefined')
            node.internal_start(when||0,offset,duration);else
            node.internal_start(when||0,offset||0);};}
            if(!node.stop){node.stop=function(when){this.noteOff(when||0);};}else{node.internal_stop=node.stop;node.stop=function(when){node.internal_stop(when||0);};}
            fixSetTarget(node.playbackRate);return node;};AudioContext.prototype.internal_createDynamicsCompressor=AudioContext.prototype.createDynamicsCompressor;AudioContext.prototype.createDynamicsCompressor=function(){var node=this.internal_createDynamicsCompressor();fixSetTarget(node.threshold);fixSetTarget(node.knee);fixSetTarget(node.ratio);fixSetTarget(node.reduction);fixSetTarget(node.attack);fixSetTarget(node.release);return node;};AudioContext.prototype.internal_createBiquadFilter=AudioContext.prototype.createBiquadFilter;AudioContext.prototype.createBiquadFilter=function(){var node=this.internal_createBiquadFilter();fixSetTarget(node.frequency);fixSetTarget(node.detune);fixSetTarget(node.Q);fixSetTarget(node.gain);return node;};if(AudioContext.prototype.hasOwnProperty('createOscillator')){AudioContext.prototype.internal_createOscillator=AudioContext.prototype.createOscillator;AudioContext.prototype.createOscillator=function(){var node=this.internal_createOscillator();if(!node.start){node.start=function(when){this.noteOn(when||0);};}else{node.internal_start=node.start;node.start=function(when){node.internal_start(when||0);};}
            if(!node.stop){node.stop=function(when){this.noteOff(when||0);};}else{node.internal_stop=node.stop;node.stop=function(when){node.internal_stop(when||0);};}
            if(!node.setPeriodicWave)
                node.setPeriodicWave=node.setWaveTable;fixSetTarget(node.frequency);fixSetTarget(node.detune);return node;};}}
        if(window.hasOwnProperty('webkitOfflineAudioContext')&&!window.hasOwnProperty('OfflineAudioContext')){window.OfflineAudioContext=webkitOfflineAudioContext;}})();}),"./polyfills/Math.trunc.js":(function(module,exports){if(!Math.trunc){Math.trunc=function trunc(x){return x<0?Math.ceil(x):Math.floor(x);};}}),"./polyfills/Uint32Array.js":(function(module,exports){if(typeof window.Uint32Array!=='function'&&typeof window.Uint32Array!=='object')
    {var CheapArray=function(fakeType)
    {var proto=new Array();window[fakeType]=function(arg){if(typeof(arg)==='number')
    {Array.call(this,arg);this.length=arg;for(var i=0;i<this.length;i++)
    {this[i]=0;}}
    else
    {Array.call(this,arg.length);this.length=arg.length;for(var i=0;i<this.length;i++)
    {this[i]=arg[i];}}};window[fakeType].prototype=proto;window[fakeType].constructor=window[fakeType];};CheapArray('Float32Array');CheapArray('Uint32Array');CheapArray('Uint16Array');CheapArray('Int16Array');CheapArray('ArrayBuffer');}}),"./polyfills/console.js":(function(module,exports){if(!window.console)
    {window.console={};window.console.log=window.console.assert=function(){};window.console.warn=window.console.assert=function(){};}}),"./polyfills/index.js":(function(module,exports,__webpack_require__){__webpack_require__("./polyfills/Array.forEach.js");__webpack_require__("./polyfills/Array.isArray.js");__webpack_require__("./polyfills/AudioContextMonkeyPatch.js");__webpack_require__("./polyfills/console.js");__webpack_require__("./polyfills/Math.trunc.js");__webpack_require__("./polyfills/performance.now.js");__webpack_require__("./polyfills/requestAnimationFrame.js");__webpack_require__("./polyfills/Uint32Array.js");}),"./polyfills/performance.now.js":(function(module,exports){(function(){if('performance'in window===false)
    {window.performance={};}
        Date.now=(Date.now||function(){return new Date().getTime();});if('now'in window.performance===false)
        {var nowOffset=Date.now();if(performance.timing&&performance.timing.navigationStart)
        {nowOffset=performance.timing.navigationStart;}
            window.performance.now=function now()
            {return Date.now()-nowOffset;}}})();}),"./polyfills/requestAnimationFrame.js":(function(module,exports,__webpack_require__){(function(global){if(!(Date.now&&Date.prototype.getTime)){Date.now=function now(){return new Date().getTime();};}
        if(!(global.performance&&global.performance.now)){var startTime=Date.now();if(!global.performance){global.performance={};}
            global.performance.now=function(){return Date.now()-startTime;};}
        var lastTime=Date.now();var vendors=['ms','moz','webkit','o'];for(var x=0;x<vendors.length&&!global.requestAnimationFrame;++x){global.requestAnimationFrame=global[vendors[x]+'RequestAnimationFrame'];global.cancelAnimationFrame=global[vendors[x]+'CancelAnimationFrame']||global[vendors[x]+'CancelRequestAnimationFrame'];}
        if(!global.requestAnimationFrame){global.requestAnimationFrame=function(callback){if(typeof callback!=='function'){throw new TypeError(callback+'is not a function');}
            var currentTime=Date.now(),delay=16+lastTime-currentTime;if(delay<0){delay=0;}
            lastTime=currentTime;return setTimeout(function(){lastTime=Date.now();callback(performance.now());},delay);};}
        if(!global.cancelAnimationFrame){global.cancelAnimationFrame=function(id){clearTimeout(id);};}}.call(this,__webpack_require__("../node_modules/webpack/buildin/global.js")))}),"./renderer/BlendModes.js":(function(module,exports){module.exports={SKIP_CHECK:-1,NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16,ERASE:17,SOURCE_IN:18,SOURCE_OUT:19,SOURCE_ATOP:20,DESTINATION_OVER:21,DESTINATION_IN:22,DESTINATION_OUT:23,DESTINATION_ATOP:24,LIGHTER:25,COPY:26,XOR:27};}),"./renderer/ScaleModes.js":(function(module,exports){module.exports={DEFAULT:0,LINEAR:0,NEAREST:1};}),"./renderer/canvas/CanvasRenderer.js":(function(module,exports,__webpack_require__){var CanvasSnapshot=__webpack_require__("./renderer/snapshot/CanvasSnapshot.js");var Class=__webpack_require__("./utils/Class.js");var CONST=__webpack_require__("./const.js");var GetBlendModes=__webpack_require__("./renderer/canvas/utils/GetBlendModes.js");var ScaleModes=__webpack_require__("./renderer/ScaleModes.js");var Smoothing=__webpack_require__("./display/canvas/Smoothing.js");var TransformMatrix=__webpack_require__("./gameobjects/components/TransformMatrix.js");var CanvasRenderer=new Class({initialize:function CanvasRenderer(game)
        {this.game=game;this.type=CONST.CANVAS;this.drawCount=0;this.width=0;this.height=0;this.config={clearBeforeRender:game.config.clearBeforeRender,backgroundColor:game.config.backgroundColor,resolution:game.config.resolution,antialias:game.config.antialias,roundPixels:game.config.roundPixels};this.scaleMode=(game.config.antialias)?ScaleModes.LINEAR:ScaleModes.NEAREST;this.gameCanvas=game.canvas;this.gameContext=(this.game.config.context)?this.game.config.context:this.gameCanvas.getContext('2d');this.currentContext=this.gameContext;this.blendModes=GetBlendModes();this.currentScaleMode=0;this.snapshotCallback=null;this.snapshotType=null;this.snapshotEncoder=null;this._tempMatrix1=new TransformMatrix();this._tempMatrix2=new TransformMatrix();this._tempMatrix3=new TransformMatrix();this._tempMatrix4=new TransformMatrix();this.init();},init:function()
        {this.game.scale.on('resize',this.onResize,this);var baseSize=this.game.scale.baseSize;this.resize(baseSize.width,baseSize.height);},onResize:function(gameSize,baseSize)
        {if(baseSize.width!==this.width||baseSize.height!==this.height)
        {this.resize(baseSize.width,baseSize.height);}},resize:function(width,height)
        {this.width=width;this.height=height;if(this.scaleMode===ScaleModes.NEAREST)
        {Smoothing.disable(this.gameContext);}},onContextLost:function()
        {},onContextRestored:function()
        {},resetTransform:function()
        {this.currentContext.setTransform(1,0,0,1,0,0);},setBlendMode:function(blendMode)
        {this.currentContext.globalCompositeOperation=blendMode;return this;},setContext:function(ctx)
        {this.currentContext=(ctx)?ctx:this.gameContext;return this;},setAlpha:function(alpha)
        {this.currentContext.globalAlpha=alpha;return this;},preRender:function()
        {var ctx=this.gameContext;var config=this.config;var width=this.width;var height=this.height;ctx.globalAlpha=1;ctx.globalCompositeOperation='source-over';ctx.setTransform(1,0,0,1,0,0);if(config.clearBeforeRender)
        {ctx.clearRect(0,0,width,height);}
            if(!config.transparent)
            {ctx.fillStyle=config.backgroundColor.rgba;ctx.fillRect(0,0,width,height);}
            ctx.save();this.drawCount=0;},render:function(scene,children,interpolationPercentage,camera)
        {var list=children.list;var childCount=list.length;var cx=camera._cx;var cy=camera._cy;var cw=camera._cw;var ch=camera._ch;var ctx=(camera.renderToTexture)?camera.context:scene.sys.context;ctx.save();if(this.game.scene.customViewports)
        {ctx.beginPath();ctx.rect(cx,cy,cw,ch);ctx.clip();}
            this.currentContext=ctx;if(!camera.transparent)
        {ctx.fillStyle=camera.backgroundColor.rgba;ctx.fillRect(cx,cy,cw,ch);}
            ctx.globalAlpha=camera.alpha;ctx.globalCompositeOperation='source-over';this.drawCount+=list.length;if(camera.renderToTexture)
        {camera.emit('prerender',camera);}
            camera.matrix.copyToContext(ctx);for(var i=0;i<childCount;i++)
        {var child=list[i];if(!child.willRender(camera))
        {continue;}
            if(child.mask)
            {child.mask.preRenderCanvas(this,child,camera);}
            child.renderCanvas(this,child,interpolationPercentage,camera);if(child.mask)
        {child.mask.postRenderCanvas(this,child,camera);}}
            ctx.setTransform(1,0,0,1,0,0);ctx.globalCompositeOperation='source-over';ctx.globalAlpha=1;camera.flashEffect.postRenderCanvas(ctx);camera.fadeEffect.postRenderCanvas(ctx);camera.dirty=false;ctx.restore();if(camera.renderToTexture)
        {camera.emit('postrender',camera);scene.sys.context.drawImage(camera.canvas,cx,cy);}},postRender:function()
        {var ctx=this.gameContext;ctx.restore();if(this.snapshotCallback)
        {this.snapshotCallback(CanvasSnapshot(this.gameCanvas,this.snapshotType,this.snapshotEncoder));this.snapshotCallback=null;}},snapshot:function(callback,type,encoderOptions)
        {this.snapshotCallback=callback;this.snapshotType=type;this.snapshotEncoder=encoderOptions;},batchSprite:function(sprite,frame,camera,parentTransformMatrix)
        {var alpha=camera.alpha*sprite.alpha;if(alpha===0)
        {return;}
            var ctx=this.currentContext;var camMatrix=this._tempMatrix1;var spriteMatrix=this._tempMatrix2;var calcMatrix=this._tempMatrix3;var cd=frame.canvasData;var frameX=cd.x;var frameY=cd.y;var frameWidth=frame.cutWidth;var frameHeight=frame.cutHeight;var res=frame.source.resolution;var x=-sprite.displayOriginX+frame.x;var y=-sprite.displayOriginY+frame.y;var fx=(sprite.flipX)?-1:1;var fy=(sprite.flipY)?-1:1;if(sprite.isCropped)
        {var crop=sprite._crop;if(crop.flipX!==sprite.flipX||crop.flipY!==sprite.flipY)
        {frame.updateCropUVs(crop,sprite.flipX,sprite.flipY);}
            frameWidth=crop.cw;frameHeight=crop.ch;frameX=crop.cx;frameY=crop.cy;x=-sprite.displayOriginX+crop.x;y=-sprite.displayOriginY+crop.y;if(fx===-1)
        {if(x>=0)
        {x=-(x+frameWidth);}
        else if(x<0)
        {x=(Math.abs(x)-frameWidth);}}
            if(fy===-1)
            {if(y>=0)
            {y=-(y+frameHeight);}
            else if(y<0)
            {y=(Math.abs(y)-frameHeight);}}}
            spriteMatrix.applyITRS(sprite.x,sprite.y,sprite.rotation,sprite.scaleX,sprite.scaleY);camMatrix.copyFrom(camera.matrix);if(parentTransformMatrix)
        {camMatrix.multiplyWithOffset(parentTransformMatrix,-camera.scrollX*sprite.scrollFactorX,-camera.scrollY*sprite.scrollFactorY);spriteMatrix.e=sprite.x;spriteMatrix.f=sprite.y;camMatrix.multiply(spriteMatrix,calcMatrix);}
        else
        {spriteMatrix.e-=camera.scrollX*sprite.scrollFactorX;spriteMatrix.f-=camera.scrollY*sprite.scrollFactorY;camMatrix.multiply(spriteMatrix,calcMatrix);}
            ctx.save();calcMatrix.setToContext(ctx);ctx.scale(fx,fy);ctx.globalCompositeOperation=this.blendModes[sprite.blendMode];ctx.globalAlpha=alpha;ctx.drawImage(frame.source.image,frameX,frameY,frameWidth,frameHeight,x,y,frameWidth / res,frameHeight / res);ctx.restore();},destroy:function()
        {this.gameCanvas=null;this.gameContext=null;this.game=null;}});module.exports=CanvasRenderer;}),"./renderer/canvas/index.js":(function(module,exports,__webpack_require__){module.exports={CanvasRenderer:__webpack_require__("./renderer/canvas/CanvasRenderer.js"),GetBlendModes:__webpack_require__("./renderer/canvas/utils/GetBlendModes.js"),SetTransform:__webpack_require__("./renderer/canvas/utils/SetTransform.js")};}),"./renderer/canvas/utils/GetBlendModes.js":(function(module,exports,__webpack_require__){var modes=__webpack_require__("./renderer/BlendModes.js");var CanvasFeatures=__webpack_require__("./device/CanvasFeatures.js");var GetBlendModes=function()
    {var output=[];var useNew=CanvasFeatures.supportNewBlendModes;var so='source-over';output[modes.NORMAL]=so;output[modes.ADD]='lighter';output[modes.MULTIPLY]=(useNew)?'multiply':so;output[modes.SCREEN]=(useNew)?'screen':so;output[modes.OVERLAY]=(useNew)?'overlay':so;output[modes.DARKEN]=(useNew)?'darken':so;output[modes.LIGHTEN]=(useNew)?'lighten':so;output[modes.COLOR_DODGE]=(useNew)?'color-dodge':so;output[modes.COLOR_BURN]=(useNew)?'color-burn':so;output[modes.HARD_LIGHT]=(useNew)?'hard-light':so;output[modes.SOFT_LIGHT]=(useNew)?'soft-light':so;output[modes.DIFFERENCE]=(useNew)?'difference':so;output[modes.EXCLUSION]=(useNew)?'exclusion':so;output[modes.HUE]=(useNew)?'hue':so;output[modes.SATURATION]=(useNew)?'saturation':so;output[modes.COLOR]=(useNew)?'color':so;output[modes.LUMINOSITY]=(useNew)?'luminosity':so;output[modes.ERASE]='destination-out';output[modes.SOURCE_IN]='source-in';output[modes.SOURCE_OUT]='source-out';output[modes.SOURCE_ATOP]='source-atop';output[modes.DESTINATION_OVER]='destination-over';output[modes.DESTINATION_IN]='destination-in';output[modes.DESTINATION_OUT]='destination-out';output[modes.DESTINATION_ATOP]='destination-atop';output[modes.LIGHTER]='lighter';output[modes.COPY]='copy';output[modes.XOR]='xor';return output;};module.exports=GetBlendModes;}),"./renderer/canvas/utils/SetTransform.js":(function(module,exports){var SetTransform=function(renderer,ctx,src,camera,parentMatrix)
    {var alpha=camera.alpha*src.alpha;if(alpha<=0)
    {return false;}
        var camMatrix=renderer._tempMatrix1.copyFromArray(camera.matrix.matrix);var gameObjectMatrix=renderer._tempMatrix2.applyITRS(src.x,src.y,src.rotation,src.scaleX,src.scaleY);var calcMatrix=renderer._tempMatrix3;if(parentMatrix)
    {camMatrix.multiplyWithOffset(parentMatrix,-camera.scrollX*src.scrollFactorX,-camera.scrollY*src.scrollFactorY);gameObjectMatrix.e=src.x;gameObjectMatrix.f=src.y;camMatrix.multiply(gameObjectMatrix,calcMatrix);}
    else
    {gameObjectMatrix.e-=camera.scrollX*src.scrollFactorX;gameObjectMatrix.f-=camera.scrollY*src.scrollFactorY;camMatrix.multiply(gameObjectMatrix,calcMatrix);}
        ctx.globalCompositeOperation=renderer.blendModes[src.blendMode];ctx.globalAlpha=alpha;ctx.save();calcMatrix.setToContext(ctx);return true;};module.exports=SetTransform;}),"./renderer/index.js":(function(module,exports,__webpack_require__){module.exports={Canvas:__webpack_require__("./renderer/canvas/index.js"),Snapshot:__webpack_require__("./renderer/snapshot/index.js"),WebGL:__webpack_require__("./renderer/webgl/index.js")};}),"./renderer/snapshot/CanvasSnapshot.js":(function(module,exports){var CanvasSnapshot=function(canvas,type,encoderOptions)
    {if(type===undefined){type='image/png';}
        if(encoderOptions===undefined){encoderOptions=0.92;}
        var src=canvas.toDataURL(type,encoderOptions);var image=new Image();image.src=src;return image;};module.exports=CanvasSnapshot;}),"./renderer/snapshot/WebGLSnapshot.js":(function(module,exports){var WebGLSnapshot=function(sourceCanvas,type,encoderOptions)
    {if(!type){type='image/png';}
        if(!encoderOptions){encoderOptions=0.92;}
        var gl=sourceCanvas.getContext('experimental-webgl');var pixels=new Uint8Array(gl.drawingBufferWidth*gl.drawingBufferHeight*4);gl.readPixels(0,0,gl.drawingBufferWidth,gl.drawingBufferHeight,gl.RGBA,gl.UNSIGNED_BYTE,pixels);var canvas=document.createElement('canvas');var ctx=canvas.getContext('2d');var imageData;canvas.width=gl.drawingBufferWidth;canvas.height=gl.drawingBufferHeight;imageData=ctx.getImageData(0,0,canvas.width,canvas.height);var data=imageData.data;for(var y=0;y<canvas.height;y+=1)
    {for(var x=0;x<canvas.width;x+=1)
    {var si=((canvas.height-y)*canvas.width+x)*4;var di=(y*canvas.width+x)*4;data[di+0]=pixels[si+0];data[di+1]=pixels[si+1];data[di+2]=pixels[si+2];data[di+3]=pixels[si+3];}}
        ctx.putImageData(imageData,0,0);var src=canvas.toDataURL(type,encoderOptions);var image=new Image();image.src=src;return image;};module.exports=WebGLSnapshot;}),"./renderer/snapshot/index.js":(function(module,exports,__webpack_require__){module.exports={Canvas:__webpack_require__("./renderer/snapshot/CanvasSnapshot.js"),WebGL:__webpack_require__("./renderer/snapshot/WebGLSnapshot.js")};}),"./renderer/webgl/Utils.js":(function(module,exports){module.exports={getTintFromFloats:function(r,g,b,a)
        {var ur=((r*255.0)|0)&0xFF;var ug=((g*255.0)|0)&0xFF;var ub=((b*255.0)|0)&0xFF;var ua=((a*255.0)|0)&0xFF;return((ua<<24)|(ur<<16)|(ug<<8)|ub)>>>0;},getTintAppendFloatAlpha:function(rgb,a)
        {var ua=((a*255.0)|0)&0xFF;return((ua<<24)|rgb)>>>0;},getTintAppendFloatAlphaAndSwap:function(rgb,a)
        {var ur=((rgb>>16)|0)&0xff;var ug=((rgb>>8)|0)&0xff;var ub=(rgb|0)&0xff;var ua=((a*255.0)|0)&0xFF;return((ua<<24)|(ub<<16)|(ug<<8)|ur)>>>0;},getFloatsFromUintRGB:function(rgb)
        {var ur=((rgb>>16)|0)&0xff;var ug=((rgb>>8)|0)&0xff;var ub=(rgb|0)&0xff;return[ur / 255.0,ug / 255.0,ub / 255.0];},getComponentCount:function(attributes,glContext)
        {var count=0;for(var index=0;index<attributes.length;++index)
        {var element=attributes[index];if(element.type===glContext.FLOAT)
        {count+=element.size;}
        else
        {count+=1;}}
            return count;}};}),"./renderer/webgl/WebGLPipeline.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Utils=__webpack_require__("./renderer/webgl/Utils.js");var WebGLPipeline=new Class({initialize:function WebGLPipeline(config)
        {this.name='WebGLPipeline';this.game=config.game;this.view=config.game.canvas;this.resolution=1;this.width=0;this.height=0;this.gl=config.gl;this.vertexCount=0;this.vertexCapacity=config.vertexCapacity;this.renderer=config.renderer;this.vertexData=(config.vertices?config.vertices:new ArrayBuffer(config.vertexCapacity*config.vertexSize));this.vertexBuffer=this.renderer.createVertexBuffer((config.vertices?config.vertices:this.vertexData.byteLength),this.gl.STREAM_DRAW);this.program=this.renderer.createProgram(config.vertShader,config.fragShader);this.attributes=config.attributes;this.vertexSize=config.vertexSize;this.topology=config.topology;this.bytes=new Uint8Array(this.vertexData);this.vertexComponentCount=Utils.getComponentCount(config.attributes,this.gl);this.flushLocked=false;this.active=false;},boot:function()
        {},addAttribute:function(name,size,type,normalized,offset)
        {this.attributes.push({name:name,size:size,type:this.renderer.glFormats[type],normalized:normalized,offset:offset});return this;},shouldFlush:function()
        {return(this.vertexCount>=this.vertexCapacity);},resize:function(width,height,resolution)
        {this.width=width*resolution;this.height=height*resolution;this.resolution=resolution;return this;},bind:function()
        {var gl=this.gl;var vertexBuffer=this.vertexBuffer;var attributes=this.attributes;var program=this.program;var renderer=this.renderer;var vertexSize=this.vertexSize;renderer.setProgram(program);renderer.setVertexBuffer(vertexBuffer);for(var index=0;index<attributes.length;++index)
        {var element=attributes[index];var location=gl.getAttribLocation(program,element.name);if(location>=0)
        {gl.enableVertexAttribArray(location);gl.vertexAttribPointer(location,element.size,element.type,element.normalized,vertexSize,element.offset);}
        else
        {gl.disableVertexAttribArray(location);}}
            return this;},onBind:function()
        {return this;},onPreRender:function()
        {return this;},onRender:function()
        {return this;},onPostRender:function()
        {return this;},flush:function()
        {if(this.flushLocked){return this;}
            this.flushLocked=true;var gl=this.gl;var vertexCount=this.vertexCount;var topology=this.topology;var vertexSize=this.vertexSize;if(vertexCount===0)
        {this.flushLocked=false;return;}
            gl.bufferSubData(gl.ARRAY_BUFFER,0,this.bytes.subarray(0,vertexCount*vertexSize));gl.drawArrays(topology,0,vertexCount);this.vertexCount=0;this.flushLocked=false;return this;},destroy:function()
        {var gl=this.gl;gl.deleteProgram(this.program);gl.deleteBuffer(this.vertexBuffer);delete this.program;delete this.vertexBuffer;delete this.gl;return this;},setFloat1:function(name,x)
        {this.renderer.setFloat1(this.program,name,x);return this;},setFloat2:function(name,x,y)
        {this.renderer.setFloat2(this.program,name,x,y);return this;},setFloat3:function(name,x,y,z)
        {this.renderer.setFloat3(this.program,name,x,y,z);return this;},setFloat4:function(name,x,y,z,w)
        {this.renderer.setFloat4(this.program,name,x,y,z,w);return this;},setFloat1v:function(name,arr)
        {this.renderer.setFloat1v(this.program,name,arr);return this;},setFloat2v:function(name,arr)
        {this.renderer.setFloat2v(this.program,name,arr);return this;},setFloat3v:function(name,arr)
        {this.renderer.setFloat3v(this.program,name,arr);return this;},setFloat4v:function(name,arr)
        {this.renderer.setFloat4v(this.program,name,arr);return this;},setInt1:function(name,x)
        {this.renderer.setInt1(this.program,name,x);return this;},setInt2:function(name,x,y)
        {this.renderer.setInt2(this.program,name,x,y);return this;},setInt3:function(name,x,y,z)
        {this.renderer.setInt3(this.program,name,x,y,z);return this;},setInt4:function(name,x,y,z,w)
        {this.renderer.setInt4(this.program,name,x,y,z,w);return this;},setMatrix2:function(name,transpose,matrix)
        {this.renderer.setMatrix2(this.program,name,transpose,matrix);return this;},setMatrix3:function(name,transpose,matrix)
        {this.renderer.setMatrix3(this.program,name,transpose,matrix);return this;},setMatrix4:function(name,transpose,matrix)
        {this.renderer.setMatrix4(this.program,name,transpose,matrix);return this;}});module.exports=WebGLPipeline;}),"./renderer/webgl/WebGLRenderer.js":(function(module,exports,__webpack_require__){var BaseCamera=__webpack_require__("./cameras/2d/BaseCamera.js");var Class=__webpack_require__("./utils/Class.js");var CONST=__webpack_require__("./const.js");var IsSizePowerOfTwo=__webpack_require__("./math/pow2/IsSizePowerOfTwo.js");var SpliceOne=__webpack_require__("./utils/array/SpliceOne.js");var TransformMatrix=__webpack_require__("./gameobjects/components/TransformMatrix.js");var Utils=__webpack_require__("./renderer/webgl/Utils.js");var WebGLSnapshot=__webpack_require__("./renderer/snapshot/WebGLSnapshot.js");var BitmapMaskPipeline=__webpack_require__("./renderer/webgl/pipelines/BitmapMaskPipeline.js");var ForwardDiffuseLightPipeline=__webpack_require__("./renderer/webgl/pipelines/ForwardDiffuseLightPipeline.js");var TextureTintPipeline=__webpack_require__("./renderer/webgl/pipelines/TextureTintPipeline.js");var WebGLRenderer=new Class({initialize:function WebGLRenderer(game)
        {var renderer=this;var gameConfig=game.config;var contextCreationConfig={alpha:gameConfig.transparent,depth:false,antialias:gameConfig.antialias,premultipliedAlpha:gameConfig.premultipliedAlpha,stencil:true,failIfMajorPerformanceCaveat:gameConfig.failIfMajorPerformanceCaveat,powerPreference:gameConfig.powerPreference};this.config={clearBeforeRender:gameConfig.clearBeforeRender,antialias:gameConfig.antialias,backgroundColor:gameConfig.backgroundColor,contextCreation:contextCreationConfig,resolution:gameConfig.resolution,roundPixels:gameConfig.roundPixels,maxTextures:gameConfig.maxTextures,maxTextureSize:gameConfig.maxTextureSize,batchSize:gameConfig.batchSize,maxLights:gameConfig.maxLights};this.game=game;this.type=CONST.WEBGL;this.width=0;this.height=0;this.canvas=game.canvas;this.lostContextCallbacks=[];this.restoredContextCallbacks=[];this.blendModes=[];this.nativeTextures=[];this.contextLost=false;this.pipelines=null;this.snapshotState={callback:null,type:null,encoder:null};this.currentActiveTextureUnit=0;this.currentTextures=new Array(16);this.currentFramebuffer=null;this.currentPipeline=null;this.currentProgram=null;this.currentVertexBuffer=null;this.currentIndexBuffer=null;this.currentBlendMode=Infinity;this.currentScissorEnabled=false;this.currentScissor=null;this.scissorStack=[];this.canvas.addEventListener('webglcontextlost',function(event)
        {renderer.contextLost=true;event.preventDefault();for(var index=0;index<renderer.lostContextCallbacks.length;++index)
        {var callback=renderer.lostContextCallbacks[index];callback[0].call(callback[1],renderer);}},false);this.canvas.addEventListener('webglcontextrestored',function()
        {renderer.contextLost=false;renderer.init(renderer.config);for(var index=0;index<renderer.restoredContextCallbacks.length;++index)
        {var callback=renderer.restoredContextCallbacks[index];callback[0].call(callback[1],renderer);}},false);this.gl=null;this.supportedExtensions=null;this.extensions={};this.glFormats=[];this.compression={ETC1:false,PVRTC:false,S3TC:false};this.drawingBufferHeight=0;this.blankTexture=null;this.defaultCamera=new BaseCamera(0,0,0,0);this._tempMatrix1=new TransformMatrix();this._tempMatrix2=new TransformMatrix();this._tempMatrix3=new TransformMatrix();this._tempMatrix4=new TransformMatrix();this.init(this.config);},init:function(config)
        {var gl;var canvas=this.canvas;var clearColor=config.backgroundColor;if(this.game.config.context)
        {gl=this.game.config.context;}
        else
        {gl=canvas.getContext('webgl',config.contextCreation)||canvas.getContext('experimental-webgl',config.contextCreation);}
            if(!gl||gl.isContextLost())
            {this.contextLost=true;throw new Error('WebGL unsupported');}
            this.gl=gl;this.game.context=gl;for(var i=0;i<=27;i++)
        {this.blendModes.push({func:[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],equation:gl.FUNC_ADD});}
            this.blendModes[1].func=[gl.ONE,gl.DST_ALPHA];this.blendModes[2].func=[gl.DST_COLOR,gl.ONE_MINUS_SRC_ALPHA];this.blendModes[3].func=[gl.ONE,gl.ONE_MINUS_SRC_COLOR];this.blendModes[17]={func:[gl.ZERO,gl.ONE_MINUS_SRC_ALPHA],equation:gl.FUNC_REVERSE_SUBTRACT};this.glFormats[0]=gl.BYTE;this.glFormats[1]=gl.SHORT;this.glFormats[2]=gl.UNSIGNED_BYTE;this.glFormats[3]=gl.UNSIGNED_SHORT;this.glFormats[4]=gl.FLOAT;var exts=gl.getSupportedExtensions();if(!config.maxTextures)
        {config.maxTextures=gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);}
            if(!config.maxTextureSize)
            {config.maxTextureSize=gl.getParameter(gl.MAX_TEXTURE_SIZE);}
            var extString='WEBGL_compressed_texture_';var wkExtString='WEBKIT_'+extString;this.compression.ETC1=gl.getExtension(extString+'etc1')||gl.getExtension(wkExtString+'etc1');this.compression.PVRTC=gl.getExtension(extString+'pvrtc')||gl.getExtension(wkExtString+'pvrtc');this.compression.S3TC=gl.getExtension(extString+'s3tc')||gl.getExtension(wkExtString+'s3tc');this.supportedExtensions=exts;gl.disable(gl.DEPTH_TEST);gl.disable(gl.CULL_FACE);gl.enable(gl.BLEND);gl.clearColor(clearColor.redGL,clearColor.greenGL,clearColor.blueGL,1);for(var index=0;index<this.currentTextures.length;++index)
        {this.currentTextures[index]=null;}
            this.pipelines={};this.addPipeline('TextureTintPipeline',new TextureTintPipeline({game:this.game,renderer:this}));this.addPipeline('BitmapMaskPipeline',new BitmapMaskPipeline({game:this.game,renderer:this}));this.addPipeline('Light2D',new ForwardDiffuseLightPipeline({game:this.game,renderer:this,maxLights:config.maxLights}));this.setBlendMode(CONST.BlendModes.NORMAL);this.game.events.once('texturesready',this.boot,this);return this;},boot:function()
        {for(var pipelineName in this.pipelines)
        {this.pipelines[pipelineName].boot();}
            var blank=this.game.textures.getFrame('__DEFAULT');this.pipelines.TextureTintPipeline.currentFrame=blank;this.blankTexture=blank;var gl=this.gl;gl.bindFramebuffer(gl.FRAMEBUFFER,null);gl.enable(gl.SCISSOR_TEST);this.setPipeline(this.pipelines.TextureTintPipeline);this.game.scale.on('resize',this.onResize,this);var baseSize=this.game.scale.baseSize;this.resize(baseSize.width,baseSize.height,this.game.scale.resolution);},onResize:function(gameSize,baseSize,displaySize,resolution)
        {if(baseSize.width!==this.width||baseSize.height!==this.height||resolution!==this.resolution)
        {this.resize(baseSize.width,baseSize.height,resolution);}},resize:function(width,height,resolution)
        {var gl=this.gl;var pipelines=this.pipelines;this.width=width;this.height=height;this.resolution=resolution;gl.viewport(0,0,width,height);for(var pipelineName in pipelines)
        {pipelines[pipelineName].resize(width,height,resolution);}
            this.drawingBufferHeight=gl.drawingBufferHeight;gl.scissor(0,(gl.drawingBufferHeight-height),width,height);this.defaultCamera.setSize(width,height);return this;},onContextRestored:function(callback,target)
        {this.restoredContextCallbacks.push([callback,target]);return this;},onContextLost:function(callback,target)
        {this.lostContextCallbacks.push([callback,target]);return this;},hasExtension:function(extensionName)
        {return this.supportedExtensions?this.supportedExtensions.indexOf(extensionName):false;},getExtension:function(extensionName)
        {if(!this.hasExtension(extensionName)){return null;}
            if(!(extensionName in this.extensions))
            {this.extensions[extensionName]=this.gl.getExtension(extensionName);}
            return this.extensions[extensionName];},flush:function()
        {if(this.currentPipeline)
        {this.currentPipeline.flush();}},hasPipeline:function(pipelineName)
        {return(pipelineName in this.pipelines);},getPipeline:function(pipelineName)
        {return(this.hasPipeline(pipelineName))?this.pipelines[pipelineName]:null;},removePipeline:function(pipelineName)
        {delete this.pipelines[pipelineName];return this;},addPipeline:function(pipelineName,pipelineInstance)
        {if(!this.hasPipeline(pipelineName))
        {this.pipelines[pipelineName]=pipelineInstance;}
        else
        {console.warn('Pipeline exists: '+pipelineName);}
            pipelineInstance.name=pipelineName;this.pipelines[pipelineName].resize(this.width,this.height,this.config.resolution);return pipelineInstance;},pushScissor:function(x,y,width,height,drawingBufferHeight)
        {if(drawingBufferHeight===undefined){drawingBufferHeight=this.drawingBufferHeight;}
            var scissorStack=this.scissorStack;var scissor=[x,y,width,height];scissorStack.push(scissor);this.setScissor(x,y,width,height,drawingBufferHeight);this.currentScissor=scissor;return scissor;},setScissor:function(x,y,width,height,drawingBufferHeight)
        {var gl=this.gl;var current=this.currentScissor;var setScissor=(width>0&&height>0);if(current&&setScissor)
        {var cx=current[0];var cy=current[1];var cw=current[2];var ch=current[3];setScissor=(cx!==x||cy!==y||cw!==width||ch!==height);}
            if(setScissor)
            {this.flush();gl.scissor(x,(drawingBufferHeight-y-height),width,height);}},popScissor:function()
        {var scissorStack=this.scissorStack;scissorStack.pop();var scissor=scissorStack[scissorStack.length-1];if(scissor)
        {this.setScissor(scissor[0],scissor[1],scissor[2],scissor[3]);}
            this.currentScissor=scissor;},setPipeline:function(pipelineInstance,gameObject)
        {if(this.currentPipeline!==pipelineInstance||this.currentPipeline.vertexBuffer!==this.currentVertexBuffer||this.currentPipeline.program!==this.currentProgram)
        {this.flush();this.currentPipeline=pipelineInstance;this.currentPipeline.bind();}
            this.currentPipeline.onBind(gameObject);return this.currentPipeline;},rebindPipeline:function(pipelineInstance)
        {var gl=this.gl;gl.disable(gl.DEPTH_TEST);gl.disable(gl.CULL_FACE);gl.disable(gl.STENCIL_TEST);gl.clear(gl.DEPTH_BUFFER_BIT|gl.STENCIL_BUFFER_BIT);gl.viewport(0,0,this.width,this.height);this.setBlendMode(0,true);gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,this.blankTexture.glTexture);this.currentActiveTextureUnit=0;this.currentTextures[0]=this.blankTexture.glTexture;this.currentPipeline=pipelineInstance;this.currentPipeline.bind();this.currentPipeline.onBind();},clearPipeline:function()
        {this.flush();this.currentPipeline=null;this.currentProgram=null;this.currentVertexBuffer=null;this.currentIndexBuffer=null;this.setBlendMode(0,true);},setBlendMode:function(blendModeId,force)
        {if(force===undefined){force=false;}
            var gl=this.gl;var blendMode=this.blendModes[blendModeId];if(force||(blendModeId!==CONST.BlendModes.SKIP_CHECK&&this.currentBlendMode!==blendModeId))
        {this.flush();gl.enable(gl.BLEND);gl.blendEquation(blendMode.equation);if(blendMode.func.length>2)
        {gl.blendFuncSeparate(blendMode.func[0],blendMode.func[1],blendMode.func[2],blendMode.func[3]);}
        else
        {gl.blendFunc(blendMode.func[0],blendMode.func[1]);}
            this.currentBlendMode=blendModeId;return true;}
            return false;},addBlendMode:function(func,equation)
        {var index=this.blendModes.push({func:func,equation:equation});return index-1;},updateBlendMode:function(index,func,equation)
        {if(this.blendModes[index])
        {this.blendModes[index].func=func;if(equation)
        {this.blendModes[index].equation=equation;}}
            return this;},removeBlendMode:function(index)
        {if(index>17&&this.blendModes[index])
        {this.blendModes.splice(index,1);}
            return this;},setBlankTexture:function(force)
        {if(force===undefined){force=false;}
            if(force||this.currentActiveTextureUnit!==0||!this.currentTextures[0])
            {this.setTexture2D(this.blankTexture.glTexture,0);}},setTexture2D:function(texture,textureUnit,flush)
        {if(flush===undefined){flush=true;}
            var gl=this.gl;if(texture!==this.currentTextures[textureUnit])
        {if(flush)
        {this.flush();}
            if(this.currentActiveTextureUnit!==textureUnit)
            {gl.activeTexture(gl.TEXTURE0+textureUnit);this.currentActiveTextureUnit=textureUnit;}
            gl.bindTexture(gl.TEXTURE_2D,texture);this.currentTextures[textureUnit]=texture;}
            return this;},setFramebuffer:function(framebuffer,updateScissor)
        {if(updateScissor===undefined){updateScissor=false;}
            var gl=this.gl;var width=this.width;var height=this.height;if(framebuffer!==this.currentFramebuffer)
        {if(framebuffer&&framebuffer.renderTexture)
        {width=framebuffer.renderTexture.width;height=framebuffer.renderTexture.height;}
        else
        {this.flush();}
            gl.bindFramebuffer(gl.FRAMEBUFFER,framebuffer);gl.viewport(0,0,width,height);if(updateScissor)
        {if(framebuffer)
        {this.drawingBufferHeight=height;this.pushScissor(0,0,width,height);}
        else
        {this.drawingBufferHeight=this.height;this.popScissor();}}
            this.currentFramebuffer=framebuffer;}
            return this;},setProgram:function(program)
        {var gl=this.gl;if(program!==this.currentProgram)
        {this.flush();gl.useProgram(program);this.currentProgram=program;}
            return this;},setVertexBuffer:function(vertexBuffer)
        {var gl=this.gl;if(vertexBuffer!==this.currentVertexBuffer)
        {this.flush();gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer);this.currentVertexBuffer=vertexBuffer;}
            return this;},setIndexBuffer:function(indexBuffer)
        {var gl=this.gl;if(indexBuffer!==this.currentIndexBuffer)
        {this.flush();gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,indexBuffer);this.currentIndexBuffer=indexBuffer;}
            return this;},createTextureFromSource:function(source,width,height,scaleMode)
        {var gl=this.gl;var filter=gl.NEAREST;var wrap=gl.CLAMP_TO_EDGE;var texture=null;width=source?source.width:width;height=source?source.height:height;if(IsSizePowerOfTwo(width,height))
        {wrap=gl.REPEAT;}
            if(scaleMode===CONST.ScaleModes.LINEAR&&this.config.antialias)
            {filter=gl.LINEAR;}
            if(!source&&typeof width==='number'&&typeof height==='number')
            {texture=this.createTexture2D(0,filter,filter,wrap,wrap,gl.RGBA,null,width,height);}
            else
            {texture=this.createTexture2D(0,filter,filter,wrap,wrap,gl.RGBA,source);}
            return texture;},createTexture2D:function(mipLevel,minFilter,magFilter,wrapT,wrapS,format,pixels,width,height,pma)
        {pma=(pma===undefined||pma===null)?true:pma;var gl=this.gl;var texture=gl.createTexture();this.setTexture2D(texture,0);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,minFilter);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,magFilter);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,wrapS);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,wrapT);gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,pma);if(pixels===null||pixels===undefined)
        {gl.texImage2D(gl.TEXTURE_2D,mipLevel,format,width,height,0,format,gl.UNSIGNED_BYTE,null);}
        else
        {gl.texImage2D(gl.TEXTURE_2D,mipLevel,format,format,gl.UNSIGNED_BYTE,pixels);width=pixels.width;height=pixels.height;}
            this.setTexture2D(null,0);texture.isAlphaPremultiplied=pma;texture.isRenderTexture=false;texture.width=width;texture.height=height;this.nativeTextures.push(texture);return texture;},createFramebuffer:function(width,height,renderTexture,addDepthStencilBuffer)
        {var gl=this.gl;var framebuffer=gl.createFramebuffer();var complete=0;this.setFramebuffer(framebuffer);if(addDepthStencilBuffer)
        {var depthStencilBuffer=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,depthStencilBuffer);gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,width,height);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_STENCIL_ATTACHMENT,gl.RENDERBUFFER,depthStencilBuffer);}
            renderTexture.isRenderTexture=true;renderTexture.isAlphaPremultiplied=false;gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,renderTexture,0);complete=gl.checkFramebufferStatus(gl.FRAMEBUFFER);if(complete!==gl.FRAMEBUFFER_COMPLETE)
        {var errors={36054:'Incomplete Attachment',36055:'Missing Attachment',36057:'Incomplete Dimensions',36061:'Framebuffer Unsupported'};throw new Error('Framebuffer incomplete. Framebuffer status: '+errors[complete]);}
            framebuffer.renderTexture=renderTexture;this.setFramebuffer(null);return framebuffer;},createProgram:function(vertexShader,fragmentShader)
        {var gl=this.gl;var program=gl.createProgram();var vs=gl.createShader(gl.VERTEX_SHADER);var fs=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(vs,vertexShader);gl.shaderSource(fs,fragmentShader);gl.compileShader(vs);gl.compileShader(fs);if(!gl.getShaderParameter(vs,gl.COMPILE_STATUS))
        {throw new Error('Failed to compile Vertex Shader:\n'+gl.getShaderInfoLog(vs));}
            if(!gl.getShaderParameter(fs,gl.COMPILE_STATUS))
            {throw new Error('Failed to compile Fragment Shader:\n'+gl.getShaderInfoLog(fs));}
            gl.attachShader(program,vs);gl.attachShader(program,fs);gl.linkProgram(program);if(!gl.getProgramParameter(program,gl.LINK_STATUS))
        {throw new Error('Failed to link program:\n'+gl.getProgramInfoLog(program));}
            return program;},createVertexBuffer:function(initialDataOrSize,bufferUsage)
        {var gl=this.gl;var vertexBuffer=gl.createBuffer();this.setVertexBuffer(vertexBuffer);gl.bufferData(gl.ARRAY_BUFFER,initialDataOrSize,bufferUsage);this.setVertexBuffer(null);return vertexBuffer;},createIndexBuffer:function(initialDataOrSize,bufferUsage)
        {var gl=this.gl;var indexBuffer=gl.createBuffer();this.setIndexBuffer(indexBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,initialDataOrSize,bufferUsage);this.setIndexBuffer(null);return indexBuffer;},deleteTexture:function(texture)
        {var index=this.nativeTextures.indexOf(texture);if(index!==-1)
        {SpliceOne(this.nativeTextures,index);}
            this.gl.deleteTexture(texture);if(this.currentTextures[0]===texture)
        {this.setBlankTexture(true);}
            return this;},deleteFramebuffer:function(framebuffer)
        {this.gl.deleteFramebuffer(framebuffer);return this;},deleteProgram:function(program)
        {this.gl.deleteProgram(program);return this;},deleteBuffer:function(buffer)
        {this.gl.deleteBuffer(buffer);return this;},preRenderCamera:function(camera)
        {var cx=camera._cx;var cy=camera._cy;var cw=camera._cw;var ch=camera._ch;var TextureTintPipeline=this.pipelines.TextureTintPipeline;var color=camera.backgroundColor;if(camera.renderToTexture)
        {this.flush();this.pushScissor(cx,cy,cw,-ch);this.setFramebuffer(camera.framebuffer);var gl=this.gl;gl.clearColor(0,0,0,0);gl.clear(gl.COLOR_BUFFER_BIT);TextureTintPipeline.projOrtho(cx,cw+cx,cy,ch+cy,-1000,1000);if(color.alphaGL>0)
        {TextureTintPipeline.drawFillRect(cx,cy,cw+cx,ch+cy,Utils.getTintFromFloats(color.redGL,color.greenGL,color.blueGL,1),color.alphaGL);}
            camera.emit('prerender',camera);}
        else
        {this.pushScissor(cx,cy,cw,ch);if(color.alphaGL>0)
        {TextureTintPipeline.drawFillRect(cx,cy,cw,ch,Utils.getTintFromFloats(color.redGL,color.greenGL,color.blueGL,1),color.alphaGL);}}},postRenderCamera:function(camera)
        {var TextureTintPipeline=this.pipelines.TextureTintPipeline;camera.flashEffect.postRenderWebGL(TextureTintPipeline,Utils.getTintFromFloats);camera.fadeEffect.postRenderWebGL(TextureTintPipeline,Utils.getTintFromFloats);camera.dirty=false;this.popScissor();if(camera.renderToTexture)
        {TextureTintPipeline.flush();this.setFramebuffer(null);camera.emit('postrender',camera);TextureTintPipeline.projOrtho(0,TextureTintPipeline.width,TextureTintPipeline.height,0,-1000.0,1000.0);var getTint=Utils.getTintAppendFloatAlpha;var pipeline=(camera.pipeline)?camera.pipeline:TextureTintPipeline;pipeline.batchTexture(camera,camera.glTexture,camera.width,camera.height,camera.x,camera.y,camera.width,camera.height,camera.zoom,camera.zoom,camera.rotation,camera.flipX,!camera.flipY,1,1,0,0,0,0,camera.width,camera.height,getTint(camera._tintTL,camera._alphaTL),getTint(camera._tintTR,camera._alphaTR),getTint(camera._tintBL,camera._alphaBL),getTint(camera._tintBR,camera._alphaBR),(camera._isTinted&&camera.tintFill),0,0,this.defaultCamera,null);this.setBlankTexture(true);}},preRender:function()
        {if(this.contextLost){return;}
            var gl=this.gl;var pipelines=this.pipelines;gl.bindFramebuffer(gl.FRAMEBUFFER,null);if(this.config.clearBeforeRender)
        {var clearColor=this.config.backgroundColor;gl.clearColor(clearColor.redGL,clearColor.greenGL,clearColor.blueGL,1);gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT|gl.STENCIL_BUFFER_BIT);}
            gl.enable(gl.SCISSOR_TEST);for(var key in pipelines)
        {pipelines[key].onPreRender();}
            this.currentScissor=[0,0,this.width,this.height];this.scissorStack=[this.currentScissor];if(this.game.scene.customViewports)
        {gl.scissor(0,(this.drawingBufferHeight-this.height),this.width,this.height);}
            this.setPipeline(this.pipelines.TextureTintPipeline);},render:function(scene,children,interpolationPercentage,camera)
        {if(this.contextLost){return;}
            var list=children.list;var childCount=list.length;var pipelines=this.pipelines;for(var key in pipelines)
        {pipelines[key].onRender(scene,camera);}
            this.preRenderCamera(camera);for(var i=0;i<childCount;i++)
        {var child=list[i];if(!child.willRender(camera))
        {continue;}
            if(child.blendMode!==this.currentBlendMode)
            {this.setBlendMode(child.blendMode);}
            var mask=child.mask;if(mask)
        {mask.preRenderWebGL(this,child,camera);child.renderWebGL(this,child,interpolationPercentage,camera);mask.postRenderWebGL(this,child);}
        else
        {child.renderWebGL(this,child,interpolationPercentage,camera);}}
            this.setBlendMode(CONST.BlendModes.NORMAL);this.postRenderCamera(camera);},postRender:function()
        {if(this.contextLost){return;}
            this.flush();if(this.snapshotState.callback)
        {this.snapshotState.callback(WebGLSnapshot(this.canvas,this.snapshotState.type,this.snapshotState.encoder));this.snapshotState.callback=null;}
            var pipelines=this.pipelines;for(var key in pipelines)
        {pipelines[key].onPostRender();}},snapshot:function(callback,type,encoderOptions)
        {this.snapshotState.callback=callback;this.snapshotState.type=type;this.snapshotState.encoder=encoderOptions;return this;},canvasToTexture:function(srcCanvas,dstTexture,noRepeat)
        {if(noRepeat===undefined){noRepeat=false;}
            var gl=this.gl;if(!dstTexture)
        {var wrapping=gl.CLAMP_TO_EDGE;if(!noRepeat&&IsSizePowerOfTwo(srcCanvas.width,srcCanvas.height))
        {wrapping=gl.REPEAT;}
            dstTexture=this.createTexture2D(0,gl.NEAREST,gl.NEAREST,wrapping,wrapping,gl.RGBA,srcCanvas,srcCanvas.width,srcCanvas.height,true);}
        else
        {this.setTexture2D(dstTexture,0);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,srcCanvas);dstTexture.width=srcCanvas.width;dstTexture.height=srcCanvas.height;this.setTexture2D(null,0);}
            return dstTexture;},setTextureFilter:function(texture,filter)
        {var gl=this.gl;var glFilter=[gl.LINEAR,gl.NEAREST][filter];this.setTexture2D(texture,0);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,glFilter);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,glFilter);this.setTexture2D(null,0);return this;},setFloat1:function(program,name,x)
        {this.setProgram(program);this.gl.uniform1f(this.gl.getUniformLocation(program,name),x);return this;},setFloat2:function(program,name,x,y)
        {this.setProgram(program);this.gl.uniform2f(this.gl.getUniformLocation(program,name),x,y);return this;},setFloat3:function(program,name,x,y,z)
        {this.setProgram(program);this.gl.uniform3f(this.gl.getUniformLocation(program,name),x,y,z);return this;},setFloat4:function(program,name,x,y,z,w)
        {this.setProgram(program);this.gl.uniform4f(this.gl.getUniformLocation(program,name),x,y,z,w);return this;},setFloat1v:function(program,name,arr)
        {this.setProgram(program);this.gl.uniform1fv(this.gl.getUniformLocation(program,name),arr);return this;},setFloat2v:function(program,name,arr)
        {this.setProgram(program);this.gl.uniform2fv(this.gl.getUniformLocation(program,name),arr);return this;},setFloat3v:function(program,name,arr)
        {this.setProgram(program);this.gl.uniform3fv(this.gl.getUniformLocation(program,name),arr);return this;},setFloat4v:function(program,name,arr)
        {this.setProgram(program);this.gl.uniform4fv(this.gl.getUniformLocation(program,name),arr);return this;},setInt1:function(program,name,x)
        {this.setProgram(program);this.gl.uniform1i(this.gl.getUniformLocation(program,name),x);return this;},setInt2:function(program,name,x,y)
        {this.setProgram(program);this.gl.uniform2i(this.gl.getUniformLocation(program,name),x,y);return this;},setInt3:function(program,name,x,y,z)
        {this.setProgram(program);this.gl.uniform3i(this.gl.getUniformLocation(program,name),x,y,z);return this;},setInt4:function(program,name,x,y,z,w)
        {this.setProgram(program);this.gl.uniform4i(this.gl.getUniformLocation(program,name),x,y,z,w);return this;},setMatrix2:function(program,name,transpose,matrix)
        {this.setProgram(program);this.gl.uniformMatrix2fv(this.gl.getUniformLocation(program,name),transpose,matrix);return this;},setMatrix3:function(program,name,transpose,matrix)
        {this.setProgram(program);this.gl.uniformMatrix3fv(this.gl.getUniformLocation(program,name),transpose,matrix);return this;},setMatrix4:function(program,name,transpose,matrix)
        {this.setProgram(program);this.gl.uniformMatrix4fv(this.gl.getUniformLocation(program,name),transpose,matrix);return this;},getMaxTextures:function()
        {return this.config.maxTextures;},getMaxTextureSize:function()
        {return this.config.maxTextureSize;},destroy:function()
        {for(var key in this.pipelines)
        {this.pipelines[key].destroy();delete this.pipelines[key];}
            for(var index=0;index<this.nativeTextures.length;++index)
            {this.deleteTexture(this.nativeTextures[index]);delete this.nativeTextures[index];}
            delete this.gl;delete this.game;this.contextLost=true;this.extensions={};this.nativeTextures.length=0;}});module.exports=WebGLRenderer;}),"./renderer/webgl/index.js":(function(module,exports,__webpack_require__){module.exports={Utils:__webpack_require__("./renderer/webgl/Utils.js"),WebGLPipeline:__webpack_require__("./renderer/webgl/WebGLPipeline.js"),WebGLRenderer:__webpack_require__("./renderer/webgl/WebGLRenderer.js"),Pipelines:__webpack_require__("./renderer/webgl/pipelines/index.js"),BYTE:0,SHORT:1,UNSIGNED_BYTE:2,UNSIGNED_SHORT:3,FLOAT:4};}),"./renderer/webgl/pipelines/BitmapMaskPipeline.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var ShaderSourceFS=__webpack_require__("./renderer/webgl/shaders/BitmapMask-frag.js");var ShaderSourceVS=__webpack_require__("./renderer/webgl/shaders/BitmapMask-vert.js");var WebGLPipeline=__webpack_require__("./renderer/webgl/WebGLPipeline.js");var BitmapMaskPipeline=new Class({Extends:WebGLPipeline,initialize:function BitmapMaskPipeline(config)
        {WebGLPipeline.call(this,{game:config.game,renderer:config.renderer,gl:config.renderer.gl,topology:(config.topology?config.topology:config.renderer.gl.TRIANGLES),vertShader:(config.vertShader?config.vertShader:ShaderSourceVS),fragShader:(config.fragShader?config.fragShader:ShaderSourceFS),vertexCapacity:(config.vertexCapacity?config.vertexCapacity:3),vertexSize:(config.vertexSize?config.vertexSize:Float32Array.BYTES_PER_ELEMENT*2),vertices:new Float32Array([-1,+1,-1,-7,+7,+1]).buffer,attributes:[{name:'inPosition',size:2,type:config.renderer.gl.FLOAT,normalized:false,offset:0}]});this.vertexViewF32=new Float32Array(this.vertexData);this.maxQuads=1;this.resolutionDirty=true;},onBind:function()
        {WebGLPipeline.prototype.onBind.call(this);var renderer=this.renderer;var program=this.program;if(this.resolutionDirty)
        {renderer.setFloat2(program,'uResolution',this.width,this.height);renderer.setInt1(program,'uMainSampler',0);renderer.setInt1(program,'uMaskSampler',1);this.resolutionDirty=false;}
            return this;},resize:function(width,height,resolution)
        {WebGLPipeline.prototype.resize.call(this,width,height,resolution);this.resolutionDirty=true;return this;},beginMask:function(mask,maskedObject,camera)
        {var renderer=this.renderer;var gl=this.gl;var bitmapMask=mask.bitmapMask;if(bitmapMask&&gl)
        {renderer.flush();renderer.setFramebuffer(mask.maskFramebuffer);gl.clearColor(0,0,0,0);gl.clear(gl.COLOR_BUFFER_BIT);bitmapMask.renderWebGL(renderer,bitmapMask,0,camera);renderer.flush();renderer.setFramebuffer(mask.mainFramebuffer);gl.clearColor(0,0,0,0);gl.clear(gl.COLOR_BUFFER_BIT);}},endMask:function(mask)
        {var renderer=this.renderer;var gl=this.gl;var bitmapMask=mask.bitmapMask;if(bitmapMask&&gl)
        {renderer.setFramebuffer(null);renderer.setPipeline(this);renderer.setTexture2D(mask.maskTexture,1);renderer.setTexture2D(mask.mainTexture,0);renderer.setInt1(this.program,'uInvertMaskAlpha',mask.invertAlpha);gl.drawArrays(this.topology,0,3);}}});module.exports=BitmapMaskPipeline;}),"./renderer/webgl/pipelines/ForwardDiffuseLightPipeline.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var ShaderSourceFS=__webpack_require__("./renderer/webgl/shaders/ForwardDiffuse-frag.js");var TextureTintPipeline=__webpack_require__("./renderer/webgl/pipelines/TextureTintPipeline.js");var LIGHT_COUNT=10;var ForwardDiffuseLightPipeline=new Class({Extends:TextureTintPipeline,initialize:function ForwardDiffuseLightPipeline(config)
        {LIGHT_COUNT=config.maxLights;config.fragShader=ShaderSourceFS.replace('%LIGHT_COUNT%',LIGHT_COUNT.toString());TextureTintPipeline.call(this,config);this.defaultNormalMap;this.inverseRotationMatrix=new Float32Array([1,0,0,0,1,0,0,0,1]);},boot:function()
        {this.defaultNormalMap=this.game.textures.getFrame('__DEFAULT');},onBind:function(gameObject)
        {TextureTintPipeline.prototype.onBind.call(this);var renderer=this.renderer;var program=this.program;this.mvpUpdate();renderer.setInt1(program,'uNormSampler',1);renderer.setFloat2(program,'uResolution',this.width,this.height);if(gameObject)
        {this.setNormalMap(gameObject);}
            return this;},onRender:function(scene,camera)
        {this.active=false;var lightManager=scene.sys.lights;if(!lightManager||lightManager.lights.length<=0||!lightManager.active)
        {return this;}
            var lights=lightManager.cull(camera);var lightCount=Math.min(lights.length,LIGHT_COUNT);if(lightCount===0)
        {return this;}
            this.active=true;var renderer=this.renderer;var program=this.program;var cameraMatrix=camera.matrix;var point={x:0,y:0};var height=renderer.height;var index;for(index=0;index<LIGHT_COUNT;++index)
        {renderer.setFloat1(program,'uLights['+index+'].radius',0);}
            renderer.setFloat4(program,'uCamera',camera.x,camera.y,camera.rotation,camera.zoom);renderer.setFloat3(program,'uAmbientLightColor',lightManager.ambientColor.r,lightManager.ambientColor.g,lightManager.ambientColor.b);for(index=0;index<lightCount;++index)
        {var light=lights[index];var lightName='uLights['+index+'].';cameraMatrix.transformPoint(light.x,light.y,point);renderer.setFloat2(program,lightName+'position',point.x-(camera.scrollX*light.scrollFactorX*camera.zoom),height-(point.y-(camera.scrollY*light.scrollFactorY)*camera.zoom));renderer.setFloat3(program,lightName+'color',light.r,light.g,light.b);renderer.setFloat1(program,lightName+'intensity',light.intensity);renderer.setFloat1(program,lightName+'radius',light.radius);}
            return this;},batchTexture:function(gameObject,texture,textureWidth,textureHeight,srcX,srcY,srcWidth,srcHeight,scaleX,scaleY,rotation,flipX,flipY,scrollFactorX,scrollFactorY,displayOriginX,displayOriginY,frameX,frameY,frameWidth,frameHeight,tintTL,tintTR,tintBL,tintBR,tintEffect,uOffset,vOffset,camera,parentTransformMatrix)
        {if(!this.active)
        {return;}
            this.renderer.setPipeline(this);var normalTexture;if(gameObject.displayTexture)
        {normalTexture=gameObject.displayTexture.dataSource[gameObject.displayFrame.sourceIndex];}
        else if(gameObject.texture)
        {normalTexture=gameObject.texture.dataSource[gameObject.frame.sourceIndex];}
        else if(gameObject.tileset)
        {normalTexture=gameObject.tileset.image.dataSource[0];}
            if(!normalTexture)
            {console.warn('Normal map missing or invalid');return;}
            this.setTexture2D(normalTexture.glTexture,1);this.setNormalMapRotation(rotation);var camMatrix=this._tempMatrix1;var spriteMatrix=this._tempMatrix2;var calcMatrix=this._tempMatrix3;var u0=(frameX / textureWidth)+uOffset;var v0=(frameY / textureHeight)+vOffset;var u1=(frameX+frameWidth)/ textureWidth+uOffset;var v1=(frameY+frameHeight)/ textureHeight+vOffset;var width=srcWidth;var height=srcHeight;var x=-displayOriginX;var y=-displayOriginY;if(gameObject.isCropped)
        {var crop=gameObject._crop;width=crop.width;height=crop.height;srcWidth=crop.width;srcHeight=crop.height;frameX=crop.x;frameY=crop.y;var ox=frameX;var oy=frameY;if(flipX)
        {ox=(frameWidth-crop.x-crop.width);}
            if(flipY&&!texture.isRenderTexture)
            {oy=(frameHeight-crop.y-crop.height);}
            u0=(ox / textureWidth)+uOffset;v0=(oy / textureHeight)+vOffset;u1=(ox+crop.width)/ textureWidth+uOffset;v1=(oy+crop.height)/ textureHeight+vOffset;x=-displayOriginX+frameX;y=-displayOriginY+frameY;}
            flipY=flipY^(texture.isRenderTexture?1:0);if(flipX)
        {width*=-1;x+=srcWidth;}
            if(flipY)
            {height*=-1;y+=srcHeight;}
            var xw=x+width;var yh=y+height;spriteMatrix.applyITRS(srcX,srcY,rotation,scaleX,scaleY);camMatrix.copyFrom(camera.matrix);if(parentTransformMatrix)
        {camMatrix.multiplyWithOffset(parentTransformMatrix,-camera.scrollX*scrollFactorX,-camera.scrollY*scrollFactorY);spriteMatrix.e=srcX;spriteMatrix.f=srcY;camMatrix.multiply(spriteMatrix,calcMatrix);}
        else
        {spriteMatrix.e-=camera.scrollX*scrollFactorX;spriteMatrix.f-=camera.scrollY*scrollFactorY;camMatrix.multiply(spriteMatrix,calcMatrix);}
            var tx0=calcMatrix.getX(x,y);var ty0=calcMatrix.getY(x,y);var tx1=calcMatrix.getX(x,yh);var ty1=calcMatrix.getY(x,yh);var tx2=calcMatrix.getX(xw,yh);var ty2=calcMatrix.getY(xw,yh);var tx3=calcMatrix.getX(xw,y);var ty3=calcMatrix.getY(xw,y);if(camera.roundPixels)
        {tx0=Math.round(tx0);ty0=Math.round(ty0);tx1=Math.round(tx1);ty1=Math.round(ty1);tx2=Math.round(tx2);ty2=Math.round(ty2);tx3=Math.round(tx3);ty3=Math.round(ty3);}
            this.setTexture2D(texture,0);this.batchQuad(tx0,ty0,tx1,ty1,tx2,ty2,tx3,ty3,u0,v0,u1,v1,tintTL,tintTR,tintBL,tintBR,tintEffect,texture,0);},setNormalMap:function(gameObject)
        {if(!this.active||!gameObject)
        {return;}
            var normalTexture;if(gameObject.texture)
        {normalTexture=gameObject.texture.dataSource[gameObject.frame.sourceIndex];}
            if(!normalTexture)
            {normalTexture=this.defaultNormalMap;}
            this.setTexture2D(normalTexture.glTexture,1);this.renderer.setPipeline(gameObject.defaultPipeline);},setNormalMapRotation:function(rotation)
        {var inverseRotationMatrix=this.inverseRotationMatrix;if(rotation)
        {var rot=-rotation;var c=Math.cos(rot);var s=Math.sin(rot);inverseRotationMatrix[1]=s;inverseRotationMatrix[3]=-s;inverseRotationMatrix[0]=inverseRotationMatrix[4]=c;}
        else
        {inverseRotationMatrix[0]=inverseRotationMatrix[4]=1;inverseRotationMatrix[1]=inverseRotationMatrix[3]=0;}
            this.renderer.setMatrix3(this.program,'uInverseRotationMatrix',false,inverseRotationMatrix);},batchSprite:function(sprite,camera,parentTransformMatrix)
        {if(!this.active)
        {return;}
            var normalTexture=sprite.texture.dataSource[sprite.frame.sourceIndex];if(normalTexture)
        {this.renderer.setPipeline(this);this.setTexture2D(normalTexture.glTexture,1);this.setNormalMapRotation(sprite.rotation);TextureTintPipeline.prototype.batchSprite.call(this,sprite,camera,parentTransformMatrix);}}});ForwardDiffuseLightPipeline.LIGHT_COUNT=LIGHT_COUNT;module.exports=ForwardDiffuseLightPipeline;}),"./renderer/webgl/pipelines/TextureTintPipeline.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Earcut=__webpack_require__("./geom/polygon/Earcut.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var ModelViewProjection=__webpack_require__("./renderer/webgl/pipelines/components/ModelViewProjection.js");var ShaderSourceFS=__webpack_require__("./renderer/webgl/shaders/TextureTint-frag.js");var ShaderSourceVS=__webpack_require__("./renderer/webgl/shaders/TextureTint-vert.js");var TransformMatrix=__webpack_require__("./gameobjects/components/TransformMatrix.js");var Utils=__webpack_require__("./renderer/webgl/Utils.js");var WebGLPipeline=__webpack_require__("./renderer/webgl/WebGLPipeline.js");var TextureTintPipeline=new Class({Extends:WebGLPipeline,Mixins:[ModelViewProjection],initialize:function TextureTintPipeline(config)
        {var rendererConfig=config.renderer.config;WebGLPipeline.call(this,{game:config.game,renderer:config.renderer,gl:config.renderer.gl,topology:GetFastValue(config,'topology',config.renderer.gl.TRIANGLES),vertShader:GetFastValue(config,'vertShader',ShaderSourceVS),fragShader:GetFastValue(config,'fragShader',ShaderSourceFS),vertexCapacity:GetFastValue(config,'vertexCapacity',6*rendererConfig.batchSize),vertexSize:GetFastValue(config,'vertexSize',Float32Array.BYTES_PER_ELEMENT*5+Uint8Array.BYTES_PER_ELEMENT*4),attributes:[{name:'inPosition',size:2,type:config.renderer.gl.FLOAT,normalized:false,offset:0},{name:'inTexCoord',size:2,type:config.renderer.gl.FLOAT,normalized:false,offset:Float32Array.BYTES_PER_ELEMENT*2},{name:'inTintEffect',size:1,type:config.renderer.gl.FLOAT,normalized:false,offset:Float32Array.BYTES_PER_ELEMENT*4},{name:'inTint',size:4,type:config.renderer.gl.UNSIGNED_BYTE,normalized:true,offset:Float32Array.BYTES_PER_ELEMENT*5}]});this.vertexViewF32=new Float32Array(this.vertexData);this.vertexViewU32=new Uint32Array(this.vertexData);this.maxQuads=rendererConfig.batchSize;this.batches=[];this._tempMatrix1=new TransformMatrix();this._tempMatrix2=new TransformMatrix();this._tempMatrix3=new TransformMatrix();this._tempMatrix4=new TransformMatrix();this.tempTriangle=[{x:0,y:0,width:0},{x:0,y:0,width:0},{x:0,y:0,width:0},{x:0,y:0,width:0}];this.tintEffect=2;this.strokeTint={TL:0,TR:0,BL:0,BR:0};this.fillTint={TL:0,TR:0,BL:0,BR:0};this.currentFrame={u0:0,v0:0,u1:1,v1:1};this.firstQuad=[0,0,0,0,0];this.prevQuad=[0,0,0,0,0];this.polygonCache=[];this.mvpInit();},onBind:function()
        {WebGLPipeline.prototype.onBind.call(this);this.mvpUpdate();return this;},resize:function(width,height,resolution)
        {WebGLPipeline.prototype.resize.call(this,width,height,resolution);this.projOrtho(0,this.width,this.height,0,-1000.0,1000.0);return this;},setTexture2D:function(texture,unit)
        {if(texture===undefined){texture=this.renderer.blankTexture.glTexture;}
            if(unit===undefined){unit=0;}
            if(this.requireTextureBatch(texture,unit))
            {this.pushBatch(texture,unit);}
            return this;},requireTextureBatch:function(texture,unit)
        {var batches=this.batches;var batchLength=batches.length;if(batchLength>0)
        {var currentTexture=(unit>0)?batches[batchLength-1].textures[unit-1]:batches[batchLength-1].texture;return!(currentTexture===texture);}
            return true;},pushBatch:function(texture,unit)
        {if(unit===0)
        {this.batches.push({first:this.vertexCount,texture:texture,textures:[]});}
        else
        {var textures=[];textures[unit-1]=texture;this.batches.push({first:this.vertexCount,texture:null,textures:textures});}},flush:function()
        {if(this.flushLocked)
        {return this;}
            this.flushLocked=true;var gl=this.gl;var vertexCount=this.vertexCount;var topology=this.topology;var vertexSize=this.vertexSize;var renderer=this.renderer;var batches=this.batches;var batchCount=batches.length;var batchVertexCount=0;var batch=null;var batchNext;var textureIndex;var nTexture;if(batchCount===0||vertexCount===0)
        {this.flushLocked=false;return this;}
            gl.bufferSubData(gl.ARRAY_BUFFER,0,this.bytes.subarray(0,vertexCount*vertexSize));for(var index=0;index<batchCount-1;index++)
        {batch=batches[index];batchNext=batches[index+1];if(batch.textures.length>0)
        {for(textureIndex=0;textureIndex<batch.textures.length;++textureIndex)
        {nTexture=batch.textures[textureIndex];if(nTexture)
        {renderer.setTexture2D(nTexture,1+textureIndex,false);}}
            gl.activeTexture(gl.TEXTURE0);}
            batchVertexCount=batchNext.first-batch.first;if(batch.texture===null||batchVertexCount<=0)
        {continue;}
            renderer.setTexture2D(batch.texture,0,false);gl.drawArrays(topology,batch.first,batchVertexCount);}
            batch=batches[batchCount-1];if(batch.textures.length>0)
        {for(textureIndex=0;textureIndex<batch.textures.length;++textureIndex)
        {nTexture=batch.textures[textureIndex];if(nTexture)
        {renderer.setTexture2D(nTexture,1+textureIndex,false);}}
            gl.activeTexture(gl.TEXTURE0);}
            batchVertexCount=vertexCount-batch.first;if(batch.texture&&batchVertexCount>0)
        {renderer.setTexture2D(batch.texture,0,false);gl.drawArrays(topology,batch.first,batchVertexCount);}
            this.vertexCount=0;batches.length=0;this.flushLocked=false;return this;},batchSprite:function(sprite,camera,parentTransformMatrix)
        {this.renderer.setPipeline(this);var camMatrix=this._tempMatrix1;var spriteMatrix=this._tempMatrix2;var calcMatrix=this._tempMatrix3;var frame=sprite.frame;var texture=frame.glTexture;var u0=frame.u0;var v0=frame.v0;var u1=frame.u1;var v1=frame.v1;var frameX=frame.x;var frameY=frame.y;var frameWidth=frame.cutWidth;var frameHeight=frame.cutHeight;var x=-sprite.displayOriginX+frameX;var y=-sprite.displayOriginY+frameY;if(sprite.isCropped)
        {var crop=sprite._crop;if(crop.flipX!==sprite.flipX||crop.flipY!==sprite.flipY)
        {frame.updateCropUVs(crop,sprite.flipX,sprite.flipY);}
            u0=crop.u0;v0=crop.v0;u1=crop.u1;v1=crop.v1;frameWidth=crop.width;frameHeight=crop.height;frameX=crop.x;frameY=crop.y;x=-sprite.displayOriginX+frameX;y=-sprite.displayOriginY+frameY;}
            if(sprite.flipX)
            {x+=frameWidth;frameWidth*=-1;}
            if(sprite.flipY)
            {y+=frameHeight;frameHeight*=-1;}
            var xw=x+frameWidth;var yh=y+frameHeight;spriteMatrix.applyITRS(sprite.x,sprite.y,sprite.rotation,sprite.scaleX,sprite.scaleY);camMatrix.copyFrom(camera.matrix);if(parentTransformMatrix)
        {camMatrix.multiplyWithOffset(parentTransformMatrix,-camera.scrollX*sprite.scrollFactorX,-camera.scrollY*sprite.scrollFactorY);spriteMatrix.e=sprite.x;spriteMatrix.f=sprite.y;camMatrix.multiply(spriteMatrix,calcMatrix);}
        else
        {spriteMatrix.e-=camera.scrollX*sprite.scrollFactorX;spriteMatrix.f-=camera.scrollY*sprite.scrollFactorY;camMatrix.multiply(spriteMatrix,calcMatrix);}
            var tx0=calcMatrix.getX(x,y);var ty0=calcMatrix.getY(x,y);var tx1=calcMatrix.getX(x,yh);var ty1=calcMatrix.getY(x,yh);var tx2=calcMatrix.getX(xw,yh);var ty2=calcMatrix.getY(xw,yh);var tx3=calcMatrix.getX(xw,y);var ty3=calcMatrix.getY(xw,y);var tintTL=Utils.getTintAppendFloatAlpha(sprite._tintTL,camera.alpha*sprite._alphaTL);var tintTR=Utils.getTintAppendFloatAlpha(sprite._tintTR,camera.alpha*sprite._alphaTR);var tintBL=Utils.getTintAppendFloatAlpha(sprite._tintBL,camera.alpha*sprite._alphaBL);var tintBR=Utils.getTintAppendFloatAlpha(sprite._tintBR,camera.alpha*sprite._alphaBR);if(camera.roundPixels)
        {tx0=Math.round(tx0);ty0=Math.round(ty0);tx1=Math.round(tx1);ty1=Math.round(ty1);tx2=Math.round(tx2);ty2=Math.round(ty2);tx3=Math.round(tx3);ty3=Math.round(ty3);}
            this.setTexture2D(texture,0);var tintEffect=(sprite._isTinted&&sprite.tintFill);this.batchQuad(tx0,ty0,tx1,ty1,tx2,ty2,tx3,ty3,u0,v0,u1,v1,tintTL,tintTR,tintBL,tintBR,tintEffect,texture,0);},batchQuad:function(x0,y0,x1,y1,x2,y2,x3,y3,u0,v0,u1,v1,tintTL,tintTR,tintBL,tintBR,tintEffect,texture,unit)
        {var hasFlushed=false;if(this.vertexCount+6>this.vertexCapacity)
        {this.flush();hasFlushed=true;this.setTexture2D(texture,unit);}
            var vertexViewF32=this.vertexViewF32;var vertexViewU32=this.vertexViewU32;var vertexOffset=(this.vertexCount*this.vertexComponentCount)-1;vertexViewF32[++vertexOffset]=x0;vertexViewF32[++vertexOffset]=y0;vertexViewF32[++vertexOffset]=u0;vertexViewF32[++vertexOffset]=v0;vertexViewF32[++vertexOffset]=tintEffect;vertexViewU32[++vertexOffset]=tintTL;vertexViewF32[++vertexOffset]=x1;vertexViewF32[++vertexOffset]=y1;vertexViewF32[++vertexOffset]=u0;vertexViewF32[++vertexOffset]=v1;vertexViewF32[++vertexOffset]=tintEffect;vertexViewU32[++vertexOffset]=tintBL;vertexViewF32[++vertexOffset]=x2;vertexViewF32[++vertexOffset]=y2;vertexViewF32[++vertexOffset]=u1;vertexViewF32[++vertexOffset]=v1;vertexViewF32[++vertexOffset]=tintEffect;vertexViewU32[++vertexOffset]=tintBR;vertexViewF32[++vertexOffset]=x0;vertexViewF32[++vertexOffset]=y0;vertexViewF32[++vertexOffset]=u0;vertexViewF32[++vertexOffset]=v0;vertexViewF32[++vertexOffset]=tintEffect;vertexViewU32[++vertexOffset]=tintTL;vertexViewF32[++vertexOffset]=x2;vertexViewF32[++vertexOffset]=y2;vertexViewF32[++vertexOffset]=u1;vertexViewF32[++vertexOffset]=v1;vertexViewF32[++vertexOffset]=tintEffect;vertexViewU32[++vertexOffset]=tintBR;vertexViewF32[++vertexOffset]=x3;vertexViewF32[++vertexOffset]=y3;vertexViewF32[++vertexOffset]=u1;vertexViewF32[++vertexOffset]=v0;vertexViewF32[++vertexOffset]=tintEffect;vertexViewU32[++vertexOffset]=tintTR;this.vertexCount+=6;return hasFlushed;},batchTri:function(x1,y1,x2,y2,x3,y3,u0,v0,u1,v1,tintTL,tintTR,tintBL,tintEffect,texture,unit)
        {var hasFlushed=false;if(this.vertexCount+3>this.vertexCapacity)
        {this.flush();this.setTexture2D(texture,unit);hasFlushed=true;}
            var vertexViewF32=this.vertexViewF32;var vertexViewU32=this.vertexViewU32;var vertexOffset=(this.vertexCount*this.vertexComponentCount)-1;vertexViewF32[++vertexOffset]=x1;vertexViewF32[++vertexOffset]=y1;vertexViewF32[++vertexOffset]=u0;vertexViewF32[++vertexOffset]=v0;vertexViewF32[++vertexOffset]=tintEffect;vertexViewU32[++vertexOffset]=tintTL;vertexViewF32[++vertexOffset]=x2;vertexViewF32[++vertexOffset]=y2;vertexViewF32[++vertexOffset]=u0;vertexViewF32[++vertexOffset]=v1;vertexViewF32[++vertexOffset]=tintEffect;vertexViewU32[++vertexOffset]=tintTR;vertexViewF32[++vertexOffset]=x3;vertexViewF32[++vertexOffset]=y3;vertexViewF32[++vertexOffset]=u1;vertexViewF32[++vertexOffset]=v1;vertexViewF32[++vertexOffset]=tintEffect;vertexViewU32[++vertexOffset]=tintBL;this.vertexCount+=3;return hasFlushed;},batchTexture:function(gameObject,texture,textureWidth,textureHeight,srcX,srcY,srcWidth,srcHeight,scaleX,scaleY,rotation,flipX,flipY,scrollFactorX,scrollFactorY,displayOriginX,displayOriginY,frameX,frameY,frameWidth,frameHeight,tintTL,tintTR,tintBL,tintBR,tintEffect,uOffset,vOffset,camera,parentTransformMatrix,skipFlip)
        {this.renderer.setPipeline(this,gameObject);var camMatrix=this._tempMatrix1;var spriteMatrix=this._tempMatrix2;var calcMatrix=this._tempMatrix3;var u0=(frameX / textureWidth)+uOffset;var v0=(frameY / textureHeight)+vOffset;var u1=(frameX+frameWidth)/ textureWidth+uOffset;var v1=(frameY+frameHeight)/ textureHeight+vOffset;var width=srcWidth;var height=srcHeight;var x=-displayOriginX;var y=-displayOriginY;if(gameObject.isCropped)
        {var crop=gameObject._crop;width=crop.width;height=crop.height;srcWidth=crop.width;srcHeight=crop.height;frameX=crop.x;frameY=crop.y;var ox=frameX;var oy=frameY;if(flipX)
        {ox=(frameWidth-crop.x-crop.width);}
            if(flipY&&!texture.isRenderTexture)
            {oy=(frameHeight-crop.y-crop.height);}
            u0=(ox / textureWidth)+uOffset;v0=(oy / textureHeight)+vOffset;u1=(ox+crop.width)/ textureWidth+uOffset;v1=(oy+crop.height)/ textureHeight+vOffset;x=-displayOriginX+frameX;y=-displayOriginY+frameY;}
            flipY=flipY^(!skipFlip&&texture.isRenderTexture?1:0);if(flipX)
        {width*=-1;x+=srcWidth;}
            if(flipY)
            {height*=-1;y+=srcHeight;}
            var xw=x+width;var yh=y+height;spriteMatrix.applyITRS(srcX,srcY,rotation,scaleX,scaleY);camMatrix.copyFrom(camera.matrix);if(parentTransformMatrix)
        {camMatrix.multiplyWithOffset(parentTransformMatrix,-camera.scrollX*scrollFactorX,-camera.scrollY*scrollFactorY);spriteMatrix.e=srcX;spriteMatrix.f=srcY;camMatrix.multiply(spriteMatrix,calcMatrix);}
        else
        {spriteMatrix.e-=camera.scrollX*scrollFactorX;spriteMatrix.f-=camera.scrollY*scrollFactorY;camMatrix.multiply(spriteMatrix,calcMatrix);}
            var tx0=calcMatrix.getX(x,y);var ty0=calcMatrix.getY(x,y);var tx1=calcMatrix.getX(x,yh);var ty1=calcMatrix.getY(x,yh);var tx2=calcMatrix.getX(xw,yh);var ty2=calcMatrix.getY(xw,yh);var tx3=calcMatrix.getX(xw,y);var ty3=calcMatrix.getY(xw,y);if(camera.roundPixels)
        {tx0=Math.round(tx0);ty0=Math.round(ty0);tx1=Math.round(tx1);ty1=Math.round(ty1);tx2=Math.round(tx2);ty2=Math.round(ty2);tx3=Math.round(tx3);ty3=Math.round(ty3);}
            this.setTexture2D(texture,0);this.batchQuad(tx0,ty0,tx1,ty1,tx2,ty2,tx3,ty3,u0,v0,u1,v1,tintTL,tintTR,tintBL,tintBR,tintEffect,texture,0);},batchTextureFrame:function(frame,x,y,tint,alpha,transformMatrix,parentTransformMatrix)
        {this.renderer.setPipeline(this);var spriteMatrix=this._tempMatrix1.copyFrom(transformMatrix);var calcMatrix=this._tempMatrix2;var xw=x+frame.width;var yh=y+frame.height;if(parentTransformMatrix)
        {spriteMatrix.multiply(parentTransformMatrix,calcMatrix);}
        else
        {calcMatrix=spriteMatrix;}
            var tx0=calcMatrix.getX(x,y);var ty0=calcMatrix.getY(x,y);var tx1=calcMatrix.getX(x,yh);var ty1=calcMatrix.getY(x,yh);var tx2=calcMatrix.getX(xw,yh);var ty2=calcMatrix.getY(xw,yh);var tx3=calcMatrix.getX(xw,y);var ty3=calcMatrix.getY(xw,y);this.setTexture2D(frame.glTexture,0);tint=Utils.getTintAppendFloatAlpha(tint,alpha);this.batchQuad(tx0,ty0,tx1,ty1,tx2,ty2,tx3,ty3,frame.u0,frame.v0,frame.u1,frame.v1,tint,tint,tint,tint,0,frame.glTexture,0);},drawFillRect:function(x,y,width,height,color,alpha)
        {var xw=x+width;var yh=y+height;this.setTexture2D();var tint=Utils.getTintAppendFloatAlphaAndSwap(color,alpha);this.batchQuad(x,y,x,yh,xw,yh,xw,y,0,0,1,1,tint,tint,tint,tint,2);},batchFillRect:function(x,y,width,height,currentMatrix,parentMatrix)
        {this.renderer.setPipeline(this);var calcMatrix=this._tempMatrix3;if(parentMatrix)
        {parentMatrix.multiply(currentMatrix,calcMatrix);}
            var xw=x+width;var yh=y+height;var x0=calcMatrix.getX(x,y);var y0=calcMatrix.getY(x,y);var x1=calcMatrix.getX(x,yh);var y1=calcMatrix.getY(x,yh);var x2=calcMatrix.getX(xw,yh);var y2=calcMatrix.getY(xw,yh);var x3=calcMatrix.getX(xw,y);var y3=calcMatrix.getY(xw,y);var frame=this.currentFrame;var u0=frame.u0;var v0=frame.v0;var u1=frame.u1;var v1=frame.v1;this.batchQuad(x0,y0,x1,y1,x2,y2,x3,y3,u0,v0,u1,v1,this.fillTint.TL,this.fillTint.TR,this.fillTint.BL,this.fillTint.BR,this.tintEffect);},batchFillTriangle:function(x0,y0,x1,y1,x2,y2,currentMatrix,parentMatrix)
        {this.renderer.setPipeline(this);var calcMatrix=this._tempMatrix3;if(parentMatrix)
        {parentMatrix.multiply(currentMatrix,calcMatrix);}
            var tx0=calcMatrix.getX(x0,y0);var ty0=calcMatrix.getY(x0,y0);var tx1=calcMatrix.getX(x1,y1);var ty1=calcMatrix.getY(x1,y1);var tx2=calcMatrix.getX(x2,y2);var ty2=calcMatrix.getY(x2,y2);var frame=this.currentFrame;var u0=frame.u0;var v0=frame.v0;var u1=frame.u1;var v1=frame.v1;this.batchTri(tx0,ty0,tx1,ty1,tx2,ty2,u0,v0,u1,v1,this.fillTint.TL,this.fillTint.TR,this.fillTint.BL,this.tintEffect);},batchStrokeTriangle:function(x0,y0,x1,y1,x2,y2,lineWidth,currentMatrix,parentMatrix)
        {var tempTriangle=this.tempTriangle;tempTriangle[0].x=x0;tempTriangle[0].y=y0;tempTriangle[0].width=lineWidth;tempTriangle[1].x=x1;tempTriangle[1].y=y1;tempTriangle[1].width=lineWidth;tempTriangle[2].x=x2;tempTriangle[2].y=y2;tempTriangle[2].width=lineWidth;tempTriangle[3].x=x0;tempTriangle[3].y=y0;tempTriangle[3].width=lineWidth;this.batchStrokePath(tempTriangle,lineWidth,false,currentMatrix,parentMatrix);},batchFillPath:function(path,currentMatrix,parentMatrix)
        {this.renderer.setPipeline(this);var calcMatrix=this._tempMatrix3;if(parentMatrix)
        {parentMatrix.multiply(currentMatrix,calcMatrix);}
            var length=path.length;var polygonCache=this.polygonCache;var polygonIndexArray;var point;var tintTL=this.fillTint.TL;var tintTR=this.fillTint.TR;var tintBL=this.fillTint.BL;var tintEffect=this.tintEffect;for(var pathIndex=0;pathIndex<length;++pathIndex)
        {point=path[pathIndex];polygonCache.push(point.x,point.y);}
            polygonIndexArray=Earcut(polygonCache);length=polygonIndexArray.length;var frame=this.currentFrame;for(var index=0;index<length;index+=3)
        {var p0=polygonIndexArray[index+0]*2;var p1=polygonIndexArray[index+1]*2;var p2=polygonIndexArray[index+2]*2;var x0=polygonCache[p0+0];var y0=polygonCache[p0+1];var x1=polygonCache[p1+0];var y1=polygonCache[p1+1];var x2=polygonCache[p2+0];var y2=polygonCache[p2+1];var tx0=calcMatrix.getX(x0,y0);var ty0=calcMatrix.getY(x0,y0);var tx1=calcMatrix.getX(x1,y1);var ty1=calcMatrix.getY(x1,y1);var tx2=calcMatrix.getX(x2,y2);var ty2=calcMatrix.getY(x2,y2);var u0=frame.u0;var v0=frame.v0;var u1=frame.u1;var v1=frame.v1;this.batchTri(tx0,ty0,tx1,ty1,tx2,ty2,u0,v0,u1,v1,tintTL,tintTR,tintBL,tintEffect);}
            polygonCache.length=0;},batchStrokePath:function(path,lineWidth,pathOpen,currentMatrix,parentMatrix)
        {this.renderer.setPipeline(this);this.prevQuad[4]=0;this.firstQuad[4]=0;var pathLength=path.length-1;for(var pathIndex=0;pathIndex<pathLength;pathIndex++)
        {var point0=path[pathIndex];var point1=path[pathIndex+1];this.batchLine(point0.x,point0.y,point1.x,point1.y,point0.width / 2,point1.width / 2,lineWidth,pathIndex,!pathOpen&&(pathIndex===pathLength-1),currentMatrix,parentMatrix);}},batchLine:function(ax,ay,bx,by,aLineWidth,bLineWidth,lineWidth,index,closePath,currentMatrix,parentMatrix)
        {this.renderer.setPipeline(this);var calcMatrix=this._tempMatrix3;if(parentMatrix)
        {parentMatrix.multiply(currentMatrix,calcMatrix);}
            var dx=bx-ax;var dy=by-ay;var len=Math.sqrt(dx*dx+dy*dy);var al0=aLineWidth*(by-ay)/ len;var al1=aLineWidth*(ax-bx)/ len;var bl0=bLineWidth*(by-ay)/ len;var bl1=bLineWidth*(ax-bx)/ len;var lx0=bx-bl0;var ly0=by-bl1;var lx1=ax-al0;var ly1=ay-al1;var lx2=bx+bl0;var ly2=by+bl1;var lx3=ax+al0;var ly3=ay+al1;var brX=calcMatrix.getX(lx0,ly0);var brY=calcMatrix.getY(lx0,ly0);var blX=calcMatrix.getX(lx1,ly1);var blY=calcMatrix.getY(lx1,ly1);var trX=calcMatrix.getX(lx2,ly2);var trY=calcMatrix.getY(lx2,ly2);var tlX=calcMatrix.getX(lx3,ly3);var tlY=calcMatrix.getY(lx3,ly3);var tint=this.strokeTint;var tintEffect=this.tintEffect;var tintTL=tint.TL;var tintTR=tint.TR;var tintBL=tint.BL;var tintBR=tint.BR;var frame=this.currentFrame;var u0=frame.u0;var v0=frame.v0;var u1=frame.u1;var v1=frame.v1;this.batchQuad(tlX,tlY,blX,blY,brX,brY,trX,trY,u0,v0,u1,v1,tintTL,tintTR,tintBL,tintBR,tintEffect);if(lineWidth<=2)
        {return;}
            var prev=this.prevQuad;var first=this.firstQuad;if(index>0&&prev[4])
        {this.batchQuad(tlX,tlY,blX,blY,prev[0],prev[1],prev[2],prev[3],u0,v0,u1,v1,tintTL,tintTR,tintBL,tintBR,tintEffect);}
        else
        {first[0]=tlX;first[1]=tlY;first[2]=blX;first[3]=blY;first[4]=1;}
            if(closePath&&first[4])
            {this.batchQuad(brX,brY,trX,trY,first[0],first[1],first[2],first[3],u0,v0,u1,v1,tintTL,tintTR,tintBL,tintBR,tintEffect);}
            else
            {prev[0]=brX;prev[1]=brY;prev[2]=trX;prev[3]=trY;prev[4]=1;}}});module.exports=TextureTintPipeline;}),"./renderer/webgl/pipelines/components/ModelViewProjection.js":(function(module,exports){var ModelViewProjection={modelMatrixDirty:false,viewMatrixDirty:false,projectionMatrixDirty:false,modelMatrix:null,viewMatrix:null,projectionMatrix:null,mvpInit:function()
        {this.modelMatrixDirty=true;this.viewMatrixDirty=true;this.projectionMatrixDirty=true;this.modelMatrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.viewMatrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.projectionMatrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);return this;},mvpUpdate:function()
        {var program=this.program;if(this.modelMatrixDirty)
        {this.renderer.setMatrix4(program,'uModelMatrix',false,this.modelMatrix);this.modelMatrixDirty=false;}
            if(this.viewMatrixDirty)
            {this.renderer.setMatrix4(program,'uViewMatrix',false,this.viewMatrix);this.viewMatrixDirty=false;}
            if(this.projectionMatrixDirty)
            {this.renderer.setMatrix4(program,'uProjectionMatrix',false,this.projectionMatrix);this.projectionMatrixDirty=false;}
            return this;},modelIdentity:function()
        {var modelMatrix=this.modelMatrix;modelMatrix[0]=1;modelMatrix[1]=0;modelMatrix[2]=0;modelMatrix[3]=0;modelMatrix[4]=0;modelMatrix[5]=1;modelMatrix[6]=0;modelMatrix[7]=0;modelMatrix[8]=0;modelMatrix[9]=0;modelMatrix[10]=1;modelMatrix[11]=0;modelMatrix[12]=0;modelMatrix[13]=0;modelMatrix[14]=0;modelMatrix[15]=1;this.modelMatrixDirty=true;return this;},modelScale:function(x,y,z)
        {var modelMatrix=this.modelMatrix;modelMatrix[0]=modelMatrix[0]*x;modelMatrix[1]=modelMatrix[1]*x;modelMatrix[2]=modelMatrix[2]*x;modelMatrix[3]=modelMatrix[3]*x;modelMatrix[4]=modelMatrix[4]*y;modelMatrix[5]=modelMatrix[5]*y;modelMatrix[6]=modelMatrix[6]*y;modelMatrix[7]=modelMatrix[7]*y;modelMatrix[8]=modelMatrix[8]*z;modelMatrix[9]=modelMatrix[9]*z;modelMatrix[10]=modelMatrix[10]*z;modelMatrix[11]=modelMatrix[11]*z;this.modelMatrixDirty=true;return this;},modelTranslate:function(x,y,z)
        {var modelMatrix=this.modelMatrix;modelMatrix[12]=modelMatrix[0]*x+modelMatrix[4]*y+modelMatrix[8]*z+modelMatrix[12];modelMatrix[13]=modelMatrix[1]*x+modelMatrix[5]*y+modelMatrix[9]*z+modelMatrix[13];modelMatrix[14]=modelMatrix[2]*x+modelMatrix[6]*y+modelMatrix[10]*z+modelMatrix[14];modelMatrix[15]=modelMatrix[3]*x+modelMatrix[7]*y+modelMatrix[11]*z+modelMatrix[15];this.modelMatrixDirty=true;return this;},modelRotateX:function(radians)
        {var modelMatrix=this.modelMatrix;var s=Math.sin(radians);var c=Math.cos(radians);var a10=modelMatrix[4];var a11=modelMatrix[5];var a12=modelMatrix[6];var a13=modelMatrix[7];var a20=modelMatrix[8];var a21=modelMatrix[9];var a22=modelMatrix[10];var a23=modelMatrix[11];modelMatrix[4]=a10*c+a20*s;modelMatrix[5]=a11*c+a21*s;modelMatrix[6]=a12*c+a22*s;modelMatrix[7]=a13*c+a23*s;modelMatrix[8]=a20*c-a10*s;modelMatrix[9]=a21*c-a11*s;modelMatrix[10]=a22*c-a12*s;modelMatrix[11]=a23*c-a13*s;this.modelMatrixDirty=true;return this;},modelRotateY:function(radians)
        {var modelMatrix=this.modelMatrix;var s=Math.sin(radians);var c=Math.cos(radians);var a00=modelMatrix[0];var a01=modelMatrix[1];var a02=modelMatrix[2];var a03=modelMatrix[3];var a20=modelMatrix[8];var a21=modelMatrix[9];var a22=modelMatrix[10];var a23=modelMatrix[11];modelMatrix[0]=a00*c-a20*s;modelMatrix[1]=a01*c-a21*s;modelMatrix[2]=a02*c-a22*s;modelMatrix[3]=a03*c-a23*s;modelMatrix[8]=a00*s+a20*c;modelMatrix[9]=a01*s+a21*c;modelMatrix[10]=a02*s+a22*c;modelMatrix[11]=a03*s+a23*c;this.modelMatrixDirty=true;return this;},modelRotateZ:function(radians)
        {var modelMatrix=this.modelMatrix;var s=Math.sin(radians);var c=Math.cos(radians);var a00=modelMatrix[0];var a01=modelMatrix[1];var a02=modelMatrix[2];var a03=modelMatrix[3];var a10=modelMatrix[4];var a11=modelMatrix[5];var a12=modelMatrix[6];var a13=modelMatrix[7];modelMatrix[0]=a00*c+a10*s;modelMatrix[1]=a01*c+a11*s;modelMatrix[2]=a02*c+a12*s;modelMatrix[3]=a03*c+a13*s;modelMatrix[4]=a10*c-a00*s;modelMatrix[5]=a11*c-a01*s;modelMatrix[6]=a12*c-a02*s;modelMatrix[7]=a13*c-a03*s;this.modelMatrixDirty=true;return this;},viewIdentity:function()
        {var viewMatrix=this.viewMatrix;viewMatrix[0]=1;viewMatrix[1]=0;viewMatrix[2]=0;viewMatrix[3]=0;viewMatrix[4]=0;viewMatrix[5]=1;viewMatrix[6]=0;viewMatrix[7]=0;viewMatrix[8]=0;viewMatrix[9]=0;viewMatrix[10]=1;viewMatrix[11]=0;viewMatrix[12]=0;viewMatrix[13]=0;viewMatrix[14]=0;viewMatrix[15]=1;this.viewMatrixDirty=true;return this;},viewScale:function(x,y,z)
        {var viewMatrix=this.viewMatrix;viewMatrix[0]=viewMatrix[0]*x;viewMatrix[1]=viewMatrix[1]*x;viewMatrix[2]=viewMatrix[2]*x;viewMatrix[3]=viewMatrix[3]*x;viewMatrix[4]=viewMatrix[4]*y;viewMatrix[5]=viewMatrix[5]*y;viewMatrix[6]=viewMatrix[6]*y;viewMatrix[7]=viewMatrix[7]*y;viewMatrix[8]=viewMatrix[8]*z;viewMatrix[9]=viewMatrix[9]*z;viewMatrix[10]=viewMatrix[10]*z;viewMatrix[11]=viewMatrix[11]*z;this.viewMatrixDirty=true;return this;},viewTranslate:function(x,y,z)
        {var viewMatrix=this.viewMatrix;viewMatrix[12]=viewMatrix[0]*x+viewMatrix[4]*y+viewMatrix[8]*z+viewMatrix[12];viewMatrix[13]=viewMatrix[1]*x+viewMatrix[5]*y+viewMatrix[9]*z+viewMatrix[13];viewMatrix[14]=viewMatrix[2]*x+viewMatrix[6]*y+viewMatrix[10]*z+viewMatrix[14];viewMatrix[15]=viewMatrix[3]*x+viewMatrix[7]*y+viewMatrix[11]*z+viewMatrix[15];this.viewMatrixDirty=true;return this;},viewRotateX:function(radians)
        {var viewMatrix=this.viewMatrix;var s=Math.sin(radians);var c=Math.cos(radians);var a10=viewMatrix[4];var a11=viewMatrix[5];var a12=viewMatrix[6];var a13=viewMatrix[7];var a20=viewMatrix[8];var a21=viewMatrix[9];var a22=viewMatrix[10];var a23=viewMatrix[11];viewMatrix[4]=a10*c+a20*s;viewMatrix[5]=a11*c+a21*s;viewMatrix[6]=a12*c+a22*s;viewMatrix[7]=a13*c+a23*s;viewMatrix[8]=a20*c-a10*s;viewMatrix[9]=a21*c-a11*s;viewMatrix[10]=a22*c-a12*s;viewMatrix[11]=a23*c-a13*s;this.viewMatrixDirty=true;return this;},viewRotateY:function(radians)
        {var viewMatrix=this.viewMatrix;var s=Math.sin(radians);var c=Math.cos(radians);var a00=viewMatrix[0];var a01=viewMatrix[1];var a02=viewMatrix[2];var a03=viewMatrix[3];var a20=viewMatrix[8];var a21=viewMatrix[9];var a22=viewMatrix[10];var a23=viewMatrix[11];viewMatrix[0]=a00*c-a20*s;viewMatrix[1]=a01*c-a21*s;viewMatrix[2]=a02*c-a22*s;viewMatrix[3]=a03*c-a23*s;viewMatrix[8]=a00*s+a20*c;viewMatrix[9]=a01*s+a21*c;viewMatrix[10]=a02*s+a22*c;viewMatrix[11]=a03*s+a23*c;this.viewMatrixDirty=true;return this;},viewRotateZ:function(radians)
        {var viewMatrix=this.viewMatrix;var s=Math.sin(radians);var c=Math.cos(radians);var a00=viewMatrix[0];var a01=viewMatrix[1];var a02=viewMatrix[2];var a03=viewMatrix[3];var a10=viewMatrix[4];var a11=viewMatrix[5];var a12=viewMatrix[6];var a13=viewMatrix[7];viewMatrix[0]=a00*c+a10*s;viewMatrix[1]=a01*c+a11*s;viewMatrix[2]=a02*c+a12*s;viewMatrix[3]=a03*c+a13*s;viewMatrix[4]=a10*c-a00*s;viewMatrix[5]=a11*c-a01*s;viewMatrix[6]=a12*c-a02*s;viewMatrix[7]=a13*c-a03*s;this.viewMatrixDirty=true;return this;},viewLoad2D:function(matrix2D)
        {var vm=this.viewMatrix;vm[0]=matrix2D[0];vm[1]=matrix2D[1];vm[2]=0.0;vm[3]=0.0;vm[4]=matrix2D[2];vm[5]=matrix2D[3];vm[6]=0.0;vm[7]=0.0;vm[8]=matrix2D[4];vm[9]=matrix2D[5];vm[10]=1.0;vm[11]=0.0;vm[12]=0.0;vm[13]=0.0;vm[14]=0.0;vm[15]=1.0;this.viewMatrixDirty=true;return this;},viewLoad:function(matrix)
        {var vm=this.viewMatrix;vm[0]=matrix[0];vm[1]=matrix[1];vm[2]=matrix[2];vm[3]=matrix[3];vm[4]=matrix[4];vm[5]=matrix[5];vm[6]=matrix[6];vm[7]=matrix[7];vm[8]=matrix[8];vm[9]=matrix[9];vm[10]=matrix[10];vm[11]=matrix[11];vm[12]=matrix[12];vm[13]=matrix[13];vm[14]=matrix[14];vm[15]=matrix[15];this.viewMatrixDirty=true;return this;},projIdentity:function()
        {var projectionMatrix=this.projectionMatrix;projectionMatrix[0]=1;projectionMatrix[1]=0;projectionMatrix[2]=0;projectionMatrix[3]=0;projectionMatrix[4]=0;projectionMatrix[5]=1;projectionMatrix[6]=0;projectionMatrix[7]=0;projectionMatrix[8]=0;projectionMatrix[9]=0;projectionMatrix[10]=1;projectionMatrix[11]=0;projectionMatrix[12]=0;projectionMatrix[13]=0;projectionMatrix[14]=0;projectionMatrix[15]=1;this.projectionMatrixDirty=true;return this;},projOrtho:function(left,right,bottom,top,near,far)
        {var projectionMatrix=this.projectionMatrix;var leftRight=1.0 /(left-right);var bottomTop=1.0 /(bottom-top);var nearFar=1.0 /(near-far);projectionMatrix[0]=-2.0*leftRight;projectionMatrix[1]=0.0;projectionMatrix[2]=0.0;projectionMatrix[3]=0.0;projectionMatrix[4]=0.0;projectionMatrix[5]=-2.0*bottomTop;projectionMatrix[6]=0.0;projectionMatrix[7]=0.0;projectionMatrix[8]=0.0;projectionMatrix[9]=0.0;projectionMatrix[10]=2.0*nearFar;projectionMatrix[11]=0.0;projectionMatrix[12]=(left+right)*leftRight;projectionMatrix[13]=(top+bottom)*bottomTop;projectionMatrix[14]=(far+near)*nearFar;projectionMatrix[15]=1.0;this.projectionMatrixDirty=true;return this;},projPersp:function(fovy,aspectRatio,near,far)
        {var projectionMatrix=this.projectionMatrix;var fov=1.0 / Math.tan(fovy / 2.0);var nearFar=1.0 /(near-far);projectionMatrix[0]=fov / aspectRatio;projectionMatrix[1]=0.0;projectionMatrix[2]=0.0;projectionMatrix[3]=0.0;projectionMatrix[4]=0.0;projectionMatrix[5]=fov;projectionMatrix[6]=0.0;projectionMatrix[7]=0.0;projectionMatrix[8]=0.0;projectionMatrix[9]=0.0;projectionMatrix[10]=(far+near)*nearFar;projectionMatrix[11]=-1.0;projectionMatrix[12]=0.0;projectionMatrix[13]=0.0;projectionMatrix[14]=(2.0*far*near)*nearFar;projectionMatrix[15]=0.0;this.projectionMatrixDirty=true;return this;}};module.exports=ModelViewProjection;}),"./renderer/webgl/pipelines/index.js":(function(module,exports,__webpack_require__){module.exports={BitmapMaskPipeline:__webpack_require__("./renderer/webgl/pipelines/BitmapMaskPipeline.js"),ForwardDiffuseLightPipeline:__webpack_require__("./renderer/webgl/pipelines/ForwardDiffuseLightPipeline.js"),TextureTintPipeline:__webpack_require__("./renderer/webgl/pipelines/TextureTintPipeline.js")};}),"./renderer/webgl/shaders/BitmapMask-frag.js":(function(module,exports){module.exports=['#define SHADER_NAME PHASER_BITMAP_MASK_FS','','precision mediump float;','','uniform vec2 uResolution;','uniform sampler2D uMainSampler;','uniform sampler2D uMaskSampler;','uniform bool uInvertMaskAlpha;','','void main()','{','    vec2 uv = gl_FragCoord.xy / uResolution;','    vec4 mainColor = texture2D(uMainSampler, uv);','    vec4 maskColor = texture2D(uMaskSampler, uv);','    float alpha = mainColor.a;','','    if (!uInvertMaskAlpha)','    {','        alpha *= (maskColor.a);','    }','    else','    {','        alpha *= (1.0 - maskColor.a);','    }','','    gl_FragColor = vec4(mainColor.rgb * alpha, alpha);','}',''].join('\n');}),"./renderer/webgl/shaders/BitmapMask-vert.js":(function(module,exports){module.exports=['#define SHADER_NAME PHASER_BITMAP_MASK_VS','','precision mediump float;','','attribute vec2 inPosition;','','void main()','{','    gl_Position = vec4(inPosition, 0.0, 1.0);','}',''].join('\n');}),"./renderer/webgl/shaders/ForwardDiffuse-frag.js":(function(module,exports){module.exports=['#define SHADER_NAME PHASER_FORWARD_DIFFUSE_FS','','precision mediump float;','','struct Light','{','    vec2 position;','    vec3 color;','    float intensity;','    float radius;','};','','const int kMaxLights = %LIGHT_COUNT%;','','uniform vec4 uCamera; /* x, y, rotation, zoom */','uniform vec2 uResolution;','uniform sampler2D uMainSampler;','uniform sampler2D uNormSampler;','uniform vec3 uAmbientLightColor;','uniform Light uLights[kMaxLights];','uniform mat3 uInverseRotationMatrix;','','varying vec2 outTexCoord;','varying vec4 outTint;','','void main()','{','    vec3 finalColor = vec3(0.0, 0.0, 0.0);','    vec4 color = texture2D(uMainSampler, outTexCoord) * vec4(outTint.rgb * outTint.a, outTint.a);','    vec3 normalMap = texture2D(uNormSampler, outTexCoord).rgb;','    vec3 normal = normalize(uInverseRotationMatrix * vec3(normalMap * 2.0 - 1.0));','    vec2 res = vec2(min(uResolution.x, uResolution.y)) * uCamera.w;','','    for (int index = 0; index < kMaxLights; ++index)','    {','        Light light = uLights[index];','        vec3 lightDir = vec3((light.position.xy / res) - (gl_FragCoord.xy / res), 0.1);','        vec3 lightNormal = normalize(lightDir);','        float distToSurf = length(lightDir) * uCamera.w;','        float diffuseFactor = max(dot(normal, lightNormal), 0.0);','        float radius = (light.radius / res.x * uCamera.w) * uCamera.w;','        float attenuation = clamp(1.0 - distToSurf * distToSurf / (radius * radius), 0.0, 1.0);','        vec3 diffuse = light.color * diffuseFactor;','        finalColor += (attenuation * diffuse) * light.intensity;','    }','','    vec4 colorOutput = vec4(uAmbientLightColor + finalColor, 1.0);','    gl_FragColor = color * vec4(colorOutput.rgb * colorOutput.a, colorOutput.a);','','}',''].join('\n');}),"./renderer/webgl/shaders/TextureTint-frag.js":(function(module,exports){module.exports=['#define SHADER_NAME PHASER_TEXTURE_TINT_FS','','precision mediump float;','','uniform sampler2D uMainSampler;','','varying vec2 outTexCoord;','varying float outTintEffect;','varying vec4 outTint;','','void main()','{','    vec4 texture = texture2D(uMainSampler, outTexCoord);','    vec4 texel = vec4(outTint.rgb * outTint.a, outTint.a);','    vec4 color = texture;','','    if (outTintEffect == 0.0)','    {','        //  Multiply texture tint','        color = texture * texel;','    }','    else if (outTintEffect == 1.0)','    {','        //  Solid color + texture alpha','        color.rgb = mix(texture.rgb, outTint.rgb * outTint.a, texture.a);','        color.a = texture.a * texel.a;','    }','    else if (outTintEffect == 2.0)','    {','        //  Solid color, no texture','        color = texel;','    }','','    gl_FragColor = color;','}',''].join('\n');}),"./renderer/webgl/shaders/TextureTint-vert.js":(function(module,exports){module.exports=['#define SHADER_NAME PHASER_TEXTURE_TINT_VS','','precision mediump float;','','uniform mat4 uProjectionMatrix;','uniform mat4 uViewMatrix;','uniform mat4 uModelMatrix;','','attribute vec2 inPosition;','attribute vec2 inTexCoord;','attribute float inTintEffect;','attribute vec4 inTint;','','varying vec2 outTexCoord;','varying float outTintEffect;','varying vec4 outTint;','','void main ()','{','    gl_Position = uProjectionMatrix * uViewMatrix * uModelMatrix * vec4(inPosition, 1.0, 1.0);','','    outTexCoord = inTexCoord;','    outTint = inTint;','    outTintEffect = inTintEffect;','}','',''].join('\n');}),"./scene/GetPhysicsPlugins.js":(function(module,exports,__webpack_require__){var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var UppercaseFirst=__webpack_require__("./utils/string/UppercaseFirst.js");var GetPhysicsPlugins=function(sys)
    {var defaultSystem=sys.game.config.defaultPhysicsSystem;var sceneSystems=GetFastValue(sys.settings,'physics',false);if(!defaultSystem&&!sceneSystems)
    {return;}
        var output=[];if(defaultSystem)
    {output.push(UppercaseFirst(defaultSystem+'Physics'));}
        if(sceneSystems)
        {for(var key in sceneSystems)
        {key=UppercaseFirst(key.concat('Physics'));if(output.indexOf(key)===-1)
        {output.push(key);}}}
        return output;};module.exports=GetPhysicsPlugins;}),"./scene/GetScenePlugins.js":(function(module,exports,__webpack_require__){var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var GetScenePlugins=function(sys)
    {var defaultPlugins=sys.plugins.getDefaultScenePlugins();var scenePlugins=GetFastValue(sys.settings,'plugins',false);if(Array.isArray(scenePlugins))
    {return scenePlugins;}
    else if(defaultPlugins)
    {return defaultPlugins;}
    else
    {return[];}};module.exports=GetScenePlugins;}),"./scene/InjectionMap.js":(function(module,exports,__webpack_require__){var InjectionMap={game:'game',anims:'anims',cache:'cache',plugins:'plugins',registry:'registry',scale:'scale',sound:'sound',textures:'textures',events:'events',cameras:'cameras',add:'add',make:'make',scenePlugin:'scene',displayList:'children',lights:'lights',data:'data',input:'input',load:'load',time:'time',tweens:'tweens',arcadePhysics:'physics',impactPhysics:'impact',matterPhysics:'matter'};if(false)
    {}
        if(false)
        {}
        module.exports=InjectionMap;}),"./scene/Scene.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Systems=__webpack_require__("./scene/Systems.js");var Scene=new Class({initialize:function Scene(config)
        {this.sys=new Systems(this,config);this.game;this.anims;this.cache;this.registry;this.sound;this.textures;this.events;this.cameras;this.add;this.make;this.scene;this.children;this.lights;this.data;this.input;this.load;this.time;this.tweens;this.physics;this.impact;this.matter;if(false)
        {}},update:function()
        {}});module.exports=Scene;}),"./scene/SceneManager.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var CONST=__webpack_require__("./scene/const.js");var GetValue=__webpack_require__("./utils/object/GetValue.js");var NOOP=__webpack_require__("./utils/NOOP.js");var Scene=__webpack_require__("./scene/Scene.js");var Systems=__webpack_require__("./scene/Systems.js");var SceneManager=new Class({initialize:function SceneManager(game,sceneConfig)
        {this.game=game;this.keys={};this.scenes=[];this._pending=[];this._start=[];this._queue=[];this._data={};this.isProcessing=false;this.isBooted=false;this.customViewports=0;if(sceneConfig)
        {if(!Array.isArray(sceneConfig))
        {sceneConfig=[sceneConfig];}
            for(var i=0;i<sceneConfig.length;i++)
            {this._pending.push({key:'default',scene:sceneConfig[i],autoStart:(i===0),data:{}});}}
            game.events.once('ready',this.bootQueue,this);},bootQueue:function()
        {if(this.isBooted)
        {return;}
            var i;var entry;var key;var sceneConfig;for(i=0;i<this._pending.length;i++)
        {entry=this._pending[i];key=entry.key;sceneConfig=entry.scene;var newScene;if(sceneConfig instanceof Scene)
        {newScene=this.createSceneFromInstance(key,sceneConfig);}
        else if(typeof sceneConfig==='object')
        {newScene=this.createSceneFromObject(key,sceneConfig);}
        else if(typeof sceneConfig==='function')
        {newScene=this.createSceneFromFunction(key,sceneConfig);}
            key=newScene.sys.settings.key;this.keys[key]=newScene;this.scenes.push(newScene);if(this._data[key])
        {newScene.sys.settings.data=this._data[key].data;if(this._data[key].autoStart)
        {entry.autoStart=true;}}
            if(entry.autoStart||newScene.sys.settings.active)
            {this._start.push(key);}}
            this._pending.length=0;this._data={};this.isBooted=true;for(i=0;i<this._start.length;i++)
        {entry=this._start[i];this.start(entry);}
            this._start.length=0;},processQueue:function()
        {var pendingLength=this._pending.length;var queueLength=this._queue.length;if(pendingLength===0&&queueLength===0)
        {return;}
            var i;var entry;if(pendingLength)
        {for(i=0;i<pendingLength;i++)
        {entry=this._pending[i];this.add(entry.key,entry.scene,entry.autoStart,entry.data);}
            for(i=0;i<this._start.length;i++)
            {entry=this._start[i];this.start(entry);}
            this._start.length=0;this._pending.length=0;return;}
            for(i=0;i<this._queue.length;i++)
            {entry=this._queue[i];this[entry.op](entry.keyA,entry.keyB);}
            this._queue.length=0;},add:function(key,sceneConfig,autoStart,data)
        {if(autoStart===undefined){autoStart=false;}
            if(data===undefined){data={};}
            if(this.isProcessing||!this.isBooted)
            {this._pending.push({key:key,scene:sceneConfig,autoStart:autoStart,data:data});if(!this.isBooted)
            {this._data[key]={data:data};}
                return null;}
            key=this.getKey(key,sceneConfig);var newScene;if(sceneConfig instanceof Scene)
        {newScene=this.createSceneFromInstance(key,sceneConfig);}
        else if(typeof sceneConfig==='object')
        {sceneConfig.key=key;newScene=this.createSceneFromObject(key,sceneConfig);}
        else if(typeof sceneConfig==='function')
        {newScene=this.createSceneFromFunction(key,sceneConfig);}
            newScene.sys.settings.data=data;key=newScene.sys.settings.key;this.keys[key]=newScene;this.scenes.push(newScene);if(autoStart||newScene.sys.settings.active)
        {if(this._pending.length)
        {this._start.push(key);}
        else
        {this.start(key);}}
            return newScene;},remove:function(key)
        {if(this.isProcessing)
        {this._queue.push({op:'remove',keyA:key,keyB:null});}
        else
        {var sceneToRemove=this.getScene(key);if(!sceneToRemove||sceneToRemove.sys.isTransitioning())
        {return this;}
            var index=this.scenes.indexOf(sceneToRemove);var sceneKey=sceneToRemove.sys.settings.key;if(index>-1)
        {delete this.keys[sceneKey];this.scenes.splice(index,1);if(this._start.indexOf(sceneKey)>-1)
        {index=this._start.indexOf(sceneKey);this._start.splice(index,1);}
            sceneToRemove.sys.destroy();}}
            return this;},bootScene:function(scene)
        {var sys=scene.sys;var settings=sys.settings;if(scene.init)
        {scene.init.call(scene,settings.data);settings.status=CONST.INIT;if(settings.isTransition)
        {sys.events.emit('transitioninit',settings.transitionFrom,settings.transitionDuration);}}
            var loader;if(sys.load)
        {loader=sys.load;loader.reset();}
            if(loader&&scene.preload)
            {scene.preload.call(scene);if(loader.list.size===0)
            {this.create(scene);}
            else
            {settings.status=CONST.LOADING;loader.once('complete',this.loadComplete,this);loader.start();}}
            else
            {this.create(scene);}},loadComplete:function(loader)
        {var scene=loader.scene;if(this.game.sound.onBlurPausedSounds)
        {this.game.sound.unlock();}
            this.create(scene);},payloadComplete:function(loader)
        {this.bootScene(loader.scene);},update:function(time,delta)
        {this.processQueue();this.isProcessing=true;for(var i=this.scenes.length-1;i>=0;i--)
        {var sys=this.scenes[i].sys;if(sys.settings.status>CONST.START&&sys.settings.status<=CONST.RUNNING)
        {sys.step(time,delta);}}},render:function(renderer)
        {for(var i=0;i<this.scenes.length;i++)
        {var sys=this.scenes[i].sys;if(sys.settings.visible&&sys.settings.status>=CONST.LOADING&&sys.settings.status<CONST.SLEEPING)
        {sys.render(renderer);}}
            this.isProcessing=false;},create:function(scene)
        {var sys=scene.sys;var settings=sys.settings;if(scene.create)
        {settings.status=CONST.CREATING;scene.create.call(scene,settings.data);if(settings.isTransition)
        {sys.events.emit('transitionstart',settings.transitionFrom,settings.transitionDuration);}}
            if(scene.update)
            {sys.sceneUpdate=scene.update;}
            settings.status=CONST.RUNNING;},createSceneFromFunction:function(key,scene)
        {var newScene=new scene();if(newScene instanceof Scene)
        {var configKey=newScene.sys.settings.key;if(configKey!=='')
        {key=configKey;}
            if(this.keys.hasOwnProperty(key))
            {throw new Error('Cannot add a Scene with duplicate key: '+key);}
            return this.createSceneFromInstance(key,newScene);}
        else
        {newScene.sys=new Systems(newScene);newScene.sys.settings.key=key;newScene.sys.init(this.game);return newScene;}},createSceneFromInstance:function(key,newScene)
        {var configKey=newScene.sys.settings.key;if(configKey!=='')
        {key=configKey;}
        else
        {newScene.sys.settings.key=key;}
            newScene.sys.init(this.game);return newScene;},createSceneFromObject:function(key,sceneConfig)
        {var newScene=new Scene(sceneConfig);var configKey=newScene.sys.settings.key;if(configKey!=='')
        {key=configKey;}
        else
        {newScene.sys.settings.key=key;}
            newScene.sys.init(this.game);var defaults=['init','preload','create','update','render'];for(var i=0;i<defaults.length;i++)
        {var sceneCallback=GetValue(sceneConfig,defaults[i],null);if(sceneCallback)
        {newScene[defaults[i]]=sceneCallback;}}
            if(sceneConfig.hasOwnProperty('extend'))
            {for(var propertyKey in sceneConfig.extend)
            {var value=sceneConfig.extend[propertyKey];if(propertyKey==='data'&&newScene.hasOwnProperty('data')&&typeof value==='object')
            {newScene.data.merge(value);}
            else if(propertyKey!=='sys')
            {newScene[propertyKey]=value;}}}
            return newScene;},getKey:function(key,sceneConfig)
        {if(!key){key='default';}
            if(typeof sceneConfig==='function')
            {return key;}
            else if(sceneConfig instanceof Scene)
            {key=sceneConfig.sys.settings.key;}
            else if(typeof sceneConfig==='object'&&sceneConfig.hasOwnProperty('key'))
            {key=sceneConfig.key;}
            if(this.keys.hasOwnProperty(key))
            {throw new Error('Cannot add a Scene with duplicate key: '+key);}
            else
            {return key;}},getScene:function(key)
        {if(typeof key==='string')
        {if(this.keys[key])
        {return this.keys[key];}}
        else
        {for(var i=0;i<this.scenes.length;i++)
        {if(key===this.scenes[i])
        {return key;}}}
            return null;},isActive:function(key)
        {var scene=this.getScene(key);if(scene)
        {return scene.sys.isActive();}
            return null;},isVisible:function(key)
        {var scene=this.getScene(key);if(scene)
        {return scene.sys.isVisible();}
            return null;},isSleeping:function(key)
        {var scene=this.getScene(key);if(scene)
        {return scene.sys.isSleeping();}
            return null;},pause:function(key,data)
        {var scene=this.getScene(key);if(scene)
        {scene.sys.pause(data);}
            return this;},resume:function(key,data)
        {var scene=this.getScene(key);if(scene)
        {scene.sys.resume(data);}
            return this;},sleep:function(key,data)
        {var scene=this.getScene(key);if(scene&&!scene.sys.isTransitioning())
        {scene.sys.sleep(data);}
            return this;},wake:function(key,data)
        {var scene=this.getScene(key);if(scene)
        {scene.sys.wake(data);}
            return this;},run:function(key,data)
        {var scene=this.getScene(key);if(!scene)
        {for(var i=0;i<this._pending.length;i++)
        {if(this._pending[i].key===key)
        {this.queueOp('start',key,data);break;}}
            return this;}
            if(scene.sys.isSleeping())
            {scene.sys.wake(data);}
            else if(scene.sys.isBooted&&!scene.sys.isActive())
            {scene.sys.resume(data);}
            else
            {this.start(key,data);}},start:function(key,data)
        {if(!this.isBooted)
        {this._data[key]={autoStart:true,data:data};return this;}
            var scene=this.getScene(key);if(scene)
        {if(scene.sys.isActive()||scene.sys.isPaused())
        {scene.sys.shutdown();scene.sys.start(data);}
        else
        {scene.sys.start(data);var loader;if(scene.sys.load)
        {loader=scene.sys.load;}
            if(loader&&scene.sys.settings.hasOwnProperty('pack'))
            {loader.reset();if(loader.addPack({payload:scene.sys.settings.pack}))
            {scene.sys.settings.status=CONST.LOADING;loader.once('complete',this.payloadComplete,this);loader.start();return this;}}}
            this.bootScene(scene);}
            return this;},stop:function(key)
        {var scene=this.getScene(key);if(scene&&!scene.sys.isTransitioning())
        {scene.sys.shutdown();}
            return this;},switch:function(from,to)
        {var sceneA=this.getScene(from);var sceneB=this.getScene(to);if(sceneA&&sceneB&&sceneA!==sceneB)
        {this.sleep(from);if(this.isSleeping(to))
        {this.wake(to);}
        else
        {this.start(to);}}
            return this;},getAt:function(index)
        {return this.scenes[index];},getIndex:function(key)
        {var scene=this.getScene(key);return this.scenes.indexOf(scene);},bringToTop:function(key)
        {if(this.isProcessing)
        {this._queue.push({op:'bringToTop',keyA:key,keyB:null});}
        else
        {var index=this.getIndex(key);if(index!==-1&&index<this.scenes.length)
        {var scene=this.getScene(key);this.scenes.splice(index,1);this.scenes.push(scene);}}
            return this;},sendToBack:function(key)
        {if(this.isProcessing)
        {this._queue.push({op:'sendToBack',keyA:key,keyB:null});}
        else
        {var index=this.getIndex(key);if(index!==-1&&index>0)
        {var scene=this.getScene(key);this.scenes.splice(index,1);this.scenes.unshift(scene);}}
            return this;},moveDown:function(key)
        {if(this.isProcessing)
        {this._queue.push({op:'moveDown',keyA:key,keyB:null});}
        else
        {var indexA=this.getIndex(key);if(indexA>0)
        {var indexB=indexA-1;var sceneA=this.getScene(key);var sceneB=this.getAt(indexB);this.scenes[indexA]=sceneB;this.scenes[indexB]=sceneA;}}
            return this;},moveUp:function(key)
        {if(this.isProcessing)
        {this._queue.push({op:'moveUp',keyA:key,keyB:null});}
        else
        {var indexA=this.getIndex(key);if(indexA<this.scenes.length-1)
        {var indexB=indexA+1;var sceneA=this.getScene(key);var sceneB=this.getAt(indexB);this.scenes[indexA]=sceneB;this.scenes[indexB]=sceneA;}}
            return this;},moveAbove:function(keyA,keyB)
        {if(keyA===keyB)
        {return this;}
            if(this.isProcessing)
            {this._queue.push({op:'moveAbove',keyA:keyA,keyB:keyB});}
            else
            {var indexA=this.getIndex(keyA);var indexB=this.getIndex(keyB);if(indexA!==-1&&indexB!==-1)
            {var tempScene=this.getAt(indexB);this.scenes.splice(indexB,1);this.scenes.splice(indexA+1,0,tempScene);}}
            return this;},moveBelow:function(keyA,keyB)
        {if(keyA===keyB)
        {return this;}
            if(this.isProcessing)
            {this._queue.push({op:'moveBelow',keyA:keyA,keyB:keyB});}
            else
            {var indexA=this.getIndex(keyA);var indexB=this.getIndex(keyB);if(indexA!==-1&&indexB!==-1)
            {var tempScene=this.getAt(indexB);this.scenes.splice(indexB,1);if(indexA===0)
            {this.scenes.unshift(tempScene);}
            else
            {this.scenes.splice(indexA,0,tempScene);}}}
            return this;},queueOp:function(op,keyA,keyB)
        {this._queue.push({op:op,keyA:keyA,keyB:keyB});return this;},swapPosition:function(keyA,keyB)
        {if(keyA===keyB)
        {return this;}
            if(this.isProcessing)
            {this._queue.push({op:'swapPosition',keyA:keyA,keyB:keyB});}
            else
            {var indexA=this.getIndex(keyA);var indexB=this.getIndex(keyB);if(indexA!==indexB&&indexA!==-1&&indexB!==-1)
            {var tempScene=this.getAt(indexA);this.scenes[indexA]=this.scenes[indexB];this.scenes[indexB]=tempScene;}}
            return this;},dump:function()
        {var out=[];var map=['pending','init','start','loading','creating','running','paused','sleeping','shutdown','destroyed'];for(var i=0;i<this.scenes.length;i++)
        {var sys=this.scenes[i].sys;var key=(sys.settings.visible&&(sys.settings.status===CONST.RUNNING||sys.settings.status===CONST.PAUSED))?'[*] ':'[-] ';key+=sys.settings.key+' ('+map[sys.settings.status]+')';out.push(key);}
            console.log(out.join('\n'));},destroy:function()
        {for(var i=0;i<this.scenes.length;i++)
        {var sys=this.scenes[i].sys;sys.destroy();}
            this.update=NOOP;this.scenes=[];this._pending=[];this._start=[];this._queue=[];this.game=null;}});module.exports=SceneManager;}),"./scene/ScenePlugin.js":(function(module,exports,__webpack_require__){var Clamp=__webpack_require__("./math/Clamp.js");var Class=__webpack_require__("./utils/Class.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var PluginCache=__webpack_require__("./plugins/PluginCache.js");var ScenePlugin=new Class({initialize:function ScenePlugin(scene)
        {this.scene=scene;this.systems=scene.sys;this.settings=scene.sys.settings;this.key=scene.sys.settings.key;this.manager=scene.sys.game.scene;this.transitionProgress=0;this._elapsed=0;this._target=null;this._duration=0;this._onUpdate;this._onUpdateScope;this._willSleep=false;this._willRemove=false;scene.sys.events.once('boot',this.boot,this);scene.sys.events.on('start',this.pluginStart,this);},boot:function()
        {this.systems.events.once('destroy',this.destroy,this);},pluginStart:function()
        {this._target=null;this.systems.events.once('shutdown',this.shutdown,this);},start:function(key,data)
        {if(key===undefined){key=this.key;}
            this.manager.queueOp('stop',this.key);this.manager.queueOp('start',key,data);return this;},restart:function(data)
        {var key=this.key;this.manager.queueOp('stop',key);this.manager.queueOp('start',key,data);return this;},transition:function(config)
        {if(config===undefined){config={};}
            var key=GetFastValue(config,'target',false);var target=this.manager.getScene(key);if(!key||!this.checkValidTransition(target))
        {return false;}
            var duration=GetFastValue(config,'duration',1000);this._elapsed=0;this._target=target;this._duration=duration;this._willSleep=GetFastValue(config,'sleep',false);this._willRemove=GetFastValue(config,'remove',false);var callback=GetFastValue(config,'onUpdate',null);if(callback)
        {this._onUpdate=callback;this._onUpdateScope=GetFastValue(config,'onUpdateScope',this.scene);}
            var allowInput=GetFastValue(config,'allowInput',false);this.settings.transitionAllowInput=allowInput;var targetSettings=target.sys.settings;targetSettings.isTransition=true;targetSettings.transitionFrom=this.scene;targetSettings.transitionDuration=duration;targetSettings.transitionAllowInput=allowInput;if(GetFastValue(config,'moveAbove',false))
        {this.manager.moveAbove(this.key,key);}
        else if(GetFastValue(config,'moveBelow',false))
        {this.manager.moveBelow(this.key,key);}
            if(target.sys.isSleeping())
            {target.sys.wake();}
            else
            {this.manager.start(key,GetFastValue(config,'data'));}
            this.systems.events.emit('transitionout',target,duration);this.systems.events.on('update',this.step,this);return true;},checkValidTransition:function(target)
        {if(!target||target.sys.isActive()||target.sys.isTransitioning()||target===this.scene||this.systems.isTransitioning())
        {return false;}
            return true;},step:function(time,delta)
        {this._elapsed+=delta;this.transitionProgress=Clamp(this._elapsed / this._duration,0,1);if(this._onUpdate)
        {this._onUpdate.call(this._onUpdateScope,this.transitionProgress);}
            if(this._elapsed>=this._duration)
            {this.transitionComplete();}},transitionComplete:function()
        {var targetSys=this._target.sys;var targetSettings=this._target.sys.settings;this.systems.events.off('update',this.step,this);targetSys.events.emit('transitioncomplete',this.scene);targetSettings.isTransition=false;targetSettings.transitionFrom=null;this._duration=0;this._target=null;this._onUpdate=null;this._onUpdateScope=null;if(this._willRemove)
        {this.manager.remove(this.key);}
        else if(this._willSleep)
        {this.systems.sleep();}
        else
        {this.manager.stop(this.key);}},add:function(key,sceneConfig,autoStart,data)
        {this.manager.add(key,sceneConfig,autoStart,data);return this;},launch:function(key,data)
        {if(key&&key!==this.key)
        {this.manager.queueOp('start',key,data);}
            return this;},run:function(key,data)
        {if(key&&key!==this.key)
        {this.manager.queueOp('run',key,data);}
            return this;},pause:function(key,data)
        {if(key===undefined){key=this.key;}
            this.manager.queueOp('pause',key,data);return this;},resume:function(key,data)
        {if(key===undefined){key=this.key;}
            this.manager.queueOp('resume',key,data);return this;},sleep:function(key,data)
        {if(key===undefined){key=this.key;}
            this.manager.queueOp('sleep',key,data);return this;},wake:function(key,data)
        {if(key===undefined){key=this.key;}
            this.manager.queueOp('wake',key,data);return this;},switch:function(key)
        {if(key!==this.key)
        {this.manager.queueOp('switch',this.key,key);}
            return this;},stop:function(key)
        {if(key===undefined){key=this.key;}
            this.manager.queueOp('stop',key);return this;},setActive:function(value,key,data)
        {if(key===undefined){key=this.key;}
            var scene=this.manager.getScene(key);if(scene)
        {scene.sys.setActive(value,data);}
            return this;},setVisible:function(value,key)
        {if(key===undefined){key=this.key;}
            var scene=this.manager.getScene(key);if(scene)
        {scene.sys.setVisible(value);}
            return this;},isSleeping:function(key)
        {if(key===undefined){key=this.key;}
            return this.manager.isSleeping(key);},isActive:function(key)
        {if(key===undefined){key=this.key;}
            return this.manager.isActive(key);},isVisible:function(key)
        {if(key===undefined){key=this.key;}
            return this.manager.isVisible(key);},swapPosition:function(keyA,keyB)
        {if(keyB===undefined){keyB=this.key;}
            if(keyA!==keyB)
            {this.manager.swapPosition(keyA,keyB);}
            return this;},moveAbove:function(keyA,keyB)
        {if(keyB===undefined){keyB=this.key;}
            if(keyA!==keyB)
            {this.manager.moveAbove(keyA,keyB);}
            return this;},moveBelow:function(keyA,keyB)
        {if(keyB===undefined){keyB=this.key;}
            if(keyA!==keyB)
            {this.manager.moveBelow(keyA,keyB);}
            return this;},remove:function(key)
        {if(key===undefined){key=this.key;}
            this.manager.remove(key);return this;},moveUp:function(key)
        {if(key===undefined){key=this.key;}
            this.manager.moveUp(key);return this;},moveDown:function(key)
        {if(key===undefined){key=this.key;}
            this.manager.moveDown(key);return this;},bringToTop:function(key)
        {if(key===undefined){key=this.key;}
            this.manager.bringToTop(key);return this;},sendToBack:function(key)
        {if(key===undefined){key=this.key;}
            this.manager.sendToBack(key);return this;},get:function(key)
        {return this.manager.getScene(key);},getIndex:function(key)
        {if(key===undefined){key=this.key;}
            return this.manager.getIndex(key);},shutdown:function()
        {var eventEmitter=this.systems.events;eventEmitter.off('shutdown',this.shutdown,this);eventEmitter.off('postupdate',this.step,this);eventEmitter.off('transitionout');},destroy:function()
        {this.shutdown();this.scene.sys.events.off('start',this.start,this);this.scene=null;this.systems=null;this.settings=null;this.manager=null;}});PluginCache.register('ScenePlugin',ScenePlugin,'scenePlugin');module.exports=ScenePlugin;}),"./scene/Settings.js":(function(module,exports,__webpack_require__){var CONST=__webpack_require__("./scene/const.js");var GetValue=__webpack_require__("./utils/object/GetValue.js");var Merge=__webpack_require__("./utils/object/Merge.js");var InjectionMap=__webpack_require__("./scene/InjectionMap.js");var Settings={create:function(config)
        {if(typeof config==='string')
        {config={key:config};}
        else if(config===undefined)
        {config={};}
            return{status:CONST.PENDING,key:GetValue(config,'key',''),active:GetValue(config,'active',false),visible:GetValue(config,'visible',true),isBooted:false,isTransition:false,transitionFrom:null,transitionDuration:0,transitionAllowInput:true,data:{},pack:GetValue(config,'pack',false),cameras:GetValue(config,'cameras',null),map:GetValue(config,'map',Merge(InjectionMap,GetValue(config,'mapAdd',{}))),physics:GetValue(config,'physics',{}),loader:GetValue(config,'loader',{}),plugins:GetValue(config,'plugins',false),input:GetValue(config,'input',{})};}};module.exports=Settings;}),"./scene/Systems.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var CONST=__webpack_require__("./scene/const.js");var DefaultPlugins=__webpack_require__("./plugins/DefaultPlugins.js");var GetPhysicsPlugins=__webpack_require__("./scene/GetPhysicsPlugins.js");var GetScenePlugins=__webpack_require__("./scene/GetScenePlugins.js");var NOOP=__webpack_require__("./utils/NOOP.js");var Settings=__webpack_require__("./scene/Settings.js");var Systems=new Class({initialize:function Systems(scene,config)
        {this.scene=scene;this.game;if(false)
        {}
            this.config=config;this.settings=Settings.create(config);this.canvas;this.context;this.anims;this.cache;this.plugins;this.registry;this.scale;this.sound;this.textures;this.add;this.cameras;this.displayList;this.events;this.make;this.scenePlugin;this.updateList;this.sceneUpdate=NOOP;},init:function(game)
        {this.settings.status=CONST.INIT;this.sceneUpdate=NOOP;this.game=game;this.canvas=game.canvas;this.context=game.context;var pluginManager=game.plugins;this.plugins=pluginManager;pluginManager.addToScene(this,DefaultPlugins.Global,[DefaultPlugins.CoreScene,GetScenePlugins(this),GetPhysicsPlugins(this)]);this.events.emit('boot',this);this.settings.isBooted=true;},install:function(plugin)
        {if(!Array.isArray(plugin))
        {plugin=[plugin];}
            this.plugins.installLocal(this,plugin);},step:function(time,delta)
        {this.events.emit('preupdate',time,delta);this.events.emit('update',time,delta);this.sceneUpdate.call(this.scene,time,delta);this.events.emit('postupdate',time,delta);},render:function(renderer)
        {var displayList=this.displayList;displayList.depthSort();this.cameras.render(renderer,displayList);this.events.emit('render',renderer);},queueDepthSort:function()
        {this.displayList.queueDepthSort();},depthSort:function()
        {this.displayList.depthSort();},pause:function(data)
        {if(this.settings.active)
        {this.settings.status=CONST.PAUSED;this.settings.active=false;this.events.emit('pause',this,data);}
            return this;},resume:function(data)
        {if(!this.settings.active)
        {this.settings.status=CONST.RUNNING;this.settings.active=true;this.events.emit('resume',this,data);}
            return this;},sleep:function(data)
        {this.settings.status=CONST.SLEEPING;this.settings.active=false;this.settings.visible=false;this.events.emit('sleep',this,data);return this;},wake:function(data)
        {var settings=this.settings;settings.status=CONST.RUNNING;settings.active=true;settings.visible=true;this.events.emit('wake',this,data);if(settings.isTransition)
        {this.events.emit('transitionwake',settings.transitionFrom,settings.transitionDuration);}
            return this;},isSleeping:function()
        {return(this.settings.status===CONST.SLEEPING);},isActive:function()
        {return(this.settings.status===CONST.RUNNING);},isPaused:function()
        {return(this.settings.status===CONST.PAUSED);},isTransitioning:function()
        {return(this.settings.isTransition||this.scenePlugin._target!==null);},isTransitionOut:function()
        {return(this.scenePlugin._target!==null&&this.scenePlugin._duration>0);},isTransitionIn:function()
        {return(this.settings.isTransition);},isVisible:function()
        {return this.settings.visible;},setVisible:function(value)
        {this.settings.visible=value;return this;},setActive:function(value,data)
        {if(value)
        {return this.resume(data);}
        else
        {return this.pause(data);}},start:function(data)
        {if(data)
        {this.settings.data=data;}
            this.settings.status=CONST.START;this.settings.active=true;this.settings.visible=true;this.events.emit('start',this);this.events.emit('ready',this,data);},shutdown:function(data)
        {this.events.off('transitioninit');this.events.off('transitionstart');this.events.off('transitioncomplete');this.events.off('transitionout');this.settings.status=CONST.SHUTDOWN;this.settings.active=false;this.settings.visible=false;this.events.emit('shutdown',this,data);},destroy:function()
        {this.settings.status=CONST.DESTROYED;this.settings.active=false;this.settings.visible=false;this.events.emit('destroy',this);this.events.removeAllListeners();var props=['scene','game','anims','cache','plugins','registry','sound','textures','add','camera','displayList','events','make','scenePlugin','updateList'];for(var i=0;i<props.length;i++)
        {this[props[i]]=null;}}});module.exports=Systems;}),"./scene/const.js":(function(module,exports){var CONST={PENDING:0,INIT:1,START:2,LOADING:3,CREATING:4,RUNNING:5,PAUSED:6,SLEEPING:7,SHUTDOWN:8,DESTROYED:9};module.exports=CONST;}),"./scene/index.js":(function(module,exports,__webpack_require__){var CONST=__webpack_require__("./scene/const.js");var Extend=__webpack_require__("./utils/object/Extend.js");var Scene={SceneManager:__webpack_require__("./scene/SceneManager.js"),ScenePlugin:__webpack_require__("./scene/ScenePlugin.js"),Settings:__webpack_require__("./scene/Settings.js"),Systems:__webpack_require__("./scene/Systems.js")};Scene=Extend(false,Scene,CONST);module.exports=Scene;}),"./sound/BaseSound.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var EventEmitter=__webpack_require__("../node_modules/eventemitter3/index.js");var Extend=__webpack_require__("./utils/object/Extend.js");var NOOP=__webpack_require__("./utils/NOOP.js");var BaseSound=new Class({Extends:EventEmitter,initialize:function BaseSound(manager,key,config)
        {EventEmitter.call(this);this.manager=manager;this.key=key;this.isPlaying=false;this.isPaused=false;this.totalRate=1;this.duration=this.duration||0;this.totalDuration=this.totalDuration||0;this.config={mute:false,volume:1,rate:1,detune:0,seek:0,loop:false,delay:0};this.currentConfig=this.config;this.config=Extend(this.config,config);this.markers={};this.currentMarker=null;this.pendingRemove=false;},addMarker:function(marker)
        {if(!marker||!marker.name||typeof marker.name!=='string')
        {return false;}
            if(this.markers[marker.name])
            {console.error('addMarker '+marker.name+' already exists in Sound');return false;}
            marker=Extend(true,{name:'',start:0,duration:this.totalDuration-(marker.start||0),config:{mute:false,volume:1,rate:1,detune:0,seek:0,loop:false,delay:0}},marker);this.markers[marker.name]=marker;return true;},updateMarker:function(marker)
        {if(!marker||!marker.name||typeof marker.name!=='string')
        {return false;}
            if(!this.markers[marker.name])
            {console.warn('Audio Marker: '+marker.name+' missing in Sound: '+this.key);return false;}
            this.markers[marker.name]=Extend(true,this.markers[marker.name],marker);return true;},removeMarker:function(markerName)
        {var marker=this.markers[markerName];if(!marker)
        {return null;}
            this.markers[markerName]=null;return marker;},play:function(markerName,config)
        {if(markerName===undefined){markerName='';}
            if(typeof markerName==='object')
            {config=markerName;markerName='';}
            if(typeof markerName!=='string')
            {return false;}
            if(!markerName)
            {this.currentMarker=null;this.currentConfig=this.config;this.duration=this.totalDuration;}
            else
            {if(!this.markers[markerName])
            {console.warn('Marker: '+markerName+' missing in Sound: '+this.key);return false;}
                this.currentMarker=this.markers[markerName];this.currentConfig=this.currentMarker.config;this.duration=this.currentMarker.duration;}
            this.resetConfig();this.currentConfig=Extend(this.currentConfig,config);this.isPlaying=true;this.isPaused=false;return true;},pause:function()
        {if(this.isPaused||!this.isPlaying)
        {return false;}
            this.isPlaying=false;this.isPaused=true;return true;},resume:function()
        {if(!this.isPaused||this.isPlaying)
        {return false;}
            this.isPlaying=true;this.isPaused=false;return true;},stop:function()
        {if(!this.isPaused&&!this.isPlaying)
        {return false;}
            this.isPlaying=false;this.isPaused=false;this.resetConfig();return true;},applyConfig:function()
        {this.mute=this.currentConfig.mute;this.volume=this.currentConfig.volume;this.rate=this.currentConfig.rate;this.detune=this.currentConfig.detune;this.loop=this.currentConfig.loop;},resetConfig:function()
        {this.currentConfig.seek=0;this.currentConfig.delay=0;},update:NOOP,calculateRate:function()
        {var cent=1.0005777895065548;var totalDetune=this.currentConfig.detune+this.manager.detune;var detuneRate=Math.pow(cent,totalDetune);this.totalRate=this.currentConfig.rate*this.manager.rate*detuneRate;},destroy:function()
        {if(this.pendingRemove)
        {return;}
            this.emit('destroy',this);this.pendingRemove=true;this.manager=null;this.key='';this.removeAllListeners();this.isPlaying=false;this.isPaused=false;this.config=null;this.currentConfig=null;this.markers=null;this.currentMarker=null;}});module.exports=BaseSound;}),"./sound/BaseSoundManager.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Clone=__webpack_require__("./utils/object/Clone.js");var EventEmitter=__webpack_require__("../node_modules/eventemitter3/index.js");var NOOP=__webpack_require__("./utils/NOOP.js");var BaseSoundManager=new Class({Extends:EventEmitter,initialize:function BaseSoundManager(game)
        {EventEmitter.call(this);this.game=game;this.jsonCache=game.cache.json;this.sounds=[];this.mute=false;this.volume=1;this.pauseOnBlur=true;this._rate=1;this._detune=0;this.locked=this.locked||false;this.unlocked=false;game.events.on('blur',function()
        {if(this.pauseOnBlur)
        {this.onBlur();}},this);game.events.on('focus',function()
        {if(this.pauseOnBlur)
        {this.onFocus();}},this);game.events.on('prestep',this.update,this);game.events.once('destroy',this.destroy,this);},add:NOOP,addAudioSprite:function(key,config)
        {if(config===undefined){config={};}
            var sound=this.add(key,config);sound.spritemap=this.jsonCache.get(key).spritemap;for(var markerName in sound.spritemap)
        {if(!sound.spritemap.hasOwnProperty(markerName))
        {continue;}
            var markerConfig=Clone(config);var marker=sound.spritemap[markerName];markerConfig.loop=(marker.hasOwnProperty('loop'))?marker.loop:false;sound.addMarker({name:markerName,start:marker.start,duration:marker.end-marker.start,config:markerConfig});}
            return sound;},play:function(key,extra)
        {var sound=this.add(key);sound.once('ended',sound.destroy,sound);if(extra)
        {if(extra.name)
        {sound.addMarker(extra);return sound.play(extra.name);}
        else
        {return sound.play(extra);}}
        else
        {return sound.play();}},playAudioSprite:function(key,spriteName,config)
        {var sound=this.addAudioSprite(key);sound.once('ended',sound.destroy,sound);return sound.play(spriteName,config);},remove:function(sound)
        {var index=this.sounds.indexOf(sound);if(index!==-1)
        {sound.destroy();this.sounds.splice(index,1);return true;}
            return false;},removeByKey:function(key)
        {var removed=0;for(var i=this.sounds.length-1;i>=0;i--)
        {var sound=this.sounds[i];if(sound.key===key)
        {sound.destroy();this.sounds.splice(i,1);removed++;}}
            return removed;},pauseAll:function()
        {this.forEachActiveSound(function(sound)
        {sound.pause();});this.emit('pauseall',this);},resumeAll:function()
        {this.forEachActiveSound(function(sound)
        {sound.resume();});this.emit('resumeall',this);},stopAll:function()
        {this.forEachActiveSound(function(sound)
        {sound.stop();});this.emit('stopall',this);},unlock:NOOP,onBlur:NOOP,onFocus:NOOP,update:function(time,delta)
        {if(this.unlocked)
        {this.unlocked=false;this.locked=false;this.emit('unlocked',this);}
            for(var i=this.sounds.length-1;i>=0;i--)
            {if(this.sounds[i].pendingRemove)
            {this.sounds.splice(i,1);}}
            this.sounds.forEach(function(sound)
            {sound.update(time,delta);});},destroy:function()
        {this.removeAllListeners();this.forEachActiveSound(function(sound)
        {sound.destroy();});this.sounds.length=0;this.sounds=null;this.game=null;},forEachActiveSound:function(callback,scope)
        {var _this=this;this.sounds.forEach(function(sound,index)
        {if(!sound.pendingRemove)
        {callback.call(scope||_this,sound,index,_this.sounds);}});},setRate:function(value)
        {this.rate=value;return this;},rate:{get:function()
            {return this._rate;},set:function(value)
            {this._rate=value;this.forEachActiveSound(function(sound)
            {sound.calculateRate();});this.emit('rate',this,value);}},setDetune:function(value)
        {this.detune=value;return this;},detune:{get:function()
            {return this._detune;},set:function(value)
            {this._detune=value;this.forEachActiveSound(function(sound)
            {sound.calculateRate();});this.emit('detune',this,value);}}});module.exports=BaseSoundManager;}),"./sound/SoundManagerCreator.js":(function(module,exports,__webpack_require__){var HTML5AudioSoundManager=__webpack_require__("./sound/html5/HTML5AudioSoundManager.js");var NoAudioSoundManager=__webpack_require__("./sound/noaudio/NoAudioSoundManager.js");var WebAudioSoundManager=__webpack_require__("./sound/webaudio/WebAudioSoundManager.js");var SoundManagerCreator={create:function(game)
        {var audioConfig=game.config.audio;var deviceAudio=game.device.audio;if((audioConfig&&audioConfig.noAudio)||(!deviceAudio.webAudio&&!deviceAudio.audioData))
        {return new NoAudioSoundManager(game);}
            if(deviceAudio.webAudio&&!(audioConfig&&audioConfig.disableWebAudio))
            {return new WebAudioSoundManager(game);}
            return new HTML5AudioSoundManager(game);}};module.exports=SoundManagerCreator;}),"./sound/html5/HTML5AudioSound.js":(function(module,exports,__webpack_require__){var BaseSound=__webpack_require__("./sound/BaseSound.js");var Class=__webpack_require__("./utils/Class.js");var HTML5AudioSound=new Class({Extends:BaseSound,initialize:function HTML5AudioSound(manager,key,config)
        {if(config===undefined){config={};}
            this.tags=manager.game.cache.audio.get(key);if(!this.tags)
        {console.warn('Audio cache entry missing: '+key);return;}
            this.audio=null;this.startTime=0;this.previousTime=0;this.duration=this.tags[0].duration;this.totalDuration=this.tags[0].duration;BaseSound.call(this,manager,key,config);},play:function(markerName,config)
        {if(this.manager.isLocked(this,'play',[markerName,config]))
        {return false;}
            if(!BaseSound.prototype.play.call(this,markerName,config))
            {return false;}
            if(!this.pickAndPlayAudioTag())
            {return false;}
            this.emit('play',this);return true;},pause:function()
        {if(this.manager.isLocked(this,'pause'))
        {return false;}
            if(this.startTime>0)
            {return false;}
            if(!BaseSound.prototype.pause.call(this))
            {return false;}
            this.currentConfig.seek=this.audio.currentTime-(this.currentMarker?this.currentMarker.start:0);this.stopAndReleaseAudioTag();this.emit('pause',this);return true;},resume:function()
        {if(this.manager.isLocked(this,'resume'))
        {return false;}
            if(this.startTime>0)
            {return false;}
            if(!BaseSound.prototype.resume.call(this))
            {return false;}
            if(!this.pickAndPlayAudioTag())
            {return false;}
            this.emit('resume',this);return true;},stop:function()
        {if(this.manager.isLocked(this,'stop'))
        {return false;}
            if(!BaseSound.prototype.stop.call(this))
            {return false;}
            this.stopAndReleaseAudioTag();this.emit('stop',this);return true;},pickAndPlayAudioTag:function()
        {if(!this.pickAudioTag())
        {this.reset();return false;}
            var seek=this.currentConfig.seek;var delay=this.currentConfig.delay;var offset=(this.currentMarker?this.currentMarker.start:0)+seek;this.previousTime=offset;this.audio.currentTime=offset;this.applyConfig();if(delay===0)
        {this.startTime=0;if(this.audio.paused)
        {this.playCatchPromise();}}
        else
        {this.startTime=window.performance.now()+delay*1000;if(!this.audio.paused)
        {this.audio.pause();}}
            this.resetConfig();return true;},pickAudioTag:function()
        {if(this.audio)
        {return true;}
            for(var i=0;i<this.tags.length;i++)
            {var audio=this.tags[i];if(audio.dataset.used==='false')
            {audio.dataset.used='true';this.audio=audio;return true;}}
            if(!this.manager.override)
            {return false;}
            var otherSounds=[];this.manager.forEachActiveSound(function(sound)
        {if(sound.key===this.key&&sound.audio)
        {otherSounds.push(sound);}},this);otherSounds.sort(function(a1,a2)
        {if(a1.loop===a2.loop)
        {return(a2.seek / a2.duration)-(a1.seek / a1.duration);}
            return a1.loop?1:-1;});var selectedSound=otherSounds[0];this.audio=selectedSound.audio;selectedSound.reset();selectedSound.audio=null;selectedSound.startTime=0;selectedSound.previousTime=0;return true;},playCatchPromise:function()
        {var playPromise=this.audio.play();if(playPromise)
        {playPromise.catch(function(reason)
        {console.warn(reason);});}},stopAndReleaseAudioTag:function()
        {this.audio.pause();this.audio.dataset.used='false';this.audio=null;this.startTime=0;this.previousTime=0;},reset:function()
        {BaseSound.prototype.stop.call(this);},onBlur:function()
        {this.isPlaying=false;this.isPaused=true;this.currentConfig.seek=this.audio.currentTime-(this.currentMarker?this.currentMarker.start:0);this.currentConfig.delay=Math.max(0,(this.startTime-window.performance.now())/ 1000);this.stopAndReleaseAudioTag();},onFocus:function()
        {this.isPlaying=true;this.isPaused=false;this.pickAndPlayAudioTag();},update:function(time,delta)
        {if(!this.isPlaying)
        {return;}
            if(this.startTime>0)
            {if(this.startTime<time-this.manager.audioPlayDelay)
            {this.audio.currentTime+=Math.max(0,time-this.startTime)/ 1000;this.startTime=0;this.previousTime=this.audio.currentTime;this.playCatchPromise();}
                return;}
            var startTime=this.currentMarker?this.currentMarker.start:0;var endTime=startTime+this.duration;var currentTime=this.audio.currentTime;if(this.currentConfig.loop)
        {if(currentTime>=endTime-this.manager.loopEndOffset)
        {this.audio.currentTime=startTime+Math.max(0,currentTime-endTime);currentTime=this.audio.currentTime;}
        else if(currentTime<startTime)
        {this.audio.currentTime+=startTime;currentTime=this.audio.currentTime;}
            if(currentTime<this.previousTime)
            {this.emit('looped',this);}}
        else if(currentTime>=endTime)
        {this.reset();this.stopAndReleaseAudioTag();this.emit('ended',this);return;}
            this.previousTime=currentTime;},destroy:function()
        {BaseSound.prototype.destroy.call(this);this.tags=null;if(this.audio)
        {this.stopAndReleaseAudioTag();}},updateMute:function()
        {if(this.audio)
        {this.audio.muted=this.currentConfig.mute||this.manager.mute;}},updateVolume:function()
        {if(this.audio)
        {this.audio.volume=this.currentConfig.volume*this.manager.volume;}},calculateRate:function()
        {BaseSound.prototype.calculateRate.call(this);if(this.audio)
        {this.audio.playbackRate=this.totalRate;}},mute:{get:function()
            {return this.currentConfig.mute;},set:function(value)
            {this.currentConfig.mute=value;if(this.manager.isLocked(this,'mute',value))
            {return;}
                this.updateMute();this.emit('mute',this,value);}},setMute:function(value)
        {this.mute=value;return this;},volume:{get:function()
            {return this.currentConfig.volume;},set:function(value)
            {this.currentConfig.volume=value;if(this.manager.isLocked(this,'volume',value))
            {return;}
                this.updateVolume();this.emit('volume',this,value);}},setVolume:function(value)
        {this.volume=value;return this;},rate:{get:function()
            {return this.currentConfig.rate;},set:function(value)
            {this.currentConfig.rate=value;if(this.manager.isLocked(this,'rate',value))
            {return;}
            else
            {this.calculateRate();this.emit('rate',this,value);}}},setRate:function(value)
        {this.rate=value;return this;},detune:{get:function()
            {return this.currentConfig.detune;},set:function(value)
            {this.currentConfig.detune=value;if(this.manager.isLocked(this,'detune',value))
            {return;}
            else
            {this.calculateRate();this.emit('detune',this,value);}}},setDetune:function(value)
        {this.detune=value;return this;},seek:{get:function()
            {if(this.isPlaying)
            {return this.audio.currentTime-(this.currentMarker?this.currentMarker.start:0);}
            else if(this.isPaused)
            {return this.currentConfig.seek;}
            else
            {return 0;}},set:function(value)
            {if(this.manager.isLocked(this,'seek',value))
            {return;}
                if(this.startTime>0)
                {return;}
                if(this.isPlaying||this.isPaused)
                {value=Math.min(Math.max(0,value),this.duration);if(this.isPlaying)
                {this.previousTime=value;this.audio.currentTime=value;}
                else if(this.isPaused)
                {this.currentConfig.seek=value;}
                    this.emit('seek',this,value);}}},setSeek:function(value)
        {this.seek=value;return this;},loop:{get:function()
            {return this.currentConfig.loop;},set:function(value)
            {this.currentConfig.loop=value;if(this.manager.isLocked(this,'loop',value))
            {return;}
                if(this.audio)
                {this.audio.loop=value;}
                this.emit('loop',this,value);}},setLoop:function(value)
        {this.loop=value;return this;}});module.exports=HTML5AudioSound;}),"./sound/html5/HTML5AudioSoundManager.js":(function(module,exports,__webpack_require__){var BaseSoundManager=__webpack_require__("./sound/BaseSoundManager.js");var Class=__webpack_require__("./utils/Class.js");var HTML5AudioSound=__webpack_require__("./sound/html5/HTML5AudioSound.js");var HTML5AudioSoundManager=new Class({Extends:BaseSoundManager,initialize:function HTML5AudioSoundManager(game)
        {this.override=true;this.audioPlayDelay=0.1;this.loopEndOffset=0.05;this.onBlurPausedSounds=[];this.locked='ontouchstart'in window;this.lockedActionsQueue=this.locked?[]:null;this._mute=false;this._volume=1;BaseSoundManager.call(this,game);},add:function(key,config)
        {var sound=new HTML5AudioSound(this,key,config);this.sounds.push(sound);return sound;},unlock:function()
        {this.locked=false;var _this=this;this.game.cache.audio.entries.each(function(key,tags)
        {for(var i=0;i<tags.length;i++)
        {if(tags[i].dataset.locked==='true')
        {_this.locked=true;return false;}}
            return true;});if(!this.locked)
        {return;}
            var moved=false;var detectMove=function()
        {moved=true;};var unlock=function()
        {if(moved)
        {moved=false;return;}
            document.body.removeEventListener('touchmove',detectMove);document.body.removeEventListener('touchend',unlock);var lockedTags=[];_this.game.cache.audio.entries.each(function(key,tags)
        {for(var i=0;i<tags.length;i++)
        {var tag=tags[i];if(tag.dataset.locked==='true')
        {lockedTags.push(tag);}}
            return true;});if(lockedTags.length===0)
        {return;}
            var lastTag=lockedTags[lockedTags.length-1];lastTag.oncanplaythrough=function()
        {lastTag.oncanplaythrough=null;lockedTags.forEach(function(tag)
        {tag.dataset.locked='false';});_this.unlocked=true;};lockedTags.forEach(function(tag)
        {tag.load();});};this.once('unlocked',function()
        {this.forEachActiveSound(function(sound)
        {if(sound.currentMarker===null&&sound.duration===0)
        {sound.duration=sound.tags[0].duration;}
            sound.totalDuration=sound.tags[0].duration;});while(this.lockedActionsQueue.length)
        {var lockedAction=this.lockedActionsQueue.shift();if(lockedAction.sound[lockedAction.prop].apply)
        {lockedAction.sound[lockedAction.prop].apply(lockedAction.sound,lockedAction.value||[]);}
        else
        {lockedAction.sound[lockedAction.prop]=lockedAction.value;}}},this);document.body.addEventListener('touchmove',detectMove,false);document.body.addEventListener('touchend',unlock,false);},onBlur:function()
        {this.forEachActiveSound(function(sound)
        {if(sound.isPlaying)
        {this.onBlurPausedSounds.push(sound);sound.onBlur();}});},onFocus:function()
        {this.onBlurPausedSounds.forEach(function(sound)
        {sound.onFocus();});this.onBlurPausedSounds.length=0;},destroy:function()
        {BaseSoundManager.prototype.destroy.call(this);this.onBlurPausedSounds.length=0;this.onBlurPausedSounds=null;},isLocked:function(sound,prop,value)
        {if(sound.tags[0].dataset.locked==='true')
        {this.lockedActionsQueue.push({sound:sound,prop:prop,value:value});return true;}
            return false;},setMute:function(value)
        {this.mute=value;return this;},mute:{get:function()
            {return this._mute;},set:function(value)
            {this._mute=value;this.forEachActiveSound(function(sound)
            {sound.updateMute();});this.emit('mute',this,value);}},setVolume:function(value)
        {this.volume=value;return this;},volume:{get:function()
            {return this._volume;},set:function(value)
            {this._volume=value;this.forEachActiveSound(function(sound)
            {sound.updateVolume();});this.emit('volume',this,value);}}});module.exports=HTML5AudioSoundManager;}),"./sound/index.js":(function(module,exports,__webpack_require__){module.exports={SoundManagerCreator:__webpack_require__("./sound/SoundManagerCreator.js"),BaseSound:__webpack_require__("./sound/BaseSound.js"),BaseSoundManager:__webpack_require__("./sound/BaseSoundManager.js"),WebAudioSound:__webpack_require__("./sound/webaudio/WebAudioSound.js"),WebAudioSoundManager:__webpack_require__("./sound/webaudio/WebAudioSoundManager.js"),HTML5AudioSound:__webpack_require__("./sound/html5/HTML5AudioSound.js"),HTML5AudioSoundManager:__webpack_require__("./sound/html5/HTML5AudioSoundManager.js"),NoAudioSound:__webpack_require__("./sound/noaudio/NoAudioSound.js"),NoAudioSoundManager:__webpack_require__("./sound/noaudio/NoAudioSoundManager.js")};}),"./sound/noaudio/NoAudioSound.js":(function(module,exports,__webpack_require__){var BaseSound=__webpack_require__("./sound/BaseSound.js");var Class=__webpack_require__("./utils/Class.js");var EventEmitter=__webpack_require__("../node_modules/eventemitter3/index.js");var Extend=__webpack_require__("./utils/object/Extend.js");var NoAudioSound=new Class({Extends:EventEmitter,initialize:function NoAudioSound(manager,key,config)
        {if(config===void 0){config={};}
            EventEmitter.call(this);this.manager=manager;this.key=key;this.isPlaying=false;this.isPaused=false;this.totalRate=1;this.duration=0;this.totalDuration=0;this.config=Extend({mute:false,volume:1,rate:1,detune:0,seek:0,loop:false,delay:0},config);this.currentConfig=this.config;this.mute=false;this.volume=1;this.rate=1;this.detune=0;this.seek=0;this.loop=false;this.markers={};this.currentMarker=null;this.pendingRemove=false;},addMarker:function(marker)
        {return false;},updateMarker:function(marker)
        {return false;},removeMarker:function(markerName)
        {return null;},play:function(markerName,config)
        {return false;},pause:function()
        {return false;},resume:function()
        {return false;},stop:function()
        {return false;},destroy:function()
        {this.manager.remove(this);BaseSound.prototype.destroy.call(this);}});module.exports=NoAudioSound;}),"./sound/noaudio/NoAudioSoundManager.js":(function(module,exports,__webpack_require__){var BaseSoundManager=__webpack_require__("./sound/BaseSoundManager.js");var Class=__webpack_require__("./utils/Class.js");var EventEmitter=__webpack_require__("../node_modules/eventemitter3/index.js");var NoAudioSound=__webpack_require__("./sound/noaudio/NoAudioSound.js");var NOOP=__webpack_require__("./utils/NOOP.js");var NoAudioSoundManager=new Class({Extends:EventEmitter,initialize:function NoAudioSoundManager(game)
        {EventEmitter.call(this);this.game=game;this.sounds=[];this.mute=false;this.volume=1;this.rate=1;this.detune=0;this.pauseOnBlur=true;this.locked=false;},add:function(key,config)
        {var sound=new NoAudioSound(this,key,config);this.sounds.push(sound);return sound;},addAudioSprite:function(key,config)
        {var sound=this.add(key,config);sound.spritemap={};return sound;},play:function(key,extra)
        {return false;},playAudioSprite:function(key,spriteName,config)
        {return false;},remove:function(sound)
        {return BaseSoundManager.prototype.remove.call(this,sound);},removeByKey:function(key)
        {return BaseSoundManager.prototype.removeByKey.call(this,key);},pauseAll:NOOP,resumeAll:NOOP,stopAll:NOOP,update:NOOP,setRate:NOOP,setDetune:NOOP,setMute:NOOP,setVolume:NOOP,forEachActiveSound:function(callbackfn,scope)
        {BaseSoundManager.prototype.forEachActiveSound.call(this,callbackfn,scope);},destroy:function()
        {BaseSoundManager.prototype.destroy.call(this);}});module.exports=NoAudioSoundManager;}),"./sound/webaudio/WebAudioSound.js":(function(module,exports,__webpack_require__){var BaseSound=__webpack_require__("./sound/BaseSound.js");var Class=__webpack_require__("./utils/Class.js");var WebAudioSound=new Class({Extends:BaseSound,initialize:function WebAudioSound(manager,key,config)
        {if(config===undefined){config={};}
            this.audioBuffer=manager.game.cache.audio.get(key);if(!this.audioBuffer)
        {console.warn('Audio cache entry missing: '+key);return;}
            this.source=null;this.loopSource=null;this.muteNode=manager.context.createGain();this.volumeNode=manager.context.createGain();this.playTime=0;this.startTime=0;this.loopTime=0;this.rateUpdates=[];this.hasEnded=false;this.hasLooped=false;this.muteNode.connect(this.volumeNode);this.volumeNode.connect(manager.destination);this.duration=this.audioBuffer.duration;this.totalDuration=this.audioBuffer.duration;BaseSound.call(this,manager,key,config);},play:function(markerName,config)
        {if(!BaseSound.prototype.play.call(this,markerName,config))
        {return false;}
            this.stopAndRemoveBufferSource();this.createAndStartBufferSource();this.emit('play',this);return true;},pause:function()
        {if(this.manager.context.currentTime<this.startTime)
        {return false;}
            if(!BaseSound.prototype.pause.call(this))
            {return false;}
            this.currentConfig.seek=this.getCurrentTime();this.stopAndRemoveBufferSource();this.emit('pause',this);return true;},resume:function()
        {if(this.manager.context.currentTime<this.startTime)
        {return false;}
            if(!BaseSound.prototype.resume.call(this))
            {return false;}
            this.createAndStartBufferSource();this.emit('resume',this);return true;},stop:function()
        {if(!BaseSound.prototype.stop.call(this))
        {return false;}
            this.stopAndRemoveBufferSource();this.emit('stop',this);return true;},createAndStartBufferSource:function()
        {var seek=this.currentConfig.seek;var delay=this.currentConfig.delay;var when=this.manager.context.currentTime+delay;var offset=(this.currentMarker?this.currentMarker.start:0)+seek;var duration=this.duration-seek;this.playTime=when-seek;this.startTime=when;this.source=this.createBufferSource();this.applyConfig();this.source.start(Math.max(0,when),Math.max(0,offset),Math.max(0,duration));this.resetConfig();},createAndStartLoopBufferSource:function()
        {var when=this.getLoopTime();var offset=this.currentMarker?this.currentMarker.start:0;var duration=this.duration;this.loopTime=when;this.loopSource=this.createBufferSource();this.loopSource.playbackRate.setValueAtTime(this.totalRate,0);this.loopSource.start(Math.max(0,when),Math.max(0,offset),Math.max(0,duration));},createBufferSource:function()
        {var _this=this;var source=this.manager.context.createBufferSource();source.buffer=this.audioBuffer;source.connect(this.muteNode);source.onended=function(ev)
        {if(ev.target===_this.source)
        {if(_this.currentConfig.loop)
        {_this.hasLooped=true;}
        else
        {_this.hasEnded=true;}}};return source;},stopAndRemoveBufferSource:function()
        {if(this.source)
        {this.source.stop();this.source.disconnect();this.source=null;}
            this.playTime=0;this.startTime=0;this.stopAndRemoveLoopBufferSource();},stopAndRemoveLoopBufferSource:function()
        {if(this.loopSource)
        {this.loopSource.stop();this.loopSource.disconnect();this.loopSource=null;}
            this.loopTime=0;},applyConfig:function()
        {this.rateUpdates.length=0;this.rateUpdates.push({time:0,rate:1});BaseSound.prototype.applyConfig.call(this);},update:function(time,delta)
        {if(this.hasEnded)
        {this.hasEnded=false;BaseSound.prototype.stop.call(this);this.stopAndRemoveBufferSource();this.emit('ended',this);}
        else if(this.hasLooped)
        {this.hasLooped=false;this.source=this.loopSource;this.loopSource=null;this.playTime=this.startTime=this.loopTime;this.rateUpdates.length=0;this.rateUpdates.push({time:0,rate:this.totalRate});this.createAndStartLoopBufferSource();this.emit('looped',this);}},destroy:function()
        {BaseSound.prototype.destroy.call(this);this.audioBuffer=null;this.stopAndRemoveBufferSource();this.muteNode.disconnect();this.muteNode=null;this.volumeNode.disconnect();this.volumeNode=null;this.rateUpdates.length=0;this.rateUpdates=null;},calculateRate:function()
        {BaseSound.prototype.calculateRate.call(this);var now=this.manager.context.currentTime;if(this.source&&typeof this.totalRate==='number')
        {this.source.playbackRate.setValueAtTime(this.totalRate,now);}
            if(this.isPlaying)
            {this.rateUpdates.push({time:Math.max(this.startTime,now)-this.playTime,rate:this.totalRate});if(this.loopSource)
            {this.stopAndRemoveLoopBufferSource();this.createAndStartLoopBufferSource();}}},getCurrentTime:function()
        {var currentTime=0;for(var i=0;i<this.rateUpdates.length;i++)
        {var nextTime=0;if(i<this.rateUpdates.length-1)
        {nextTime=this.rateUpdates[i+1].time;}
        else
        {nextTime=this.manager.context.currentTime-this.playTime;}
            currentTime+=(nextTime-this.rateUpdates[i].time)*this.rateUpdates[i].rate;}
            return currentTime;},getLoopTime:function()
        {var lastRateUpdateCurrentTime=0;for(var i=0;i<this.rateUpdates.length-1;i++)
        {lastRateUpdateCurrentTime+=(this.rateUpdates[i+1].time-this.rateUpdates[i].time)*this.rateUpdates[i].rate;}
            var lastRateUpdate=this.rateUpdates[this.rateUpdates.length-1];return this.playTime+lastRateUpdate.time+(this.duration-lastRateUpdateCurrentTime)/ lastRateUpdate.rate;},rate:{get:function()
            {return this.currentConfig.rate;},set:function(value)
            {this.currentConfig.rate=value;this.calculateRate();this.emit('rate',this,value);}},setRate:function(value)
        {this.rate=value;return this;},detune:{get:function()
            {return this.currentConfig.detune;},set:function(value)
            {this.currentConfig.detune=value;this.calculateRate();this.emit('detune',this,value);}},setDetune:function(value)
        {this.detune=value;return this;},mute:{get:function()
            {return(this.muteNode.gain.value===0);},set:function(value)
            {this.currentConfig.mute=value;this.muteNode.gain.setValueAtTime(value?0:1,0);this.emit('mute',this,value);}},setMute:function(value)
        {this.mute=value;return this;},volume:{get:function()
            {return this.volumeNode.gain.value;},set:function(value)
            {this.currentConfig.volume=value;this.volumeNode.gain.setValueAtTime(value,0);this.emit('volume',this,value);}},setVolume:function(value)
        {this.volume=value;return this;},seek:{get:function()
            {if(this.isPlaying)
            {if(this.manager.context.currentTime<this.startTime)
            {return this.startTime-this.playTime;}
                return this.getCurrentTime();}
            else if(this.isPaused)
            {return this.currentConfig.seek;}
            else
            {return 0;}},set:function(value)
            {if(this.manager.context.currentTime<this.startTime)
            {return;}
                if(this.isPlaying||this.isPaused)
                {value=Math.min(Math.max(0,value),this.duration);this.currentConfig.seek=value;if(this.isPlaying)
                {this.stopAndRemoveBufferSource();this.createAndStartBufferSource();}
                    this.emit('seek',this,value);}}},setSeek:function(value)
        {this.seek=value;return this;},loop:{get:function()
            {return this.currentConfig.loop;},set:function(value)
            {this.currentConfig.loop=value;if(this.isPlaying)
            {this.stopAndRemoveLoopBufferSource();if(value)
            {this.createAndStartLoopBufferSource();}}
                this.emit('loop',this,value);}},setLoop:function(value)
        {this.loop=value;return this;}});module.exports=WebAudioSound;}),"./sound/webaudio/WebAudioSoundManager.js":(function(module,exports,__webpack_require__){var BaseSoundManager=__webpack_require__("./sound/BaseSoundManager.js");var Class=__webpack_require__("./utils/Class.js");var WebAudioSound=__webpack_require__("./sound/webaudio/WebAudioSound.js");var WebAudioSoundManager=new Class({Extends:BaseSoundManager,initialize:function WebAudioSoundManager(game)
        {this.context=this.createAudioContext(game);this.masterMuteNode=this.context.createGain();this.masterVolumeNode=this.context.createGain();this.masterMuteNode.connect(this.masterVolumeNode);this.masterVolumeNode.connect(this.context.destination);this.destination=this.masterMuteNode;this.locked=this.context.state==='suspended'&&('ontouchstart'in window||'onclick'in window);BaseSoundManager.call(this,game);if(this.locked)
        {this.unlock();}},createAudioContext:function(game)
        {var audioConfig=game.config.audio;if(audioConfig&&audioConfig.context)
        {audioConfig.context.resume();return audioConfig.context;}
            return new AudioContext();},add:function(key,config)
        {var sound=new WebAudioSound(this,key,config);this.sounds.push(sound);return sound;},unlock:function()
        {var _this=this;var unlockHandler=function unlockHandler()
        {_this.context.resume().then(function()
        {document.body.removeEventListener('touchstart',unlockHandler);document.body.removeEventListener('touchend',unlockHandler);document.body.removeEventListener('click',unlockHandler);_this.unlocked=true;});};if(document.body)
        {document.body.addEventListener('touchstart',unlockHandler,false);document.body.addEventListener('touchend',unlockHandler,false);document.body.addEventListener('click',unlockHandler,false);}},onBlur:function()
        {if(!this.locked)
        {this.context.suspend();}},onFocus:function()
        {if(!this.locked)
        {this.context.resume();}},destroy:function()
        {this.destination=null;this.masterVolumeNode.disconnect();this.masterVolumeNode=null;this.masterMuteNode.disconnect();this.masterMuteNode=null;if(this.game.config.audio&&this.game.config.audio.context)
        {this.context.suspend();}
        else
        {var _this=this;this.context.close().then(function()
        {_this.context=null;});}
            BaseSoundManager.prototype.destroy.call(this);},setMute:function(value)
        {this.mute=value;return this;},mute:{get:function()
            {return(this.masterMuteNode.gain.value===0);},set:function(value)
            {this.masterMuteNode.gain.setValueAtTime(value?0:1,0);this.emit('mute',this,value);}},setVolume:function(value)
        {this.volume=value;return this;},volume:{get:function()
            {return this.masterVolumeNode.gain.value;},set:function(value)
            {this.masterVolumeNode.gain.setValueAtTime(value,0);this.emit('volume',this,value);}}});module.exports=WebAudioSoundManager;}),"./structs/List.js":(function(module,exports,__webpack_require__){var ArrayUtils=__webpack_require__("./utils/array/index.js");var Class=__webpack_require__("./utils/Class.js");var NOOP=__webpack_require__("./utils/NOOP.js");var StableSort=__webpack_require__("./utils/array/StableSort.js");var List=new Class({initialize:function List(parent)
        {this.parent=parent;this.list=[];this.position=0;this.addCallback=NOOP;this.removeCallback=NOOP;this._sortKey='';},add:function(child,skipCallback)
        {if(skipCallback)
        {return ArrayUtils.Add(this.list,child);}
        else
        {return ArrayUtils.Add(this.list,child,0,this.addCallback,this);}},addAt:function(child,index,skipCallback)
        {if(skipCallback)
        {return ArrayUtils.AddAt(this.list,child,index);}
        else
        {return ArrayUtils.AddAt(this.list,child,index,0,this.addCallback,this);}},getAt:function(index)
        {return this.list[index];},getIndex:function(child)
        {return this.list.indexOf(child);},sort:function(property)
        {if(property)
        {this._sortKey=property;StableSort.inplace(this.list,this.sortHandler);}
            return this;},sortHandler:function(childA,childB)
        {return childA[this._sortKey]-childB[this._sortKey];},getByName:function(name)
        {return ArrayUtils.GetFirst(this.list,'name',name);},getRandom:function(startIndex,length)
        {return ArrayUtils.GetRandom(this.list,startIndex,length);},getFirst:function(property,value,startIndex,endIndex)
        {return ArrayUtils.GetFirst(this.list,property,value,startIndex,endIndex);},getAll:function(property,value,startIndex,endIndex)
        {return ArrayUtils.GetAll(this.list,property,value,startIndex,endIndex);},count:function(property,value)
        {return ArrayUtils.CountAllMatching(this.list,property,value);},swap:function(child1,child2)
        {ArrayUtils.Swap(this.list,child1,child2);},moveTo:function(child,index)
        {return ArrayUtils.MoveTo(this.list,child,index);},remove:function(child,skipCallback)
        {if(skipCallback)
        {return ArrayUtils.Remove(this.list,child);}
        else
        {return ArrayUtils.Remove(this.list,child,this.removeCallback,this);}},removeAt:function(index,skipCallback)
        {if(skipCallback)
        {return ArrayUtils.RemoveAt(this.list,index);}
        else
        {return ArrayUtils.RemoveAt(this.list,index,this.removeCallback,this);}},removeBetween:function(startIndex,endIndex,skipCallback)
        {if(skipCallback)
        {return ArrayUtils.RemoveBetween(this.list,startIndex,endIndex);}
        else
        {return ArrayUtils.RemoveBetween(this.list,startIndex,endIndex,this.removeCallback,this);}},removeAll:function(skipCallback)
        {var i=this.list.length;while(i--)
        {this.remove(this.list[i],skipCallback);}
            return this;},bringToTop:function(child)
        {return ArrayUtils.BringToTop(this.list,child);},sendToBack:function(child)
        {return ArrayUtils.SendToBack(this.list,child);},moveUp:function(child)
        {ArrayUtils.MoveUp(this.list,child);return child;},moveDown:function(child)
        {ArrayUtils.MoveDown(this.list,child);return child;},reverse:function()
        {this.list.reverse();return this;},shuffle:function()
        {ArrayUtils.Shuffle(this.list);return this;},replace:function(oldChild,newChild)
        {return ArrayUtils.Replace(this.list,oldChild,newChild);},exists:function(child)
        {return(this.list.indexOf(child)>-1);},setAll:function(property,value,startIndex,endIndex)
        {ArrayUtils.SetAll(this.list,property,value,startIndex,endIndex);return this;},each:function(callback,context)
        {var args=[null];for(var i=2;i<arguments.length;i++)
        {args.push(arguments[i]);}
            for(i=0;i<this.list.length;i++)
            {args[0]=this.list[i];callback.apply(context,args);}},shutdown:function()
        {this.removeAll();this.list=[];},destroy:function()
        {this.removeAll();this.parent=null;this.addCallback=null;this.removeCallback=null;},length:{get:function()
            {return this.list.length;}},first:{get:function()
            {this.position=0;if(this.list.length>0)
            {return this.list[0];}
            else
            {return null;}}},last:{get:function()
            {if(this.list.length>0)
            {this.position=this.list.length-1;return this.list[this.position];}
            else
            {return null;}}},next:{get:function()
            {if(this.position<this.list.length)
            {this.position++;return this.list[this.position];}
            else
            {return null;}}},previous:{get:function()
            {if(this.position>0)
            {this.position--;return this.list[this.position];}
            else
            {return null;}}}});module.exports=List;}),"./structs/Map.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Map=new Class({initialize:function Map(elements)
        {this.entries={};this.size=0;if(Array.isArray(elements))
        {for(var i=0;i<elements.length;i++)
        {this.set(elements[i][0],elements[i][1]);}}},set:function(key,value)
        {if(!this.has(key))
        {this.size++;}
            this.entries[key]=value;return this;},get:function(key)
        {if(this.has(key))
        {return this.entries[key];}},getArray:function()
        {var output=[];var entries=this.entries;for(var key in entries)
        {output.push(entries[key]);}
            return output;},has:function(key)
        {return(this.entries.hasOwnProperty(key));},delete:function(key)
        {if(this.has(key))
        {delete this.entries[key];this.size--;}
            return this;},clear:function()
        {Object.keys(this.entries).forEach(function(prop)
        {delete this.entries[prop];},this);this.size=0;return this;},keys:function()
        {return Object.keys(this.entries);},values:function()
        {var output=[];var entries=this.entries;for(var key in entries)
        {output.push(entries[key]);}
            return output;},dump:function()
        {var entries=this.entries;console.group('Map');for(var key in entries)
        {console.log(key,entries[key]);}
            console.groupEnd();},each:function(callback)
        {var entries=this.entries;for(var key in entries)
        {if(callback(key,entries[key])===false)
        {break;}}
            return this;},contains:function(value)
        {var entries=this.entries;for(var key in entries)
        {if(entries[key]===value)
        {return true;}}
            return false;},merge:function(map,override)
        {if(override===undefined){override=false;}
            var local=this.entries;var source=map.entries;for(var key in source)
        {if(local.hasOwnProperty(key)&&override)
        {local[key]=source[key];}
        else
        {this.set(key,source[key]);}}
            return this;}});module.exports=Map;}),"./structs/ProcessQueue.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var ProcessQueue=new Class({initialize:function ProcessQueue()
        {this._pending=[];this._active=[];this._destroy=[];this._toProcess=0;},add:function(item)
        {this._pending.push(item);this._toProcess++;return this;},remove:function(item)
        {this._destroy.push(item);this._toProcess++;return this;},update:function()
        {if(this._toProcess===0)
        {return this._active;}
            var list=this._destroy;var active=this._active;var i;var item;for(i=0;i<list.length;i++)
        {item=list[i];var idx=active.indexOf(item);if(idx!==-1)
        {active.splice(idx,1);}}
            list.length=0;list=this._pending;for(i=0;i<list.length;i++)
        {item=list[i];this._active.push(item);}
            list.length=0;this._toProcess=0;return this._active;},getActive:function()
        {return this._active;},destroy:function()
        {this._toProcess=0;this._pending=[];this._active=[];this._destroy=[];}});module.exports=ProcessQueue;}),"./structs/RTree.js":(function(module,exports,__webpack_require__){var quickselect=__webpack_require__("./utils/array/QuickSelect.js");function rbush(maxEntries)
    {var format=['.left','.top','.right','.bottom'];if(!(this instanceof rbush))return new rbush(maxEntries,format);this._maxEntries=Math.max(4,maxEntries||9);this._minEntries=Math.max(2,Math.ceil(this._maxEntries*0.4));this.clear();}
        rbush.prototype={all:function()
            {return this._all(this.data,[]);},search:function(bbox)
            {var node=this.data,result=[],toBBox=this.toBBox;if(!intersects(bbox,node))return result;var nodesToSearch=[],i,len,child,childBBox;while(node){for(i=0,len=node.children.length;i<len;i++){child=node.children[i];childBBox=node.leaf?toBBox(child):child;if(intersects(bbox,childBBox)){if(node.leaf)result.push(child);else if(contains(bbox,childBBox))this._all(child,result);else nodesToSearch.push(child);}}
                node=nodesToSearch.pop();}
                return result;},collides:function(bbox)
            {var node=this.data,toBBox=this.toBBox;if(!intersects(bbox,node))return false;var nodesToSearch=[],i,len,child,childBBox;while(node){for(i=0,len=node.children.length;i<len;i++){child=node.children[i];childBBox=node.leaf?toBBox(child):child;if(intersects(bbox,childBBox)){if(node.leaf||contains(bbox,childBBox))return true;nodesToSearch.push(child);}}
                node=nodesToSearch.pop();}
                return false;},load:function(data)
            {if(!(data&&data.length))return this;if(data.length<this._minEntries){for(var i=0,len=data.length;i<len;i++){this.insert(data[i]);}
                return this;}
                var node=this._build(data.slice(),0,data.length-1,0);if(!this.data.children.length){this.data=node;}else if(this.data.height===node.height){this._splitRoot(this.data,node);}else{if(this.data.height<node.height){var tmpNode=this.data;this.data=node;node=tmpNode;}
                this._insert(node,this.data.height-node.height-1,true);}
                return this;},insert:function(item)
            {if(item)this._insert(item,this.data.height-1);return this;},clear:function()
            {this.data=createNode([]);return this;},remove:function(item,equalsFn)
            {if(!item)return this;var node=this.data,bbox=this.toBBox(item),path=[],indexes=[],i,parent,index,goingUp;while(node||path.length){if(!node){node=path.pop();parent=path[path.length-1];i=indexes.pop();goingUp=true;}
                if(node.leaf){index=findItem(item,node.children,equalsFn);if(index!==-1){node.children.splice(index,1);path.push(node);this._condense(path);return this;}}
                if(!goingUp&&!node.leaf&&contains(node,bbox)){path.push(node);indexes.push(i);i=0;parent=node;node=node.children[0];}else if(parent){i++;node=parent.children[i];goingUp=false;}else node=null;}
                return this;},toBBox:function(item){return item;},compareMinX:compareNodeMinX,compareMinY:compareNodeMinY,toJSON:function(){return this.data;},fromJSON:function(data)
            {this.data=data;return this;},_all:function(node,result)
            {var nodesToSearch=[];while(node){if(node.leaf)result.push.apply(result,node.children);else nodesToSearch.push.apply(nodesToSearch,node.children);node=nodesToSearch.pop();}
                return result;},_build:function(items,left,right,height)
            {var N=right-left+1,M=this._maxEntries,node;if(N<=M){node=createNode(items.slice(left,right+1));calcBBox(node,this.toBBox);return node;}
                if(!height){height=Math.ceil(Math.log(N)/ Math.log(M));M=Math.ceil(N / Math.pow(M,height-1));}
                node=createNode([]);node.leaf=false;node.height=height;var N2=Math.ceil(N / M),N1=N2*Math.ceil(Math.sqrt(M)),i,j,right2,right3;multiSelect(items,left,right,N1,this.compareMinX);for(i=left;i<=right;i+=N1){right2=Math.min(i+N1-1,right);multiSelect(items,i,right2,N2,this.compareMinY);for(j=i;j<=right2;j+=N2){right3=Math.min(j+N2-1,right2);node.children.push(this._build(items,j,right3,height-1));}}
                calcBBox(node,this.toBBox);return node;},_chooseSubtree:function(bbox,node,level,path)
            {var i,len,child,targetNode,area,enlargement,minArea,minEnlargement;while(true){path.push(node);if(node.leaf||path.length-1===level)break;minArea=minEnlargement=Infinity;for(i=0,len=node.children.length;i<len;i++){child=node.children[i];area=bboxArea(child);enlargement=enlargedArea(bbox,child)-area;if(enlargement<minEnlargement){minEnlargement=enlargement;minArea=area<minArea?area:minArea;targetNode=child;}else if(enlargement===minEnlargement){if(area<minArea){minArea=area;targetNode=child;}}}
                node=targetNode||node.children[0];}
                return node;},_insert:function(item,level,isNode)
            {var toBBox=this.toBBox,bbox=isNode?item:toBBox(item),insertPath=[];var node=this._chooseSubtree(bbox,this.data,level,insertPath);node.children.push(item);extend(node,bbox);while(level>=0){if(insertPath[level].children.length>this._maxEntries){this._split(insertPath,level);level--;}else break;}
                this._adjustParentBBoxes(bbox,insertPath,level);},_split:function(insertPath,level)
            {var node=insertPath[level],M=node.children.length,m=this._minEntries;this._chooseSplitAxis(node,m,M);var splitIndex=this._chooseSplitIndex(node,m,M);var newNode=createNode(node.children.splice(splitIndex,node.children.length-splitIndex));newNode.height=node.height;newNode.leaf=node.leaf;calcBBox(node,this.toBBox);calcBBox(newNode,this.toBBox);if(level)insertPath[level-1].children.push(newNode);else this._splitRoot(node,newNode);},_splitRoot:function(node,newNode)
            {this.data=createNode([node,newNode]);this.data.height=node.height+1;this.data.leaf=false;calcBBox(this.data,this.toBBox);},_chooseSplitIndex:function(node,m,M)
            {var i,bbox1,bbox2,overlap,area,minOverlap,minArea,index;minOverlap=minArea=Infinity;for(i=m;i<=M-m;i++){bbox1=distBBox(node,0,i,this.toBBox);bbox2=distBBox(node,i,M,this.toBBox);overlap=intersectionArea(bbox1,bbox2);area=bboxArea(bbox1)+bboxArea(bbox2);if(overlap<minOverlap){minOverlap=overlap;index=i;minArea=area<minArea?area:minArea;}else if(overlap===minOverlap){if(area<minArea){minArea=area;index=i;}}}
                return index;},_chooseSplitAxis:function(node,m,M)
            {var compareMinX=node.leaf?this.compareMinX:compareNodeMinX,compareMinY=node.leaf?this.compareMinY:compareNodeMinY,xMargin=this._allDistMargin(node,m,M,compareMinX),yMargin=this._allDistMargin(node,m,M,compareMinY);if(xMargin<yMargin)node.children.sort(compareMinX);},_allDistMargin:function(node,m,M,compare)
            {node.children.sort(compare);var toBBox=this.toBBox,leftBBox=distBBox(node,0,m,toBBox),rightBBox=distBBox(node,M-m,M,toBBox),margin=bboxMargin(leftBBox)+bboxMargin(rightBBox),i,child;for(i=m;i<M-m;i++){child=node.children[i];extend(leftBBox,node.leaf?toBBox(child):child);margin+=bboxMargin(leftBBox);}
                for(i=M-m-1;i>=m;i--){child=node.children[i];extend(rightBBox,node.leaf?toBBox(child):child);margin+=bboxMargin(rightBBox);}
                return margin;},_adjustParentBBoxes:function(bbox,path,level)
            {for(var i=level;i>=0;i--){extend(path[i],bbox);}},_condense:function(path)
            {for(var i=path.length-1,siblings;i>=0;i--){if(path[i].children.length===0){if(i>0){siblings=path[i-1].children;siblings.splice(siblings.indexOf(path[i]),1);}else this.clear();}else calcBBox(path[i],this.toBBox);}},compareMinX:function(a,b)
            {return a.left-b.left;},compareMinY:function(a,b)
            {return a.top-b.top;},toBBox:function(a)
            {return{minX:a.left,minY:a.top,maxX:a.right,maxY:a.bottom};}};function findItem(item,items,equalsFn)
        {if(!equalsFn)return items.indexOf(item);for(var i=0;i<items.length;i++){if(equalsFn(item,items[i]))return i;}
            return-1;}
        function calcBBox(node,toBBox)
        {distBBox(node,0,node.children.length,toBBox,node);}
        function distBBox(node,k,p,toBBox,destNode)
        {if(!destNode)destNode=createNode(null);destNode.minX=Infinity;destNode.minY=Infinity;destNode.maxX=-Infinity;destNode.maxY=-Infinity;for(var i=k,child;i<p;i++){child=node.children[i];extend(destNode,node.leaf?toBBox(child):child);}
            return destNode;}
        function extend(a,b)
        {a.minX=Math.min(a.minX,b.minX);a.minY=Math.min(a.minY,b.minY);a.maxX=Math.max(a.maxX,b.maxX);a.maxY=Math.max(a.maxY,b.maxY);return a;}
        function compareNodeMinX(a,b){return a.minX-b.minX;}
        function compareNodeMinY(a,b){return a.minY-b.minY;}
        function bboxArea(a){return(a.maxX-a.minX)*(a.maxY-a.minY);}
        function bboxMargin(a){return(a.maxX-a.minX)+(a.maxY-a.minY);}
        function enlargedArea(a,b)
        {return(Math.max(b.maxX,a.maxX)-Math.min(b.minX,a.minX))*(Math.max(b.maxY,a.maxY)-Math.min(b.minY,a.minY));}
        function intersectionArea(a,b)
        {var minX=Math.max(a.minX,b.minX),minY=Math.max(a.minY,b.minY),maxX=Math.min(a.maxX,b.maxX),maxY=Math.min(a.maxY,b.maxY);return Math.max(0,maxX-minX)*Math.max(0,maxY-minY);}
        function contains(a,b)
        {return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY;}
        function intersects(a,b)
        {return b.minX<=a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY;}
        function createNode(children)
        {return{children:children,height:1,leaf:true,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity};}
        function multiSelect(arr,left,right,n,compare)
        {var stack=[left,right],mid;while(stack.length)
        {right=stack.pop();left=stack.pop();if(right-left<=n)continue;mid=left+Math.ceil((right-left)/ n / 2)*n;quickselect(arr,mid,left,right,compare);stack.push(left,mid,mid,right);}}
        module.exports=rbush;}),"./structs/Set.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Set=new Class({initialize:function Set(elements)
        {this.entries=[];if(Array.isArray(elements))
        {for(var i=0;i<elements.length;i++)
        {this.set(elements[i]);}}},set:function(value)
        {if(this.entries.indexOf(value)===-1)
        {this.entries.push(value);}
            return this;},get:function(property,value)
        {for(var i=0;i<this.entries.length;i++)
        {var entry=this.entries[i];if(entry[property]===value)
        {return entry;}}},getArray:function()
        {return this.entries.slice(0);},delete:function(value)
        {var index=this.entries.indexOf(value);if(index>-1)
        {this.entries.splice(index,1);}
            return this;},dump:function()
        {console.group('Set');for(var i=0;i<this.entries.length;i++)
        {var entry=this.entries[i];console.log(entry);}
            console.groupEnd();},each:function(callback,callbackScope)
        {var i;var temp=this.entries.slice();var len=temp.length;if(callbackScope)
        {for(i=0;i<len;i++)
        {if(callback.call(callbackScope,temp[i],i)===false)
        {break;}}}
        else
        {for(i=0;i<len;i++)
        {if(callback(temp[i],i)===false)
        {break;}}}
            return this;},iterate:function(callback,callbackScope)
        {var i;var len=this.entries.length;if(callbackScope)
        {for(i=0;i<len;i++)
        {if(callback.call(callbackScope,this.entries[i],i)===false)
        {break;}}}
        else
        {for(i=0;i<len;i++)
        {if(callback(this.entries[i],i)===false)
        {break;}}}
            return this;},iterateLocal:function(callbackKey)
        {var i;var args=[];for(i=1;i<arguments.length;i++)
        {args.push(arguments[i]);}
            var len=this.entries.length;for(i=0;i<len;i++)
        {var entry=this.entries[i];entry[callbackKey].apply(entry,args);}
            return this;},clear:function()
        {this.entries.length=0;return this;},contains:function(value)
        {return(this.entries.indexOf(value)>-1);},union:function(set)
        {var newSet=new Set();set.entries.forEach(function(value)
        {newSet.set(value);});this.entries.forEach(function(value)
        {newSet.set(value);});return newSet;},intersect:function(set)
        {var newSet=new Set();this.entries.forEach(function(value)
        {if(set.contains(value))
        {newSet.set(value);}});return newSet;},difference:function(set)
        {var newSet=new Set();this.entries.forEach(function(value)
        {if(!set.contains(value))
        {newSet.set(value);}});return newSet;},size:{get:function()
            {return this.entries.length;},set:function(value)
            {if(value<this.entries.length)
            {return this.entries.length=value;}
            else
            {return this.entries.length;}}}});module.exports=Set;}),"./structs/Size.js":(function(module,exports,__webpack_require__){var Clamp=__webpack_require__("./math/Clamp.js");var Class=__webpack_require__("./utils/Class.js");var SnapFloor=__webpack_require__("./math/snap/SnapFloor.js");var Vector2=__webpack_require__("./math/Vector2.js");var Size=new Class({initialize:function Size(width,height,aspectMode,parent)
        {if(width===undefined){width=0;}
            if(height===undefined){height=width;}
            if(aspectMode===undefined){aspectMode=0;}
            if(parent===undefined){parent=null;}
            this._width=width;this._height=height;this._parent=parent;this.aspectMode=aspectMode;this.aspectRatio=(height===0)?1:width / height;this.minWidth=0;this.minHeight=0;this.maxWidth=Number.MAX_VALUE;this.maxHeight=Number.MAX_VALUE;this.snapTo=new Vector2();},setAspectMode:function(value)
        {if(value===undefined){value=0;}
            this.aspectMode=value;return this.setSize(this._width,this._height);},setSnap:function(snapWidth,snapHeight)
        {if(snapWidth===undefined){snapWidth=0;}
            if(snapHeight===undefined){snapHeight=snapWidth;}
            this.snapTo.set(snapWidth,snapHeight);return this.setSize(this._width,this._height);},setParent:function(parent)
        {this._parent=parent;return this.setSize(this._width,this._height);},setMin:function(width,height)
        {if(width===undefined){width=0;}
            if(height===undefined){height=width;}
            this.minWidth=Clamp(width,0,this.maxWidth);this.minHeight=Clamp(height,0,this.maxHeight);return this.setSize(this._width,this._height);},setMax:function(width,height)
        {if(width===undefined){width=Number.MAX_VALUE;}
            if(height===undefined){height=width;}
            this.maxWidth=Clamp(width,this.minWidth,Number.MAX_VALUE);this.maxHeight=Clamp(height,this.minHeight,Number.MAX_VALUE);return this.setSize(this._width,this._height);},setSize:function(width,height)
        {if(width===undefined){width=0;}
            if(height===undefined){height=width;}
            switch(this.aspectMode)
            {case Size.NONE:this._width=this.getNewWidth(SnapFloor(width,this.snapTo.x));this._height=this.getNewHeight(SnapFloor(height,this.snapTo.y));this.aspectRatio=(this._height===0)?1:this._width / this._height;break;case Size.WIDTH_CONTROLS_HEIGHT:this._width=this.getNewWidth(SnapFloor(width,this.snapTo.x));this._height=this.getNewHeight(this._width*(1 / this.aspectRatio),false);break;case Size.HEIGHT_CONTROLS_WIDTH:this._height=this.getNewHeight(SnapFloor(height,this.snapTo.y));this._width=this.getNewWidth(this._height*this.aspectRatio,false);break;case Size.FIT:this.constrain(width,height,true);break;case Size.ENVELOP:this.constrain(width,height,false);break;}
            return this;},getNewWidth:function(value,checkParent)
        {if(checkParent===undefined){checkParent=true;}
            value=Clamp(value,this.minWidth,this.maxWidth);if(checkParent&&this._parent&&value>this._parent.width)
        {value=Math.max(this.minWidth,this._parent.width);}
            return value;},getNewHeight:function(value,checkParent)
        {if(checkParent===undefined){checkParent=true;}
            value=Clamp(value,this.minHeight,this.maxHeight);if(checkParent&&this._parent&&value>this._parent.height)
        {value=Math.max(this.minHeight,this._parent.height);}
            return value;},constrain:function(width,height,fit)
        {if(width===undefined){width=0;}
            if(height===undefined){height=width;}
            if(fit===undefined){fit=true;}
            width=this.getNewWidth(width);height=this.getNewHeight(height);var snap=this.snapTo;var newRatio=(height===0)?1:width / height;if((fit&&this.aspectRatio>newRatio)||(!fit&&this.aspectRatio<newRatio))
        {width=SnapFloor(width,snap.x);height=width / this.aspectRatio;if(snap.y>0)
        {height=SnapFloor(height,snap.y);width=height*this.aspectRatio;}}
        else if((fit&&this.aspectRatio<newRatio)||(!fit&&this.aspectRatio>newRatio))
        {height=SnapFloor(height,snap.y);width=height*this.aspectRatio;if(snap.x>0)
        {width=SnapFloor(width,snap.x);height=width*(1 / this.aspectRatio);}}
            this._width=width;this._height=height;return this;},fitTo:function(width,height)
        {return this.constrain(width,height,true);},envelop:function(width,height)
        {return this.constrain(width,height,false);},setWidth:function(value)
        {return this.setSize(value,this._height);},setHeight:function(value)
        {return this.setSize(this._width,value);},toString:function()
        {return'[{ Size (width='+this._width+' height='+this._height+' aspectRatio='+this.aspectRatio+' aspectMode='+this.aspectMode+') }]';},destroy:function()
        {this._parent=null;this.snapTo=null;},width:{get:function()
            {return this._width;},set:function(value)
            {this.setSize(value,this._height);}},height:{get:function()
            {return this._height;},set:function(value)
            {this.setSize(this._width,value);}}});Size.NONE=0;Size.WIDTH_CONTROLS_HEIGHT=1;Size.HEIGHT_CONTROLS_WIDTH=2;Size.FIT=3;Size.ENVELOP=4;module.exports=Size;}),"./structs/index.js":(function(module,exports,__webpack_require__){module.exports={List:__webpack_require__("./structs/List.js"),Map:__webpack_require__("./structs/Map.js"),ProcessQueue:__webpack_require__("./structs/ProcessQueue.js"),RTree:__webpack_require__("./structs/RTree.js"),Set:__webpack_require__("./structs/Set.js"),Size:__webpack_require__("./structs/Size.js")};}),"./textures/CanvasTexture.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Clamp=__webpack_require__("./math/Clamp.js");var Color=__webpack_require__("./display/color/Color.js");var IsSizePowerOfTwo=__webpack_require__("./math/pow2/IsSizePowerOfTwo.js");var Texture=__webpack_require__("./textures/Texture.js");var CanvasTexture=new Class({Extends:Texture,initialize:function CanvasTexture(manager,key,source,width,height)
        {Texture.call(this,manager,key,source,width,height);this.add('__BASE',0,0,0,width,height);this._source=this.frames['__BASE'].source;this.canvas=this._source.image;this.context=this.canvas.getContext('2d');this.width=width;this.height=height;this.imageData=this.context.getImageData(0,0,width,height);this.data=null;if(this.imageData)
        {this.data=this.imageData.data;}
            this.pixels=null;this.buffer;if(this.data)
        {if(this.imageData.data.buffer)
        {this.buffer=this.imageData.data.buffer;this.pixels=new Uint32Array(this.buffer);}
        else if(window.ArrayBuffer)
        {this.buffer=new ArrayBuffer(this.imageData.data.length);this.pixels=new Uint32Array(this.buffer);}
        else
        {this.pixels=this.imageData.data;}}},update:function()
        {this.imageData=this.context.getImageData(0,0,this.width,this.height);this.data=this.imageData.data;if(this.imageData.data.buffer)
        {this.buffer=this.imageData.data.buffer;this.pixels=new Uint32Array(this.buffer);}
        else if(window.ArrayBuffer)
        {this.buffer=new ArrayBuffer(this.imageData.data.length);this.pixels=new Uint32Array(this.buffer);}
        else
        {this.pixels=this.imageData.data;}
            return this;},draw:function(x,y,source)
        {this.context.drawImage(source,x,y);return this.update();},drawFrame:function(key,frame,x,y)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            var textureFrame=this.manager.getFrame(key,frame);if(textureFrame)
        {var cd=textureFrame.canvasData;var width=textureFrame.cutWidth;var height=textureFrame.cutHeight;var res=textureFrame.source.resolution;this.context.drawImage(textureFrame.source.image,cd.x,cd.y,width,height,x,y,width / res,height / res);return this.update();}
        else
        {return this;}},setPixel:function(x,y,red,green,blue,alpha)
        {if(alpha===undefined){alpha=255;}
            x=Math.abs(Math.floor(x));y=Math.abs(Math.floor(y));var index=this.getIndex(x,y);if(index>-1)
        {var imageData=this.context.getImageData(x,y,1,1);imageData.data[0]=red;imageData.data[1]=green;imageData.data[2]=blue;imageData.data[3]=alpha;this.context.putImageData(imageData,x,y);}
            return this;},putData:function(imageData,x,y)
        {x=Math.abs(Math.floor(x));y=Math.abs(Math.floor(y));this.context.putImageData(imageData,x,y);return this;},getData:function(x,y,width,height)
        {x=Clamp(Math.floor(x),0,this.width-1);y=Clamp(Math.floor(y),0,this.height-1);width=Clamp(width,1,this.width-x);height=Clamp(height,1,this.height-y);var imageData=this.context.getImageData(x,y,width,height);return imageData;},getPixel:function(x,y,out)
        {if(!out)
        {out=new Color();}
            var index=this.getIndex(x,y);if(index>-1)
        {var data=this.data;var r=data[index+0];var g=data[index+1];var b=data[index+2];var a=data[index+3];out.setTo(r,g,b,a);}
            return out;},getPixels:function(x,y,width,height)
        {if(height===undefined){height=width;}
            x=Math.abs(Math.round(x));y=Math.abs(Math.round(y));var left=Clamp(x,0,this.width);var right=Clamp(x+width,0,this.width);var top=Clamp(y,0,this.height);var bottom=Clamp(y+height,0,this.height);var pixel=new Color();var out=[];for(var py=top;py<bottom;py++)
        {var row=[];for(var px=left;px<right;px++)
        {pixel=this.getPixel(px,py,pixel);row.push({x:px,y:py,color:pixel.color,alpha:pixel.alphaGL});}
            out.push(row);}
            return out;},getIndex:function(x,y)
        {x=Math.abs(Math.round(x));y=Math.abs(Math.round(y));if(x<this.width&&y<this.height)
        {return(x+y*this.width)*4;}
        else
        {return-1;}},refresh:function()
        {this._source.update();return this;},getCanvas:function()
        {return this.canvas;},getContext:function()
        {return this.context;},clear:function(x,y,width,height)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            if(width===undefined){width=this.width;}
            if(height===undefined){height=this.height;}
            this.context.clearRect(x,y,width,height);return this.update();},setSize:function(width,height)
        {if(height===undefined){height=width;}
            if(width!==this.width||height!==this.height)
            {this.canvas.width=width;this.canvas.height=height;this._source.width=width;this._source.height=height;this._source.isPowerOf2=IsSizePowerOfTwo(width,height);this.frames['__BASE'].setSize(width,height,0,0);this.refresh();}
            return this;},destroy:function()
        {Texture.prototype.destroy.call(this);this._source=null;this.canvas=null;this.context=null;this.imageData=null;this.data=null;this.pixels=null;this.buffer=null;}});module.exports=CanvasTexture;}),"./textures/Frame.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Clamp=__webpack_require__("./math/Clamp.js");var Extend=__webpack_require__("./utils/object/Extend.js");var Frame=new Class({initialize:function Frame(texture,name,sourceIndex,x,y,width,height)
        {this.texture=texture;this.name=name;this.source=texture.source[sourceIndex];this.sourceIndex=sourceIndex;this.glTexture=this.source.glTexture;this.cutX;this.cutY;this.cutWidth;this.cutHeight;this.x=0;this.y=0;this.width;this.height;this.halfWidth;this.halfHeight;this.centerX;this.centerY;this.pivotX=0;this.pivotY=0;this.customPivot=false;this.rotated=false;this.autoRound=-1;this.customData={};this.u0=0;this.v0=0;this.u1=0;this.v1=0;this.data={cut:{x:0,y:0,w:0,h:0,r:0,b:0},trim:false,sourceSize:{w:0,h:0},spriteSourceSize:{x:0,y:0,w:0,h:0,r:0,b:0},radius:0,drawImage:{x:0,y:0,width:0,height:0}};this.setSize(width,height,x,y);},setSize:function(width,height,x,y)
        {if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            this.cutX=x;this.cutY=y;this.cutWidth=width;this.cutHeight=height;this.width=width;this.height=height;this.halfWidth=Math.floor(width*0.5);this.halfHeight=Math.floor(height*0.5);this.centerX=Math.floor(width / 2);this.centerY=Math.floor(height / 2);var data=this.data;var cut=data.cut;cut.x=x;cut.y=y;cut.w=width;cut.h=height;cut.r=x+width;cut.b=y+height;data.sourceSize.w=width;data.sourceSize.h=height;data.spriteSourceSize.w=width;data.spriteSourceSize.h=height;data.radius=0.5*Math.sqrt(width*width+height*height);var drawImage=data.drawImage;drawImage.x=x;drawImage.y=y;drawImage.width=width;drawImage.height=height;return this.updateUVs();},setTrim:function(actualWidth,actualHeight,destX,destY,destWidth,destHeight)
        {var data=this.data;var ss=data.spriteSourceSize;data.trim=true;data.sourceSize.w=actualWidth;data.sourceSize.h=actualHeight;ss.x=destX;ss.y=destY;ss.w=destWidth;ss.h=destHeight;ss.r=destX+destWidth;ss.b=destY+destHeight;this.x=destX;this.y=destY;this.width=destWidth;this.height=destHeight;this.halfWidth=destWidth*0.5;this.halfHeight=destHeight*0.5;this.centerX=Math.floor(destWidth / 2);this.centerY=Math.floor(destHeight / 2);return this.updateUVs();},setCropUVs:function(crop,x,y,width,height,flipX,flipY)
        {var cx=this.cutX;var cy=this.cutY;var cw=this.cutWidth;var ch=this.cutHeight;var rw=this.realWidth;var rh=this.realHeight;x=Clamp(x,0,rw);y=Clamp(y,0,rh);width=Clamp(width,0,rw-x);height=Clamp(height,0,rh-y);var ox=cx+x;var oy=cy+y;var ow=width;var oh=height;var data=this.data;if(data.trim)
        {var ss=data.spriteSourceSize;width=Clamp(width,0,cw-x);height=Clamp(height,0,ch-y);var cropRight=x+width;var cropBottom=y+height;var intersects=!(ss.r<x||ss.b<y||ss.x>cropRight||ss.y>cropBottom);if(intersects)
        {var ix=Math.max(ss.x,x);var iy=Math.max(ss.y,y);var iw=Math.min(ss.r,cropRight)-ix;var ih=Math.min(ss.b,cropBottom)-iy;ow=iw;oh=ih;if(flipX)
        {ox=cx+(cw-(ix-ss.x)-iw);}
        else
        {ox=cx+(ix-ss.x);}
            if(flipY)
            {oy=cy+(ch-(iy-ss.y)-ih);}
            else
            {oy=cy+(iy-ss.y);}
            x=ix;y=iy;width=iw;height=ih;}
        else
        {ox=0;oy=0;ow=0;oh=0;}}
        else
        {if(flipX)
        {ox=cx+(cw-x-width);}
            if(flipY)
            {oy=cy+(ch-y-height);}}
            var tw=this.source.width;var th=this.source.height;crop.u0=Math.max(0,ox / tw);crop.v0=Math.max(0,oy / th);crop.u1=Math.min(1,(ox+ow)/ tw);crop.v1=Math.min(1,(oy+oh)/ th);crop.x=x;crop.y=y;crop.cx=ox;crop.cy=oy;crop.cw=ow;crop.ch=oh;crop.width=width;crop.height=height;crop.flipX=flipX;crop.flipY=flipY;return crop;},updateCropUVs:function(crop,flipX,flipY)
        {return this.setCropUVs(crop,crop.x,crop.y,crop.width,crop.height,flipX,flipY);},updateUVs:function()
        {var cx=this.cutX;var cy=this.cutY;var cw=this.cutWidth;var ch=this.cutHeight;var cd=this.data.drawImage;cd.width=cw;cd.height=ch;var tw=this.source.width;var th=this.source.height;this.u0=cx / tw;this.v0=cy / th;this.u1=(cx+cw)/ tw;this.v1=(cy+ch)/ th;return this;},updateUVsInverted:function()
        {var tw=this.source.width;var th=this.source.height;this.u0=(this.cutX+this.cutHeight)/ tw;this.v0=this.cutY / th;this.u1=this.cutX / tw;this.v1=(this.cutY+this.cutWidth)/ th;return this;},clone:function()
        {var clone=new Frame(this.texture,this.name,this.sourceIndex);clone.cutX=this.cutX;clone.cutY=this.cutY;clone.cutWidth=this.cutWidth;clone.cutHeight=this.cutHeight;clone.x=this.x;clone.y=this.y;clone.width=this.width;clone.height=this.height;clone.halfWidth=this.halfWidth;clone.halfHeight=this.halfHeight;clone.centerX=this.centerX;clone.centerY=this.centerY;clone.rotated=this.rotated;clone.data=Extend(true,clone.data,this.data);clone.updateUVs();return clone;},destroy:function()
        {this.texture=null;this.source=null;},realWidth:{get:function()
            {return this.data.sourceSize.w;}},realHeight:{get:function()
            {return this.data.sourceSize.h;}},radius:{get:function()
            {return this.data.radius;}},trimmed:{get:function()
            {return this.data.trim;}},canvasData:{get:function()
            {return this.data.drawImage;}}});module.exports=Frame;}),"./textures/Texture.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Frame=__webpack_require__("./textures/Frame.js");var TextureSource=__webpack_require__("./textures/TextureSource.js");var TEXTURE_MISSING_ERROR='Texture.frame missing: ';var Texture=new Class({initialize:function Texture(manager,key,source,width,height)
        {if(!Array.isArray(source))
        {source=[source];}
            this.manager=manager;this.key=key;this.source=[];this.dataSource=[];this.frames={};this.customData={};this.firstFrame='__BASE';this.frameTotal=0;for(var i=0;i<source.length;i++)
        {this.source.push(new TextureSource(this,source[i],width,height));}},add:function(name,sourceIndex,x,y,width,height)
        {var frame=new Frame(this,name,sourceIndex,x,y,width,height);this.frames[name]=frame;if(this.frameTotal===1)
        {this.firstFrame=name;}
            this.frameTotal++;return frame;},has:function(name)
        {return(this.frames[name]);},get:function(name)
        {if(!name)
        {name=this.firstFrame;}
            var frame=this.frames[name];if(!frame)
        {console.warn(TEXTURE_MISSING_ERROR+name);frame=this.frames[this.firstFrame];}
            return frame;},getTextureSourceIndex:function(source)
        {for(var i=0;i<this.source.length;i++)
        {if(this.source[i]===source)
        {return i;}}
            return-1;},getFramesFromTextureSource:function(sourceIndex,includeBase)
        {if(includeBase===undefined){includeBase=false;}
            var out=[];for(var frameName in this.frames)
        {if(frameName==='__BASE'&&!includeBase)
        {continue;}
            var frame=this.frames[frameName];if(frame.sourceIndex===sourceIndex)
        {out.push(frame);}}
            return out;},getFrameNames:function(includeBase)
        {if(includeBase===undefined){includeBase=false;}
            var out=Object.keys(this.frames);if(!includeBase)
        {var idx=out.indexOf('__BASE');if(idx!==-1)
        {out.splice(idx,1);}}
            return out;},getSourceImage:function(name)
        {if(name===undefined||name===null||this.frameTotal===1)
        {name='__BASE';}
            var frame=this.frames[name];if(frame)
        {return frame.source.image;}
        else
        {console.warn(TEXTURE_MISSING_ERROR+name);return this.frames['__BASE'].source.image;}},getDataSourceImage:function(name)
        {if(name===undefined||name===null||this.frameTotal===1)
        {name='__BASE';}
            var frame=this.frames[name];var idx;if(!frame)
        {console.warn(TEXTURE_MISSING_ERROR+name);idx=this.frames['__BASE'].sourceIndex;}
        else
        {idx=frame.sourceIndex;}
            return this.dataSource[idx].image;},setDataSource:function(data)
        {if(!Array.isArray(data))
        {data=[data];}
            for(var i=0;i<data.length;i++)
            {var source=this.source[i];this.dataSource.push(new TextureSource(this,data[i],source.width,source.height));}},setFilter:function(filterMode)
        {var i;for(i=0;i<this.source.length;i++)
        {this.source[i].setFilter(filterMode);}
            for(i=0;i<this.dataSource.length;i++)
            {this.dataSource[i].setFilter(filterMode);}},destroy:function()
        {var i;for(i=0;i<this.source.length;i++)
        {this.source[i].destroy();}
            for(i=0;i<this.dataSource.length;i++)
            {this.dataSource[i].destroy();}
            for(var frameName in this.frames)
            {var frame=this.frames[frameName];frame.destroy();}
            this.source=[];this.dataSource=[];this.frames={};this.manager=null;}});module.exports=Texture;}),"./textures/TextureManager.js":(function(module,exports,__webpack_require__){var CanvasPool=__webpack_require__("./display/canvas/CanvasPool.js");var CanvasTexture=__webpack_require__("./textures/CanvasTexture.js");var Class=__webpack_require__("./utils/Class.js");var Color=__webpack_require__("./display/color/Color.js");var CONST=__webpack_require__("./const.js");var EventEmitter=__webpack_require__("../node_modules/eventemitter3/index.js");var GenerateTexture=__webpack_require__("./create/GenerateTexture.js");var GetValue=__webpack_require__("./utils/object/GetValue.js");var Parser=__webpack_require__("./textures/parsers/index.js");var Texture=__webpack_require__("./textures/Texture.js");var TextureManager=new Class({Extends:EventEmitter,initialize:function TextureManager(game)
        {EventEmitter.call(this);this.game=game;this.name='TextureManager';this.list={};this._tempCanvas=CanvasPool.create2D(this,1,1);this._tempContext=this._tempCanvas.getContext('2d');this._pending=0;game.events.once('boot',this.boot,this);},boot:function()
        {this._pending=2;this.on('onload',this.updatePending,this);this.on('onerror',this.updatePending,this);this.addBase64('__DEFAULT',this.game.config.defaultImage);this.addBase64('__MISSING',this.game.config.missingImage);this.game.events.once('destroy',this.destroy,this);},updatePending:function()
        {this._pending--;if(this._pending===0)
        {this.off('onload');this.off('onerror');this.game.events.emit('texturesready');}},checkKey:function(key)
        {if(this.exists(key))
        {console.error('Texture key already in use: '+key);return false;}
            return true;},remove:function(key)
        {if(typeof key==='string')
        {if(this.exists(key))
        {key=this.get(key);}
        else
        {console.warn('No texture found matching key: '+key);return this;}}
            if(this.list.hasOwnProperty(key.key))
            {delete this.list[key.key];key.destroy();this.emit('removetexture',key.key);}
            return this;},addBase64:function(key,data)
        {if(this.checkKey(key))
        {var _this=this;var image=new Image();image.onerror=function()
        {_this.emit('onerror',key);};image.onload=function()
        {var texture=_this.create(key,image);Parser.Image(texture,0);_this.emit('addtexture',key,texture);_this.emit('onload',key,texture);};image.src=data;}
            return this;},getBase64:function(key,frame,type,encoderOptions)
        {if(type===undefined){type='image/png';}
            if(encoderOptions===undefined){encoderOptions=0.92;}
            var data='';var textureFrame=this.getFrame(key,frame);if(textureFrame)
        {var cd=textureFrame.canvasData;var canvas=CanvasPool.create2D(this,cd.width,cd.height);var ctx=canvas.getContext('2d');ctx.drawImage(textureFrame.source.image,cd.x,cd.y,cd.width,cd.height,0,0,cd.width,cd.height);data=canvas.toDataURL(type,encoderOptions);CanvasPool.remove(canvas);}
            return data;},addImage:function(key,source,dataSource)
        {var texture=null;if(this.checkKey(key))
        {texture=this.create(key,source);Parser.Image(texture,0);if(dataSource)
        {texture.setDataSource(dataSource);}
            this.emit('addtexture',key,texture);}
            return texture;},addRenderTexture:function(key,renderTexture)
        {var texture=null;if(this.checkKey(key))
        {texture=this.create(key,renderTexture);texture.add('__BASE',0,0,0,renderTexture.width,renderTexture.height);this.emit('addtexture',key,texture);}
            return texture;},generate:function(key,config)
        {if(this.checkKey(key))
        {var canvas=CanvasPool.create(this,1,1);config.canvas=canvas;GenerateTexture(config);return this.addCanvas(key,canvas);}
        else
        {return null;}},createCanvas:function(key,width,height)
        {if(width===undefined){width=256;}
            if(height===undefined){height=256;}
            if(this.checkKey(key))
            {var canvas=CanvasPool.create(this,width,height,CONST.CANVAS,true);return this.addCanvas(key,canvas);}
            return null;},addCanvas:function(key,source,skipCache)
        {if(skipCache===undefined){skipCache=false;}
            var texture=null;if(skipCache)
        {texture=new CanvasTexture(this,key,source,source.width,source.height);}
        else if(this.checkKey(key))
        {texture=new CanvasTexture(this,key,source,source.width,source.height);this.list[key]=texture;this.emit('addtexture',key,texture);}
            return texture;},addAtlas:function(key,source,data,dataSource)
        {if(Array.isArray(data.textures)||Array.isArray(data.frames))
        {return this.addAtlasJSONArray(key,source,data,dataSource);}
        else
        {return this.addAtlasJSONHash(key,source,data,dataSource);}},addAtlasJSONArray:function(key,source,data,dataSource)
        {var texture=null;if(this.checkKey(key))
        {texture=this.create(key,source);if(Array.isArray(data))
        {var singleAtlasFile=(data.length===1);for(var i=0;i<texture.source.length;i++)
        {var atlasData=singleAtlasFile?data[0]:data[i];Parser.JSONArray(texture,i,atlasData);}}
        else
        {Parser.JSONArray(texture,0,data);}
            if(dataSource)
            {texture.setDataSource(dataSource);}
            this.emit('addtexture',key,texture);}
            return texture;},addAtlasJSONHash:function(key,source,data,dataSource)
        {var texture=null;if(this.checkKey(key))
        {texture=this.create(key,source);if(Array.isArray(data))
        {for(var i=0;i<data.length;i++)
        {Parser.JSONHash(texture,i,data[i]);}}
        else
        {Parser.JSONHash(texture,0,data);}
            if(dataSource)
            {texture.setDataSource(dataSource);}
            this.emit('addtexture',key,texture);}
            return texture;},addAtlasXML:function(key,source,data,dataSource)
        {var texture=null;if(this.checkKey(key))
        {texture=this.create(key,source);Parser.AtlasXML(texture,0,data);if(dataSource)
        {texture.setDataSource(dataSource);}
            this.emit('addtexture',key,texture);}
            return texture;},addUnityAtlas:function(key,source,data,dataSource)
        {var texture=null;if(this.checkKey(key))
        {texture=this.create(key,source);Parser.UnityYAML(texture,0,data);if(dataSource)
        {texture.setDataSource(dataSource);}
            this.emit('addtexture',key,texture);}
            return texture;},addSpriteSheet:function(key,source,config)
        {var texture=null;if(this.checkKey(key))
        {texture=this.create(key,source);var width=texture.source[0].width;var height=texture.source[0].height;Parser.SpriteSheet(texture,0,0,0,width,height,config);this.emit('addtexture',key,texture);}
            return texture;},addSpriteSheetFromAtlas:function(key,config)
        {if(!this.checkKey(key))
        {return null;}
            var atlasKey=GetValue(config,'atlas',null);var atlasFrame=GetValue(config,'frame',null);if(!atlasKey||!atlasFrame)
        {return;}
            var atlas=this.get(atlasKey);var sheet=atlas.get(atlasFrame);if(sheet)
        {var texture=this.create(key,sheet.source.image);if(sheet.trimmed)
        {Parser.SpriteSheetFromAtlas(texture,sheet,config);}
        else
        {Parser.SpriteSheet(texture,0,sheet.cutX,sheet.cutY,sheet.cutWidth,sheet.cutHeight,config);}
            this.emit('addtexture',key,texture);return texture;}},create:function(key,source,width,height)
        {var texture=null;if(this.checkKey(key))
        {texture=new Texture(this,key,source,width,height);this.list[key]=texture;}
            return texture;},exists:function(key)
        {return(this.list.hasOwnProperty(key));},get:function(key)
        {if(key===undefined){key='__DEFAULT';}
            if(this.list[key])
            {return this.list[key];}
            else
            {return this.list['__MISSING'];}},cloneFrame:function(key,frame)
        {if(this.list[key])
        {return this.list[key].get(frame).clone();}},getFrame:function(key,frame)
        {if(this.list[key])
        {return this.list[key].get(frame);}},getTextureKeys:function()
        {var output=[];for(var key in this.list)
        {if(key!=='__DEFAULT'&&key!=='__MISSING')
        {output.push(key);}}
            return output;},getPixel:function(x,y,key,frame)
        {var textureFrame=this.getFrame(key,frame);if(textureFrame)
        {x-=textureFrame.x;y-=textureFrame.y;var data=textureFrame.data.cut;x+=data.x;y+=data.y;if(x>=data.x&&x<data.r&&y>=data.y&&y<data.b)
        {var ctx=this._tempContext;ctx.clearRect(0,0,1,1);ctx.drawImage(textureFrame.source.image,x,y,1,1,0,0,1,1);var rgb=ctx.getImageData(0,0,1,1);return new Color(rgb.data[0],rgb.data[1],rgb.data[2],rgb.data[3]);}}
            return null;},getPixelAlpha:function(x,y,key,frame)
        {var textureFrame=this.getFrame(key,frame);if(textureFrame)
        {x-=textureFrame.x;y-=textureFrame.y;var data=textureFrame.data.cut;x+=data.x;y+=data.y;if(x>=data.x&&x<data.r&&y>=data.y&&y<data.b)
        {var ctx=this._tempContext;ctx.clearRect(0,0,1,1);ctx.drawImage(textureFrame.source.image,x,y,1,1,0,0,1,1);var rgb=ctx.getImageData(0,0,1,1);return rgb.data[3];}}
            return null;},setTexture:function(gameObject,key,frame)
        {if(this.list[key])
        {gameObject.texture=this.list[key];gameObject.frame=gameObject.texture.get(frame);}
            return gameObject;},renameTexture:function(currentKey,newKey)
        {var texture=this.get(currentKey);if(texture&&currentKey!==newKey)
        {texture.key=newKey;this.list[newKey]=texture;delete this.list[currentKey];return true;}
            return false;},each:function(callback,scope)
        {var args=[null];for(var i=1;i<arguments.length;i++)
        {args.push(arguments[i]);}
            for(var texture in this.list)
            {args[0]=this.list[texture];callback.apply(scope,args);}},destroy:function()
        {for(var texture in this.list)
        {this.list[texture].destroy();}
            this.list={};this.game=null;CanvasPool.remove(this._tempCanvas);}});module.exports=TextureManager;}),"./textures/TextureSource.js":(function(module,exports,__webpack_require__){var CanvasPool=__webpack_require__("./display/canvas/CanvasPool.js");var Class=__webpack_require__("./utils/Class.js");var IsSizePowerOfTwo=__webpack_require__("./math/pow2/IsSizePowerOfTwo.js");var ScaleModes=__webpack_require__("./renderer/ScaleModes.js");var TextureSource=new Class({initialize:function TextureSource(texture,source,width,height)
        {var game=texture.manager.game;this.renderer=game.renderer;this.texture=texture;this.source=source;this.image=source;this.compressionAlgorithm=null;this.resolution=1;this.width=width||source.naturalWidth||source.width||0;this.height=height||source.naturalHeight||source.height||0;this.scaleMode=ScaleModes.DEFAULT;this.isCanvas=(source instanceof HTMLCanvasElement);this.isRenderTexture=(source.type==='RenderTexture');this.isPowerOf2=IsSizePowerOfTwo(this.width,this.height);this.glTexture=null;this.init(game);},init:function(game)
        {if(this.renderer)
        {if(this.renderer.gl)
        {if(this.isCanvas)
        {this.glTexture=this.renderer.canvasToTexture(this.image);}
        else if(this.isRenderTexture)
        {this.image=this.source.canvas;this.glTexture=this.renderer.createTextureFromSource(null,this.width,this.height,this.scaleMode);}
        else
        {this.glTexture=this.renderer.createTextureFromSource(this.image,this.width,this.height,this.scaleMode);}}
        else if(this.isRenderTexture)
        {this.image=this.source.canvas;}}
            if(!game.config.antialias)
            {this.setFilter(1);}},setFilter:function(filterMode)
        {if(this.renderer.gl)
        {this.renderer.setTextureFilter(this.glTexture,filterMode);}},update:function()
        {if(this.renderer.gl&&this.isCanvas)
        {this.glTexture=this.renderer.canvasToTexture(this.image,this.glTexture);}},destroy:function()
        {if(this.glTexture)
        {this.renderer.deleteTexture(this.glTexture);}
            if(this.isCanvas)
            {CanvasPool.remove(this.image);}
            this.renderer=null;this.texture=null;this.source=null;this.image=null;this.glTexture=null;}});module.exports=TextureSource;}),"./textures/const.js":(function(module,exports){var CONST={LINEAR:0,NEAREST:1};module.exports=CONST;}),"./textures/index.js":(function(module,exports,__webpack_require__){var Extend=__webpack_require__("./utils/object/Extend.js");var FilterMode=__webpack_require__("./textures/const.js");var Textures={FilterMode:FilterMode,Frame:__webpack_require__("./textures/Frame.js"),Parsers:__webpack_require__("./textures/parsers/index.js"),Texture:__webpack_require__("./textures/Texture.js"),TextureManager:__webpack_require__("./textures/TextureManager.js"),TextureSource:__webpack_require__("./textures/TextureSource.js")};Textures=Extend(false,Textures,FilterMode);module.exports=Textures;}),"./textures/parsers/AtlasXML.js":(function(module,exports){var AtlasXML=function(texture,sourceIndex,xml)
    {if(!xml.getElementsByTagName('TextureAtlas'))
    {console.warn('Invalid Texture Atlas XML given');return;}
        var source=texture.source[sourceIndex];texture.add('__BASE',sourceIndex,0,0,source.width,source.height);var frames=xml.getElementsByTagName('SubTexture');var newFrame;for(var i=0;i<frames.length;i++)
    {var frame=frames[i].attributes;var name=frame.name.value;var x=parseInt(frame.x.value,10);var y=parseInt(frame.y.value,10);var width=parseInt(frame.width.value,10);var height=parseInt(frame.height.value,10);newFrame=texture.add(name,sourceIndex,x,y,width,height);if(frame.frameX)
    {var frameX=Math.abs(parseInt(frame.frameX.value,10));var frameY=Math.abs(parseInt(frame.frameY.value,10));var frameWidth=parseInt(frame.frameWidth.value,10);var frameHeight=parseInt(frame.frameHeight.value,10);newFrame.setTrim(width,height,frameX,frameY,frameWidth,frameHeight);}}
        return texture;};module.exports=AtlasXML;}),"./textures/parsers/Canvas.js":(function(module,exports){var Canvas=function(texture,sourceIndex)
    {var source=texture.source[sourceIndex];texture.add('__BASE',sourceIndex,0,0,source.width,source.height);return texture;};module.exports=Canvas;}),"./textures/parsers/Image.js":(function(module,exports){var Image=function(texture,sourceIndex)
    {var source=texture.source[sourceIndex];texture.add('__BASE',sourceIndex,0,0,source.width,source.height);return texture;};module.exports=Image;}),"./textures/parsers/JSONArray.js":(function(module,exports,__webpack_require__){var Clone=__webpack_require__("./utils/object/Clone.js");var JSONArray=function(texture,sourceIndex,json)
    {if(!json['frames']&&!json['textures'])
    {console.warn('Invalid Texture Atlas JSON Array');return;}
        var source=texture.source[sourceIndex];texture.add('__BASE',sourceIndex,0,0,source.width,source.height);var frames=(Array.isArray(json.textures))?json.textures[sourceIndex].frames:json.frames;var newFrame;for(var i=0;i<frames.length;i++)
    {var src=frames[i];newFrame=texture.add(src.filename,sourceIndex,src.frame.x,src.frame.y,src.frame.w,src.frame.h);if(src.trimmed)
    {newFrame.setTrim(src.sourceSize.w,src.sourceSize.h,src.spriteSourceSize.x,src.spriteSourceSize.y,src.spriteSourceSize.w,src.spriteSourceSize.h);}
        if(src.rotated)
        {newFrame.rotated=true;newFrame.updateUVsInverted();}
        if(src.anchor)
        {newFrame.customPivot=true;newFrame.pivotX=src.anchor.x;newFrame.pivotY=src.anchor.y;}
        newFrame.customData=Clone(src);}
        for(var dataKey in json)
        {if(dataKey==='frames')
        {continue;}
            if(Array.isArray(json[dataKey]))
            {texture.customData[dataKey]=json[dataKey].slice(0);}
            else
            {texture.customData[dataKey]=json[dataKey];}}
        return texture;};module.exports=JSONArray;}),"./textures/parsers/JSONHash.js":(function(module,exports,__webpack_require__){var Clone=__webpack_require__("./utils/object/Clone.js");var JSONHash=function(texture,sourceIndex,json)
    {if(!json['frames'])
    {console.warn('Invalid Texture Atlas JSON Hash given, missing \'frames\' Object');return;}
        var source=texture.source[sourceIndex];texture.add('__BASE',sourceIndex,0,0,source.width,source.height);var frames=json['frames'];var newFrame;for(var key in frames)
    {var src=frames[key];newFrame=texture.add(key,sourceIndex,src.frame.x,src.frame.y,src.frame.w,src.frame.h);if(src.trimmed)
    {newFrame.setTrim(src.sourceSize.w,src.sourceSize.h,src.spriteSourceSize.x,src.spriteSourceSize.y,src.spriteSourceSize.w,src.spriteSourceSize.h);}
        if(src.rotated)
        {newFrame.rotated=true;newFrame.updateUVsInverted();}
        newFrame.customData=Clone(src);}
        for(var dataKey in json)
        {if(dataKey==='frames')
        {continue;}
            if(Array.isArray(json[dataKey]))
            {texture.customData[dataKey]=json[dataKey].slice(0);}
            else
            {texture.customData[dataKey]=json[dataKey];}}
        return texture;};module.exports=JSONHash;}),"./textures/parsers/SpriteSheet.js":(function(module,exports,__webpack_require__){var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var SpriteSheet=function(texture,sourceIndex,x,y,width,height,config)
    {var frameWidth=GetFastValue(config,'frameWidth',null);var frameHeight=GetFastValue(config,'frameHeight',frameWidth);if(frameWidth===null)
    {throw new Error('TextureManager.SpriteSheet: Invalid frameWidth given.');}
        var source=texture.source[sourceIndex];texture.add('__BASE',sourceIndex,0,0,source.width,source.height);var startFrame=GetFastValue(config,'startFrame',0);var endFrame=GetFastValue(config,'endFrame',-1);var margin=GetFastValue(config,'margin',0);var spacing=GetFastValue(config,'spacing',0);var row=Math.floor((width-margin+spacing)/(frameWidth+spacing));var column=Math.floor((height-margin+spacing)/(frameHeight+spacing));var total=row*column;if(total===0)
    {console.warn('SpriteSheet frame dimensions will result in zero frames.');}
        if(startFrame>total||startFrame<-total)
        {startFrame=0;}
        if(startFrame<0)
        {startFrame=total+startFrame;}
        if(endFrame!==-1)
        {total=startFrame+(endFrame+1);}
        var fx=margin;var fy=margin;var ax=0;var ay=0;for(var i=0;i<total;i++)
    {ax=0;ay=0;var w=fx+frameWidth;var h=fy+frameHeight;if(w>width)
    {ax=w-width;}
        if(h>height)
        {ay=h-height;}
        texture.add(i,sourceIndex,x+fx,y+fy,frameWidth-ax,frameHeight-ay);fx+=frameWidth+spacing;if(fx+frameWidth>width)
    {fx=margin;fy+=frameHeight+spacing;}}
        return texture;};module.exports=SpriteSheet;}),"./textures/parsers/SpriteSheetFromAtlas.js":(function(module,exports,__webpack_require__){var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var SpriteSheetFromAtlas=function(texture,frame,config)
    {var frameWidth=GetFastValue(config,'frameWidth',null);var frameHeight=GetFastValue(config,'frameHeight',frameWidth);if(!frameWidth)
    {throw new Error('TextureManager.SpriteSheetFromAtlas: Invalid frameWidth given.');}
        var startFrame=GetFastValue(config,'startFrame',0);var endFrame=GetFastValue(config,'endFrame',-1);var margin=GetFastValue(config,'margin',0);var spacing=GetFastValue(config,'spacing',0);var x=frame.cutX;var y=frame.cutY;var cutWidth=frame.cutWidth;var cutHeight=frame.cutHeight;var sheetWidth=frame.realWidth;var sheetHeight=frame.realHeight;var row=Math.floor((sheetWidth-margin+spacing)/(frameWidth+spacing));var column=Math.floor((sheetHeight-margin+spacing)/(frameHeight+spacing));var total=row*column;var leftPad=frame.x;var leftWidth=frameWidth-leftPad;var rightWidth=frameWidth-((sheetWidth-cutWidth)-leftPad);var topPad=frame.y;var topHeight=frameHeight-topPad;var bottomHeight=frameHeight-((sheetHeight-cutHeight)-topPad);if(startFrame>total||startFrame<-total)
    {startFrame=0;}
        if(startFrame<0)
        {startFrame=total+startFrame;}
        if(endFrame!==-1)
        {total=startFrame+(endFrame+1);}
        var sheetFrame;var frameX=margin;var frameY=margin;var frameIndex=0;var sourceIndex=frame.sourceIndex;for(var sheetY=0;sheetY<column;sheetY++)
    {var topRow=(sheetY===0);var bottomRow=(sheetY===column-1);for(var sheetX=0;sheetX<row;sheetX++)
    {var leftRow=(sheetX===0);var rightRow=(sheetX===row-1);sheetFrame=texture.add(frameIndex,sourceIndex,x+frameX,y+frameY,frameWidth,frameHeight);if(leftRow||topRow||rightRow||bottomRow)
    {var destX=(leftRow)?leftPad:0;var destY=(topRow)?topPad:0;var trimWidth=0;var trimHeight=0;if(leftRow)
    {trimWidth+=(frameWidth-leftWidth);}
        if(rightRow)
        {trimWidth+=(frameWidth-rightWidth);}
        if(topRow)
        {trimHeight+=(frameHeight-topHeight);}
        if(bottomRow)
        {trimHeight+=(frameHeight-bottomHeight);}
        var destWidth=frameWidth-trimWidth;var destHeight=frameHeight-trimHeight;sheetFrame.cutWidth=destWidth;sheetFrame.cutHeight=destHeight;sheetFrame.setTrim(frameWidth,frameHeight,destX,destY,destWidth,destHeight);}
        frameX+=spacing;if(leftRow)
    {frameX+=leftWidth;}
    else if(rightRow)
    {frameX+=rightWidth;}
    else
    {frameX+=frameWidth;}
        frameIndex++;}
        frameX=margin;frameY+=spacing;if(topRow)
    {frameY+=topHeight;}
    else if(bottomRow)
    {frameY+=bottomHeight;}
    else
    {frameY+=frameHeight;}}
        return texture;};module.exports=SpriteSheetFromAtlas;}),"./textures/parsers/UnityYAML.js":(function(module,exports){var imageHeight=0;var addFrame=function(texture,sourceIndex,name,frame)
    {var y=imageHeight-frame.y-frame.height;texture.add(name,sourceIndex,frame.x,y,frame.width,frame.height);};var UnityYAML=function(texture,sourceIndex,yaml)
    {var source=texture.source[sourceIndex];texture.add('__BASE',sourceIndex,0,0,source.width,source.height);imageHeight=source.height;var data=yaml.split('\n');var lineRegExp=/^[ ]*(- )*(\w+)+[: ]+(.*)/;var prevSprite='';var currentSprite='';var rect={x:0,y:0,width:0,height:0};for(var i=0;i<data.length;i++)
    {var results=data[i].match(lineRegExp);if(!results)
    {continue;}
        var isList=(results[1]==='- ');var key=results[2];var value=results[3];if(isList)
    {if(currentSprite!==prevSprite)
    {addFrame(texture,sourceIndex,currentSprite,rect);prevSprite=currentSprite;}
        rect={x:0,y:0,width:0,height:0};}
        if(key==='name')
        {currentSprite=value;continue;}
        switch(key)
        {case'x':case'y':case'width':case'height':rect[key]=parseInt(value,10);break;}}
        if(currentSprite!==prevSprite)
        {addFrame(texture,sourceIndex,currentSprite,rect);}
        return texture;};module.exports=UnityYAML;}),"./textures/parsers/index.js":(function(module,exports,__webpack_require__){module.exports={AtlasXML:__webpack_require__("./textures/parsers/AtlasXML.js"),Canvas:__webpack_require__("./textures/parsers/Canvas.js"),Image:__webpack_require__("./textures/parsers/Image.js"),JSONArray:__webpack_require__("./textures/parsers/JSONArray.js"),JSONHash:__webpack_require__("./textures/parsers/JSONHash.js"),SpriteSheet:__webpack_require__("./textures/parsers/SpriteSheet.js"),SpriteSheetFromAtlas:__webpack_require__("./textures/parsers/SpriteSheetFromAtlas.js"),UnityYAML:__webpack_require__("./textures/parsers/UnityYAML.js")};}),"./tilemaps/Formats.js":(function(module,exports){module.exports={CSV:0,TILED_JSON:1,ARRAY_2D:2,WELTMEISTER:3};}),"./tilemaps/ImageCollection.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var ImageCollection=new Class({initialize:function ImageCollection(name,firstgid,width,height,margin,spacing,properties)
        {if(width===undefined||width<=0){width=32;}
            if(height===undefined||height<=0){height=32;}
            if(margin===undefined){margin=0;}
            if(spacing===undefined){spacing=0;}
            this.name=name;this.firstgid=firstgid|0;this.imageWidth=width|0;this.imageHeight=height|0;this.imageMargin=margin|0;this.imageSpacing=spacing|0;this.properties=properties||{};this.images=[];this.total=0;},containsImageIndex:function(imageIndex)
        {return(imageIndex>=this.firstgid&&imageIndex<(this.firstgid+this.total));},addImage:function(gid,image)
        {this.images.push({gid:gid,image:image});this.total++;return this;}});module.exports=ImageCollection;}),"./tilemaps/ParseToTilemap.js":(function(module,exports,__webpack_require__){var Formats=__webpack_require__("./tilemaps/Formats.js");var MapData=__webpack_require__("./tilemaps/mapdata/MapData.js");var Parse=__webpack_require__("./tilemaps/parsers/Parse.js");var Tilemap=__webpack_require__("./tilemaps/Tilemap.js");var ParseToTilemap=function(scene,key,tileWidth,tileHeight,width,height,data,insertNull)
    {if(tileWidth===undefined){tileWidth=32;}
        if(tileHeight===undefined){tileHeight=32;}
        if(width===undefined){width=10;}
        if(height===undefined){height=10;}
        if(insertNull===undefined){insertNull=false;}
        var mapData=null;if(Array.isArray(data))
    {var name=key!==undefined?key:'map';mapData=Parse(name,Formats.ARRAY_2D,data,tileWidth,tileHeight,insertNull);}
    else if(key!==undefined)
    {var tilemapData=scene.cache.tilemap.get(key);if(!tilemapData)
    {console.warn('No map data found for key '+key);}
    else
    {mapData=Parse(key,tilemapData.format,tilemapData.data,tileWidth,tileHeight,insertNull);}}
        if(mapData===null)
        {mapData=new MapData({tileWidth:tileWidth,tileHeight:tileHeight,width:width,height:height});}
        return new Tilemap(scene,mapData);};module.exports=ParseToTilemap;}),"./tilemaps/Tile.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Components=__webpack_require__("./gameobjects/components/index.js");var Rectangle=__webpack_require__("./geom/rectangle/index.js");var Tile=new Class({Mixins:[Components.Alpha,Components.Flip,Components.Visible],initialize:function Tile(layer,index,x,y,width,height,baseWidth,baseHeight)
        {this.layer=layer;this.index=index;this.x=x;this.y=y;this.width=width;this.height=height;this.baseWidth=(baseWidth!==undefined)?baseWidth:width;this.baseHeight=(baseHeight!==undefined)?baseHeight:height;this.pixelX=0;this.pixelY=0;this.updatePixelXY();this.properties={};this.rotation=0;this.collideLeft=false;this.collideRight=false;this.collideUp=false;this.collideDown=false;this.faceLeft=false;this.faceRight=false;this.faceTop=false;this.faceBottom=false;this.collisionCallback=null;this.collisionCallbackContext=this;this.tint=0xffffff;this.physics={};},containsPoint:function(x,y)
        {return!(x<this.pixelX||y<this.pixelY||x>this.right||y>this.bottom);},copy:function(tile)
        {this.index=tile.index;this.alpha=tile.alpha;this.properties=tile.properties;this.visible=tile.visible;this.setFlip(tile.flipX,tile.flipY);this.tint=tile.tint;this.rotation=tile.rotation;this.collideUp=tile.collideUp;this.collideDown=tile.collideDown;this.collideLeft=tile.collideLeft;this.collideRight=tile.collideRight;this.collisionCallback=tile.collisionCallback;this.collisionCallbackContext=tile.collisionCallbackContext;return this;},getCollisionGroup:function()
        {return this.tileset?this.tileset.getTileCollisionGroup(this.index):null;},getTileData:function()
        {return this.tileset?this.tileset.getTileData(this.index):null;},getLeft:function(camera)
        {var tilemapLayer=this.tilemapLayer;return(tilemapLayer)?tilemapLayer.tileToWorldX(this.x,camera):this.x*this.baseWidth;},getRight:function(camera)
        {var tilemapLayer=this.tilemapLayer;return(tilemapLayer)?this.getLeft(camera)+this.width*tilemapLayer.scaleX:this.getLeft(camera)+this.width;},getTop:function(camera)
        {var tilemapLayer=this.tilemapLayer;return tilemapLayer?tilemapLayer.tileToWorldY(this.y,camera)-(this.height-this.baseHeight)*tilemapLayer.scaleY:this.y*this.baseHeight-(this.height-this.baseHeight);},getBottom:function(camera)
        {var tilemapLayer=this.tilemapLayer;return tilemapLayer?this.getTop(camera)+this.height*tilemapLayer.scaleY:this.getTop(camera)+this.height;},getBounds:function(camera,output)
        {if(output===undefined){output=new Rectangle();}
            output.x=this.getLeft();output.y=this.getTop();output.width=this.getRight()-output.x;output.height=this.getBottom()-output.y;return output;},getCenterX:function(camera)
        {return this.getLeft(camera)+this.width / 2;},getCenterY:function(camera)
        {return this.getTop(camera)+this.height / 2;},destroy:function()
        {this.collisionCallback=undefined;this.collisionCallbackContext=undefined;this.properties=undefined;},intersects:function(x,y,right,bottom)
        {return!(right<=this.pixelX||bottom<=this.pixelY||x>=this.right||y>=this.bottom);},isInteresting:function(collides,faces)
        {if(collides&&faces){return(this.canCollide||this.hasInterestingFace);}
        else if(collides){return this.collides;}
        else if(faces){return this.hasInterestingFace;}
            return false;},resetCollision:function(recalculateFaces)
        {if(recalculateFaces===undefined){recalculateFaces=true;}
            this.collideLeft=false;this.collideRight=false;this.collideUp=false;this.collideDown=false;this.faceTop=false;this.faceBottom=false;this.faceLeft=false;this.faceRight=false;if(recalculateFaces)
        {var tilemapLayer=this.tilemapLayer;if(tilemapLayer)
        {this.tilemapLayer.calculateFacesAt(this.x,this.y);}}
            return this;},resetFaces:function()
        {this.faceTop=false;this.faceBottom=false;this.faceLeft=false;this.faceRight=false;return this;},setCollision:function(left,right,up,down,recalculateFaces)
        {if(right===undefined){right=left;}
            if(up===undefined){up=left;}
            if(down===undefined){down=left;}
            if(recalculateFaces===undefined){recalculateFaces=true;}
            this.collideLeft=left;this.collideRight=right;this.collideUp=up;this.collideDown=down;this.faceLeft=left;this.faceRight=right;this.faceTop=up;this.faceBottom=down;if(recalculateFaces)
        {var tilemapLayer=this.tilemapLayer;if(tilemapLayer)
        {this.tilemapLayer.calculateFacesAt(this.x,this.y);}}
            return this;},setCollisionCallback:function(callback,context)
        {if(callback===null)
        {this.collisionCallback=undefined;this.collisionCallbackContext=undefined;}
        else
        {this.collisionCallback=callback;this.collisionCallbackContext=context;}
            return this;},setSize:function(tileWidth,tileHeight,baseWidth,baseHeight)
        {if(tileWidth!==undefined){this.width=tileWidth;}
            if(tileHeight!==undefined){this.height=tileHeight;}
            if(baseWidth!==undefined){this.baseWidth=baseWidth;}
            if(baseHeight!==undefined){this.baseHeight=baseHeight;}
            this.updatePixelXY();return this;},updatePixelXY:function()
        {this.pixelX=this.x*this.baseWidth;this.pixelY=this.y*this.baseHeight;return this;},canCollide:{get:function()
            {return(this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.collisionCallback);}},collides:{get:function()
            {return(this.collideLeft||this.collideRight||this.collideUp||this.collideDown);}},hasInterestingFace:{get:function()
            {return(this.faceTop||this.faceBottom||this.faceLeft||this.faceRight);}},tileset:{get:function()
            {var tilemapLayer=this.layer.tilemapLayer;if(tilemapLayer)
            {var tileset=tilemapLayer.gidMap[this.index];if(tileset)
            {return tileset;}}
                return null;}},tilemapLayer:{get:function()
            {return this.layer.tilemapLayer;}},tilemap:{get:function()
            {var tilemapLayer=this.tilemapLayer;return tilemapLayer?tilemapLayer.tilemap:null;}}});module.exports=Tile;}),"./tilemaps/Tilemap.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var DegToRad=__webpack_require__("./math/DegToRad.js");var DynamicTilemapLayer=__webpack_require__("./tilemaps/dynamiclayer/DynamicTilemapLayer.js");var Extend=__webpack_require__("./utils/object/Extend.js");var Formats=__webpack_require__("./tilemaps/Formats.js");var LayerData=__webpack_require__("./tilemaps/mapdata/LayerData.js");var Rotate=__webpack_require__("./math/Rotate.js");var StaticTilemapLayer=__webpack_require__("./tilemaps/staticlayer/StaticTilemapLayer.js");var Tile=__webpack_require__("./tilemaps/Tile.js");var TilemapComponents=__webpack_require__("./tilemaps/components/index.js");var Tileset=__webpack_require__("./tilemaps/Tileset.js");var Tilemap=new Class({initialize:function Tilemap(scene,mapData)
        {this.scene=scene;this.tileWidth=mapData.tileWidth;this.tileHeight=mapData.tileHeight;this.width=mapData.width;this.height=mapData.height;this.orientation=mapData.orientation;this.renderOrder=mapData.renderOrder;this.format=mapData.format;this.version=mapData.version;this.properties=mapData.properties;this.widthInPixels=mapData.widthInPixels;this.heightInPixels=mapData.heightInPixels;this.imageCollections=mapData.imageCollections;this.images=mapData.images;this.layers=mapData.layers;this.tilesets=mapData.tilesets;this.objects=mapData.objects;this.currentLayerIndex=0;},setRenderOrder:function(renderOrder)
        {var orders=['right-down','left-down','right-up','left-up'];if(typeof renderOrder==='number')
        {renderOrder=orders[renderOrder];}
            if(orders.indexOf(renderOrder)>-1)
            {this.renderOrder=renderOrder;}
            return this;},addTilesetImage:function(tilesetName,key,tileWidth,tileHeight,tileMargin,tileSpacing,gid)
        {if(tilesetName===undefined){return null;}
            if(key===undefined||key===null){key=tilesetName;}
            if(!this.scene.sys.textures.exists(key))
            {console.warn('Invalid Tileset Image: '+key);return null;}
            var texture=this.scene.sys.textures.get(key);var index=this.getTilesetIndex(tilesetName);if(index===null&&this.format===Formats.TILED_JSON)
        {console.warn('No data found for Tileset: '+tilesetName);return null;}
            var tileset=this.tilesets[index];if(tileset)
        {tileset.setTileSize(tileWidth,tileHeight);tileset.setSpacing(tileMargin,tileSpacing);tileset.setImage(texture);return tileset;}
            if(tileWidth===undefined){tileWidth=this.tileWidth;}
            if(tileHeight===undefined){tileHeight=this.tileHeight;}
            if(tileMargin===undefined){tileMargin=0;}
            if(tileSpacing===undefined){tileSpacing=0;}
            if(gid===undefined){gid=0;}
            tileset=new Tileset(tilesetName,gid,tileWidth,tileHeight,tileMargin,tileSpacing);tileset.setImage(texture);this.tilesets.push(tileset);return tileset;},convertLayerToStatic:function(layer)
        {layer=this.getLayer(layer);if(layer===null){return null;}
            var dynamicLayer=layer.tilemapLayer;if(!dynamicLayer||!(dynamicLayer instanceof DynamicTilemapLayer))
        {return null;}
            var staticLayer=new StaticTilemapLayer(dynamicLayer.scene,dynamicLayer.tilemap,dynamicLayer.layerIndex,dynamicLayer.tileset,dynamicLayer.x,dynamicLayer.y);this.scene.sys.displayList.add(staticLayer);dynamicLayer.destroy();return staticLayer;},copy:function(srcTileX,srcTileY,width,height,destTileX,destTileY,recalculateFaces,layer)
        {layer=this.getLayer(layer);if(this._isStaticCall(layer,'copy')){return this;}
            if(layer!==null)
            {TilemapComponents.Copy(srcTileX,srcTileY,width,height,destTileX,destTileY,recalculateFaces,layer);}
            return this;},createBlankDynamicLayer:function(name,tileset,x,y,width,height,tileWidth,tileHeight)
        {if(tileWidth===undefined){tileWidth=tileset.tileWidth;}
            if(tileHeight===undefined){tileHeight=tileset.tileHeight;}
            if(width===undefined){width=this.width;}
            if(height===undefined){height=this.height;}
            if(x===undefined){x=0;}
            if(y===undefined){y=0;}
            var index=this.getLayerIndex(name);if(index!==null)
        {console.warn('Invalid Tilemap Layer ID: '+name);return null;}
            var layerData=new LayerData({name:name,tileWidth:tileWidth,tileHeight:tileHeight,width:width,height:height});var row;for(var tileY=0;tileY<height;tileY++)
        {row=[];for(var tileX=0;tileX<width;tileX++)
        {row.push(new Tile(layerData,-1,tileX,tileY,tileWidth,tileHeight,this.tileWidth,this.tileHeight));}
            layerData.data.push(row);}
            this.layers.push(layerData);this.currentLayerIndex=this.layers.length-1;var dynamicLayer=new DynamicTilemapLayer(this.scene,this,this.currentLayerIndex,tileset,x,y);dynamicLayer.setRenderOrder(this.renderOrder);this.scene.sys.displayList.add(dynamicLayer);return dynamicLayer;},createDynamicLayer:function(layerID,tileset,x,y)
        {var index=this.getLayerIndex(layerID);if(index===null)
        {console.warn('Invalid Tilemap Layer ID: '+layerID);return null;}
            var layerData=this.layers[index];if(layerData.tilemapLayer)
        {console.warn('Tilemap Layer ID already exists:'+layerID);return null;}
            this.currentLayerIndex=index;if(x===undefined&&this.layers[index].x){x=this.layers[index].x;}
            if(y===undefined&&this.layers[index].y){y=this.layers[index].y;}
            var layer=new DynamicTilemapLayer(this.scene,this,index,tileset,x,y);layer.setRenderOrder(this.renderOrder);this.scene.sys.displayList.add(layer);return layer;},createFromObjects:function(name,id,spriteConfig,scene)
        {if(spriteConfig===undefined){spriteConfig={};}
            if(scene===undefined){scene=this.scene;}
            var objectLayer=this.getObjectLayer(name);if(!objectLayer)
        {console.warn('Cannot create from object. Invalid objectgroup name given: '+name);return;}
            var objects=objectLayer.objects;var sprites=[];for(var i=0;i<objects.length;i++)
        {var found=false;var obj=objects[i];if(obj.gid!==undefined&&typeof id==='number'&&obj.gid===id||obj.id!==undefined&&typeof id==='number'&&obj.id===id||obj.name!==undefined&&typeof id==='string'&&obj.name===id)
        {found=true;}
            if(found)
            {var config=Extend({},spriteConfig,obj.properties);config.x=obj.x;config.y=obj.y;var sprite=this.scene.make.sprite(config);sprite.name=obj.name;if(obj.width){sprite.displayWidth=obj.width;}
                if(obj.height){sprite.displayHeight=obj.height;}
                var offset={x:sprite.originX*sprite.displayWidth,y:(sprite.originY-1)*sprite.displayHeight};if(obj.rotation)
            {var angle=DegToRad(obj.rotation);Rotate(offset,angle);sprite.rotation=angle;}
                sprite.x+=offset.x;sprite.y+=offset.y;if(obj.flippedHorizontal!==undefined||obj.flippedVertical!==undefined)
            {sprite.setFlip(obj.flippedHorizontal,obj.flippedVertical);}
                if(!obj.visible){sprite.visible=false;}
                for(var key in obj.properties)
                {if(sprite.hasOwnProperty(key))
                {continue;}
                    sprite.setData(key,obj.properties[key]);}
                sprites.push(sprite);}}
            return sprites;},createFromTiles:function(indexes,replacements,spriteConfig,scene,camera,layer)
        {layer=this.getLayer(layer);if(layer===null){return null;}
            return TilemapComponents.CreateFromTiles(indexes,replacements,spriteConfig,scene,camera,layer);},createStaticLayer:function(layerID,tileset,x,y)
        {var index=this.getLayerIndex(layerID);if(index===null)
        {console.warn('Invalid Tilemap Layer ID: '+layerID);return null;}
            var layerData=this.layers[index];if(layerData.tilemapLayer)
        {console.warn('Tilemap Layer ID already exists:'+layerID);return null;}
            this.currentLayerIndex=index;if(x===undefined&&this.layers[index].x){x=this.layers[index].x;}
            if(y===undefined&&this.layers[index].y){y=this.layers[index].y;}
            var layer=new StaticTilemapLayer(this.scene,this,index,tileset,x,y);layer.setRenderOrder(this.renderOrder);this.scene.sys.displayList.add(layer);return layer;},destroy:function()
        {this.removeAllLayers();this.tilesets.length=0;this.objects.length=0;this.scene=undefined;},fill:function(index,tileX,tileY,width,height,recalculateFaces,layer)
        {layer=this.getLayer(layer);if(this._isStaticCall(layer,'fill')){return this;}
            if(layer!==null)
            {TilemapComponents.Fill(index,tileX,tileY,width,height,recalculateFaces,layer);}
            return this;},filterObjects:function(objectLayer,callback,context)
        {if(typeof objectLayer==='string')
        {var name=objectLayer;objectLayer=this.getObjectLayer(objectLayer);if(!objectLayer)
        {console.warn('No object layer found with the name: '+name);return null;}}
            return objectLayer.objects.filter(callback,context);},filterTiles:function(callback,context,tileX,tileY,width,height,filteringOptions,layer)
        {layer=this.getLayer(layer);if(layer===null){return null;}
            return TilemapComponents.FilterTiles(callback,context,tileX,tileY,width,height,filteringOptions,layer);},findByIndex:function(findIndex,skip,reverse,layer)
        {layer=this.getLayer(layer);if(layer===null){return null;}
            return TilemapComponents.FindByIndex(findIndex,skip,reverse,layer);},findObject:function(objectLayer,callback,context)
        {if(typeof objectLayer==='string')
        {var name=objectLayer;objectLayer=this.getObjectLayer(objectLayer);if(!objectLayer)
        {console.warn('No object layer found with the name: '+name);return null;}}
            return objectLayer.objects.find(callback,context)||null;},findTile:function(callback,context,tileX,tileY,width,height,filteringOptions,layer)
        {layer=this.getLayer(layer);if(layer===null){return null;}
            return TilemapComponents.FindTile(callback,context,tileX,tileY,width,height,filteringOptions,layer);},forEachTile:function(callback,context,tileX,tileY,width,height,filteringOptions,layer)
        {layer=this.getLayer(layer);if(layer!==null)
        {TilemapComponents.ForEachTile(callback,context,tileX,tileY,width,height,filteringOptions,layer);}
            return this;},getImageIndex:function(name)
        {return this.getIndex(this.images,name);},getIndex:function(location,name)
        {for(var i=0;i<location.length;i++)
        {if(location[i].name===name)
        {return i;}}
            return null;},getLayer:function(layer)
        {var index=this.getLayerIndex(layer);return index!==null?this.layers[index]:null;},getObjectLayer:function(name)
        {var index=this.getIndex(this.objects,name);return index!==null?this.objects[index]:null;},getLayerIndex:function(layer)
        {if(layer===undefined)
        {return this.currentLayerIndex;}
        else if(typeof layer==='string')
        {return this.getLayerIndexByName(layer);}
        else if(typeof layer==='number'&&layer<this.layers.length)
        {return layer;}
        else if(layer instanceof StaticTilemapLayer||layer instanceof DynamicTilemapLayer)
        {return layer.layerIndex;}
        else
        {return null;}},getLayerIndexByName:function(name)
        {return this.getIndex(this.layers,name);},getTileAt:function(tileX,tileY,nonNull,layer)
        {layer=this.getLayer(layer);if(layer===null){return null;}
            return TilemapComponents.GetTileAt(tileX,tileY,nonNull,layer);},getTileAtWorldXY:function(worldX,worldY,nonNull,camera,layer)
        {layer=this.getLayer(layer);if(layer===null)
        {return null;}
        else
        {return TilemapComponents.GetTileAtWorldXY(worldX,worldY,nonNull,camera,layer);}},getTilesWithin:function(tileX,tileY,width,height,filteringOptions,layer)
        {layer=this.getLayer(layer);if(layer===null){return null;}
            return TilemapComponents.GetTilesWithin(tileX,tileY,width,height,filteringOptions,layer);},getTilesWithinShape:function(shape,filteringOptions,camera,layer)
        {layer=this.getLayer(layer);if(layer===null){return null;}
            return TilemapComponents.GetTilesWithinShape(shape,filteringOptions,camera,layer);},getTilesWithinWorldXY:function(worldX,worldY,width,height,filteringOptions,camera,layer)
        {layer=this.getLayer(layer);if(layer===null){return null;}
            return TilemapComponents.GetTilesWithinWorldXY(worldX,worldY,width,height,filteringOptions,camera,layer);},getTileset:function(name)
        {var index=this.getIndex(this.tilesets,name);return(index!==null)?this.tilesets[index]:null;},getTilesetIndex:function(name)
        {return this.getIndex(this.tilesets,name);},hasTileAt:function(tileX,tileY,layer)
        {layer=this.getLayer(layer);if(layer===null){return null;}
            return TilemapComponents.HasTileAt(tileX,tileY,layer);},hasTileAtWorldXY:function(worldX,worldY,camera,layer)
        {layer=this.getLayer(layer);if(layer===null){return null;}
            return TilemapComponents.HasTileAtWorldXY(worldX,worldY,camera,layer);},layer:{get:function()
            {return this.layers[this.currentLayerIndex];},set:function(layer)
            {this.setLayer(layer);}},putTileAt:function(tile,tileX,tileY,recalculateFaces,layer)
        {layer=this.getLayer(layer);if(this._isStaticCall(layer,'putTileAt')){return null;}
            if(layer===null){return null;}
            return TilemapComponents.PutTileAt(tile,tileX,tileY,recalculateFaces,layer);},putTileAtWorldXY:function(tile,worldX,worldY,recalculateFaces,camera,layer)
        {layer=this.getLayer(layer);if(this._isStaticCall(layer,'putTileAtWorldXY')){return null;}
            if(layer===null){return null;}
            return TilemapComponents.PutTileAtWorldXY(tile,worldX,worldY,recalculateFaces,camera,layer);},putTilesAt:function(tilesArray,tileX,tileY,recalculateFaces,layer)
        {layer=this.getLayer(layer);if(this._isStaticCall(layer,'putTilesAt')){return this;}
            if(layer!==null)
            {TilemapComponents.PutTilesAt(tilesArray,tileX,tileY,recalculateFaces,layer);}
            return this;},randomize:function(tileX,tileY,width,height,indexes,layer)
        {layer=this.getLayer(layer);if(this._isStaticCall(layer,'randomize')){return this;}
            if(layer!==null)
            {TilemapComponents.Randomize(tileX,tileY,width,height,indexes,layer);}
            return this;},calculateFacesAt:function(tileX,tileY,layer)
        {layer=this.getLayer(layer);if(layer===null){return this;}
            TilemapComponents.CalculateFacesAt(tileX,tileY,layer);return this;},calculateFacesWithin:function(tileX,tileY,width,height,layer)
        {layer=this.getLayer(layer);if(layer===null){return this;}
            TilemapComponents.CalculateFacesWithin(tileX,tileY,width,height,layer);return this;},removeAllLayers:function()
        {for(var i=0;i<this.layers.length;i++)
        {if(this.layers[i].tilemapLayer)
        {this.layers[i].tilemapLayer.destroy();}}
            this.layers.length=0;this.currentLayerIndex=0;return this;},removeTileAt:function(tileX,tileY,replaceWithNull,recalculateFaces,layer)
        {layer=this.getLayer(layer);if(this._isStaticCall(layer,'removeTileAt')){return null;}
            if(layer===null){return null;}
            return TilemapComponents.RemoveTileAt(tileX,tileY,replaceWithNull,recalculateFaces,layer);},removeTileAtWorldXY:function(worldX,worldY,replaceWithNull,recalculateFaces,camera,layer)
        {layer=this.getLayer(layer);if(this._isStaticCall(layer,'removeTileAtWorldXY')){return null;}
            if(layer===null){return null;}
            return TilemapComponents.RemoveTileAtWorldXY(worldX,worldY,replaceWithNull,recalculateFaces,camera,layer);},renderDebug:function(graphics,styleConfig,layer)
        {layer=this.getLayer(layer);if(layer===null){return this;}
            TilemapComponents.RenderDebug(graphics,styleConfig,layer);return this;},replaceByIndex:function(findIndex,newIndex,tileX,tileY,width,height,layer)
        {layer=this.getLayer(layer);if(this._isStaticCall(layer,'replaceByIndex')){return this;}
            if(layer!==null)
            {TilemapComponents.ReplaceByIndex(findIndex,newIndex,tileX,tileY,width,height,layer);}
            return this;},setCollision:function(indexes,collides,recalculateFaces,layer)
        {layer=this.getLayer(layer);if(layer===null){return this;}
            TilemapComponents.SetCollision(indexes,collides,recalculateFaces,layer);return this;},setCollisionBetween:function(start,stop,collides,recalculateFaces,layer)
        {layer=this.getLayer(layer);if(layer===null){return this;}
            TilemapComponents.SetCollisionBetween(start,stop,collides,recalculateFaces,layer);return this;},setCollisionByProperty:function(properties,collides,recalculateFaces,layer)
        {layer=this.getLayer(layer);if(layer===null){return this;}
            TilemapComponents.SetCollisionByProperty(properties,collides,recalculateFaces,layer);return this;},setCollisionByExclusion:function(indexes,collides,recalculateFaces,layer)
        {layer=this.getLayer(layer);if(layer===null){return this;}
            TilemapComponents.SetCollisionByExclusion(indexes,collides,recalculateFaces,layer);return this;},setCollisionFromCollisionGroup:function(collides,recalculateFaces,layer)
        {layer=this.getLayer(layer);if(layer===null){return this;}
            TilemapComponents.SetCollisionFromCollisionGroup(collides,recalculateFaces,layer);return this;},setTileIndexCallback:function(indexes,callback,callbackContext,layer)
        {layer=this.getLayer(layer);if(layer===null){return this;}
            TilemapComponents.SetTileIndexCallback(indexes,callback,callbackContext,layer);return this;},setTileLocationCallback:function(tileX,tileY,width,height,callback,callbackContext,layer)
        {layer=this.getLayer(layer);if(layer===null){return this;}
            TilemapComponents.SetTileLocationCallback(tileX,tileY,width,height,callback,callbackContext,layer);return this;},setLayer:function(layer)
        {var index=this.getLayerIndex(layer);if(index!==null)
        {this.currentLayerIndex=index;}
            return this;},setBaseTileSize:function(tileWidth,tileHeight)
        {this.tileWidth=tileWidth;this.tileHeight=tileHeight;this.widthInPixels=this.width*tileWidth;this.heightInPixels=this.height*tileHeight;for(var i=0;i<this.layers.length;i++)
        {this.layers[i].baseTileWidth=tileWidth;this.layers[i].baseTileHeight=tileHeight;var mapData=this.layers[i].data;var mapWidth=this.layers[i].width;var mapHeight=this.layers[i].height;for(var row=0;row<mapHeight;row++)
        {for(var col=0;col<mapWidth;col++)
        {var tile=mapData[row][col];if(tile!==null)
        {tile.setSize(undefined,undefined,tileWidth,tileHeight);}}}}
            return this;},setLayerTileSize:function(tileWidth,tileHeight,layer)
        {layer=this.getLayer(layer);if(layer===null){return this;}
            layer.tileWidth=tileWidth;layer.tileHeight=tileHeight;var mapData=layer.data;var mapWidth=layer.width;var mapHeight=layer.height;for(var row=0;row<mapHeight;row++)
        {for(var col=0;col<mapWidth;col++)
        {var tile=mapData[row][col];if(tile!==null)
        {tile.setSize(tileWidth,tileHeight);}}}
            return this;},shuffle:function(tileX,tileY,width,height,layer)
        {layer=this.getLayer(layer);if(this._isStaticCall(layer,'shuffle')){return this;}
            if(layer!==null)
            {TilemapComponents.Shuffle(tileX,tileY,width,height,layer);}
            return this;},swapByIndex:function(indexA,indexB,tileX,tileY,width,height,layer)
        {layer=this.getLayer(layer);if(this._isStaticCall(layer,'swapByIndex')){return this;}
            if(layer!==null)
            {TilemapComponents.SwapByIndex(indexA,indexB,tileX,tileY,width,height,layer);}
            return this;},tileToWorldX:function(tileX,camera,layer)
        {layer=this.getLayer(layer);if(layer===null){return null;}
            return TilemapComponents.TileToWorldX(tileX,camera,layer);},tileToWorldY:function(tileX,camera,layer)
        {layer=this.getLayer(layer);if(layer===null){return null;}
            return TilemapComponents.TileToWorldY(tileX,camera,layer);},tileToWorldXY:function(tileX,tileY,point,camera,layer)
        {layer=this.getLayer(layer);if(layer===null){return null;}
            return TilemapComponents.TileToWorldXY(tileX,tileY,point,camera,layer);},weightedRandomize:function(tileX,tileY,width,height,weightedIndexes,layer)
        {layer=this.getLayer(layer);if(this._isStaticCall(layer,'weightedRandomize')){return this;}
            if(layer!==null)
            {TilemapComponents.WeightedRandomize(tileX,tileY,width,height,weightedIndexes,layer);}
            return this;},worldToTileX:function(worldX,snapToFloor,camera,layer)
        {layer=this.getLayer(layer);if(layer===null){return null;}
            return TilemapComponents.WorldToTileX(worldX,snapToFloor,camera,layer);},worldToTileY:function(worldY,snapToFloor,camera,layer)
        {layer=this.getLayer(layer);if(layer===null){return null;}
            return TilemapComponents.WorldToTileY(worldY,snapToFloor,camera,layer);},worldToTileXY:function(worldX,worldY,snapToFloor,point,camera,layer)
        {layer=this.getLayer(layer);if(layer===null){return null;}
            return TilemapComponents.WorldToTileXY(worldX,worldY,snapToFloor,point,camera,layer);},_isStaticCall:function(layer,functionName)
        {if(layer.tilemapLayer instanceof StaticTilemapLayer)
        {console.warn(functionName+': You cannot change the tiles in a static tilemap layer');return true;}
        else
        {return false;}}});module.exports=Tilemap;}),"./tilemaps/TilemapCreator.js":(function(module,exports,__webpack_require__){var GameObjectCreator=__webpack_require__("./gameobjects/GameObjectCreator.js");var ParseToTilemap=__webpack_require__("./tilemaps/ParseToTilemap.js");GameObjectCreator.register('tilemap',function(config)
    {var c=(config!==undefined)?config:{};return ParseToTilemap(this.scene,c.key,c.tileWidth,c.tileHeight,c.width,c.height,c.data,c.insertNull);});}),"./tilemaps/TilemapFactory.js":(function(module,exports,__webpack_require__){var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");var ParseToTilemap=__webpack_require__("./tilemaps/ParseToTilemap.js");GameObjectFactory.register('tilemap',function(key,tileWidth,tileHeight,width,height,data,insertNull)
    {if(key===null){key=undefined;}
        if(tileWidth===null){tileWidth=undefined;}
        if(tileHeight===null){tileHeight=undefined;}
        if(width===null){width=undefined;}
        if(height===null){height=undefined;}
        return ParseToTilemap(this.scene,key,tileWidth,tileHeight,width,height,data,insertNull);});}),"./tilemaps/Tileset.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Tileset=new Class({initialize:function Tileset(name,firstgid,tileWidth,tileHeight,tileMargin,tileSpacing,tileProperties,tileData)
        {if(tileWidth===undefined||tileWidth<=0){tileWidth=32;}
            if(tileHeight===undefined||tileHeight<=0){tileHeight=32;}
            if(tileMargin===undefined){tileMargin=0;}
            if(tileSpacing===undefined){tileSpacing=0;}
            if(tileProperties===undefined){tileProperties={};}
            if(tileData===undefined){tileData={};}
            this.name=name;this.firstgid=firstgid;this.tileWidth=tileWidth;this.tileHeight=tileHeight;this.tileMargin=tileMargin;this.tileSpacing=tileSpacing;this.tileProperties=tileProperties;this.tileData=tileData;this.image=null;this.glTexture=null;this.rows=0;this.columns=0;this.total=0;this.texCoordinates=[];},getTileProperties:function(tileIndex)
        {if(!this.containsTileIndex(tileIndex)){return null;}
            return this.tileProperties[tileIndex-this.firstgid];},getTileData:function(tileIndex)
        {if(!this.containsTileIndex(tileIndex)){return null;}
            return this.tileData[tileIndex-this.firstgid];},getTileCollisionGroup:function(tileIndex)
        {var data=this.getTileData(tileIndex);return(data&&data.objectgroup)?data.objectgroup:null;},containsTileIndex:function(tileIndex)
        {return(tileIndex>=this.firstgid&&tileIndex<(this.firstgid+this.total));},getTileTextureCoordinates:function(tileIndex)
        {if(!this.containsTileIndex(tileIndex)){return null;}
            return this.texCoordinates[tileIndex-this.firstgid];},setImage:function(texture)
        {this.image=texture;this.glTexture=texture.get().source.glTexture;this.updateTileData(this.image.source[0].width,this.image.source[0].height);return this;},setTileSize:function(tileWidth,tileHeight)
        {if(tileWidth!==undefined){this.tileWidth=tileWidth;}
            if(tileHeight!==undefined){this.tileHeight=tileHeight;}
            if(this.image)
            {this.updateTileData(this.image.source[0].width,this.image.source[0].height);}
            return this;},setSpacing:function(margin,spacing)
        {if(margin!==undefined){this.tileMargin=margin;}
            if(spacing!==undefined){this.tileSpacing=spacing;}
            if(this.image)
            {this.updateTileData(this.image.source[0].width,this.image.source[0].height);}
            return this;},updateTileData:function(imageWidth,imageHeight)
        {var rowCount=(imageHeight-this.tileMargin*2+this.tileSpacing)/(this.tileHeight+this.tileSpacing);var colCount=(imageWidth-this.tileMargin*2+this.tileSpacing)/(this.tileWidth+this.tileSpacing);if(rowCount%1!==0||colCount%1!==0)
        {console.warn('Image tile area not tile size multiple in: '+this.name);}
            rowCount=Math.floor(rowCount);colCount=Math.floor(colCount);this.rows=rowCount;this.columns=colCount;this.total=rowCount*colCount;this.texCoordinates.length=0;var tx=this.tileMargin;var ty=this.tileMargin;for(var y=0;y<this.rows;y++)
        {for(var x=0;x<this.columns;x++)
        {this.texCoordinates.push({x:tx,y:ty});tx+=this.tileWidth+this.tileSpacing;}
            tx=this.tileMargin;ty+=this.tileHeight+this.tileSpacing;}
            return this;}});module.exports=Tileset;}),"./tilemaps/components/CalculateFacesAt.js":(function(module,exports,__webpack_require__){var GetTileAt=__webpack_require__("./tilemaps/components/GetTileAt.js");var CalculateFacesAt=function(tileX,tileY,layer)
    {var tile=GetTileAt(tileX,tileY,true,layer);var above=GetTileAt(tileX,tileY-1,true,layer);var below=GetTileAt(tileX,tileY+1,true,layer);var left=GetTileAt(tileX-1,tileY,true,layer);var right=GetTileAt(tileX+1,tileY,true,layer);var tileCollides=tile&&tile.collides;if(tileCollides)
    {tile.faceTop=true;tile.faceBottom=true;tile.faceLeft=true;tile.faceRight=true;}
        if(above&&above.collides)
        {if(tileCollides){tile.faceTop=false;}
            above.faceBottom=!tileCollides;}
        if(below&&below.collides)
        {if(tileCollides){tile.faceBottom=false;}
            below.faceTop=!tileCollides;}
        if(left&&left.collides)
        {if(tileCollides){tile.faceLeft=false;}
            left.faceRight=!tileCollides;}
        if(right&&right.collides)
        {if(tileCollides){tile.faceRight=false;}
            right.faceLeft=!tileCollides;}
        if(tile&&!tile.collides){tile.resetFaces();}
        return tile;};module.exports=CalculateFacesAt;}),"./tilemaps/components/CalculateFacesWithin.js":(function(module,exports,__webpack_require__){var GetTileAt=__webpack_require__("./tilemaps/components/GetTileAt.js");var GetTilesWithin=__webpack_require__("./tilemaps/components/GetTilesWithin.js");var CalculateFacesWithin=function(tileX,tileY,width,height,layer)
    {var above=null;var below=null;var left=null;var right=null;var tiles=GetTilesWithin(tileX,tileY,width,height,null,layer);for(var i=0;i<tiles.length;i++)
    {var tile=tiles[i];if(tile)
    {if(tile.collides)
    {above=GetTileAt(tile.x,tile.y-1,true,layer);below=GetTileAt(tile.x,tile.y+1,true,layer);left=GetTileAt(tile.x-1,tile.y,true,layer);right=GetTileAt(tile.x+1,tile.y,true,layer);tile.faceTop=(above&&above.collides)?false:true;tile.faceBottom=(below&&below.collides)?false:true;tile.faceLeft=(left&&left.collides)?false:true;tile.faceRight=(right&&right.collides)?false:true;}
    else
    {tile.resetFaces();}}}};module.exports=CalculateFacesWithin;}),"./tilemaps/components/Copy.js":(function(module,exports,__webpack_require__){var GetTilesWithin=__webpack_require__("./tilemaps/components/GetTilesWithin.js");var CalculateFacesWithin=__webpack_require__("./tilemaps/components/CalculateFacesWithin.js");var Copy=function(srcTileX,srcTileY,width,height,destTileX,destTileY,recalculateFaces,layer)
    {if(srcTileX<0){srcTileX=0;}
        if(srcTileY<0){srcTileY=0;}
        if(recalculateFaces===undefined){recalculateFaces=true;}
        var srcTiles=GetTilesWithin(srcTileX,srcTileY,width,height,null,layer);var offsetX=destTileX-srcTileX;var offsetY=destTileY-srcTileY;for(var i=0;i<srcTiles.length;i++)
    {var tileX=srcTiles[i].x+offsetX;var tileY=srcTiles[i].y+offsetY;if(tileX>=0&&tileX<layer.width&&tileY>=0&&tileY<layer.height)
    {if(layer.data[tileY][tileX])
    {layer.data[tileY][tileX].copy(srcTiles[i]);}}}
        if(recalculateFaces)
        {CalculateFacesWithin(destTileX-1,destTileY-1,width+2,height+2,layer);}};module.exports=Copy;}),"./tilemaps/components/CreateFromTiles.js":(function(module,exports,__webpack_require__){var TileToWorldX=__webpack_require__("./tilemaps/components/TileToWorldX.js");var TileToWorldY=__webpack_require__("./tilemaps/components/TileToWorldY.js");var GetTilesWithin=__webpack_require__("./tilemaps/components/GetTilesWithin.js");var ReplaceByIndex=__webpack_require__("./tilemaps/components/ReplaceByIndex.js");var CreateFromTiles=function(indexes,replacements,spriteConfig,scene,camera,layer)
    {if(spriteConfig===undefined){spriteConfig={};}
        if(!Array.isArray(indexes)){indexes=[indexes];}
        var tilemapLayer=layer.tilemapLayer;if(scene===undefined){scene=tilemapLayer.scene;}
        if(camera===undefined){camera=scene.cameras.main;}
        var tiles=GetTilesWithin(0,0,layer.width,layer.height,null,layer);var sprites=[];var i;for(i=0;i<tiles.length;i++)
    {var tile=tiles[i];if(indexes.indexOf(tile.index)!==-1)
    {spriteConfig.x=TileToWorldX(tile.x,camera,layer);spriteConfig.y=TileToWorldY(tile.y,camera,layer);var sprite=scene.make.sprite(spriteConfig);sprites.push(sprite);}}
        if(typeof replacements==='number')
        {for(i=0;i<indexes.length;i++)
        {ReplaceByIndex(indexes[i],replacements,0,0,layer.width,layer.height,layer);}}
        else if(Array.isArray(replacements))
        {for(i=0;i<indexes.length;i++)
        {ReplaceByIndex(indexes[i],replacements[i],0,0,layer.width,layer.height,layer);}}
        return sprites;};module.exports=CreateFromTiles;}),"./tilemaps/components/CullTiles.js":(function(module,exports,__webpack_require__){var SnapFloor=__webpack_require__("./math/snap/SnapFloor.js");var SnapCeil=__webpack_require__("./math/snap/SnapCeil.js");var CullTiles=function(layer,camera,outputArray,renderOrder)
    {if(outputArray===undefined){outputArray=[];}
        if(renderOrder===undefined){renderOrder=0;}
        outputArray.length=0;var tilemap=layer.tilemapLayer.tilemap;var tilemapLayer=layer.tilemapLayer;var mapData=layer.data;var mapWidth=layer.width;var mapHeight=layer.height;var tileW=Math.floor(tilemap.tileWidth*tilemapLayer.scaleX);var tileH=Math.floor(tilemap.tileHeight*tilemapLayer.scaleY);var drawLeft=0;var drawRight=mapWidth;var drawTop=0;var drawBottom=mapHeight;if(!tilemapLayer.skipCull&&tilemapLayer.scrollFactorX===1&&tilemapLayer.scrollFactorY===1)
    {var boundsLeft=SnapFloor(camera.worldView.x-tilemapLayer.x,tileW,0,true)-tilemapLayer.cullPaddingX;var boundsRight=SnapCeil(camera.worldView.right-tilemapLayer.x,tileW,0,true)+tilemapLayer.cullPaddingX;var boundsTop=SnapFloor(camera.worldView.y-tilemapLayer.y,tileH,0,true)-tilemapLayer.cullPaddingY;var boundsBottom=SnapCeil(camera.worldView.bottom-tilemapLayer.y,tileH,0,true)+tilemapLayer.cullPaddingY;drawLeft=Math.max(0,boundsLeft);drawRight=Math.min(mapWidth,boundsRight);drawTop=Math.max(0,boundsTop);drawBottom=Math.min(mapHeight,boundsBottom);}
        var x;var y;var tile;if(renderOrder===0)
    {for(y=drawTop;y<drawBottom;y++)
    {for(x=drawLeft;mapData[y]&&x<drawRight;x++)
    {tile=mapData[y][x];if(!tile||tile.index===-1||!tile.visible||tile.alpha===0)
    {continue;}
        outputArray.push(tile);}}}
    else if(renderOrder===1)
    {for(y=drawTop;y<drawBottom;y++)
    {for(x=drawRight;mapData[y]&&x>=drawLeft;x--)
    {tile=mapData[y][x];if(!tile||tile.index===-1||!tile.visible||tile.alpha===0)
    {continue;}
        outputArray.push(tile);}}}
    else if(renderOrder===2)
    {for(y=drawBottom;y>=drawTop;y--)
    {for(x=drawLeft;mapData[y]&&x<drawRight;x++)
    {tile=mapData[y][x];if(!tile||tile.index===-1||!tile.visible||tile.alpha===0)
    {continue;}
        outputArray.push(tile);}}}
    else if(renderOrder===3)
    {for(y=drawBottom;y>=drawTop;y--)
    {for(x=drawRight;mapData[y]&&x>=drawLeft;x--)
    {tile=mapData[y][x];if(!tile||tile.index===-1||!tile.visible||tile.alpha===0)
    {continue;}
        outputArray.push(tile);}}}
        tilemapLayer.tilesDrawn=outputArray.length;tilemapLayer.tilesTotal=mapWidth*mapHeight;return outputArray;};module.exports=CullTiles;}),"./tilemaps/components/Fill.js":(function(module,exports,__webpack_require__){var GetTilesWithin=__webpack_require__("./tilemaps/components/GetTilesWithin.js");var CalculateFacesWithin=__webpack_require__("./tilemaps/components/CalculateFacesWithin.js");var SetTileCollision=__webpack_require__("./tilemaps/components/SetTileCollision.js");var Fill=function(index,tileX,tileY,width,height,recalculateFaces,layer)
    {var doesIndexCollide=(layer.collideIndexes.indexOf(index)!==-1);var tiles=GetTilesWithin(tileX,tileY,width,height,null,layer);for(var i=0;i<tiles.length;i++)
    {tiles[i].index=index;SetTileCollision(tiles[i],doesIndexCollide);}
        if(recalculateFaces)
        {CalculateFacesWithin(tileX-1,tileY-1,width+2,height+2,layer);}};module.exports=Fill;}),"./tilemaps/components/FilterTiles.js":(function(module,exports,__webpack_require__){var GetTilesWithin=__webpack_require__("./tilemaps/components/GetTilesWithin.js");var FilterTiles=function(callback,context,tileX,tileY,width,height,filteringOptions,layer)
    {var tiles=GetTilesWithin(tileX,tileY,width,height,filteringOptions,layer);return tiles.filter(callback,context);};module.exports=FilterTiles;}),"./tilemaps/components/FindByIndex.js":(function(module,exports){var FindByIndex=function(findIndex,skip,reverse,layer)
    {if(skip===undefined){skip=0;}
        if(reverse===undefined){reverse=false;}
        var count=0;var tx;var ty;var tile;if(reverse)
    {for(ty=layer.height-1;ty>=0;ty--)
    {for(tx=layer.width-1;tx>=0;tx--)
    {tile=layer.data[ty][tx];if(tile&&tile.index===findIndex)
    {if(count===skip)
    {return tile;}
    else
    {count+=1;}}}}}
    else
    {for(ty=0;ty<layer.height;ty++)
    {for(tx=0;tx<layer.width;tx++)
    {tile=layer.data[ty][tx];if(tile&&tile.index===findIndex)
    {if(count===skip)
    {return tile;}
    else
    {count+=1;}}}}}
        return null;};module.exports=FindByIndex;}),"./tilemaps/components/FindTile.js":(function(module,exports,__webpack_require__){var GetTilesWithin=__webpack_require__("./tilemaps/components/GetTilesWithin.js");var FindTile=function(callback,context,tileX,tileY,width,height,filteringOptions,layer)
    {var tiles=GetTilesWithin(tileX,tileY,width,height,filteringOptions,layer);return tiles.find(callback,context)||null;};module.exports=FindTile;}),"./tilemaps/components/ForEachTile.js":(function(module,exports,__webpack_require__){var GetTilesWithin=__webpack_require__("./tilemaps/components/GetTilesWithin.js");var ForEachTile=function(callback,context,tileX,tileY,width,height,filteringOptions,layer)
    {var tiles=GetTilesWithin(tileX,tileY,width,height,filteringOptions,layer);tiles.forEach(callback,context);};module.exports=ForEachTile;}),"./tilemaps/components/GetTileAt.js":(function(module,exports,__webpack_require__){var IsInLayerBounds=__webpack_require__("./tilemaps/components/IsInLayerBounds.js");var GetTileAt=function(tileX,tileY,nonNull,layer)
    {if(nonNull===undefined){nonNull=false;}
        if(IsInLayerBounds(tileX,tileY,layer))
        {var tile=layer.data[tileY][tileX]||null;if(tile===null)
        {return null;}
        else if(tile.index===-1)
        {return nonNull?tile:null;}
        else
        {return tile;}}
        else
        {return null;}};module.exports=GetTileAt;}),"./tilemaps/components/GetTileAtWorldXY.js":(function(module,exports,__webpack_require__){var GetTileAt=__webpack_require__("./tilemaps/components/GetTileAt.js");var WorldToTileX=__webpack_require__("./tilemaps/components/WorldToTileX.js");var WorldToTileY=__webpack_require__("./tilemaps/components/WorldToTileY.js");var GetTileAtWorldXY=function(worldX,worldY,nonNull,camera,layer)
    {var tileX=WorldToTileX(worldX,true,camera,layer);var tileY=WorldToTileY(worldY,true,camera,layer);return GetTileAt(tileX,tileY,nonNull,layer);};module.exports=GetTileAtWorldXY;}),"./tilemaps/components/GetTilesWithin.js":(function(module,exports,__webpack_require__){var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var GetTilesWithin=function(tileX,tileY,width,height,filteringOptions,layer)
    {if(tileX===undefined){tileX=0;}
        if(tileY===undefined){tileY=0;}
        if(width===undefined){width=layer.width;}
        if(height===undefined){height=layer.height;}
        var isNotEmpty=GetFastValue(filteringOptions,'isNotEmpty',false);var isColliding=GetFastValue(filteringOptions,'isColliding',false);var hasInterestingFace=GetFastValue(filteringOptions,'hasInterestingFace',false);if(tileX<0)
    {width+=tileX;tileX=0;}
        if(tileY<0)
        {height+=tileY;tileY=0;}
        if(tileX+width>layer.width)
        {width=Math.max(layer.width-tileX,0);}
        if(tileY+height>layer.height)
        {height=Math.max(layer.height-tileY,0);}
        var results=[];for(var ty=tileY;ty<tileY+height;ty++)
    {for(var tx=tileX;tx<tileX+width;tx++)
    {var tile=layer.data[ty][tx];if(tile!==null)
    {if(isNotEmpty&&tile.index===-1){continue;}
        if(isColliding&&!tile.collides){continue;}
        if(hasInterestingFace&&!tile.hasInterestingFace){continue;}
        results.push(tile);}}}
        return results;};module.exports=GetTilesWithin;}),"./tilemaps/components/GetTilesWithinShape.js":(function(module,exports,__webpack_require__){var Geom=__webpack_require__("./geom/index.js");var GetTilesWithin=__webpack_require__("./tilemaps/components/GetTilesWithin.js");var Intersects=__webpack_require__("./geom/intersects/index.js");var NOOP=__webpack_require__("./utils/NOOP.js");var TileToWorldX=__webpack_require__("./tilemaps/components/TileToWorldX.js");var TileToWorldY=__webpack_require__("./tilemaps/components/TileToWorldY.js");var WorldToTileX=__webpack_require__("./tilemaps/components/WorldToTileX.js");var WorldToTileY=__webpack_require__("./tilemaps/components/WorldToTileY.js");var TriangleToRectangle=function(triangle,rect)
    {return Intersects.RectangleToTriangle(rect,triangle);};var GetTilesWithinShape=function(shape,filteringOptions,camera,layer)
    {if(shape===undefined){return[];}
        var intersectTest=NOOP;if(shape instanceof Geom.Circle){intersectTest=Intersects.CircleToRectangle;}
    else if(shape instanceof Geom.Rectangle){intersectTest=Intersects.RectangleToRectangle;}
    else if(shape instanceof Geom.Triangle){intersectTest=TriangleToRectangle;}
    else if(shape instanceof Geom.Line){intersectTest=Intersects.LineToRectangle;}
        var xStart=WorldToTileX(shape.left,true,camera,layer);var yStart=WorldToTileY(shape.top,true,camera,layer);var xEnd=Math.ceil(WorldToTileX(shape.right,false,camera,layer));var yEnd=Math.ceil(WorldToTileY(shape.bottom,false,camera,layer));var width=Math.max(xEnd-xStart,1);var height=Math.max(yEnd-yStart,1);var tiles=GetTilesWithin(xStart,yStart,width,height,filteringOptions,layer);var tileWidth=layer.tileWidth;var tileHeight=layer.tileHeight;if(layer.tilemapLayer)
    {tileWidth*=layer.tilemapLayer.scaleX;tileHeight*=layer.tilemapLayer.scaleY;}
        var results=[];var tileRect=new Geom.Rectangle(0,0,tileWidth,tileHeight);for(var i=0;i<tiles.length;i++)
    {var tile=tiles[i];tileRect.x=TileToWorldX(tile.x,camera,layer);tileRect.y=TileToWorldY(tile.y,camera,layer);if(intersectTest(shape,tileRect))
    {results.push(tile);}}
        return results;};module.exports=GetTilesWithinShape;}),"./tilemaps/components/GetTilesWithinWorldXY.js":(function(module,exports,__webpack_require__){var GetTilesWithin=__webpack_require__("./tilemaps/components/GetTilesWithin.js");var WorldToTileX=__webpack_require__("./tilemaps/components/WorldToTileX.js");var WorldToTileY=__webpack_require__("./tilemaps/components/WorldToTileY.js");var GetTilesWithinWorldXY=function(worldX,worldY,width,height,filteringOptions,camera,layer)
    {var xStart=WorldToTileX(worldX,true,camera,layer);var yStart=WorldToTileY(worldY,true,camera,layer);var xEnd=Math.ceil(WorldToTileX(worldX+width,false,camera,layer));var yEnd=Math.ceil(WorldToTileY(worldY+height,false,camera,layer));return GetTilesWithin(xStart,yStart,xEnd-xStart,yEnd-yStart,filteringOptions,layer);};module.exports=GetTilesWithinWorldXY;}),"./tilemaps/components/HasTileAt.js":(function(module,exports,__webpack_require__){var IsInLayerBounds=__webpack_require__("./tilemaps/components/IsInLayerBounds.js");var HasTileAt=function(tileX,tileY,layer)
    {if(IsInLayerBounds(tileX,tileY,layer))
    {var tile=layer.data[tileY][tileX];return(tile!==null&&tile.index>-1);}
    else
    {return false;}};module.exports=HasTileAt;}),"./tilemaps/components/HasTileAtWorldXY.js":(function(module,exports,__webpack_require__){var HasTileAt=__webpack_require__("./tilemaps/components/HasTileAt.js");var WorldToTileX=__webpack_require__("./tilemaps/components/WorldToTileX.js");var WorldToTileY=__webpack_require__("./tilemaps/components/WorldToTileY.js");var HasTileAtWorldXY=function(worldX,worldY,camera,layer)
    {var tileX=WorldToTileX(worldX,true,camera,layer);var tileY=WorldToTileY(worldY,true,camera,layer);return HasTileAt(tileX,tileY,layer);};module.exports=HasTileAtWorldXY;}),"./tilemaps/components/IsInLayerBounds.js":(function(module,exports){var IsInLayerBounds=function(tileX,tileY,layer)
    {return(tileX>=0&&tileX<layer.width&&tileY>=0&&tileY<layer.height);};module.exports=IsInLayerBounds;}),"./tilemaps/components/PutTileAt.js":(function(module,exports,__webpack_require__){var Tile=__webpack_require__("./tilemaps/Tile.js");var IsInLayerBounds=__webpack_require__("./tilemaps/components/IsInLayerBounds.js");var CalculateFacesAt=__webpack_require__("./tilemaps/components/CalculateFacesAt.js");var SetTileCollision=__webpack_require__("./tilemaps/components/SetTileCollision.js");var PutTileAt=function(tile,tileX,tileY,recalculateFaces,layer)
    {if(!IsInLayerBounds(tileX,tileY,layer)){return null;}
        if(recalculateFaces===undefined){recalculateFaces=true;}
        var oldTile=layer.data[tileY][tileX];var oldTileCollides=oldTile&&oldTile.collides;if(tile instanceof Tile)
    {if(layer.data[tileY][tileX]===null)
    {layer.data[tileY][tileX]=new Tile(layer,tile.index,tileX,tileY,tile.width,tile.height);}
        layer.data[tileY][tileX].copy(tile);}
    else
    {var index=tile;if(layer.data[tileY][tileX]===null)
    {layer.data[tileY][tileX]=new Tile(layer,index,tileX,tileY,layer.tileWidth,layer.tileHeight);}
    else
    {layer.data[tileY][tileX].index=index;}}
        var newTile=layer.data[tileY][tileX];var collides=layer.collideIndexes.indexOf(newTile.index)!==-1;SetTileCollision(newTile,collides);if(recalculateFaces&&(oldTileCollides!==newTile.collides))
    {CalculateFacesAt(tileX,tileY,layer);}
        return newTile;};module.exports=PutTileAt;}),"./tilemaps/components/PutTileAtWorldXY.js":(function(module,exports,__webpack_require__){var PutTileAt=__webpack_require__("./tilemaps/components/PutTileAt.js");var WorldToTileX=__webpack_require__("./tilemaps/components/WorldToTileX.js");var WorldToTileY=__webpack_require__("./tilemaps/components/WorldToTileY.js");var PutTileAtWorldXY=function(tile,worldX,worldY,recalculateFaces,camera,layer)
    {var tileX=WorldToTileX(worldX,true,camera,layer);var tileY=WorldToTileY(worldY,true,camera,layer);return PutTileAt(tile,tileX,tileY,recalculateFaces,layer);};module.exports=PutTileAtWorldXY;}),"./tilemaps/components/PutTilesAt.js":(function(module,exports,__webpack_require__){var CalculateFacesWithin=__webpack_require__("./tilemaps/components/CalculateFacesWithin.js");var PutTileAt=__webpack_require__("./tilemaps/components/PutTileAt.js");var PutTilesAt=function(tilesArray,tileX,tileY,recalculateFaces,layer)
    {if(!Array.isArray(tilesArray)){return null;}
        if(recalculateFaces===undefined){recalculateFaces=true;}
        if(!Array.isArray(tilesArray[0]))
        {tilesArray=[tilesArray];}
        var height=tilesArray.length;var width=tilesArray[0].length;for(var ty=0;ty<height;ty++)
    {for(var tx=0;tx<width;tx++)
    {var tile=tilesArray[ty][tx];PutTileAt(tile,tileX+tx,tileY+ty,false,layer);}}
        if(recalculateFaces)
        {CalculateFacesWithin(tileX-1,tileY-1,width+2,height+2,layer);}};module.exports=PutTilesAt;}),"./tilemaps/components/Randomize.js":(function(module,exports,__webpack_require__){var GetTilesWithin=__webpack_require__("./tilemaps/components/GetTilesWithin.js");var GetRandom=__webpack_require__("./utils/array/GetRandom.js");var Randomize=function(tileX,tileY,width,height,indexes,layer)
    {var i;var tiles=GetTilesWithin(tileX,tileY,width,height,null,layer);if(indexes===undefined)
    {indexes=[];for(i=0;i<tiles.length;i++)
    {if(indexes.indexOf(tiles[i].index)===-1)
    {indexes.push(tiles[i].index);}}}
        for(i=0;i<tiles.length;i++)
        {tiles[i].index=GetRandom(indexes);}};module.exports=Randomize;}),"./tilemaps/components/RemoveTileAt.js":(function(module,exports,__webpack_require__){var Tile=__webpack_require__("./tilemaps/Tile.js");var IsInLayerBounds=__webpack_require__("./tilemaps/components/IsInLayerBounds.js");var CalculateFacesAt=__webpack_require__("./tilemaps/components/CalculateFacesAt.js");var RemoveTileAt=function(tileX,tileY,replaceWithNull,recalculateFaces,layer)
    {if(replaceWithNull===undefined){replaceWithNull=false;}
        if(recalculateFaces===undefined){recalculateFaces=true;}
        if(!IsInLayerBounds(tileX,tileY,layer)){return null;}
        var tile=layer.data[tileY][tileX]||null;if(tile===null)
    {return null;}
    else
    {layer.data[tileY][tileX]=replaceWithNull?null:new Tile(layer,-1,tileX,tileY,tile.width,tile.height);}
        if(recalculateFaces&&tile&&tile.collides)
        {CalculateFacesAt(tileX,tileY,layer);}
        return tile;};module.exports=RemoveTileAt;}),"./tilemaps/components/RemoveTileAtWorldXY.js":(function(module,exports,__webpack_require__){var RemoveTileAt=__webpack_require__("./tilemaps/components/RemoveTileAt.js");var WorldToTileX=__webpack_require__("./tilemaps/components/WorldToTileX.js");var WorldToTileY=__webpack_require__("./tilemaps/components/WorldToTileY.js");var RemoveTileAtWorldXY=function(worldX,worldY,replaceWithNull,recalculateFaces,camera,layer)
    {var tileX=WorldToTileX(worldX,true,camera,layer);var tileY=WorldToTileY(worldY,true,camera,layer);return RemoveTileAt(tileX,tileY,replaceWithNull,recalculateFaces,layer);};module.exports=RemoveTileAtWorldXY;}),"./tilemaps/components/RenderDebug.js":(function(module,exports,__webpack_require__){var GetTilesWithin=__webpack_require__("./tilemaps/components/GetTilesWithin.js");var Color=__webpack_require__("./display/color/index.js");var defaultTileColor=new Color(105,210,231,150);var defaultCollidingTileColor=new Color(243,134,48,200);var defaultFaceColor=new Color(40,39,37,150);var RenderDebug=function(graphics,styleConfig,layer)
    {if(styleConfig===undefined){styleConfig={};}
        var tileColor=(styleConfig.tileColor!==undefined)?styleConfig.tileColor:defaultTileColor;var collidingTileColor=(styleConfig.collidingTileColor!==undefined)?styleConfig.collidingTileColor:defaultCollidingTileColor;var faceColor=(styleConfig.faceColor!==undefined)?styleConfig.faceColor:defaultFaceColor;var tiles=GetTilesWithin(0,0,layer.width,layer.height,null,layer);graphics.translate(layer.tilemapLayer.x,layer.tilemapLayer.y);graphics.scale(layer.tilemapLayer.scaleX,layer.tilemapLayer.scaleY);for(var i=0;i<tiles.length;i++)
    {var tile=tiles[i];var tw=tile.width;var th=tile.height;var x=tile.pixelX;var y=tile.pixelY;var color=tile.collides?collidingTileColor:tileColor;if(color!==null)
    {graphics.fillStyle(color.color,color.alpha / 255);graphics.fillRect(x,y,tw,th);}
        x+=1;y+=1;tw-=2;th-=2;if(faceColor!==null)
    {graphics.lineStyle(1,faceColor.color,faceColor.alpha / 255);if(tile.faceTop){graphics.lineBetween(x,y,x+tw,y);}
        if(tile.faceRight){graphics.lineBetween(x+tw,y,x+tw,y+th);}
        if(tile.faceBottom){graphics.lineBetween(x,y+th,x+tw,y+th);}
        if(tile.faceLeft){graphics.lineBetween(x,y,x,y+th);}}}};module.exports=RenderDebug;}),"./tilemaps/components/ReplaceByIndex.js":(function(module,exports,__webpack_require__){var GetTilesWithin=__webpack_require__("./tilemaps/components/GetTilesWithin.js");var ReplaceByIndex=function(findIndex,newIndex,tileX,tileY,width,height,layer)
    {var tiles=GetTilesWithin(tileX,tileY,width,height,null,layer);for(var i=0;i<tiles.length;i++)
    {if(tiles[i]&&tiles[i].index===findIndex)
    {tiles[i].index=newIndex;}}};module.exports=ReplaceByIndex;}),"./tilemaps/components/SetCollision.js":(function(module,exports,__webpack_require__){var SetTileCollision=__webpack_require__("./tilemaps/components/SetTileCollision.js");var CalculateFacesWithin=__webpack_require__("./tilemaps/components/CalculateFacesWithin.js");var SetLayerCollisionIndex=__webpack_require__("./tilemaps/components/SetLayerCollisionIndex.js");var SetCollision=function(indexes,collides,recalculateFaces,layer)
    {if(collides===undefined){collides=true;}
        if(recalculateFaces===undefined){recalculateFaces=true;}
        if(!Array.isArray(indexes)){indexes=[indexes];}
        for(var i=0;i<indexes.length;i++)
        {SetLayerCollisionIndex(indexes[i],collides,layer);}
        for(var ty=0;ty<layer.height;ty++)
        {for(var tx=0;tx<layer.width;tx++)
        {var tile=layer.data[ty][tx];if(tile&&indexes.indexOf(tile.index)!==-1)
        {SetTileCollision(tile,collides);}}}
        if(recalculateFaces)
        {CalculateFacesWithin(0,0,layer.width,layer.height,layer);}};module.exports=SetCollision;}),"./tilemaps/components/SetCollisionBetween.js":(function(module,exports,__webpack_require__){var SetTileCollision=__webpack_require__("./tilemaps/components/SetTileCollision.js");var CalculateFacesWithin=__webpack_require__("./tilemaps/components/CalculateFacesWithin.js");var SetLayerCollisionIndex=__webpack_require__("./tilemaps/components/SetLayerCollisionIndex.js");var SetCollisionBetween=function(start,stop,collides,recalculateFaces,layer)
    {if(collides===undefined){collides=true;}
        if(recalculateFaces===undefined){recalculateFaces=true;}
        if(start>stop){return;}
        for(var index=start;index<=stop;index++)
        {SetLayerCollisionIndex(index,collides,layer);}
        for(var ty=0;ty<layer.height;ty++)
        {for(var tx=0;tx<layer.width;tx++)
        {var tile=layer.data[ty][tx];if(tile)
        {if(tile.index>=start&&tile.index<=stop)
        {SetTileCollision(tile,collides);}}}}
        if(recalculateFaces)
        {CalculateFacesWithin(0,0,layer.width,layer.height,layer);}};module.exports=SetCollisionBetween;}),"./tilemaps/components/SetCollisionByExclusion.js":(function(module,exports,__webpack_require__){var SetTileCollision=__webpack_require__("./tilemaps/components/SetTileCollision.js");var CalculateFacesWithin=__webpack_require__("./tilemaps/components/CalculateFacesWithin.js");var SetLayerCollisionIndex=__webpack_require__("./tilemaps/components/SetLayerCollisionIndex.js");var SetCollisionByExclusion=function(indexes,collides,recalculateFaces,layer)
    {if(collides===undefined){collides=true;}
        if(recalculateFaces===undefined){recalculateFaces=true;}
        if(!Array.isArray(indexes)){indexes=[indexes];}
        for(var ty=0;ty<layer.height;ty++)
        {for(var tx=0;tx<layer.width;tx++)
        {var tile=layer.data[ty][tx];if(tile&&indexes.indexOf(tile.index)===-1)
        {SetTileCollision(tile,collides);SetLayerCollisionIndex(tile.index,collides,layer);}}}
        if(recalculateFaces)
        {CalculateFacesWithin(0,0,layer.width,layer.height,layer);}};module.exports=SetCollisionByExclusion;}),"./tilemaps/components/SetCollisionByProperty.js":(function(module,exports,__webpack_require__){var SetTileCollision=__webpack_require__("./tilemaps/components/SetTileCollision.js");var CalculateFacesWithin=__webpack_require__("./tilemaps/components/CalculateFacesWithin.js");var HasValue=__webpack_require__("./utils/object/HasValue.js");var SetCollisionByProperty=function(properties,collides,recalculateFaces,layer)
    {if(collides===undefined){collides=true;}
        if(recalculateFaces===undefined){recalculateFaces=true;}
        for(var ty=0;ty<layer.height;ty++)
        {for(var tx=0;tx<layer.width;tx++)
        {var tile=layer.data[ty][tx];if(!tile){continue;}
            for(var property in properties)
            {if(!HasValue(tile.properties,property)){continue;}
                var values=properties[property];if(!Array.isArray(values))
            {values=[values];}
                for(var i=0;i<values.length;i++)
                {if(tile.properties[property]===values[i])
                {SetTileCollision(tile,collides);}}}}}
        if(recalculateFaces)
        {CalculateFacesWithin(0,0,layer.width,layer.height,layer);}};module.exports=SetCollisionByProperty;}),"./tilemaps/components/SetCollisionFromCollisionGroup.js":(function(module,exports,__webpack_require__){var SetTileCollision=__webpack_require__("./tilemaps/components/SetTileCollision.js");var CalculateFacesWithin=__webpack_require__("./tilemaps/components/CalculateFacesWithin.js");var SetCollisionFromCollisionGroup=function(collides,recalculateFaces,layer)
    {if(collides===undefined){collides=true;}
        if(recalculateFaces===undefined){recalculateFaces=true;}
        for(var ty=0;ty<layer.height;ty++)
        {for(var tx=0;tx<layer.width;tx++)
        {var tile=layer.data[ty][tx];if(!tile){continue;}
            var collisionGroup=tile.getCollisionGroup();if(collisionGroup&&collisionGroup.objects&&collisionGroup.objects.length>0)
        {SetTileCollision(tile,collides);}}}
        if(recalculateFaces)
        {CalculateFacesWithin(0,0,layer.width,layer.height,layer);}};module.exports=SetCollisionFromCollisionGroup;}),"./tilemaps/components/SetLayerCollisionIndex.js":(function(module,exports){var SetLayerCollisionIndex=function(tileIndex,collides,layer)
    {var loc=layer.collideIndexes.indexOf(tileIndex);if(collides&&loc===-1)
    {layer.collideIndexes.push(tileIndex);}
    else if(!collides&&loc!==-1)
    {layer.collideIndexes.splice(loc,1);}};module.exports=SetLayerCollisionIndex;}),"./tilemaps/components/SetTileCollision.js":(function(module,exports){var SetTileCollision=function(tile,collides)
    {if(collides)
    {tile.setCollision(true,true,true,true,false);}
    else
    {tile.resetCollision(false);}};module.exports=SetTileCollision;}),"./tilemaps/components/SetTileIndexCallback.js":(function(module,exports){var SetTileIndexCallback=function(indexes,callback,callbackContext,layer)
    {if(typeof indexes==='number')
    {layer.callbacks[indexes]=(callback!==null)?{callback:callback,callbackContext:callbackContext}:undefined;}
    else
    {for(var i=0,len=indexes.length;i<len;i++)
    {layer.callbacks[indexes[i]]=(callback!==null)?{callback:callback,callbackContext:callbackContext}:undefined;}}};module.exports=SetTileIndexCallback;}),"./tilemaps/components/SetTileLocationCallback.js":(function(module,exports,__webpack_require__){var GetTilesWithin=__webpack_require__("./tilemaps/components/GetTilesWithin.js");var SetTileLocationCallback=function(tileX,tileY,width,height,callback,callbackContext,layer)
    {var tiles=GetTilesWithin(tileX,tileY,width,height,null,layer);for(var i=0;i<tiles.length;i++)
    {tiles[i].setCollisionCallback(callback,callbackContext);}};module.exports=SetTileLocationCallback;}),"./tilemaps/components/Shuffle.js":(function(module,exports,__webpack_require__){var GetTilesWithin=__webpack_require__("./tilemaps/components/GetTilesWithin.js");var ShuffleArray=__webpack_require__("./utils/array/Shuffle.js");var Shuffle=function(tileX,tileY,width,height,layer)
    {var tiles=GetTilesWithin(tileX,tileY,width,height,null,layer);var indexes=tiles.map(function(tile){return tile.index;});ShuffleArray(indexes);for(var i=0;i<tiles.length;i++)
    {tiles[i].index=indexes[i];}};module.exports=Shuffle;}),"./tilemaps/components/SwapByIndex.js":(function(module,exports,__webpack_require__){var GetTilesWithin=__webpack_require__("./tilemaps/components/GetTilesWithin.js");var SwapByIndex=function(indexA,indexB,tileX,tileY,width,height,layer)
    {var tiles=GetTilesWithin(tileX,tileY,width,height,null,layer);for(var i=0;i<tiles.length;i++)
    {if(tiles[i])
    {if(tiles[i].index===indexA)
    {tiles[i].index=indexB;}
    else if(tiles[i].index===indexB)
    {tiles[i].index=indexA;}}}};module.exports=SwapByIndex;}),"./tilemaps/components/TileToWorldX.js":(function(module,exports){var TileToWorldX=function(tileX,camera,layer)
    {var tileWidth=layer.baseTileWidth;var tilemapLayer=layer.tilemapLayer;var layerWorldX=0;if(tilemapLayer)
    {if(camera===undefined){camera=tilemapLayer.scene.cameras.main;}
        layerWorldX=tilemapLayer.x+camera.scrollX*(1-tilemapLayer.scrollFactorX);tileWidth*=tilemapLayer.scaleX;}
        return layerWorldX+tileX*tileWidth;};module.exports=TileToWorldX;}),"./tilemaps/components/TileToWorldXY.js":(function(module,exports,__webpack_require__){var TileToWorldX=__webpack_require__("./tilemaps/components/TileToWorldX.js");var TileToWorldY=__webpack_require__("./tilemaps/components/TileToWorldY.js");var Vector2=__webpack_require__("./math/Vector2.js");var TileToWorldXY=function(tileX,tileY,point,camera,layer)
    {if(point===undefined){point=new Vector2(0,0);}
        point.x=TileToWorldX(tileX,camera,layer);point.y=TileToWorldY(tileY,camera,layer);return point;};module.exports=TileToWorldXY;}),"./tilemaps/components/TileToWorldY.js":(function(module,exports){var TileToWorldY=function(tileY,camera,layer)
    {var tileHeight=layer.baseTileHeight;var tilemapLayer=layer.tilemapLayer;var layerWorldY=0;if(tilemapLayer)
    {if(camera===undefined){camera=tilemapLayer.scene.cameras.main;}
        layerWorldY=(tilemapLayer.y+camera.scrollY*(1-tilemapLayer.scrollFactorY));tileHeight*=tilemapLayer.scaleY;}
        return layerWorldY+tileY*tileHeight;};module.exports=TileToWorldY;}),"./tilemaps/components/WeightedRandomize.js":(function(module,exports,__webpack_require__){var GetTilesWithin=__webpack_require__("./tilemaps/components/GetTilesWithin.js");var WeightedRandomize=function(tileX,tileY,width,height,weightedIndexes,layer)
    {if(weightedIndexes===undefined){return;}
        var i;var tiles=GetTilesWithin(tileX,tileY,width,height,null,layer);var weightTotal=0;for(i=0;i<weightedIndexes.length;i++)
    {weightTotal+=weightedIndexes[i].weight;}
        if(weightTotal<=0){return;}
        for(i=0;i<tiles.length;i++)
        {var rand=Math.random()*weightTotal;var sum=0;var randomIndex=-1;for(var j=0;j<weightedIndexes.length;j++)
        {sum+=weightedIndexes[j].weight;if(rand<=sum)
        {var chosen=weightedIndexes[j].index;randomIndex=Array.isArray(chosen)?chosen[Math.floor(Math.random()*chosen.length)]:chosen;break;}}
            tiles[i].index=randomIndex;}};module.exports=WeightedRandomize;}),"./tilemaps/components/WorldToTileX.js":(function(module,exports){var WorldToTileX=function(worldX,snapToFloor,camera,layer)
    {if(snapToFloor===undefined){snapToFloor=true;}
        var tileWidth=layer.baseTileWidth;var tilemapLayer=layer.tilemapLayer;if(tilemapLayer)
    {if(camera===undefined){camera=tilemapLayer.scene.cameras.main;}
        worldX=worldX-(tilemapLayer.x+camera.scrollX*(1-tilemapLayer.scrollFactorX));tileWidth*=tilemapLayer.scaleX;}
        return snapToFloor?Math.floor(worldX / tileWidth):worldX / tileWidth;};module.exports=WorldToTileX;}),"./tilemaps/components/WorldToTileXY.js":(function(module,exports,__webpack_require__){var WorldToTileX=__webpack_require__("./tilemaps/components/WorldToTileX.js");var WorldToTileY=__webpack_require__("./tilemaps/components/WorldToTileY.js");var Vector2=__webpack_require__("./math/Vector2.js");var WorldToTileXY=function(worldX,worldY,snapToFloor,point,camera,layer)
    {if(point===undefined){point=new Vector2(0,0);}
        point.x=WorldToTileX(worldX,snapToFloor,camera,layer);point.y=WorldToTileY(worldY,snapToFloor,camera,layer);return point;};module.exports=WorldToTileXY;}),"./tilemaps/components/WorldToTileY.js":(function(module,exports){var WorldToTileY=function(worldY,snapToFloor,camera,layer)
    {if(snapToFloor===undefined){snapToFloor=true;}
        var tileHeight=layer.baseTileHeight;var tilemapLayer=layer.tilemapLayer;if(tilemapLayer)
    {if(camera===undefined){camera=tilemapLayer.scene.cameras.main;}
        worldY=worldY-(tilemapLayer.y+camera.scrollY*(1-tilemapLayer.scrollFactorY));tileHeight*=tilemapLayer.scaleY;}
        return snapToFloor?Math.floor(worldY / tileHeight):worldY / tileHeight;};module.exports=WorldToTileY;}),"./tilemaps/components/index.js":(function(module,exports,__webpack_require__){module.exports={CalculateFacesAt:__webpack_require__("./tilemaps/components/CalculateFacesAt.js"),CalculateFacesWithin:__webpack_require__("./tilemaps/components/CalculateFacesWithin.js"),Copy:__webpack_require__("./tilemaps/components/Copy.js"),CreateFromTiles:__webpack_require__("./tilemaps/components/CreateFromTiles.js"),CullTiles:__webpack_require__("./tilemaps/components/CullTiles.js"),Fill:__webpack_require__("./tilemaps/components/Fill.js"),FilterTiles:__webpack_require__("./tilemaps/components/FilterTiles.js"),FindByIndex:__webpack_require__("./tilemaps/components/FindByIndex.js"),FindTile:__webpack_require__("./tilemaps/components/FindTile.js"),ForEachTile:__webpack_require__("./tilemaps/components/ForEachTile.js"),GetTileAt:__webpack_require__("./tilemaps/components/GetTileAt.js"),GetTileAtWorldXY:__webpack_require__("./tilemaps/components/GetTileAtWorldXY.js"),GetTilesWithin:__webpack_require__("./tilemaps/components/GetTilesWithin.js"),GetTilesWithinShape:__webpack_require__("./tilemaps/components/GetTilesWithinShape.js"),GetTilesWithinWorldXY:__webpack_require__("./tilemaps/components/GetTilesWithinWorldXY.js"),HasTileAt:__webpack_require__("./tilemaps/components/HasTileAt.js"),HasTileAtWorldXY:__webpack_require__("./tilemaps/components/HasTileAtWorldXY.js"),IsInLayerBounds:__webpack_require__("./tilemaps/components/IsInLayerBounds.js"),PutTileAt:__webpack_require__("./tilemaps/components/PutTileAt.js"),PutTileAtWorldXY:__webpack_require__("./tilemaps/components/PutTileAtWorldXY.js"),PutTilesAt:__webpack_require__("./tilemaps/components/PutTilesAt.js"),Randomize:__webpack_require__("./tilemaps/components/Randomize.js"),RemoveTileAt:__webpack_require__("./tilemaps/components/RemoveTileAt.js"),RemoveTileAtWorldXY:__webpack_require__("./tilemaps/components/RemoveTileAtWorldXY.js"),RenderDebug:__webpack_require__("./tilemaps/components/RenderDebug.js"),ReplaceByIndex:__webpack_require__("./tilemaps/components/ReplaceByIndex.js"),SetCollision:__webpack_require__("./tilemaps/components/SetCollision.js"),SetCollisionBetween:__webpack_require__("./tilemaps/components/SetCollisionBetween.js"),SetCollisionByExclusion:__webpack_require__("./tilemaps/components/SetCollisionByExclusion.js"),SetCollisionByProperty:__webpack_require__("./tilemaps/components/SetCollisionByProperty.js"),SetCollisionFromCollisionGroup:__webpack_require__("./tilemaps/components/SetCollisionFromCollisionGroup.js"),SetTileIndexCallback:__webpack_require__("./tilemaps/components/SetTileIndexCallback.js"),SetTileLocationCallback:__webpack_require__("./tilemaps/components/SetTileLocationCallback.js"),Shuffle:__webpack_require__("./tilemaps/components/Shuffle.js"),SwapByIndex:__webpack_require__("./tilemaps/components/SwapByIndex.js"),TileToWorldX:__webpack_require__("./tilemaps/components/TileToWorldX.js"),TileToWorldXY:__webpack_require__("./tilemaps/components/TileToWorldXY.js"),TileToWorldY:__webpack_require__("./tilemaps/components/TileToWorldY.js"),WeightedRandomize:__webpack_require__("./tilemaps/components/WeightedRandomize.js"),WorldToTileX:__webpack_require__("./tilemaps/components/WorldToTileX.js"),WorldToTileXY:__webpack_require__("./tilemaps/components/WorldToTileXY.js"),WorldToTileY:__webpack_require__("./tilemaps/components/WorldToTileY.js")};}),"./tilemaps/dynamiclayer/DynamicTilemapLayer.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Components=__webpack_require__("./gameobjects/components/index.js");var DynamicTilemapLayerRender=__webpack_require__("./tilemaps/dynamiclayer/DynamicTilemapLayerRender.js");var GameObject=__webpack_require__("./gameobjects/GameObject.js");var TilemapComponents=__webpack_require__("./tilemaps/components/index.js");var DynamicTilemapLayer=new Class({Extends:GameObject,Mixins:[Components.Alpha,Components.BlendMode,Components.ComputedSize,Components.Depth,Components.Flip,Components.GetBounds,Components.Origin,Components.Pipeline,Components.ScaleMode,Components.Transform,Components.Visible,Components.ScrollFactor,DynamicTilemapLayerRender],initialize:function DynamicTilemapLayer(scene,tilemap,layerIndex,tileset,x,y)
        {GameObject.call(this,scene,'DynamicTilemapLayer');this.isTilemap=true;this.tilemap=tilemap;this.layerIndex=layerIndex;this.layer=tilemap.layers[layerIndex];this.layer.tilemapLayer=this;this.tileset=[];this.culledTiles=[];this.skipCull=false;this.tilesDrawn=0;this.tilesTotal=this.layer.width*this.layer.height;this.cullPaddingX=1;this.cullPaddingY=1;this.cullCallback=TilemapComponents.CullTiles;this._renderOrder=0;this.gidMap=[];this.setTilesets(tileset);this.setAlpha(this.layer.alpha);this.setPosition(x,y);this.setOrigin();this.setSize(tilemap.tileWidth*this.layer.width,tilemap.tileHeight*this.layer.height);this.initPipeline('TextureTintPipeline');},setTilesets:function(tilesets)
        {var gidMap=[];var setList=[];var map=this.tilemap;if(!Array.isArray(tilesets))
        {tilesets=[tilesets];}
            for(var i=0;i<tilesets.length;i++)
            {var tileset=tilesets[i];if(typeof tileset==='string')
            {tileset=map.getTileset(tileset);}
                if(tileset)
                {setList.push(tileset);var s=tileset.firstgid;for(var t=0;t<tileset.total;t++)
                {gidMap[s+t]=tileset;}}}
            this.gidMap=gidMap;this.tileset=setList;},setRenderOrder:function(renderOrder)
        {var orders=['right-down','left-down','right-up','left-up'];if(typeof renderOrder==='string')
        {renderOrder=orders.indexOf(renderOrder);}
            if(renderOrder>=0&&renderOrder<4)
            {this._renderOrder=renderOrder;}
            return this;},calculateFacesAt:function(tileX,tileY)
        {TilemapComponents.CalculateFacesAt(tileX,tileY,this.layer);return this;},calculateFacesWithin:function(tileX,tileY,width,height)
        {TilemapComponents.CalculateFacesWithin(tileX,tileY,width,height,this.layer);return this;},createFromTiles:function(indexes,replacements,spriteConfig,scene,camera)
        {return TilemapComponents.CreateFromTiles(indexes,replacements,spriteConfig,scene,camera,this.layer);},cull:function(camera)
        {return this.cullCallback(this.layer,camera,this.culledTiles,this._renderOrder);},copy:function(srcTileX,srcTileY,width,height,destTileX,destTileY,recalculateFaces)
        {TilemapComponents.Copy(srcTileX,srcTileY,width,height,destTileX,destTileY,recalculateFaces,this.layer);return this;},destroy:function()
        {if(this.layer.tilemapLayer===this)
        {this.layer.tilemapLayer=undefined;}
            this.tilemap=undefined;this.layer=undefined;this.culledTiles.length=0;this.cullCallback=null;this.gidMap=[];this.tileset=[];GameObject.prototype.destroy.call(this);},fill:function(index,tileX,tileY,width,height,recalculateFaces)
        {TilemapComponents.Fill(index,tileX,tileY,width,height,recalculateFaces,this.layer);return this;},filterTiles:function(callback,context,tileX,tileY,width,height,filteringOptions)
        {return TilemapComponents.FilterTiles(callback,context,tileX,tileY,width,height,filteringOptions,this.layer);},findByIndex:function(findIndex,skip,reverse)
        {return TilemapComponents.FindByIndex(findIndex,skip,reverse,this.layer);},findTile:function(callback,context,tileX,tileY,width,height,filteringOptions)
        {return TilemapComponents.FindTile(callback,context,tileX,tileY,width,height,filteringOptions,this.layer);},forEachTile:function(callback,context,tileX,tileY,width,height,filteringOptions)
        {TilemapComponents.ForEachTile(callback,context,tileX,tileY,width,height,filteringOptions,this.layer);return this;},getTileAt:function(tileX,tileY,nonNull)
        {return TilemapComponents.GetTileAt(tileX,tileY,nonNull,this.layer);},getTileAtWorldXY:function(worldX,worldY,nonNull,camera)
        {return TilemapComponents.GetTileAtWorldXY(worldX,worldY,nonNull,camera,this.layer);},getTilesWithin:function(tileX,tileY,width,height,filteringOptions)
        {return TilemapComponents.GetTilesWithin(tileX,tileY,width,height,filteringOptions,this.layer);},getTilesWithinShape:function(shape,filteringOptions,camera)
        {return TilemapComponents.GetTilesWithinShape(shape,filteringOptions,camera,this.layer);},getTilesWithinWorldXY:function(worldX,worldY,width,height,filteringOptions,camera)
        {return TilemapComponents.GetTilesWithinWorldXY(worldX,worldY,width,height,filteringOptions,camera,this.layer);},hasTileAt:function(tileX,tileY)
        {return TilemapComponents.HasTileAt(tileX,tileY,this.layer);},hasTileAtWorldXY:function(worldX,worldY,camera)
        {return TilemapComponents.HasTileAtWorldXY(worldX,worldY,camera,this.layer);},putTileAt:function(tile,tileX,tileY,recalculateFaces)
        {return TilemapComponents.PutTileAt(tile,tileX,tileY,recalculateFaces,this.layer);},putTileAtWorldXY:function(tile,worldX,worldY,recalculateFaces,camera)
        {return TilemapComponents.PutTileAtWorldXY(tile,worldX,worldY,recalculateFaces,camera,this.layer);},putTilesAt:function(tilesArray,tileX,tileY,recalculateFaces)
        {TilemapComponents.PutTilesAt(tilesArray,tileX,tileY,recalculateFaces,this.layer);return this;},randomize:function(tileX,tileY,width,height,indexes)
        {TilemapComponents.Randomize(tileX,tileY,width,height,indexes,this.layer);return this;},removeTileAt:function(tileX,tileY,replaceWithNull,recalculateFaces)
        {return TilemapComponents.RemoveTileAt(tileX,tileY,replaceWithNull,recalculateFaces,this.layer);},removeTileAtWorldXY:function(worldX,worldY,replaceWithNull,recalculateFaces,camera)
        {return TilemapComponents.RemoveTileAtWorldXY(worldX,worldY,replaceWithNull,recalculateFaces,camera,this.layer);},renderDebug:function(graphics,styleConfig)
        {TilemapComponents.RenderDebug(graphics,styleConfig,this.layer);return this;},replaceByIndex:function(findIndex,newIndex,tileX,tileY,width,height)
        {TilemapComponents.ReplaceByIndex(findIndex,newIndex,tileX,tileY,width,height,this.layer);return this;},setSkipCull:function(value)
        {if(value===undefined){value=true;}
            this.skipCull=value;return this;},setCullPadding:function(paddingX,paddingY)
        {if(paddingX===undefined){paddingX=1;}
            if(paddingY===undefined){paddingY=1;}
            this.cullPaddingX=paddingX;this.cullPaddingY=paddingY;return this;},setCollision:function(indexes,collides,recalculateFaces)
        {TilemapComponents.SetCollision(indexes,collides,recalculateFaces,this.layer);return this;},setCollisionBetween:function(start,stop,collides,recalculateFaces)
        {TilemapComponents.SetCollisionBetween(start,stop,collides,recalculateFaces,this.layer);return this;},setCollisionByProperty:function(properties,collides,recalculateFaces)
        {TilemapComponents.SetCollisionByProperty(properties,collides,recalculateFaces,this.layer);return this;},setCollisionByExclusion:function(indexes,collides,recalculateFaces)
        {TilemapComponents.SetCollisionByExclusion(indexes,collides,recalculateFaces,this.layer);return this;},setCollisionFromCollisionGroup:function(collides,recalculateFaces)
        {TilemapComponents.SetCollisionFromCollisionGroup(collides,recalculateFaces,this.layer);return this;},setTileIndexCallback:function(indexes,callback,callbackContext)
        {TilemapComponents.SetTileIndexCallback(indexes,callback,callbackContext,this.layer);return this;},setTileLocationCallback:function(tileX,tileY,width,height,callback,callbackContext)
        {TilemapComponents.SetTileLocationCallback(tileX,tileY,width,height,callback,callbackContext,this.layer);return this;},shuffle:function(tileX,tileY,width,height)
        {TilemapComponents.Shuffle(tileX,tileY,width,height,this.layer);return this;},swapByIndex:function(indexA,indexB,tileX,tileY,width,height)
        {TilemapComponents.SwapByIndex(indexA,indexB,tileX,tileY,width,height,this.layer);return this;},tileToWorldX:function(tileX,camera)
        {return TilemapComponents.TileToWorldX(tileX,camera,this.layer);},tileToWorldY:function(tileY,camera)
        {return TilemapComponents.TileToWorldY(tileY,camera,this.layer);},tileToWorldXY:function(tileX,tileY,point,camera)
        {return TilemapComponents.TileToWorldXY(tileX,tileY,point,camera,this.layer);},weightedRandomize:function(tileX,tileY,width,height,weightedIndexes)
        {TilemapComponents.WeightedRandomize(tileX,tileY,width,height,weightedIndexes,this.layer);return this;},worldToTileX:function(worldX,snapToFloor,camera)
        {return TilemapComponents.WorldToTileX(worldX,snapToFloor,camera,this.layer);},worldToTileY:function(worldY,snapToFloor,camera)
        {return TilemapComponents.WorldToTileY(worldY,snapToFloor,camera,this.layer);},worldToTileXY:function(worldX,worldY,snapToFloor,point,camera)
        {return TilemapComponents.WorldToTileXY(worldX,worldY,snapToFloor,point,camera,this.layer);}});module.exports=DynamicTilemapLayer;}),"./tilemaps/dynamiclayer/DynamicTilemapLayerCanvasRenderer.js":(function(module,exports){var DynamicTilemapLayerCanvasRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {src.cull(camera);var renderTiles=src.culledTiles;var tileCount=renderTiles.length;if(tileCount===0)
    {return;}
        var camMatrix=renderer._tempMatrix1;var layerMatrix=renderer._tempMatrix2;var calcMatrix=renderer._tempMatrix3;layerMatrix.applyITRS(src.x,src.y,src.rotation,src.scaleX,src.scaleY);camMatrix.copyFrom(camera.matrix);var ctx=renderer.currentContext;var gidMap=src.gidMap;ctx.save();if(parentMatrix)
    {camMatrix.multiplyWithOffset(parentMatrix,-camera.scrollX*src.scrollFactorX,-camera.scrollY*src.scrollFactorY);layerMatrix.e=src.x;layerMatrix.f=src.y;camMatrix.multiply(layerMatrix,calcMatrix);calcMatrix.copyToContext(ctx);}
    else
    {layerMatrix.e-=camera.scrollX*src.scrollFactorX;layerMatrix.f-=camera.scrollY*src.scrollFactorY;layerMatrix.copyToContext(ctx);}
        var alpha=camera.alpha*src.alpha;for(var i=0;i<tileCount;i++)
    {var tile=renderTiles[i];var tileset=gidMap[tile.index];if(!tileset)
    {continue;}
        var image=tileset.image.getSourceImage();var tileTexCoords=tileset.getTileTextureCoordinates(tile.index);if(tileTexCoords)
    {var halfWidth=tile.width / 2;var halfHeight=tile.height / 2;ctx.save();ctx.translate(tile.pixelX+halfWidth,tile.pixelY+halfHeight);if(tile.rotation!==0)
    {ctx.rotate(tile.rotation);}
        if(tile.flipX||tile.flipY)
        {ctx.scale((tile.flipX)?-1:1,(tile.flipY)?-1:1);}
        ctx.globalAlpha=alpha*tile.alpha;ctx.drawImage(image,tileTexCoords.x,tileTexCoords.y,tile.width,tile.height,-halfWidth,-halfHeight,tile.width,tile.height);ctx.restore();}}
        ctx.restore();};module.exports=DynamicTilemapLayerCanvasRenderer;}),"./tilemaps/dynamiclayer/DynamicTilemapLayerRender.js":(function(module,exports,__webpack_require__){var renderWebGL=__webpack_require__("./utils/NOOP.js");var renderCanvas=__webpack_require__("./utils/NOOP.js");if(true)
    {renderWebGL=__webpack_require__("./tilemaps/dynamiclayer/DynamicTilemapLayerWebGLRenderer.js");}
        if(true)
        {renderCanvas=__webpack_require__("./tilemaps/dynamiclayer/DynamicTilemapLayerCanvasRenderer.js");}
        module.exports={renderWebGL:renderWebGL,renderCanvas:renderCanvas};}),"./tilemaps/dynamiclayer/DynamicTilemapLayerWebGLRenderer.js":(function(module,exports,__webpack_require__){var Utils=__webpack_require__("./renderer/webgl/Utils.js");var DynamicTilemapLayerWebGLRenderer=function(renderer,src,interpolationPercentage,camera)
    {src.cull(camera);var renderTiles=src.culledTiles;var tileCount=renderTiles.length;var alpha=camera.alpha*src.alpha;if(tileCount===0||alpha<=0)
    {return;}
        var gidMap=src.gidMap;var pipeline=src.pipeline;var getTint=Utils.getTintAppendFloatAlpha;var scrollFactorX=src.scrollFactorX;var scrollFactorY=src.scrollFactorY;var x=src.x;var y=src.y;var sx=src.scaleX;var sy=src.scaleY;var tilesets=src.tileset;for(var c=0;c<tilesets.length;c++)
    {var currentSet=tilesets[c];var texture=currentSet.glTexture;for(var i=0;i<tileCount;i++)
    {var tile=renderTiles[i];var tileset=gidMap[tile.index];if(tileset!==currentSet)
    {continue;}
        var tileTexCoords=tileset.getTileTextureCoordinates(tile.index);if(tileTexCoords===null)
    {continue;}
        var frameWidth=tile.width;var frameHeight=tile.height;var frameX=tileTexCoords.x;var frameY=tileTexCoords.y;var tw=tile.width*0.5;var th=tile.height*0.5;var tint=getTint(tile.tint,alpha*tile.alpha);pipeline.batchTexture(src,texture,texture.width,texture.height,x+((tw+tile.pixelX)*sx),y+((th+tile.pixelY)*sy),tile.width,tile.height,sx,sy,tile.rotation,tile.flipX,tile.flipY,scrollFactorX,scrollFactorY,tw,th,frameX,frameY,frameWidth,frameHeight,tint,tint,tint,tint,false,0,0,camera,null,true);}}};module.exports=DynamicTilemapLayerWebGLRenderer;}),"./tilemaps/index.js":(function(module,exports,__webpack_require__){module.exports={Components:__webpack_require__("./tilemaps/components/index.js"),Parsers:__webpack_require__("./tilemaps/parsers/index.js"),Formats:__webpack_require__("./tilemaps/Formats.js"),ImageCollection:__webpack_require__("./tilemaps/ImageCollection.js"),ParseToTilemap:__webpack_require__("./tilemaps/ParseToTilemap.js"),Tile:__webpack_require__("./tilemaps/Tile.js"),Tilemap:__webpack_require__("./tilemaps/Tilemap.js"),TilemapCreator:__webpack_require__("./tilemaps/TilemapCreator.js"),TilemapFactory:__webpack_require__("./tilemaps/TilemapFactory.js"),Tileset:__webpack_require__("./tilemaps/Tileset.js"),LayerData:__webpack_require__("./tilemaps/mapdata/LayerData.js"),MapData:__webpack_require__("./tilemaps/mapdata/MapData.js"),ObjectLayer:__webpack_require__("./tilemaps/mapdata/ObjectLayer.js"),DynamicTilemapLayer:__webpack_require__("./tilemaps/dynamiclayer/DynamicTilemapLayer.js"),StaticTilemapLayer:__webpack_require__("./tilemaps/staticlayer/StaticTilemapLayer.js")};}),"./tilemaps/mapdata/LayerData.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var LayerData=new Class({initialize:function LayerData(config)
        {if(config===undefined){config={};}
            this.name=GetFastValue(config,'name','layer');this.x=GetFastValue(config,'x',0);this.y=GetFastValue(config,'y',0);this.width=GetFastValue(config,'width',0);this.height=GetFastValue(config,'height',0);this.tileWidth=GetFastValue(config,'tileWidth',0);this.tileHeight=GetFastValue(config,'tileHeight',0);this.baseTileWidth=GetFastValue(config,'baseTileWidth',this.tileWidth);this.baseTileHeight=GetFastValue(config,'baseTileHeight',this.tileHeight);this.widthInPixels=GetFastValue(config,'widthInPixels',this.width*this.baseTileWidth);this.heightInPixels=GetFastValue(config,'heightInPixels',this.height*this.baseTileHeight);this.alpha=GetFastValue(config,'alpha',1);this.visible=GetFastValue(config,'visible',true);this.properties=GetFastValue(config,'properties',{});this.indexes=GetFastValue(config,'indexes',[]);this.collideIndexes=GetFastValue(config,'collideIndexes',[]);this.callbacks=GetFastValue(config,'callbacks',[]);this.bodies=GetFastValue(config,'bodies',[]);this.data=GetFastValue(config,'data',[]);this.tilemapLayer=GetFastValue(config,'tilemapLayer',null);}});module.exports=LayerData;}),"./tilemaps/mapdata/MapData.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var MapData=new Class({initialize:function MapData(config)
        {if(config===undefined){config={};}
            this.name=GetFastValue(config,'name','map');this.width=GetFastValue(config,'width',0);this.height=GetFastValue(config,'height',0);this.tileWidth=GetFastValue(config,'tileWidth',0);this.tileHeight=GetFastValue(config,'tileHeight',0);this.widthInPixels=GetFastValue(config,'widthInPixels',this.width*this.tileWidth);this.heightInPixels=GetFastValue(config,'heightInPixels',this.height*this.tileHeight);this.format=GetFastValue(config,'format',null);this.orientation=GetFastValue(config,'orientation','orthogonal');this.renderOrder=GetFastValue(config,'renderOrder','right-down');this.version=GetFastValue(config,'version','1');this.properties=GetFastValue(config,'properties',{});this.layers=GetFastValue(config,'layers',[]);this.images=GetFastValue(config,'images',[]);this.objects=GetFastValue(config,'objects',{});this.collision=GetFastValue(config,'collision',{});this.tilesets=GetFastValue(config,'tilesets',[]);this.imageCollections=GetFastValue(config,'imageCollections',[]);this.tiles=GetFastValue(config,'tiles',[]);}});module.exports=MapData;}),"./tilemaps/mapdata/ObjectLayer.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var ObjectLayer=new Class({initialize:function ObjectLayer(config)
        {if(config===undefined){config={};}
            this.name=GetFastValue(config,'name','object layer');this.opacity=GetFastValue(config,'opacity',1);this.properties=GetFastValue(config,'properties',{});this.propertyTypes=GetFastValue(config,'propertytypes',{});this.type=GetFastValue(config,'type','objectgroup');this.visible=GetFastValue(config,'visible',true);this.objects=GetFastValue(config,'objects',[]);}});module.exports=ObjectLayer;}),"./tilemaps/parsers/Parse.js":(function(module,exports,__webpack_require__){var Formats=__webpack_require__("./tilemaps/Formats.js");var Parse2DArray=__webpack_require__("./tilemaps/parsers/Parse2DArray.js");var ParseCSV=__webpack_require__("./tilemaps/parsers/ParseCSV.js");var ParseJSONTiled=__webpack_require__("./tilemaps/parsers/tiled/ParseJSONTiled.js");var ParseWeltmeister=__webpack_require__("./tilemaps/parsers/impact/ParseWeltmeister.js");var Parse=function(name,mapFormat,data,tileWidth,tileHeight,insertNull)
    {var newMap;switch(mapFormat)
    {case(Formats.ARRAY_2D):newMap=Parse2DArray(name,data,tileWidth,tileHeight,insertNull);break;case(Formats.CSV):newMap=ParseCSV(name,data,tileWidth,tileHeight,insertNull);break;case(Formats.TILED_JSON):newMap=ParseJSONTiled(name,data,insertNull);break;case(Formats.WELTMEISTER):newMap=ParseWeltmeister(name,data,insertNull);break;default:console.warn('Unrecognized tilemap data format: '+mapFormat);newMap=null;}
        return newMap;};module.exports=Parse;}),"./tilemaps/parsers/Parse2DArray.js":(function(module,exports,__webpack_require__){var Formats=__webpack_require__("./tilemaps/Formats.js");var LayerData=__webpack_require__("./tilemaps/mapdata/LayerData.js");var MapData=__webpack_require__("./tilemaps/mapdata/MapData.js");var Tile=__webpack_require__("./tilemaps/Tile.js");var Parse2DArray=function(name,data,tileWidth,tileHeight,insertNull)
    {var layerData=new LayerData({tileWidth:tileWidth,tileHeight:tileHeight});var mapData=new MapData({name:name,tileWidth:tileWidth,tileHeight:tileHeight,format:Formats.ARRAY_2D,layers:[layerData]});var tiles=[];var height=data.length;var width=0;for(var y=0;y<data.length;y++)
    {tiles[y]=[];var row=data[y];for(var x=0;x<row.length;x++)
    {var tileIndex=parseInt(row[x],10);if(isNaN(tileIndex)||tileIndex===-1)
    {tiles[y][x]=insertNull?null:new Tile(layerData,-1,x,y,tileWidth,tileHeight);}
    else
    {tiles[y][x]=new Tile(layerData,tileIndex,x,y,tileWidth,tileHeight);}}
        if(width===0)
        {width=row.length;}}
        mapData.width=layerData.width=width;mapData.height=layerData.height=height;mapData.widthInPixels=layerData.widthInPixels=width*tileWidth;mapData.heightInPixels=layerData.heightInPixels=height*tileHeight;layerData.data=tiles;return mapData;};module.exports=Parse2DArray;}),"./tilemaps/parsers/ParseCSV.js":(function(module,exports,__webpack_require__){var Formats=__webpack_require__("./tilemaps/Formats.js");var Parse2DArray=__webpack_require__("./tilemaps/parsers/Parse2DArray.js");var ParseCSV=function(name,data,tileWidth,tileHeight,insertNull)
    {var array2D=data.trim().split('\n').map(function(row){return row.split(',');});var map=Parse2DArray(name,array2D,tileWidth,tileHeight,insertNull);map.format=Formats.CSV;return map;};module.exports=ParseCSV;}),"./tilemaps/parsers/impact/ParseTileLayers.js":(function(module,exports,__webpack_require__){var LayerData=__webpack_require__("./tilemaps/mapdata/LayerData.js");var Tile=__webpack_require__("./tilemaps/Tile.js");var ParseTileLayers=function(json,insertNull)
    {var tileLayers=[];for(var i=0;i<json.layer.length;i++)
    {var layer=json.layer[i];var layerData=new LayerData({name:layer.name,width:layer.width,height:layer.height,tileWidth:layer.tilesize,tileHeight:layer.tilesize,visible:layer.visible===1});var row=[];var tileGrid=[];for(var y=0;y<layer.data.length;y++)
    {for(var x=0;x<layer.data[y].length;x++)
    {var index=layer.data[y][x]-1;var tile;if(index>-1)
    {tile=new Tile(layerData,index,x,y,layer.tilesize,layer.tilesize);}
    else
    {tile=insertNull?null:new Tile(layerData,-1,x,y,layer.tilesize,layer.tilesize);}
        row.push(tile);}
        tileGrid.push(row);row=[];}
        layerData.data=tileGrid;tileLayers.push(layerData);}
        return tileLayers;};module.exports=ParseTileLayers;}),"./tilemaps/parsers/impact/ParseTilesets.js":(function(module,exports,__webpack_require__){var Tileset=__webpack_require__("./tilemaps/Tileset.js");var ParseTilesets=function(json)
    {var tilesets=[];var tilesetsNames=[];for(var i=0;i<json.layer.length;i++)
    {var layer=json.layer[i];var tilesetName=layer.tilesetName;if(tilesetName!==''&&tilesetsNames.indexOf(tilesetName)===-1)
    {tilesetsNames.push(tilesetName);tilesets.push(new Tileset(tilesetName,0,layer.tilesize,layer.tilesize,0,0));}}
        return tilesets;};module.exports=ParseTilesets;}),"./tilemaps/parsers/impact/ParseWeltmeister.js":(function(module,exports,__webpack_require__){var Formats=__webpack_require__("./tilemaps/Formats.js");var MapData=__webpack_require__("./tilemaps/mapdata/MapData.js");var ParseTileLayers=__webpack_require__("./tilemaps/parsers/impact/ParseTileLayers.js");var ParseTilesets=__webpack_require__("./tilemaps/parsers/impact/ParseTilesets.js");var ParseWeltmeister=function(name,json,insertNull)
    {if(json.layer.length===0)
    {console.warn('No layers found in the Weltmeister map: '+name);return null;}
        var width=0;var height=0;for(var i=0;i<json.layer.length;i++)
    {if(json.layer[i].width>width){width=json.layer[i].width;}
        if(json.layer[i].height>height){height=json.layer[i].height;}}
        var mapData=new MapData({width:width,height:height,name:name,tileWidth:json.layer[0].tilesize,tileHeight:json.layer[0].tilesize,format:Formats.WELTMEISTER});mapData.layers=ParseTileLayers(json,insertNull);mapData.tilesets=ParseTilesets(json);return mapData;};module.exports=ParseWeltmeister;}),"./tilemaps/parsers/index.js":(function(module,exports,__webpack_require__){module.exports={Parse:__webpack_require__("./tilemaps/parsers/Parse.js"),Parse2DArray:__webpack_require__("./tilemaps/parsers/Parse2DArray.js"),ParseCSV:__webpack_require__("./tilemaps/parsers/ParseCSV.js"),Impact:__webpack_require__("./tilemaps/parsers/impact/ParseWeltmeister.js"),Tiled:__webpack_require__("./tilemaps/parsers/tiled/ParseJSONTiled.js")};}),"./tilemaps/parsers/tiled/AssignTileProperties.js":(function(module,exports,__webpack_require__){var Extend=__webpack_require__("./utils/object/Extend.js");var AssignTileProperties=function(mapData)
    {var layerData;var tile;var sid;var set;var row;for(var i=0;i<mapData.layers.length;i++)
    {layerData=mapData.layers[i];set=null;for(var j=0;j<layerData.data.length;j++)
    {row=layerData.data[j];for(var k=0;k<row.length;k++)
    {tile=row[k];if(tile===null||tile.index<0)
    {continue;}
        sid=mapData.tiles[tile.index][2];set=mapData.tilesets[sid];tile.width=set.tileWidth;tile.height=set.tileHeight;if(set.tileProperties&&set.tileProperties[tile.index-set.firstgid])
    {tile.properties=Extend(tile.properties,set.tileProperties[tile.index-set.firstgid]);}}}}};module.exports=AssignTileProperties;}),"./tilemaps/parsers/tiled/Base64Decode.js":(function(module,exports){var Base64Decode=function(data)
    {var binaryString=window.atob(data);var len=binaryString.length;var bytes=new Array(len / 4);for(var i=0;i<len;i+=4)
    {bytes[i / 4]=(binaryString.charCodeAt(i)|binaryString.charCodeAt(i+1)<<8|binaryString.charCodeAt(i+2)<<16|binaryString.charCodeAt(i+3)<<24)>>>0;}
        return bytes;};module.exports=Base64Decode;}),"./tilemaps/parsers/tiled/BuildTilesetIndex.js":(function(module,exports){var BuildTilesetIndex=function(mapData)
    {var tiles=[];for(var i=0;i<mapData.tilesets.length;i++)
    {var set=mapData.tilesets[i];var x=set.tileMargin;var y=set.tileMargin;var count=0;var countX=0;var countY=0;for(var t=set.firstgid;t<set.firstgid+set.total;t++)
    {tiles[t]=[x,y,i];x+=set.tileWidth+set.tileSpacing;count++;if(count===set.total)
    {break;}
        countX++;if(countX===set.columns)
    {x=set.tileMargin;y+=set.tileHeight+set.tileSpacing;countX=0;countY++;if(countY===set.rows)
    {break;}}}}
        return tiles;};module.exports=BuildTilesetIndex;}),"./tilemaps/parsers/tiled/ParseGID.js":(function(module,exports){var FLIPPED_HORIZONTAL=0x80000000;var FLIPPED_VERTICAL=0x40000000;var FLIPPED_ANTI_DIAGONAL=0x20000000;var ParseGID=function(gid)
    {var flippedHorizontal=Boolean(gid&FLIPPED_HORIZONTAL);var flippedVertical=Boolean(gid&FLIPPED_VERTICAL);var flippedAntiDiagonal=Boolean(gid&FLIPPED_ANTI_DIAGONAL);gid=gid&~(FLIPPED_HORIZONTAL|FLIPPED_VERTICAL|FLIPPED_ANTI_DIAGONAL);var rotation=0;var flipped=false;if(flippedHorizontal&&flippedVertical&&flippedAntiDiagonal)
    {rotation=Math.PI / 2;flipped=true;}
    else if(flippedHorizontal&&flippedVertical&&!flippedAntiDiagonal)
    {rotation=Math.PI;flipped=false;}
    else if(flippedHorizontal&&!flippedVertical&&flippedAntiDiagonal)
    {rotation=Math.PI / 2;flipped=false;}
    else if(flippedHorizontal&&!flippedVertical&&!flippedAntiDiagonal)
    {rotation=0;flipped=true;}
    else if(!flippedHorizontal&&flippedVertical&&flippedAntiDiagonal)
    {rotation=3*Math.PI / 2;flipped=false;}
    else if(!flippedHorizontal&&flippedVertical&&!flippedAntiDiagonal)
    {rotation=Math.PI;flipped=true;}
    else if(!flippedHorizontal&&!flippedVertical&&flippedAntiDiagonal)
    {rotation=3*Math.PI / 2;flipped=true;}
    else if(!flippedHorizontal&&!flippedVertical&&!flippedAntiDiagonal)
    {rotation=0;flipped=false;}
        return{gid:gid,flippedHorizontal:flippedHorizontal,flippedVertical:flippedVertical,flippedAntiDiagonal:flippedAntiDiagonal,rotation:rotation,flipped:flipped};};module.exports=ParseGID;}),"./tilemaps/parsers/tiled/ParseImageLayers.js":(function(module,exports,__webpack_require__){var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var ParseImageLayers=function(json)
    {var images=[];for(var i=0;i<json.layers.length;i++)
    {if(json.layers[i].type!=='imagelayer')
    {continue;}
        var curi=json.layers[i];images.push({name:curi.name,image:curi.image,x:GetFastValue(curi,'offsetx',0)+curi.x,y:GetFastValue(curi,'offsety',0)+curi.y,alpha:curi.opacity,visible:curi.visible,properties:GetFastValue(curi,'properties',{})});}
        return images;};module.exports=ParseImageLayers;}),"./tilemaps/parsers/tiled/ParseJSONTiled.js":(function(module,exports,__webpack_require__){var Formats=__webpack_require__("./tilemaps/Formats.js");var MapData=__webpack_require__("./tilemaps/mapdata/MapData.js");var ParseTileLayers=__webpack_require__("./tilemaps/parsers/tiled/ParseTileLayers.js");var ParseImageLayers=__webpack_require__("./tilemaps/parsers/tiled/ParseImageLayers.js");var ParseTilesets=__webpack_require__("./tilemaps/parsers/tiled/ParseTilesets.js");var ParseObjectLayers=__webpack_require__("./tilemaps/parsers/tiled/ParseObjectLayers.js");var BuildTilesetIndex=__webpack_require__("./tilemaps/parsers/tiled/BuildTilesetIndex.js");var AssignTileProperties=__webpack_require__("./tilemaps/parsers/tiled/AssignTileProperties.js");var ParseJSONTiled=function(name,json,insertNull)
    {if(json.orientation!=='orthogonal')
    {console.warn('Only orthogonal map types are supported in this version of Phaser');return null;}
        var mapData=new MapData({width:json.width,height:json.height,name:name,tileWidth:json.tilewidth,tileHeight:json.tileheight,orientation:json.orientation,format:Formats.TILED_JSON,version:json.version,properties:json.properties,renderOrder:json.renderorder});mapData.layers=ParseTileLayers(json,insertNull);mapData.images=ParseImageLayers(json);var sets=ParseTilesets(json);mapData.tilesets=sets.tilesets;mapData.imageCollections=sets.imageCollections;mapData.objects=ParseObjectLayers(json);mapData.tiles=BuildTilesetIndex(mapData);AssignTileProperties(mapData);return mapData;};module.exports=ParseJSONTiled;}),"./tilemaps/parsers/tiled/ParseObject.js":(function(module,exports,__webpack_require__){var Pick=__webpack_require__("./tilemaps/parsers/tiled/Pick.js");var ParseGID=__webpack_require__("./tilemaps/parsers/tiled/ParseGID.js");var copyPoints=function(p){return{x:p.x,y:p.y};};var commonObjectProps=['id','name','type','rotation','properties','visible','x','y','width','height'];var ParseObject=function(tiledObject,offsetX,offsetY)
    {if(offsetX===undefined){offsetX=0;}
        if(offsetY===undefined){offsetY=0;}
        var parsedObject=Pick(tiledObject,commonObjectProps);parsedObject.x+=offsetX;parsedObject.y+=offsetY;if(tiledObject.gid)
    {var gidInfo=ParseGID(tiledObject.gid);parsedObject.gid=gidInfo.gid;parsedObject.flippedHorizontal=gidInfo.flippedHorizontal;parsedObject.flippedVertical=gidInfo.flippedVertical;parsedObject.flippedAntiDiagonal=gidInfo.flippedAntiDiagonal;}
    else if(tiledObject.polyline)
    {parsedObject.polyline=tiledObject.polyline.map(copyPoints);}
    else if(tiledObject.polygon)
    {parsedObject.polygon=tiledObject.polygon.map(copyPoints);}
    else if(tiledObject.ellipse)
    {parsedObject.ellipse=tiledObject.ellipse;parsedObject.width=tiledObject.width;parsedObject.height=tiledObject.height;}
    else if(tiledObject.text)
    {parsedObject.width=tiledObject.width;parsedObject.height=tiledObject.height;parsedObject.text=tiledObject.text;}
    else
    {parsedObject.rectangle=true;parsedObject.width=tiledObject.width;parsedObject.height=tiledObject.height;}
        return parsedObject;};module.exports=ParseObject;}),"./tilemaps/parsers/tiled/ParseObjectLayers.js":(function(module,exports,__webpack_require__){var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var ParseObject=__webpack_require__("./tilemaps/parsers/tiled/ParseObject.js");var ObjectLayer=__webpack_require__("./tilemaps/mapdata/ObjectLayer.js");var ParseObjectLayers=function(json)
    {var objectLayers=[];for(var i=0;i<json.layers.length;i++)
    {if(json.layers[i].type!=='objectgroup')
    {continue;}
        var curo=json.layers[i];var offsetX=GetFastValue(curo,'offsetx',0);var offsetY=GetFastValue(curo,'offsety',0);var objects=[];for(var j=0;j<curo.objects.length;j++)
    {var parsedObject=ParseObject(curo.objects[j],offsetX,offsetY);objects.push(parsedObject);}
        var objectLayer=new ObjectLayer(curo);objectLayer.objects=objects;objectLayers.push(objectLayer);}
        return objectLayers;};module.exports=ParseObjectLayers;}),"./tilemaps/parsers/tiled/ParseTileLayers.js":(function(module,exports,__webpack_require__){var Base64Decode=__webpack_require__("./tilemaps/parsers/tiled/Base64Decode.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var LayerData=__webpack_require__("./tilemaps/mapdata/LayerData.js");var ParseGID=__webpack_require__("./tilemaps/parsers/tiled/ParseGID.js");var Tile=__webpack_require__("./tilemaps/Tile.js");var ParseTileLayers=function(json,insertNull)
    {var tileLayers=[];for(var i=0;i<json.layers.length;i++)
    {if(json.layers[i].type!=='tilelayer')
    {continue;}
        var curl=json.layers[i];if(curl.compression)
    {console.warn('TilemapParser.parseTiledJSON - Layer compression is unsupported, skipping layer \''
        +curl.name+'\'');continue;}
    else if(curl.encoding&&curl.encoding==='base64')
    {curl.data=Base64Decode(curl.data);delete curl.encoding;}
        var layerData=new LayerData({name:curl.name,x:GetFastValue(curl,'offsetx',0)+curl.x,y:GetFastValue(curl,'offsety',0)+curl.y,width:curl.width,height:curl.height,tileWidth:json.tilewidth,tileHeight:json.tileheight,alpha:curl.opacity,visible:curl.visible,properties:GetFastValue(curl,'properties',{})});var x=0;var row=[];var output=[];for(var t=0,len=curl.data.length;t<len;t++)
    {var gidInfo=ParseGID(curl.data[t]);if(gidInfo.gid>0)
    {var tile=new Tile(layerData,gidInfo.gid,x,output.length,json.tilewidth,json.tileheight);tile.rotation=gidInfo.rotation;tile.flipX=gidInfo.flipped;row.push(tile);}
    else
    {var blankTile=insertNull?null:new Tile(layerData,-1,x,output.length,json.tilewidth,json.tileheight);row.push(blankTile);}
        x++;if(x===curl.width)
    {output.push(row);x=0;row=[];}}
        layerData.data=output;tileLayers.push(layerData);}
        return tileLayers;};module.exports=ParseTileLayers;}),"./tilemaps/parsers/tiled/ParseTilesets.js":(function(module,exports,__webpack_require__){var Tileset=__webpack_require__("./tilemaps/Tileset.js");var ImageCollection=__webpack_require__("./tilemaps/ImageCollection.js");var ParseObject=__webpack_require__("./tilemaps/parsers/tiled/ParseObject.js");var ParseTilesets=function(json)
    {var tilesets=[];var imageCollections=[];var lastSet=null;var stringID;for(var i=0;i<json.tilesets.length;i++)
    {var set=json.tilesets[i];if(set.source)
    {console.warn('Phaser can\'t load external tilesets. Use the Embed Tileset button and then export the map again.');}
    else if(set.image)
    {var newSet=new Tileset(set.name,set.firstgid,set.tilewidth,set.tileheight,set.margin,set.spacing);if(json.version>1)
    {if(Array.isArray(set.tiles))
    {var tiles={};var props={};for(var t=0;t<set.tiles.length;t++)
    {var tile=set.tiles[t];if(tile.properties)
    {var newPropData={};tile.properties.forEach(function(propData)
    {newPropData[propData['name']]=propData['value'];});props[tile.id]=newPropData;}
        if(tile.objectgroup)
        {tiles[tile.id]={objectgroup:tile.objectgroup};if(tile.objectgroup.objects)
        {var parsedObjects2=tile.objectgroup.objects.map(function(obj){return ParseObject(obj);});tiles[tile.id].objectgroup.objects=parsedObjects2;}}
        if(tile.animation)
        {if(tiles.hasOwnProperty(tile.id))
        {tiles[tile.id].animation=tile.animation;}
        else
        {tiles[tile.id]={animation:tile.animation};}}}
        newSet.tileData=tiles;newSet.tileProperties=props;}}
    else
    {if(set.tileproperties)
    {newSet.tileProperties=set.tileproperties;}
        if(set.tiles)
        {newSet.tileData=set.tiles;for(stringID in newSet.tileData)
        {var objectGroup=newSet.tileData[stringID].objectgroup;if(objectGroup&&objectGroup.objects)
        {var parsedObjects1=objectGroup.objects.map(function(obj){return ParseObject(obj);});newSet.tileData[stringID].objectgroup.objects=parsedObjects1;}}}}
        newSet.updateTileData(set.imagewidth,set.imageheight);tilesets.push(newSet);}
    else
    {var newCollection=new ImageCollection(set.name,set.firstgid,set.tilewidth,set.tileheight,set.margin,set.spacing,set.properties);for(stringID in set.tiles)
    {var image=set.tiles[stringID].image;var gid=set.firstgid+parseInt(stringID,10);newCollection.addImage(gid,image);}
        imageCollections.push(newCollection);}
        if(lastSet)
        {lastSet.lastgid=set.firstgid-1;}
        lastSet=set;}
        return{tilesets:tilesets,imageCollections:imageCollections};};module.exports=ParseTilesets;}),"./tilemaps/parsers/tiled/Pick.js":(function(module,exports,__webpack_require__){var HasValue=__webpack_require__("./utils/object/HasValue.js");var Pick=function(object,keys)
    {var obj={};for(var i=0;i<keys.length;i++)
    {var key=keys[i];if(HasValue(object,key))
    {obj[key]=object[key];}}
        return obj;};module.exports=Pick;}),"./tilemaps/staticlayer/StaticTilemapLayer.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var Components=__webpack_require__("./gameobjects/components/index.js");var CONST=__webpack_require__("./const.js");var GameObject=__webpack_require__("./gameobjects/GameObject.js");var StaticTilemapLayerRender=__webpack_require__("./tilemaps/staticlayer/StaticTilemapLayerRender.js");var TilemapComponents=__webpack_require__("./tilemaps/components/index.js");var TransformMatrix=__webpack_require__("./gameobjects/components/TransformMatrix.js");var Utils=__webpack_require__("./renderer/webgl/Utils.js");var StaticTilemapLayer=new Class({Extends:GameObject,Mixins:[Components.Alpha,Components.BlendMode,Components.ComputedSize,Components.Depth,Components.Flip,Components.GetBounds,Components.Origin,Components.Pipeline,Components.ScaleMode,Components.Transform,Components.Visible,Components.ScrollFactor,StaticTilemapLayerRender],initialize:function StaticTilemapLayer(scene,tilemap,layerIndex,tileset,x,y)
        {GameObject.call(this,scene,'StaticTilemapLayer');this.isTilemap=true;this.tilemap=tilemap;this.layerIndex=layerIndex;this.layer=tilemap.layers[layerIndex];this.layer.tilemapLayer=this;this.tileset=[];this.culledTiles=[];this.skipCull=false;this.tilesDrawn=0;this.tilesTotal=this.layer.width*this.layer.height;this.cullPaddingX=1;this.cullPaddingY=1;this.cullCallback=TilemapComponents.CullTiles;this.renderer=scene.sys.game.renderer;this.vertexBuffer=[];this.bufferData=[];this.vertexViewF32=[];this.vertexViewU32=[];this.dirty=[];this.vertexCount=[];this._renderOrder=0;this._tempMatrix=new TransformMatrix();this.gidMap=[];this.setTilesets(tileset);this.setAlpha(this.layer.alpha);this.setPosition(x,y);this.setOrigin();this.setSize(tilemap.tileWidth*this.layer.width,tilemap.tileHeight*this.layer.height);this.updateVBOData();this.initPipeline('TextureTintPipeline');if(scene.sys.game.config.renderType===CONST.WEBGL)
        {scene.sys.game.renderer.onContextRestored(function()
        {this.updateVBOData();},this);}},setTilesets:function(tilesets)
        {var gidMap=[];var setList=[];var map=this.tilemap;if(!Array.isArray(tilesets))
        {tilesets=[tilesets];}
            for(var i=0;i<tilesets.length;i++)
            {var tileset=tilesets[i];if(typeof tileset==='string')
            {tileset=map.getTileset(tileset);}
                if(tileset)
                {setList.push(tileset);var s=tileset.firstgid;for(var t=0;t<tileset.total;t++)
                {gidMap[s+t]=tileset;}}}
            this.gidMap=gidMap;this.tileset=setList;},updateVBOData:function()
        {for(var i=0;i<this.tileset.length;i++)
        {this.dirty[i]=true;this.vertexCount[i]=0;this.vertexBuffer[i]=null;this.bufferData[i]=null;this.vertexViewF32[i]=null;this.vertexViewU32[i]=null;}
            return this;},upload:function(camera,tilesetIndex)
        {var renderer=this.renderer;var gl=renderer.gl;var pipeline=renderer.pipelines.TextureTintPipeline;if(this.dirty[tilesetIndex])
        {var tileset=this.tileset[tilesetIndex];var mapWidth=this.layer.width;var mapHeight=this.layer.height;var width=tileset.image.source[0].width;var height=tileset.image.source[0].height;var mapData=this.layer.data;var tile;var row;var col;var renderOrder=this._renderOrder;var minTileIndex=tileset.firstgid;var maxTileIndex=tileset.firstgid+tileset.total;var vertexBuffer=this.vertexBuffer[tilesetIndex];var bufferData=this.bufferData[tilesetIndex];var vOffset=-1;var bufferSize=(mapWidth*mapHeight)*pipeline.vertexSize*6;this.vertexCount[tilesetIndex]=0;if(bufferData===null)
        {bufferData=new ArrayBuffer(bufferSize);this.bufferData[tilesetIndex]=bufferData;this.vertexViewF32[tilesetIndex]=new Float32Array(bufferData);this.vertexViewU32[tilesetIndex]=new Uint32Array(bufferData);}
            if(renderOrder===0)
            {for(row=0;row<mapHeight;row++)
            {for(col=0;col<mapWidth;col++)
            {tile=mapData[row][col];if(!tile||tile.index<minTileIndex||tile.index>maxTileIndex||!tile.visible)
            {continue;}
                vOffset=this.batchTile(vOffset,tile,tileset,width,height,camera,tilesetIndex);}}}
            else if(renderOrder===1)
            {for(row=0;row<mapHeight;row++)
            {for(col=mapWidth-1;col>=0;col--)
            {tile=mapData[row][col];if(!tile||tile.index<minTileIndex||tile.index>maxTileIndex||!tile.visible)
            {continue;}
                vOffset=this.batchTile(vOffset,tile,tileset,width,height,camera,tilesetIndex);}}}
            else if(renderOrder===2)
            {for(row=mapHeight-1;row>=0;row--)
            {for(col=0;col<mapWidth;col++)
            {tile=mapData[row][col];if(!tile||tile.index<minTileIndex||tile.index>maxTileIndex||!tile.visible)
            {continue;}
                vOffset=this.batchTile(vOffset,tile,tileset,width,height,camera,tilesetIndex);}}}
            else if(renderOrder===3)
            {for(row=mapHeight-1;row>=0;row--)
            {for(col=mapWidth-1;col>=0;col--)
            {tile=mapData[row][col];if(!tile||tile.index<minTileIndex||tile.index>maxTileIndex||!tile.visible)
            {continue;}
                vOffset=this.batchTile(vOffset,tile,tileset,width,height,camera,tilesetIndex);}}}
            this.dirty[tilesetIndex]=false;if(vertexBuffer===null)
        {vertexBuffer=renderer.createVertexBuffer(bufferData,gl.STATIC_DRAW);this.vertexBuffer[tilesetIndex]=vertexBuffer;}
        else
        {renderer.setVertexBuffer(vertexBuffer);gl.bufferSubData(gl.ARRAY_BUFFER,0,bufferData);}}
            return this;},batchTile:function(vOffset,tile,tileset,width,height,camera,tilesetIndex)
        {var texCoords=tileset.getTileTextureCoordinates(tile.index);if(!texCoords)
        {return vOffset;}
            var tileWidth=tileset.tileWidth;var tileHeight=tileset.tileHeight;var halfTileWidth=tileWidth / 2;var halfTileHeight=tileHeight / 2;var u0=texCoords.x / width;var v0=texCoords.y / height;var u1=(texCoords.x+tileWidth)/ width;var v1=(texCoords.y+tileHeight)/ height;var matrix=this._tempMatrix;var x=-halfTileWidth;var y=-halfTileHeight;if(tile.flipX)
        {tileWidth*=-1;x+=tileset.tileWidth;}
            if(tile.flipY)
            {tileHeight*=-1;y+=tileset.tileHeight;}
            var xw=x+tileWidth;var yh=y+tileHeight;matrix.applyITRS(halfTileWidth+tile.pixelX,halfTileHeight+tile.pixelY,tile.rotation,1,1);var tint=Utils.getTintAppendFloatAlpha(0xffffff,camera.alpha*this.alpha*tile.alpha);var tx0=matrix.getX(x,y);var ty0=matrix.getY(x,y);var tx1=matrix.getX(x,yh);var ty1=matrix.getY(x,yh);var tx2=matrix.getX(xw,yh);var ty2=matrix.getY(xw,yh);var tx3=matrix.getX(xw,y);var ty3=matrix.getY(xw,y);if(camera.roundPixels)
        {tx0=Math.round(tx0);ty0=Math.round(ty0);tx1=Math.round(tx1);ty1=Math.round(ty1);tx2=Math.round(tx2);ty2=Math.round(ty2);tx3=Math.round(tx3);ty3=Math.round(ty3);}
            var vertexViewF32=this.vertexViewF32[tilesetIndex];var vertexViewU32=this.vertexViewU32[tilesetIndex];vertexViewF32[++vOffset]=tx0;vertexViewF32[++vOffset]=ty0;vertexViewF32[++vOffset]=u0;vertexViewF32[++vOffset]=v0;vertexViewF32[++vOffset]=0;vertexViewU32[++vOffset]=tint;vertexViewF32[++vOffset]=tx1;vertexViewF32[++vOffset]=ty1;vertexViewF32[++vOffset]=u0;vertexViewF32[++vOffset]=v1;vertexViewF32[++vOffset]=0;vertexViewU32[++vOffset]=tint;vertexViewF32[++vOffset]=tx2;vertexViewF32[++vOffset]=ty2;vertexViewF32[++vOffset]=u1;vertexViewF32[++vOffset]=v1;vertexViewF32[++vOffset]=0;vertexViewU32[++vOffset]=tint;vertexViewF32[++vOffset]=tx0;vertexViewF32[++vOffset]=ty0;vertexViewF32[++vOffset]=u0;vertexViewF32[++vOffset]=v0;vertexViewF32[++vOffset]=0;vertexViewU32[++vOffset]=tint;vertexViewF32[++vOffset]=tx2;vertexViewF32[++vOffset]=ty2;vertexViewF32[++vOffset]=u1;vertexViewF32[++vOffset]=v1;vertexViewF32[++vOffset]=0;vertexViewU32[++vOffset]=tint;vertexViewF32[++vOffset]=tx3;vertexViewF32[++vOffset]=ty3;vertexViewF32[++vOffset]=u1;vertexViewF32[++vOffset]=v0;vertexViewF32[++vOffset]=0;vertexViewU32[++vOffset]=tint;this.vertexCount[tilesetIndex]+=6;return vOffset;},setRenderOrder:function(renderOrder)
        {var orders=['right-down','left-down','right-up','left-up'];if(typeof renderOrder==='string')
        {renderOrder=orders.indexOf(renderOrder);}
            if(renderOrder>=0&&renderOrder<4)
            {this._renderOrder=renderOrder;for(var i=0;i<this.tileset.length;i++)
            {this.dirty[i]=true;}}
            return this;},calculateFacesAt:function(tileX,tileY)
        {TilemapComponents.CalculateFacesAt(tileX,tileY,this.layer);return this;},calculateFacesWithin:function(tileX,tileY,width,height)
        {TilemapComponents.CalculateFacesWithin(tileX,tileY,width,height,this.layer);return this;},createFromTiles:function(indexes,replacements,spriteConfig,scene,camera)
        {return TilemapComponents.CreateFromTiles(indexes,replacements,spriteConfig,scene,camera,this.layer);},cull:function(camera)
        {return this.cullCallback(this.layer,camera,this.culledTiles);},setSkipCull:function(value)
        {if(value===undefined){value=true;}
            this.skipCull=value;return this;},setCullPadding:function(paddingX,paddingY)
        {if(paddingX===undefined){paddingX=1;}
            if(paddingY===undefined){paddingY=1;}
            this.cullPaddingX=paddingX;this.cullPaddingY=paddingY;return this;},findByIndex:function(findIndex,skip,reverse)
        {return TilemapComponents.FindByIndex(findIndex,skip,reverse,this.layer);},findTile:function(callback,context,tileX,tileY,width,height,filteringOptions)
        {return TilemapComponents.FindTile(callback,context,tileX,tileY,width,height,filteringOptions,this.layer);},filterTiles:function(callback,context,tileX,tileY,width,height,filteringOptions)
        {return TilemapComponents.FilterTiles(callback,context,tileX,tileY,width,height,filteringOptions,this.layer);},forEachTile:function(callback,context,tileX,tileY,width,height,filteringOptions)
        {TilemapComponents.ForEachTile(callback,context,tileX,tileY,width,height,filteringOptions,this.layer);return this;},getTileAt:function(tileX,tileY,nonNull)
        {return TilemapComponents.GetTileAt(tileX,tileY,nonNull,this.layer);},getTileAtWorldXY:function(worldX,worldY,nonNull,camera)
        {return TilemapComponents.GetTileAtWorldXY(worldX,worldY,nonNull,camera,this.layer);},getTilesWithin:function(tileX,tileY,width,height,filteringOptions)
        {return TilemapComponents.GetTilesWithin(tileX,tileY,width,height,filteringOptions,this.layer);},getTilesWithinWorldXY:function(worldX,worldY,width,height,filteringOptions,camera)
        {return TilemapComponents.GetTilesWithinWorldXY(worldX,worldY,width,height,filteringOptions,camera,this.layer);},getTilesWithinShape:function(shape,filteringOptions,camera)
        {return TilemapComponents.GetTilesWithinShape(shape,filteringOptions,camera,this.layer);},hasTileAt:function(tileX,tileY)
        {return TilemapComponents.HasTileAt(tileX,tileY,this.layer);},hasTileAtWorldXY:function(worldX,worldY,camera)
        {return TilemapComponents.HasTileAtWorldXY(worldX,worldY,camera,this.layer);},renderDebug:function(graphics,styleConfig)
        {TilemapComponents.RenderDebug(graphics,styleConfig,this.layer);return this;},setCollision:function(indexes,collides,recalculateFaces)
        {TilemapComponents.SetCollision(indexes,collides,recalculateFaces,this.layer);return this;},setCollisionBetween:function(start,stop,collides,recalculateFaces)
        {TilemapComponents.SetCollisionBetween(start,stop,collides,recalculateFaces,this.layer);return this;},setCollisionByProperty:function(properties,collides,recalculateFaces)
        {TilemapComponents.SetCollisionByProperty(properties,collides,recalculateFaces,this.layer);return this;},setCollisionByExclusion:function(indexes,collides,recalculateFaces)
        {TilemapComponents.SetCollisionByExclusion(indexes,collides,recalculateFaces,this.layer);return this;},setTileIndexCallback:function(indexes,callback,callbackContext)
        {TilemapComponents.SetTileIndexCallback(indexes,callback,callbackContext,this.layer);return this;},setCollisionFromCollisionGroup:function(collides,recalculateFaces)
        {TilemapComponents.SetCollisionFromCollisionGroup(collides,recalculateFaces,this.layer);return this;},setTileLocationCallback:function(tileX,tileY,width,height,callback,callbackContext)
        {TilemapComponents.SetTileLocationCallback(tileX,tileY,width,height,callback,callbackContext,this.layer);return this;},tileToWorldX:function(tileX,camera)
        {return TilemapComponents.TileToWorldX(tileX,camera,this.layer);},tileToWorldY:function(tileY,camera)
        {return TilemapComponents.TileToWorldY(tileY,camera,this.layer);},tileToWorldXY:function(tileX,tileY,point,camera)
        {return TilemapComponents.TileToWorldXY(tileX,tileY,point,camera,this.layer);},worldToTileX:function(worldX,snapToFloor,camera)
        {return TilemapComponents.WorldToTileX(worldX,snapToFloor,camera,this.layer);},worldToTileY:function(worldY,snapToFloor,camera)
        {return TilemapComponents.WorldToTileY(worldY,snapToFloor,camera,this.layer);},worldToTileXY:function(worldX,worldY,snapToFloor,point,camera)
        {return TilemapComponents.WorldToTileXY(worldX,worldY,snapToFloor,point,camera,this.layer);},destroy:function()
        {if(this.layer.tilemapLayer===this)
        {this.layer.tilemapLayer=undefined;}
            this.tilemap=undefined;this.layer=undefined;this.culledTiles.length=0;this.cullCallback=null;for(var i=0;i<this.tileset.length;i++)
        {this.dirty[i]=true;this.vertexCount[i]=0;this.vertexBuffer[i]=null;this.bufferData[i]=null;this.vertexViewF32[i]=null;this.vertexViewU32[i]=null;}
            this.gidMap=[];this.tileset=[];GameObject.prototype.destroy.call(this);}});module.exports=StaticTilemapLayer;}),"./tilemaps/staticlayer/StaticTilemapLayerCanvasRenderer.js":(function(module,exports){var StaticTilemapLayerCanvasRenderer=function(renderer,src,interpolationPercentage,camera,parentMatrix)
    {src.cull(camera);var renderTiles=src.culledTiles;var tileCount=renderTiles.length;if(tileCount===0)
    {return;}
        var camMatrix=renderer._tempMatrix1;var layerMatrix=renderer._tempMatrix2;var calcMatrix=renderer._tempMatrix3;layerMatrix.applyITRS(src.x,src.y,src.rotation,src.scaleX,src.scaleY);camMatrix.copyFrom(camera.matrix);var ctx=renderer.currentContext;var gidMap=src.gidMap;ctx.save();if(parentMatrix)
    {camMatrix.multiplyWithOffset(parentMatrix,-camera.scrollX*src.scrollFactorX,-camera.scrollY*src.scrollFactorY);layerMatrix.e=src.x;layerMatrix.f=src.y;camMatrix.multiply(layerMatrix,calcMatrix);calcMatrix.copyToContext(ctx);}
    else
    {layerMatrix.e-=camera.scrollX*src.scrollFactorX;layerMatrix.f-=camera.scrollY*src.scrollFactorY;layerMatrix.copyToContext(ctx);}
        var alpha=camera.alpha*src.alpha;ctx.globalAlpha=camera.alpha*src.alpha;for(var i=0;i<tileCount;i++)
    {var tile=renderTiles[i];var tileset=gidMap[tile.index];if(!tileset)
    {continue;}
        var image=tileset.image.getSourceImage();var tileTexCoords=tileset.getTileTextureCoordinates(tile.index);if(tileTexCoords)
    {var tileWidth=tileset.tileWidth;var tileHeight=tileset.tileHeight;var halfWidth=tileWidth / 2;var halfHeight=tileHeight / 2;ctx.save();ctx.translate(tile.pixelX+halfWidth,tile.pixelY+halfHeight);if(tile.rotation!==0)
    {ctx.rotate(tile.rotation);}
        if(tile.flipX||tile.flipY)
        {ctx.scale((tile.flipX)?-1:1,(tile.flipY)?-1:1);}
        ctx.globalAlpha=alpha*tile.alpha;ctx.drawImage(image,tileTexCoords.x,tileTexCoords.y,tileWidth,tileHeight,-halfWidth,-halfHeight,tileWidth,tileHeight);ctx.restore();}}
        ctx.restore();};module.exports=StaticTilemapLayerCanvasRenderer;}),"./tilemaps/staticlayer/StaticTilemapLayerRender.js":(function(module,exports,__webpack_require__){var renderWebGL=__webpack_require__("./utils/NOOP.js");var renderCanvas=__webpack_require__("./utils/NOOP.js");if(true)
    {renderWebGL=__webpack_require__("./tilemaps/staticlayer/StaticTilemapLayerWebGLRenderer.js");}
        if(true)
        {renderCanvas=__webpack_require__("./tilemaps/staticlayer/StaticTilemapLayerCanvasRenderer.js");}
        module.exports={renderWebGL:renderWebGL,renderCanvas:renderCanvas};}),"./tilemaps/staticlayer/StaticTilemapLayerWebGLRenderer.js":(function(module,exports){var StaticTilemapLayerWebGLRenderer=function(renderer,src,interpolationPercentage,camera)
    {var tilesets=src.tileset;var pipeline=src.pipeline;var pipelineVertexBuffer=pipeline.vertexBuffer;renderer.setPipeline(pipeline);pipeline.modelIdentity();pipeline.modelTranslate(src.x-(camera.scrollX*src.scrollFactorX),src.y-(camera.scrollY*src.scrollFactorY),0);pipeline.modelScale(src.scaleX,src.scaleY,1);pipeline.viewLoad2D(camera.matrix.matrix);for(var i=0;i<tilesets.length;i++)
    {src.upload(camera,i);if(src.vertexCount[i]>0)
    {if(renderer.currentPipeline&&renderer.currentPipeline.vertexCount>0)
    {renderer.flush();}
        pipeline.vertexBuffer=src.vertexBuffer[i];renderer.setPipeline(pipeline);renderer.setTexture2D(tilesets[i].glTexture,0);renderer.gl.drawArrays(pipeline.topology,0,src.vertexCount[i]);}}
        pipeline.vertexBuffer=pipelineVertexBuffer;pipeline.viewIdentity();pipeline.modelIdentity();};module.exports=StaticTilemapLayerWebGLRenderer;}),"./time/Clock.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var PluginCache=__webpack_require__("./plugins/PluginCache.js");var TimerEvent=__webpack_require__("./time/TimerEvent.js");var Clock=new Class({initialize:function Clock(scene)
        {this.scene=scene;this.systems=scene.sys;this.now=Date.now();this.timeScale=1;this.paused=false;this._active=[];this._pendingInsertion=[];this._pendingRemoval=[];scene.sys.events.once('boot',this.boot,this);scene.sys.events.on('start',this.start,this);},boot:function()
        {this.systems.events.once('destroy',this.destroy,this);},start:function()
        {var eventEmitter=this.systems.events;eventEmitter.on('preupdate',this.preUpdate,this);eventEmitter.on('update',this.update,this);eventEmitter.once('shutdown',this.shutdown,this);},addEvent:function(config)
        {var event=new TimerEvent(config);this._pendingInsertion.push(event);return event;},delayedCall:function(delay,callback,args,callbackScope)
        {return this.addEvent({delay:delay,callback:callback,args:args,callbackScope:callbackScope});},clearPendingEvents:function()
        {this._pendingInsertion=[];return this;},removeAllEvents:function()
        {this._pendingRemoval=this._pendingRemoval.concat(this._active);return this;},preUpdate:function()
        {var toRemove=this._pendingRemoval.length;var toInsert=this._pendingInsertion.length;if(toRemove===0&&toInsert===0)
        {return;}
            var i;var event;for(i=0;i<toRemove;i++)
        {event=this._pendingRemoval[i];var index=this._active.indexOf(event);if(index>-1)
        {this._active.splice(index,1);}
            event.destroy();}
            for(i=0;i<toInsert;i++)
            {event=this._pendingInsertion[i];this._active.push(event);}
            this._pendingRemoval.length=0;this._pendingInsertion.length=0;},update:function(time,delta)
        {this.now=time;if(this.paused)
        {return;}
            delta*=this.timeScale;for(var i=0;i<this._active.length;i++)
        {var event=this._active[i];if(event.paused)
        {continue;}
            event.elapsed+=delta*event.timeScale;if(event.elapsed>=event.delay)
        {var remainder=event.elapsed-event.delay;event.elapsed=event.delay;if(!event.hasDispatched&&event.callback)
        {event.hasDispatched=true;event.callback.apply(event.callbackScope,event.args);}
            if(event.repeatCount>0)
            {event.repeatCount--;event.elapsed=remainder;event.hasDispatched=false;}
            else
            {this._pendingRemoval.push(event);}}}},shutdown:function()
        {var i;for(i=0;i<this._pendingInsertion.length;i++)
        {this._pendingInsertion[i].destroy();}
            for(i=0;i<this._active.length;i++)
            {this._active[i].destroy();}
            for(i=0;i<this._pendingRemoval.length;i++)
            {this._pendingRemoval[i].destroy();}
            this._active.length=0;this._pendingRemoval.length=0;this._pendingInsertion.length=0;var eventEmitter=this.systems.events;eventEmitter.off('preupdate',this.preUpdate,this);eventEmitter.off('update',this.update,this);eventEmitter.off('shutdown',this.shutdown,this);},destroy:function()
        {this.shutdown();this.scene.sys.events.off('start',this.start,this);this.scene=null;this.systems=null;}});PluginCache.register('Clock',Clock,'time');module.exports=Clock;}),"./time/TimerEvent.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var GetFastValue=__webpack_require__("./utils/object/GetFastValue.js");var TimerEvent=new Class({initialize:function TimerEvent(config)
        {this.delay=0;this.repeat=0;this.repeatCount=0;this.loop=false;this.callback;this.callbackScope;this.args;this.timeScale=1;this.startAt=0;this.elapsed=0;this.paused=false;this.hasDispatched=false;this.reset(config);},reset:function(config)
        {this.delay=GetFastValue(config,'delay',0);this.repeat=GetFastValue(config,'repeat',0);this.loop=GetFastValue(config,'loop',false);this.callback=GetFastValue(config,'callback',undefined);this.callbackScope=GetFastValue(config,'callbackScope',this.callback);this.args=GetFastValue(config,'args',[]);this.timeScale=GetFastValue(config,'timeScale',1);this.startAt=GetFastValue(config,'startAt',0);this.paused=GetFastValue(config,'paused',false);this.elapsed=this.startAt;this.hasDispatched=false;this.repeatCount=(this.repeat===-1||this.loop)?999999999999:this.repeat;return this;},getProgress:function()
        {return(this.elapsed / this.delay);},getOverallProgress:function()
        {if(this.repeat>0)
        {var totalDuration=this.delay+(this.delay*this.repeat);var totalElapsed=this.elapsed+(this.delay*(this.repeat-this.repeatCount));return(totalElapsed / totalDuration);}
        else
        {return this.getProgress();}},getRepeatCount:function()
        {return this.repeatCount;},getElapsed:function()
        {return this.elapsed;},getElapsedSeconds:function()
        {return this.elapsed*0.001;},remove:function(dispatchCallback)
        {if(dispatchCallback===undefined){dispatchCallback=false;}
            this.elapsed=this.delay;this.hasDispatched=!dispatchCallback;this.repeatCount=0;},destroy:function()
        {this.callback=undefined;this.callbackScope=undefined;this.args=[];}});module.exports=TimerEvent;}),"./time/index.js":(function(module,exports,__webpack_require__){module.exports={Clock:__webpack_require__("./time/Clock.js"),TimerEvent:__webpack_require__("./time/TimerEvent.js")};}),"./tweens/Timeline.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var EventEmitter=__webpack_require__("../node_modules/eventemitter3/index.js");var TweenBuilder=__webpack_require__("./tweens/builders/TweenBuilder.js");var TWEEN_CONST=__webpack_require__("./tweens/tween/const.js");var Timeline=new Class({Extends:EventEmitter,initialize:function Timeline(manager)
        {EventEmitter.call(this);this.manager=manager;this.isTimeline=true;this.data=[];this.totalData=0;this.useFrames=false;this.timeScale=1;this.loop=0;this.loopDelay=0;this.loopCounter=0;this.completeDelay=0;this.countdown=0;this.state=TWEEN_CONST.PENDING_ADD;this._pausedState=TWEEN_CONST.PENDING_ADD;this.paused=false;this.elapsed=0;this.totalElapsed=0;this.duration=0;this.progress=0;this.totalDuration=0;this.totalProgress=0;this.callbacks={onComplete:null,onLoop:null,onStart:null,onUpdate:null,onYoyo:null};this.callbackScope;},setTimeScale:function(value)
        {this.timeScale=value;return this;},getTimeScale:function()
        {return this.timeScale;},isPlaying:function()
        {return(this.state===TWEEN_CONST.ACTIVE);},add:function(config)
        {return this.queue(TweenBuilder(this,config));},queue:function(tween)
        {if(!this.isPlaying())
        {tween.parent=this;tween.parentIsTimeline=true;this.data.push(tween);this.totalData=this.data.length;}
            return this;},hasOffset:function(tween)
        {return(tween.offset!==null);},isOffsetAbsolute:function(value)
        {return(typeof(value)==='number');},isOffsetRelative:function(value)
        {var t=typeof(value);if(t==='string')
        {var op=value[0];if(op==='-'||op==='+')
        {return true;}}
            return false;},getRelativeOffset:function(value,base)
        {var op=value[0];var num=parseFloat(value.substr(2));var result=base;switch(op)
        {case'+':result+=num;break;case'-':result-=num;break;}
            return Math.max(0,result);},calcDuration:function()
        {var prevEnd=0;var totalDuration=0;var offsetDuration=0;for(var i=0;i<this.totalData;i++)
        {var tween=this.data[i];tween.init();if(this.hasOffset(tween))
        {if(this.isOffsetAbsolute(tween.offset))
        {tween.calculatedOffset=tween.offset;if(tween.offset===0)
        {offsetDuration=0;}}
        else if(this.isOffsetRelative(tween.offset))
        {tween.calculatedOffset=this.getRelativeOffset(tween.offset,prevEnd);}}
        else
        {tween.calculatedOffset=offsetDuration;}
            prevEnd=tween.totalDuration+tween.calculatedOffset;totalDuration+=tween.totalDuration;offsetDuration+=tween.totalDuration;}
            this.duration=totalDuration;this.loopCounter=(this.loop===-1)?999999999999:this.loop;if(this.loopCounter>0)
        {this.totalDuration=this.duration+this.completeDelay+((this.duration+this.loopDelay)*this.loopCounter);}
        else
        {this.totalDuration=this.duration+this.completeDelay;}},init:function()
        {this.calcDuration();this.progress=0;this.totalProgress=0;if(this.paused)
        {this.state=TWEEN_CONST.PAUSED;return false;}
        else
        {return true;}},resetTweens:function(resetFromLoop)
        {for(var i=0;i<this.totalData;i++)
        {var tween=this.data[i];tween.play(resetFromLoop);}},setCallback:function(type,callback,params,scope)
        {if(Timeline.TYPES.indexOf(type)!==-1)
        {this.callbacks[type]={func:callback,scope:scope,params:params};}
            return this;},makeActive:function(tween)
        {return this.manager.makeActive(tween);},play:function()
        {if(this.state===TWEEN_CONST.ACTIVE)
        {return;}
            if(this.paused)
            {this.paused=false;this.manager.makeActive(this);return;}
            else
            {this.resetTweens(false);this.state=TWEEN_CONST.ACTIVE;}
            var onStart=this.callbacks.onStart;if(onStart)
        {onStart.func.apply(onStart.scope,onStart.params);}
            this.emit('start',this);},nextState:function()
        {if(this.loopCounter>0)
        {this.elapsed=0;this.progress=0;this.loopCounter--;var onLoop=this.callbacks.onLoop;if(onLoop)
        {onLoop.func.apply(onLoop.scope,onLoop.params);}
            this.emit('loop',this,this.loopCounter);this.resetTweens(true);if(this.loopDelay>0)
        {this.countdown=this.loopDelay;this.state=TWEEN_CONST.LOOP_DELAY;}
        else
        {this.state=TWEEN_CONST.ACTIVE;}}
        else if(this.completeDelay>0)
        {this.countdown=this.completeDelay;this.state=TWEEN_CONST.COMPLETE_DELAY;}
        else
        {var onComplete=this.callbacks.onComplete;if(onComplete)
        {onComplete.func.apply(onComplete.scope,onComplete.params);}
            this.emit('complete',this);this.state=TWEEN_CONST.PENDING_REMOVE;}},update:function(timestamp,delta)
        {if(this.state===TWEEN_CONST.PAUSED)
        {return;}
            var rawDelta=delta;if(this.useFrames)
        {delta=1*this.manager.timeScale;}
            delta*=this.timeScale;this.elapsed+=delta;this.progress=Math.min(this.elapsed / this.duration,1);this.totalElapsed+=delta;this.totalProgress=Math.min(this.totalElapsed / this.totalDuration,1);switch(this.state)
        {case TWEEN_CONST.ACTIVE:var stillRunning=this.totalData;for(var i=0;i<this.totalData;i++)
            {var tween=this.data[i];if(tween.update(timestamp,rawDelta))
            {stillRunning--;}}
                var onUpdate=this.callbacks.onUpdate;if(onUpdate)
                {onUpdate.func.apply(onUpdate.scope,onUpdate.params);}
                this.emit('update',this);if(stillRunning===0)
                {this.nextState();}
                break;case TWEEN_CONST.LOOP_DELAY:this.countdown-=delta;if(this.countdown<=0)
            {this.state=TWEEN_CONST.ACTIVE;}
                break;case TWEEN_CONST.COMPLETE_DELAY:this.countdown-=delta;if(this.countdown<=0)
            {var onComplete=this.callbacks.onComplete;if(onComplete)
            {onComplete.func.apply(onComplete.scope,onComplete.params);}
                this.emit('complete',this);this.state=TWEEN_CONST.PENDING_REMOVE;}
                break;}
            return(this.state===TWEEN_CONST.PENDING_REMOVE);},stop:function()
        {this.state=TWEEN_CONST.PENDING_REMOVE;},pause:function()
        {if(this.state===TWEEN_CONST.PAUSED)
        {return;}
            this.paused=true;this._pausedState=this.state;this.state=TWEEN_CONST.PAUSED;this.emit('pause',this);return this;},resume:function()
        {if(this.state===TWEEN_CONST.PAUSED)
        {this.paused=false;this.state=this._pausedState;}
            this.emit('resume',this);return this;},hasTarget:function(target)
        {for(var i=0;i<this.data.length;i++)
        {if(this.data[i].hasTarget(target))
        {return true;}}
            return false;},destroy:function()
        {for(var i=0;i<this.data.length;i++)
        {this.data[i].stop();}}});Timeline.TYPES=['onStart','onUpdate','onLoop','onComplete','onYoyo'];module.exports=Timeline;}),"./tweens/TweenManager.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var NumberTweenBuilder=__webpack_require__("./tweens/builders/NumberTweenBuilder.js");var PluginCache=__webpack_require__("./plugins/PluginCache.js");var TimelineBuilder=__webpack_require__("./tweens/builders/TimelineBuilder.js");var TWEEN_CONST=__webpack_require__("./tweens/tween/const.js");var TweenBuilder=__webpack_require__("./tweens/builders/TweenBuilder.js");var TweenManager=new Class({initialize:function TweenManager(scene)
        {this.scene=scene;this.systems=scene.sys;this.timeScale=1;this._add=[];this._pending=[];this._active=[];this._destroy=[];this._toProcess=0;scene.sys.events.once('boot',this.boot,this);scene.sys.events.on('start',this.start,this);},boot:function()
        {this.systems.events.once('destroy',this.destroy,this);},start:function()
        {var eventEmitter=this.systems.events;eventEmitter.on('preupdate',this.preUpdate,this);eventEmitter.on('update',this.update,this);eventEmitter.once('shutdown',this.shutdown,this);this.timeScale=1;},createTimeline:function(config)
        {return TimelineBuilder(this,config);},timeline:function(config)
        {var timeline=TimelineBuilder(this,config);if(!timeline.paused)
        {this._add.push(timeline);this._toProcess++;}
            return timeline;},create:function(config)
        {return TweenBuilder(this,config);},add:function(config)
        {var tween=TweenBuilder(this,config);this._add.push(tween);this._toProcess++;return tween;},existing:function(tween)
        {this._add.push(tween);this._toProcess++;return this;},addCounter:function(config)
        {var tween=NumberTweenBuilder(this,config);this._add.push(tween);this._toProcess++;return tween;},preUpdate:function()
        {if(this._toProcess===0)
        {return;}
            var list=this._destroy;var active=this._active;var pending=this._pending;var i;var tween;for(i=0;i<list.length;i++)
        {tween=list[i];var idx=active.indexOf(tween);if(idx===-1)
        {idx=pending.indexOf(tween);if(idx>-1)
        {tween.state=TWEEN_CONST.REMOVED;pending.splice(idx,1);}}
        else
        {tween.state=TWEEN_CONST.REMOVED;active.splice(idx,1);}}
            list.length=0;list=this._add;for(i=0;i<list.length;i++)
        {tween=list[i];if(tween.state===TWEEN_CONST.PENDING_ADD)
        {if(tween.init())
        {tween.play();this._active.push(tween);}
        else
        {this._pending.push(tween);}}}
            list.length=0;this._toProcess=0;},update:function(timestamp,delta)
        {var list=this._active;var tween;delta*=this.timeScale;for(var i=0;i<list.length;i++)
        {tween=list[i];if(tween.update(timestamp,delta))
        {this._destroy.push(tween);this._toProcess++;}}},makeActive:function(tween)
        {if(this._add.indexOf(tween)!==-1||this._active.indexOf(tween)!==-1)
        {return;}
            var idx=this._pending.indexOf(tween);if(idx!==-1)
        {this._pending.splice(idx,1);}
            this._add.push(tween);tween.state=TWEEN_CONST.PENDING_ADD;this._toProcess++;return this;},each:function(callback,scope)
        {var args=[null];for(var i=1;i<arguments.length;i++)
        {args.push(arguments[i]);}
            for(var texture in this.list)
            {args[0]=this.list[texture];callback.apply(scope,args);}},getAllTweens:function()
        {var list=this._active;var output=[];for(var i=0;i<list.length;i++)
        {output.push(list[i]);}
            return output;},getGlobalTimeScale:function()
        {return this.timeScale;},getTweensOf:function(target)
        {var list=this._active;var tween;var output=[];var i;if(Array.isArray(target))
        {for(i=0;i<list.length;i++)
        {tween=list[i];for(var t=0;t<target.length;t++)
        {if(tween.hasTarget(target[t]))
        {output.push(tween);}}}}
        else
        {for(i=0;i<list.length;i++)
        {tween=list[i];if(tween.hasTarget(target))
        {output.push(tween);}}}
            return output;},isTweening:function(target)
        {var list=this._active;var tween;for(var i=0;i<list.length;i++)
        {tween=list[i];if(tween.hasTarget(target)&&tween.isPlaying())
        {return true;}}
            return false;},killAll:function()
        {var tweens=this.getAllTweens();for(var i=0;i<tweens.length;i++)
        {tweens[i].stop();}
            return this;},killTweensOf:function(target)
        {var tweens=this.getTweensOf(target);for(var i=0;i<tweens.length;i++)
        {tweens[i].stop();}
            return this;},pauseAll:function()
        {var list=this._active;for(var i=0;i<list.length;i++)
        {list[i].pause();}
            return this;},resumeAll:function()
        {var list=this._active;for(var i=0;i<list.length;i++)
        {list[i].resume();}
            return this;},setGlobalTimeScale:function(value)
        {this.timeScale=value;return this;},shutdown:function()
        {this.killAll();this._add=[];this._pending=[];this._active=[];this._destroy=[];this._toProcess=0;var eventEmitter=this.systems.events;eventEmitter.off('preupdate',this.preUpdate,this);eventEmitter.off('update',this.update,this);eventEmitter.off('shutdown',this.shutdown,this);},destroy:function()
        {this.shutdown();this.scene.sys.events.off('start',this.start,this);this.scene=null;this.systems=null;}});PluginCache.register('TweenManager',TweenManager,'tweens');module.exports=TweenManager;}),"./tweens/builders/GetBoolean.js":(function(module,exports){var GetBoolean=function(source,key,defaultValue)
    {if(!source)
    {return defaultValue;}
    else if(source.hasOwnProperty(key))
    {return source[key];}
    else
    {return defaultValue;}};module.exports=GetBoolean;}),"./tweens/builders/GetEaseFunction.js":(function(module,exports,__webpack_require__){var EaseMap=__webpack_require__("./math/easing/EaseMap.js");var GetEaseFunction=function(ease,easeParams)
    {if(typeof ease==='string'&&EaseMap.hasOwnProperty(ease))
    {if(easeParams)
    {var cloneParams=easeParams.slice(0);cloneParams.unshift(0);return function(v)
    {cloneParams[0]=v;return EaseMap[ease].apply(this,cloneParams);};}
    else
    {return EaseMap[ease];}}
    else if(typeof ease==='function')
    {return ease;}
    else if(Array.isArray(ease)&&ease.length===4)
    {}
        return EaseMap.Power0;};module.exports=GetEaseFunction;}),"./tweens/builders/GetNewValue.js":(function(module,exports){var GetNewValue=function(source,key,defaultValue)
    {var valueCallback;if(source.hasOwnProperty(key))
    {var t=typeof(source[key]);if(t==='function')
    {valueCallback=function(index,totalTargets,target)
    {return source[key](index,totalTargets,target);};}
    else
    {valueCallback=function()
    {return source[key];};}}
    else if(typeof defaultValue==='function')
    {valueCallback=defaultValue;}
    else
    {valueCallback=function()
    {return defaultValue;};}
        return valueCallback;};module.exports=GetNewValue;}),"./tweens/builders/GetProps.js":(function(module,exports,__webpack_require__){var RESERVED=__webpack_require__("./tweens/tween/ReservedProps.js");var GetProps=function(config)
    {var key;var keys=[];if(config.hasOwnProperty('props'))
    {for(key in config.props)
    {if(key.substr(0,1)!=='_')
    {keys.push({key:key,value:config.props[key]});}}}
    else
    {for(key in config)
    {if(RESERVED.indexOf(key)===-1&&key.substr(0,1)!=='_')
    {keys.push({key:key,value:config[key]});}}}
        return keys;};module.exports=GetProps;}),"./tweens/builders/GetTargets.js":(function(module,exports,__webpack_require__){var GetValue=__webpack_require__("./utils/object/GetValue.js");var GetTargets=function(config)
    {var targets=GetValue(config,'targets',null);if(targets===null)
    {return targets;}
        if(typeof targets==='function')
        {targets=targets.call();}
        if(!Array.isArray(targets))
        {targets=[targets];}
        return targets;};module.exports=GetTargets;}),"./tweens/builders/GetTweens.js":(function(module,exports,__webpack_require__){var GetValue=__webpack_require__("./utils/object/GetValue.js");var GetTweens=function(config)
    {var tweens=GetValue(config,'tweens',null);if(tweens===null)
    {return[];}
    else if(typeof tweens==='function')
    {tweens=tweens.call();}
        if(!Array.isArray(tweens))
        {tweens=[tweens];}
        return tweens;};module.exports=GetTweens;}),"./tweens/builders/GetValueOp.js":(function(module,exports){function hasGetStart(def)
    {return(!!def.getStart&&typeof def.getStart==='function');}
        function hasGetEnd(def)
        {return(!!def.getEnd&&typeof def.getEnd==='function');}
        function hasGetters(def)
        {return hasGetStart(def)||hasGetEnd(def);}
        var GetValueOp=function(key,propertyValue)
        {var callbacks;var getEnd=function(target,key,value){return value;};var getStart=function(target,key,value){return value;};var t=typeof(propertyValue);if(t==='number')
        {getEnd=function()
        {return propertyValue;};}
        else if(t==='string')
        {var op=propertyValue[0];var num=parseFloat(propertyValue.substr(2));switch(op)
        {case'+':getEnd=function(target,key,value)
            {return value+num;};break;case'-':getEnd=function(target,key,value)
            {return value-num;};break;case'*':getEnd=function(target,key,value)
            {return value*num;};break;case'/':getEnd=function(target,key,value)
            {return value / num;};break;default:getEnd=function()
            {return parseFloat(propertyValue);};}}
        else if(t==='function')
        {getEnd=propertyValue;}
        else if(t==='object'&&hasGetters(propertyValue))
        {if(hasGetEnd(propertyValue))
        {getEnd=propertyValue.getEnd;}
            if(hasGetStart(propertyValue))
            {getStart=propertyValue.getStart;}}
        else if(propertyValue.hasOwnProperty('value'))
        {callbacks=GetValueOp(key,propertyValue.value);}
            if(!callbacks)
            {callbacks={getEnd:getEnd,getStart:getStart};}
            return callbacks;};module.exports=GetValueOp;}),"./tweens/builders/NumberTweenBuilder.js":(function(module,exports,__webpack_require__){var Defaults=__webpack_require__("./tweens/tween/Defaults.js");var GetAdvancedValue=__webpack_require__("./utils/object/GetAdvancedValue.js");var GetBoolean=__webpack_require__("./tweens/builders/GetBoolean.js");var GetEaseFunction=__webpack_require__("./tweens/builders/GetEaseFunction.js");var GetNewValue=__webpack_require__("./tweens/builders/GetNewValue.js");var GetValue=__webpack_require__("./utils/object/GetValue.js");var GetValueOp=__webpack_require__("./tweens/builders/GetValueOp.js");var Tween=__webpack_require__("./tweens/tween/Tween.js");var TweenData=__webpack_require__("./tweens/tween/TweenData.js");var NumberTweenBuilder=function(parent,config,defaults)
    {if(defaults===undefined)
    {defaults=Defaults;}
        var from=GetValue(config,'from',0);var to=GetValue(config,'to',1);var targets=[{value:from}];var delay=GetNewValue(config,'delay',defaults.delay);var duration=GetNewValue(config,'duration',defaults.duration);var easeParams=GetValue(config,'easeParams',defaults.easeParams);var ease=GetEaseFunction(GetValue(config,'ease',defaults.ease),easeParams);var hold=GetNewValue(config,'hold',defaults.hold);var repeat=GetNewValue(config,'repeat',defaults.repeat);var repeatDelay=GetNewValue(config,'repeatDelay',defaults.repeatDelay);var yoyo=GetBoolean(config,'yoyo',defaults.yoyo);var data=[];var ops=GetValueOp('value',to);var tweenData=TweenData(targets[0],'value',ops.getEnd,ops.getStart,ease,delay,duration,yoyo,hold,repeat,repeatDelay,false,false);tweenData.start=from;tweenData.current=from;tweenData.to=to;data.push(tweenData);var tween=new Tween(parent,data,targets);tween.offset=GetAdvancedValue(config,'offset',null);tween.completeDelay=GetAdvancedValue(config,'completeDelay',0);tween.loop=Math.round(GetAdvancedValue(config,'loop',0));tween.loopDelay=Math.round(GetAdvancedValue(config,'loopDelay',0));tween.paused=GetBoolean(config,'paused',false);tween.useFrames=GetBoolean(config,'useFrames',false);var scope=GetValue(config,'callbackScope',tween);var tweenArray=[tween,null];var callbacks=Tween.TYPES;for(var i=0;i<callbacks.length;i++)
    {var type=callbacks[i];var callback=GetValue(config,type,false);if(callback)
    {var callbackScope=GetValue(config,type+'Scope',scope);var callbackParams=GetValue(config,type+'Params',[]);tween.setCallback(type,callback,tweenArray.concat(callbackParams),callbackScope);}}
        return tween;};module.exports=NumberTweenBuilder;}),"./tweens/builders/TimelineBuilder.js":(function(module,exports,__webpack_require__){var Clone=__webpack_require__("./utils/object/Clone.js");var Defaults=__webpack_require__("./tweens/tween/Defaults.js");var GetAdvancedValue=__webpack_require__("./utils/object/GetAdvancedValue.js");var GetBoolean=__webpack_require__("./tweens/builders/GetBoolean.js");var GetEaseFunction=__webpack_require__("./tweens/builders/GetEaseFunction.js");var GetNewValue=__webpack_require__("./tweens/builders/GetNewValue.js");var GetTargets=__webpack_require__("./tweens/builders/GetTargets.js");var GetTweens=__webpack_require__("./tweens/builders/GetTweens.js");var GetValue=__webpack_require__("./utils/object/GetValue.js");var Timeline=__webpack_require__("./tweens/Timeline.js");var TweenBuilder=__webpack_require__("./tweens/builders/TweenBuilder.js");var TimelineBuilder=function(manager,config)
    {var timeline=new Timeline(manager);var tweens=GetTweens(config);if(tweens.length===0)
    {timeline.paused=true;return timeline;}
        var defaults=Clone(Defaults);defaults.targets=GetTargets(config);var totalDuration=GetAdvancedValue(config,'totalDuration',0);if(totalDuration>0)
    {defaults.duration=Math.floor(totalDuration / tweens.length);}
    else
    {defaults.duration=GetNewValue(config,'duration',defaults.duration);}
        defaults.delay=GetNewValue(config,'delay',defaults.delay);defaults.easeParams=GetValue(config,'easeParams',defaults.easeParams);defaults.ease=GetEaseFunction(GetValue(config,'ease',defaults.ease),defaults.easeParams);defaults.hold=GetNewValue(config,'hold',defaults.hold);defaults.repeat=GetNewValue(config,'repeat',defaults.repeat);defaults.repeatDelay=GetNewValue(config,'repeatDelay',defaults.repeatDelay);defaults.yoyo=GetBoolean(config,'yoyo',defaults.yoyo);defaults.flipX=GetBoolean(config,'flipX',defaults.flipX);defaults.flipY=GetBoolean(config,'flipY',defaults.flipY);for(var i=0;i<tweens.length;i++)
    {timeline.queue(TweenBuilder(timeline,tweens[i],defaults));}
        timeline.completeDelay=GetAdvancedValue(config,'completeDelay',0);timeline.loop=Math.round(GetAdvancedValue(config,'loop',0));timeline.loopDelay=Math.round(GetAdvancedValue(config,'loopDelay',0));timeline.paused=GetBoolean(config,'paused',false);timeline.useFrames=GetBoolean(config,'useFrames',false);var scope=GetValue(config,'callbackScope',timeline);var timelineArray=[timeline];var onStart=GetValue(config,'onStart',false);if(onStart)
    {var onStartScope=GetValue(config,'onStartScope',scope);var onStartParams=GetValue(config,'onStartParams',[]);timeline.setCallback('onStart',onStart,timelineArray.concat(onStartParams),onStartScope);}
        var onUpdate=GetValue(config,'onUpdate',false);if(onUpdate)
    {var onUpdateScope=GetValue(config,'onUpdateScope',scope);var onUpdateParams=GetValue(config,'onUpdateParams',[]);timeline.setCallback('onUpdate',onUpdate,timelineArray.concat(onUpdateParams),onUpdateScope);}
        var onLoop=GetValue(config,'onLoop',false);if(onLoop)
    {var onLoopScope=GetValue(config,'onLoopScope',scope);var onLoopParams=GetValue(config,'onLoopParams',[]);timeline.setCallback('onLoop',onLoop,timelineArray.concat(onLoopParams),onLoopScope);}
        var onYoyo=GetValue(config,'onYoyo',false);if(onYoyo)
    {var onYoyoScope=GetValue(config,'onYoyoScope',scope);var onYoyoParams=GetValue(config,'onYoyoParams',[]);timeline.setCallback('onYoyo',onYoyo,timelineArray.concat(null,onYoyoParams),onYoyoScope);}
        var onComplete=GetValue(config,'onComplete',false);if(onComplete)
    {var onCompleteScope=GetValue(config,'onCompleteScope',scope);var onCompleteParams=GetValue(config,'onCompleteParams',[]);timeline.setCallback('onComplete',onComplete,timelineArray.concat(onCompleteParams),onCompleteScope);}
        return timeline;};module.exports=TimelineBuilder;}),"./tweens/builders/TweenBuilder.js":(function(module,exports,__webpack_require__){var Defaults=__webpack_require__("./tweens/tween/Defaults.js");var GetAdvancedValue=__webpack_require__("./utils/object/GetAdvancedValue.js");var GetBoolean=__webpack_require__("./tweens/builders/GetBoolean.js");var GetEaseFunction=__webpack_require__("./tweens/builders/GetEaseFunction.js");var GetNewValue=__webpack_require__("./tweens/builders/GetNewValue.js");var GetProps=__webpack_require__("./tweens/builders/GetProps.js");var GetTargets=__webpack_require__("./tweens/builders/GetTargets.js");var GetValue=__webpack_require__("./utils/object/GetValue.js");var GetValueOp=__webpack_require__("./tweens/builders/GetValueOp.js");var Tween=__webpack_require__("./tweens/tween/Tween.js");var TweenData=__webpack_require__("./tweens/tween/TweenData.js");var TweenBuilder=function(parent,config,defaults)
    {if(defaults===undefined)
    {defaults=Defaults;}
        var targets=(defaults.targets)?defaults.targets:GetTargets(config);var props=GetProps(config);var delay=GetNewValue(config,'delay',defaults.delay);var duration=GetNewValue(config,'duration',defaults.duration);var easeParams=GetValue(config,'easeParams',defaults.easeParams);var ease=GetEaseFunction(GetValue(config,'ease',defaults.ease),easeParams);var hold=GetNewValue(config,'hold',defaults.hold);var repeat=GetNewValue(config,'repeat',defaults.repeat);var repeatDelay=GetNewValue(config,'repeatDelay',defaults.repeatDelay);var yoyo=GetBoolean(config,'yoyo',defaults.yoyo);var flipX=GetBoolean(config,'flipX',defaults.flipX);var flipY=GetBoolean(config,'flipY',defaults.flipY);var data=[];for(var p=0;p<props.length;p++)
    {var key=props[p].key;var value=props[p].value;for(var t=0;t<targets.length;t++)
    {var ops=GetValueOp(key,value);var tweenData=TweenData(targets[t],key,ops.getEnd,ops.getStart,GetEaseFunction(GetValue(value,'ease',ease),easeParams),GetNewValue(value,'delay',delay),GetNewValue(value,'duration',duration),GetBoolean(value,'yoyo',yoyo),GetNewValue(value,'hold',hold),GetNewValue(value,'repeat',repeat),GetNewValue(value,'repeatDelay',repeatDelay),GetBoolean(value,'flipX',flipX),GetBoolean(value,'flipY',flipY));data.push(tweenData);}}
        var tween=new Tween(parent,data,targets);tween.offset=GetAdvancedValue(config,'offset',null);tween.completeDelay=GetAdvancedValue(config,'completeDelay',0);tween.loop=Math.round(GetAdvancedValue(config,'loop',0));tween.loopDelay=Math.round(GetAdvancedValue(config,'loopDelay',0));tween.paused=GetBoolean(config,'paused',false);tween.useFrames=GetBoolean(config,'useFrames',false);var scope=GetValue(config,'callbackScope',tween);var tweenArray=[tween,null];var callbacks=Tween.TYPES;for(var i=0;i<callbacks.length;i++)
    {var type=callbacks[i];var callback=GetValue(config,type,false);if(callback)
    {var callbackScope=GetValue(config,type+'Scope',scope);var callbackParams=GetValue(config,type+'Params',[]);tween.setCallback(type,callback,tweenArray.concat(callbackParams),callbackScope);}}
        return tween;};module.exports=TweenBuilder;}),"./tweens/builders/index.js":(function(module,exports,__webpack_require__){module.exports={GetBoolean:__webpack_require__("./tweens/builders/GetBoolean.js"),GetEaseFunction:__webpack_require__("./tweens/builders/GetEaseFunction.js"),GetNewValue:__webpack_require__("./tweens/builders/GetNewValue.js"),GetProps:__webpack_require__("./tweens/builders/GetProps.js"),GetTargets:__webpack_require__("./tweens/builders/GetTargets.js"),GetTweens:__webpack_require__("./tweens/builders/GetTweens.js"),GetValueOp:__webpack_require__("./tweens/builders/GetValueOp.js"),NumberTweenBuilder:__webpack_require__("./tweens/builders/NumberTweenBuilder.js"),TimelineBuilder:__webpack_require__("./tweens/builders/TimelineBuilder.js"),TweenBuilder:__webpack_require__("./tweens/builders/TweenBuilder.js")};}),"./tweens/index.js":(function(module,exports,__webpack_require__){var CONST=__webpack_require__("./tweens/tween/const.js");var Extend=__webpack_require__("./utils/object/Extend.js");var Tweens={Builders:__webpack_require__("./tweens/builders/index.js"),TweenManager:__webpack_require__("./tweens/TweenManager.js"),Tween:__webpack_require__("./tweens/tween/Tween.js"),TweenData:__webpack_require__("./tweens/tween/TweenData.js"),Timeline:__webpack_require__("./tweens/Timeline.js")};Tweens=Extend(false,Tweens,CONST);module.exports=Tweens;}),"./tweens/tween/Defaults.js":(function(module,exports){var TWEEN_DEFAULTS={targets:null,delay:0,duration:1000,ease:'Power0',easeParams:null,hold:0,repeat:0,repeatDelay:0,yoyo:false,flipX:false,flipY:false};module.exports=TWEEN_DEFAULTS;}),"./tweens/tween/ReservedProps.js":(function(module,exports){module.exports=['callbackScope','completeDelay','delay','duration','ease','easeParams','flipX','flipY','hold','loop','loopDelay','offset','onComplete','onCompleteParams','onCompleteScope','onLoop','onLoopParams','onLoopScope','onRepeat','onRepeatParams','onRepeatScope','onStart','onStartParams','onStartScope','onUpdate','onUpdateParams','onUpdateScope','onYoyo','onYoyoParams','onYoyoScope','paused','props','repeat','repeatDelay','targets','useFrames','yoyo'];}),"./tweens/tween/Tween.js":(function(module,exports,__webpack_require__){var Class=__webpack_require__("./utils/Class.js");var GameObjectCreator=__webpack_require__("./gameobjects/GameObjectCreator.js");var GameObjectFactory=__webpack_require__("./gameobjects/GameObjectFactory.js");var TWEEN_CONST=__webpack_require__("./tweens/tween/const.js");var Tween=new Class({initialize:function Tween(parent,data,targets)
        {this.parent=parent;this.parentIsTimeline=parent.hasOwnProperty('isTimeline');this.data=data;this.totalData=data.length;this.targets=targets;this.totalTargets=targets.length;this.useFrames=false;this.timeScale=1;this.loop=0;this.loopDelay=0;this.loopCounter=0;this.completeDelay=0;this.countdown=0;this.offset=0;this.calculatedOffset=0;this.state=TWEEN_CONST.PENDING_ADD;this._pausedState=TWEEN_CONST.PENDING_ADD;this.paused=false;this.elapsed=0;this.totalElapsed=0;this.duration=0;this.progress=0;this.totalDuration=0;this.totalProgress=0;this.callbacks={onComplete:null,onLoop:null,onRepeat:null,onStart:null,onUpdate:null,onYoyo:null};this.callbackScope;},getValue:function()
        {return this.data[0].current;},setTimeScale:function(value)
        {this.timeScale=value;return this;},getTimeScale:function()
        {return this.timeScale;},isPlaying:function()
        {return(this.state===TWEEN_CONST.ACTIVE);},isPaused:function()
        {return(this.state===TWEEN_CONST.PAUSED);},hasTarget:function(target)
        {return(this.targets.indexOf(target)!==-1);},updateTo:function(key,value,startToCurrent)
        {for(var i=0;i<this.totalData;i++)
        {var tweenData=this.data[i];if(tweenData.key===key)
        {tweenData.end=value;if(startToCurrent)
        {tweenData.start=tweenData.current;}
            break;}}
            return this;},restart:function()
        {if(this.state===TWEEN_CONST.REMOVED)
        {this.seek(0);this.parent.makeActive(this);}
        else
        {this.stop();this.play();}},calcDuration:function()
        {var max=0;var data=this.data;for(var i=0;i<this.totalData;i++)
        {var tweenData=data[i];tweenData.t1=tweenData.duration+tweenData.hold;if(tweenData.yoyo)
        {tweenData.t1+=tweenData.duration;}
            tweenData.t2=tweenData.t1+tweenData.repeatDelay;tweenData.totalDuration=tweenData.delay+tweenData.t1;if(tweenData.repeat===-1)
        {tweenData.totalDuration+=(tweenData.t2*999999999999);}
        else if(tweenData.repeat>0)
        {tweenData.totalDuration+=(tweenData.t2*tweenData.repeat);}
            if(tweenData.totalDuration>max)
            {max=tweenData.totalDuration;}}
            this.duration=max;this.loopCounter=(this.loop===-1)?999999999999:this.loop;if(this.loopCounter>0)
        {this.totalDuration=this.duration+this.completeDelay+((this.duration+this.loopDelay)*this.loopCounter);}
        else
        {this.totalDuration=this.duration+this.completeDelay;}},init:function()
        {var data=this.data;var totalTargets=this.totalTargets;for(var i=0;i<this.totalData;i++)
        {var tweenData=data[i];var target=tweenData.target;var gen=tweenData.gen;tweenData.delay=gen.delay(i,totalTargets,target);tweenData.duration=gen.duration(i,totalTargets,target);tweenData.hold=gen.hold(i,totalTargets,target);tweenData.repeat=gen.repeat(i,totalTargets,target);tweenData.repeatDelay=gen.repeatDelay(i,totalTargets,target);}
            this.calcDuration();this.progress=0;this.totalProgress=0;this.elapsed=0;this.totalElapsed=0;if(this.paused&&!this.parentIsTimeline)
        {this.state=TWEEN_CONST.PENDING_ADD;this._pausedState=TWEEN_CONST.INIT;return false;}
        else
        {this.state=TWEEN_CONST.INIT;return true;}},nextState:function()
        {if(this.loopCounter>0)
        {this.elapsed=0;this.progress=0;this.loopCounter--;var onLoop=this.callbacks.onLoop;if(onLoop)
        {onLoop.params[1]=this.targets;onLoop.func.apply(onLoop.scope,onLoop.params);}
            this.resetTweenData(true);if(this.loopDelay>0)
        {this.countdown=this.loopDelay;this.state=TWEEN_CONST.LOOP_DELAY;}
        else
        {this.state=TWEEN_CONST.ACTIVE;}}
        else if(this.completeDelay>0)
        {this.countdown=this.completeDelay;this.state=TWEEN_CONST.COMPLETE_DELAY;}
        else
        {var onComplete=this.callbacks.onComplete;if(onComplete)
        {onComplete.params[1]=this.targets;onComplete.func.apply(onComplete.scope,onComplete.params);}
            this.state=TWEEN_CONST.PENDING_REMOVE;}},pause:function()
        {if(this.state===TWEEN_CONST.PAUSED)
        {return;}
            this.paused=true;this._pausedState=this.state;this.state=TWEEN_CONST.PAUSED;return this;},play:function(resetFromTimeline)
        {if(this.state===TWEEN_CONST.ACTIVE)
        {return;}
        else if(this.state===TWEEN_CONST.PENDING_REMOVE||this.state===TWEEN_CONST.REMOVED)
        {this.init();this.parent.makeActive(this);resetFromTimeline=true;}
            var onStart=this.callbacks.onStart;if(this.parentIsTimeline)
        {this.resetTweenData(resetFromTimeline);if(this.calculatedOffset===0)
        {if(onStart)
        {onStart.params[1]=this.targets;onStart.func.apply(onStart.scope,onStart.params);}
            this.state=TWEEN_CONST.ACTIVE;}
        else
        {this.countdown=this.calculatedOffset;this.state=TWEEN_CONST.OFFSET_DELAY;}}
        else if(this.paused)
        {this.paused=false;this.parent.makeActive(this);}
        else
        {this.resetTweenData(resetFromTimeline);this.state=TWEEN_CONST.ACTIVE;if(onStart)
        {onStart.params[1]=this.targets;onStart.func.apply(onStart.scope,onStart.params);}
            this.parent.makeActive(this);}},resetTweenData:function(resetFromLoop)
        {var data=this.data;for(var i=0;i<this.totalData;i++)
        {var tweenData=data[i];tweenData.progress=0;tweenData.elapsed=0;tweenData.repeatCounter=(tweenData.repeat===-1)?999999999999:tweenData.repeat;if(resetFromLoop)
        {tweenData.start=tweenData.getStartValue(tweenData.target,tweenData.key,tweenData.start);tweenData.end=tweenData.getEndValue(tweenData.target,tweenData.key,tweenData.end);tweenData.current=tweenData.start;tweenData.state=TWEEN_CONST.PLAYING_FORWARD;}
        else if(tweenData.delay>0)
        {tweenData.elapsed=tweenData.delay;tweenData.state=TWEEN_CONST.DELAY;}
        else
        {tweenData.state=TWEEN_CONST.PENDING_RENDER;}}},resume:function()
        {if(this.state===TWEEN_CONST.PAUSED)
        {this.paused=false;this.state=this._pausedState;}
        else
        {this.play();}
            return this;},seek:function(toPosition)
        {var data=this.data;for(var i=0;i<this.totalData;i++)
        {var ms=this.totalDuration*toPosition;var tweenData=data[i];var progress=0;var elapsed=0;if(ms<=tweenData.delay)
        {progress=0;elapsed=0;}
        else if(ms>=tweenData.totalDuration)
        {progress=1;elapsed=tweenData.duration;}
        else if(ms>tweenData.delay&&ms<=tweenData.t1)
        {ms=Math.max(0,ms-tweenData.delay);progress=ms / tweenData.t1;elapsed=tweenData.duration*progress;}
        else if(ms>tweenData.t1&&ms<tweenData.totalDuration)
        {ms-=tweenData.delay;ms-=tweenData.t1;ms=((ms / tweenData.t2)%1)*tweenData.t2;if(ms>tweenData.repeatDelay)
        {progress=ms / tweenData.t1;elapsed=tweenData.duration*progress;}}
            tweenData.progress=progress;tweenData.elapsed=elapsed;var v=tweenData.ease(tweenData.progress);tweenData.current=tweenData.start+((tweenData.end-tweenData.start)*v);tweenData.target[tweenData.key]=tweenData.current;}},setCallback:function(type,callback,params,scope)
        {this.callbacks[type]={func:callback,scope:scope,params:params};return this;},complete:function(delay)
        {if(delay===undefined){delay=0;}
            if(delay)
            {this.countdown=delay;this.state=TWEEN_CONST.COMPLETE_DELAY;}
            else
            {var onComplete=this.callbacks.onComplete;if(onComplete)
            {onComplete.params[1]=this.targets;onComplete.func.apply(onComplete.scope,onComplete.params);}
                this.state=TWEEN_CONST.PENDING_REMOVE;}},stop:function(resetTo)
        {if(this.state===TWEEN_CONST.ACTIVE)
        {if(resetTo!==undefined)
        {this.seek(resetTo);}}
            if(this.state!==TWEEN_CONST.REMOVED)
            {if(this.state===TWEEN_CONST.PAUSED||this.state===TWEEN_CONST.PENDING_ADD)
            {this.parent._destroy.push(this);this.parent._toProcess++;}
                this.state=TWEEN_CONST.PENDING_REMOVE;}},update:function(timestamp,delta)
        {if(this.state===TWEEN_CONST.PAUSED)
        {return false;}
            if(this.useFrames)
            {delta=1*this.parent.timeScale;}
            delta*=this.timeScale;this.elapsed+=delta;this.progress=Math.min(this.elapsed / this.duration,1);this.totalElapsed+=delta;this.totalProgress=Math.min(this.totalElapsed / this.totalDuration,1);switch(this.state)
        {case TWEEN_CONST.ACTIVE:var stillRunning=false;for(var i=0;i<this.totalData;i++)
            {if(this.updateTweenData(this,this.data[i],delta))
            {stillRunning=true;}}
                if(!stillRunning)
                {this.nextState();}
                break;case TWEEN_CONST.LOOP_DELAY:this.countdown-=delta;if(this.countdown<=0)
            {this.state=TWEEN_CONST.ACTIVE;}
                break;case TWEEN_CONST.OFFSET_DELAY:this.countdown-=delta;if(this.countdown<=0)
            {var onStart=this.callbacks.onStart;if(onStart)
            {onStart.params[1]=this.targets;onStart.func.apply(onStart.scope,onStart.params);}
                this.state=TWEEN_CONST.ACTIVE;}
                break;case TWEEN_CONST.COMPLETE_DELAY:this.countdown-=delta;if(this.countdown<=0)
            {var onComplete=this.callbacks.onComplete;if(onComplete)
            {onComplete.func.apply(onComplete.scope,onComplete.params);}
                this.state=TWEEN_CONST.PENDING_REMOVE;}
                break;}
            return(this.state===TWEEN_CONST.PENDING_REMOVE);},setStateFromEnd:function(tween,tweenData,diff)
        {if(tweenData.yoyo)
        {tweenData.elapsed=diff;tweenData.progress=diff / tweenData.duration;if(tweenData.flipX)
        {tweenData.target.toggleFlipX();}
            if(tweenData.flipY)
            {tweenData.target.toggleFlipY();}
            var onYoyo=tween.callbacks.onYoyo;if(onYoyo)
        {onYoyo.params[1]=tweenData.target;onYoyo.func.apply(onYoyo.scope,onYoyo.params);}
            tweenData.start=tweenData.getStartValue(tweenData.target,tweenData.key,tweenData.start);return TWEEN_CONST.PLAYING_BACKWARD;}
        else if(tweenData.repeatCounter>0)
        {tweenData.repeatCounter--;tweenData.elapsed=diff;tweenData.progress=diff / tweenData.duration;if(tweenData.flipX)
        {tweenData.target.toggleFlipX();}
            if(tweenData.flipY)
            {tweenData.target.toggleFlipY();}
            var onRepeat=tween.callbacks.onRepeat;if(onRepeat)
        {onRepeat.params[1]=tweenData.target;onRepeat.func.apply(onRepeat.scope,onRepeat.params);}
            tweenData.start=tweenData.getStartValue(tweenData.target,tweenData.key,tweenData.start);tweenData.end=tweenData.getEndValue(tweenData.target,tweenData.key,tweenData.start);if(tweenData.repeatDelay>0)
        {tweenData.elapsed=tweenData.repeatDelay-diff;tweenData.current=tweenData.start;tweenData.target[tweenData.key]=tweenData.current;return TWEEN_CONST.REPEAT_DELAY;}
        else
        {return TWEEN_CONST.PLAYING_FORWARD;}}
            return TWEEN_CONST.COMPLETE;},setStateFromStart:function(tween,tweenData,diff)
        {if(tweenData.repeatCounter>0)
        {tweenData.repeatCounter--;tweenData.elapsed=diff;tweenData.progress=diff / tweenData.duration;if(tweenData.flipX)
        {tweenData.target.toggleFlipX();}
            if(tweenData.flipY)
            {tweenData.target.toggleFlipY();}
            var onRepeat=tween.callbacks.onRepeat;if(onRepeat)
        {onRepeat.params[1]=tweenData.target;onRepeat.func.apply(onRepeat.scope,onRepeat.params);}
            tweenData.end=tweenData.getEndValue(tweenData.target,tweenData.key,tweenData.start);if(tweenData.repeatDelay>0)
        {tweenData.elapsed=tweenData.repeatDelay-diff;tweenData.current=tweenData.start;tweenData.target[tweenData.key]=tweenData.current;return TWEEN_CONST.REPEAT_DELAY;}
        else
        {return TWEEN_CONST.PLAYING_FORWARD;}}
            return TWEEN_CONST.COMPLETE;},updateTweenData:function(tween,tweenData,delta)
        {switch(tweenData.state)
        {case TWEEN_CONST.PLAYING_FORWARD:case TWEEN_CONST.PLAYING_BACKWARD:if(!tweenData.target)
            {tweenData.state=TWEEN_CONST.COMPLETE;break;}
                var elapsed=tweenData.elapsed;var duration=tweenData.duration;var diff=0;elapsed+=delta;if(elapsed>duration)
                {diff=elapsed-duration;elapsed=duration;}
                var forward=(tweenData.state===TWEEN_CONST.PLAYING_FORWARD);var progress=elapsed / duration;var v;if(forward)
                {v=tweenData.ease(progress);}
                else
                {v=tweenData.ease(1-progress);}
                tweenData.current=tweenData.start+((tweenData.end-tweenData.start)*v);tweenData.target[tweenData.key]=tweenData.current;tweenData.elapsed=elapsed;tweenData.progress=progress;var onUpdate=tween.callbacks.onUpdate;if(onUpdate)
                {onUpdate.params[1]=tweenData.target;onUpdate.func.apply(onUpdate.scope,onUpdate.params);}
                if(progress===1)
                {if(forward)
                {if(tweenData.hold>0)
                {tweenData.elapsed=tweenData.hold-diff;tweenData.state=TWEEN_CONST.HOLD_DELAY;}
                else
                {tweenData.state=this.setStateFromEnd(tween,tweenData,diff);}}
                else
                {tweenData.state=this.setStateFromStart(tween,tweenData,diff);}}
                break;case TWEEN_CONST.DELAY:tweenData.elapsed-=delta;if(tweenData.elapsed<=0)
            {tweenData.elapsed=Math.abs(tweenData.elapsed);tweenData.state=TWEEN_CONST.PENDING_RENDER;}
                break;case TWEEN_CONST.REPEAT_DELAY:tweenData.elapsed-=delta;if(tweenData.elapsed<=0)
            {tweenData.elapsed=Math.abs(tweenData.elapsed);tweenData.state=TWEEN_CONST.PLAYING_FORWARD;}
                break;case TWEEN_CONST.HOLD_DELAY:tweenData.elapsed-=delta;if(tweenData.elapsed<=0)
            {tweenData.state=this.setStateFromEnd(tween,tweenData,Math.abs(tweenData.elapsed));}
                break;case TWEEN_CONST.PENDING_RENDER:if(tweenData.target)
            {tweenData.start=tweenData.getStartValue(tweenData.target,tweenData.key,tweenData.target[tweenData.key]);tweenData.end=tweenData.getEndValue(tweenData.target,tweenData.key,tweenData.start);tweenData.current=tweenData.start;tweenData.target[tweenData.key]=tweenData.start;tweenData.state=TWEEN_CONST.PLAYING_FORWARD;}
            else
            {tweenData.state=TWEEN_CONST.COMPLETE;}
                break;}
            return(tweenData.state!==TWEEN_CONST.COMPLETE);}});Tween.TYPES=['onComplete','onLoop','onRepeat','onStart','onUpdate','onYoyo'];GameObjectFactory.register('tween',function(config)
    {return this.scene.sys.tweens.add(config);});GameObjectCreator.register('tween',function(config)
    {return this.scene.sys.tweens.create(config);});module.exports=Tween;}),"./tweens/tween/TweenData.js":(function(module,exports){var TweenData=function(target,key,getEnd,getStart,ease,delay,duration,yoyo,hold,repeat,repeatDelay,flipX,flipY)
    {return{target:target,key:key,getEndValue:getEnd,getStartValue:getStart,ease:ease,duration:0,totalDuration:0,delay:0,yoyo:yoyo,hold:0,repeat:0,repeatDelay:0,flipX:flipX,flipY:flipY,progress:0,elapsed:0,repeatCounter:0,start:0,current:0,end:0,t1:0,t2:0,gen:{delay:delay,duration:duration,hold:hold,repeat:repeat,repeatDelay:repeatDelay},state:0};};module.exports=TweenData;}),"./tweens/tween/const.js":(function(module,exports){var TWEEN_CONST={CREATED:0,INIT:1,DELAY:2,OFFSET_DELAY:3,PENDING_RENDER:4,PLAYING_FORWARD:5,PLAYING_BACKWARD:6,HOLD_DELAY:7,REPEAT_DELAY:8,COMPLETE:9,PENDING_ADD:20,PAUSED:21,LOOP_DELAY:22,ACTIVE:23,COMPLETE_DELAY:24,PENDING_REMOVE:25,REMOVED:26};module.exports=TWEEN_CONST;}),"./utils/Class.js":(function(module,exports){function hasGetterOrSetter(def)
    {return(!!def.get&&typeof def.get==='function')||(!!def.set&&typeof def.set==='function');}
        function getProperty(definition,k,isClassDescriptor)
        {var def=(isClassDescriptor)?definition[k]:Object.getOwnPropertyDescriptor(definition,k);if(!isClassDescriptor&&def.value&&typeof def.value==='object')
        {def=def.value;}
            if(def&&hasGetterOrSetter(def))
            {if(typeof def.enumerable==='undefined')
            {def.enumerable=true;}
                if(typeof def.configurable==='undefined')
                {def.configurable=true;}
                return def;}
            else
            {return false;}}
        function hasNonConfigurable(obj,k)
        {var prop=Object.getOwnPropertyDescriptor(obj,k);if(!prop)
        {return false;}
            if(prop.value&&typeof prop.value==='object')
            {prop=prop.value;}
            if(prop.configurable===false)
            {return true;}
            return false;}
        function extend(ctor,definition,isClassDescriptor,extend)
        {for(var k in definition)
        {if(!definition.hasOwnProperty(k))
        {continue;}
            var def=getProperty(definition,k,isClassDescriptor);if(def!==false)
        {var parent=extend||ctor;if(hasNonConfigurable(parent.prototype,k))
        {if(Class.ignoreFinals)
        {continue;}
            throw new Error('cannot override final property \''+k+'\', set Class.ignoreFinals = true to skip');}
            Object.defineProperty(ctor.prototype,k,def);}
        else
        {ctor.prototype[k]=definition[k];}}}
        function mixin(myClass,mixins)
        {if(!mixins)
        {return;}
            if(!Array.isArray(mixins))
            {mixins=[mixins];}
            for(var i=0;i<mixins.length;i++)
            {extend(myClass,mixins[i].prototype||mixins[i]);}}
        function Class(definition)
        {if(!definition)
        {definition={};}
            var initialize;var Extends;if(definition.initialize)
        {if(typeof definition.initialize!=='function')
        {throw new Error('initialize must be a function');}
            initialize=definition.initialize;delete definition.initialize;}
        else if(definition.Extends)
        {var base=definition.Extends;initialize=function()
        {base.apply(this,arguments);};}
        else
        {initialize=function(){};}
            if(definition.Extends)
            {initialize.prototype=Object.create(definition.Extends.prototype);initialize.prototype.constructor=initialize;Extends=definition.Extends;delete definition.Extends;}
            else
            {initialize.prototype.constructor=initialize;}
            var mixins=null;if(definition.Mixins)
        {mixins=definition.Mixins;delete definition.Mixins;}
            mixin(initialize,mixins);extend(initialize,definition,true,Extends);return initialize;}
        Class.extend=extend;Class.mixin=mixin;Class.ignoreFinals=false;module.exports=Class;}),"./utils/NOOP.js":(function(module,exports){var NOOP=function()
    {};module.exports=NOOP;}),"./utils/array/Add.js":(function(module,exports){var Add=function(array,item,limit,callback,context)
    {if(context===undefined){context=array;}
        if(limit>0)
        {var remaining=limit-array.length;if(remaining<=0)
        {return null;}}
        if(!Array.isArray(item))
        {if(array.indexOf(item)===-1)
        {array.push(item);if(callback)
        {callback.call(context,item);}
            return item;}
        else
        {return null;}}
        var itemLength=item.length-1;while(itemLength>=0)
    {if(array.indexOf(item[itemLength])!==-1)
    {item.pop();}
        itemLength--;}
        itemLength=item.length;if(itemLength===0)
    {return null;}
        if(limit>0&&itemLength>remaining)
        {item.splice(remaining);itemLength=remaining;}
        for(var i=0;i<itemLength;i++)
        {var entry=item[i];array.push(entry);if(callback)
        {callback.call(context,entry);}}
        return item;};module.exports=Add;}),"./utils/array/AddAt.js":(function(module,exports){var AddAt=function(array,item,index,limit,callback,context)
    {if(index===undefined){index=0;}
        if(context===undefined){context=array;}
        if(limit>0)
        {var remaining=limit-array.length;if(remaining<=0)
        {return null;}}
        if(!Array.isArray(item))
        {if(array.indexOf(item)===-1)
        {array.splice(index,0,item);if(callback)
        {callback.call(context,item);}
            return item;}
        else
        {return null;}}
        var itemLength=item.length-1;while(itemLength>=0)
    {if(array.indexOf(item[itemLength])!==-1)
    {item.pop();}
        itemLength--;}
        itemLength=item.length;if(itemLength===0)
    {return null;}
        if(limit>0&&itemLength>remaining)
        {item.splice(remaining);itemLength=remaining;}
        for(var i=itemLength-1;i>=0;i--)
        {var entry=item[i];array.splice(index,0,entry);if(callback)
        {callback.call(context,entry);}}
        return item;};module.exports=AddAt;}),"./utils/array/BringToTop.js":(function(module,exports){var BringToTop=function(array,item)
    {var currentIndex=array.indexOf(item);if(currentIndex!==-1&&currentIndex<array.length)
    {array.splice(currentIndex,1);array.push(item);}
        return item;};module.exports=BringToTop;}),"./utils/array/CountAllMatching.js":(function(module,exports,__webpack_require__){var SafeRange=__webpack_require__("./utils/array/SafeRange.js");var CountAllMatching=function(array,property,value,startIndex,endIndex)
    {if(startIndex===undefined){startIndex=0;}
        if(endIndex===undefined){endIndex=array.length;}
        var total=0;if(SafeRange(array,startIndex,endIndex))
    {for(var i=startIndex;i<endIndex;i++)
    {var child=array[i];if(child[property]===value)
    {total++;}}}
        return total;};module.exports=CountAllMatching;}),"./utils/array/Each.js":(function(module,exports){var Each=function(array,callback,context)
    {var i;var args=[null];for(i=3;i<arguments.length;i++)
    {args.push(arguments[i]);}
        for(i=0;i<array.length;i++)
        {args[0]=array[i];callback.apply(context,args);}
        return array;};module.exports=Each;}),"./utils/array/EachInRange.js":(function(module,exports,__webpack_require__){var SafeRange=__webpack_require__("./utils/array/SafeRange.js");var EachInRange=function(array,callback,context,startIndex,endIndex)
    {if(startIndex===undefined){startIndex=0;}
        if(endIndex===undefined){endIndex=array.length;}
        if(SafeRange(array,startIndex,endIndex))
        {var i;var args=[null];for(i=5;i<arguments.length;i++)
        {args.push(arguments[i]);}
            for(i=startIndex;i<endIndex;i++)
            {args[0]=array[i];callback.apply(context,args);}}
        return array;};module.exports=EachInRange;}),"./utils/array/FindClosestInSorted.js":(function(module,exports){var FindClosestInSorted=function(value,array,key)
    {if(!array.length)
    {return NaN;}
    else if(array.length===1)
    {return array[0];}
        var i=1;var low;var high;if(key)
    {if(value<array[0][key])
    {return array[0];}
        while(array[i][key]<value)
        {i++;}}
    else
    {while(array[i]<value)
    {i++;}}
        if(i>array.length)
        {i=array.length;}
        if(key)
        {low=array[i-1][key];high=array[i][key];return((high-value)<=(value-low))?array[i]:array[i-1];}
        else
        {low=array[i-1];high=array[i];return((high-value)<=(value-low))?high:low;}};module.exports=FindClosestInSorted;}),"./utils/array/GetAll.js":(function(module,exports,__webpack_require__){var SafeRange=__webpack_require__("./utils/array/SafeRange.js");var GetAll=function(array,property,value,startIndex,endIndex)
    {if(startIndex===undefined){startIndex=0;}
        if(endIndex===undefined){endIndex=array.length;}
        var output=[];if(SafeRange(array,startIndex,endIndex))
    {for(var i=startIndex;i<endIndex;i++)
    {var child=array[i];if(!property||(property&&value===undefined&&child.hasOwnProperty(property))||(property&&value!==undefined&&child[property]===value))
    {output.push(child);}}}
        return output;};module.exports=GetAll;}),"./utils/array/GetFirst.js":(function(module,exports,__webpack_require__){var SafeRange=__webpack_require__("./utils/array/SafeRange.js");var GetFirst=function(array,property,value,startIndex,endIndex)
    {if(startIndex===undefined){startIndex=0;}
        if(endIndex===undefined){endIndex=array.length;}
        if(SafeRange(array,startIndex,endIndex))
        {for(var i=startIndex;i<endIndex;i++)
        {var child=array[i];if(!property||(property&&value===undefined&&child.hasOwnProperty(property))||(property&&value!==undefined&&child[property]===value))
        {return child;}}}
        return null;};module.exports=GetFirst;}),"./utils/array/GetRandom.js":(function(module,exports){var GetRandom=function(array,startIndex,length)
    {if(startIndex===undefined){startIndex=0;}
        if(length===undefined){length=array.length;}
        var randomIndex=startIndex+Math.floor(Math.random()*length);return(array[randomIndex]===undefined)?null:array[randomIndex];};module.exports=GetRandom;}),"./utils/array/MoveDown.js":(function(module,exports){var MoveDown=function(array,item)
    {var currentIndex=array.indexOf(item);if(currentIndex>0)
    {var item2=array[currentIndex-1];var index2=array.indexOf(item2);array[currentIndex]=item2;array[index2]=item;}
        return array;};module.exports=MoveDown;}),"./utils/array/MoveTo.js":(function(module,exports){var MoveTo=function(array,item,index)
    {var currentIndex=array.indexOf(item);if(currentIndex===-1||index<0||index>=array.length)
    {throw new Error('Supplied index out of bounds');}
        if(currentIndex!==index)
        {array.splice(currentIndex,1);array.splice(index,0,item);}
        return item;};module.exports=MoveTo;}),"./utils/array/MoveUp.js":(function(module,exports){var MoveUp=function(array,item)
    {var currentIndex=array.indexOf(item);if(currentIndex!==-1&&currentIndex<array.length-1)
    {var item2=array[currentIndex+1];var index2=array.indexOf(item2);array[currentIndex]=item2;array[index2]=item;}
        return array;};module.exports=MoveUp;}),"./utils/array/NumberArray.js":(function(module,exports){var NumberArray=function(start,end,prefix,suffix)
    {var result=[];for(var i=start;i<=end;i++)
    {if(prefix||suffix)
    {var key=(prefix)?prefix+i.toString():i.toString();if(suffix)
    {key=key.concat(suffix);}
        result.push(key);}
    else
    {result.push(i);}}
        return result;};module.exports=NumberArray;}),"./utils/array/NumberArrayStep.js":(function(module,exports,__webpack_require__){var RoundAwayFromZero=__webpack_require__("./math/RoundAwayFromZero.js");var NumberArrayStep=function(start,end,step)
    {if(start===undefined){start=0;}
        if(end===undefined){end=null;}
        if(step===undefined){step=1;}
        if(end===null)
        {end=start;start=0;}
        var result=[];var total=Math.max(RoundAwayFromZero((end-start)/(step||1)),0);for(var i=0;i<total;i++)
    {result.push(start);start+=step;}
        return result;};module.exports=NumberArrayStep;}),"./utils/array/QuickSelect.js":(function(module,exports){function swap(arr,i,j)
    {var tmp=arr[i];arr[i]=arr[j];arr[j]=tmp;}
        function defaultCompare(a,b)
        {return a<b?-1:a>b?1:0;}
        var QuickSelect=function(arr,k,left,right,compare)
        {if(left===undefined){left=0;}
            if(right===undefined){right=arr.length-1;}
            if(compare===undefined){compare=defaultCompare;}
            while(right>left)
            {if(right-left>600)
            {var n=right-left+1;var m=k-left+1;var z=Math.log(n);var s=0.5*Math.exp(2*z / 3);var sd=0.5*Math.sqrt(z*s*(n-s)/ n)*(m-n / 2<0?-1:1);var newLeft=Math.max(left,Math.floor(k-m*s / n+sd));var newRight=Math.min(right,Math.floor(k+(n-m)*s / n+sd));QuickSelect(arr,k,newLeft,newRight,compare);}
                var t=arr[k];var i=left;var j=right;swap(arr,left,k);if(compare(arr[right],t)>0)
            {swap(arr,left,right);}
                while(i<j)
                {swap(arr,i,j);i++;j--;while(compare(arr[i],t)<0)
                {i++;}
                    while(compare(arr[j],t)>0)
                    {j--;}}
                if(compare(arr[left],t)===0)
                {swap(arr,left,j);}
                else
                {j++;swap(arr,j,right);}
                if(j<=k)
                {left=j+1;}
                if(k<=j)
                {right=j-1;}}};module.exports=QuickSelect;}),"./utils/array/Range.js":(function(module,exports,__webpack_require__){var GetValue=__webpack_require__("./utils/object/GetValue.js");var Shuffle=__webpack_require__("./utils/array/Shuffle.js");var BuildChunk=function(a,b,qty)
    {var out=[];for(var aIndex=0;aIndex<a.length;aIndex++)
    {for(var bIndex=0;bIndex<b.length;bIndex++)
    {for(var i=0;i<qty;i++)
    {out.push({a:a[aIndex],b:b[bIndex]});}}}
        return out;};var Range=function(a,b,options)
    {var max=GetValue(options,'max',0);var qty=GetValue(options,'qty',1);var random=GetValue(options,'random',false);var randomB=GetValue(options,'randomB',false);var repeat=GetValue(options,'repeat',0);var yoyo=GetValue(options,'yoyo',false);var out=[];if(randomB)
    {Shuffle(b);}
        if(repeat===-1)
        {if(max===0)
        {repeat=0;}
        else
        {var total=(a.length*b.length)*qty;if(yoyo)
        {total*=2;}
            repeat=Math.ceil(max / total);}}
        for(var i=0;i<=repeat;i++)
        {var chunk=BuildChunk(a,b,qty);if(random)
        {Shuffle(chunk);}
            out=out.concat(chunk);if(yoyo)
        {chunk.reverse();out=out.concat(chunk);}}
        if(max)
        {out.splice(max);}
        return out;};module.exports=Range;}),"./utils/array/Remove.js":(function(module,exports,__webpack_require__){var SpliceOne=__webpack_require__("./utils/array/SpliceOne.js");var Remove=function(array,item,callback,context)
    {if(context===undefined){context=array;}
        var index;if(!Array.isArray(item))
    {index=array.indexOf(item);if(index!==-1)
    {SpliceOne(array,index);if(callback)
    {callback.call(context,item);}
        return item;}
    else
    {return null;}}
        var itemLength=item.length-1;while(itemLength>=0)
    {var entry=item[itemLength];index=array.indexOf(entry);if(index!==-1)
    {SpliceOne(array,index);if(callback)
    {callback.call(context,entry);}}
    else
    {item.pop();}
        itemLength--;}
        return item;};module.exports=Remove;}),"./utils/array/RemoveAt.js":(function(module,exports,__webpack_require__){var SpliceOne=__webpack_require__("./utils/array/SpliceOne.js");var RemoveAt=function(array,index,callback,context)
    {if(context===undefined){context=array;}
        if(index<0||index>array.length-1)
        {throw new Error('Index out of bounds');}
        var item=SpliceOne(array,index);if(callback)
    {callback.call(context,item);}
        return item;};module.exports=RemoveAt;}),"./utils/array/RemoveBetween.js":(function(module,exports,__webpack_require__){var SafeRange=__webpack_require__("./utils/array/SafeRange.js");var RemoveBetween=function(array,startIndex,endIndex,callback,context)
    {if(startIndex===undefined){startIndex=0;}
        if(endIndex===undefined){endIndex=array.length;}
        if(context===undefined){context=array;}
        if(SafeRange(array,startIndex,endIndex))
        {var size=endIndex-startIndex;var removed=array.splice(startIndex,size);if(callback)
        {for(var i=0;i<removed.length;i++)
        {var entry=removed[i];callback.call(context,entry);}}
            return removed;}
        else
        {return[];}};module.exports=RemoveBetween;}),"./utils/array/RemoveRandomElement.js":(function(module,exports,__webpack_require__){var SpliceOne=__webpack_require__("./utils/array/SpliceOne.js");var RemoveRandomElement=function(array,start,length)
    {if(start===undefined){start=0;}
        if(length===undefined){length=array.length;}
        var randomIndex=start+Math.floor(Math.random()*length);return SpliceOne(array,randomIndex);};module.exports=RemoveRandomElement;}),"./utils/array/Replace.js":(function(module,exports){var Replace=function(array,oldChild,newChild)
    {var index1=array.indexOf(oldChild);var index2=array.indexOf(newChild);if(index1!==-1&&index2===-1)
    {array[index1]=newChild;return true;}
    else
    {return false;}};module.exports=Replace;}),"./utils/array/RotateLeft.js":(function(module,exports){var RotateLeft=function(array,total)
    {if(total===undefined){total=1;}
        var element=null;for(var i=0;i<total;i++)
    {element=array.shift();array.push(element);}
        return element;};module.exports=RotateLeft;}),"./utils/array/RotateRight.js":(function(module,exports){var RotateRight=function(array,total)
    {if(total===undefined){total=1;}
        var element=null;for(var i=0;i<total;i++)
    {element=array.pop();array.unshift(element);}
        return element;};module.exports=RotateRight;}),"./utils/array/SafeRange.js":(function(module,exports){var SafeRange=function(array,startIndex,endIndex,throwError)
    {var len=array.length;if(startIndex<0||startIndex>len||startIndex>=endIndex||endIndex>len||startIndex+endIndex>len)
    {if(throwError)
    {throw new Error('Range Error: Values outside acceptable range');}
        return false;}
    else
    {return true;}};module.exports=SafeRange;}),"./utils/array/SendToBack.js":(function(module,exports){var SendToBack=function(array,item)
    {var currentIndex=array.indexOf(item);if(currentIndex!==-1&&currentIndex>0)
    {array.splice(currentIndex,1);array.unshift(item);}
        return item;};module.exports=SendToBack;}),"./utils/array/SetAll.js":(function(module,exports,__webpack_require__){var SafeRange=__webpack_require__("./utils/array/SafeRange.js");var SetAll=function(array,property,value,startIndex,endIndex)
    {if(startIndex===undefined){startIndex=0;}
        if(endIndex===undefined){endIndex=array.length;}
        if(SafeRange(array,startIndex,endIndex))
        {for(var i=startIndex;i<endIndex;i++)
        {var entry=array[i];if(entry.hasOwnProperty(property))
        {entry[property]=value;}}}
        return array;};module.exports=SetAll;}),"./utils/array/Shuffle.js":(function(module,exports){var Shuffle=function(array)
    {for(var i=array.length-1;i>0;i--)
    {var j=Math.floor(Math.random()*(i+1));var temp=array[i];array[i]=array[j];array[j]=temp;}
        return array;};module.exports=Shuffle;}),"./utils/array/SpliceOne.js":(function(module,exports){var SpliceOne=function(array,index)
    {if(index>=array.length)
    {return;}
        var len=array.length-1;var item=array[index];for(var i=index;i<len;i++)
    {array[i]=array[i+1];}
        array.length=len;return item;};module.exports=SpliceOne;}),"./utils/array/StableSort.js":(function(module,exports,__webpack_require__){(function(){var stable=function(arr,comp){return exec(arr.slice(),comp);};stable.inplace=function(arr,comp){var result=exec(arr,comp);if(result!==arr){pass(result,null,arr.length,arr);}
        return arr;};function exec(arr,comp){if(typeof(comp)!=='function'){comp=function(a,b){return String(a).localeCompare(b);};}
        var len=arr.length;if(len<=1){return arr;}
        var buffer=new Array(len);for(var chk=1;chk<len;chk*=2){pass(arr,comp,chk,buffer);var tmp=arr;arr=buffer;buffer=tmp;}
        return arr;}
        var pass=function(arr,comp,chk,result){var len=arr.length;var i=0;var dbl=chk*2;var l,r,e;var li,ri;for(l=0;l<len;l+=dbl){r=l+chk;e=r+chk;if(r>len)r=len;if(e>len)e=len;li=l;ri=r;while(true){if(li<r&&ri<e){if(comp(arr[li],arr[ri])<=0){result[i++]=arr[li++];}
        else{result[i++]=arr[ri++];}}
        else if(li<r){result[i++]=arr[li++];}
        else if(ri<e){result[i++]=arr[ri++];}
        else{break;}}}};if(true){module.exports=stable;}
        else{}})();}),"./utils/array/Swap.js":(function(module,exports){var Swap=function(array,item1,item2)
    {if(item1===item2)
    {return;}
        var index1=array.indexOf(item1);var index2=array.indexOf(item2);if(index1<0||index2<0)
    {throw new Error('Supplied items must be elements of the same array');}
        array[index1]=item2;array[index2]=item1;return array;};module.exports=Swap;}),"./utils/array/index.js":(function(module,exports,__webpack_require__){module.exports={Matrix:__webpack_require__("./utils/array/matrix/index.js"),Add:__webpack_require__("./utils/array/Add.js"),AddAt:__webpack_require__("./utils/array/AddAt.js"),BringToTop:__webpack_require__("./utils/array/BringToTop.js"),CountAllMatching:__webpack_require__("./utils/array/CountAllMatching.js"),Each:__webpack_require__("./utils/array/Each.js"),EachInRange:__webpack_require__("./utils/array/EachInRange.js"),FindClosestInSorted:__webpack_require__("./utils/array/FindClosestInSorted.js"),GetAll:__webpack_require__("./utils/array/GetAll.js"),GetFirst:__webpack_require__("./utils/array/GetFirst.js"),GetRandom:__webpack_require__("./utils/array/GetRandom.js"),MoveDown:__webpack_require__("./utils/array/MoveDown.js"),MoveTo:__webpack_require__("./utils/array/MoveTo.js"),MoveUp:__webpack_require__("./utils/array/MoveUp.js"),NumberArray:__webpack_require__("./utils/array/NumberArray.js"),NumberArrayStep:__webpack_require__("./utils/array/NumberArrayStep.js"),QuickSelect:__webpack_require__("./utils/array/QuickSelect.js"),Range:__webpack_require__("./utils/array/Range.js"),Remove:__webpack_require__("./utils/array/Remove.js"),RemoveAt:__webpack_require__("./utils/array/RemoveAt.js"),RemoveBetween:__webpack_require__("./utils/array/RemoveBetween.js"),RemoveRandomElement:__webpack_require__("./utils/array/RemoveRandomElement.js"),Replace:__webpack_require__("./utils/array/Replace.js"),RotateLeft:__webpack_require__("./utils/array/RotateLeft.js"),RotateRight:__webpack_require__("./utils/array/RotateRight.js"),SafeRange:__webpack_require__("./utils/array/SafeRange.js"),SendToBack:__webpack_require__("./utils/array/SendToBack.js"),SetAll:__webpack_require__("./utils/array/SetAll.js"),Shuffle:__webpack_require__("./utils/array/Shuffle.js"),SpliceOne:__webpack_require__("./utils/array/SpliceOne.js"),StableSort:__webpack_require__("./utils/array/StableSort.js"),Swap:__webpack_require__("./utils/array/Swap.js")};}),"./utils/array/matrix/CheckMatrix.js":(function(module,exports){var CheckMatrix=function(matrix)
    {if(!Array.isArray(matrix)||matrix.length<2||!Array.isArray(matrix[0]))
    {return false;}
        var size=matrix[0].length;for(var i=1;i<matrix.length;i++)
    {if(matrix[i].length!==size)
    {return false;}}
        return true;};module.exports=CheckMatrix;}),"./utils/array/matrix/MatrixToString.js":(function(module,exports,__webpack_require__){var Pad=__webpack_require__("./utils/string/Pad.js");var CheckMatrix=__webpack_require__("./utils/array/matrix/CheckMatrix.js");var MatrixToString=function(matrix)
    {var str='';if(!CheckMatrix(matrix))
    {return str;}
        for(var r=0;r<matrix.length;r++)
        {for(var c=0;c<matrix[r].length;c++)
        {var cell=matrix[r][c].toString();if(cell!=='undefined')
        {str+=Pad(cell,2);}
        else
        {str+='?';}
            if(c<matrix[r].length-1)
            {str+=' |';}}
            if(r<matrix.length-1)
            {str+='\n';for(var i=0;i<matrix[r].length;i++)
            {str+='---';if(i<matrix[r].length-1)
            {str+='+';}}
                str+='\n';}}
        return str;};module.exports=MatrixToString;}),"./utils/array/matrix/ReverseColumns.js":(function(module,exports){var ReverseColumns=function(matrix)
    {return matrix.reverse();};module.exports=ReverseColumns;}),"./utils/array/matrix/ReverseRows.js":(function(module,exports){var ReverseRows=function(matrix)
    {for(var i=0;i<matrix.length;i++)
    {matrix[i].reverse();}
        return matrix;};module.exports=ReverseRows;}),"./utils/array/matrix/Rotate180.js":(function(module,exports,__webpack_require__){var RotateMatrix=__webpack_require__("./utils/array/matrix/RotateMatrix.js");var Rotate180=function(matrix)
    {return RotateMatrix(matrix,180);};module.exports=Rotate180;}),"./utils/array/matrix/RotateLeft.js":(function(module,exports,__webpack_require__){var RotateMatrix=__webpack_require__("./utils/array/matrix/RotateMatrix.js");var RotateLeft=function(matrix)
    {return RotateMatrix(matrix,90);};module.exports=RotateLeft;}),"./utils/array/matrix/RotateMatrix.js":(function(module,exports,__webpack_require__){var CheckMatrix=__webpack_require__("./utils/array/matrix/CheckMatrix.js");var TransposeMatrix=__webpack_require__("./utils/array/matrix/TransposeMatrix.js");var RotateMatrix=function(matrix,direction)
    {if(direction===undefined){direction=90;}
        if(!CheckMatrix(matrix))
        {return null;}
        if(typeof direction!=='string')
        {direction=((direction%360)+360)%360;}
        if(direction===90||direction===-270||direction==='rotateLeft')
        {matrix=TransposeMatrix(matrix);matrix.reverse();}
        else if(direction===-90||direction===270||direction==='rotateRight')
        {matrix.reverse();matrix=TransposeMatrix(matrix);}
        else if(Math.abs(direction)===180||direction==='rotate180')
        {for(var i=0;i<matrix.length;i++)
        {matrix[i].reverse();}
            matrix.reverse();}
        return matrix;};module.exports=RotateMatrix;}),"./utils/array/matrix/RotateRight.js":(function(module,exports,__webpack_require__){var RotateMatrix=__webpack_require__("./utils/array/matrix/RotateMatrix.js");var RotateRight=function(matrix)
    {return RotateMatrix(matrix,-90);};module.exports=RotateRight;}),"./utils/array/matrix/TransposeMatrix.js":(function(module,exports){var TransposeMatrix=function(array)
    {var sourceRowCount=array.length;var sourceColCount=array[0].length;var result=new Array(sourceColCount);for(var i=0;i<sourceColCount;i++)
    {result[i]=new Array(sourceRowCount);for(var j=sourceRowCount-1;j>-1;j--)
    {result[i][j]=array[j][i];}}
        return result;};module.exports=TransposeMatrix;}),"./utils/array/matrix/index.js":(function(module,exports,__webpack_require__){module.exports={CheckMatrix:__webpack_require__("./utils/array/matrix/CheckMatrix.js"),MatrixToString:__webpack_require__("./utils/array/matrix/MatrixToString.js"),ReverseColumns:__webpack_require__("./utils/array/matrix/ReverseColumns.js"),ReverseRows:__webpack_require__("./utils/array/matrix/ReverseRows.js"),Rotate180:__webpack_require__("./utils/array/matrix/Rotate180.js"),RotateLeft:__webpack_require__("./utils/array/matrix/RotateLeft.js"),RotateMatrix:__webpack_require__("./utils/array/matrix/RotateMatrix.js"),RotateRight:__webpack_require__("./utils/array/matrix/RotateRight.js"),TransposeMatrix:__webpack_require__("./utils/array/matrix/TransposeMatrix.js")};}),"./utils/index.js":(function(module,exports,__webpack_require__){module.exports={Array:__webpack_require__("./utils/array/index.js"),Objects:__webpack_require__("./utils/object/index.js"),String:__webpack_require__("./utils/string/index.js")};}),"./utils/object/Clone.js":(function(module,exports){var Clone=function(obj)
    {var clone={};for(var key in obj)
    {if(Array.isArray(obj[key]))
    {clone[key]=obj[key].slice(0);}
    else
    {clone[key]=obj[key];}}
        return clone;};module.exports=Clone;}),"./utils/object/Extend.js":(function(module,exports,__webpack_require__){var IsPlainObject=__webpack_require__("./utils/object/IsPlainObject.js");var Extend=function()
    {var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==='boolean')
    {deep=target;target=arguments[1]||{};i=2;}
        if(length===i)
        {target=this;--i;}
        for(;i<length;i++)
        {if((options=arguments[i])!=null)
        {for(name in options)
        {src=target[name];copy=options[name];if(target===copy)
        {continue;}
            if(deep&&copy&&(IsPlainObject(copy)||(copyIsArray=Array.isArray(copy))))
            {if(copyIsArray)
            {copyIsArray=false;clone=src&&Array.isArray(src)?src:[];}
            else
            {clone=src&&IsPlainObject(src)?src:{};}
                target[name]=Extend(deep,clone,copy);}
            else if(copy!==undefined)
            {target[name]=copy;}}}}
        return target;};module.exports=Extend;}),"./utils/object/GetAdvancedValue.js":(function(module,exports,__webpack_require__){var MATH=__webpack_require__("./math/const.js");var GetValue=__webpack_require__("./utils/object/GetValue.js");var GetAdvancedValue=function(source,key,defaultValue)
    {var value=GetValue(source,key,null);if(value===null)
    {return defaultValue;}
    else if(Array.isArray(value))
    {return MATH.RND.pick(value);}
    else if(typeof value==='object')
    {if(value.hasOwnProperty('randInt'))
    {return MATH.RND.integerInRange(value.randInt[0],value.randInt[1]);}
    else if(value.hasOwnProperty('randFloat'))
    {return MATH.RND.realInRange(value.randFloat[0],value.randFloat[1]);}}
    else if(typeof value==='function')
    {return value(key);}
        return value;};module.exports=GetAdvancedValue;}),"./utils/object/GetFastValue.js":(function(module,exports){var GetFastValue=function(source,key,defaultValue)
    {var t=typeof(source);if(!source||t==='number'||t==='string')
    {return defaultValue;}
    else if(source.hasOwnProperty(key)&&source[key]!==undefined)
    {return source[key];}
    else
    {return defaultValue;}};module.exports=GetFastValue;}),"./utils/object/GetMinMaxValue.js":(function(module,exports,__webpack_require__){var GetValue=__webpack_require__("./utils/object/GetValue.js");var Clamp=__webpack_require__("./math/Clamp.js");var GetMinMaxValue=function(source,key,min,max,defaultValue)
    {if(defaultValue===undefined){defaultValue=min;}
        var value=GetValue(source,key,defaultValue);return Clamp(value,min,max);};module.exports=GetMinMaxValue;}),"./utils/object/GetValue.js":(function(module,exports){var GetValue=function(source,key,defaultValue)
    {if(!source||typeof source==='number')
    {return defaultValue;}
    else if(source.hasOwnProperty(key))
    {return source[key];}
    else if(key.indexOf('.'))
    {var keys=key.split('.');var parent=source;var value=defaultValue;for(var i=0;i<keys.length;i++)
    {if(parent.hasOwnProperty(keys[i]))
    {value=parent[keys[i]];parent=parent[keys[i]];}
    else
    {value=defaultValue;break;}}
        return value;}
    else
    {return defaultValue;}};module.exports=GetValue;}),"./utils/object/HasAll.js":(function(module,exports){var HasAll=function(source,keys)
    {for(var i=0;i<keys.length;i++)
    {if(!source.hasOwnProperty(keys[i]))
    {return false;}}
        return true;};module.exports=HasAll;}),"./utils/object/HasAny.js":(function(module,exports){var HasAny=function(source,keys)
    {for(var i=0;i<keys.length;i++)
    {if(source.hasOwnProperty(keys[i]))
    {return true;}}
        return false;};module.exports=HasAny;}),"./utils/object/HasValue.js":(function(module,exports){var HasValue=function(source,key)
    {return(source.hasOwnProperty(key));};module.exports=HasValue;}),"./utils/object/IsPlainObject.js":(function(module,exports){var IsPlainObject=function(obj)
    {if(typeof(obj)!=='object'||obj.nodeType||obj===obj.window)
    {return false;}
        try
        {if(obj.constructor&&!({}).hasOwnProperty.call(obj.constructor.prototype,'isPrototypeOf'))
        {return false;}}
        catch(e)
        {return false;}
        return true;};module.exports=IsPlainObject;}),"./utils/object/Merge.js":(function(module,exports,__webpack_require__){var Clone=__webpack_require__("./utils/object/Clone.js");var Merge=function(obj1,obj2)
    {var clone=Clone(obj1);for(var key in obj2)
    {if(!clone.hasOwnProperty(key))
    {clone[key]=obj2[key];}}
        return clone;};module.exports=Merge;}),"./utils/object/MergeRight.js":(function(module,exports,__webpack_require__){var Clone=__webpack_require__("./utils/object/Clone.js");var MergeRight=function(obj1,obj2)
    {var clone=Clone(obj1);for(var key in obj2)
    {if(clone.hasOwnProperty(key))
    {clone[key]=obj2[key];}}
        return clone;};module.exports=MergeRight;}),"./utils/object/index.js":(function(module,exports,__webpack_require__){module.exports={Clone:__webpack_require__("./utils/object/Clone.js"),Extend:__webpack_require__("./utils/object/Extend.js"),GetAdvancedValue:__webpack_require__("./utils/object/GetAdvancedValue.js"),GetFastValue:__webpack_require__("./utils/object/GetFastValue.js"),GetMinMaxValue:__webpack_require__("./utils/object/GetMinMaxValue.js"),GetValue:__webpack_require__("./utils/object/GetValue.js"),HasAll:__webpack_require__("./utils/object/HasAll.js"),HasAny:__webpack_require__("./utils/object/HasAny.js"),HasValue:__webpack_require__("./utils/object/HasValue.js"),IsPlainObject:__webpack_require__("./utils/object/IsPlainObject.js"),Merge:__webpack_require__("./utils/object/Merge.js"),MergeRight:__webpack_require__("./utils/object/MergeRight.js")};}),"./utils/string/Format.js":(function(module,exports){var Format=function(string,values)
    {return string.replace(/%([0-9]+)/g,function(s,n)
    {return values[Number(n)-1];});};module.exports=Format;}),"./utils/string/Pad.js":(function(module,exports){var Pad=function(str,len,pad,dir)
    {if(len===undefined){len=0;}
        if(pad===undefined){pad=' ';}
        if(dir===undefined){dir=3;}
        str=str.toString();var padlen=0;if(len+1>=str.length)
    {switch(dir)
    {case 1:str=new Array(len+1-str.length).join(pad)+str;break;case 3:var right=Math.ceil((padlen=len-str.length)/ 2);var left=padlen-right;str=new Array(left+1).join(pad)+str+new Array(right+1).join(pad);break;default:str=str+new Array(len+1-str.length).join(pad);break;}}
        return str;};module.exports=Pad;}),"./utils/string/Reverse.js":(function(module,exports){var ReverseString=function(string)
    {return string.split('').reverse().join('');};module.exports=ReverseString;}),"./utils/string/UUID.js":(function(module,exports){var UUID=function()
    {return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(c)
    {var r=Math.random()*16|0;var v=(c==='x')?r:(r&0x3|0x8);return v.toString(16);});};module.exports=UUID;}),"./utils/string/UppercaseFirst.js":(function(module,exports){var UppercaseFirst=function(str)
    {return str&&str[0].toUpperCase()+str.slice(1);};module.exports=UppercaseFirst;}),"./utils/string/index.js":(function(module,exports,__webpack_require__){module.exports={Format:__webpack_require__("./utils/string/Format.js"),Pad:__webpack_require__("./utils/string/Pad.js"),Reverse:__webpack_require__("./utils/string/Reverse.js"),UppercaseFirst:__webpack_require__("./utils/string/UppercaseFirst.js"),UUID:__webpack_require__("./utils/string/UUID.js")};})});});

!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("phaser")):"function"==typeof define&&define.amd?define(["phaser"],e):"object"==typeof exports?exports.NineSlice=e(require("phaser")):t.NineSlice=e(t.Phaser)}(window,function(t){return function(t){var e={};function r(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},r.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=6)}([function(e,r){e.exports=t},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EVENTS=void 0;var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),o=a(r(0)),n=a(r(4));function a(t){return t&&t.__esModule?t:{default:t}}var s=function(t){var e=t;if("number"==typeof e.sourceLayout.width){var r=e.sourceLayout,i=r.width,o=r.height;e.sourceLayout={topLeft:{width:i,height:o}}}var n=e.sourceLayout;n.topRight=n.topRight||n.topLeft,n.bottomRight=n.bottomRight||n.topLeft,n.bottomLeft=n.bottomLeft||n.topLeft;var a=Math.max(n.topLeft.height,n.topRight.height),s=Math.max(n.topRight.width,n.bottomRight.width),u=Math.max(n.bottomLeft.height,n.bottomRight.height),h=Math.max(n.topLeft.width,n.bottomLeft.width);if(e.safeOffsets||(e.safeOffsets={top:a,right:s,bottom:u,left:h}),void 0===e.minSizing||!1!==e.minSizing){var f=e.safeOffsets;e.minSizing={width:f?Math.max(f.left+f.right,h+s):h+s,height:f?Math.max(f.top+f.bottom,a+u):a+u}}else e.minSizing=!1;return e},u=function(t){return{tl:{x:t.topLeft.width,y:t.topLeft.height},tr:{x:t.topRight.width,y:t.topRight.height},bl:{x:t.bottomLeft.width,y:t.bottomLeft.height},br:{x:t.bottomRight.width,y:t.bottomRight.height}}},h="__BASE",f="__MISSING",l=e.EVENTS={UPDATE_SAFE_BOUNDS:"updatesafebounds"},c=function(t){function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var a=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,0,0,32,32));a.initFrames=a.initFrames.bind(a),a.getUsableBounds=a.getUsableBounds.bind(a),a.drawFrames=a.drawFrames.bind(a),a.resize=a.resize.bind(a),a.updateSafeBounds=a.updateSafeBounds.bind(a),a.enableDebugDraw=a.enableDebugDraw.bind(a),a.events=new o.default.Events.EventEmitter,a.sliceConfig=s(r),a._safeBounds=new o.default.Geom.Rectangle;var u=a.sliceConfig,l=u.sourceKey,c=u.sourceFrame;if(a.sourceTex=t.sys.textures.get(a.sliceConfig.sourceKey),!l)throw new Error("NineSlice requires a texture sourceKey to be specified.");if(!a.sourceTex||a.sourceTex.key===f)throw new Error("Expected source image "+l+" not found.");a._framePrefix=""+(0,n.default)(JSON.stringify({sourceKey:l,sourceFrame:c},404)),a.mkFrameName=function(t){return a._framePrefix+"-"+t},a._frameCache={};var d="string"==typeof c||"number"==typeof c?c:h;a.sourceFrame=a.sourceTex.get(d),a.initFrames(),a._initalized=!0;var y=i.x,b=i.y,g=i.width,p=i.height;return a.setPosition(y||0,b||0),a.resize(g||a.sourceFrame.width,p||a.sourceFrame.height),a.updateSafeBounds(),a}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o.default.GameObjects.RenderTexture),i(e,[{key:"updateSafeBounds",value:function(){if(this._initalized){var t=this.sliceConfig.safeOffsets,e=t.top,r=t.right,i=t.bottom,o=t.left,n=this.x+o,a=this.y+e,s=this.width-(o+r),u=this.height-(e+i),h=this._safeBounds,f=h.x,c=h.y,d=h.width,y=h.height;n===f&&a===c&&s===d&&u===y||(this._safeBounds.setTo(this.x+o,this.y+e,this.width-(o+r),this.height-(e+i)),this.events.emit(l.UPDATE_SAFE_BOUNDS,this,this._safeBounds)),this._g&&(this._g.lineStyle(1,65280),this._g.strokeRectShape(this._safeBounds))}}},{key:"resize",value:function(t,r){var i=(this.sliceConfig||{}).minSizing,o=i?Math.max(i.height,r):r,n=i?Math.max(i.width,t):t;if(o>r||n>t){var a="Attempted to set NineSlice size less than minimum ("+t+"x"+r+").";/*console.error(a)*/}(function t(e,r,i){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,r);if(void 0===o){var n=Object.getPrototypeOf(e);return null===n?void 0:t(n,r,i)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(i):void 0})(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"resize",this).call(this,n,o),this._initalized&&(this._g&&this._g.clear(),this.drawFrames(),this.updateSafeBounds())}},{key:"initFrames",value:function(){var t=this,e=this.sourceTex,r=this.sourceFrame.width,i=this.sourceFrame.height,o=this.sourceFrame.cutX,n=this.sourceFrame.cutY,a=function(r,i,a,s,u){var h=t.mkFrameName(r);e.has(h)?t._frameCache[r]=e.frames[h]:t._frameCache[r]=e.add(h,0,o+i,n+a,s,u)},s=u(this.sliceConfig.sourceLayout);a("topLeft",0,0,s.tl.x,s.tl.y),a("topRight",r-s.tr.x,0,s.tr.x,s.tr.y),a("bottomRight",r-s.br.x,i-s.br.y,s.br.x,s.br.y),a("bottomLeft",0,i-s.bl.y,s.bl.x,s.bl.y),a("topMiddle",s.tl.x,0,r-(s.tl.x+s.tr.x),Math.max(s.tl.y,s.tr.y)),a("bottomMiddle",s.bl.x,i-Math.max(s.bl.y,s.br.y),r-(s.bl.x+s.br.x),Math.max(s.bl.y,s.br.y)),a("leftMiddle",0,s.tl.y,Math.max(s.tl.x,s.bl.x),i-(s.tl.y+s.bl.y)),a("rightMiddle",r-Math.max(s.tr.x,s.br.x),s.tr.y,Math.max(s.tr.x,s.br.x),i-s.tr.y-s.br.y);var h=Math.min(s.tl.x,s.bl.x),f=Math.min(s.tl.y,s.tr.y);a("center",h,f,r-h-Math.min(s.tr.x,s.br.x),i-f-Math.min(s.br.y,s.bl.y))}},{key:"getUsableBounds",value:function(){return this._initalized?this._safeBounds:null}},{key:"drawFrames",value:function(){var t=this;if(this._initalized){this._g&&this._g.lineStyle(1,16711680);var e=u(this.sliceConfig.sourceLayout),r=this._frameCache,i=function(e,r,i,o,n){if(o>0&&n>0){t._g&&t._g.strokeRect(t.x+r,t.y+i,o,n);var a=t.scene.make.image({key:t.sourceTex.key,frame:e.name,x:0,y:0}),s=o/e.width,u=n/e.height;a.setOrigin(0).setScale(s,u),t.draw(a,r,i),a.destroy()}},o=Math.min(e.tl.x,e.bl.x),n=Math.min(e.tr.x,e.br.x),a=Math.min(e.tl.y,e.tr.y),s=Math.min(e.bl.y,e.br.y);this.clear(),i(r.center,o,a,this.width-o-n,this.height-a-s),i(r.topMiddle,e.tl.x,0,this.width-e.tl.x-e.tr.x,r.topMiddle.height),i(r.bottomMiddle,e.bl.x,this.height-r.bottomMiddle.height,this.width-e.bl.x-e.br.x,r.bottomMiddle.height),i(r.leftMiddle,0,e.tl.y,r.leftMiddle.width,this.height-e.tl.y-e.bl.y),i(r.rightMiddle,this.width-e.tr.x,e.tr.y,r.rightMiddle.width,this.height-e.tr.y-e.br.y),i(r.topLeft,0,0,e.tl.x,e.tl.y),i(r.topRight,this.width-e.tr.x,0,e.tr.x,e.tr.y),i(r.bottomRight,this.width-e.br.x,this.height-e.br.y,e.br.x,e.br.y),i(r.bottomLeft,0,this.height-e.bl.y,e.bl.x,e.bl.y)}}},{key:"enableDebugDraw",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._g&&this._g.clear(),this._g=t?this.scene.add.graphics(this.x,this.y):null,this.drawFrames(),this.updateSafeBounds()}},{key:"y",get:function(){return this._y},set:function(t){this._y!==t&&(this._g&&(this._g.clear(),this.drawFrames()),this._y=t,this.updateSafeBounds())}},{key:"x",get:function(){return this._x},set:function(t){this._x!==t&&(this._g&&(this._g.clear(),this.drawFrames()),this._x=t,this.updateSafeBounds())}}]),e}();e.default=c},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=function(t){switch(t.length){case 1:return[t[0],t[0],t[0],t[0]];case 2:return[t[0],t[1],t[0],t[1]];case 3:return[t[0],t[1],t[2],t[1]];case 4:return t}throw new Error("Received ${arr.length} offset values, expected 1 to 4.")}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],i=!0,o=!1,n=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);i=!0);}catch(t){o=!0,n=t}finally{try{!i&&s.return&&s.return()}finally{if(o)throw n}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),n=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),a=h(r(0)),s=h(r(1)),u=h(r(2));function h(t){return t&&t.__esModule?t:{default:t}}var f=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return t.registerGameObject("nineslice",r.addNineSlice,r.makeNineSlice),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,a.default.Plugins.BasePlugin),n(e,[{key:"addNineSlice",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];var i=l(this.scene,e);return this.displayList.add(i),i}},{key:"makeNineSlice",value:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return l(this.scene,e)}}]),e}();e.default=f;var l=function(t,e){if(2===e.length)return new s.default(t,e[0],e[1]);if(e.length<6)throw new Error("Expected at least 6 arguments to NineSlice creator, received "+e.length+".");e.length>7&&console.error("Expected less than 7 arguments for NineSlice creation, received "+e.length+".");var r=o(e,6),n=r[0],a=r[1],h=r[2],f=r[3],l=r[4],c=r[5],d={},y={x:n,y:a,width:h,height:f};if("string"==typeof l)d.sourceKey=l;else{var b=l.key,g=l.frame;d.sourceKey=b,"string"!=typeof g&&"number"!=typeof g||(d.sourceFrame=l.frame)}if("number"==typeof c)d.sourceLayout={width:c,height:c};else if(Array.isArray(c)){var p=(0,u.default)(c),m=o(p,4),x=m[0],v=m[1],_=m[2],w=m[3];d.sourceLayout={topLeft:{width:w,height:x},topRight:{width:v,height:x},bottomRight:{width:v,height:_},bottomLeft:{width:w,height:_}}}else d.sourceLayout=c;if(e.length>6)if("number"==typeof e[6]){var S=e[6];d.safeOffsets={top:S,right:S,bottom:S,left:S}}else{if(!Array.isArray(e[6]))throw new Error("Expected argument number or array for argument 7, got "+i(e[6])+".");var O=(0,u.default)(e[6]),M=o(O,4),j=M[0],E=M[1],P=M[2],L=M[3];d.safeOffsets={top:j,right:E,bottom:P,left:L}}return new s.default(t,d,y)},c={key:"NineSlice",plugin:f,start:!0};f.DefaultCfg=c},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=function(t,e){var r,i,o,n,a,s,u,h;for(r=3&t.length,i=t.length-r,o=e,a=3432918353,s=461845907,h=0;h<i;)u=255&t.charCodeAt(h)|(255&t.charCodeAt(++h))<<8|(255&t.charCodeAt(++h))<<16|(255&t.charCodeAt(++h))<<24,++h,o=27492+(65535&(n=5*(65535&(o=(o^=u=(65535&(u=(u=(65535&u)*a+(((u>>>16)*a&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295)<<13|o>>>19))+((5*(o>>>16)&65535)<<16)&4294967295))+((58964+(n>>>16)&65535)<<16);switch(u=0,r){case 3:u^=(255&t.charCodeAt(h+2))<<16;case 2:u^=(255&t.charCodeAt(h+1))<<8;case 1:o^=u=(65535&(u=(u=(65535&(u^=255&t.charCodeAt(h)))*a+(((u>>>16)*a&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295}return o^=t.length,o=2246822507*(65535&(o^=o>>>16))+((2246822507*(o>>>16)&65535)<<16)&4294967295,o=3266489909*(65535&(o^=o>>>13))+((3266489909*(o>>>16)&65535)<<16)&4294967295,(o^=o>>>16)>>>0}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(1);Object.defineProperty(e,"NineSlice",{enumerable:!0,get:function(){return n(i).default}}),Object.defineProperty(e,"EVENTS",{enumerable:!0,get:function(){return i.EVENTS}});var o=r(3);function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"Plugin",{enumerable:!0,get:function(){return n(o).default}})},function(t,e,r){t.exports=r(5)}])});

class GameAnalytics {

    sendEvent(name, params) {
        if (!params)
            params = {};
        params.eventCategory = name;
        if (typeof ga != "undefined")
            ga('send', 'event', params);
    }

    sendServerError(error, type) {
        console.warn("sendServerError", error);

        this.sendEvent("ServerError", {
            error: error.code,
            message: error.message,
            type: type
        });
    }
}

const gameAnalytics = new GameAnalytics();

!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.UnnyNet=t():e.UnnyNet=t()}(window,(function(){return function(e){var t=window.webpackHotUpdateUnnyNet;window.webpackHotUpdateUnnyNet=function(e,n){!function(e,t){if(g[e]&&_[e]){for(var n in _[e]=!1,t)Object.prototype.hasOwnProperty.call(t,n)&&(h[n]=t[n]);0==--m&&0===y&&C()}}(e,n),t&&t(e,n)};var n,a=!0,o="8688e9a3d162a8561dc2",r=1e4,i={},u=[],s=[];function l(e){var t=I[e];if(!t)return A;function a(a){return t.hot.active?(I[a]?-1===I[a].parents.indexOf(e)&&I[a].parents.push(e):(u=[e],n=a),-1===t.children.indexOf(a)&&t.children.push(a)):(console.warn("[HMR] unexpected require("+a+") from disposed module "+e),u=[]),A(a)}function o(e){return{configurable:!0,enumerable:!0,get:function(){return A[e]},set:function(t){A[e]=t}}}for(var r in A)Object.prototype.hasOwnProperty.call(A,r)&&"e"!==r&&"t"!==r&&Object.defineProperty(a,r,o(r));return a.e=function(e){return"ready"===d&&f("prepare"),y++,A.e(e).then(t,(function(e){throw t(),e}));function t(){y--,"prepare"===d&&(b[e]||O(e),0===y&&0===m&&C())}},a.t=function(e,t){return 1&t&&(e=a(e)),A.t(e,-2&t)},a}var c=[],d="idle";function f(e){d=e;for(var t=0;t<c.length;t++)c[t].call(null,e)}var p,h,v,m=0,y=0,b={},_={},g={};function k(e){return+e+""===e?+e:e}function w(e){if("idle"!==d)throw new Error("check() is only allowed in idle status");return a=e,f("check"),function(e){return e=e||1e4,new Promise((function(t,n){if("undefined"==typeof XMLHttpRequest)return n(new Error("No browser support"));try{var a=new XMLHttpRequest,r=A.p+""+o+".hot-update.json";a.open("GET",r,!0),a.timeout=e,a.send(null)}catch(e){return n(e)}a.onreadystatechange=function(){if(4===a.readyState)if(0===a.status)n(new Error("Manifest request to "+r+" timed out."));else if(404===a.status)t();else if(200!==a.status&&304!==a.status)n(new Error("Manifest request to "+r+" failed."));else{try{var e=JSON.parse(a.responseText)}catch(e){return void n(e)}t(e)}}}))}(r).then((function(e){if(!e)return f("idle"),null;_={},b={},g=e.c,v=e.h,f("prepare");var t=new Promise((function(e,t){p={resolve:e,reject:t}}));return h={},O(0),"prepare"===d&&0===y&&0===m&&C(),t}))}function O(e){g[e]?(_[e]=!0,m++,function(e){var t=document.createElement("script");t.charset="utf-8",t.src=A.p+""+e+"."+o+".hot-update.js",document.head.appendChild(t)}(e)):b[e]=!0}function C(){f("ready");var e=p;if(p=null,e)if(a)Promise.resolve().then((function(){return P(a)})).then((function(t){e.resolve(t)}),(function(t){e.reject(t)}));else{var t=[];for(var n in h)Object.prototype.hasOwnProperty.call(h,n)&&t.push(k(n));e.resolve(t)}}function P(t){if("ready"!==d)throw new Error("apply() is only allowed in ready status");var n,a,r,s,l;function c(e){for(var t=[e],n={},a=t.map((function(e){return{chain:[e],id:e}}));0<a.length;){var o=a.pop(),r=o.id,i=o.chain;if((s=I[r])&&!s.hot._selfAccepted){if(s.hot._selfDeclined)return{type:"self-declined",chain:i,moduleId:r};if(s.hot._main)return{type:"unaccepted",chain:i,moduleId:r};for(var u=0;u<s.parents.length;u++){var l=s.parents[u],c=I[l];if(c){if(c.hot._declinedDependencies[r])return{type:"declined",chain:i.concat([l]),moduleId:r,parentId:l};-1===t.indexOf(l)&&(c.hot._acceptedDependencies[r]?(n[l]||(n[l]=[]),p(n[l],[r])):(delete n[l],t.push(l),a.push({chain:i.concat([l]),id:l})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:n}}function p(e,t){for(var n=0;n<t.length;n++){var a=t[n];-1===e.indexOf(a)&&e.push(a)}}function m(){console.warn("[HMR] unexpected require("+O.moduleId+") to disposed module")}t=t||{};var y={},b=[],_={};for(var w in h)if(Object.prototype.hasOwnProperty.call(h,w)){var O;l=k(w);var C=!1,P=!1,E=!1,R="";switch((O=h[w]?c(l):{type:"disposed",moduleId:w}).chain&&(R="\nUpdate propagation: "+O.chain.join(" -> ")),O.type){case"self-declined":t.onDeclined&&t.onDeclined(O),t.ignoreDeclined||(C=new Error("Aborted because of self decline: "+O.moduleId+R));break;case"declined":t.onDeclined&&t.onDeclined(O),t.ignoreDeclined||(C=new Error("Aborted because of declined dependency: "+O.moduleId+" in "+O.parentId+R));break;case"unaccepted":t.onUnaccepted&&t.onUnaccepted(O),t.ignoreUnaccepted||(C=new Error("Aborted because "+l+" is not accepted"+R));break;case"accepted":t.onAccepted&&t.onAccepted(O),P=!0;break;case"disposed":t.onDisposed&&t.onDisposed(O),E=!0;break;default:throw new Error("Unexception type "+O.type)}if(C)return f("abort"),Promise.reject(C);if(P)for(l in _[l]=h[l],p(b,O.outdatedModules),O.outdatedDependencies)Object.prototype.hasOwnProperty.call(O.outdatedDependencies,l)&&(y[l]||(y[l]=[]),p(y[l],O.outdatedDependencies[l]));E&&(p(b,[O.moduleId]),_[l]=m)}var S,T=[];for(a=0;a<b.length;a++)l=b[a],I[l]&&I[l].hot._selfAccepted&&_[l]!==m&&T.push({module:l,errorHandler:I[l].hot._selfAccepted});f("dispose"),Object.keys(g).forEach((function(e){!1===g[e]&&function(e){delete installedChunks[e]}(e)}));for(var N,D,j=b.slice();0<j.length;)if(l=j.pop(),s=I[l]){var q={},M=s.hot._disposeHandlers;for(r=0;r<M.length;r++)(n=M[r])(q);for(i[l]=q,s.hot.active=!1,delete I[l],delete y[l],r=0;r<s.children.length;r++){var F=I[s.children[r]];F&&0<=(S=F.parents.indexOf(l))&&F.parents.splice(S,1)}}for(l in y)if(Object.prototype.hasOwnProperty.call(y,l)&&(s=I[l]))for(D=y[l],r=0;r<D.length;r++)N=D[r],0<=(S=s.children.indexOf(N))&&s.children.splice(S,1);for(l in f("apply"),o=v,_)Object.prototype.hasOwnProperty.call(_,l)&&(e[l]=_[l]);var G=null;for(l in y)if(Object.prototype.hasOwnProperty.call(y,l)&&(s=I[l])){D=y[l];var U=[];for(a=0;a<D.length;a++)if(N=D[a],n=s.hot._acceptedDependencies[N]){if(-1!==U.indexOf(n))continue;U.push(n)}for(a=0;a<U.length;a++){n=U[a];try{n(D)}catch(n){t.onErrored&&t.onErrored({type:"accept-errored",moduleId:l,dependencyId:D[a],error:n}),t.ignoreErrored||(G=G||n)}}}for(a=0;a<T.length;a++){var L=T[a];l=L.module,u=[l];try{A(l)}catch(a){if("function"==typeof L.errorHandler)try{L.errorHandler(a)}catch(n){t.onErrored&&t.onErrored({type:"self-accept-error-handler-errored",moduleId:l,error:n,originalError:a}),t.ignoreErrored||(G=G||n),G=G||a}else t.onErrored&&t.onErrored({type:"self-accept-errored",moduleId:l,error:a}),t.ignoreErrored||(G=G||a)}}return G?(f("fail"),Promise.reject(G)):(f("idle"),new Promise((function(e){e(b)})))}var I={};function A(t){if(I[t])return I[t].exports;var a=I[t]={i:t,l:!1,exports:{},hot:function(e){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:n!==e,active:!0,accept:function(e,n){if(void 0===e)t._selfAccepted=!0;else if("function"==typeof e)t._selfAccepted=e;else if("object"==typeof e)for(var a=0;a<e.length;a++)t._acceptedDependencies[e[a]]=n||function(){};else t._acceptedDependencies[e]=n||function(){}},decline:function(e){if(void 0===e)t._selfDeclined=!0;else if("object"==typeof e)for(var n=0;n<e.length;n++)t._declinedDependencies[e[n]]=!0;else t._declinedDependencies[e]=!0},dispose:function(e){t._disposeHandlers.push(e)},addDisposeHandler:function(e){t._disposeHandlers.push(e)},removeDisposeHandler:function(e){var n=t._disposeHandlers.indexOf(e);0<=n&&t._disposeHandlers.splice(n,1)},check:w,apply:P,status:function(e){if(!e)return d;c.push(e)},addStatusHandler:function(e){c.push(e)},removeStatusHandler:function(e){var t=c.indexOf(e);0<=t&&c.splice(t,1)},data:i[e]};return n=void 0,t}(t),parents:(s=u,u=[],s),children:[]};return e[t].call(a.exports,a,a.exports,l(t)),a.l=!0,a.exports}return A.m=e,A.c=I,A.d=function(e,t,n){A.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},A.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},A.t=function(e,t){if(1&t&&(e=A(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(A.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)A.d(n,a,function(t){return e[t]}.bind(null,a));return n},A.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return A.d(t,"a",t),t},A.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},A.p="",A.h=function(){return o},l(10)(A.s=10)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=s(n(4)),r=s(n(1)),i=n(6),u=s(i);function s(e){return e&&e.__esModule?e:{default:e}}var l=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(c,o.default),function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(c,null,[{key:"initialize",value:function(e,t){c.instance=new c(e,t)}},{key:"openLeaderboards",value:function(e){o.default.evaluateCommand(r.default.Command.OpenLeaderBoards,!0,e)}},{key:"openAchievements",value:function(e){o.default.evaluateCommand(r.default.Command.OpenAchievements,!0,e)}},{key:"openFriends",value:function(e){o.default.evaluateCommand(r.default.Command.OpenFriends,!0,e)}},{key:"openChannel",value:function(e,t){var n=r.default.GetCommand(r.default.Command.OpenChannel).format(e);o.default.evaluateCodeInJavaScript(new u.default(r.default.Command.OpenChannel,n,!0,t))}},{key:"openGuilds",value:function(e){o.default.evaluateCommand(r.default.Command.OpenGuilds,!0,e)}},{key:"openMyGuild",value:function(e){o.default.evaluateCommand(r.default.Command.OpenMyGuild,!0,e)}},{key:"authorizeWithCredentials",value:function(e,t,n,a){var i=r.default.GetCommand(r.default.Command.AuthorizeWithCredentials).format(e,t,n);o.default.evaluateCodeInJavaScript(new u.default(r.default.Command.AuthorizeWithCredentials,i,!1,a),!0)}},{key:"authorizeAsGuest",value:function(e,t){var n=r.default.GetCommand(r.default.Command.AuthorizeAsGuest).format(e);o.default.evaluateCodeInJavaScript(new u.default(r.default.Command.AuthorizeAsGuest,n,!1,t),!0)}},{key:"authorizeWithCustomId",value:function(e,t,n){var a=r.default.GetCommand(r.default.Command.AuthorizeWithCustomId).format(e,t);o.default.evaluateCodeInJavaScript(new u.default(r.default.Command.AuthorizeWithCustomId,a,!1,n),!0)}},{key:"forceLogout",value:function(e){o.default.evaluateCommand(r.default.Command.ForceLogout,!1,e)}},{key:"getGuildInfo",value:function(e,t){var n=r.default.GetCommand(r.default.Command.GetGuildInfo).format(e?1:0);o.default.evaluateCodeInJavaScript(new i.UnnyCommandInfoDelayed(r.default.Command.GetGuildInfo,n,t))}},{key:"getAchievementsInfo",value:function(e){var t=r.default.GetCommand(r.default.Command.GetAchievementsInfo);o.default.evaluateCodeInJavaScript(new i.UnnyCommandInfoDelayed(r.default.Command.GetAchievementsInfo,t,e))}},{key:"getPlayerPublicInfo",value:function(e){var t=r.default.GetCommand(r.default.Command.GetPlayerPublicInfo);o.default.evaluateCodeInJavaScript(new i.UnnyCommandInfoDelayed(r.default.Command.GetPlayerPublicInfo,t,e))}},{key:"getLeaderboardScores",value:function(e,t){var n=r.default.GetCommand(r.default.Command.GetLeaderboardScores).format(e);o.default.evaluateCodeInJavaScript(new i.UnnyCommandInfoDelayed(r.default.Command.GetLeaderboardScores,n,t))}},{key:"sendMessageToChannel",value:function(e,t,n){if(t){var a=r.default.GetCommand(r.default.Command.SendMessage).format(e,t);o.default.evaluateCodeInJavaScript(new u.default(r.default.Command.SendMessage,a,!1,n))}}},{key:"reportLeaderboards",value:function(e,t,n,a){n=n?encodeURIComponent(n):"";var u=r.default.GetCommand(r.default.Command.ReportLeaderboardScoresAsync).format(e,t,n);o.default.evaluateCodeInJavaScript(new i.UnnyCommandInfoDelayed(r.default.Command.ReportLeaderboardScoresAsync,u,a))}},{key:"reportAchievements",value:function(e,t,n){var a=r.default.GetCommand(r.default.Command.ReportAchievementProgressAsync).format(e,t);o.default.evaluateCodeInJavaScript(new i.UnnyCommandInfoDelayed(r.default.Command.ReportAchievementProgressAsync,a,n))}},{key:"addGuildExperience",value:function(e,t){var n=r.default.GetCommand(r.default.Command.AddGuildExperience).format(e);o.default.evaluateCodeInJavaScript(new u.default(r.default.Command.AddGuildExperience,n,!1,t))}},{key:"authorize",value:function(e,t,n){c.instance.API.authWithLogin(e,t,n)}},{key:"save",value:function(e,t,n,a,o){c.instance.API.save(e,t,n,a,o)}},{key:"load",value:function(e,t,n){c.instance.API.load(e,t,n)}},{key:"purchaseProduct",value:function(e,t){c.instance.API.purchaseProduct(e,t)}},{key:"completeNutakuPurchase",value:function(e,t,n,a){c.instance.API.completeNutakuPurchase(e,t,n,a)}},{key:"completeNutakuPurchase2",value:function(e,t,n,a){c.instance.API.completeNutakuPurchase2(e,t,n,a)}},{key:"getPurchases",value:function(e,t){c.instance.API.getPurchases(e,t)}},{key:"claimPurchase",value:function(e,t,n,a){c.instance.API.claimPurchase(e,t,n,a)}},{key:"claimPurchase2",value:function(e,t,n,a){c.instance.API.claimPurchase2(e,t,n,a)}}]),c);function c(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(c.__proto__||Object.getPrototypeOf(c)).apply(this,arguments))}l.instance=null,t.default=l},function(e,t,n){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0});function o(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}t.Errors={NotInitialized:-1,Unknown:1,NotAuthorized:2,NoMessage:3,NoChannel:4,UnnynetNotReady:5,NoGameId:6,NoSuchLeaderboard:7,NoLeaderboardsForTheGame:8,NoAchievementsForTheGame:9,NoGuildsForTheGame:10,NotInGuild:11,NoSuchAchievement:12,WrongAchievementType:13,AchievementIsNotPublished:14,LeaderboardReportsTooOften:15,NoAccessToken:16};var i=(function(e,t,n){t&&o(e.prototype,t),n&&o(e,n)}(u,null,[{key:"GetCommand",value:function(e){return u.jsCommands[e]}},{key:"getResponceData",value:function(e){var t={};return e.error?(t.success=!1,t.error=JSON.parse(e.error)):t.success=!0,e.data&&(t.data=JSON.parse(e.data)),t}},{key:"getErrorResponse",value:function(e,t){return{success:!1,error:{code:e,message:1<arguments.length&&void 0!==t?t:""}}}},{key:"getSuccessResponse",value:function(e){var t=0<arguments.length&&void 0!==e?e:null,n={success:!0};return t&&(n.data=t),n}}]),u);function u(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u)}i.Command={OpenLeaderBoards:1,OpenAchievements:2,OpenFriends:3,OpenChannel:4,OpenGuilds:5,OpenMyGuild:6,SetSafeArea:7,SendMessage:20,UnnyNetWasOpened:30,ReportLeaderboardScoresAsync:40,ReportAchievementProgressAsync:41,AddGuildExperience:60,RequestFailed:70,RequestSucceeded:71,RequestReply:72,SetKeyboardOffset:80,SetConfig:81,SetDefaultChannel:82,AuthorizeWithCredentials:100,AuthorizeAsGuest:101,AuthorizeWithCustomId:102,ForceLogout:110,GetGuildInfo:120,GetAchievementsInfo:130,GetPlayerPublicInfo:140,GetLeaderboardScores:150},i.jsCommands=(r(a={},i.Command.OpenLeaderBoards,"window.globalReactFunctions.apiOpenLeaderboards();"),r(a,i.Command.OpenAchievements,"window.globalReactFunctions.apiOpenAchievements();"),r(a,i.Command.OpenFriends,"window.globalReactFunctions.apiOpenFriends();"),r(a,i.Command.OpenChannel,"window.globalReactFunctions.apiOpenChannel('{0}');"),r(a,i.Command.OpenGuilds,"window.globalReactFunctions.apiOpenGuilds();"),r(a,i.Command.OpenMyGuild,"window.globalReactFunctions.apiOpenMyGuild();"),r(a,i.Command.SendMessage,"window.globalReactFunctions.apiSendMessage('{0}', '{1}');"),r(a,i.Command.UnnyNetWasOpened,"window.globalReactFunctions.apiUnnyNetWasOpened();"),r(a,i.Command.ReportLeaderboardScoresAsync,"window.globalReactFunctions.apiReportLeaderboardScoresAsync(<*id*>, '{0}', {1}, '{2}');"),r(a,i.Command.ReportAchievementProgressAsync,"window.globalReactFunctions.apiReportAchievementProgressAsync(<*id*>, {0}, {1});"),r(a,i.Command.AddGuildExperience,"window.globalReactFunctions.apiAddGuildExperience('{0}');"),r(a,i.Command.RequestFailed,"window.globalReactFunctions.requestFailed('{0}', \"{1}\");"),r(a,i.Command.RequestSucceeded,"window.globalReactFunctions.requestSucceeded('{0}');"),r(a,i.Command.RequestReply,"window.globalReactFunctions.requestReply('{0}', '{1}');"),r(a,i.Command.SetKeyboardOffset,"window.globalReactFunctions.apiSetKeyboardOffset('{0}');"),r(a,i.Command.SetConfig,"window.globalReactFunctions.apiSetConfig('{0}');"),r(a,i.Command.SetDefaultChannel,"window.globalReactFunctions.apiSetDefaultChannel('{0}');"),r(a,i.Command.AuthorizeWithCredentials,"window.globalReactFunctions.apiAuthWithCredentials('{0}', '{1}', '{2}');"),r(a,i.Command.AuthorizeAsGuest,"window.globalReactFunctions.apiAuthAsGuest('{0}');"),r(a,i.Command.AuthorizeWithCustomId,"window.globalReactFunctions.apiAuthWithCustomId('{0}', '{1}');"),r(a,i.Command.ForceLogout,"window.globalReactFunctions.apiForceLogout();"),r(a,i.Command.GetGuildInfo,"window.globalReactFunctions.apiGetGuildInfo(<*id*>, {0});"),r(a,i.Command.SetSafeArea,"window.globalReactFunctions.apiSetSafeArea({0}, {1}, {2}, {3});"),r(a,i.Command.GetAchievementsInfo,"window.globalReactFunctions.apiGetAchievementsInfo(<*id*>);"),r(a,i.Command.GetPlayerPublicInfo,"window.globalReactFunctions.apiGetPlayerPublicInfo(<*id*>);"),r(a,i.Command.GetLeaderboardScores,"window.globalReactFunctions.apiGetLeaderboardScores(<*id*>, '{0}');"),a),t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NutakuPlatform={PCBrowser:1,SPBrowser:2,Android:3,ClientGames:4},t.default={GENERAL_CONSTANTS:{REMOTE_URL:"https://unnynet.com",VERSION:2,PLUGIN_VERSION:"2.9"},MAX_DELAYED_CONFIRMATIONS:10,REQUESTS_SAVE_TIME:60,CHECK_PERIOD:1,MAX_QUEUE_LENGTH:100,SEND_REQUEST_RETRY_DELAY:1,ANIMATIONS:{OPEN_DURATION:.5},Platform:{NUTAKU:2,VKONTAKTE:3,FACEBOOK:4,ODNOKLASSNIKI:5,FB_INSTANT:6},PurchaseStatusFilter:{ALL:0,PENDING:1,COMPLETED:2,CLAIMED:3},Environment:{Development:0,Stage:1,Production:2}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o,r=n(1),i=(o=r)&&o.__esModule?o:{default:o},u=(function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(s,[{key:"authorize",value:function(e){console.error("authorize isn't implemented for this platform"),e&&e(i.default.getErrorResponse(r.Errors.Unknown,"authorize isn't implemented for this platform"))}},{key:"_autoAuthInNakama",value:function(){console.error("No nakama auth for current platform")}},{key:"getDeviceIdForNakama",value:function(){return null}}]),s);function s(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),this.environment=e.environment,this.API=e.API,this.allGetParams=e.allGetParams}t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=v(n(11)),r=v(n(6)),i=n(1),u=v(i),s=v(n(7)),l=v(n(12)),c=v(n(0)),d=v(n(2)),f=v(n(13)),p=v(n(15)),h=v(n(17));function v(e){return e&&e.__esModule?e:{default:e}}String.prototype.format||(String.prototype.format=function(){var e=arguments;return this.replace(/{(\d+)}/g,(function(t,n){return void 0!==e[n]?e[n]:t}))});var m=d.default.Environment.Development,y=(function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(b,[{key:"_prepareConfig",value:function(e){return e.game_id||(e.game_id="8ff16d3c-ebcc-4582-a734-77ca6c14af29"),c.default.onGameLoginRequest&&(e.game_login=1),e.platform===d.default.Platform.FB_INSTANT&&(e.lite_version||(e.lite_version=!0,console.warn("FB Instant can use only lite version of UnnyNet: Forced Lite"))),e}},{key:"_initServices",value:function(){this.API=new f.default(this.config),this.socialPlatform=h.default.createSocialPlatform(this,this.config.platform)}},{key:"_prepareWebView",value:function(){this.config.lite_version||(this.webView=new o.default(this.config),this.webView.openGameUrl(this.config,this.socialPlatform.getDeviceIdForNakama()),this.webView.onMessageReceived=this._receiveMessage.bind(this),this._loadQueue())}},{key:"_setDebug",value:function(e){this.debug=e}},{key:"_receiveMessage",value:function(e){var t=e.path,n=e.args;switch(t){case"authorised":c.default.onPlayerAuthorized&&c.default.onPlayerAuthorized(n),this.config.default_channel&&b._setDefaultChannel(this.config.default_channel);break;case"logged_out":c.default.onPlayerLoggedOut&&c.default.onPlayerLoggedOut();break;case"renamed":c.default.onPlayerNameChanged&&c.default.onPlayerNameChanged(n.name);break;case"rank_changed":c.default.onRankChanged&&c.default.onRankChanged(n);break;case"new_guild":null!=c.default.onNewGuild&&c.default.onNewGuild(n);break;case"ask_new_guild":case"popup_appeared":l.default.create(t,n,b._sendRequestReply);break;case"popup_button_clicked":l.default.buttonClicked(n);break;case"ach_completed":null!=c.default.onAchievementCompleted&&c.default.onAchievementCompleted(n);break;case"new_message":null!=c.default.onNewMessageReceived&&c.default.onNewMessageReceived(n);break;case"game_login_request":null!=c.default.onGameLoginRequest&&c.default.onGameLoginRequest();break;case"request_reply":s.default.replyReceived(n);break;case"open_url":n.url&&window.open(n.url,"_blank");break;case"debug":this._setDebug(1==n.enable)}b.log("_receiveMessage",e)}},{key:"_update",value:function(){this._checkQueue(),(!this.last_save_time||Date.now()-this.last_save_time>=1e3*d.default.REQUESTS_SAVE_TIME)&&this._saveQueue()}},{key:"_getSaveKey",value:function(){return"UN_SAVE_"+this.config.game_id}},{key:"_saveQueue",value:function(){this.last_save_time=Date.now();var e=[];for(var t in this.queue){var n=this.queue[t];n.needToSave()&&e.push(n.getSaveData())}var a=this._getSaveKey();0===e.length?localStorage.removeItem(a):localStorage.setItem(a,JSON.stringify(e))}},{key:"_loadQueue",value:function(){var e=this._getSaveKey(),t=localStorage.getItem(e);if(t){var n=JSON.parse(t);for(var a in n){var o=r.default.loadData(n[a]);this.queue.push(o)}b.log("_loadQueue",this.queue),localStorage.removeItem(e)}}},{key:"_checkQueue",value:function(){var e=this;if(0!==this.queue.length&&b._checkWebView()){var t=null,n=!1;for(var a in this.queue){var o=this.queue[a];if(!n||!o.isRequestWithFixedOrder()){if(!o.isWaiting()){t=o;break}if(o.isRequestWithFixedOrder()&&(n=!0),o.startedTime&&Date.now()-o.startedTime<1e3*d.default.MAX_DELAYED_CONFIRMATIONS)continue;t=o;break}}if(t){t.startedTime=Date.now();try{b.log("evaluate",t.getCode()),this.webView.evaluateJavaScript(t.getCode(),(function(n){b.log("response",n);var a=!1;if(n.success)t.isDelayedRequestConfirm()?t.startWaiting():a=!0,t.info.openWindow&&b.openUnnyNet();else if(n.error)switch(n.error.code){case i.Errors.UnnynetNotReady:case i.Errors.NotAuthorized:b.log("Waiting...",n);break;default:a=!0}a&&(e.queue.shift(),null!=t&&t.invokeCallback(n),e._checkQueue())}))}catch(n){console.error("EVAL ERROR: ",n)}}}}},{key:"hideWebView",value:function(){this.webView&&(null!=c.default.onUnnyNetClosed&&c.default.onUnnyNetClosed(),this.webView.hide(this.config))}},{key:"showWebView",value:function(){this.webView&&(this.webView.show(this.config),b.evaluateCommand(u.default.Command.UnnyNetWasOpened,!1,null))}}],[{key:"log",value:function(e){for(var t,n=arguments.length,a=Array(1<n?n-1:0),o=1;o<n;o++)a[o-1]=arguments[o];b.staticUnnyNetInstance.debug&&(t=console).info.apply(t,["[UNNYNET_JS] "+e].concat(a))}},{key:"_setDefaultChannel",value:function(e){var t=u.default.GetCommand(u.default.Command.SetDefaultChannel).format(e);b.evaluateCodeInJavaScript(new r.default(u.default.Command.SetDefaultChannel,t,!1))}},{key:"_sendRequestReply",value:function(e,t){var n=u.default.GetCommand(u.default.Command.RequestReply).format(e,t);b.evaluateCodeInJavaScript(new r.default(u.default.Command.RequestReply,n,!1))}},{key:"_checkWebView",value:function(){return!!b.staticUnnyNetInstance||(console.error("UnnyNet wasn't properly initialized"),!1)}},{key:"evaluateCommand",value:function(e,t,n){b.evaluateCodeInJavaScript(new r.default(e,u.default.GetCommand(e),t,n))}},{key:"evaluateCodeInJavaScript",value:function(e,t){var n=1<arguments.length&&void 0!==t&&t;if(b._checkWebView())if(b.staticUnnyNetInstance.config.lite_version)console.warn("You can't use this method in Lite Mode");else{for(var a=b.staticUnnyNetInstance.queue,o=-1,r=1;r<a.length;r++)if(a[r].couldBeReplaced(e.Command)){o=r;break}if(-1===o){if(n?a.unshift(e):a.push(e),1===a.length)b.staticUnnyNetInstance._checkQueue();else if(a.length>=d.default.MAX_QUEUE_LENGTH)for(var i=0;i<a.length;i++)if(a[i].isDelayedRequestConfirm()){a.splice(i,1);break}}else a[o]=e}}},{key:"openUnnyNet",value:function(){b._checkWebView()&&b.staticUnnyNetInstance.showWebView()}},{key:"closeUnnyNet",value:function(){null!=b.staticUnnyNetInstance&&b.staticUnnyNetInstance.hideWebView()}},{key:"delayedCommandWasConfirmed",value:function(e){var t=b.staticUnnyNetInstance.queue;for(var n in t)if(e===t[n]){t.splice(n,1);break}}},{key:"setFrame",value:function(e){b.staticUnnyNetInstance.webView&&b.staticUnnyNetInstance.webView.setFrame(e)}},{key:"setCloseButtonVisible",value:function(e){b.staticUnnyNetInstance.webView&&b.staticUnnyNetInstance.webView.setCloseButtonVisible(e)}}]),b);function b(e,t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,b),(b.staticUnnyNetInstance=this).config=this._prepareConfig(e),this.allGetParams=function(){var e={},t=window.location.search;if(t&&0<t.length)for(var n=(t=t.substring(1)).split("&"),a=0;a<n.length;a++){var o=n[a].split("=");o[0].startsWith("amp;")?e[o[0].substring(4)]=o[1]:e[o[0]]=o[1]}return e}(),this.queue=[],this.environment=this.config.hasOwnProperty("environment")?this.config.environment:m,console.info("PRMS",this.allGetParams),this._initServices(),this._prepareWebView(),this._setDebug(this.config.debug),b.RGC=p.default.UnnyRGC.initialize({game_id:this.config.game_id},(function(){b.log("RGC was initialized"),n.socialPlatform.authorize(t)})),setInterval(this._update.bind(this),1e3*d.default.CHECK_PERIOD)}y.staticUnnyNetInstance=null,y.RGC=null,t.default=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ViewOpenDirection=void 0;function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o,r=(o=n(2))&&o.__esModule?o:{default:o},i=t.ViewOpenDirection={NONE:0,LEFT_TO_RIGHT:2,RIGHT_TO_LEFT:4,TOP_TO_BOTTOM:1,BOTTOM_TO_TOP:3},u=(function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(s,[{key:"_receiveMessage",value:function(e){if(e.origin===r.default.GENERAL_CONSTANTS.REMOTE_URL&&e.data)if(e.data.reply){var t=e.data.id;if(this.evaluationsById.hasOwnProperty(t)){var n=e.data.reply,a=this.evaluationsById[t].callback;delete this.evaluationsById[t],a(n)}}else if(e.data&&e.data.message&&e.data.message.split){var o=decodeURIComponent(e.data.message).split("?"),i=void 0,u={};if(0<o.length&&(i=o[0],1<o.length))for(var s=o[1].split("&"),l=0;l<s.length;l++){var c=s[l].split("=");1<c.length&&(u[c[0]]=c[1])}this.onMessageReceived&&this.onMessageReceived({path:i,args:u})}}},{key:"openUrl",value:function(e){this.iFrame.src=e}},{key:"setFrame",value:function(e){this.cachedFrame=e,this._isVisible()?this._applyNormalPosition():this._applyHiddenPosition()}},{key:"_applyNormalPosition",value:function(){var e=this.cachedFrame,t=this.parent.style;t.left=e.left,t.right=e.right,t.top=e.top,t.bottom=e.bottom,t.width=e.width,t.height=e.height}},{key:"_applyHiddenPosition",value:function(){var e=this.parent.style;switch(this._applyNormalPosition(),this.config.open_animation){case i.LEFT_TO_RIGHT:e.left="-"+e.width,e.right=void 0;break;case i.RIGHT_TO_LEFT:e.left=void 0,e.right="-"+e.width;break;case i.TOP_TO_BOTTOM:e.top="-"+e.height,e.bottom=void 0;break;case i.BOTTOM_TO_TOP:e.top=void 0,e.bottom="-"+e.height}}},{key:"_isVisible",value:function(){return"visible"===this.parent.style.visibility}},{key:"_setAnimationActive",value:function(e){var t=this.parent.style;t["-webkit-transition"]=t.transition=e?"all "+r.default.ANIMATIONS.OPEN_DURATION+"s ease-in-out":void 0}},{key:"_clearTimer",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null)}},{key:"hide",value:function(){var e=this;this._clearTimer(),this._applyHiddenPosition(),this.timer=setTimeout((function(){e.parent.style.visibility="hidden",e.timer=null}),1e3*r.default.ANIMATIONS.OPEN_DURATION)}},{key:"show",value:function(){this._clearTimer(),this.parent.style.visibility="visible",this._applyNormalPosition()}},{key:"evaluateJavaScript",value:function(e,t){var n={eval_code:e,id:this.instanceId++};this.evaluationsById[n.id]={callback:t},this.window.postMessage(n,r.default.GENERAL_CONSTANTS.REMOTE_URL)}}]),s);function s(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);var t=document.createElement("div");this.parent=document.body.appendChild(t);var n=document.createElement("iframe");this.iFrame=this.parent.appendChild(n),this.window=this.iFrame.contentWindow;var a=this.iFrame.style;a.position="absolute",a.left=a.right="0",a.top=a.bottom="0",a.width=a.height="100%",a.border="none";var o=this.parent.style;o.zIndex="999999",o.position="fixed",o.visibility="hidden",this.config=e,this.evaluationsById={},this.instanceId=0,this.onMessageReceived=null,e.open_animation&&this._setAnimationActive(!0),this.setFrame({top:0,right:0,left:"",bottom:0,width:"50%",height:"100%"}),window.addEventListener("message",this._receiveMessage.bind(this),!1)}t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnnyCommandInfoDelayed=void 0;var a=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var r=u(n(1)),i=u(n(7));function u(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var l=(a(c,[{key:"getSaveData",value:function(){var e={command:this.info.command,code:this.info.code};return 0<=this.req_id&&(e.req_id=this.req_id),e}},{key:"getCode",value:function(){return this.info.code}},{key:"setCode",value:function(e){this.info.code=e}},{key:"getCommand",value:function(){return this.info.command}},{key:"invokeCallback",value:function(e){this.info.callback&&this.info.callback(e)}},{key:"invokeCallbackDelayed",value:function(e){var t=r.default.getResponceData(e);return this.info.callbackDelayed&&this.info.callbackDelayed(t),t}},{key:"needToSave",value:function(){switch(this.info.command){case r.default.Command.SendMessage:case r.default.Command.ReportLeaderboardScoresAsync:case r.default.Command.ReportAchievementProgressAsync:case r.default.Command.AddGuildExperience:return!0;default:return!1}}},{key:"couldBeReplaced",value:function(e){var t=this.getCommand();switch(e){case r.default.Command.OpenLeaderBoards:case r.default.Command.OpenAchievements:case r.default.Command.OpenFriends:case r.default.Command.OpenChannel:case r.default.Command.OpenGuilds:case r.default.Command.OpenMyGuild:return t===r.default.Command.OpenLeaderBoards||t===r.default.Command.OpenAchievements||t===r.default.Command.OpenFriends||t===r.default.Command.OpenChannel||t===r.default.Command.OpenGuilds||t===r.default.Command.OpenMyGuild;case r.default.Command.AuthorizeWithCredentials:case r.default.Command.AuthorizeAsGuest:case r.default.Command.AuthorizeWithCustomId:case r.default.Command.ForceLogout:case r.default.Command.GetGuildInfo:case r.default.Command.GetAchievementsInfo:case r.default.Command.GetPlayerPublicInfo:case r.default.Command.GetLeaderboardScores:case r.default.Command.SetSafeArea:case r.default.Command.UnnyNetWasOpened:return t===e;default:return!1}}},{key:"_isOpenCommand",value:function(e){switch(e){case r.default.Command.OpenLeaderBoards:case r.default.Command.OpenAchievements:case r.default.Command.OpenFriends:case r.default.Command.OpenChannel:case r.default.Command.OpenGuilds:case r.default.Command.OpenMyGuild:return!0;default:return!1}}},{key:"sameType",value:function(e){var t=this.getCommand();return!(!this._isOpenCommand(e)||!this._isOpenCommand(t))||e===t}},{key:"isDelayedRequestConfirm",value:function(){return c.isDelayedRequestConfirm(this.getCommand())}},{key:"isRequestWithFixedOrder",value:function(){return c.isRequestWithFixedOrder(this.getCommand())}},{key:"startWaiting",value:function(){this.delayedRequestWaiting=!0}},{key:"isWaiting",value:function(){return this.delayedRequestWaiting}}],[{key:"loadData",value:function(e){var t=null;return e.hasOwnProperty("req_id")?((t=new d(e.command,e.code)).setRequestId(e.req_id),i.default.addLoadedRequest(t)):t=new c(e.command,e.code),t}},{key:"isDelayedRequestConfirm",value:function(e){switch(e){case r.default.Command.ReportLeaderboardScoresAsync:case r.default.Command.ReportAchievementProgressAsync:return!0}return!1}},{key:"isRequestWithFixedOrder",value:function(e){switch(e){case r.default.Command.ReportLeaderboardScoresAsync:return!0}return!1}}]),c);function c(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;s(this,c),this.info={command:e,code:t,openWindow:n,callback:a},this.startedTime=null,this.req_id=-1,this.delayedRequestWaiting=!1}t.default=l;var d=t.UnnyCommandInfoDelayed=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(f,l),a(f,[{key:"setRequestId",value:function(e){this.req_id=e}}]),f);function f(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;s(this,f);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,e,t,!1,null));return a.info.callbackDelayed=n,i.default.addRequest(a),a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o,r=(o=n(4))&&o.__esModule?o:{default:o},i=n(1),u=(function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(s,[{key:"_requestId",value:function(){return this.uniqueIds===Number.MAX_SAFE_INTEGER?this.uniqueIds=0:this.uniqueIds++,this.uniqueIds}}],[{key:"getInstance",value:function(){return s.staticRequestsManagerInstance||(s.staticRequestsManagerInstance=new s),s.staticRequestsManagerInstance}},{key:"addRequest",value:function(e){var t=s.getInstance(),n=t._requestId();if((t.allRequests[n]=e).getCode()){var a=e.getCode().replace("<*id*>",n);e.setRequestId(n),e.setCode(a)}}},{key:"addLoadedRequest",value:function(e){if(0<=e.req_id){var t=s.getInstance(),n=e.req_id;t.allRequests[n]=e,n>=t.uniqueIds&&(t.uniqueIds=n===Number.MAX_SAFE_INTEGER?0:n+1)}}},{key:"replyReceived",value:function(e){var t=s.getInstance(),n=e.id;if(t.allRequests.hasOwnProperty(n)){var a=t.allRequests[n],o=a.invokeCallbackDelayed(e);if(a.isDelayedRequestConfirm()){var u=o.success;if(!u)switch(o.error.code){case i.Errors.NoSuchLeaderboard:case i.Errors.NoSuchAchievement:case i.Errors.WrongAchievementType:case i.Errors.AchievementIsNotPublished:u=!0}u&&(r.default.delayedCommandWasConfirmed(a),delete t.allRequests[n])}else delete t.allRequests[n]}}}]),s);function s(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),this.uniqueIds=0,this.allRequests={}}u.staticRequestsManagerInstance=null,t.default=u},function(e,t,n){"use strict";function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}Object.defineProperty(t,"__esModule",{value:!0});var o="un_token",r="un_refresh_token",i=(function(e,t,n){n&&a(e,n)}(u,0,[{key:"_saveValue",value:function(e,t){localStorage.setItem(e,t)}},{key:"_getValue",value:function(e){return localStorage.getItem(e)}},{key:"_removeItem",value:function(e){localStorage.removeItem(e)}},{key:"setToken",value:function(e){u._saveValue(o,e)}},{key:"getToken",value:function(){return u._getValue(o)}},{key:"setRefreshToken",value:function(e){u._saveValue(r,e)}},{key:"getRefreshToken",value:function(){u._getValue(r)}},{key:"clearTokens",value:function(){u._removeItem(o),u._removeItem(r)}}]),u);function u(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u)}t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o,r=(o=n(4))&&o.__esModule?o:{default:o},i=(function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(u,[{key:"_getSaveKey",value:function(){return"UN_API_SAVE_"+this.game_id}},{key:"_updateTokenForRequests",value:function(e){for(var t in this.requestsQueue){var n=this.requestsQueue[t].data.request;n.headers.hasOwnProperty("Authorization")&&(n.headers.Authorization="Bearer "+e)}}},{key:"_enqueueRequest",value:function(e,t,n,a,o){var r={data:{url:e,request:t},callback:o,retries:0,save:n};a?this.requestsQueue.unshift(r):this.requestsQueue.push(r),this.requests_were_updated=!0,1===this.requestsQueue.length&&this._sendNextRequest()}},{key:"_checkRequestToSave",value:function(){if(0<this.requestsQueue.length&&this.requests_were_updated){var e=Date.now();5e3<e-this.last_update_time&&(this.last_update_time=e,this.requests_were_updated=!1,this.saveRequests())}}},{key:"_removeFirstRequest",value:function(e){for(var t=0;t<this.requestsQueue.length;t++)this.requestsQueue[t]===e&&this.requestsQueue.splice(t,1);this._sendNextRequest(),this.last_update_time=Date.now()}},{key:"_sendNextRequest",value:function(){var e=this;if(0!==this.requestsQueue.length){var t=this.requestsQueue[0],n=t.data.url,a=t.data.request,o=t.callback;r.default.log("fetch",n,a.body),fetch(n,a).then((function(e){return r.default.log("fetch response",e),200<=e.status&&e.status<300?e.json():Promise.reject(e)})).then((function(n){o&&o(null,n),e._removeFirstRequest(t)})).catch((function(n){r.default.log("fetch failed",n),t.retries<3?(t.retries++,setTimeout((function(){return e._sendNextRequest()}),1e3)):(o&&o(n,null),e._removeFirstRequest(t))}))}}},{key:"loadRequests",value:function(){var e=localStorage.getItem(this._getSaveKey());if(e){var t=JSON.parse(e);if(t)for(var n in t){var a=t[n];this._enqueueRequest(a.url,a.request,!0,null)}localStorage.removeItem(this._getSaveKey())}}},{key:"saveRequests",value:function(){var e=Math.min(100,this.requestsQueue.length);if(0<e){for(var t=[],n=0;n<e;n++)this.requestsQueue[n].save&&t.push(this.requestsQueue[n].data);localStorage.setItem(this._getSaveKey(),JSON.stringify(t))}}}],[{key:"updateTokenForRequests",value:function(e){u.instance._updateTokenForRequests(e)}},{key:"enqueueRequest",value:function(e,t,n,a){u.instance._enqueueRequest(e,t,n,!1,a)}},{key:"enqueueImportantRequest",value:function(e,t,n,a){u.instance._enqueueRequest(e,t,n,!0,a)}}]),u);function u(e){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),this.game_id=e.game_id,this.requestsQueue=[],(u.instance=this).loadRequests(),this.last_update_time=Date.now(),this.requests_were_updated=!1,setInterval((function(){return t._checkRequestToSave()}),1e3)}t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=c(n(0)),o=n(23),r=c(o),i=n(5),u=n(1),s=n(2),l=c(s);function c(e){return e&&e.__esModule?e:{default:e}}t.default={UnnyNet:a.default,PopupButtons:r.default,ButtonType:o.ButtonType,ViewOpenDirection:i.ViewOpenDirection,Errors:u.Errors,NutakuPlatform:s.NutakuPlatform,Platform:l.default.Platform,Environment:l.default.Environment,PurchaseStatusFilter:l.default.PurchaseStatusFilter}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=u(n(5)),r=u(n(2)),i=u(n(0));function u(e){return e&&e.__esModule?e:{default:e}}var s=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(l,o.default),function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(l,[{key:"openGameUrl",value:function(e,t){var n={game_id:e.game_id,public_key:e.public_key,version:r.default.GENERAL_CONSTANTS.VERSION,device:"web",location_origin:window.location.origin};e.game_login&&(n.game_login=1),t&&(n.device_id=t),e.platform&&(n.platform=e.platform);var a=encodeURIComponent(JSON.stringify(n)),o=r.default.GENERAL_CONSTANTS.REMOTE_URL+"/#/plugin/?data="+a;this.openUrl(o)}},{key:"setCloseButtonVisible",value:function(e){this.closeBtn.style.visibility=e?"visible":"hidden"}}]),l);function l(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,e)),n=document.createElement("button");t.closeBtn=t.parent.appendChild(n);var a=t.closeBtn.style;return a.position="absolute",a.top=a.right="7px",a.outline="none",a.background="none",a.border="none",t.closeBtn.innerHTML='<img src="https://unnynet.azureedge.net/users/attachments/b246adbe-c1af-4532-88ca-f1d1709b0211/09b47e40-e61b-11e9-b83d-a5adea23c281.png" />',t.closeBtn.onclick=i.default.closeUnnyNet,t}t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o,r=n(1),i=(o=n(0))&&o.__esModule?o:{default:o},u=(function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(s,null,[{key:"create",value:function(e,t,n){switch(e){case"ask_new_guild":s._askNewGuildRequest(t,n);break;case"popup_appeared":s._playerPopupAppearedRequest(t,n)}}},{key:"sendFailed",value:function(e,t,n,a){var o=2<arguments.length&&void 0!==n?n:"";t(e,'{"success": 0, "error": {"code":'+(3<arguments.length&&void 0!==a?a:r.Errors.Unknown)+', "message": "'+o+'"}}')}},{key:"sendSuccess",value:function(e,t){t(e,'{"success": 1}')}},{key:"sendSuccessWithData",value:function(e,t,n){n(e,'{"success": 1, "data":'+t+"}")}},{key:"_askNewGuildRequest",value:function(e,t){var n=e.sys_id,a=null;i.default.onNewGuildRequest&&(a=i.default.onNewGuildRequest(e)),a?s.sendFailed(n,t,a):s.sendSuccess(n,t)}},{key:"_playerPopupAppearedRequest",value:function(e,t){var n=e.sys_id;if(null!=i.default.onPopupOpened){var a=i.default.onPopupOpened(e);if(null!=a)return void s.sendSuccessWithData(n,a.parse(),t)}s.sendSuccess(n,t)}},{key:"buttonClicked",value:function(e){if(PopupButtons.activePopup){var t=e.button_id;if(t){var n=parseInt(t);PopupButtons.activePopup.buttonClicked(n)}}}}]),s);function s(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s)}t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=l(n(8)),r=l(n(14)),i=n(1),u=l(i),s=l(n(9));function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}l(n(2)),l(n(0));var d="https://un-api.unnynet.com",f=(function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(p,[{key:"_onAuth",value:function(e){var t=e?e.accessToken:null,n=e?e.refreshToken:null;t&&(o.default.setToken(t),s.default.updateTokenForRequests(t)),n&&o.default.setRefreshToken(n)}},{key:"_onAuthCallback",value:function(e,t,n){var a=void 0;e?a=u.default.getErrorResponse(i.Errors.Unknown,e.status+":"+e.statusText):(a=u.default.getSuccessResponse(t),this._onAuth(t)),n&&n(a)}},{key:"_onCallback",value:function(e,t,n){var a;a=e?u.default.getErrorResponse(i.Errors.Unknown,e.status+":"+e.statusText):u.default.getSuccessResponse(t),n&&n(a)}},{key:"_sendDefaultError",value:function(e,t){t&&t(u.default.getErrorResponse(i.Errors.Unknown,e)),console.error(e)}},{key:"authWithLogin",value:function(e,t,n){var a=this;o.default.clearTokens(),new r.default(d+"/v1/auth/name",{name:e,password:t,game_id:this.config.game_id,public_key:this.config.public_key},(function(e,t){return a._onAuthCallback(e,t,n)})).markAsAuth().post()}},{key:"authWithVK",value:function(e,t,n,a){var i=this;return e||0===e?t?n?(o.default.clearTokens(),void new r.default(d+"/v1/auth/vk",{env:e,user_id:t,token:n,game_id:this.config.game_id,public_key:this.config.public_key},(function(e,t){return i._onAuthCallback(e,t,a)})).markAsAuth().post()):this._sendDefaultError("[VK]: no auth_key provided",a):this._sendDefaultError("[VK]: no viewer_id provided",a):this._sendDefaultError("[VK]: no environment provided",a)}},{key:"authWithOK",value:function(e,t,n,a){var i=this;return e||0===e?t?n?(o.default.clearTokens(),void new r.default(d+"/v1/auth/ok",{env:e,access_token:t,session_secret_key:n,game_id:this.config.game_id,public_key:this.config.public_key},(function(e,t){return i._onAuthCallback(e,t,a)})).markAsAuth().post()):this._sendDefaultError("[OK]: no session_secret_key provided",a):this._sendDefaultError("[OK]: no access_token provided",a):this._sendDefaultError("[OK]: no environment provided",a)}},{key:"authWithFB",value:function(e,t,n){var a=this;return e||0===e?t?(o.default.clearTokens(),void new r.default(d+"/v1/auth/fb",{env:e,token:t,game_id:this.config.game_id,public_key:this.config.public_key},(function(e,t){return a._onAuthCallback(e,t,n)})).markAsAuth().post()):this._sendDefaultError("[FB]: no auth_key provided",n):this._sendDefaultError("[FB]: no environment provided",n)}},{key:"authWithNutaku",value:function(e,t,n,a,i,u){var s=this;o.default.clearTokens(),new r.default(d+"/v1/auth/nutaku",{user_id:e,platform:t.toString(),oauth_token:n,oauth_token_secret:a,autologin_token:i,game_id:this.config.game_id,public_key:this.config.public_key},(function(e,t){return s._onAuthCallback(e,t,u)})).markAsAuth().post()}},{key:"authWithNutakuGadget",value:function(e){var t=this;if("undefined"!=typeof gadgets){var n;o.default.clearTokens();var a=(c(n={},gadgets.io.RequestParameters.METHOD,gadgets.io.MethodType.POST),c(n,gadgets.io.RequestParameters.CONTENT_TYPE,gadgets.io.ContentType.JSON),c(n,gadgets.io.RequestParameters.POST_DATA,gadgets.io.encodeValues({game_id:this.config.game_id,public_key:this.config.public_key})),c(n,gadgets.io.RequestParameters.AUTHORIZATION,gadgets.io.AuthorizationType.SIGNED),n);console.error("SENDING...",a),gadgets.io.makeRequest(d+"/v1/auth/nutaku_pc",(function(n){console.info("NUTAKU REPLY",n),n.errors&&n.errors.length&&console.error("AUTH ERROR",n.errors),t._onAuthCallback(null,n.data,e)}),a)}else console.warn("AUTH with login"),this.authWithLogin("test_user1","test_password",e)}},{key:"purchaseProduct",value:function(e,t){var n=this,a={};a[opensocial.BillingItem.Field.SKU_ID]="com.un.test.1",a[opensocial.BillingItem.Field.PRICE]=1e3,a[opensocial.BillingItem.Field.COUNT]=1,a[opensocial.BillingItem.Field.DESCRIPTION]="item 001",a[nutaku.BillingItem.Field.NAME]="Much Doge1",a[nutaku.BillingItem.Field.IMAGE_URL]="http://i.imgur.com/cBAPCQ4.png";var o=opensocial.newBillingItem(a),r={};r[opensocial.Payment.Field.ITEMS]=[o],r[opensocial.Payment.Field.MESSAGE]="Optional message to show alongside the items",r[opensocial.Payment.Field.PAYMENT_TYPE]=opensocial.Payment.PaymentType.PAYMENT;var i=opensocial.newPayment(r);console.info("MAKE_PURCHASE",i),opensocial.requestPayment(i,(function(e){if(e.hadError())console.error("ERROR",e),n._onCallback(e,null,t);else{var a=e.getData(),o=a.getField(nutaku.Payment.Field.PAYMENT_ID);console.info("INFO> "+o,a),n._onCallback(null,e,t)}}))}},{key:"getPurchases",value:function(e,t){var n=this;return console.log("1 getPurchases = "+e),new r.default(d+"/v1/payments/purchases?status="+e,null,(function(e,a){return n._onCallback(e,a,t)})).setToken(o.default.getToken()).get()}},{key:"completeNutakuPurchase",value:function(e,t,n,a){var i=this;return new r.default(d+"/v1/payments/nutaku/complete",{platform:t,order_id:n,user_id:e},(function(e,t){return i._onCallback(e,t,a)})).setToken(o.default.getToken()).post()}},{key:"completeNutakuPurchase2",value:function(e,t,n,a){var i=this;return new r.default(d+"/v1/payments/nutaku/complete",{platform:t,un_order_id:n,user_id:e},(function(e,t){return i._onCallback(e,t,a)})).setToken(o.default.getToken()).post()}},{key:"claimPurchase",value:function(e,t,n,a){var i=this;return new r.default(d+"/v1/payments/all/claim",{platform:t,order_id:n,user_id:e},(function(e,t){return i._onCallback(e,t,a)})).setToken(o.default.getToken()).post()}},{key:"claimPurchase2",value:function(e,t,n,a){var i=this;return new r.default(d+"/v1/payments/all/claim",{platform:t,un_order_id:n,user_id:e},(function(e,t){return i._onCallback(e,t,a)})).setToken(o.default.getToken()).post()}},{key:"_save",value:function(e,t,n,a,i){var u=this;a=a||-1,new r.default(d+"/v1/saves",{collection:e,key:t,value:n},(function(e,t){return u._onCallback(e,t,i)})).setToken(o.default.getToken()).setHeader("data-version",a.toString()).post()}},{key:"save",value:function(e,t,n,a,r){o.default.getToken()?this._save(e,t,n,a,r):r&&r(u.default.getErrorResponse(i.Errors.NoAccessToken))}},{key:"_load",value:function(e,t,n){var a=this;new r.default(d+"/v1/saves?collection="+e+(t?"&key="+t:""),null,(function(e,t){return a._onCallback(e,t,n)})).setToken(o.default.getToken()).get()}},{key:"load",value:function(e,t,n){o.default.getToken()?this._load(e,t,n):n&&n(u.default.getErrorResponse(i.Errors.NoAccessToken))}}]),p);function p(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p),this.config=e,this.apiRequests=new s.default(this.config)}t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=r(n(9));function r(e){return e&&e.__esModule?e:{default:e}}r(n(8));var i=(function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(u,[{key:"setHeaders",value:function(e){return this.headers=e,this}},{key:"setHeader",value:function(e,t){return this.headers||(this.headers={}),this.headers[e]=t,this}},{key:"setToken",value:function(e){return this.setHeader("Authorization","Bearer "+e)}},{key:"_sendRequest",value:function(e,t){this.important?o.default.enqueueImportantRequest(this.url,e,t,this.callback):o.default.enqueueRequest(this.url,e,t,this.callback)}},{key:"_send",value:function(e,t){if(e.headers={"Content-Type":"application/json"},this.headers)for(var n in this.headers)e.headers[n]=this.headers[n];this._sendRequest(e,t)}},{key:"markAsAuth",value:function(){return this.markAsUnsavable().markImportant()}},{key:"markAsUnsavable",value:function(){return this.savePost=!1,this}},{key:"markImportant",value:function(){return this.important=!0,this}},{key:"get",value:function(){this._send({method:"GET"},!1)}},{key:"post",value:function(){var e={method:"POST"};this.data&&(e.body=JSON.stringify(this.data)),this._send(e,this.savePost)}}]),u);function u(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),this.url=e,this.data=t,this.callback=n,this.retry=0,this.savePost=!0,this.important=!1}t.default=i},function(e,t,n){"use strict";(function(e){var n,a,o,r,i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};window,r=function(){return function(e){var t=window.webpackHotUpdateUnnyAdmin;window.webpackHotUpdateUnnyAdmin=function(e,n){!function(e,t){if(k[e]&&g[e]){for(var n in g[e]=!1,t)Object.prototype.hasOwnProperty.call(t,n)&&(v[n]=t[n]);0==--y&&0===b&&P()}}(e,n),t&&t(e,n)};var n,a=!0,o="222703fd7b689a678937",r=1e4,u={},s=[],l=[];function c(e){var t=A[e];if(!t)return E;function a(a){return t.hot.active?(A[a]?-1===A[a].parents.indexOf(e)&&A[a].parents.push(e):(s=[e],n=a),-1===t.children.indexOf(a)&&t.children.push(a)):(console.warn("[HMR] unexpected require("+a+") from disposed module "+e),s=[]),E(a)}function o(e){return{configurable:!0,enumerable:!0,get:function(){return E[e]},set:function(t){E[e]=t}}}for(var r in E)Object.prototype.hasOwnProperty.call(E,r)&&"e"!==r&&"t"!==r&&Object.defineProperty(a,r,o(r));return a.e=function(e){return"ready"===f&&p("prepare"),b++,E.e(e).then(t,(function(e){throw t(),e}));function t(){b--,"prepare"===f&&(_[e]||C(e),0===b&&0===y&&P())}},a.t=function(e,t){return 1&t&&(e=a(e)),E.t(e,-2&t)},a}var d=[],f="idle";function p(e){f=e;for(var t=0;t<d.length;t++)d[t].call(null,e)}var h,v,m,y=0,b=0,_={},g={},k={};function w(e){return+e+""===e?+e:e}function O(e){if("idle"!==f)throw new Error("check() is only allowed in idle status");return a=e,p("check"),(t=(t=r)||1e4,new Promise((function(e,n){if("undefined"==typeof XMLHttpRequest)return n(new Error("No browser support"));try{var a=new XMLHttpRequest,r=E.p+""+o+".hot-update.json";a.open("GET",r,!0),a.timeout=t,a.send(null)}catch(e){return n(e)}a.onreadystatechange=function(){if(4===a.readyState)if(0===a.status)n(new Error("Manifest request to "+r+" timed out."));else if(404===a.status)e();else if(200!==a.status&&304!==a.status)n(new Error("Manifest request to "+r+" failed."));else{try{var t=JSON.parse(a.responseText)}catch(t){return void n(t)}e(t)}}}))).then((function(e){if(!e)return p("idle"),null;g={},_={},k=e.c,m=e.h,p("prepare");var t=new Promise((function(e,t){h={resolve:e,reject:t}}));return v={},C(0),"prepare"===f&&0===b&&0===y&&P(),t}));var t}function C(e){var t,n;k[e]?(g[e]=!0,y++,t=e,(n=document.createElement("script")).charset="utf-8",n.src=E.p+""+t+"."+o+".hot-update.js",document.head.appendChild(n)):_[e]=!0}function P(){p("ready");var e=h;if(h=null,e)if(a)Promise.resolve().then((function(){return I(a)})).then((function(t){e.resolve(t)}),(function(t){e.reject(t)}));else{var t=[];for(var n in v)Object.prototype.hasOwnProperty.call(v,n)&&t.push(w(n));e.resolve(t)}}function I(t){if("ready"!==f)throw new Error("apply() is only allowed in ready status");var n,a,r,i,l;function c(e){for(var t=[e],n={},a=t.map((function(e){return{chain:[e],id:e}}));0<a.length;){var o=a.pop(),r=o.id,u=o.chain;if((i=A[r])&&!i.hot._selfAccepted){if(i.hot._selfDeclined)return{type:"self-declined",chain:u,moduleId:r};if(i.hot._main)return{type:"unaccepted",chain:u,moduleId:r};for(var s=0;s<i.parents.length;s++){var l=i.parents[s],c=A[l];if(c){if(c.hot._declinedDependencies[r])return{type:"declined",chain:u.concat([l]),moduleId:r,parentId:l};-1===t.indexOf(l)&&(c.hot._acceptedDependencies[r]?(n[l]||(n[l]=[]),d(n[l],[r])):(delete n[l],t.push(l),a.push({chain:u.concat([l]),id:l})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:n}}function d(e,t){for(var n=0;n<t.length;n++){var a=t[n];-1===e.indexOf(a)&&e.push(a)}}function h(){console.warn("[HMR] unexpected require("+O.moduleId+") to disposed module")}t=t||{};var y={},b=[],_={};for(var g in v)if(Object.prototype.hasOwnProperty.call(v,g)){var O;l=w(g);var C=!1,P=!1,I=!1,R="";switch((O=v[g]?c(l):{type:"disposed",moduleId:g}).chain&&(R="\nUpdate propagation: "+O.chain.join(" -> ")),O.type){case"self-declined":t.onDeclined&&t.onDeclined(O),t.ignoreDeclined||(C=new Error("Aborted because of self decline: "+O.moduleId+R));break;case"declined":t.onDeclined&&t.onDeclined(O),t.ignoreDeclined||(C=new Error("Aborted because of declined dependency: "+O.moduleId+" in "+O.parentId+R));break;case"unaccepted":t.onUnaccepted&&t.onUnaccepted(O),t.ignoreUnaccepted||(C=new Error("Aborted because "+l+" is not accepted"+R));break;case"accepted":t.onAccepted&&t.onAccepted(O),P=!0;break;case"disposed":t.onDisposed&&t.onDisposed(O),I=!0;break;default:throw new Error("Unexception type "+O.type)}if(C)return p("abort"),Promise.reject(C);if(P)for(l in _[l]=v[l],d(b,O.outdatedModules),O.outdatedDependencies)Object.prototype.hasOwnProperty.call(O.outdatedDependencies,l)&&(y[l]||(y[l]=[]),d(y[l],O.outdatedDependencies[l]));I&&(d(b,[O.moduleId]),_[l]=h)}var S,T=[];for(a=0;a<b.length;a++)l=b[a],A[l]&&A[l].hot._selfAccepted&&_[l]!==h&&T.push({module:l,errorHandler:A[l].hot._selfAccepted});p("dispose"),Object.keys(k).forEach((function(e){!1===k[e]&&delete installedChunks[e]}));for(var N,D,j=b.slice();0<j.length;)if(l=j.pop(),i=A[l]){var q={},M=i.hot._disposeHandlers;for(r=0;r<M.length;r++)(n=M[r])(q);for(u[l]=q,i.hot.active=!1,delete A[l],delete y[l],r=0;r<i.children.length;r++){var F=A[i.children[r]];F&&0<=(S=F.parents.indexOf(l))&&F.parents.splice(S,1)}}for(l in y)if(Object.prototype.hasOwnProperty.call(y,l)&&(i=A[l]))for(D=y[l],r=0;r<D.length;r++)N=D[r],0<=(S=i.children.indexOf(N))&&i.children.splice(S,1);for(l in p("apply"),o=m,_)Object.prototype.hasOwnProperty.call(_,l)&&(e[l]=_[l]);var G=null;for(l in y)if(Object.prototype.hasOwnProperty.call(y,l)&&(i=A[l])){D=y[l];var U=[];for(a=0;a<D.length;a++)if(N=D[a],n=i.hot._acceptedDependencies[N]){if(-1!==U.indexOf(n))continue;U.push(n)}for(a=0;a<U.length;a++){n=U[a];try{n(D)}catch(n){t.onErrored&&t.onErrored({type:"accept-errored",moduleId:l,dependencyId:D[a],error:n}),t.ignoreErrored||(G=G||n)}}}for(a=0;a<T.length;a++){var L=T[a];l=L.module,s=[l];try{E(l)}catch(a){if("function"==typeof L.errorHandler)try{L.errorHandler(a)}catch(n){t.onErrored&&t.onErrored({type:"self-accept-error-handler-errored",moduleId:l,error:n,originalError:a}),t.ignoreErrored||(G=G||n),G=G||a}else t.onErrored&&t.onErrored({type:"self-accept-errored",moduleId:l,error:a}),t.ignoreErrored||(G=G||a)}}return G?(p("fail"),Promise.reject(G)):(p("idle"),new Promise((function(e){e(b)})))}var A={};function E(t){if(A[t])return A[t].exports;var a,o=A[t]={i:t,l:!1,exports:{},hot:(a={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:n!==t,active:!0,accept:function(e,t){if(void 0===e)a._selfAccepted=!0;else if("function"==typeof e)a._selfAccepted=e;else if("object"==(void 0===e?"undefined":i(e)))for(var n=0;n<e.length;n++)a._acceptedDependencies[e[n]]=t||function(){};else a._acceptedDependencies[e]=t||function(){}},decline:function(e){if(void 0===e)a._selfDeclined=!0;else if("object"==(void 0===e?"undefined":i(e)))for(var t=0;t<e.length;t++)a._declinedDependencies[e[t]]=!0;else a._declinedDependencies[e]=!0},dispose:function(e){a._disposeHandlers.push(e)},addDisposeHandler:function(e){a._disposeHandlers.push(e)},removeDisposeHandler:function(e){var t=a._disposeHandlers.indexOf(e);0<=t&&a._disposeHandlers.splice(t,1)},check:O,apply:I,status:function(e){if(!e)return f;d.push(e)},addStatusHandler:function(e){d.push(e)},removeStatusHandler:function(e){var t=d.indexOf(e);0<=t&&d.splice(t,1)},data:u[t]},n=void 0,a),parents:(l=s,s=[],l),children:[]};return e[t].call(o.exports,o,o.exports,c(t)),o.l=!0,o.exports}return E.m=e,E.c=A,E.d=function(e,t,n){E.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},E.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},E.t=function(e,t){if(1&t&&(e=E(e)),8&t)return e;if(4&t&&"object"==(void 0===e?"undefined":i(e))&&e&&e.__esModule)return e;var n=Object.create(null);if(E.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)E.d(n,a,function(t){return e[t]}.bind(null,a));return n},E.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return E.d(t,"a",t),t},E.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},E.p="",E.h=function(){return o},c(0)(E.s=0)}([function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var a,o=(a=n(1))&&a.__esModule?a:{default:a};t.default={UnnyRGC:o.default}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.Errors=void 0;var a="function"==typeof Symbol&&"symbol"==i(Symbol.iterator)?function(e){return void 0===e?"undefined":i(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":i(e)};function o(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var r=s(n(2)),u=s(n(3));function s(e){return e&&e.__esModule?e:{default:e}}var l,c,d="name",f="version",p=t.Errors={FAILED_DOWNLOAD_VERSIONS:1e3,FAILED_DOWNLOAD_DICTIONARY:1001,PARSING_ERROR:1002},h=(c=[{key:"_sendFailedCallback",value:function(e,t,n){e({success:!1,error:{code:t,message:n}})}},{key:"initialize",value:function(e,t){return(v.instance=new v)._initialize(e.game_id,t),v.instance}}],o((l=v).prototype,[{key:"_getFileExtension",value:function(){return".json"}},{key:"_downloadNextDictionary",value:function(){function e(e){var n=t.allDictionaries[e];if(1===n.status){var a=t.downloadUrl+n[d]+(n.version?"_v"+n.version:"")+t._getFileExtension();return v.instance.downloader.loadJson(a,(function(e){e.success?(n.value=e.data,n.status=0,t.db.saveDictionary(n[d],n.value,n[f]),t._downloadNextDictionary()):(e.error.code=p.FAILED_DOWNLOAD_DICTIONARY,t.callback(e))})),{v:void 0}}}var t=this;for(var n in this.allDictionaries){var o=e(n);if("object"===(void 0===o?"undefined":a(o)))return o.v}this.callback&&(this.callback({success:!0}),this.callback=null)}},{key:"_initialize",value:function(e,t){var n=this;this.callback=t,this.db=new u.default("UNNY_RGC_"+e,2),this.downloadUrl="https://dictionaries-unnynet.fra1.cdn.digitaloceanspaces.com/dictionaries/"+e+"/";var a="https://dictionaries-unnynet.fra1.digitaloceanspaces.com/dictionaries/"+e+"/versions"+this._getFileExtension()+"?timestamp="+Math.trunc((new Date).getTime());v.instance.downloader.loadJson(a,(function(e){if(e.success){var a=e.data.dictionaries;a?n.db.waitForTheConnection((function(){for(var e=a.length,t=function(t){var o=a[t],r=o[d];n.db.loadDictionary(r,(function(t){o[f]<=(t?t.version:-1)&&t.value?(o.status=0,o.value=t.value):o.status=1,n.allDictionaries[o.name]=o,0==--e&&n._downloadNextDictionary()}))},o=0;o<a.length;o++)t(o)})):v._sendFailedCallback(t,p.PARSING_ERROR,e.data.toString())}else e.error.code=p.FAILED_DOWNLOAD_VERSIONS,t(e)}))}},{key:"getDictionary",value:function(e){return this.allDictionaries.hasOwnProperty(e)?this.allDictionaries[e].value:null}}]),o(l,c),v);function v(){!function(e){if(!(e instanceof v))throw new TypeError("Cannot call a class as a function")}(this),this.downloader=new r.default,this.allDictionaries=[]}t.default=h},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}(o.prototype,[{key:"loadJson",value:function(e,t){fetch(e).then((function(e){return e.json()})).then((function(e){return t({success:!0,data:e})})).catch((function(e){return t({success:!1,error:{message:e.toString()}})}))}}]),o);function o(){!function(e){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}(this)}t.default=a},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var a=0,o=-1,r=2,i=3,u="all_dictionaries",s=(function(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}(l.prototype,[{key:"_callCallback",value:function(){this.callback&&(this.callback(this.isActive()),this.callback=null)}},{key:"waitForTheConnection",value:function(e){this.callback=e,this.dbState!==r&&this._callCallback()}},{key:"saveDictionary",value:function(e,t,n){if(this.isActive())try{this.db.transaction([u],"readwrite").objectStore(u).put({name:e,value:t,version:n}).onerror=function(t){console.error("Failed to save "+e,t)}}catch(t){console.error("Something went wrong during saving",t)}}},{key:"loadDictionary",value:function(e,t){if(this.isActive())try{var n=this.db.transaction([u],"readonly").objectStore(u).get(e);n.onerror=function(n){console.error("couldn't load dictionary "+e,n),t(null)},n.onsuccess=function(){t(n.result)}}catch(n){console.error("Something went wrong during loading",n),t(null)}}},{key:"isActive",value:function(){return this.dbState===i}}]),l);function l(e,t){var n=this;if(function(e){if(!(e instanceof l))throw new TypeError("Cannot call a class as a function")}(this),this.dbSupport=!!window.indexedDB,this.dbSupport){this.dbState=r;var s=window.indexedDB.open(e,t);s.onerror=function(e){console.error("Couldn't connect to DB",s.errorCode),n.dbState=a,n._callCallback()},s.onsuccess=function(e){n.db=e.target.result,n.dbState=i,n._callCallback()},s.onupgradeneeded=function(e){n.db=e.target.result,n.db.createObjectStore(u,{keyPath:"name"})}}else console.error("IndexedDB isn't supported"),this.dbState=o}t.default=s}]).default},"object"==i(t)&&"object"==i(e)?e.exports=r():(a=[],void 0===(o="function"==typeof(n=r)?n.apply(t,a):n)||(e.exports=o))}).call(this,n(16)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=d(n(2)),r=d(n(18)),i=d(n(19)),u=d(n(20)),s=d(n(21)),l=d(n(3)),c=d(n(22));function d(e){return e&&e.__esModule?e:{default:e}}var f=(function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(p,null,[{key:"createSocialPlatform",value:function(e,t){switch(t){case o.default.Platform.NUTAKU:return new r.default(e);case o.default.Platform.VKONTAKTE:return new i.default(e);case o.default.Platform.ODNOKLASSNIKI:return new u.default(e);case o.default.Platform.FACEBOOK:return new s.default(e);case o.default.Platform.FB_INSTANT:return new c.default(e);default:return new l.default(e)}}}]),p);function p(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p)}t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o,r=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,((o=n(3))&&o.__esModule?o:{default:o}).default),function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(i,[{key:"authorize",value:function(e){this.API.authWithNutakuGadget(e)}},{key:"getDeviceIdForNakama",value:function(){return null}}]),i);function i(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e))}t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=i(n(3)),r=i(n(0));function i(e){return e&&e.__esModule?e:{default:e}}var u=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(s,o.default),function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(s,[{key:"authorize",value:function(e){this.API.authWithVK(this.environment,this._getVkUserId(),this._getVkAccessToken(),e),this._autoAuthInNakama()}},{key:"_getVkUserId",value:function(){return this.allGetParams.viewer_id}},{key:"_getVkAccessToken",value:function(){return this.allGetParams.access_token}},{key:"_autoAuthInNakama",value:function(){r.default.authorizeAsGuest("")}},{key:"getDeviceIdForNakama",value:function(){return"vkontakte_"+this._getVkUserId()}}]),s);function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(s.__proto__||Object.getPrototypeOf(s)).apply(this,arguments))}t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=i(n(3)),r=i(n(0));function i(e){return e&&e.__esModule?e:{default:e}}var u=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(s,o.default),function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(s,[{key:"authorize",value:function(e){this.API.authWithOK(e),this._autoAuthInNakama()}},{key:"_autoAuthInNakama",value:function(){r.default.authorizeAsGuest("")}},{key:"getDeviceIdForNakama",value:function(){return"odnoklassniki_user_id"}}]),s);function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(s.__proto__||Object.getPrototypeOf(s)).apply(this,arguments))}t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=i(n(3)),r=i(n(0));function i(e){return e&&e.__esModule?e:{default:e}}var u=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(s,o.default),function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(s,[{key:"authorize",value:function(e){this._initializeFacebook((function(){console.warn("INITIALIZED -> auth"),r.default.authorize("test_user1","test_password",e)}))}},{key:"_autoAuthInNakama",value:function(){r.default.authorizeAsGuest("")}},{key:"_initializeFacebook",value:function(e){var t,n,a,o,r=this;window!==top?(window.fbAsyncInit=function(){FB.init({appId:r.fb_app_id,cookie:!0,xfbml:!0,version:"v3.3"}),FB.AppEvents.logPageView();var t=function(e){var t={scope:"email"};e&&(t.auth_type="rerequest"),FB.login((function(e){n(e)}),t)},n=function(n){console.info("FB STATUS",n),"connected"===n.status?function(n){r.accessToken=n.authResponse.accessToken,r.fbUserID=n.authResponse.userID,FB.api("/me",{locale:"en_US",fields:"name, picture, email"},(function(n){console.info(n),n.hasOwnProperty("email")?(r.fbUserEmail=n.email,r.fbUserName=n.name,e&&e()):t(!0)}))}(n):t()};FB.getLoginStatus((function(e){n(e)}))},n="facebook-jssdk",a=void 0,o=(t=document).getElementsByTagName("script")[0],t.getElementById(n)||((a=t.createElement("script")).id=n,a.src="https://connect.facebook.net/en_US/sdk.js",o.parentNode.insertBefore(a,o))):e&&e()}}]),s);function s(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,e));return t.fb_app_id=e.config.fb_app_id,t}t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=u(n(3)),r=u(n(0)),i=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}var s=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(l,o.default),function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(l,[{key:"authorize",value:function(e){this._initializeFacebook((function(){console.warn("INITIALIZED -> auth"),r.default.authorize("test_user1","test_password",e)}))}},{key:"_initializeFacebook",value:function(e){var t,n,a,o;window===top?e&&e():(n="facebook-jssdk",a=void 0,o=(t=document).getElementsByTagName("script")[0],t.getElementById(n)||((a=t.createElement("script")).id=n,a.src="https://connect.facebook.net/en_US/fbinstant.6.3.js",a.onload=function(){"undefined"!=typeof FBInstant?FBInstant.initializeAsync().then((function(){function t(){FBInstant.startGameAsync().then((function(){FBInstant.context.getID(),FBInstant.context.getType();var t=FBInstant.player.getPhoto();this.fbUserID=FBInstant.player.getID(),this.fbUserName=FBInstant.player.getName(),console.info("PLAYERID "+this.fbUserID+" <> "+this.fbUserName,t),e&&e()})).catch((function(e){console.error("Failed to startGameAsync",e)}))}i.default.onLoadingProgress?i.default.onLoadingProgress((function(e){FBInstant.setLoadingProgress(e)}),t):t()})).catch((function(e){console.error("Failed to initializeAsync",e)})):e&&e()},o.parentNode.insertBefore(a,o)))}}]),l);function l(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(l.__proto__||Object.getPrototypeOf(l)).apply(this,arguments))}t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=t.ButtonType={Primary:"Primary",Secondary:"Secondary",Success:"Success",Info:"Info",Warning:"Warning",Danger:"Danger"},r=(function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(i,[{key:"addButton",value:function(e,t,n){var a=2<arguments.length&&void 0!==n?n:o.Primary;this.allButtons.push({id:i._buttonInstance++,title:e,type:a}),this.allButtonsAction.push(t)}},{key:"parse",value:function(){var e=JSON.stringify(this.allButtons);return console.log("> "+e),'{"buttons": '+e+"}"}},{key:"buttonClicked",value:function(e){for(var t=0;t<this.allButtons.length;t++)if(this.allButtons[t].id===e){var n=this.allButtonsAction[t];n&&n();break}}}]),i);function i(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(i.activePopup=this).allButtons=[],this.allButtonsAction=[]}r._buttonInstance=0,t.default=r}]).default}));
window.onerror = function myErrorHandler(errorMsg, url, lineNumber) {
    console.info("[ERROR]: ", errorMsg, url, lineNumber);
    if (typeof ga != 'undefined') {
        ga('send', 'event', {
            eventCategory: 'ERROR',
            eventAction: errorMsg,
            eventLabel: url + " : " + lineNumber
        });
    }
    return false;
};

let UnnyObjectType = {
    Image: 0,
    SpriteSheet: 1,
    Spine: 2,
    NineSlice: 3,
    Audio: 4,
    Json: 5
};

const RESOURCES_SCALE = 100;

let localScale;
let imageSizeLocalScale;
let imagesDeltaScale;
let use2ximages = true;

const CommonVisualData = {

    FINGER: {
        objects: [
            {
                name: 'Tut_Finger'
            }
        ]
    },

    PRELOAD_OBJECTS: [//Bundle specific images
        'Tut_Circle',
        'Tut_Finger',
        'Lock',
        'LockIcon',
        'LockPuzzle',

        'Background1',
        'PriceIcon',
        'PriceGems',
        'PriceSeeds',
        // 'Building_1',
        // 'Building_2',
        // 'Building_3',
        // 'Building_4',
        // 'Building_5',
        // 'Building_6',
        // 'Building_7',
        // 'Building_8',
        // 'Building_9',

        'Production_Progress_Bar_Back',
        'Production_Progress_Bar',
        'Upgrade_Progress_Bar',

        'LikePlus',
        'TableLike',
        'TableUpgrade',

        'WinStandardBack',
        'WinUpgradeBack',
        'DefaultButton',
        'ExitButton',
        'BlackPixel',
        'CollectionBack',

        'MM_Btn_Login',
        'MM_Btn_Upgrade',
        'MM_Btn_Likes',
        'MM_Btn_Worlds',
        'MM_Btn_Chests',
        'MM_Btn_Store',

        'Tab_Close',
        'Tab_Open',
        'TabIcon_Actual',
        'TabIcon_Money',
        'Store_Slot',

        'BoxTabIcon',
        'PuzzleTabIcon',

        'PuzzleBonusBack',
        'PuzzleItemFrame',
        'PuzzleItemLockDL',
        'PuzzleItemLockDR',
        'PuzzleItemLockUL',
        'PuzzleItemLockUR',
        'PuzzleOpened',
        'PuzzleBronze',
        'PuzzleSilver',
        'PuzzleGold',
        'PuzzleDiamond',

        'PuzzlesOpened',
        'PuzzlesBronze',
        'PuzzlesSilver',
        'PuzzlesGold',
        'PuzzlesDiamond',

        'BoxCounter',

        'FortuneItemTimeTravel',
        'FortuneHUDButton',
        'GiftBox',
        'GiftBoxOpen',
        'GiftBoxSuper',
        'GiftBoxSuperOpen',

        'Quests_RefreshBtn',
        'Quests_ProgressFill',
        'Quests_ProgressBar',
        'QuestsHUDButton',
        'Daily_HUDButton',
        'QuestBack',
        'Daily_Opened',
        'Daily_Active',
        'HudPlusButton',
        'SeedsQuestIcon',

        'Popup',
        'PopupThumbsUp',

        'SettingsBtn',
        'FastProduction',
        'Effect_Glow',
        'AdCam',
        'Notification',

        'DoubleInappCross',
        'InappLike',
        'InappLike1',
    ],

    ALL_OBJECTS: {

        'AdCam': {
            file: 'UI/HUD_and_common/adCamIcon.png',
        },
        'Music_On': {
            file: 'UI/Windows/Settings/musicOn.png',
        },
        'Music_Off': {
            file: 'UI/Windows/Settings/musicOff.png',
        },

        'Sounds_On': {
            file: 'UI/Windows/Settings/soundsOn.png',
        },
        'Sounds_Off': {
            file: 'UI/Windows/Settings/soundsOff.png',
        },

        'Language_Arabic': {
            file: 'UI/Windows/ChangeLanguage/Arabic.png',
        },
        'Language_Chinese (Simplified)': {
            file: 'UI/Windows/ChangeLanguage/Chinese (Simplified).png',
        },
        'Language_Chinese (Traditional)': {
            file: 'UI/Windows/ChangeLanguage/Chinese (Traditional).png',
        },
        'Language_English': {
            file: 'UI/Windows/ChangeLanguage/English.png',
        },
        'Language_French': {
            file: 'UI/Windows/ChangeLanguage/French.png',
        },
        'Language_German': {
            file: 'UI/Windows/ChangeLanguage/German.png',
        },
        'Language_Italian': {
            file: 'UI/Windows/ChangeLanguage/Italian.png',
        },
        'Language_Japanese': {
            file: 'UI/Windows/ChangeLanguage/Japanese.png',
        },
        'Language_Korean': {
            file: 'UI/Windows/ChangeLanguage/Korean.png',
        },
        'Language_Portuguese (Brazil)': {
            file: 'UI/Windows/ChangeLanguage/Portuguese (Brazil).png',
        },
        'Language_Russian': {
            file: 'UI/Windows/ChangeLanguage/Russian.png',
        },
        'Language_Spanish': {
            file: 'UI/Windows/ChangeLanguage/Spanish.png',
        },

        'LoadingSplash': {
            file: '../LoadingSplash.jpg',
        },
        'LoadingSplash_ProgressBar': {
            file: '../ProgressBar.png',
        },
        'LoadingSplash_ProgressBarFill': {
            file: '../ProgressBarFill.png',
        },

        'Tut_Circle': {
            file: 'Tutorial/Circle.png',
        },

        'LockIcon': {
            file: 'Slots/Lock.png',
        },
        'LockPuzzle': {
            file: 'Slots/LockPuzzle.png',
        },
        'Lock': {
            file: 'Slots/GroundBlocked.png',
        },

        'Notification': {
            file: 'UI/HUD_and_common/ui_button_red.png',
        },

        'PriceIcon': {
            file: 'UI/HUD_and_common/HUD/HudGoldIcon.png',
        },

        'PriceIconBig': {
            file: 'UI/Windows/SpecialOffer/FishIcon.png',
        },
        'PriceGems': {
            file: 'UI/HUD_and_common/HUD/HudGemIcon.png',
        },
        'PriceSeeds': {
            file: 'UI/HUD_and_common/HUD/HudSeedIcon.png',
        },
        'PriceSeedsBig': {
            file: 'UI/Windows/SpecialOffer/CanIcon.png',
        },
        'HudPlusButton': {
            file: 'UI/HUD_and_common/HUD/HudPlusButton.png',
        },
        'SeedsQuestIcon': {
            file: 'UI/HUD_and_common/HUD/SeedsQuestIcon.png',
        },
        'Tut_Finger': {
            type: UnnyObjectType.Spine,
            json: 'finger.json',
            atlas: 'finger.atlas',
            animations: {
                // idle: 'active',
                appear: 'press',
                disappear: 'up',
            },
        },
        'Building_1w1': {
            type: UnnyObjectType.Spine,
            json: 'Slot1.json',
            atlas: 'Slot1.atlas',
            animations: {
                idle: 'Idle',
                appear: 'Appear',
                action: 'Touch',
            }
        },
        'Building_2w1': {
            type: UnnyObjectType.Spine,
            json: 'Slot2.json',
            atlas: 'Slot2.atlas',
            animations: {
                idle: 'Idle',
                appear: 'Appear',
                action: 'Touch',
            }
        },
        'Building_3w1': {
            type: UnnyObjectType.Spine,
            json: 'Slot3.json',
            atlas: 'Slot3.atlas',
            animations: {
                idle: 'Idle',
                appear: 'Appear',
                action: 'Touch',
            }
        },
        'Building_4w1': {
            type: UnnyObjectType.Spine,
            json: 'Slot4.json',
            atlas: 'Slot4.atlas',
            animations: {
                idle: 'Idle',
                appear: 'Appear',
                action: 'Touch',
            }
        },
        'Building_5w1': {
            type: UnnyObjectType.Spine,
            json: 'Slot5.json',
            atlas: 'Slot5.atlas',
            animations: {
                idle: 'Idle',
                appear: 'Appear',
                action: 'Touch',
            }
        },
        'Building_6w1': {
            type: UnnyObjectType.Spine,
            json: 'Slot6.json',
            atlas: 'Slot6.atlas',
            animations: {
                idle: 'Idle',
                appear: 'Appear',
                action: 'Touch',
            }
        },
        'Building_7w1': {
            type: UnnyObjectType.Spine,
            json: 'slot7.json',
            atlas: 'slot7.atlas',
            animations: {
                idle: 'Idle',
                appear: 'Appear',
                action: 'Touch',
            }
        },
        'Building_8w1': {
            type: UnnyObjectType.Spine,
            json: 'slot8.json',
            atlas: 'slot8.atlas',
            animations: {
                idle: 'Idle',
                appear: 'Appear',
                action: 'Touch',
            }
        },
        'Building_9w1': {
            type: UnnyObjectType.Spine,
            json: 'slot9.json',
            atlas: 'slot9.atlas',
            animations: {
                idle: 'Idle',
                appear: 'Appear',
                action: 'Touch',
            }
        },
        'Building_1w2': {
            type: UnnyObjectType.Spine,
            json: 'Slot1w2.json',
            atlas: 'Slot1w2.atlas',
            animations: {
                idle: 'Idle',
                appear: 'Appear',
                action: 'Touch',
            }
        },
        'Building_2w2': {
            type: UnnyObjectType.Spine,
            json: 'slot2w2.json',
            atlas: 'slot2w2.atlas',
            animations: {
                idle: 'Idle',
                appear: 'Appear',
                action: 'Touch',
            }
        },
        'Building_3w2': {
            type: UnnyObjectType.Spine,
            json: 'slot3w2.json',
            atlas: 'slot3w2.atlas',
            animations: {
                idle: 'Idle',
                appear: 'Appear',
                action: 'Touch',
            }
        },
        'Building_4w2': {
            type: UnnyObjectType.Spine,
            json: 'slot4w2.json',
            atlas: 'slot4w2.atlas',
            animations: {
                idle: 'Idle',
                appear: 'Appear',
                action: 'Touch',
            }
        },
        'Building_5w2': {
            type: UnnyObjectType.Spine,
            json: 'slot5w2.json',
            atlas: 'slot5w2.atlas',
            animations: {
                idle: 'Idle',
                appear: 'Appear',
                action: 'Touch',
            }
        },
        'Building_6w2': {
            type: UnnyObjectType.Spine,
            json: 'slot6w2.json',
            atlas: 'slot6w2.atlas',
            animations: {
                idle: 'Idle',
                appear: 'Appear',
                action: 'Touch',
            }
        },
        'Building_7w2': {
            type: UnnyObjectType.Spine,
            json: 'slot7w2.json',
            atlas: 'slot7w2.atlas',
            animations: {
                idle: 'Idle',
                appear: 'Appear',
                action: 'Touch',
            }
        },
        'Building_8w2': {
            type: UnnyObjectType.Spine,
            json: 'slot8w2.json',
            atlas: 'slot8w2.atlas',
            animations: {
                idle: 'Idle',
                appear: 'Appear',
                action: 'Touch',
            }
        },
        'Building_9w2': {
            type: UnnyObjectType.Spine,
            json: 'slot9w2.json',
            atlas: 'slot9w2.atlas',
            animations: {
                idle: 'Idle',
                appear: 'Appear',
                action: 'Touch',
            }
        },

        'Building_1w3': {
            type: UnnyObjectType.Spine,
            json: 'Slot1w3.json',
            atlas: 'Slot1w3.atlas',
            animations: {
                idle: 'Idle',
                appear: 'Appear',
                action: 'Touch',
            }
        },
        'Building_2w3': {
            type: UnnyObjectType.Spine,
            json: 'Slot2w3.json',
            atlas: 'Slot2w3.atlas',
            animations: {
                idle: 'Idle',
                appear: 'Appear',
                action: 'Touch',
            }
        },
        'Building_3w3': {
            type: UnnyObjectType.Spine,
            json: 'Slot3w3.json',
            atlas: 'Slot3w3.atlas',
            animations: {
                idle: 'Idle',
                appear: 'Appear',
                action: 'Touch',
            }
        },
        'Building_4w3': {
            type: UnnyObjectType.Spine,
            json: 'Slot4w3.json',
            atlas: 'Slot4w3.atlas',
            animations: {
                idle: 'Idle',
                appear: 'Appear',
                action: 'Touch',
            }
        },
        'Building_5w3': {
            type: UnnyObjectType.Spine,
            json: 'Slot5w3.json',
            atlas: 'Slot5w3.atlas',
            animations: {
                idle: 'Idle',
                appear: 'Appear',
                action: 'Touch',
            }
        },
        'Building_6w3': {
            type: UnnyObjectType.Spine,
            json: 'Slot6w3.json',
            atlas: 'Slot6w3.atlas',
            animations: {
                idle: 'Idle',
                appear: 'Appear',
                action: 'Touch',
            }
        },
        'Building_7w3': {
            type: UnnyObjectType.Spine,
            json: 'Slot7w3.json',
            atlas: 'Slot7w3.atlas',
            animations: {
                idle: 'Idle',
                appear: 'Appear',
                action: 'Touch',
            }
        },
        'Building_8w3': {
            type: UnnyObjectType.Spine,
            json: 'Slot8w3.json',
            atlas: 'Slot8w3.atlas',
            animations: {
                idle: 'Idle',
                appear: 'Appear',
                action: 'Touch',
            }
        },
        'Building_9w3': {
            type: UnnyObjectType.Spine,
            json: 'Slot9w3.json',
            atlas: 'Slot9w3.atlas',
            animations: {
                idle: 'Idle',
                appear: 'Appear',
                action: 'Touch',
            }
        },

        'Production_Progress_Bar_Back': {
            file: 'Slots/timeBar.png',
        },
        'Production_Progress_Bar': {
            file: 'Slots/timeprogress.png',
        },
        'Upgrade_Progress_Bar': {
            file: 'Slots/macroProgress.png',
        },
        'LikePlus': {
            file: 'Slots/likePlus.png',
        },
        'TableLike': {
            file: 'Slots/tableLike.png',
        },
        'TableUpgrade': {
            file: 'Slots/tableUpgrade.png',
        },
        'FastProduction': {
            type: UnnyObjectType.SpriteSheet,
            file: 'Slots/timefast.jpg',
            frameWidth: 256,
            frameHeight: 29,
            frames: 8,
            period: 0.033,
        },

        'DefaultButton': {
            file: 'UI/HUD_and_common/Buttons/Btn355x158.png', //TODO Optimize ... too many buttons
            type: UnnyObjectType.NineSlice,
            paddingX: 80,
            paddingY: 79
        },
        'ExitButton': {
            file: 'UI/HUD_and_common/Buttons/CloseBtn.png',
        },
        'BlackPixel': {
            file: 'Backs/BlackPixel.png',
        },
        'CollectionBack': {
            file: 'Backs/CollectionBack.png',
        },

        'MM_Btn_Login': {
            file: 'UI/HUD_and_common/HUD/HudSocialBtn.png',
        },
        'MM_Btn_Upgrade': {
            file: 'UI/HUD_and_common/HUD/HudSlotUpgradeBtn.png',
        },
        'MM_Btn_Likes': {
            file: 'UI/HUD_and_common/HUD/HudLikesBtn.png',
        },
        'MM_Btn_Worlds': {
            file: 'UI/HUD_and_common/HUD/HUDChangeLocation.png',
        },
        'MM_Btn_Chests': {
            file: 'UI/HUD_and_common/HUD/HudPuzzlesBtn.png',
        },
        'MM_Btn_Store': {
            file: 'UI/HUD_and_common/HUD/HudShovelBtn.png',
        },

        'Tab_Close': {
            file: 'UI/Windows/Upgrade/DeactiveTabBack.png',
        },
        'Tab_Open': {
            file: 'UI/Windows/Upgrade/ActiveTabBack.png',
        },
        'TabIcon_Actual': {
            file: 'UI/Windows/Upgrade/ActualTabIcon.png',
        },
        'TabIcon_Money': {
            file: 'UI/Windows/Upgrade/InappTabIcon.png',
        },
        'Store_Slot': {
            file: 'UI/Windows/Upgrade/UpgradeItemBack.png',
        },
        'DoubleInappCross': {
            file: 'UI/Windows/Upgrade/DoubleInappCross.png',
        },
        'InappLike': {
            file: 'UI/Windows/Upgrade/InappLike.png',
        },
        'InappLike1': {
            file: 'UI/Windows/Upgrade/InappLike1.png',
        },



        'BoxTabIcon': {
            file: 'UI/Windows/Puzzles/BoxTabIcon.png',
        },
        'PuzzleTabIcon': {
            file: 'UI/Windows/Puzzles/PuzzleTabIcon.png',
        },
        'PuzzleBonusBack': {
            file: 'UI/Windows/Puzzles/PuzzleItem/PuzzleBonusBack.png',
        },
        'PuzzleItemFrame': {
            file: 'UI/Windows/Puzzles/PuzzleItem/PuzzleItemFrame.png',
        },

        'PuzzleItemLockDL': {
            file: 'UI/Windows/Puzzles/PuzzleItem/Parts/blocked/PuzzleItemLockDL.png',
        },
        'PuzzleItemLockDR': {
            file: 'UI/Windows/Puzzles/PuzzleItem/Parts/blocked/PuzzleItemLockDR.png',
        },
        'PuzzleItemLockUL': {
            file: 'UI/Windows/Puzzles/PuzzleItem/Parts/blocked/PuzzleItemLockUL.png',
        },
        'PuzzleItemLockUR': {
            file: 'UI/Windows/Puzzles/PuzzleItem/Parts/blocked/PuzzleItemLockUR.png',
        },
        'PuzzleOpened': {
            file: 'UI/Windows/Puzzles/PuzzleItem/Parts/opened/s.png',
        },
        'PuzzleBronze': {
            file: 'UI/Windows/Puzzles/PuzzleItem/Parts/bronze/s.png',
        },
        'PuzzleSilver': {
            file: 'UI/Windows/Puzzles/PuzzleItem/Parts/silver/s.png',
        },
        'PuzzleGold': {
            file: 'UI/Windows/Puzzles/PuzzleItem/Parts/gold/s.png',
        },
        'PuzzleDiamond': {
            file: 'UI/Windows/Puzzles/PuzzleItem/Parts/diamond/s.png',
        },

        'PuzzlesOpened': {
            file: 'UI/Windows/Puzzles/PuzzlesOpened.png',
        },
        'PuzzlesBronze': {
            file: 'UI/Windows/Puzzles/PuzzlesBronze.png',
        },
        'PuzzlesSilver': {
            file: 'UI/Windows/Puzzles/PuzzlesSilver.png',
        },
        'PuzzlesGold': {
            file: 'UI/Windows/Puzzles/PuzzlesGold.png',
        },
        'PuzzlesDiamond': {
            file: 'UI/Windows/Puzzles/PuzzlesDiamond.png',
        },
        'BoxCounter': {
            file: 'UI/Windows/Puzzles/BoxCounter.png',
        },
        'CollectCrop': {
            file: 'UI/WindowsBigPictures/CollectCrop.png',
        },
        'Banjo': {
            file: 'UI/WindowsBigPictures/Banjo.png',
        },
        'BanjoEnd': {
            file: 'UI/WindowsBigPictures/BanjoEnd.png',
        },
        'MultiplyOnStart': {
            file: 'UI/WindowsBigPictures/MultiplyOnStart.png',
        },
        'Cloud': {
            file: 'UI/WindowsBigPictures/Cloud.png',
        },

        'Popup': {
            file: 'UI/HUD_and_common/Popup.png',
        },
        'PopupThumbsUp': {
            file: 'UI/HUD_and_common/PopupThumbsUp.png',
        },

        'NotEnoughGems' : {
            file :'UI/WindowsBigPictures/NotEnoughGems.png',
        },
        'NoAdAndRatings' : {
            file : 'UI/WindowsBigPictures/spaceman.png',
        },
        'OtherWorldsLocked': {
            file: 'UI/WindowsBigPictures/Scientist.png'
        },
        'Wait' : {
            file : 'UI/WindowsBigPictures/Wait.png',
        },
        // 'Clockwork_icon_big' : {
        //     file : 'GoodsBuyWindowIcons/Clockwork_icon.png',
        // },
        'AppleInfo' : {
            file: 'UI/WindowsBigPictures/AppleInfo.png',
        },
        'TimeTravel4h' : {
            file : 'UI/Windows/Upgrade/Items/TimeTravel4h.png',
        },
        'TimeTravel24h' : {
            file : 'UI/Windows/Upgrade/Items/TimeTravel24h.png',
        },
        'TimeTravel7d' : {
            file : 'UI/Windows/Upgrade/Items/TimeTravel7d.png',
        },

        'collectCropSplash': {
            file: 'Backs/collectCropSplash.png',
        },


        'FortuneWheelBack': {
            file: 'UI/Windows/FortuneWindow/WheelBack.png',
        },
        'FortuneWheel': {
            file: 'UI/Windows/FortuneWindow/Wheel.png',
        },
        'FortuneItemTimeTravel': {
            file: 'UI/Windows/FortuneWindow/ItemTimeTravel.png',
        },
        'FortuneHUDButton': {
            file: 'UI/Windows/FortuneWindow/HUDButton.png',
        },
        'FortuneDevil': {
            file: 'UI/Windows/FortuneWindow/Devil.png',
        },
        'FortuneWheelArrow': {
            file: 'UI/Windows/FortuneWindow/WheelArrow.png',
        },
        'OpenedBox': {
            file: 'UI/Windows/Puzzles/OpenedBox.png',
        },
        'GiftBoxSuper': {
            file: 'UI/Windows/Upgrade/Items/GiftBoxSuper.png',
        },

        'QuestBack': {
            file: 'UI/Windows/DailyQuests/Back.png',
        },
        'Quests_ProgressFill': {
            file: 'UI/Windows/DailyQuests/ProgressFill.png',
        },
        'Quests_ProgressBar': {
            file: 'UI/Windows/DailyQuests/ProgressBar.png',
        },
        'Quests_RefreshBtn': {
            file: 'UI/Windows/DailyQuests/RefreshBtn.png',
        },
        'QuestsHUDButton': {
            file: 'UI/HUD_and_common/HUD/HudDailyQuestsBtn.png',
        },

        'Daily_Opened': {
            file: 'UI/Windows/LoginBonus/Opened.png',
        },
        'Daily_Closed': {
            file: 'UI/Windows/LoginBonus/Closed.png',
        },
        'Daily_Active': {
            file: 'UI/Windows/LoginBonus/Active.png',
        },
        'Daily_Check': {
            file: 'UI/Windows/LoginBonus/04.png',
        },
        'Daily_HUDButton': {
            file: 'UI/HUD_and_common/HUD/HudLoginBonusBtn.png',
        },
        'GiftBoxSuperOpen' : {
            file :'UI/Windows/GetPuzzlePart/Chest_open.png',
        },
        'GiftBox' : {
            file :'UI/Windows/GetPuzzlePart/ChestNormal.png',
        },
        'GiftBoxOpen' : {
            file :'UI/Windows/GetPuzzlePart/ChestNormalOpen.png',
        },

        'SettingsBtn' : {
            file :'UI/HUD_and_common/SeetingBtn.png',
        },

        'Effect_Glow': {
            file: 'Effects/glow.png',
        },
    },
};

if (typeof exports !== 'undefined') {
    if (typeof module !== 'undefined' && module.exports) {
        exports = module.exports = CommonVisualData;
    }
    exports.CommonData = CommonVisualData;
    exports.UnnyObjectType = UnnyObjectType;
}

class GameTrail {
    constructor(game) {
        const engine = game.engine;
        this.group = engine.add.group();

        this.points = [];
        // const d = 0.2;
        for (let i = 0;i<10;i++) {
            const img = this.group.create(0, 0, "Effect_Glow").setDepth(WinDefaultDepth).setScale(0.5 ,0.5).setOrigin(0.5, 0);
            // img.setCrop(0, img.height * d, img.width, img.height * (1 - d * 2));
            this.points.push(img);
        }

        const trail = this;
        function getPos(ev) {
            const rect = GlobalGameLink.canvas.getBoundingClientRect();
            const x = (ev.clientX - rect.left) / rect.width * RealScreenWidth;
            const y = (ev.clientY - rect.top) / rect.height * RealScreenHeight;
            return {
                x: x,
                y: y
            }
        }

        document.body.onmousedown = function(ev) {
            trail.showTrail(getPos(ev));
        };
        document.body.onmouseup = function() {
            trail.hideTrail();
        };
        document.body.onmousemove = function(ev) {
            trail.moveTrail(getPos(ev));
        };

        game.update.addListener(this.update.bind(this));

        SetGroupVisible(this.group, false);
    }

    showTrail(pos) {
        this.visible = true;
        for (let i = 0; i < this.points.length; i++)
            this.points[i].setPosition(pos.x, pos.y);

        SetGroupVisible(this.group, true);
    }

    moveTrail(pos) {
        this.points[0].setPosition(pos.x, pos.y);
    }

    update(deltaTime) {
        if (this.visible) {
            // for (let i = this.points.length - 1;i > 0; i--) {
            //     const p = this.points[i];
            //     const p0 = this.points[i - 1];
            //     p.x = p0.x;
            //     p.y = p0.y;
            // }

            for (let i = 1;i < this.points.length; i++) {
                const p = this.points[i];
                const dx = this.points[i-1].x - p.x;
                const dy = this.points[i-1].y - p.y;
                const dist = Math.sqrt(dx * dx + dy * dy);

                if (dist < 1) {
                    p.setScale(0.5, 0);
                    continue;
                }

                const newDist = dist * 0.75;
                const k = newDist/dist;

                p.angle = -Math.atan2(dx, dy) / Math.PI * 180;
                p.setScale(0.5, dist / 38);

                p.x = p.x + dx * k;
                p.y = p.y + dy * k;
            }
        }
    }

    hideTrail() {
        this.visible = false;
        SetGroupVisible(this.group, false);
    }
}

let gameTrail;

function SocialVK() {

    let app_id;
    let loadedAds = [];
    let _getParams = null;
    const PURCHASE_SUFFIX = ".vk";
    let authorizing = false;

    function _preloadAd(callbacks, playMethod) {
        if (typeof admanInit === 'undefined') {
            if (callbacks && callbacks.onAdBlock)
                callbacks.onAdBlock();
            return;
        }
        console.log("preloadAdFor app " + app_id);
        admanInit({
            user_id: null,
            app_id: app_id,
            type: 'rewarded',         // 'preloader' или 'rewarded' (по умолчанию - 'preloader')
            // params: {preview: 1}   // для проверки корректности работы рекламы
        }, onAdsReady, onNoAds);

        function onAdsReady(adman) {
            loadedAds.push(adman);
            if (playMethod)
                playMethod(callbacks);
        }

        function onNoAds() {
            console.error("onNoAds");
            if (callbacks && callbacks.onNoAds)
                callbacks.onNoAds();
        }
    }

    function _playRewardedAd(callbacks) {
        if (loadedAds.length > 0) {
            adman = loadedAds.pop();
            if (callbacks.onStarted) {
                adman.onStarted(function () {
                    callbacks.onStarted();
                });
            }

            if (callbacks.onCompleted) {
                adman.onCompleted(function () {
                    callbacks.onCompleted();
                });
            }
            if (callbacks.onSkipped) {
                adman.onSkipped(function () {
                    callbacks.onSkipped();
                });
            }
            if (callbacks.onClicked) {
                adman.onClicked(function () {
                    callbacks.onClicked();
                });
            }
            adman.start('preroll');
            _preloadAd();
        } else
            _preloadAd(callbacks, _playRewardedAd);
    }

    function getAuthKey() {
        // return "a7aeecb9cf5b60cfba66225716e7395d";
        return _getParams['auth_key'];
    }

    function getViewerId() {
        // return "539955786";
        return _getParams['viewer_id'];
    }

    function _checkPurchases(consumeCallback, offset) {
        const request_limit = 20;
        offset = offset || 0;
        if (gBase)
        gBase.social.vkListPurchases(offset, request_limit, (err, response) => {
            console.info("list  err ", err);
            console.info("response ", response);
            if (err) {
                gameAnalytics.sendServerError(err, "vkListPurchases");
                socialManager.checkAuthStatus(err, () => _checkPurchases(consumeCallback, 0));
            } else {
                if (response) {
                    let stopped = false;
                    const arr = response.details.originalResponse;
                    for (let i = 0;i < arr.length; i++) {
                        const a = arr[i];
                        if (!a.isConsumed) {
                            console.warn("CONSUME " + a.purchaseNum);
                            gBase.social.vkConsumePurchase(a.purchaseNum, (err, response) => {
                                console.info("consume err ", err);
                                console.info("response ", response);

                                if (err) {
                                    gameAnalytics.sendServerError(err, "vkConsumePurchase");
                                    socialManager.checkAuthStatus(err, () => _checkPurchases(consumeCallback, 0));
                                    stopped = true;
                                }
                                else {
                                    const itemId = a.itemId ? a.itemId : a.productCode;
                                    consumeCallback(itemId.substring(0, itemId.length - PURCHASE_SUFFIX.length));
                                }
                            });
                        }

                        if (stopped)
                            return;
                    }

                    if (arr.length === request_limit)
                        _checkPurchases(consumeCallback, offset + request_limit);
                }
            }
        });
    }

    return {
        initVK: function (appId) {
            app_id = appId;
            this.createGBase();
            if (typeof VK !== 'undefined')
            VK.init(function() {
                // API initialization succeeded
                // console.info("INIT2 ", window.location);
                // Your code here
                // VK.callMethod("showInviteBox");

                var callbacksResults = document.getElementById('callbacks');

                VK.addCallback('onOrderSuccess', (order_id) => {
                    _checkPurchases((id)=>{
                       gameInit.progress.publicConfirmedPayment(id);
                    });
                });
            });
            _preloadAd();
        },

        setAllGetParams(prms) {
            _getParams = prms;
        },

        playRewardedAd: function (callbacks) {
            _playRewardedAd(callbacks);
        },

        isAuthorizing() {
            return authorizing;
        },

        reconnect(callback) {
            this.createGBase();
            this.authorize(()=> {
                if (gBase) {//legacy
                    gBase.profile.getp((err) => {
                        if (err)
                            gameAnalytics.sendServerError(err, "getp");
                        else
                            callback();
                    });
                } else
                    callback();
            });
        },

        authorize(callback) {

            const resp = (response) => {
                // console.info("AUTH>", response);
                if (response.success)
                    callback();
                else
                    console.error("Couldnt' authorize ", response.error);
            };

            if (!getViewerId() || !getAuthKey())
                UnnyNet.UnnyNet.authorize('test_user1', 'test_password', resp);
            else {
                authorizing = true;
                console.log("Authorize: " + getViewerId());
                if (gBase) {//legacy
                    gBase.account.authWebVk(getViewerId(), getAuthKey(), (err) => {
                        authorizing = false;
                        if (err)
                            gameAnalytics.sendServerError(err, "authWebVk");
                    });
                }
            }
        },

        checkPurchases(consumeCallback) {
            _checkPurchases(consumeCallback);
        },

        purchase(productId) {
            var params = {
                type: 'item',
                item: productId + PURCHASE_SUFFIX
            };

            VK.callMethod('showOrderBox', params);
        },

        getDisplayPrice(price) {
            return price + " Руб.";
        },

        getPriceLabel(productId) {
            return this.getDisplayPrice(this.getPrice(productId));
        },

        getPrice(productId) {
            const info = VisualData.getPaymentInfoById(productId);
            return info ? info.vk_price * 7 : 0;
        }
    };
}

function SocialOK() {

    let app_id;
    let loadedAds = [];
    let _getParams = null;
    const PURCHASE_SUFFIX = ".ok";
    let authorizing = false;

    let callbackOnNoAds = null;
    let callbackAdIsReady = null;
    let callbackAdStarted = null;
    let callbackAdCompleted = null;

    let callbackPostMessage = null;

    let authData;
    let authCallback;

    function _applyCallbacks() {

    }

    function _preloadAd(callbacks, playMethod) {
        // if (typeof admanInit === 'undefined') {
        //     if (callbacks && callbacks.onAdBlock)
        //         callbacks.onAdBlock();
        //     return;
        // }
        callbackAdIsReady = function onAdsReady() {
            loadedAds.push(1);
            if (playMethod)
                playMethod(callbacks);
            callbackAdIsReady = null;
        };

        callbackOnNoAds = function onNoAds() {
            console.warn("onNoAds");
            if (callbacks && callbacks.onNoAds)
                callbacks.onNoAds();
            callbackOnNoAds = null;
        };

        FAPI.invokeUIMethod("prepareMidroll");
    }

    function _playRewardedAd(callbacks) {
        if (callbacks.onStarted) {
            callbackAdStarted = function () {
                callbacks.onStarted();
                callbackAdStarted = null;
            }
        }

        if (callbacks.onCompleted) {
            callbackAdCompleted = function () {
                callbacks.onCompleted();
                callbackAdCompleted = null;
            }
        }

        if (loadedAds.length > 0) {
            loadedAds.pop();

            // if (callbacks.onCompleted) {//TODO
            //     adman.onCompleted(function () {
            //         callbacks.onCompleted();
            //     });
            // }

            FAPI.invokeUIMethod("showMidroll");
            _preloadAd();
        } else
            _preloadAd(callbacks, _playRewardedAd);
    }

    function _checkPurchases(consumeCallback, offset) {
        const request_limit = 20;
        offset = offset || 0;
        gBase.social.okListPurchases(offset, request_limit, (err, response) => {
            console.info("list  err ", err);
            console.info("response ", response);
            if (err) {
                gameAnalytics.sendServerError(err, "okListPurchases");
                socialManager.checkAuthStatus(err, () => _checkPurchases(consumeCallback, 0));
            } else {
                if (response) {
                    let stopped = false;
                    const arr = response.details.originalResponse;
                    for (let i = 0; i < arr.length; i++) {
                        const a = arr[i];
                        if (!a.isConsumed) {
                            console.warn("CONSUME " + a.purchaseNum);
                            gBase.social.okConsumePurchase(a.purchaseNum, (err, response) => {
                                console.info("consume err ", err);
                                console.info("response ", response);

                                if (err) {
                                    gameAnalytics.sendServerError(err, "okConsumePurchase");
                                    socialManager.checkAuthStatus(err, () => _checkPurchases(consumeCallback, 0));
                                    stopped = true;
                                }
                                else {
                                    const itemId = a.itemId ? a.itemId : a.productCode;
                                    consumeCallback(itemId.substring(0, itemId.length - PURCHASE_SUFFIX.length));
                                }
                            });
                        }

                        if (stopped)
                            return;
                    }

                    if (arr.length === request_limit)
                        _checkPurchases(consumeCallback, offset + request_limit);
                }
            }
        });
    }

    return {
        initOK: function (appId) {
            app_id = appId;
            this.createGBase();
            // gBase = new Gbase.GbaseApi(CURRENT_ENVIRONMENT.name, CURRENT_ENVIRONMENT.env, CURRENT_ENVIRONMENT.hmac, CURRENT_ENVIRONMENT.platform, CURRENT_ENVIRONMENT.version);
            if (typeof FAPI !== 'undefined') {
                var rParams = FAPI.Util.getRequestParameters();
                console.info("rParams", rParams);
                authData = rParams;
                FAPI.init(rParams["api_server"], rParams["apiconnection"],
                    /*
                    * Первый параметр:
                    * функция, которая будет вызвана после успешной инициализации.
                    */
                    function () {
                        window.API_callback = function (method, result, data) {
                            console.warn("method " + method + " > " + result + " data = ", data);
                            switch (method) {
                                case "postMediatopic":
                                    if (result === "ok") {
                                        if (callbackPostMessage) {
                                            callbackPostMessage();
                                            callbackPostMessage = null;
                                        }
                                    }
                                    break;
                                case "showInvite":
                                    if (result === "ok" && data) {
                                        const ids = data.split(",");
                                        if (ids && ids.length > 0)
                                            gameInit.likedSuccessfull(ids);
                                    }
                                    break;
                                case "showPayment":
                                    if (result === "ok") {
                                        _checkPurchases((id) => {
                                            gameInit.progress.publicConfirmedPayment(id);
                                        });
                                    }
                                    break;
                                case "prepareMidroll":
                                    switch (data) {
                                        case "ready":
                                            if (callbackAdIsReady)
                                                callbackAdIsReady();
                                            break;
                                        case "in_use":
                                            if (callbackAdStarted)
                                                callbackAdStarted();
                                            break;
                                        default:
                                            if (callbackOnNoAds)
                                                callbackOnNoAds();
                                            break;
                                    }
                                    break;
                                case "showMidroll":
                                    if (result === "ok") {
                                        switch (data) {
                                            case "complete":
                                                if (callbackAdCompleted)
                                                    callbackAdCompleted();
                                                break;
                                        }
                                    } else {
                                        if (callbackOnNoAds)
                                            callbackOnNoAds();
                                    }
                                    break;
                            }
                        }
                    },
                    /*
                    * Второй параметр:
                    * функция, которая будет вызвана, если инициализация не удалась.
                    */
                    function (error) {
                        alert("Ошибка инициализации");
                    }
                );
            }

            _preloadAd();
        },

        openLikes() {
            FAPI.UI.showInvite("Поиграй в мою игру!");
        },

        setAllGetParams(prms) {
            _getParams = prms;
        },

        playRewardedAd: function (callbacks) {
            _playRewardedAd(callbacks);
        },

        isAuthorizing() {
            return authorizing;
        },

        authorize(callback) {
            if (!authData) {
                console.log("Waiting for auth data");
                authCallback = callback;
            }
            else {
                authorizing = true;
                // okId, okSecret, okSessionKey
                gBase.account.authWebOk(authData.logged_user_id, authData.auth_sig, authData.session_key, (err) => {//TODO
                    authorizing = false;
                    console.info("auth!!", err);
                    if (err)
                        gameAnalytics.sendServerError(err, "authWebOk");
                    callback();
                });
            }
        },

        checkPurchases(consumeCallback) {
            _checkPurchases(consumeCallback);
        },

        purchase(productId) {
            FAPI.UI.showPayment("Кристаллы", "С ними быстрее качаться!", productId + PURCHASE_SUFFIX, this.getPrice(productId), null, null, "ok", "true");//TODO
        },

        getPrice(productId) {
            const info = VisualData.getPaymentInfoById(productId);
            return info ? info.ok_price : 0;
        },

        getDisplayPrice(price) {
            return price + " ОК";
        },

        getPriceLabel(productId) {
            return this.getDisplayPrice(this.getPrice(productId));
        },

        postMessage(callback) {
            callbackPostMessage = callback;
            FAPI.UI.postMediatopic({
                "media":[
                    {
                        "type": "text",
                        "text": "Давай играть вместе!"
                    }
                ]
            }, false);
        }
    };
}

function SocialFB() {

    let app_id;
    let loadedAds = [];
    let _getParams = null;

    function _preloadAd(callbacks, playMethod) {
        if (typeof admanInit === 'undefined') {
            if (callbacks && callbacks.onAdBlock)
                callbacks.onAdBlock();
            return;
        }
        admanInit({
            user_id: null,
            app_id: app_id,
            type: 'rewarded',         // 'preloader' или 'rewarded' (по умолчанию - 'preloader')
            // params: {preview: 1}   // для проверки корректности работы рекламы
        }, onAdsReady, onNoAds);

        function onAdsReady(adman) {
            loadedAds.push(adman);
            if (playMethod)
                playMethod(callbacks);
        }

        function onNoAds() {
            console.warn("onNoAds");
            if (callbacks && callbacks.onNoAds)
                callbacks.onNoAds();
        }
    }

    function _playRewardedAd(callbacks) {
        if (loadedAds.length > 0) {
            adman = loadedAds.pop();
            if (callbacks.onStarted) {
                adman.onStarted(function () {
                    callbacks.onStarted();
                });
            }

            if (callbacks.onCompleted) {
                adman.onCompleted(function () {
                    callbacks.onCompleted();
                });
            }
            if (callbacks.onSkipped) {
                adman.onSkipped(function () {
                    callbacks.onSkipped();
                });
            }
            if (callbacks.onClicked) {
                adman.onClicked(function () {
                    callbacks.onClicked();
                });
            }
            adman.start('preroll');
            _preloadAd();
        } else
            _preloadAd(callbacks, _playRewardedAd);
    }

    function _checkPurchases(consumeCallback, offset) {
        console.error("_checkPurchases NOT implemented");
    }

    return {
        initFB: function (appId) {
            app_id = appId;
            this.createGBase();
        },

        setAllGetParams(prms) {
            _getParams = prms;
        },

        playRewardedAd: function (callbacks) {
            // _playRewardedAd(callbacks);
            console.error("not implemented");
        },

        authorize(callback) {
            if (window.fbAsyncInit) {
                callback();
                return;
            }
            window.fbAsyncInit = function() {
                FB.init({
                    appId      : app_id,
                    cookie     : true,
                    xfbml      : true,
                    version    : 'v3.3'
                });

                FB.AppEvents.logPageView();

                function onLogin(response) {
                    var accessToken = response.authResponse.accessToken;

                    const resp = (response) => {
                        // console.info("AUTH>", response);
                        if (response.success)
                            callback();
                        else
                            console.error("Couldnt' authorize ", response.error);
                    };

                    if (gBase) {
                        gBase.account.authFb(accessToken, (err) => {
                            if (err)
                                gameAnalytics.sendServerError(err, "authFb");
                            callback();
                        });
                    } else {
                        UnnyNet.UnnyNet.authorize('test_user1', 'test_password', resp);
                    }
                }

                FB.getLoginStatus(function(response) {
                    if (response.status === 'connected') {
                        // the user is logged in and has authenticated your
                        // app, and response.authResponse supplies
                        // the user's ID, a valid access token, a signed
                        // request, and the time the access token
                        // and signed request each expire
                        // var uid = response.authResponse.userID;
                        onLogin(response);
                    } else {
                        FB.login(function (response) {
                            onLogin(response);
                        }, {scope: 'email'});
                    }
                });
            };

            (function(d, s, id){
                var js, fjs = d.getElementsByTagName(s)[0];
                if (d.getElementById(id)) {return;}
                js = d.createElement(s); js.id = id;
                js.src = "https://connect.facebook.net/en_US/sdk.js";
                fjs.parentNode.insertBefore(js, fjs);
            }(document, 'script', 'facebook-jssdk'));
        },

        checkPurchases(consumeCallback) {
            console.error("checkPurchases(consumeCallback) not implemented!");
        },

        getDisplayPrice(price) {
            return price + " ЮНЕК";
        },

        getPriceLabel(productId) {
            return this.getDisplayPrice(this.getPrice(productId));
        },

        getPrice(productId) {
            const info = VisualData.getPaymentInfoById(productId);
            return info ? info.vk_price * 7 : 0;
        }
    };
};

function SocialNutaku() {

    let _getParams = null;
    let user_id = null;

    function _checkPurchases(consumeCallback) {
        // console.warn("_CHECK? " + user_id);
        if (!user_id)
            return null;

        UnnyNet.UnnyNet.getPurchases(UnnyNet.PurchaseStatusFilter.COMPLETED, (response) => {
            // console.info("COMPLETED", response);
            if (response.success) {
                const list = response.data;
                for (let i in list) {
                    const id = list[i].id;
                    if (id)
                        UnnyNet.UnnyNet.claimPurchase2(user_id, 2, id, (response2) => {//TODO fix it
                            if (response2.success) {
                                console.info("claim2", response2);
                                if (consumeCallback)
                                    consumeCallback();
                            } else {
                                console.error("[ERROR]completeNutakuPurchase2: ", response2);
                            }
                        });
                }
            } else {
                console.error("[ERROR]getPurchases: ", response);
            }
        });

        UnnyNet.UnnyNet.getPurchases(UnnyNet.PurchaseStatusFilter.PENDING, (response) => {
            console.info("RESPINSE", response);
            if (response.success) {
                const list = response.data;
                for (let i in list) {
                    const id = list[i].id;
                    if (id)
                        UnnyNet.UnnyNet.completeNutakuPurchase2(user_id, UnnyNet.NutakuPlatform.PCBrowser, id, (response2) => {
                            if (response2.success) {
                                console.info("COMPLETE..", response2);
                                UnnyNet.UnnyNet.claimPurchase2(user_id, 2, response2.data.id, (response3) => {//TODO fix it
                                    console.info("CLAIMED..", response3);
                                    if (consumeCallback)
                                        consumeCallback();
                                });
                            } else {
                                console.error("[ERROR]completeNutakuPurchase2: ", response2);
                            }
                        });
                }
            } else {
                console.error("[ERROR]getPurchases: ", response);
            }
        });
    }

    return {
        initNutaku: function (appId) {
            if (typeof opensocial != "undefined") {
                let req = opensocial.newDataRequest();
                req.add(req.newFetchPersonRequest(opensocial.IdSpec.PersonId.VIEWER), "viewer");
                req.send(function (response) {
                    if (response.hadError()) {
                        // error
                    } else {
                        let item = response.get("viewer");
                        if (item.hadError()) {
                            // error
                        } else {
                            let viewer = item.getData();
                            user_id = viewer.getId();
                            // var nickname = viewer.getDisplayName();
                            console.info("USER", viewer);
                            // ...
                        }
                    }
                });
            }
        },

        playRewardedAd: function (callbacks) {
            if (callbacks)
                callbacks.onCompleted();
        },

        setAllGetParams(prms) {
            _getParams = prms;
        },

        checkPurchases(consumeCallback) {
            _checkPurchases((id) => {
                gameInit.progress.publicConfirmedPayment("hellprodgems200");
            });
        },

        purchase(productId) {
            if (typeof gadgets === "undefined") {
                gameInit.progress.publicConfirmedPayment(productId);
                return;
            }

            UnnyNet.UnnyNet.purchaseProduct("test", (response) => {
                console.warn("Go check now", response);
                _checkPurchases((id) => {
                    gameInit.progress.publicConfirmedPayment(productId);
                });
            });
        },

        authorize(callback) {
            const resp = (response) => {
                // console.info("AUTH>", response);
                if (response.success)
                    callback();
                else
                    console.error("Couldnt' authorize ", response.error);
            };

            if (typeof gadgets != "undefined")
                UnnyNet.UnnyNet.Nutaku.authorize(resp);
            else
                UnnyNet.UnnyNet.authorize('test_user1', 'test_password', resp);
        },

        getDisplayPrice(price) {
            return 1000;
        },

        getPriceLabel(productId) {
            return this.getDisplayPrice(this.getPrice(productId));
        },

        getPrice(productId) {
            const info = VisualData.getPaymentInfoById(productId);
            return info ? info.nutaku_price : 0;
        }
    }
}

function SocialFB_Instant() {

    let app_id;
    let loadedAds = [];
    let _getParams = null;

    function _preloadAd(callbacks, playMethod) {
        if (typeof admanInit === 'undefined') {
            if (callbacks && callbacks.onAdBlock)
                callbacks.onAdBlock();
            return;
        }
        admanInit({
            user_id: null,
            app_id: app_id,
            type: 'rewarded',         // 'preloader' или 'rewarded' (по умолчанию - 'preloader')
            // params: {preview: 1}   // для проверки корректности работы рекламы
        }, onAdsReady, onNoAds);

        function onAdsReady(adman) {
            loadedAds.push(adman);
            if (playMethod)
                playMethod(callbacks);
        }

        function onNoAds() {
            console.warn("onNoAds");
            if (callbacks && callbacks.onNoAds)
                callbacks.onNoAds();
        }
    }

    function _playRewardedAd(callbacks) {
        if (loadedAds.length > 0) {
            adman = loadedAds.pop();
            if (callbacks.onStarted) {
                adman.onStarted(function () {
                    callbacks.onStarted();
                });
            }

            if (callbacks.onCompleted) {
                adman.onCompleted(function () {
                    callbacks.onCompleted();
                });
            }
            if (callbacks.onSkipped) {
                adman.onSkipped(function () {
                    callbacks.onSkipped();
                });
            }
            if (callbacks.onClicked) {
                adman.onClicked(function () {
                    callbacks.onClicked();
                });
            }
            adman.start('preroll');
            _preloadAd();
        } else
            _preloadAd(callbacks, _playRewardedAd);
    }

    return {
        initFB: function (appId) {
            app_id = appId;
            this.createGBase();
        },

        setAllGetParams(prms) {
            _getParams = prms;
        },

        playRewardedAd: function (callbacks) {
            // _playRewardedAd(callbacks);
            console.error("not implemented");
        },

        authorize(callback) {
            callback();
        },

        checkPurchases(consumeCallback) {
            console.error("checkPurchases(consumeCallback) not implemented!");
        },

        getDisplayPrice(price) {
            return price + " ЮНЕК";
        },

        getPriceLabel(productId) {
            return this.getDisplayPrice(this.getPrice(productId));
        },

        getPrice(productId) {
            const info = VisualData.getPaymentInfoById(productId);
            return info ? info.vk_price * 7 : 0;
        }
    };
};

const UN_DATA = {
    //fish
    "5c02bb6d-3afb-4ca5-8f91-ce69d2c5a28d" : {
        leaderboards: {
            boxes: "a332f1d7-80fd-40de-97a8-f8a3948ebad7",
            factory: "bb340b93-11b0-4ce7-8ebb-ba5dcaa672dd"
        },
        achievements: {
            factory: 1,
            slot_1: 4,
            slot_2: 5,
            slot_3: 6,
            slot_4: 7,
            slot_5: 8,
            slot_6: 9,
            slot_7: 10,
            slot_8: 11,
            slot_9: 12,
        }
    },

    //hell
    "819ced8f-14c6-478d-85d2-0fa616f79fa5" : {
        leaderboards: {
            boxes: "058acf78-ef5a-4f0c-8074-a84cb0c06e09",
            factory: "9db0b3ae-2877-48df-a1e1-ff89f0a196d5"
        },
        achievements: {
            factory: 10,
            slot_1: 1,
            slot_2: 2,
            slot_3: 3,
            slot_4: 4,
            slot_5: 5,
            slot_6: 6,
            slot_7: 7,
            slot_8: 8,
            slot_9: 9,
        }
    }
};

const GAME_ENVIRONMENTS = {
    'fish_vk_prod': {
        name: "rmg-vkfish",
        env: "production",
        hmac: 'bR2UBrFSHflMlXILNVENAoLR',
        platform: "webvk",
        version: "0.0.1",
        un_game_id: "5c02bb6d-3afb-4ca5-8f91-ce69d2c5a28d",
        un_key: "MTRhZjU5NTUtMzdmNS00",
        environment: UnnyNet.Environment.Production,
    },
    'fish_vk_dev': {
        name: 'rmg-vkfish',
        env: 'dev',
        hmac: 'mE2ibFZ1tPCDOcdc6n0XB7I4',
        platform: "webvk",
        version: "0.0.1",
        un_game_id: "5c02bb6d-3afb-4ca5-8f91-ce69d2c5a28d",
        un_key: "MTRhZjU5NTUtMzdmNS00",
        environment: UnnyNet.Environment.Development,
    },
    'fish_ok_prod': {
        name: "rmg-vkfish",
        env: "production",
        hmac: 'J8Bsh1KT2bt4gnUcSEJrjrep',
        platform: "webok",
        version: "0.0.1",
        un_game_id: "5c02bb6d-3afb-4ca5-8f91-ce69d2c5a28d",
        un_key: "MTRhZjU5NTUtMzdmNS00",
        environment: UnnyNet.Environment.Production,
    },
    'fish_ok_dev': {
        name: 'rmg-vkfish',
        env: 'dev',
        hmac: 'uwe6KwuCvFLCU5WuwXXU4pMW',
        platform: "webok",
        version: "0.0.1",
        un_game_id: "5c02bb6d-3afb-4ca5-8f91-ce69d2c5a28d",
        un_key: "MTRhZjU5NTUtMzdmNS00",
        environment: UnnyNet.Environment.Development,
    },
    'myth_dev': {
        un_game_id: "f6d3e8d9-e41b-4fde-bdf0-d30df9092672",
        un_key: "YTNkYmQxZjktNTk0Ny00",
        environment: UnnyNet.Environment.Development,
    },

    'hell_vk_dev': {
        env: 'dev',
        un_game_id: "819ced8f-14c6-478d-85d2-0fa616f79fa5",
        un_key: "MDYxMWIyNGEtYjdhZS00",
        environment: UnnyNet.Environment.Development,
    },

    'hell_fb_dev': {
        env: 'dev',
        un_game_id: "819ced8f-14c6-478d-85d2-0fa616f79fa5",
        un_key: "MDYxMWIyNGEtYjdhZS00",
        environment: UnnyNet.Environment.Development,
    }
};

const DEFAULT_PLATFORM = "nutaku";
const DEFAULT_ENVIRONMENT = "myth_dev";

let AllGetParams = null;
function parseGetParams() {
    if (!AllGetParams) {
        const prms = {};
        var queryString = window.location.search;
        if (queryString && queryString.length > 0) {
            queryString = queryString.substring(1);
            const queries = queryString.split("&");

            for (let i = 0; i < queries.length; i++) {
                const kvp = queries[i].split('=');
                if (kvp[0].startsWith("amp;"))
                    prms[kvp[0].substring(4)] = kvp[1];
                else
                    prms[kvp[0]] = kvp[1];
            }
        }
        AllGetParams = prms;
    }
    return AllGetParams;
}
var socialManager;
parseGetParams();

if (!AllGetParams.hasOwnProperty('game_platform')) {
    console.log("platform wasn't specified, use default: " + DEFAULT_PLATFORM);
    AllGetParams.game_platform = DEFAULT_PLATFORM;
}

if (!AllGetParams.hasOwnProperty('game_env')) {
    console.log("game_env wasn't specified, use default: " + DEFAULT_ENVIRONMENT);
    AllGetParams.game_env = DEFAULT_ENVIRONMENT;
}

const CURRENT_ENVIRONMENT = GAME_ENVIRONMENTS[AllGetParams.game_env];

const CURRENT_UN_DATA = UN_DATA[CURRENT_ENVIRONMENT.un_game_id];

const TEST_MODE = true;//AllGetParams.test_mode;
const DEBUG_MODE = AllGetParams.debug_mode;

{
    switch (AllGetParams.game_platform) {
        case "vk":
            socialManager = new SocialVK();
            socialManager.initialize = function (gameSettings) {
                socialManager.initVK(gameSettings.vk_app_id);
            };
            break;
        case "ok":
            socialManager = new SocialOK();
            socialManager.initialize = function (gameSettings) {
                socialManager.initOK(gameSettings.ok_app_id);
            };
            break;
        case "fb":
            socialManager = new SocialFB();
            socialManager.initialize = function (gameSettings) {
                socialManager.initFB(gameSettings.fb_app_id);
            };
            break;
        case "nutaku":
            socialManager = new SocialNutaku();
            socialManager.initialize = function (gameSettings) {
                socialManager.initNutaku();
            };
            break;
        case "fb_instant":
            socialManager = new SocialFB_Instant();
            socialManager.initialize = function (gameSettings) {
                socialManager.initFB(gameSettings.fb_app_id);
            };
            break;
    }
}

socialManager.createGBase = function() {
    if (CURRENT_ENVIRONMENT.hmac)
        gBase = new Gbase.GbaseApi(CURRENT_ENVIRONMENT.name, CURRENT_ENVIRONMENT.env, CURRENT_ENVIRONMENT.hmac, CURRENT_ENVIRONMENT.platform, CURRENT_ENVIRONMENT.version);
};

socialManager.reconnect = function (callback) {
    this.createGBase();
    this.authorize(()=> {
        gBase.profile.getp((err) => {
            if (err)
                gameAnalytics.sendServerError(err, "getp");
            else
                callback();
        });
    });
};

socialManager.checkAuthStatus = function(err, callback) {
    if (err.code == 310 && !socialManager.isAuthorizing()) {
        console.log("Re-auth");
        socialManager.reconnect(callback);
    }
};

const FINGER_TYPE = {
    NONE: "None",
    SOFT: "Soft",
    HARD: "Hard"
};

const TutStartPhase = 0;

class Tutorial {
    constructor() {
        this.depth = WinDefaultDepth + 900;
        this.guardShown = false;
        this.supervisorShown = false;
        this.fortuneShown = false;
        this.timers = [];

        this.dialogCallback = this.dialogClicked.bind(this);
        this.resourcesCallback = this.resourcesChanged.bind(this);
    }

    dialogClicked() {
        this.goToNextStep();
    }

    resourcesChanged() {
        switch (this.phaseData.actionType) {
            case "CollectGold":
                // console.log("IS " + this.phaseData.parameter + " ? " + gameInit.progress.getTotalResources().compare(this.phaseData.parameter * RESOURCES_SCALE));
                if (gameInit.progress.getTotalResources().compare(this.phaseData.parameter * RESOURCES_SCALE) >= 0) {
                    if (this.fingerAnimation) {
                        clearInterval(this.fingerAnimation);
                        this.fingerAnimation = null;
                    }

                    this.goToNextStep();
                }
                break;
        }
    }

    loaded(progress) {
        const phase = progress.getTutorialPhase();

        const data = GameData.getTutorialConfig();
        const phaseIndex = this.getPhaseIndex(phase);

        if (phaseIndex >= 0) {
            // console.error("loaded " + phase, data[phaseIndex]);
            if (data[phaseIndex].actionType !== 'Completed') {

                gameInit.progress.onResourcesChanges.addListener(this.resourcesCallback);
                this.newMethod = tutorial.update.bind(tutorial);
                gameInit.update.addListener(this.newMethod);

                guiManager.getWindowByType(WindowType.WinMain).hideAllButtonsForTutorial();
                hudResources.hideForTutorial();

                for (let i = 0; i <= phaseIndex; i++)
                    this.preparePhase(data[i].stepNumber, i, i < phaseIndex);
            } else
                this.stopTutorial();
        }
    }

    stopTutorial() {
        if (this.newMethod) {
            gameInit.progress.onResourcesChanges.removeListener(this.resourcesCallback);
            gameInit.update.removeListener(this.newMethod);
        }
        guiManager.setTutorialPhrase(null);
        this._hideFinger();
    }

    playSwipeAnimation() {
        const oxy = {
            x: this.finger.obj.x / localScale,
            y: this.finger.obj.y / localScale
        };

        const play = () => {
            if (this.finger.visible) {
                this.finger.playAppear(true);
                this.timers[0] = setTimeout(() => {
                    this.finger_move_animation = animManager.moveToPoint(this.finger.obj, {
                        x: oxy.x + 200 * GlobalScale,
                        y: oxy.y - 100 * GlobalScale
                    }, 0.3, () => {
                        this.finger.playDisappear(true);
                        this.timers[1] = setTimeout(() => {
                            this.finger_move_animation = animManager.moveToPoint(this.finger.obj, oxy, 0.7, () => {
                                this.finger_move_animation = null;
                            });
                            this.timers[1] = null;
                        }, 500);
                        this.timers[0] = null;
                    });
                }, 500);
            }
        };
        const intervalTimer = setInterval(() => {
            play();
        }, 2000);
        play();

        return intervalTimer;
    }

    pointAtPosition(pos, center, useScale, no_animation, hold_time) {
        this.finger.setVisible(true);
        const x = (useScale ? pos.x / localScale : pos.x) + (center ? 0 : VisualData.MAP_PARAMS.center.x);
        const y = (useScale ? pos.y / localScale : pos.y) + (center ? 0 : VisualData.MAP_PARAMS.center.y);
        this.finger.setPosition(x, y);
        this.circle.setPosition(x, y);

        if (this.intervalTimer)
            clearInterval(this.intervalTimer);

        if (this.finger_move_animation) {
            this.finger_move_animation.stopAnimation();
            this.finger_move_animation = null;
        }

        for (let i = 0; i <= 1; i++) {
            if (this.timers[i]) {
                clearTimeout(this.timers[i]);
                this.timers[i] = null;
            }
        }

        this.circle.setVisible(false);

        if (no_animation)
            return;

        hold_time = hold_time ? hold_time * 1000 : 0;
        const play = () => {
            if (this.finger.visible) {
                this.finger.playAppear(true);
                this.timers[0] = setTimeout(() => {
                    this.circle.setVisible(true);
                    animManager.scaleAlphaOnce(this.circle, 0.5, null, 0.5);
                    this.timers[0] = null;
                }, 100);

                this.timers[1] = setTimeout(() => {
                    this.finger.playDisappear(true);
                    this.timers[1] = null;
                }, 500 + hold_time);
            }
        };
        this.intervalTimer = setInterval(() => {
            play();
        }, 1200 + hold_time);
        play();
    }

    _isWindow(winType) {
        return this.lastWindow == winType;
    }

    _lockAtButton(btn, center, pos) {
        if (!btn)
            return;

        lockGuiAtButton(btn);
        if (pos) {
            this.pointAtPosition(pos);
            return;
        }

        if (btn.getParentObject) {
            const p = btn.getParentObject();
            this.pointAtPosition({
                x: p.x / localScale,
                y: p.y / localScale + (0.5 - btn.originY) * btn.height
            }, center);
        } else if (btn.originY && btn.originY !== 0.5) {
            this.pointAtPosition({
                x: btn.x,
                y: btn.y + (0.5 - btn.originY) * btn.height
            }, center);
        } else {
            this.pointAtPosition(btn, center);
        }
    }

    _hideFinger() {
        this.finger.setVisible(false);
        this.circle.setVisible(false);
    }

    _getFirstSlotPosition() {
        const pos = VisualData.PLACED_BUILDINGS[1].position;
        const key = VisualData.PLACED_BUILDINGS[1].levels[0].building;
        const offset = VisualData.VISUAL_BUILDINGS[key].objects[0];
        return {
            x: pos.x + offset.x,
            y: pos.y + offset.y,
        };
    }

    getPhaseIndex(phase) {
        return Progress.getPhaseIndex(phase);
    }

    goToNextPhase() {
        unlockGUI();
        unlockAnimatedObject();
        this._hideFinger();
        this.phaseIndex = this.getPhaseIndex(this.phase + 1);
        this.preparePhase(this.phase, this.phaseIndex);
    }

    goToNextStep() {
        unlockGUI();
        unlockAnimatedObject();
        this._hideFinger();
        // console.log("goToNextStep ");
        // // console.log("MOVE to " + this.phase);
        // gameAnalytics.sendEvent("Tutorial", {
        //     "phase": this.phase
        // });

        const data = GameData.getTutorialConfig();
        const d = data[++this.phaseIndex];

        if (gameInit.progress.getTutorialPhase() < d.stepNumber)
            gameInit.progress.setTutorialPhase(d.stepNumber);

        this.preparePhase(d.stepNumber, this.phaseIndex);
    }

    preparePhase(phase, phaseIndex, fastComplete) {
        this.phase = phase;
        this.phaseIndex = phaseIndex;
        this.lastWindow = guiManager.getWinTypeAtTheTop();
        this.lastTab = 0;

        const data = GameData.getTutorialConfig();
        const phaseData = data[this.phaseIndex];

        this.phaseData = phaseData;

        //close last dialog
        if (this._isWindow(WindowType.QuestBubble)) {
            const win = guiManager.getActiveWindow();
            win.closeWindow();
        }

        // console.log("preparePhase " + phase + " > " + phaseIndex + " = " + phaseData.actionType + " win = " + this.lastWindow);

        if (phaseData.showHint) {
            guiManager.setTutorialPhrase(LocalizationManager.getTutorialLocalizization(phaseData.localizationKey));
        } else
            guiManager.setTutorialPhrase(null);

        switch (phaseData.actionType) {
            case "ShowDialog":
                guiManager.showQuestMessage(LocalizationManager.getTutorialLocalizization(phaseData.localizationKey), phaseData.parameter, this.dialogCallback);
                break;
            case "ClickSlot":
                if (this._isWindow(WindowType.WinMain)) {
                    if (!VisualData.getGameSettings().slot_purchase_as_buttons) {
                        this.pointAtPosition(this._getFirstSlotPosition());
                        lockGuiEverything();
                    } else {
                        this._lockAtButton(buildingsGUI.getPurchaseButton(1, 1), true);
                    }
                } else {
                    if (this._isWindow(WindowType.WinConstruct))
                        this._lockAtButton(guiManager.getActiveWindow().getTutorialButton());
                }
                break;
            case "ChangeGameModeToUpgrade":
                const win = guiManager.getWindowByType(WindowType.WinMain);
                win.showUpgradeButton();
                if (this._isWindow(WindowType.WinMain)) {
                    lockAtOneAnimatedObject(win);
                    this._lockAtButton(win.getUpgradeButton(), true);
                }
                break;
            case "UpgradeSlot":
                if (phaseData.fingerType !== FINGER_TYPE.NONE) {
                    if (this._isWindow(WindowType.WinUpgrade)) {
                        lockGuiEverything();
                        unlockAnimatedObject();
                        this.pointAtPosition(this._getFirstSlotPosition(), null, null, false, 0.5);
                        buildingsGUI.hideSomeLabelsForTutorial();
                    }
                }
            {
                if (fastComplete)
                    hudResources.showTokens();
                const win = guiManager.getWindowByType(WindowType.WinMain);
                win.showUpgradeButton();
            }
                break;
            case "ChangeGameModeToNormal":
                this._lockAtButton(guiManager.getActiveWindow().getExitButton(), true);
                break;
            case "CloseGirlListWindow": {
                this._lockAtButton(guiManager.getActiveWindow().getExitButton(), true);
                const win = guiManager.getWindowByType(WindowType.WinPhotosMainMenu);
                if (win.scroll)
                    win.scroll.setScrollerEnable(true);
                break;
            }
            case "ClickGirlMenuButton": {
                const win = guiManager.getWindowByType(WindowType.WinMain);
                win.showGirlsMenuButton();
                if (this._isWindow(WindowType.WinMain)) {
                    this._lockAtButton(win.getGirlsMenuButton(), true);
                } else if (this._isWindow(WindowType.WinPhotosMainMenu))
                    this.goToNextStep();
                break;
            }
            case "OpenGirlListWindow":
            case "OpenBioWindow":
            case "OpenUpgradeMarketWindow":
            case "OpenDoublingsWindow":

            case "OpenPuzzlesWindow":
            case "ClickOpenBoxItem":
                this.goToNextStep();
                break;
            case "OpenGirlQuestWindow": {
                if (this._isWindow(WindowType.WinPhotosMainMenu)) {
                    const win = guiManager.getWindowByType(WindowType.WinPhotosMainMenu);
                    win.scroll.setScrollerEnable(false);
                    const btn = win.getButtonByTag("Peristera");
                    this._lockAtButton(btn, true, win.getButtonPosByTag());
                }
                break;
            }
            case "ClickBioButton": {
                if (this._isWindow(WindowType.WinGirlBio))
                    this.goToNextStep();
                else {
                    const win = guiManager.getWindowByType(WindowType.WinPhotosQuest);
                    this._lockAtButton(win.GirlDescription, true);
                }
                break;
            }
            case "ClickUnlockPhotoButton": {
                const win = guiManager.getWindowByType(WindowType.WinPhotosQuest);
                this._lockAtButton(win.actionButton, true);
                break;
            }
            case "ClickUpgradeMarketButton": {
                hudResources.showGems();
                const win = guiManager.getWindowByType(WindowType.WinMain);
                win.showStoreButton();
                if (this._isWindow(WindowType.WinMain)) {
                    GlobalInputLocked = true;
                    this._lockAtButton(win.getStoreButton(), true);
                } else if (this._isWindow(WindowType.WinStore))
                    this.goToNextStep();
                break;
            }
            case "BuyAutoClickUpgrade": {
                const id = VisualData.getAutoClickSlot1Id();
                if (!gameInit.progress.isUpgradePurchased(id) && this._isWindow(WindowType.WinStore)) {
                    GlobalInputLocked = false;
                    const win = guiManager.getActiveWindow();
                    this._lockAtButton(win.getFirstUpgradeSlot(), true);
                    win.scroll.setScrollerEnable(false);
                }
                break;
            }
            case "ClickManagerButton": {
                if (this._isWindow(WindowType.WinMain)) {
                    GlobalInputLocked = true;
                    const win = guiManager.getActiveWindow();
                    win.showSuperVisorButton();
                    this._lockAtButton(win.getSuperVisorButton(), true);
                } else if (this._isWindow(WindowType.WinManagerDoubling))
                    this.goToNextStep();
                break;
            }
            case "StartSuperDoubling": {
                if (this._isWindow(WindowType.WinMain)) {
                    if (this.supervisorShown)
                        this.goToNextStep();
                    else {
                        this._hideFinger();
                        unlockAnimatedObject();
                    }
                } else {
                    if (this._isWindow(WindowType.WinBanjoEnd)) {
                        this._lockAtButton(guiManager.getActiveWindow().getTutorialButton());
                        this.supervisorShown = true;
                    } else {
                        if (this._isWindow(WindowType.WinManagerDoubling)) {
                            if (!gameInit.progress.haveAnySuperDoublingTokens())
                                this.goToNextStep();
                            else
                                this._lockAtButton(guiManager.getActiveWindow().getTutorialButton(), true);
                        }
                    }
                }
                break;
            }
            case "BuySlots": {
                if (gameInit.progress.getConstructedBuildingsCount() >= 6)
                    this.goToNextStep();
                break;
            }
            case "ClickPrestigeButton": {
                if (gameInit.progress.getHarvestsCount() >= 1)
                    this.goToNextStep();
                else {
                    lockGuiEverything();
                    lockAtOneAnimatedObject(visualGame.getBoss());
                    if (this._isWindow(WindowType.WinMain)) {
                        const win = guiManager.getActiveWindow();
                        win.showBossButton();
                        this._lockAtButton(win.getBossButton(), true);
                    } else {
                        if (this._isWindow(WindowType.WinBossSummon))
                            this.goToNextStep();
                    }
                    break;
                }
                break;
            }
            case "OpenPrestigeWindow":
                if (this._isWindow(WindowType.WinBossSummon))
                    this._lockAtButton(guiManager.getActiveWindow().getTutorialButton());
                else {
                    if (this._isWindow(WindowType.WinBossProccess))
                        this.goToNextStep();
                }
                break;
            case "StartPrestige": {
                if (this._isWindow(WindowType.WinHarvested))
                    this.goToNextStep();
                break;
            }
            case "CompletePrestige": {
                if (guiManager.getWinTypeAtTheTop() == WindowType.WinMain) {
                    this.goToNextStep();
                    guiManager.getWindowByType(WindowType.WinMain).showAllButtonsFromTutorial();
                }
                hudResources.showStars();
                break;
            }
            case "ClickPuzzlesButton": {
                GlobalInputLocked = true;
                if (this._isWindow(WindowType.WinMain)) {
                    const win = guiManager.getActiveWindow();
                    this._lockAtButton(win.getPuzzlesButton(), true);
                } else if (this._isWindow(WindowType.WinPuzzle))
                    this.goToNextStep();

                break;
            }
            case "ClickBoxTab": {
                if (this._isWindow(WindowType.WinPuzzle)) {
                    const win = guiManager.getActiveWindow();
                    this.lastTab = win.getSelectedTab();
                    if (this.lastTab === 0)
                        this._lockAtButton(win.getBoxesTab(), true);
                    else
                        this._lockAtButton(win.getPuzzleOpenBox(), true);

                    win.getBoxesScroll().setScrollerEnable(false);
                } else {
                    if (gameInit.progress.getOpenedBoxes() > 0) {
                        this._hideFinger();
                        this.goToNextStep();

                        const win = guiManager.getWindowByType(WindowType.WinPuzzle);
                        if (win.scroll)
                            win.getBoxesScroll().setScrollerEnable(true);
                    }
                }
                break;
            }
        }
    }

    onCreated(engine) {
        this.engine = engine;
        PrepareAndCreateObject(CommonVisualData.FINGER, null, this.engine, this.depth, (finger) => {
            this.finger = finger;
        });
        this.circle = this.engine.add.sprite(0, 0, "Tut_Circle").setDepth(this.depth - 1);
        this._hideFinger();
    }

    update() {
        const win = guiManager.getActiveWindow();
        if (win.winType != WindowType.QuestBubble && (this.lastWindow != guiManager.getWinTypeAtTheTop() || (win.selectedTab && win.selectedTab !== this.lastTab))) {
            this.preparePhase(this.phase, this.phaseIndex);
        }

        switch (this.phaseData.actionType) {
            case "ClickSlot":
                if (gameInit.progress.isBuildingConstructed(1, 1))
                    this.goToNextPhase();
                break;
            case "ChangeGameModeToUpgrade":
                if (this._isWindow(WindowType.WinUpgrade))
                    this.goToNextStep();
                break;
            case "UpgradeSlot":
                const b = gameInit.getBuildingById(1, 1);
                if (b.getLevel() >= this.phaseData.parameter) {
                    if (this.phaseData.parameter >= 20)
                        hudResources.showTokens();

                    this.goToNextStep();
                }
                break;
            case "ChangeGameModeToNormal":
            case "CloseGirlListWindow": {
                if (this._isWindow(WindowType.WinMain))
                    this.goToNextStep();
                break;
            }
            case "ClickPeristeraBar": {
                const win = guiManager.getWindowByType(WindowType.WinPhotosMainMenu);
                const btn = win.getButtonByTag("Peristera");
                if (btn)
                    this.goToNextStep();
                break;
            }
            case "OpenGirlQuestWindow":
                if (this._isWindow(WindowType.WinPhotosQuest))
                    this.goToNextStep();
                break;
            case "ClickUnlockPhotoButton":
                if (gameInit.progress.haveAnyPhotos()) {
                    const win = guiManager.getWindowByType(WindowType.WinMain);
                    win.showPhotoAlbum();
                    this.goToNextStep();
                }
                break;
            case "ClickUpgradeMarketButton":
            case "BuyAutoClickUpgrade":
                const id = VisualData.getAutoClickSlot1Id();
                if (gameInit.progress.isUpgradePurchased(id)) {
                    const win = guiManager.getWindowByType(WindowType.WinStore);
                    win.scroll.setScrollerEnable(true);
                    unlockGUI();
                    this._hideFinger();
                    this.goToNextStep();
                }
                break;
            case "CollectGold": {
                if (!this.fingerAnimation && gameInit.getBuildingById(1, 1).anyResources && this.phaseData.parameter <= 100) {
                    this.pointAtPosition(this._getFirstSlotPosition(), null, null, true);
                    this.fingerAnimation = this.playSwipeAnimation();
                    // this.fingerAnimation = animManager.swipeInfinite(this.finger.obj, 1);
                    this.circle.setVisible(false);
                }
                break;
            }
        }
    }

    onAdStarted() {
        switch (this.phase) {
            case TutPhases.FortuneWheel:
                this._hideFinger();
                this.goToNextStep();
                break;
        }
    }
}

const GlobalScale = 0.595;
let RealScreenWidth = 1920;
let RealScreenHeight = 1080;

var GameDataSettings = (function() {
    return {
        getGlobalScale() {
            return GlobalScale
        }
    }
})();

if (typeof exports !== 'undefined') {
    if (typeof module !== 'undefined' && module.exports) {
        exports = module.exports = GameDataSettings;
    }
    exports.GameDataSettings = GameDataSettings;
}

const useNewScale = true;
let mapScale = 1;

let gameW, gameH;
let dpi = useNewScale ? (window.devicePixelRatio || 1) : 1;
let localScaleLimit = 1;

if (AllGetParams.game_platform === 'fb_instant') {
    dpi = 1;
    localScaleLimit = 0.5;
}

function UpdateNumbers() {
    if (useNewScale) {
        const sw = window.innerWidth / RealScreenWidth;
        const sh = window.innerHeight / RealScreenHeight;
        localScale = Math.min(sw, sh);
        localScale *= dpi;

        // const minValue = 0.5;
        // if (localScale < minValue) {
        //     dpi *= minValue / localScale;
        //     localScale = minValue;
        // }

        if (localScale > localScaleLimit) {
            dpi *= localScaleLimit / localScale;
            localScale = localScaleLimit;
        }

        if (localScale < 0.6) {
            imagesDeltaScale = 2;
            use2ximages = false;
        } else {
            imagesDeltaScale = 1;
            use2ximages = true;
        }
        imageSizeLocalScale = imagesDeltaScale * localScale;

        if (Math.abs(sw - sh) > 0.0001) {
            if (sh > sw) {
                if (GameDataSettings.getHeightMaxScale) {
                    mapScale = Math.min(GameDataSettings.getHeightMaxScale(), sh / sw);
                    RealScreenHeight *= mapScale;
                }
            } else {
                if (GameDataSettings.getWidthMaxScale) {
                    mapScale = Math.min(GameDataSettings.getWidthMaxScale(), sw / sh);
                    RealScreenWidth *= mapScale;
                }
            }
        }
    } else
        localScale = 1;

    gameW = RealScreenWidth * localScale;
    gameH = RealScreenHeight * localScale;
}

UpdateNumbers();


let CommonData = null;

let globalScale;
if (typeof exports !== 'undefined') {
    let argv = require('minimist')(process.argv.slice(2));
    const orientation = argv["orientation"];
    const SettingsFileName = "GameDataSettings_" + orientation + ".js";
    const pathToGameSettings = "./" + SettingsFileName;
    GameDataSettings = require(pathToGameSettings);
    globalScale = GameDataSettings.getGlobalScale();
} else
    globalScale = GlobalScale;

const totalScale = 1;//temporary - it should be 1 in the release

const NormalTint = 0xffffff;
const LockTint = 0xaaaaaa;

const REMOTE_GAME_PATH = "https://unnyhog.github.io/myth/";

var VisualData = (function () {

    let GAME_NAME = 'MYTH';
    let GAME_PATH = REMOTE_GAME_PATH + 'games/myth';
    let DATA_FOLDER = GAME_PATH + '/data/';
    let DATA_LOCALIZATIONS_RELATIVE = '../localizations/';
    let DATA_AUDIO = GAME_PATH + '/Audio/';
    let IMAGES_FOLDER = GAME_PATH + '/images/';
    let IMAGES_FOLDER_2x = GAME_PATH + '/images2x/';
    let STORE_IMAGES_FOLDER = 'UI/Windows/Upgrade/Items/';
    let PUZZLE_UI_FOLDER = 'UI/Windows/Puzzles/';
    let PUZZLE_IMAGES_FOLDER = 'GoodsPuzzleIcons/';
    let GUARD_PUZZLE_IMAGES_FOLDER = 'GuardsIcons/Puzzles/';

    let QUEST_ICONS_FOLDER = 'UI/Windows/DailyQuests/DailyQuests Icons/';
    let DAILY_ICONS_FOLDER = 'UI/Windows/LoginBonus/BonusTypes/';
    let GIRLS_ICONS_FOLDER = 'UI/Windows/GirlsMenu/girls/';
    let GIRLS_PREVIEW_FOLDER = 'UI/Windows/GirlsMenu/Thumbs/';
    let LOCATIONS_FOLDER = 'UI/Windows/ChangeLocations/';


    if (typeof exports !== 'undefined') {
        CommonData = require('../../../CommonVisualData');
        UnnyObjectType = CommonData.UnnyObjectType;
    } else
        CommonData = CommonVisualData;

    const AllLanguages = [
        'Arabic',
        // 'Chinese (Simplified)',
        // 'Chinese (Traditional)',
        'English',
        'French',
        'German',
        'Italian',
        'Japanese',
        'Korean',
        'Portuguese (Brazil)',
        'Russian',
        'Spanish'
    ];

    const PaymentInfo = {
        hellprodgems100: {
            nutaku_price: 1000
        },
        hellprodgems200: {
            nutaku_price: 1000
        },
        hellprodgems300: {
            nutaku_price: 1000
        },
        hellprodgems400: {
            nutaku_price: 1000
        },
        hellprodgems500: {
            nutaku_price: 1000
        }
    };

    const LocalObjects = {
        //overrides
        'Tab_Close': {
            file: 'UI/Windows/PhotoAlbum/inactive_pad.png',
        },
        'Tab_Open': {
            file: 'UI/Windows/PhotoAlbum/active_pad.png',
        },
        'Notification': {
            file: 'UI/HUD_and_common/HUD/HudNotify.png',
        },
        'PriceIconBig': {
            file: 'UI/HUD_and_common/PriceGold.png',
            duplicate: [
                {
                    name: 'UI/HUD_and_common/PriceGoldSmall.png',
                    scale: 0.16
                }
            ]
        },
        'PriceGemsBig': {
            file: 'UI/HUD_and_common/PriceGems.png',
            duplicate: [
                {
                    name: 'UI/HUD_and_common/PriceGemsSmall.png',
                    scale: 0.16
                }
            ]
        },
        'PriceSeedsBig': {
            file: 'UI/HUD_and_common/PriceSeeds.png',
            duplicate: [
                {
                    name: 'UI/HUD_and_common/PriceSeedsSmall.png',
                    scale: 0.16
                }
            ]
        },
        'PriceIcon': {
            file: 'UI/HUD_and_common/PriceGoldSmall.png',
        },
        'PriceGems': {
            file: 'UI/HUD_and_common/PriceGemsSmall.png',
        },
        'PriceSeeds': {
            file: 'UI/HUD_and_common/PriceSeedsSmall.png',
        },
        'DefaultButton': {
            file: 'UI/Windows/DailyQuests/get_button.png',
            type: UnnyObjectType.NineSlice,
            paddingX: 50,
            paddingY: 22
        },
        'LockPuzzle': {
            file: 'Slots/puzzle_white.png',
        },

        'FastProduction': {
            file: 'Slots/timefast.png',
        },

        'Production_Progress_Bar': {
            file: 'Slots/time_loading.png',
        },
        'CollectionBack': {
            file: 'Backs/BlackPixel.png',
        },
        'CollectCrop': {
            file: 'UI/Windows/Prestige/prestige_icon.png',
        },
        'NotEnoughGems' : {
            file :'UI/Windows/Prestige/prestige_pict.png',
        },

        'collectCropSplash': {
            file: 'UI/Windows/Prestige/prestige_pict.png',
        },
        'MultiplyOnStart': {
            file: 'UI/Windows/Prestige/prestige_pict.png',
        },
        'BanjoEnd': {
            file: 'UI/Windows/Prestige/prestige_pict.png',
        },
        //overrides...

        'PrestigeStar': {
            file: 'UI/Windows/Prestige/star.png',
        },
        'ScrollLine': {
            file: 'UI/Windows/Common/scroll line.png',
        },
        'ScrollLineWhite': {
            file: 'UI/Windows/Common/scroll_line_white.png',
        },
        'ScrollPart': {
            file: 'UI/Windows/Common/scroll.png',
        },

        'PriceDoublingToken': {
            file: 'UI/HUD_and_common/HUD/superDoubling_coin.png',
        },

        'PrestigeLoading': {
            file: 'UI/Windows/Prestige/loading_stripe.png',
        },

        'PrestigeLoadingBack': {
            file: 'UI/Windows/Prestige/loading_back.png',
        },

        'PlayerIcon': {
            file: 'UI/HUD_and_common/HUD/pleer_lvl_avatar.png'
        },

        'PlayerExpLoader': {
            file: 'UI/HUD_and_common/HUD/pleer_lvl_load.png'
        },

        'PlayerExpLoaderBack': {
            file: 'UI/HUD_and_common/HUD/pleer_lvl_loading.png'
        },

        'PlayerExpStar': {
            file: 'UI/HUD_and_common/HUD/pleer_lvl_star.png'
        },

        'StoreButton_Pink': {
            file: 'UI/Windows/Upgrade/button_pink.png',
        },
        'StoreButton_Inactive': {
            file: 'UI/Windows/Upgrade/button_inactive.png',
        },
        'StoreButton_Blue': {
            file: 'UI/Windows/Upgrade/button_blue.png',
        },
        'StoreTab_Active': {
            file: 'UI/Windows/Upgrade/ActiveTabBack.png',
        },
        'StoreTab_Inactive': {
            file: 'UI/Windows/Upgrade/DeactiveTabBack.png',
        },

        'PlaceSlotButton': {
            file: 'Slots/Ground.png',
        },

        'GuardsTabIcon': {
            file: 'UI/Windows/Puzzles/GuardTabIcon.png',
        },
        'TokenCommon': {
            file: 'UI/HUD_and_common/HUD/res_loc_1.png',
        },
        'TokenRare': {
            file: 'UI/HUD_and_common/HUD/res_loc_2.png',
        },
        'TokenEpic': {
            file: 'UI/HUD_and_common/HUD/res_loc_3.png',
        },
        'StripeText': {
            file: 'UI/Windows/PhotoAlbum/stripe_text.png',
        },
        'PhotoLock': {
            file: 'UI/Windows/GirlsMenu/lock.png',
        },
        'WhiteSpace': {
            file: 'UI/Windows/PhotoAlbum/white place.png',
        },
        'InAppIcon': {
            file: 'UI/Windows/Prestige/hard.png',
        },

        'GirlDescription': {
            file: 'UI/Windows/GirlsMenu/person.png',
        },

        'PhotoQuestBar': {
            file: 'UI/Windows/GirlsMenu/bar.png',
        },
        'PhotoQuestBarFull': {
            file: 'UI/Windows/GirlsMenu/bar_full.png',
        },
        // 'PhotoQuestFrame': {
        //     file: 'UI/Windows/GirlsMenu/frame.png',
        // },
        'PhotoQuestUnlockButton': {
            file: 'UI/Windows/GirlsMenu/unlock.png',
        },
        'PhotoQuestDoneIcon': {
            file: 'UI/Windows/GirlsMenu/done_icon.png',
        },

        'BigBlueButton': {
            file: 'UI/Windows/PhotoAlbum/to_main_screen.png',
        },

        'TabAlbum_Misc': {
            file: 'UI/Windows/PhotoAlbum/misc_icon.png',
        },
        'TabAlbum_Girl': {
            file: 'UI/Windows/PhotoAlbum/girl_icon.png',
        },
        'TabAlbum_Genre': {
            file: 'UI/Windows/PhotoAlbum/genre_icon.png',
        },
        'Album_Frame': {
            file: 'UI/Windows/PhotoAlbum/frame.png',
        },

        'GetQuestButton': {
            file: 'UI/Windows/DailyQuests/get_button.png',
        },
        'MM_Btn_Prestige': {
            file: 'UI/HUD_and_common/HUD/HudPrestigeBtn.png',
        },
        'MM_Btn_PhotoAlbum': {
            file: 'UI/HUD_and_common/HUD/HudPhotoAlbumBtn.png',
        },
        'MM_Btn_GirlMenu': {
            file: 'UI/HUD_and_common/HUD/HudGirlsMenuBtn.png',
        },

        'MM_Btn_ManagerDoubling': {
            file: 'UI/HUD_and_common/HUD/manager.png',
        },
        'MM_Btn_Zoom': {
            file: 'UI/HUD_and_common/HUD/zoom.png',
        },

        'Background1': {
            type: UnnyObjectType.Image,
            file: 'Map/background_greece_fullhd.png'
        },

        // 'Fabrika': {
        //     type: UnnyObjectType.Spine,
        //         json: 'fabrika2.json',
        //         atlas: 'fabrika2.atlas',
        //         animations: {
        //         idle: 'Active',
        //             appear: 'Appear'
        //     },
        // },
        'Podkova': {
            type: UnnyObjectType.Spine,
            json: 'podkova.json',
            atlas: 'podkova.atlas',
            animations: {
                idle: 'Idle',
                active: 'Active'
            },
        },
        'SplitScreen': {
            type: UnnyObjectType.Spine,
            json: 'SplitScreen.json',
            atlas: 'SplitScreen.atlas',
            animations: {
                action: '2Sec',
            },
        },
        'FactoryWorking': {
            type: UnnyObjectType.Spine,
            json: 'Conveer_fullhd.json',
            atlas: 'Conveer_fullhd.atlas',
            animations: {
                idle: 'idle',
            },
        },
        'DefaultButton_Slice': {
            file: 'UI/Windows/DailyQuests/get_button.png',
            type: UnnyObjectType.NineSlice,
            paddingX: 50,
            paddingY: 22
        },

        'WinStandardBack': {
            file: 'UI/Windows/Common/paper.png',
            type: UnnyObjectType.NineSlice,
            paddingX: 100,
            paddingY: 70
        },

        'HudResBack': {
            file: 'UI/HUD_and_common/HUD/HudResBack.png',
        },

        'HudTokensBack': {
            file: 'UI/HUD_and_common/HUD/Hud_Photo_Res.png',
        },

        'HudTokensOpen': {
            file: 'UI/HUD_and_common/HUD/hud_res_button.png',
        },

        'BackgroundMusic': {
            type: UnnyObjectType.Audio,
            file: '../Audio/Fishclicker - Music/MUS_Sea_Theme_Loop.ogg',
        },
        'BackgroundMusic2': {
            type: UnnyObjectType.Audio,
            file: '../Audio/Fishclicker - Music/MUS_Space_Theme_Loop.ogg',
        },
        'BackgroundMusic3': {
            type: UnnyObjectType.Audio,
            file: '../Audio/Fishclicker - Music/MUS_Winter_Theme_Loop.ogg',
        },
        'Gathering': {
            type: UnnyObjectType.Audio,
            file: '../Audio/Fishclicker - Music/MUS_Gathering_Loop.ogg',
        },
        'Banjoded': {
            type: UnnyObjectType.Audio,
            file: '../Audio/Fishclicker - Music/MUS_Bread_Theme.ogg',
        },
        'Audio_Chest_1': {
            type: UnnyObjectType.Audio,
            file: '../Audio/Sounds/GetPuzzlePart/chest_1.wav',
        },
        'Audio_Chest_2': {
            type: UnnyObjectType.Audio,
            file: '../Audio/Sounds/GetPuzzlePart/chest_2.wav',
        },
        'Audio_Chest_3': {
            type: UnnyObjectType.Audio,
            file: '../Audio/Sounds/GetPuzzlePart/chest_3.wav',
        },
        'Audio_longtap1': {
            type: UnnyObjectType.Audio,
            file: '../Audio/Sounds/ObjectsClick/longtap1.wav',
        },
        'Audio_longtap2': {
            type: UnnyObjectType.Audio,
            file: '../Audio/Sounds/ObjectsClick/longtap2.wav',
        },
        'Audio_longtap3': {
            type: UnnyObjectType.Audio,
            file: '../Audio/Sounds/ObjectsClick/longtap3.wav',
        },
        'Audio_longtap4': {
            type: UnnyObjectType.Audio,
            file: '../Audio/Sounds/ObjectsClick/longtap4.wav',
        },
        'Audio_Pop-ani-1': {
            type: UnnyObjectType.Audio,
            file: '../Audio/Fishclicker - Sounds/SND_Tap_1.ogg',
        },
        'Audio_Pop-ani-2': {
            type: UnnyObjectType.Audio,
            file: '../Audio/Fishclicker - Sounds/SND_Tap_2.ogg',
        },
        'Audio_Pop-ani-3': {
            type: UnnyObjectType.Audio,
            file: '../Audio/Fishclicker - Sounds/SND_Tap_3.ogg',
        },
        'Audio_ClickUI': {
            type: UnnyObjectType.Audio,
            file: '../Audio/Fishclicker - Sounds/SND_Click.ogg',
        },
        'Audio_Info': {
            type: UnnyObjectType.Audio,
            file: '../Audio/Fishclicker - Sounds/SND_Tap_Dif_Level_Up.ogg',
        },
        // 'Audio_LevelUp': {
        //     type: UnnyObjectType.Audio,
        //     file: '../Audio/Sounds/UI/LevelUp.wav',
        // },
        'Audio_Money': {
            type: UnnyObjectType.Audio,
            file: '../Audio/Fishclicker - Sounds/SND_Fly_Fish_2.ogg',
        },
        'Audio_Window': {
            type: UnnyObjectType.Audio,
            file: '../Audio/Fishclicker - Sounds/SND_Window_Show.ogg',
        },
        // 'Audio_WindowHide': {
        //     type: UnnyObjectType.Audio,
        //     file: '../Audio/Fishclicker - Sounds/SND_Window_Hide.ogg',
        // },

        //Without preload
        'Managers_UnderText_1': {
            file: 'UI/Windows/Manager-Donate_doubling/undertext_1.png',
        },
        'Managers_UnderText_2': {
            file: 'UI/Windows/Manager-Donate_doubling/undertext_2.png',
        },
        'ButtonGreen': {
            file: 'UI/Windows/Manager-Donate_doubling/green_button.png'
        },
        'ButtonBlue': {
            file: 'UI/Windows/Manager-Donate_doubling/blue_button.png'
        },

        'ButtonPink': {
            file: 'UI/Windows/Manager-Donate_doubling/pink_button.png'
        },

        'TableUpgradeGR': {
            file: 'Slots/tableUpgrade_gr.png',
        },

        'PrestigeBtnPink': {
            file: 'UI/Windows/Prestige/pink_button.png'
        },
        'PrestigeBtnGrey': {
            file: 'UI/Windows/Prestige/grey_button.png'
        },
        'PrestigeBlueHead': {
            file: 'UI/Windows/Common/blue_head.png'
        },

        'ChestGuard' : {
            file :'UI/Windows/GetPuzzlePart/ChestGuard.png',
        },
        'ChestGuardOpen' : {
            file :'UI/Windows/GetPuzzlePart/ChestGuardOpen.png',
        },
        'ChestGuardSuper' : {
            file :'UI/Windows/GetPuzzlePart/ChestGuardSuper.png',
        },
        'ChestGuardSuperOpen' : {
            file :'UI/Windows/GetPuzzlePart/ChestGuardSuperOpen.png',
        },

        'LocationsBtnGreen' : {
            file :'UI/Windows/ChangeLocations/green back.png',
        },

        'LocationsBtnGrey' : {
            file :'UI/Windows/ChangeLocations/grey back.png',
        },

        'PHOTO_PLACEHOLDER' : {
            file :'UI/Windows/PhotoAlbum/picture.png',
        },
    };

    const PreloadObjects = [
        'SplitScreen',
        'GuardsTabIcon',
        // 'WinStandardBack2',
        'DefaultButton_Slice',

        'HudResBack',
        'HudTokensBack',
        'HudTokensOpen',
        'MM_Btn_GirlMenu',
        'MM_Btn_ManagerDoubling',
        'MM_Btn_Zoom',
        'MM_Btn_PhotoAlbum',
        'MM_Btn_Prestige',
        'GetQuestButton',
        'TabAlbum_Misc',
        'TabAlbum_Girl',
        'TabAlbum_Genre',
        'Album_Frame',
        'StripeText',
        'PhotoLock',
        'WhiteSpace',
        'GirlDescription',
        'PhotoQuestBar',
        'PhotoQuestBarFull',
        // 'PhotoQuestFrame',
        'PhotoQuestUnlockButton',
        'PhotoQuestDoneIcon',
        'BigBlueButton',
        'TokenCommon',
        'TokenRare',
        'TokenEpic',
        'InAppIcon',
        'Managers_UnderText_1',
        'Managers_UnderText_2',
        'ButtonGreen',
        'ButtonBlue',
        'ButtonPink',
        'PlaceSlotButton',
        'TableUpgradeGR',
        'StoreButton_Pink',
        'StoreButton_Inactive',
        'StoreButton_Blue',
        'StoreTab_Active',
        'StoreTab_Inactive',
        'PrestigeBtnPink',
        'PrestigeBtnGrey',
        'PrestigeBlueHead',
        'PlayerIcon',
        'PlayerExpLoader',
        'PlayerExpLoaderBack',
        'PlayerExpStar',
        'Daily_Check',
        'ChestGuard',
        'ChestGuardOpen',
        'ChestGuardSuper',
        'ChestGuardSuperOpen',
        'PriceDoublingToken',
        'LocationsBtnGreen',
        'LocationsBtnGrey',
        'ScrollLine',
        'ScrollLineWhite',
        'ScrollPart',
        'CollectCrop',
        'PrestigeStar'
    ];

    const GameSettings = {
        drop_image_scale: 0.8,
        popup_image_scale: 0.6,
        popup_images_from_drop: true,
        dont_double: true,
        display_hard_icon: true,
        save_version: 10,
        banjo_duration: 16,
        fb_app_id: 2077329288999958,//hz
        vk_app_id: 6955719,//fish
        player_level: true,
        photos: true,
        locations_window: true,
        no_guard: true,
        guards: true,
        no_offers: true,
        no_availability_jump: true,
        // btn_text_height: 1.2,
        slot_purchase_as_buttons: {
            'locked': 'Lock',
            'puzzle': 'LockIcon',
            'available': 'PlaceSlotButton',
            'icon_pos': {
                x: -84 * globalScale,
                y: 0,
            },
            'price_pos': {
                x: -33 * globalScale,
                y: 0,
            },
            'icon_pos_puzzle': {
                x: 110 * globalScale,
                y: 15 * globalScale,
            },
            'price_pos_puzzle': {
                x: -6 * globalScale,
                y: 15 * globalScale,
            }
        },
        circular_progress: true,
        dont_show_production_icon: true,
        productionText: {
            x: 40,
            y: 0,
            ox: 0,
            oy: 0.5
        },
        dont_show_shield_icon: true,
        shields: {
            drop_icon: true,
            icon: false,
            upgrade_x: 80,
            upgrade_y: -60,
            level_x: 0,
            level_y: 30,
            level_suffix: 'LVL ',
            shield_locked: 'TableUpgradeGR',
            rewards: true,
            reward_x: -90,
            reward_y: 95
        },
        tut_phrase_y: 240,
        puzzle_top: true,
        no_buttons_tint: true,
        nameForLocalization: true,
        show_best: false
    };

    return {
        getGameName() {
            return GAME_NAME;
        },

        getUncompressedFiles() {
            return [
                'background_greece_fullhd.png'
            ]
        },

        getGameSettings() {
            return GameSettings;
        },

        getAllLanguages() {
            return AllLanguages;
        },

        IsVertical() {
            return false;
        },

        getWorldsCount() {
            return 3;
        },

        getPaymentInfoById(id) {
            return PaymentInfo.hasOwnProperty(id) ? PaymentInfo[id] : null;
        },

        getChestIconPath() {
            return VisualData.getPuzzleUIFolder() + "GoldBox.png";
        },

        ANIMATIONS: {
            flyingResources: 1.5,
            flyingResourcesScale: 1,
        },

        GUI_Common: {
            notification_scale: 0.7,
            playBreadAnimation: false
        },

        GUI_WinHarvested: {
            font: true,
            imageY: -500 * globalScale,
            headerY: 0,
            descY: 200 * globalScale
        },

        GUI_WinSettings: {
            languages_columns: 5
        },

        GUI_WinStore: {
            headerImg: "Managers_UnderText_1",
            headerOffsetY: -230,
            header_wrap: 360,
            btnOffsetY: 330,
            descOffsetY: 220,
            nineSlice: "store",
            togglesX: -700,
            togglesY: -560,
            togglesDistance: 160,
            activeOffset: 10,
            iconOffset: 70,
            iconOffsetActive: 70,
            iconScaleActive: 1.1,
            imageOffset: 20,
            showHud: true,
            store_back_scale: 1.5,
            headerFont: true,
            // btnMinWidth: 280,
            btnScale: 1.26,
            btnSpriteNormal: "StoreButton_Pink",
            btnSpriteInactive: "StoreButton_Inactive",
            btnSpriteGems: "StoreButton_Blue",
            tabClose: "StoreTab_Inactive",
            tabOpen: "StoreTab_Active",
            tabCloseOffsetX: 20,
            price_icon_right: true,
        },

        GUI_WinBossSummon: {
            nineSlice: "prestige",
            imageY: -100,
            no_description: true,
            mystButtons: true,
            headerFont: true,
            btnImage: 'PrestigeBtnPink',
            btnImage2: 'PrestigeBtnGrey',
            header_image: 'PrestigeBlueHead',
            buttonY2: 550 * globalScale,
            buttonY: 400 * globalScale,
            headerOffset: -450
        },

        GUI_WinConstruct: {
            nineSlice: "small",
            headerOffset: -530,
            buttonOffset: 500,
        },

        GUI_WinWithPicture: {
            nineSlice: "long",
            imageX: 0,
            imageY: 0,
            headerOffset: -370,
            buttonOffset: 300,
            buttonOffsetX: 0,
            descriptionX: 350,
            descriptionY: 0,
        },

        GUI_WinAppleDescription: {
            nineSlice: "apples_desc",
            centerX: 350,
            distanceX: 430,
            startY: -150,
            distanceY: 75,
            imageX: -500,
            imageY: -200,
            headerOffset: -470,
            hardcoded_myth: true,
            header_image: 'PrestigeBlueHead',
            headerFont: true,
        },

        GUI_WinPuzzle: {
            nineSlice: "puzzle",
            storeDistanceX: 270,
            storeDistanceY: 370,
            togglesX: 700,
            togglesY: -480,
            togglesDistance: 300,
            activeOffset: 10,
            // iconOffset: 90,
            // iconOffsetActive: 160,
            imageOffset: 80,
            centerBlock: false,
            showGrid: false,
            partSize: 286,
            frontPartSize: 286,
            BonusOffsetX: 160,
            showHud: true,
            popup_x: 140,
            popup_y: -130,
            puzzleNumberFont: true,
            no_frame: true
        },

        GUI_BuildingsGUI: {
            loaderOffsetX: 0,
            loaderOffsetY: -8,
            loaderScale: 1,
            purchaseIconScale: 1,
        },

        GUI_WinDailyBonus: {
            columns: 8,
            rows: 4,
            distance: 300,
            addDistance: 50,
            dailyClosedDepth: 11,
            // btnsScale: 1.2,
            check_y: -90,
            text_x: 80,
            text_y: 35,
            font: true,
        },

        GUI_WinPhotosMainMenu: {
            nineSlice: "none",
        },

        GUI_WinLocationSelection: {
            nineSlice: "none",
        },

        GUI_WinPhotosQuest: {
            nineSlice: "photo_quest",
        },

        GUI_WinGirlBio: {
            nineSlice: "photo_quest",
        },

        GUI_WinPhotosList: {
            nineSlice: "photo_list",
            activeOffset: 10
        },

        GUI_WinPhotosListSingleImages: {
            nineSlice: "photo_list",
            activeOffset: 10
        },

        GUI_WinManagerDoubling: {
            nineSlice: "manager_doubling",
        },

        GUI_WinFortuneWheel: {
            backX: 0,
            backY: -50,
            rotationX: 0,
            rotationY: 70,
            buttonY: 800,
            heroX: 500,
            heroY: 300,
            arrowX: 0,
            arrowY: -500,
            headerY: 100,
            initRotation: 180,
            radius: 250,

            backSize: {
                width: 1327,
                height: 1177
            },
            lights: [
                {
                    x: 180,
                    y: 1000,
                },
                {
                    x: 160,
                    y: 830,
                },
                {
                    x: 125,
                    y: 640,
                },
                {
                    x: 150,
                    y: 520,
                },
                {
                    x: 130,
                    y: 300,
                },
                {
                    x: 200,
                    y: 130,
                },
                {
                    x: 375,
                    y: 125,
                },
                {
                    x: 525,
                    y: 150,
                },

                {
                    x: 860,
                    y: 150,
                },
                {
                    x: 1010,
                    y: 125,
                },
                {
                    x: 1125,
                    y: 125,
                },
                {
                    x: 1200,
                    y: 260,
                },
                {
                    x: 1210,
                    y: 430,
                },
                {
                    x: 1175,
                    y: 525,
                },
                {
                    x: 1180,
                    y: 715,
                },
                {
                    x: 1200,
                    y: 845,
                },
                {
                    x: 1170,
                    y: 1010,
                }
            ]
        },

        GUI_WinQuests: {
            distance: 500,
            centerY: 50,
            iconsScale: 0.75,
            noMoreQuestsIcon: 'FortuneDevil',
            buttonName: 'GetQuestButton',
            claim_x: 360,
            claim_y: 60,
            refresh_x: -410,
            refresh_y: 50,
            loader_x: 0,
            loader_y: -50,
            join_desc_and_progress: true,
            no_icon: true,
            reward_one_line: true,
            desc_x: -330,
            desc_y: 20,
            desc_ox: 0,
            desc_width: 560,
            x_x: -330,
            x_y: 80,
        },

        GUI_HUDResources: {
            labelOffsetY: -2,
            greenButtonOffsetX1: 390,

            singleImage: 'HudResBack',
            hudBackScale: 1.7
        },

        getFolderPath: function () {
            return use2ximages ? IMAGES_FOLDER_2x : IMAGES_FOLDER;
        },

        getAtlasPath: function () {
            return null;
        },

        getAtlasFullPath: function () {
            return null;
        },

        getQuestIcons: function () {
            return QUEST_ICONS_FOLDER;
        },

        getGirlsImagesFolder: function () {
            return GIRLS_ICONS_FOLDER;
        },

        getGirlsPreviewFolder: function () {
            return GIRLS_PREVIEW_FOLDER;
        },

        getLocationsFolder: function () {
            return LOCATIONS_FOLDER;
        },

        getDataFolder() {
            return DATA_FOLDER;
        },

        getDailyBonusIconsFolder() {
            return DAILY_ICONS_FOLDER;
        },

        getLocalizationsFolder() {
            return DATA_LOCALIZATIONS_RELATIVE;
        },

        getAudioFolder() {
            return DATA_AUDIO;
        },

        getStoreFolder() {
            return STORE_IMAGES_FOLDER;
        },

        getPuzzleFolder() {
            return PUZZLE_IMAGES_FOLDER;
        },

        getManagerPuzzleFolder() {
            return GUARD_PUZZLE_IMAGES_FOLDER;
        },

        getPuzzleUIFolder() {
            return PUZZLE_UI_FOLDER;
        },

        getGullPath: function (path) {
            return path ? IMAGES_FOLDER + path : IMAGES_FOLDER;
        },

        getAutoClickSlot1Id() {
            return 23;
        },

        getMusicVolumeForWorld(worldId) {
            return worldId === "1" ? 0.4 : 1;
        },

        getMusicForWorld(worldId) {
            return worldId === "1" ? "BackgroundMusic" : "BackgroundMusic" + worldId;
        },

        WINDOW_NINE_SLICE: {
            store: {
                name: 'WinStandardBack',
                width: 1800,
                height: 1400,
                y: 130
            },
            small: {
                name: 'WinStandardBack',
                width: 1200,
                height: 1400,
                y: 0
            },
            prestige: {
                name: 'WinStandardBack',
                width: 1100,
                height: 1400,
                y: 0
            },
            long: {
                name: 'WinStandardBack',
                width: 1800,
                height: 1000,
                y: 0
            },
            apples_desc: {
                name: 'WinStandardBack',
                width: 1100,
                height: 1400,
                y: 0
            },
            puzzle: {
                name: 'WinStandardBack',
                width: 1800,
                height: 1000,
            },
            photo_menu: {
                name: 'WinStandardBack',
                width: 1200,
                height: 1500,
                y: 100
            },
            photo_list: {
                name: 'WinStandardBack',
                width: 1600,
                height: 1500,
                y: 100
            },
            photo_quest: {
                name: 'WinStandardBack',
                width: 1100,
                height: 1500,
                y: 100
            },
            manager_doubling: {
                name: 'WinStandardBack',
                width: 1060,
                height: 1000,
                y: -200
            }
        },

        STORE_SCROLL_CONFIG: {
            maxSlots: 9,
            columns: 3,
            cellWidth: 500,
            cellHeight: 850,
            offsetX: 0,
            offsetY: 130,
            width: 1600,
            height: 1280,
        },

        PUZZLE_SCROLL_CONFIG: {
            columns: 4,
            cellWidth: 350,
            cellHeight: 350,
            offsetX: 0,
            offsetY: 0,
            width: 1600,
            height: 900,
        },

        PUZZLE_SCROLL_CONFIG_MANAGERS: {
            columns: 1,
            cellWidth: 1000,
            cellHeight: 350,
            offsetX: 0,
            offsetY: 0,
            width: 1200,
            height: 900,
            // track: "ScrollLine",
            // thumb: "ScrollPart",
        },

        PHOTOS_MENU_SCROLL_CONFIG: {
            columns: 1,
            cellWidth: 1300,
            cellHeight: 400,
            offsetX: 0,
            offsetY: 100,
            width: 1300,
            height: 1380,
            track: "ScrollLineWhite",
            thumb: "ScrollPart",
        },

        LOCATIONS_MENU_SCROLL_CONFIG: {
            columns: 1,
            cellWidth: 1300,
            cellHeight: 400,
            offsetX: 0,
            offsetY: 100,
            width: 1300,
            height: 1380,
            track: "ScrollLineWhite",
            thumb: "ScrollPart",
        },

        PHOTOS_LIST_SCROLL_CONFIG: {
            columns: 3,
            cellWidth: 450,
            cellHeight: 450,
            offsetX: 0,
            offsetY: 100,
            width: 1400,
            height: 1380,
        },

        PHOTOS_LIST_SINGLE_SCROLL_CONFIG: {
            columns: 3,
            cellWidth: 450,
            cellHeight: 450,
            offsetX: 0,
            offsetY: 200,
            width: 1400,
            height: 1280,
        },

        PUZZLE_SCROLL_CONFIG_STORE: {
            columns: 3,
            cellWidth: 500,
            cellHeight: 850,
            offsetX: 0,
            offsetY: 0,
            width: 1600,
            height: 900,
        },

        BUNDLE_FOLDERS: [//Bundle the folders
            'GoodsBuyWindowIcons',
            'GoodsSmallIcons',
            'GoodsDrops',
            'GoodsPuzzleIcons',
            'Tutorial',
            'UI/Windows/GetPuzzlePart',
            STORE_IMAGES_FOLDER,
            QUEST_ICONS_FOLDER,
            DAILY_ICONS_FOLDER,
            GUARD_PUZZLE_IMAGES_FOLDER,
            GIRLS_ICONS_FOLDER,
            GIRLS_PREVIEW_FOLDER,
            LOCATIONS_FOLDER,
            PUZZLE_UI_FOLDER
            // '../Audio/'
        ],

        PRELOAD_OBJECTS: CommonData.PRELOAD_OBJECTS.concat(PreloadObjects),

        MAP_PARAMS: {
            width: 1536,
            height: 2448,
        },

        BACKGROUNDS: {
            1: {
                objects: [
                    {
                        name: 'Background1'
                    }
                ]
            },
            2: {
                objects: [
                    {
                        name: 'Background1',
                    }
                ]
            },
            3: {
                objects: [
                    {
                        name: 'Background1',
                    }
                ]
            }
        },

        SPLIT_SCREEN: {
            objects: [
                {
                    name: 'SplitScreen'
                }
            ]
        },

        // FACTORY_WORKING: {
        //     objects: [
        //         {
        //             name: 'FactoryWorking'
        //         }
        //     ]
        // },

        // FABRIKA: {
        //     objects: [
        //         {
        //             click: true,
        //             name: 'Fabrika',
        //             scale: 0.2 * totalScale,
        //             x: 750,
        //             y: -320,
        //         }
        //     ]
        // },

        PODKOVA: {
            objects: [
                {
                    click: true,
                    name: 'Podkova',
                    scale: 0.2 * totalScale,
                    x: -800,
                    y: -50,
                }
            ]
        },

        ALL_OBJECTS: Object.assign({}, CommonData.ALL_OBJECTS, LocalObjects),

        VISUAL_BUILDINGS: {
            start1w1: {
                objects: [
                    {
                        x: 12,
                        y: -56,
                    },
                ]
            },
            start2w1: {
                objects: [
                    {
                        x: 26,
                        y: -4,
                    },
                ]
            },
            start3w1: {
                objects: [
                    {
                        x: 28,
                        y: -60,
                    },
                ]
            },
            start4w1: {
                objects: [
                    {
                        x: 10,
                        y: -26,
                    },
                ]
            },
            start5w1: {
                objects: [
                    {
                        x: 80,
                        y: -30,
                    },
                ]
            },
            start6w1: {
                objects: [
                    {
                        x: 70,
                        y: -36,
                    },
                ]
            },
            start7w1: {
                objects: [
                    {
                        x: 26,
                        y: -106,
                    },
                ]
            },
            start8w1: {
                objects: [
                    {
                        x: 40,
                        y: -80,
                    },
                ]
            },
            start9w1: {
                objects: [
                    {
                        x: 14,
                        y: -80,
                    },
                ]
            },

            start1w2: {
                objects: [
                    {
                        x: -46,
                        y: -70,
                    },
                ]
            },
            start2w2: {
                objects: [
                    {
                        x: 26,
                        y: -80,
                    },
                ]
            },
            start3w2: {
                objects: [
                    {
                        x: -40,
                        y: -100,
                    },
                ]
            },
            start4w2: {
                objects: [
                    {
                        x: -10,
                        y: -74,
                    },
                ]
            },
            start5w2: {
                objects: [
                    {
                        x: -10,
                        y: -46,
                    },
                ]
            },
            start6w2: {
                objects: [
                    {
                        x: -12,
                        y: -72,
                    },
                ]
            },
            start7w2: {
                objects: [
                    {
                        x: -30,
                        y: -80,
                    },
                ]
            },
            start8w2: {
                objects: [
                    {
                        x: -84,
                        y: -100,
                    },
                ]
            },
            start9w2: {
                objects: [
                    {
                        x: -190,
                        y: -106,
                    },
                ]
            },

            start1w3: {
                objects: [
                    {
                        x: 90,
                        y: -60,
                    },
                ]
            },
            start2w3: {
                objects: [
                    {
                        x: -160,
                        y: -40,
                    },
                ]
            },
            start3w3: {
                objects: [
                    {
                        x: -20,
                        y: -26,
                    },
                ]
            },
            start4w3: {
                objects: [
                    {
                        x: 36,
                        y: -40,
                    },
                ]
            },
            start5w3: {
                objects: [
                    {
                        x: -60,
                        y: 0,
                    },
                ]
            },
            start6w3: {
                objects: [
                    {
                        x: -10,
                        y: -60,
                    },
                ]
            },
            start7w3: {
                objects: [
                    {
                        x: -120,
                        y: -20,
                    },
                ]
            },
            start8w3: {
                objects: [
                    {
                        x: -90,
                        y: -20,
                    },
                ]
            },
            start9w3: {
                objects: [
                    {
                        x: -160,
                        y: -46,
                    },
                ]
            },

            building1w1: {
                objects: [
                    {
                        scale: 0.1 * totalScale,
                    }
                ]
            },
            building2w1: {
                objects: [
                    {
                        scale: 0.06 * totalScale,
                        scaleSize: {x: 1, y: 0.5}
                    }
                ]
            },
            building3w1: {
                objects: [
                    {
                        scale: 0.09 * totalScale,
                    }
                ]
            },
            building4w1: {
                objects: [
                    {
                        scale: 0.08 * totalScale,
                    }
                ]
            },
            building5w1: {
                objects: [
                    {
                        scale: 0.12 * totalScale,
                    }
                ]
            },
            building6w1: {
                objects: [
                    {
                        scale: 0.1 * totalScale,
                    }
                ]
            },
            building7w1: {
                objects: [
                    {
                        scale: 0.11 * totalScale,
                    }
                ]
            },
            building8w1: {
                objects: [
                    {
                        scale: 0.095 * totalScale,
                    }
                ]
            },
            building9w1: {
                objects: [
                    {
                        scale: 0.09 * totalScale,
                    }
                ]
            },

            building1w2: {
                objects: [
                    {
                        scale: 0.31 * totalScale,
                        x: -40,
                        y: -24,
                    }
                ]
            },
            building2w2: {
                objects: [
                    {
                        scale: 0.17 * totalScale,
                        x: 40,
                        y: -22,
                    }
                ]
            },
            building3w2: {
                objects: [
                    {
                        scale: 0.32 * totalScale,
                        x: -44,
                        y: -40,
                    }
                ]
            },
            building4w2: {
                objects: [
                    {
                        scale: 0.14 * totalScale,
                        x: -20,
                        y: -50,
                    }
                ]
            },
            building5w2: {
                objects: [
                    {
                        scale: 0.16 * totalScale,
                        x: -10,
                        y: -50,
                    }
                ]
            },
            building6w2: {
                objects: [
                    {
                        scale: 0.18 * totalScale,
                        x: -36,
                        y: -70,
                    }
                ]
            },
            building7w2: {
                objects: [
                    {
                        scale: 0.21 * totalScale,
                        x: -30,
                        y: 10,
                    }
                ]
            },
            building8w2: {
                objects: [
                    {
                        scale: 0.17 * totalScale,
                        x: -100,
                        y: 10,
                    }
                ]
            },
            building9w2: {
                objects: [
                    {
                        scale: 0.23 * totalScale,
                        x: -140,
                        y: -110,
                    }
                ]
            },

            building1w3: {
                objects: [
                    {
                        scale: 0.1 * totalScale,
                        x: 104,
                        y: -10,
                    }
                ]
            },
            building2w3: {
                objects: [
                    {
                        scale: 0.12 * totalScale,
                        x: -144,
                        y: -4,
                    }
                ]
            },
            building3w3: {
                objects: [
                    {
                        scale: 0.1 * totalScale,
                        x: 14,
                        y: 0,
                    }
                ]
            },
            building4w3: {
                objects: [
                    {
                        scale: 0.13 * totalScale,
                        x: 20,
                        y: -10,
                    }
                ]
            },
            building5w3: {
                objects: [
                    {
                        scale: 0.09 * totalScale,
                        x: -40,
                        y: -20,
                    }
                ]
            },
            building6w3: {
                objects: [
                    {
                        scale: 0.16 * totalScale,
                        x: -10,
                        y: 10,
                    }
                ]
            },
            building7w3: {
                objects: [
                    {
                        scale: 0.11 * totalScale,
                        x: -6,
                        y: 20,
                    }
                ]
            },
            building8w3: {
                objects: [
                    {
                        scale: 0.1 * totalScale,
                        x: -86,
                        y: -20,
                    }
                ]
            },
            building9w3: {
                objects: [
                    {
                        scale: 0.13 * totalScale,
                        x: -164,
                        y: -4,
                    }
                ]
            }
        },

        PLACED_BUILDINGS: {
            1: {//pool
                position: {
                    x: -41 * totalScale,
                    y: 317 * totalScale,
                    lx: 110,
                    ly: 30
                }
            },
            2: {
                position: {
                    x: -23 * totalScale,
                    y: -119 * totalScale,
                    lx: 60,
                    ly: 50
                }
            },
            3: {//u'bka
                position: {
                    x: 118 * totalScale,
                    y: 191 * totalScale,
                    lx: 70,
                    ly: -190
                }
            },
            4: {//cat
                position: {
                    x: -56 * totalScale,
                    y: -225 * totalScale,
                    lx: 70,
                    ly: -160
                }
            },
            5: {//pike
                position: {
                    x: -253 * totalScale,
                    y: 156 * totalScale,
                    lx: 130,
                    ly: -20
                }
            },
            6: {//2 guys top right
                position: {
                    x: 127 * totalScale,
                    y: -111 * totalScale,
                    lx: 90,
                    ly: -150
                }
            },
            7: {//drums
                position: {
                    x: -53 * totalScale,
                    y: 128 * totalScale,
                    lx: 70,
                    ly: -190
                }
            },
            8: {//reading
                position: {
                    x: 222 * totalScale,
                    y: 304 * totalScale,
                    lx: 140,
                    ly: -170
                }
            },
            9: {//visit
                position: {
                    x: -207 * totalScale,
                    y: -102 * totalScale,
                    lx: -90,
                    ly: -250
                }
            },

            10: {
                position: {
                    x: 650 * totalScale,
                    y: 456 * totalScale
                }
            },
            11: {
                position: {
                    x: -480 * totalScale,
                    y: 456 * totalScale
                }
            },
            12: {
                position: {
                    x: 0 * totalScale,
                    y: 456 * totalScale
                }
            },
            13: {
                position: {
                    x: 356 * totalScale,
                    y: 288 * totalScale
                }
            },
            14: {
                position: {
                    x: -50 * totalScale,
                    y: 134 * totalScale
                }
            },
            15: {
                position: {
                    x: -420 * totalScale,
                    y: 140 * totalScale
                }
            },
            16: {
                position: {
                    x: 80 * totalScale,
                    y: -172 * totalScale
                }
            },
            17: {
                position: {
                    x: -250 * totalScale,
                    y: -150 * totalScale
                }
            },
            18: {
                position: {
                    x: 626 * totalScale,
                    y: 0 * totalScale
                }
            },

            19: {
                position: {
                    x: 580 * totalScale,
                    y: 446 * totalScale
                }
            },
            20: {
                position: {
                    x: -370 * totalScale,
                    y: 446 * totalScale
                }
            },
            21: {
                position: {
                    x: -20 * totalScale,
                    y: 426 * totalScale
                }
            },
            22: {
                position: {
                    x: 340 * totalScale,
                    y: 290 * totalScale
                }
            },
            23: {
                position: {
                    x: 130 * totalScale,
                    y: -180 * totalScale
                }
            },
            24: {
                position: {
                    x: -50 * totalScale,
                    y: 170 * totalScale
                }
            },
            25: {
                position: {
                    x: -420 * totalScale,
                    y: 90 * totalScale
                }
            },
            26: {
                position: {
                    x: -330 * totalScale,
                    y: -180 * totalScale
                }
            },
            27: {
                position: {
                    x: 620 * totalScale,
                    y: -50 * totalScale
                }
            }
        }
    }
})();


for (let w = 1; w <= 3; w++) {
    const add = 'w' + w;
    for (let i = 1; i <= 9; i++) {

        const ww = i + 'w' + w;

        VisualData.ALL_OBJECTS['Building_' + ww] = {
            type: UnnyObjectType.Spine,
            json: 'Slot' + ww + '.json',
            atlas: 'Slot' + ww + '.atlas',
            animations: {
                idle: 'Idle',
                appear: 'Appear',
                action: 'Touch',
            }
        };

        const bName = 'building' + i + add;
        const building2 = VisualData.VISUAL_BUILDINGS[bName].objects;
        const b = building2[0];
        b.name = 'Building_' + i + add;
        b.click = true;

        const sName = 'start' + i + add;
        const obj = VisualData.VISUAL_BUILDINGS[sName].objects;
        const s = obj[0];
        s.x *= totalScale;
        s.y *= totalScale;
        s.click = true;
        obj[0].scale = totalScale;

        const slot = VisualData.PLACED_BUILDINGS[(w - 1) * 9 + i];
        slot.depth = 3000 - (i - 1) * 100;
        slot.levels = [
            {
                maxLevel: 0,
                building: sName,
            },
            {
                building: bName,
            },
        ];
    }
}

const DefaultFontColor = "#fff";
const DefaultStrokeColor = "#570105";

let DefaultFontPurchaseSlot, DefaultFontStoreItemHeader;
let DefaultFontProduction;
let ShieldFontPrice, ShieldFontLevel, DefaultFontDailyBonus, PuzzleNumberFont, ShieldRewardFont;
let GirlsMenuHeaderFont, GirlsMenuDescFont, PhotoQuestDescFont, PhotoQuestPrice, PhotosCountInListFont,
    BossSummonHeaderFont, QuestFont;
let TutorialFont, PlayerLevelFont;
let DefaultFontSmallBtns;
let PrestigeFontHeader, PrestigeFontDescription, FontManagerWindow;

function CalculateFonts() {
    TextScale = 0.7;
    TextScale2 = 0.6;
    DefaultFontVeryBig = createFont({
        font: getFont(100),
        font2: getFont2(100),
        fill: DefaultFontColor,
        align: 'center',
        stroke: DefaultStrokeColor,
        strokeThickness: getStroke(15)
    });
    DefaultFontBig = createFont({//headers
        font: getFont(70),
        font2: getFont2(70),
        fill: DefaultStrokeColor,
        align: 'center',
    });
    DefaultFontWheel = createFont({
        font: getFont(120),
        font2: getFont2(120),
        fill: DefaultFontColor,
        align: 'center',
        stroke: DefaultStrokeColor,
        strokeThickness: getStroke(16),
        lineSpacing: getLineSpacing(-30)
    });
    DefaultFont = createFont({//all btns
        font: getFont(40),
        font2: getFont2(40),
        fill: DefaultFontColor,
        align: 'center',
        // stroke: DefaultStrokeColor,
        // strokeThickness: getStroke(7)
    });

    DefaultFontSmallBtns = createFont({
        font: getFont(35),
        font2: getFont2(35),
        fill: DefaultFontColor,
        align: 'center',
    });
    DefaultFontSmall = createFont({//hud
        font: getFont(45),
        font2: getFont2(45),
        fill: DefaultStrokeColor,
        align: 'center',
        // stroke: DefaultFontColor,
        // strokeThickness: getStroke(7)
    });
    DefaultFontSmallPuzzleBonus = createFont({
        font: getFont(45),
        font2: getFont2(45),
        fill: DefaultFontColor,
        align: 'center',
        stroke: DefaultStrokeColor,
        strokeThickness: getStroke(7)
    });
    DefaultFontSmall2 = createFont({
        font: getFont(40),
        font2: getFont2(40),
        fill: DefaultFontColor,
        align: 'center',
        stroke: DefaultStrokeColor,
        strokeThickness: getStroke(5)
    });
    DefaultFontBlack = createFont({font: getFont(45), font2: getFont2(45), fill: DefaultStrokeColor, align: 'center'});
    DefaultFontSmallBlack = createFont({
        font: getFont(35),
        font2: getFont2(35),
        fill: DefaultStrokeColor,
        align: 'center'
    });//quests
    DefaultFontVerySmall = createFont({
        font: getFont(30),
        font2: getFont2(30),
        fill: DefaultStrokeColor,
        align: 'center',
        lineSpacing: getLineSpacing(-5)
    });//store desc
    DefaultFontVerySmall2 = createFont({
        font: getFont(40),
        font2: getFont2(40),
        fill: DefaultFontColor,
        align: 'center',
    });//store btn
    //new
    DefaultFontStoreItemHeader = createFont({
        font: getFont(40),
        font2: getFont2(40),
        fill: DefaultFontColor,
        align: 'center',
        lineSpacing: getLineSpacing(-5)
    });//store header
    DefaultFontPurchaseSlot = createFont({
        font: getFont(30),
        font2: getFont2(30),
        fill: DefaultFontColor,
        align: 'center',
    });

    DefaultFontProduction = createFont({
        font: getFont(55),
        font2: getFont2(55),
        fill: DefaultFontColor,
        align: 'center',
        stroke: DefaultStrokeColor,
        strokeThickness: getStroke(8)
    });

    ShieldFontPrice = createFont({
        font: getFont(35),
        font2: getFont2(35),
        fill: DefaultStrokeColor,
        align: 'center',
    });

    ShieldFontLevel = createFont({
        font: getFont(30),
        font2: getFont2(30),
        fill: DefaultFontColor,
        align: 'center',
    });
    DefaultFontDailyBonus = createFont({
        font: getFont(50),
        font2: getFont2(50),
        fill: DefaultFontColor,
    });

    PuzzleNumberFont = createFont({//hud
        font: getFont(45),
        font2: getFont2(45),
        fill: DefaultFontColor,
    });

    GirlsMenuHeaderFont = createFont({
        font: getFont(35),
        font2: getFont2(35),
        fill: DefaultFontColor,
    });

    GirlsMenuDescFont = createFont({
        font: getFont(25),
        font2: getFont2(25),
        fill: DefaultFontColor,
    });

    PhotoQuestDescFont = createFont({
        font: getFont(20),
        font2: getFont2(30),
        fill: DefaultStrokeColor,
        align: 'center',
    });

    PhotoQuestPrice = createFont({
        font: getFont(35),
        font2: getFont2(35),
        fill: DefaultStrokeColor,
        align: 'center',
    });

    PhotosCountInListFont = createFont({
        font: getFont(35),
        font2: getFont2(35),
        fill: DefaultStrokeColor,
        align: 'center',
    });

    BossSummonHeaderFont = createFont({
        font: getFont(50),
        font2: getFont2(50),
        fill: DefaultFontColor,
        align: 'center',
    });

    QuestFont = createFont({
        font: getFont(30),
        font2: getFont2(30),
        fill: DefaultStrokeColor,
        align: 'left',
    });

    ShieldRewardFont = createFont({
        font: getFont(20),
        font2: getFont2(20),
        fill: DefaultStrokeColor,
        align: 'left',
    });

    TutorialFont = createFont({
        font: getFont(60),
        font2: getFont2(60),
        fill: DefaultFontColor,
        align: 'center',
        stroke: DefaultStrokeColor,
        strokeThickness: getStroke(10)
    });

    PlayerLevelFont = createFont({
        font: getFont(40),
        font2: getFont2(40),
        fill: DefaultFontColor,
        align: 'center',
        stroke: DefaultStrokeColor,
        strokeThickness: getStroke(5)
    });

    DefaultFontNotifications = createFont({
        font: getFont(50),
        font2: getFont2(50),
        fill: DefaultFontColor,
        align: 'center',
        stroke: DefaultStrokeColor,
        strokeThickness: getStroke(16),
    });

    PrestigeFontHeader = createFont({
        font: getFont(70),
        font2: getFont2(70),
        fill: DefaultFontColor,
        align: 'center',
    });

    PrestigeFontDescription = createFont({
        font: getFont(50),
        font2: getFont2(50),
        fill: DefaultFontColor,
        align: 'center',
    });

    FontManagerWindow = createFont({
        font: getFont(35),
        font2: getFont2(35),
        fill: DefaultStrokeColor,
        align: 'center',
    });
}

if (typeof exports !== 'undefined') {
    if (typeof module !== 'undefined' && module.exports) {
        exports = module.exports = VisualData;
    }
    exports.VisualData = VisualData;
}

let activeButtonForTutorial = null;
const invisibleButton = {};

function lockGuiAtButton(btn) {
    activeButtonForTutorial = btn;
}

function lockGuiEverything() {
    activeButtonForTutorial = invisibleButton;
}

function unlockGUI() {
    activeButtonForTutorial = null;
}

class BasicButton extends Phaser.GameObjects.Sprite {
    constructor(group, config, callback) {
        config.x = config.x || 0;
        config.y = config.y || 0;
        //check if config contains a scene
        if (!config.scene) {
            console.log('missing scene');
            return;
        }
        //check if config contains a key
        if (!config.key) {
            console.log("missing key!");
            return;
        }

        //if there is no up property assume 0
        if (!config.up) {
            config.up = 0;
        }
        //if there is no down in config use up
        if (!config.down) {
            config.down = config.up;
        }
        //if there is no over in config use up
        if (!config.over) {
            config.over = config.up;
        }

        const obj = VisualData.ALL_OBJECTS[config.key];

        var sliceName, nineSlice;
        if (config.minWidth) {
            sliceName = config.key + "_Slice";
            nineSlice = VisualData.ALL_OBJECTS[sliceName];
        }

        if (nineSlice && nineSlice.type === UnnyObjectType.NineSlice) {
            super(config.scene, config.x, config.y, null);
        } else {
            if (obj && GameData.getAtlasName(obj)) {
                super(config.scene, config.x, config.y, 'atlas_sprites', obj.file);
            }
            else {
                super(config.scene, config.x, config.y, config.key, config.up);
            }
        }
        this.config = config;
        this.callback = callback;

        //add this to the scene
        config.scene.add.existing(this);
        this.group = group;
        if (group)
            group.add(this);

        this.clickable = this;

        this.extraXScale = 1;
        if (config.minWidth) {
            if (nineSlice) {
                if (nineSlice.type === UnnyObjectType.NineSlice) {
                    this.clickable = config.scene.add.myNineSlice(config.x, config.y, {
                        name: sliceName,
                        width: config.minWidth,
                        height: this.height,
                    }).setOrigin(0.5);
                    this.visible = false;
                    // this.visible = false;
                    this.nineActive = true;
                    if (group)
                        group.add(this.clickable);
                }
            } else
                this.extraXScale = Math.max(1, config.minWidth * GlobalScale / imagesDeltaScale / this.width);
        }

        if (!config.scale)
            config.scale = 1;
        if (this.config.scale_parent)
            this._defaultScale(1);
        this.setScale(config.scale);

        //make interactive and set listeners
        this.clickable.setInteractive();
        this.clickable.on('pointerdown',this.onDown,this);
        this.clickable.on('pointerup',this.onUp,this);
        this.clickable.on('pointerover',this.onOver,this);
        this.clickable.on('pointerout',this.onOut,this);
    }

    setVisible(visible) {
        if (!this.nineActive)
            super.setVisible(visible);
        else
            this.clickable.setVisible(visible);
    }

    getParentObject() {
        return this.config.scale_parent ? this.group : this.clickable;
    }

    isLocked() {
        return (activeButtonForTutorial && activeButtonForTutorial !== this && !this.ignoreTutorial) || this.locked;
    }

    setButtonLocked(locked) {
        this.locked = locked;
        if (!VisualData.getGameSettings().no_buttons_tint)
            setLockedColor(this.clickable, locked);
    }

    onDown()
    {
        if (this.isLocked())
            return;

        this.down = true;
        // this.setFrame(this.config.down);
        if (this.callback) {
            if (!this.config.dont_scale)
                this.setScale(0.95 * this.config.scale);
            audioManager.playButtonClick();
        }
    }
    onOver()
    {
        if (this.isLocked())
            return;

        // this.setFrame(this.config.over);
    }

    onOut()
    {
        if (this.isLocked())
            return;

        this.down = false;
        // this.setFrame(this.config.up);
        if (this.callback)
            this.setScale(this.config.scale);
    }

    _defaultScale(x, y) {
        if (this.nineActive)
            this.clickable.setScale(x * this.extraXScale, y || x);
        else
            super.setScale(x * this.extraXScale, y || x);
    }

    setScale(x, y) {
        if (this.config.scale_parent) {
            this.group.setScale(x * this.extraXScale, y || x);
        } else
            this._defaultScale(x, y);
    }

    setExternalScale(value) {
        this.config.scale = value;
        this.setScale(this.config.scale);
    }

    onUp()
    {
        if (this.isLocked())
            return;

        // this.setFrame(this.config.up);
        if (this.down && this.callback) {
            this.down = false;
            this.setScale(this.config.scale);
            this.callback();
        }
    }

    setCallback(callback) {
        this.callback = callback;
    }
}

class ButtonWithText extends BasicButton {
    constructor(group, config, callback) {
        super(group, config, callback);//.setDepth(WinDefaultDepth + 100);

        const iconSize = 100 * GlobalScale;
        const borderSize = 100 * GlobalScale;
        const maxWidth = config.minWidth * GlobalScale - borderSize;
        const maxHeight = this.height * (VisualData.getGameSettings().btn_text_height || 1);

        if (config.icon) {
            const priceIcon = config.scene.add.sprite(this.x / localScale - config.minWidth / 2 * GlobalScale + iconSize, this.y / localScale, config.icon);
            group.add(priceIcon);
            this.caption = config.scene.add.text(priceIcon.x / localScale + iconSize, this.y / localScale, config.caption, config.font || DefaultFont)
                .setOrigin(0, 0.5)
                .setDepth(WinDefaultDepth + 110);

            if (config.minWidth)
                this.caption.setFitSize(maxWidth - iconSize * 2, maxHeight);
        } else {
            const x = this.x / localScale + (this.config.textOffsetX || 0);
            this.caption = config.scene.add.text(x, this.y / localScale, config.caption, config.font || DefaultFont)
                .setOrigin(0.5, 0.5)
                .setDepth(WinDefaultDepth + 110);

            if (config.minWidth)
                this.caption.setFitSize(maxWidth, maxHeight);
        }

        group.add(this.caption);
    }

    setScale(x, y) {
        super.setScale(x, y);
        if (this.caption)
            this.caption.setScale(x, y);
    }
}

class AnimationBase {
    constructor(group, duration, callback, startDelay) {
        this.group = group;
        this.callback = callback;
        this.time = 0;
        this.delay = startDelay || 0;
        this.duration = duration;
        if (group) {
            this.x = group.x / localScale;
            this.y = group.y / localScale;
            this.scaleX = group.scaleX / imageSizeLocalScale;
            this.scaleY = group.scaleY / imageSizeLocalScale;
        }
    }

    setInverse() {
        this.inverse = true;
        this.playFrame(0);
    }

    getTime() {
        return this.inverse ? (1 - this.time / this.duration) : this.time / this.duration;
    }

    _playAnimation() {

    }

    stopAnimation() {
        this.stopped = true;
    }

    playFrame(deltaTime){
        if (this.stopped)
            return true;

        this.deltaTime = deltaTime;
        this.time += deltaTime;
        let done = false;
        if (this.time >= this.duration) {
            this.time = this.duration;
            done = true;
        }

        this._playAnimation();

        if (done) {
            this.animationDone();
            return true;
        } else
            return false;
    }

    animationDone() {
        if (this.callback)
            this.callback();
    }
}

class AnimationChangeAlpha extends AnimationBase {
    constructor(group, finalAlpha, duration, callback) {
        super(group, duration, callback);
        this.alphaStart = group.alpha;
        this.alphaFinish = finalAlpha;
    }

    _playAnimation() {
        const dt = this.getTime();
        this.group.alpha = this.alphaStart * (1-dt) + this.alphaFinish * dt;
    }
}

class AnimationWinOpen extends AnimationBase {
    constructor(group, callback) {
        super(group, 0.2, callback);
        this.angle = Math.PI * 0.65;
        this.sinAngle = Math.sin(this.angle);
        this.scale = 1;

        this.playFrame(0);
    }

    _playAnimation() {
        this.group.alpha = this.getTime();
        this.group.setScale(Math.sin(this.group.alpha * this.angle) / this.sinAngle * this.scale);
    }
}

class AnimationButtonShow extends AnimationWinOpen {
    constructor(button, callback) {
        super(button, callback);
        this.scale = button.config.scale;
        this.duration = 0.5;
    }
}

class MoveToPoint extends AnimationBase {
    constructor(group, point, duration, callback) {
        super(group, duration, callback);

        this.dx = point.x - this.x;
        this.dy = point.y - this.y;
    }

    _playAnimation() {
        const dt = this.getTime();
        this.group.setPosition(this.x + this.dx * dt, this.y + this.dy * dt);
    }
}

class JumpShieldAnimation extends AnimationBase {
    constructor(group, params, duration, callback) {
        super(group, duration, callback);
        this.params = params;
    }

    _playAnimation() {
        const dt = this.getTime();
        const a = Math.sin(Math.PI * dt);
        this.group.setPositionY(this.y - this.params.height * a);
        this.group.setScale((1 + a * this.params.scale));
    }
}

class AnimationInfinite extends AnimationBase {
    constructor(group, period, callback) {
        super(group, Number.MAX_VALUE, callback);
        this.period = period;
    }

    getTime() {
        return this.time / this.period - Math.trunc(this.time / this.period);
    }
}

class JumpFishAnimation extends AnimationInfinite {
    constructor(group, params, period, callback) {
        super(group, period, callback);
        this.params = params;
    }

    _playAnimation() {
        const dt = this.getTime();
        const a = Math.sin(Math.PI * dt);
        this.group.setPositionY(this.y - this.params.height * a);
        this.group.setScale((1 + a * this.params.scale) * this.scaleX);
    }
}

class FallFishAnimation extends AnimationInfinite {
    constructor(group, params, period, callback) {
        super(group, period, callback);
        this.params = params;
    }

    _playAnimation() {
        const dt = this.getTime();
        const a = Math.sin(Math.PI * dt);
        this.group.setPositionY(this.y - this.params.height * (1 - a));
        this.group.setScale((1 + a * this.params.scale) * this.scaleX, (1 - this.params.scale + this.params.scale * (1 - a)) * this.scaleY);
    }

    stopAnimation() {
        super.stopAnimation();

        this.group.setPositionY(this.y);
        this.group.setScale(this.scaleX, this.scaleY);
    }
}

class RandomJumpRotation extends AnimationBase {
    constructor(group, params, duration, callback) {
        super(group, duration, callback);
        this.params = params;
    }

    _playAnimation() {
        const dt = this.getTime();
        this.group.setPosition(this.group.x / localScale + this.params.vx * dt, this.group.y / localScale + this.params.vy * dt);
        this.group.angle += this.params.angle * dt;
        this.params.vy += this.params.g * dt;
    }
}

class MoveToPointExtra extends MoveToPoint {
    constructor(group, point, extra, duration, callback) {
        super(group, point, duration, callback);
        this.sinAngle = 1 - extra;
        this.angle = Math.PI - Math.asin(this.sinAngle);
    }

    _playAnimation() {
        const dt = Math.sin(this.getTime() * this.angle) / this.sinAngle;
        this.group.setPosition(this.x + this.dx * dt, this.y + this.dy * dt);
    }
}

class MoveToPointSin extends MoveToPoint {
    constructor(group, point, duration, callback) {
        super(group, point, duration, callback);
        const d = Math.sqrt(this.dx * this.dx + this.dy * this.dy);
        this.d = d;
        this.nx = this.dy / d;
        this.ny = -this.dx / d;
    }

    _playAnimation() {
        const dt = this.getTime();
        const a = Math.sin(dt * Math.PI * 2) * this.d / 10;
        this.group.setPosition(this.x + this.dx * dt + a * this.nx, this.y + this.dy * dt + a * this.ny);
    }
}

class ChangeShape extends AnimationBase {
    constructor(group, scale, duration, periods, callback) {
        super(group, duration, callback);
        this.scale = scale;
        this.periods = periods;
    }

    _playAnimation() {
        const dt = this.getTime();
        const a = Math.sin(dt * Math.PI * 2 * this.periods) * this.scale;
        this.group.setScale2(this.scaleX * (1 + a), this.scaleY * (1 - a));
    }
}

class ScaleAnimation extends AnimationBase {
    constructor(group, scale, duration, callback) {
        super(group, duration, callback);
        this.scaleStart = group.scaleX;
        this.scaleEnd = scale;
    }

    _playAnimation() {
        const dt = this.getTime();
        this.group.setScale(this.scaleStart * (1-dt) + this.scaleEnd * dt);
    }
}

class RotationAnimation extends AnimationBase {
    constructor(group, amplitude, duration, periods, callback) {
        super(group, duration, callback);
        this.amplitude = amplitude;
        this.periods = periods;
        this.angle = this.group.angle;
    }

    _playAnimation() {
        const dt = this.getTime();
        this.group.angle = this.angle + Math.sin(dt * Math.PI * 2 * this.periods) * this.amplitude;
    }
}

class RotationCircleAnimation extends AnimationInfinite {
    constructor(group, periods, callback) {
        super(group, periods, callback);
    }

    _playAnimation() {
        const dt = this.getTime();
        this.group.angle = dt * 360;
    }
}

class ShakeBox extends RotationAnimation {
    constructor(group, amplitude, distance, duration, periods, callback) {
        super(group, amplitude, duration, periods, callback);
        this.distance = distance;
    }

    _playAnimation() {
        const dt = this.getTime();
        const delay = Math.PI / 2;
        this.group.angle = -Math.sin(dt * (Math.PI * 2 * this.periods - delay) + delay) * this.amplitude;
        const sin = Math.sin(dt * Math.PI * 2 * this.periods);
        this.group.setPositionX(this.x + sin * this.distance);
    }
}

class ScaleSinInfinite extends AnimationInfinite {
    constructor(group, period, startScale, amplitude, callback) {
        super(group, period, callback);
        this.startScale = startScale;
        this.amplitude = amplitude;
    }

    _playAnimation() {
        const dt = this.getTime();
        this.group.setScale(this.startScale + this.amplitude * Math.sin(dt * Math.PI * 2));
    }
}

class MoveSinInfinite extends AnimationInfinite {
    constructor(group, period, amplitudeX, amplitudeY, callback) {
        super(group, period, callback);
        this.amplitudeX = amplitudeX;
        this.amplitudeY = amplitudeY;
    }

    _playAnimation() {
        const dt = this.getTime();
        this.group.setPosition(
            this.x + this.amplitudeX * Math.sin(dt * Math.PI * 2),
            this.y + this.amplitudeY * Math.sin(dt * Math.PI * 2)
            );
    }
}

class ScaleAlphaInfinite extends AnimationInfinite {
    _playAnimation() {
        const dt = this.getTime();
        this.group.setScale(dt);
        this.group.alpha = Math.cos(dt * Math.PI / 2) * 2;
    }
}

class ScaleAlphaOnce extends AnimationBase {
    _playAnimation() {
        const dt = this.getTime();
        this.group.setScale(dt);
        this.group.alpha = Math.cos(dt * Math.PI / 2) * 2;
    }
}

class SwipeInfinite extends AnimationInfinite {
    constructor(group, period, callback) {
        super(group, period, callback);
        this.part = 0.3;
        this.endPoint = {
            x: this.x + 200 * GlobalScale,
            y: this.y - 100 * GlobalScale
        };
    }

    _playAnimation() {
        let dt = this.getTime();
        if (dt <= this.part) {
            dt /= this.part;
            this.group.setPosition(this.x * (1-dt) + this.endPoint.x * dt, this.y * (1-dt) + this.endPoint.y * dt);
        } else {
            dt = 1 - dt;
            dt /= (1 - this.part);
            this.group.setPosition(this.x * (1-dt) + this.endPoint.x * dt, this.y * (1-dt) + this.endPoint.y * dt);
        }
    }
}

class SwipeOnce extends AnimationBase {
    constructor(group, period, callback) {
        super(group, period, callback);
        this.part = 0.3;
        this.endPoint = {
            x: this.x + 200 * GlobalScale,
            y: this.y - 100 * GlobalScale
        };
    }

    _playAnimation() {
        let dt = this.getTime();
        if (dt <= this.part) {
            dt /= this.part;
            this.group.setPosition(this.x * (1-dt) + this.endPoint.x * dt, this.y * (1-dt) + this.endPoint.y * dt);
        } else {
            dt = 1 - dt;
            dt /= (1 - this.part);
            this.group.setPosition(this.x * (1-dt) + this.endPoint.x * dt, this.y * (1-dt) + this.endPoint.y * dt);
        }
    }
}

class AnimationFallingBread extends AnimationBase {
    constructor(engine, group, duration, callback) {
        super(group, duration, callback);
        this.engine = engine;
        this.breads = [];
        this.period = 0.15;

        this.respawn = true;
        this.destroyedCount = 0;

        this.timer = Math.trunc(duration - 0.5);

        const number = this.engine.add.textOld(RealScreenWidth / 2, RealScreenHeight * 0.1, LocalizationManager.getLocalizization("BanjoManTipStart"), DefaultFontVeryBig)
            .setDepth(WinDefaultDepth)
            .setOrigin(0.5);
        animManager.applyWinOpenAnimation(number, ()=>{
            setTimeout(()=>number.destroy(true), 500);
        });

        audioManager.playBanjoded();
    }

    playFrame(deltaTime){
        if (this.stopped)
            return true;

        this.deltaTime = deltaTime;

        if (this.respawn) {
            this.time += deltaTime;
            if (this.time >= this.duration - 1) {
                this.time = this.duration;
                this.respawn = false;
            }
        } else {
            if (this.destroyedCount >= this.breads.length) {
                this.animationDone();
                return true;
            }
        }

        this._playAnimation();
    }

    _playAnimation() {
        const timeLeft = Math.trunc(this.duration - this.time);

        if (timeLeft < this.timer) {
            this.timer = timeLeft;
            const number = this.engine.add.textOld(RealScreenWidth / 2, RealScreenHeight * 0.1, timeLeft, DefaultFontVeryBig)
                .setDepth(WinDefaultDepth)
                .setOrigin(0.5);
            animManager.applyWinOpenAnimation(number, ()=>{
                setTimeout(()=>number.destroy(true), 500);
            });
        }

        if (!VisualData.GUI_Common.playBreadAnimation)
            return;

        const count = Math.trunc(this.time / this.period);
        if (count > this.breads.length) {
            let newCount = count - this.breads.length;
            const part = 0.2;
            for (let i = 0; i < newCount; i++) {
                const obj = {};
                this.breads.push(obj);
                CreateImageInGroup(this.engine, this.group, 'bread_' + (Math.trunc(Math.random() * 7) + 1), (sprite)=>{
                    obj.img = sprite;
                    obj.v = (3 + Math.random()) * 400;
                    obj.y = 0;
                    let x;
                    if (Math.random() > 0.5)
                        x = (1 - part * 0.25 - Math.random() * part) * RealScreenWidth;
                    else
                        x = part * 0.25 + (Math.random() * part) * RealScreenWidth;
                    sprite.setPosition(x, obj.y).setScale(0.7 + Math.random() * 0.5);
                    sprite.angle = Math.random() * 360;
                });
            }
        }

        for (let i = 0; i < this.breads.length; i++) {
            const obj = this.breads[i];
            const img = obj.img;

            if (img) {
                obj.y += obj.v * this.deltaTime;
                if (obj.y >= RealScreenHeight){
                    this.destroyedCount++;
                    obj.img.destroy(true);
                    obj.img = null;
                } else
                    img.setPositionY(obj.y);
            }
        }
    }
}

class AnimationsManager {

    constructor() {
        this.allAnimations = [];
        this.deltaTime = 1.0 / 30.0;
        setInterval(() => this.playAnimations(), this.deltaTime * 1000);
    }

    _canAddAnimation(group) {
        for (let i in this.allAnimations) {
            if (this.allAnimations[i].group === group)
                return false;
        }
        return true;
    }

    _addAnimation(anim) {
        this.allAnimations.push(anim);
        return anim;
    }

    applyWinOpenAnimation(group, callback) {
        return this._addAnimation(new AnimationWinOpen(group, callback));
    }

    applyButtonShowAnimation(group) {
        return this._addAnimation(new AnimationButtonShow(group));
    }

    moveToPoint(group, point, duration, callback) {
        return this._addAnimation(new MoveToPoint(group, point, duration, callback));
    }

    moveToPointExtra(group, point, extra, duration, callback) {
        return this._addAnimation(new MoveToPointExtra(group, point, extra, duration, callback));
    }

    animationChangeAlpha(group, finalAlpha, duration, callback) {
        return this._addAnimation(new AnimationChangeAlpha(group, finalAlpha, duration, callback));
    }

    moveToPointSin(group, point, duration, callback) {
        return this._addAnimation(new MoveToPointSin(group, point, duration, callback));
    }

    changeShape(group, scale, duration, periods, callback) {
        return this._addAnimation(new ChangeShape(group, scale, duration, periods, callback));
    }

    rotationAnimation(group, amplitude, duration, periods, callback) {
        return this._addAnimation(new RotationAnimation(group, amplitude, duration, periods, callback));
    }

    rotationCircleAnimation(group, periods, callback) {
        return this._addAnimation(new RotationCircleAnimation(group, periods, callback));
    }

    shakeBox(group, amplitude, distance, duration, periods, callback) {
        return this._addAnimation(new ShakeBox(group, amplitude, distance, duration, periods, callback));
    }

    scaleAnimation(group, scale, duration, callback) {
        return this._addAnimation(new ScaleAnimation(group, scale, duration, callback));
    }

    randomJumpRotation(group, params, duration, callback) {
        return this._addAnimation(new RandomJumpRotation(group, params, duration, callback));
    }

    jumpShieldAnimation(group, params, duration, callback) {
        if (this._canAddAnimation(group))
            return this._addAnimation(new JumpShieldAnimation(group, params, duration, callback));
        return null;
    }

    jumpFishAnimation(group, params, period, callback) {
        if (this._canAddAnimation(group))
            return this._addAnimation(new JumpFishAnimation(group, params, period, callback));
        return null;
    }

    fallFishAnimation(group, params, period, callback) {
        if (this._canAddAnimation(group))
            return this._addAnimation(new FallFishAnimation(group, params, period, callback));
        return null;
    }

    waitAnimation(duration, callback) {
        return this._addAnimation(new AnimationBase(null, duration, callback));
    }

    scaleAlphaInfinite(group, period, callback) {
        return this._addAnimation(new ScaleAlphaInfinite(group, period, callback));
    }

    scaleAlphaOnce(group, period, callback, delay) {
        return this._addAnimation(new ScaleAlphaOnce(group, period, callback, delay));
    }

    moveSinInfinite(group, period, amplitudeX, amplitudeY, callback) {
        return this._addAnimation(new MoveSinInfinite(group, period, amplitudeX, amplitudeY, callback));
    }

    scaleSinInfinite(group, period, startScale, amplitude, callback) {
        return this._addAnimation(new ScaleSinInfinite(group, period, startScale, amplitude, callback));
    }

    swipeInfinite(group, period, callback) {
        return this._addAnimation(new SwipeInfinite(group, period, callback));
    }

    swipeOnce(group, period, callback) {
        return this._addAnimation(new SwipeOnce(group, period, callback));
    }

    playFallingBread(engine, group, duration, callback) {
        return this._addAnimation(new AnimationFallingBread(engine, group, duration, callback));
    }

    changeShapeOfSouls(group, callback) {
        if (this._canAddAnimation(group)) {
            audioManager.playMoneyCollected();
            return this._addAnimation(new ChangeShape(group, 0.2, 0.5, 1, callback));
        }
        return null;
    }

    playAnimations() {
        for (let i = this.allAnimations.length - 1; i >= 0; i--) {
            if (this.allAnimations[i].playFrame(this.deltaTime)) {
                this.allAnimations.splice(i, 1);
            }
        }
    }
}

let animManager = new AnimationsManager();

class AudioManager {
    constructor() {
        this.names = {
            BackgroundMusic: 'BackgroundMusic',
            Banjoded: 'Banjoded',
            Chest: ['Audio_Chest_1',
                'Audio_Chest_2',
                'Audio_Chest_3'
            ],
            LongTap: [
                'Audio_longtap1',
                'Audio_longtap2',
                'Audio_longtap3',
                'Audio_longtap4'
            ],
            Click: [
                'Audio_Pop-ani-1',
                'Audio_Pop-ani-2',
                'Audio_Pop-ani-3',
            ],
            ButtonClick: 'Audio_ClickUI',
            Info: 'Audio_Info',
            // LevelUp: 'Audio_LevelUp',
            Money: 'Audio_Money',
            Window: 'Audio_Window'
        };

        this.addMusic = {
            BackgroundMusic2: 'BackgroundMusic2',
            BackgroundMusic3: 'BackgroundMusic3',
            Gathering: 'Gathering'
        };
        this.sounds = {};
        this._activeWorldMusic = 0;
    }

    playFactoryMusic() {
        this.playWorldMusic(0);
    }

    _playBackMusic(music, volume) {
        if (this.activeMusic === music || GameSettings.musicOff)
            return;

        volume = volume || 1;
        this.stopMusic();

        if (music)
            music.play({loop: true, volume: volume});
        this.activeMusic = music;
    }

    stopMusic() {
        if (this.activeMusic) {
            this.activeMusic.stop();
            this.activeMusic = null;
        }
    }

    restoreMusic() {
        this.playWorldMusic(this._activeWorldMusic);
    }

    _loadAndPlayMusicByKey(worldIndex, key) {
        if (this.sounds.hasOwnProperty(key)) {
            this._playBackMusic(this.sounds[key]);
        } else {
            const music = this.addMusic[key];
            LoadPreparedFile(this.engine, music, ()=>{
                this.sounds[key] = this.engine.sound.add(music);
                if (this._activeWorldMusic === worldIndex)
                    this._playBackMusic(this.sounds[key]);
            });
        }
    }

    playWorldMusic(worldIndex) {
        worldIndex = parseInt(worldIndex);
        this._activeWorldMusic = worldIndex;
        switch (worldIndex) {
            case 0:
                this._loadAndPlayMusicByKey(worldIndex, 'Gathering');
                break;
            case 1:
                this._playBackMusic(this.sounds.BackgroundMusic, VisualData.getMusicVolumeForWorld(worldIndex));
                break;
            default:
                this._loadAndPlayMusicByKey(worldIndex, VisualData.getMusicForWorld(worldIndex));
                break;
        }
    }

    load(engine) {
        this.engine = engine;
        const load = engine.load;

        for (let key in this.names) {
            if (typeof this.names[key] === 'object') {
                for (let name of this.names[key])
                    load.audio(name, VisualData.ALL_OBJECTS[name].file);
            } else {
                const name = this.names[key];
                load.audio(name, VisualData.ALL_OBJECTS[name].file);
            }
        }

        engine.load.once('complete', ()=>{
            for (let key in this.names) {
                if (typeof this.names[key] === 'object') {
                    const arr = this.sounds[key] = [];
                    for (let name of this.names[key])
                        arr.push(engine.sound.add(name));
                } else {
                    const name = this.names[key];
                    this.sounds[key] = engine.sound.add(name);
                }
            }

            window.onclick = () => {
                if (this._activeWorldMusic === 0)
                    this.playWorldMusic(1);
                window.onclick = null;
            };
        });
        load.start();
    }

    playWindowOpen(){
        if (GameSettings.soundsOff)
            return;

        if (this.sounds.Window)
            this.sounds.Window.play();
    }

    playButtonClick(){
        if (GameSettings.soundsOff)
            return;

        if (this.sounds.ButtonClick)
            this.sounds.ButtonClick.play();
    }

    playMoneyCollected(){
        if (GameSettings.soundsOff)
            return;

        if (this.sounds.Money)
            this.sounds.Money.play();
    }

    playBuildingClick() {
        if (GameSettings.soundsOff)
            return;

        if (this.sounds.Click)
            this.sounds.Click[Math.trunc(Math.random() * this.sounds.Click.length)].play();
    }

    playUpgrade(counter) {
        if (GameSettings.soundsOff)
            return;

        if (this.sounds.LongTap) {
            const index = Math.min(this.sounds.LongTap.length - 1, Math.trunc(counter / 4));
            const sound = this.sounds.LongTap[index];
            sound.play();
        }
    }

    playChestSound(index) {
        if (GameSettings.soundsOff)
            return;

        if (this.sounds.Chest)
            this.sounds.Chest[index].play();
    }

    playBanjoded() {
        if (GameSettings.soundsOff)
            return;

        if (this.sounds.Banjoded)
            this.sounds.Banjoded.play();
    }

    playInfo() {
        if (GameSettings.soundsOff)
            return;

        if (this.sounds.Info)
            this.sounds.Info.play();
    }

    muteSounds() {
        if (!GameSettings.musicOff && this.activeMusic) {
            this.activeMusic.pause();
        }
    }

    unMuteSounds() {
        if (!GameSettings.musicOff && this.activeMusic) {
            this.activeMusic.resume();
        }
    }
}

var audioManager = new AudioManager();

function Random(seed) {
    this._seed = seed % 2147483647;
    if (this._seed <= 0) this._seed += 2147483646;
}

/**
 * Returns a pseudo-random value between 1 and 2^32 - 2.
 */
Random.prototype.next = function () {
    return this._seed = this._seed * 16807 % 2147483647;
};


/**
 * Returns a pseudo-random floating point number in range [0, 1).
 */
Random.prototype.nextFloat = function () {
    return (this.next() - 1) / 2147483646;
};

function BigIntSqrRoot(val) {
    function newtonIteration(x0) {
        const x1 = val.divide(x0).add(x0).divide(2);
        if (x1.compare(x0) >= 0)
            return x1;

        return newtonIteration(x1);
    }

    return newtonIteration(val);
}

class UnnyAction {

    constructor(){
        this.allListeners = [];
    }

    addListener(listener) {
        this.allListeners.push(listener);
    }

    removeListener(listener) {
        for (let i = 0;i < this.allListeners.length;i++){
            if (this.allListeners[i] === listener){
                this.allListeners.splice(i, 1);
                break;
            }
        }
    }

    clear() {
        this.allListeners = [];
    }

    callListeners (...theArgs) {
        for (let i = 0;i < this.allListeners.length;i++)
            this.allListeners[i](...theArgs);
    }

    callAndClearListeners (...theArgs) {
        const temp = this.allListeners;
        this.clear();
        for (let i = 0;i < temp.length;i++)
            temp[i](...theArgs);
    }
}

class EventManager {
    constructor() {
        this.onSoulsCollected = new UnnyAction();//slot, amount
        this.onBoxOpened = new UnnyAction();
        this.onGuardBoxOpened = new UnnyAction();
        this.onBoxPurchased = new UnnyAction();
        this.onBoxReceived = new UnnyAction();
        this.onLongSpeedActivated = new UnnyAction();
        this.onShortSpeedActivated = new UnnyAction();
        this.onUpgradePurchased = new UnnyAction();
        this.onBuildingUpgraded = new UnnyAction();
        this.onHarvestCompleted = new UnnyAction();
        this.onMacroUpgraded = new UnnyAction();
        this.onMouseWheel = new UnnyAction();
        this.onAdStarted = new UnnyAction();
        this.onDailyBonusCollected = new UnnyAction();
        this.onQuestCompleted = new UnnyAction();
        this.onQuestClaimed = new UnnyAction();
        this.onPhotoQuestClaimed = new UnnyAction();
        this.onPhotoTokensEarnedFromBuilding = new UnnyAction();
        this.onLikesReseted = new UnnyAction();
        this.onFortuneWheelUsed = new UnnyAction();
        this.onActionQuestProgress = new UnnyAction();
        this.onLoadResourcesAdded = new UnnyAction();
        this.onOfflineCollected = new UnnyAction();
        this.onOfflineDoubled = new UnnyAction();
        this.onHarvestClicked = new UnnyAction();
        this.onLikesReseted = new UnnyAction();
        this.onFortuneWheelUsed = new UnnyAction();
        this.onActionQuestProgress = new UnnyAction();
        this.onPhotoQuestClaimed = new UnnyAction();
        this.onPhotoTokensEarnedFromBuilding = new UnnyAction();
        this.onGuardLeveledUp = new UnnyAction();
        this.onBubbleAppeared = new UnnyAction();
    }

    soulsCollected(slot, amount) {
        this.onSoulsCollected.callListeners(slot, amount);
    }

    guardBoxOpened() {
        this.onGuardBoxOpened.callListeners();
    }

    boxOpened() {
        this.onBoxOpened.callListeners();
        gameAnalytics.sendEvent("BoxOpened");
    }

    boxReceived(amount) {
        this.onBoxReceived.callListeners(amount);
    }

    boxPurchased(amount) {
        this.onBoxPurchased.callListeners(amount);
    }

    longSpeedActivated() {
        this.onLongSpeedActivated.callListeners();
    }

    shortSpeedActivated() {
        this.onShortSpeedActivated.callListeners();
    }

    upgradePurchased(upgradeInfo) {
        this.onUpgradePurchased.callListeners(upgradeInfo);
    }

    buildingUpgraded(building, slot) {
        this.onBuildingUpgraded.callListeners(building, slot);
    }

    harvestCompleted(seeds) {
        this.onHarvestCompleted.callListeners(seeds);
    }

    macroUpgraded(building, bonus) {
        this.onMacroUpgraded.callListeners(building, bonus);
    }

    mouseWheel(deltaX, deltaY) {
        this.onMouseWheel.callListeners(deltaX, deltaY);
    }

    adStarted() {
        this.onAdStarted.callListeners();
    }

    dailyBonusCollected() {
        this.onDailyBonusCollected.callListeners();
    }

    questClaimed() {
        this.onQuestClaimed.callListeners();
    }

    photoQuestClaimed() {
        this.onPhotoQuestClaimed.callListeners();
    }

    questCompleted() {
        this.onQuestCompleted.callListeners();
    }

    photoTokensEarnedFromBuilding(building, token) {
        this.onPhotoTokensEarnedFromBuilding.callListeners(building, token);
    }

    likesReseted() {
        this.onLikesReseted.callListeners();
    }

    fortuneWheelUsed() {
        this.onFortuneWheelUsed.callListeners();
    }

    actionQuestProgress(quest) {
        this.onActionQuestProgress.callListeners(quest);
    }
    loadResourcesAdded(resources) {
        this.onLoadResourcesAdded.callListeners(resources);
    }

    offlineCollected(time, resources) {
        this.onOfflineCollected.callListeners(time, resources);
    }

    offlineDoubled() {
        this.onOfflineDoubled.callListeners();
    }

    harvestClicked() {
        this.onHarvestClicked.callListeners();
    }

    guardLeveledUp(guard) {
        this.onGuardLeveledUp.callListeners(guard);
    }

    bubbleAppeared() {
        this.onBubbleAppeared.callListeners();
    }
}

let eventManager = new EventManager();

const BONUS_PER_LIKE = 1;
const MAX_LIKES_COUNT = 100;
const MAX_COLLECTION_TIME = 4 * 3600 * 1000;

const AllBuildings = {};

function GetAllBuildingsProduction(timeInSecs) {
    let totalProduction = bigInt(0);
    for(let i in AllBuildings) {
        const b = AllBuildings[i];
        if (b.getLevel() > 0) {
            const production = b.getProductionPerLoad();
            const loadTime = b.getLoadingTime();
            const loads = Math.trunc(timeInSecs / loadTime);
            totalProduction = totalProduction.add(production.multiply(loads));
        }
    }

    return totalProduction;
}

let lastBuildingTokenClick = null;

class Building {

    constructor(info, slot, key, world_id) {
        this.onResourcesUpdated = new UnnyAction();
        this.onBuildingUpdated = new UnnyAction();
        this.onResourcesCollected = new UnnyAction();
        this.onPreUpgrade = new UnnyAction();
        this.onUpgraded = new UnnyAction();
        this.onLiked = new UnnyAction();
        this.onReseted = new UnnyAction();
        this.onUnlockChanged = new UnnyAction();

        this.currentLoading = 0;
        this.info = info;
        this.resources = 0;
        this.level = 0;
        this.likes = [];
        this.slot = slot;
        this.id = parseInt(key);
        this.world_id = world_id;
        this.lastTokensGetLevel = 0;

        AllBuildings[this.slot] = this;

        this.onLikesReseted = new UnnyAction();
        eventManager.onLikesReseted.addListener(this.likesWereReseted.bind(this));
        eventManager.onOfflineDoubled.addListener(this.offlineDoubled.bind(this));
    }

    _saveState() {
        this.savedProgress.resources = this.resources.toString();
        this.savedProgress.loading = this.currentLoading;
        this.savedProgress.update = this.update = Progress.getTimeNow();
    }

    _loadProgress(progress, globalProgress, nowTime) {
        this.savedProgress = progress;

        this.level = progress.level;
        this.likes = progress.likes ? progress.likes : [];
        this.resources = bigInt(progress.resources);
        if (!progress.hasOwnProperty("upgradePrice")) {
            progress.upgradePrice = "0"
        }
        this.upgradePrice = bigInt(this.level > 0 ? progress.upgradePrice : this.info.construct.price);
        this.currentLoading = progress.loading || 0;
        this.update = progress.update || 0;
        this.bonus_SpeedUp = progress.speedUpMultiplier ? progress.speedUpMultiplier : 1;
        if (!progress.hasOwnProperty('multiProfitMultiplier'))
            progress.multiProfitMultiplier = "1";
        this.bonus_MultiProfit = new bigInt(progress.multiProfitMultiplier);
        this.autoCollect = progress.hasAutoClick;

        this._updateFinalProductionRate();

        if (this.level > 0) {
            const loadTime = this.getLoadingTime();
            const production = this.getProductionPerLoad();

            let deltaTime = Math.min(nowTime - this.update, MAX_COLLECTION_TIME);

            const guardEndTime = globalProgress.getGuardEndTime();
            let guardScale = 1;
            if (guardEndTime > this.update) {
                if (guardEndTime >= nowTime)
                    guardScale = 2;
                else
                    guardScale = ((nowTime - guardEndTime) + 2 * (guardEndTime - this.update)) / deltaTime;
            }

            if (this.resources.compare(0) !== 0 && !this.autoCollect) {
                this.currentLoading = 0;
                this.anyResources = true;
            } else {
                deltaTime /= 1000;
                let periods = Math.trunc(deltaTime / loadTime);
                if (!this.autoCollect)
                    periods = Math.min(1, periods);

                // console.log("id = " + this.id + " > " + this.autoCollect + " ? " + periods + " <> " + production + " this.resources = " + this.resources.toString());
                // console.warn("guardScale " + guardScale);
                this.offlineResources = production.multiply(Math.trunc(periods * guardScale));
                eventManager.loadResourcesAdded(this.offlineResources);
                this.resources = this.resources.add(this.offlineResources);
                this.anyResources = this.resources.compare(0) !== 0;

                if (this.anyResources && !this.autoCollect)
                    this.currentLoading = 0;
                else
                    this.currentLoading += deltaTime - periods * loadTime;
            }
            this._calculateNextBigUpgradeLevel();

        } else
            this.anyResources = false;

        globalProgress.onResourcesChanges.addListener(this.resourcesChanged.bind(this));

        this._checkBuildingForOpen(globalProgress);
        // const info = globalProgress.getPuzzleInfoById(this.id - 1);
        // if (info && info.level > 1) {
        //     const data = {
        //         upgradeType: 'MultiProfit'
        //     };
        //     for (let i = 2;i < info.level;i++) {
        //         data.parameter = GameData.getPuzzleResourceBonusPerLevel(i);
        //         this._applyBonus(data);
        //     }
        // }
    }

    offlineDoubled() {
        if (this.offlineResources) {
            this.resources = this.resources.add(this.offlineResources);
            this.onResourcesUpdated.callListeners(this);
            this.offlineResources = null;
            this._saveState();
            gameInit.progress.saveProgress();
        }
    }

    isUnlocked() {
        return this.unlocked;
    }

    _checkBuildingForOpen(progress) {
        if (this.getLevel() > 0) {
            this.unlocked = false;
        } else {
            const newUnlocked = progress.isResourcesEnoughForConstruction(this);
            if (this.unlocked !== newUnlocked) {
                this.unlocked = newUnlocked;
                this.onUnlockChanged.callListeners(this);
            }
        }
    }

    resourcesChanged(progress, increased) {
        if (this.unlocked === !increased && increased !== undefined) {
            this._checkBuildingForOpen(progress);
        }
    }

    loadProgress(progress, globalProgress, nowTime) {
        this._loadProgress(progress, globalProgress, nowTime);

        globalProgress.onPuzzleCompleted.addListener(this.puzzleCompleted.bind(this));
        globalProgress.onSeedsBonusChanged.addListener(this._updateFinalProductionRate.bind(this));
    }

    reseted(globalProgress, buildings) {
        const nowTime = Math.trunc(Progress.getTimeNow());
        const prog = buildings[this.id];

        this._loadProgress(prog, globalProgress, nowTime);

        this.onReseted.callListeners();
    }

    puzzleCompleted(info) {
        if (info.id !== this.slot)
            return;

        const data = {
            upgradeType: 'MultiProfit',
            parameter: GameData.getPuzzleResourceBonusPerLevel(info.level),
            div_parameter: GameData.getPuzzleResourceBonusDivPerLevel(info.level)
        };

        if (info.level === 1)
            this._checkBuildingForOpen(gameInit.progress);

        this._applyBonus(data);
    }

    getLoadingTime() {
        return this.info.loading.duration / this.bonus_SpeedUp;
    }

    getProductionPerLoad() {
        return this.finalProduction;// this.info.production.base.multiply(this.bonus_MultiProfit);
    }

    updateBuilding(deltaTime) {
        if (this.level <= 0)
            return;

        if (this.anyResources && !this.autoCollect)
            return;

        this.currentLoading += deltaTime;
        const loadTime = this.getLoadingTime();
        if (this.currentLoading >= loadTime) {
            let loads = Math.trunc(this.currentLoading / loadTime);

            if (this.autoCollect)
                this.currentLoading -= loads * loadTime;
            else {
                this.currentLoading = 0;
                loads = 1;
            }

            const multiply = gameInit.progress.isGuardActive() ? gameInit.progress.getGuardMultiplier() : 1;
            this.resources = this.resources.add(this.getProductionPerLoad().multiply(loads * multiply));
            this.onResourcesUpdated.callListeners(this);
            this.anyResources = true;
        }
        this.onBuildingUpdated.callListeners(this);
    }

    getProducedResources() {
        return this.resources;
    }

    getLoadingPercentage() {
        if (this.anyResources && !this.autoCollect)
            return 1;
        return Math.min(this.currentLoading / this.getLoadingTime(), 1);
    }

    getLevel() {
        return this.level;
    }

    likesWereReseted() {
        if (this.getLikes() > 0) {
            this.likes = [];
            this._updateFinalProductionRate();
            this.onLikesReseted.callListeners(this);
        }
    }

    getLikes() {
        return this.likes.length > MAX_LIKES_COUNT ? MAX_LIKES_COUNT : this.likes.length;
    }

    addLikes(arr) {
        for (let i in arr) {
            const val = arr[i];
            if (!this.likes.includes(val))
                this.likes.push(val);
        }

        this.savedProgress.likes = this.likes;
        this.onLiked.callListeners(this);
        this._updateFinalProductionRate();
        gameInit.progress.saveProgress();
    }

    getUpgradePrice() {
        return this.upgradePrice;//.getUpgradePrice(this.level);
    }

    getUpgradeProgress() {
        return (this.level - this.prevBigUpgradeLevel) / (this.nextBigUpgradeLevel - this.prevBigUpgradeLevel);
    }

    buildingWasClicked() {
        if (this.anyResources) {
            if (gameInit.progress.isSupervisorActive()) {
                let bonus = gameInit.guardManager ? gameInit.guardManager.getActiveBonusForWorld(this.world_id) : 2;
                const amount = this.resources.multiply(bonus);
                this.onResourcesCollected.callListeners(this, amount);
                gameInit.progress.addSupervisorResources(amount);
            }
            else
                this.onResourcesCollected.callListeners(this, this.resources);
            this.resources = bigInt(0);
            this.anyResources = false;
            this.onResourcesUpdated.callListeners(this);

            const info = GameData.getTokensInfoForWorld(this.world_id);
            if (info) {
                const time = Progress.getTimeNow();
                if (!lastBuildingTokenClick || time - lastBuildingTokenClick >= info.cooldown * 1000) {
                    const r = Math.random();
                    if (r < info.tokenDropClick) {
                        gameInit.progress.tokensEarned(info.tokenType, info.tokenDropAmount);
                        eventManager.photoTokensEarnedFromBuilding(this, info.tokenType);
                    }

                    lastBuildingTokenClick = time;
                }
            }

            this._saveState();
        }
    }

    _calculateNextBigUpgradeLevel() {
        const upgradeData = GameData.getSlotsUpgrade();

        for (let i = 0; i < upgradeData.length; i++) {
            const val = upgradeData[i];
            if (this.level < val.requiredLevel) {
                this.nextBigUpgradeLevel = val.requiredLevel;
                this.prevBigUpgradeLevel = i === 0 ? 0 : upgradeData[i - 1].requiredLevel;
                return;
            }
        }

        this.nextBigUpgradeLevel = Math.trunc(this.level / 100 + 1) * 100;
        this.prevBigUpgradeLevel = this.nextBigUpgradeLevel - 100;
    }

    _getBigUpgradeLevelBonus() {
        const upgradeData = GameData.getSlotsUpgrade();

        for (let i in upgradeData) {
            const val = upgradeData[i];
            if (val.requiredLevel === this.level)
                return val;
        }

        return upgradeData[upgradeData.length - 1];
    }

    _applyPuzzleBonusAfterConstruction() {
        const puzzleInfo = gameInit.progress.getPuzzleInfoById(this.slot - 1);
        if (puzzleInfo.level >= 2) {
            const data = {
                upgradeType: 'MultiProfit',
                parameter: GameData.getPuzzleResourceBonusPerLevel(puzzleInfo.level)
            };
            this._applyBonus(data);
        }
    }

    upgradeBuilding(free) {
        if (!free)
            this.onPreUpgrade.callListeners(this);

        this.level++;

        this._updateFinalProductionRate();

        const upgrade = this.info.upgrade;
        if (this.level === 1) {
            this.upgradePrice = bigInt(upgrade.base);
            this._calculateNextBigUpgradeLevel();
            this._applyPuzzleBonusAfterConstruction();
        } else {
            this.upgradePrice = this.upgradePrice.multiply(Math.trunc(upgrade.scale * 100)).divide(100);

            if (this.level === this.nextBigUpgradeLevel) {
                const bonus = this._getBigUpgradeLevelBonus();

                this._applyBonus(bonus);
                this._calculateNextBigUpgradeLevel();

                eventManager.macroUpgraded(this, bonus);
            }

            if (!this.savedProgress.lastTokensGetLevel || this.level > this.savedProgress.lastTokensGetLevel) {
                const tokens = GameData.getTokensForSlotLevelUp(this.level);
                if (tokens) {
                    const info = GameData.getTokensInfoForWorld(this.world_id);
                    if (info) {
                        this.savedProgress.lastTokensGetLevel = this.level;
                        const type = info.tokenType;
                        gameInit.progress.tokensEarned(type, tokens);
                        eventManager.photoTokensEarnedFromBuilding(this, type);
                    } else
                        console.error("no info for tokens in the world " + this.world_id);
                }
            }
            eventManager.buildingUpgraded(this, this.id);
        }

        this.update = Progress.getTimeNow();

        this.savedProgress.level = this.level;
        this.savedProgress.upgradePrice = this.upgradePrice.toString();
        this._saveState();

        this.onUpgraded.callListeners(this);

        achsManager.slotWasUpgraded(this);

        if (this.unlocked) {
            this.unlocked = false;
            this.onUnlockChanged.callListeners(this);
        }
    }

    guardWasChanged() {
        if (this.getLevel() > 0) {
            this._saveState();
            this._updateFinalProductionRate();
        }
    }

    _updateFinalProductionRate() {
        let seedsBonus = gameInit.progress.getTotalSeedsBonus();
        this.finalProduction = this.info.production.base.multiply(this.getLevel()).multiply(this.bonus_MultiProfit);

        if (gameInit.guardManager) {
            seedsBonus += gameInit.guardManager.getSeedsBonusForWorld(this.world_id);//that doesn't work right
            const guardMultiplier = gameInit.guardManager.getProfitMultiplier(this.world_id);
            // console.log("ADD BONUS " + this.world_id + " > " + gameInit.guardManager.getSeedsBonusForWorld(this.world_id) + " GUARD " + guardMultiplier + " >> " + this.finalProduction);
            if (guardMultiplier > 0)
                this.finalProduction = this.finalProduction.multiply(guardMultiplier + 100).divide(100);
        }

        this.finalProduction = this.finalProduction.multiply(seedsBonus);

        if (this.getLikes() > 0)
            this.finalProduction = this.finalProduction.multiply(100 + this.getLikes() * BONUS_PER_LIKE).divide(100);
    }

    getProductionForLevel(level) {
        const seedsBonus = gameInit.progress.getTotalSeedsBonus();
        return this.info.production.base.multiply(level).multiply(seedsBonus).multiply(this.bonus_MultiProfit);
    }

    _applyBonus(bonus) {
        switch (bonus.upgradeType) {
            case 'SpeedUp':
                this.bonus_SpeedUp *= bonus.parameter;
                this.savedProgress.speedUpMultiplier = this.bonus_SpeedUp;
                break;
            case 'MultiProfit':
                this.bonus_MultiProfit = this.bonus_MultiProfit.multiply(bonus.parameter);
                if (bonus.div_parameter)
                    this.bonus_MultiProfit = this.bonus_MultiProfit.divide(bonus.div_parameter);
                this.savedProgress.multiProfitMultiplier = this.bonus_MultiProfit.toString();
                this._updateFinalProductionRate();
                break;
            case 'AutoClick':
                this.savedProgress.hasAutoClick = this.autoCollect = true;
                break;
            case 'TimeTravel':
                this.updateBuilding(bonus.parameter);
                break;
            case 'Upgrade':
                if (this.getLevel() > 0) {
                    for (let i = 0; i < bonus.parameter; i++) {
                        this.upgradeBuilding(true);
                    }
                }
                break;
            //TODO implement those:
            case 'SuperSeed':
            case 'SeedProc':
        }
        this._saveState();
    }

    upgradePurchased(data) {
        if (data.slotNumber >= 0 && data.slotNumber + 1 !== this.id)
            return;

        this._applyBonus(data);
    }

    getDropIcon() {
        return this.info.visual.drop;
    }

    getDropIconPath() {
        return "GoodsDrops/" + this.info.visual.drop + ".png";
    }

    getSmallIcon() {
        if (VisualData.getGameSettings().popup_images_from_drop)
            return this.getDropIcon();
        return this.info.visual.icon + "_small";
    }

    getSmallIconPath() {
        if (VisualData.getGameSettings().popup_images_from_drop)
            return this.getDropIconPath();
        return "GoodsSmallIcons/" + this.info.visual.icon + ".png";
    }

    getBigIcon() {
        return this.info.visual.icon + "_big";
    }

    getBigIconScale() {//remove this hardcode
        return AllGetParams.game_platform === "nutaku" && this.id === 5 ? 0.8 : 1;
    }

    getBigIconPath() {
        return "GoodsBuyWindowIcons/" + this.info.visual.icon + ".png"; //TODO Optimize ... do we need them?
    }

    getLocalizationKey() {
        if (VisualData.getGameSettings().nameForLocalization)
            return this.info.name;
        return this.info.visual.icon.substring(0, this.info.visual.icon.length - 5);
    }
}

class World {
    constructor(logic, key) {
        this.onUpdateWorld = new UnnyAction();
        this.onBuildingCreated = new UnnyAction();
        this.onBuildingUpgraded = new UnnyAction();
        this.onBuildingPreUpgrade = new UnnyAction();
        this.onResourcesUpdated = new UnnyAction();
        this.onBuildingUpdated = new UnnyAction();
        this.onBuildingLiked = new UnnyAction();
        this.onResourcesCollected = new UnnyAction();
        this.onUpgradePurchased = new UnnyAction();
        this.onReseted = new UnnyAction();
        this.id = key;

        logic.update.addListener(this.update.bind(this));
        logic.reseted.addListener(this.resetWorld.bind(this));
    }

    upgradePurchased(data) {
        this.onUpgradePurchased.callListeners(data);
    }

    loadProgress(progress) {
        const buildings = progress.getBuildingsForWorld(this.id);

        const nowtime = Progress.getTimeNow();
        this.allBuildings = {};
        for (let key in buildings) {
            const prog = buildings[key];
            // const data = new BuildingData(GameData.getBuildingInfoByPlace(prog.name));
            const building = this.createBuilding(GameData.getBuildingInfoBySlot(prog.slot), prog.slot, key);
            building.loadProgress(prog, progress, nowtime);
            this.onBuildingCreated.callListeners(this, building);
            this.allBuildings[key] = building;
        }

        progress.onGuardWasChanged.addListener(this.guardWasChanged.bind(this));
        eventManager.onGuardLeveledUp.addListener(this.guardLeveledUp.bind(this));
    }

    guardLeveledUp(guard) {
        if (gameInit.guardManager.doesWorldHasGuard(this.id, guard)) {
            for (let i in this.allBuildings)
                this.allBuildings[i].guardWasChanged(guard);
        }
    }

    guardWasChanged(worldId, guardInfo) {
        if (this.id == worldId) {
            for (let i in this.allBuildings)
                this.allBuildings[i].guardWasChanged(guardInfo);
        }
    }

    getBuildingById(id) {
        return this.allBuildings[id];
    }

    resetWorld(progress) {
        const buildings = progress.getBuildingsForWorld(this.id);
        this.onReseted.callListeners(progress, buildings);
    }

    isSelected() {
        return this.id == gameInit.selectedWorld;
    }

    createBuilding(data, slot, key) {
        const building = new Building(data, slot, key, this.id);
        this.onUpdateWorld.addListener(building.updateBuilding.bind(building));
        this.onUpgradePurchased.addListener(building.upgradePurchased.bind(building));
        this.onReseted.addListener(building.reseted.bind(building));
        building.world = this;
        building.onResourcesCollected.addListener(this.resourcesCollected.bind(this));
        building.onUpgraded.addListener(this.buildingUpgraded.bind(this));
        building.onPreUpgrade.addListener(this.buildingPreUpgrade.bind(this));
        building.onResourcesUpdated.addListener(this.resourcesUpdate.bind(this));
        building.onBuildingUpdated.addListener(this.buildingUpdated.bind(this));
        building.onLiked.addListener(this.buildingLiked.bind(this));
        return building;
    }

    buildingPreUpgrade(building) {
        this.onBuildingPreUpgrade.callListeners(this, building);
    }

    buildingUpgraded(building) {
        this.onBuildingUpgraded.callListeners(this, building);
    }

    resourcesUpdate(building) {
        this.onResourcesUpdated.callListeners(this, building);
    }

    buildingUpdated(building) {
        this.onBuildingUpdated.callListeners(this, building);
    }

    buildingLiked(building) {
        this.onBuildingLiked.callListeners(this, building);
    }

    resourcesCollected(building, resources) {
        this.onResourcesCollected.callListeners(building, resources);
    }

    update(deltaTime) {
        this.onUpdateWorld.callListeners(deltaTime);
    };
}

const BanjoDuration = VisualData.getGameSettings().banjo_duration || 7;
const GuardDurationHours = 4;
const SpinsResporeTime = 8 * 3600 * 1000;
const AdsAvailableToWatchADay = 5;
const MAX_PUZZLE_LEVEL = 5;
const JACKPOT_SIZE = 5;
const JACKPOT_INCREASE = 2;
const GEMS_PRICE_FOR_WHEEL_SPIN = 5;
const LIKES_RESET_TIMER = 3 * 24 * 3600 * 1000;

const BoxType = {
    GoldBox: "0",
    GemsBox: "1",
    SuperBox: "2",
    GuardBox: "3",
    GuardSuperBox: "4"
};

const MUSIC_STATE = "MUSIC_STATE";
const SOUNDS_STATE = "SOUNDS_STATE";
const CURRENT_LANGUAGE = "CURRENT_LANGUAGE";
const GAME_VERSION = "0.9.36";

console.log("game version: " + GAME_VERSION);

let LockAllSounds = false;

var ua = navigator.userAgent.toLowerCase();
if (ua.indexOf('safari') != -1) {
    if (ua.indexOf('chrome') > -1) {
    } else {
        LockAllSounds = true;
    }
}

const GameSettings = {
    musicOff: localStorage.getItem(MUSIC_STATE) || LockAllSounds,
    soundsOff: localStorage.getItem(SOUNDS_STATE) || LockAllSounds,
    language: localStorage.getItem(CURRENT_LANGUAGE),
    allLanguages: {},
};

if (!GameSettings.language)
    GameSettings.language = AllGetParams.game_platform === 'ok' || AllGetParams.game_platform === 'vk' ? "Russian" : "English";

const COLLECTION_NAME = "General";
const COLLECTION_KEY_NAME = "PlayerInfo";

function SetMusicState(state) {
    GameSettings.musicOff = !state || LockAllSounds;
    if (GameSettings.musicOff) {
        localStorage.setItem(MUSIC_STATE, "true");
        audioManager.stopMusic();
    }
    else {
        localStorage.removeItem(MUSIC_STATE);
        audioManager.restoreMusic();
    }
}

function SetSoundsState(state) {
    GameSettings.soundsOff = !state || LockAllSounds;
    if (GameSettings.soundsOff)
        localStorage.setItem(SOUNDS_STATE, "true");
    else
        localStorage.removeItem(SOUNDS_STATE);
}

function SetCurrentLanguage(language) {
    GameSettings.language = language;
    localStorage.setItem(CURRENT_LANGUAGE, language);

    if (GameSettings.allLanguages.hasOwnProperty(GameSettings.language)) {
        LocalizationManager.initWithJson(GameSettings.allLanguages[GameSettings.language]);
        guiManager.localize();
    }
    else {
        const localization = 'Localization_' + GameSettings.language;
        LoadFile(gameInit.engine, localization, VisualData.getLocalizationsFolder() + localization + ".json", () => {
            const json = gameInit.engine.cache.json.get(localization);
            GameSettings.allLanguages[GameSettings.language] = json;
            SetCurrentLanguage(GameSettings.language);
        }, UnnyObjectType.Json);
    }
}

function getCheatSave() {
    //return JSON.parse("{\"adsWatched\":{\"count\":1,\"update\":1569247674763},\"dailyBonus\":{\"lastBonus\":3,\"seed\":0,\"update\":1569730763737},\"fortuneWheel\":{\"freeSpins\":3,\"jackpot\":1100,\"update\":1569441129919,\"windowOpened\":false},\"guard\":1569432762778,\"profile\":{\"adsWatched\":{\"count\":0,\"update\":0},\"firstTimeInGame\":1569247268842,\"gameLanguage\":\"English\",\"gems\":\"58900\",\"gemsMultiProfit\":\"1\",\"gold\":\"36657990917283939917387\",\"goldSpent\":\"27440626749785127227002781\",\"harvestsCount\":2,\"maxGoldModifier\":9,\"savedVersion\":131,\"seeds\":\"73900\",\"seedsStrength\":7,\"sessionNumber\":15,\"tutorialPhase\":15,\"version\":8},\"purchases\":{\"6\":1,\"7\":1,\"23\":1,\"24\":1,\"25\":1,\"26\":1,\"27\":1,\"28\":1,\"29\":1,\"30\":1,\"31\":1,\"32\":1,\"33\":1,\"34\":1,\"35\":1,\"36\":1,\"37\":1,\"38\":1,\"39\":1,\"40\":1,\"41\":1,\"42\":1,\"43\":1,\"44\":1,\"45\":1,\"47\":1,\"48\":1,\"49\":1,\"50\":1,\"51\":1,\"52\":1,\"53\":1,\"54\":1,\"55\":1,\"56\":1,\"57\":1,\"58\":1,\"60\":1,\"61\":1,\"62\":1},\"puzzle\":{\"boxes\":{\"0\":19,\"1\":0,\"2\":0,\"3\":0,\"4\":0},\"goldBoxPrice\":\"348678440100000000000000\",\"goods\":{\"0\":{\"id\":1,\"level\":1,\"pieces\":0},\"1\":{\"id\":2,\"level\":1,\"pieces\":0},\"2\":{\"id\":3,\"level\":1,\"pieces\":0},\"3\":{\"id\":4,\"level\":1,\"pieces\":0},\"4\":{\"id\":5,\"level\":1,\"pieces\":0},\"5\":{\"id\":6,\"level\":1,\"pieces\":0},\"6\":{\"id\":7,\"level\":1,\"pieces\":0},\"7\":{\"id\":8,\"level\":1,\"pieces\":0},\"8\":{\"id\":9,\"level\":1,\"pieces\":0},\"9\":{\"id\":10,\"level\":0,\"pieces\":0},\"10\":{\"id\":11,\"level\":0,\"pieces\":0},\"11\":{\"id\":12,\"level\":0,\"pieces\":0},\"12\":{\"id\":13,\"level\":0,\"pieces\":4},\"13\":{\"id\":14,\"level\":0,\"pieces\":0},\"14\":{\"id\":15,\"level\":0,\"pieces\":4},\"15\":{\"id\":16,\"level\":0,\"pieces\":0},\"16\":{\"id\":17,\"level\":0,\"pieces\":0},\"17\":{\"id\":18,\"level\":0,\"pieces\":0},\"18\":{\"id\":19,\"level\":0,\"pieces\":0},\"19\":{\"id\":20,\"level\":0,\"pieces\":0},\"20\":{\"id\":21,\"level\":0,\"pieces\":0},\"21\":{\"id\":22,\"level\":0,\"pieces\":0},\"22\":{\"id\":23,\"level\":0,\"pieces\":0},\"23\":{\"id\":24,\"level\":0,\"pieces\":0},\"24\":{\"id\":25,\"level\":0,\"pieces\":8},\"25\":{\"id\":26,\"level\":0,\"pieces\":8},\"26\":{\"id\":27,\"level\":0,\"pieces\":0}},\"openedBox\":5},\"quests\":{\"activeQuests\":{\"0\":{\"id\":6,\"level\":1,\"progress\":0,\"isRefreshed\":false,\"isComplete\":false},\"1\":{\"id\":7,\"level\":2,\"progress\":0,\"isRefreshed\":false,\"isComplete\":false},\"2\":{\"id\":9,\"level\":1,\"progress\":0,\"isRefreshed\":false,\"isComplete\":false}},\"update\":1569742270536},\"worlds\":{\"1\":{\"buildings\":{\"1\":{\"hasAutoClick\":true,\"level\":1,\"loading\":0.047000000018891264,\"multiProfitMultiplier\":\"1944\",\"resources\":\"54132300\",\"slot\":1,\"speedUpMultiplier\":8,\"update\":1569730785075,\"upgradePrice\":\"300\"},\"2\":{\"hasAutoClick\":true,\"level\":1,\"loading\":0.3490000000074218,\"multiProfitMultiplier\":\"5832\",\"resources\":\"387828000\",\"slot\":2,\"speedUpMultiplier\":8,\"update\":1569730785075,\"upgradePrice\":\"6000\"},\"3\":{\"hasAutoClick\":true,\"level\":1,\"loading\":0.8899999999967063,\"multiProfitMultiplier\":\"5832\",\"resources\":\"1994544000\",\"slot\":3,\"speedUpMultiplier\":8,\"update\":1569730785075,\"upgradePrice\":\"72000\"},\"4\":{\"hasAutoClick\":true,\"level\":1,\"loading\":4.904999999993551,\"multiProfitMultiplier\":\"5832\",\"resources\":\"10206000000\",\"slot\":4,\"speedUpMultiplier\":8,\"update\":1569730785275,\"upgradePrice\":\"4200000\"},\"5\":{\"hasAutoClick\":true,\"level\":1,\"loading\":22.024999999993895,\"multiProfitMultiplier\":\"1944\",\"resources\":\"123373530000000\",\"slot\":5,\"speedUpMultiplier\":8,\"update\":1569730785075,\"upgradePrice\":\"210000000\"},\"6\":{\"level\":71,\"loading\":2.5770000000000053,\"multiProfitMultiplier\":\"648\",\"resources\":\"1349019360000000\",\"slot\":6,\"speedUpMultiplier\":32,\"update\":1569730809917,\"upgradePrice\":\"609998032155439650965760\",\"hasAutoClick\":true},\"7\":{\"level\":65,\"loading\":1.024000000000001,\"multiProfitMultiplier\":\"648\",\"resources\":\"6943060800000000\",\"slot\":7,\"speedUpMultiplier\":32,\"update\":1569730800207,\"upgradePrice\":\"11157940587993629198663912\",\"hasAutoClick\":true},\"8\":{\"level\":0,\"loading\":0,\"multiProfitMultiplier\":\"72\",\"resources\":\"0\",\"slot\":8,\"speedUpMultiplier\":8,\"update\":1569730785075,\"upgradePrice\":\"0\"},\"9\":{\"level\":1,\"loading\":11.908999999999992,\"multiProfitMultiplier\":\"72\",\"resources\":\"0\",\"slot\":9,\"speedUpMultiplier\":8,\"update\":1569730785075,\"upgradePrice\":\"888000000000\",\"hasAutoClick\":true}}},\"2\":{\"buildings\":{\"1\":{\"hasAutoClick\":true,\"level\":0,\"loading\":0,\"multiProfitMultiplier\":\"1944\",\"resources\":\"0\",\"slot\":10,\"speedUpMultiplier\":8,\"update\":1569730785075,\"upgradePrice\":\"0\"},\"2\":{\"hasAutoClick\":true,\"level\":0,\"loading\":0,\"multiProfitMultiplier\":\"5832\",\"resources\":\"0\",\"slot\":11,\"speedUpMultiplier\":8,\"update\":1569730785075,\"upgradePrice\":\"0\"},\"3\":{\"hasAutoClick\":true,\"level\":0,\"loading\":0,\"multiProfitMultiplier\":\"5832\",\"resources\":\"0\",\"slot\":12,\"speedUpMultiplier\":8,\"update\":1569730785075,\"upgradePrice\":\"0\"},\"4\":{\"hasAutoClick\":true,\"level\":0,\"loading\":0,\"multiProfitMultiplier\":\"5832\",\"resources\":\"0\",\"slot\":13,\"speedUpMultiplier\":8,\"update\":1569730785275,\"upgradePrice\":\"0\"},\"5\":{\"hasAutoClick\":true,\"level\":0,\"loading\":0,\"multiProfitMultiplier\":\"1944\",\"resources\":\"0\",\"slot\":14,\"speedUpMultiplier\":8,\"update\":1569730785075,\"upgradePrice\":\"0\"},\"6\":{\"level\":0,\"loading\":0,\"multiProfitMultiplier\":\"648\",\"resources\":\"0\",\"slot\":15,\"speedUpMultiplier\":8,\"update\":1569730785075,\"upgradePrice\":\"0\",\"hasAutoClick\":true},\"7\":{\"level\":0,\"loading\":0,\"multiProfitMultiplier\":\"648\",\"resources\":\"0\",\"slot\":16,\"speedUpMultiplier\":8,\"update\":1569730785075,\"upgradePrice\":\"0\",\"hasAutoClick\":true},\"8\":{\"level\":0,\"loading\":0,\"multiProfitMultiplier\":\"72\",\"resources\":\"0\",\"slot\":17,\"speedUpMultiplier\":8,\"update\":1569730785075,\"upgradePrice\":\"0\"},\"9\":{\"level\":0,\"loading\":0,\"multiProfitMultiplier\":\"72\",\"resources\":\"0\",\"slot\":18,\"speedUpMultiplier\":8,\"update\":1569730785075,\"upgradePrice\":\"0\",\"hasAutoClick\":true}}},\"3\":{\"buildings\":{\"1\":{\"hasAutoClick\":true,\"level\":0,\"loading\":0,\"multiProfitMultiplier\":\"1944\",\"resources\":\"0\",\"slot\":19,\"speedUpMultiplier\":8,\"update\":1569730785075,\"upgradePrice\":\"0\"},\"2\":{\"hasAutoClick\":true,\"level\":0,\"loading\":0,\"multiProfitMultiplier\":\"5832\",\"resources\":\"0\",\"slot\":20,\"speedUpMultiplier\":8,\"update\":1569730785075,\"upgradePrice\":\"0\"},\"3\":{\"hasAutoClick\":true,\"level\":0,\"loading\":0,\"multiProfitMultiplier\":\"5832\",\"resources\":\"0\",\"slot\":21,\"speedUpMultiplier\":8,\"update\":1569730785075,\"upgradePrice\":\"0\"},\"4\":{\"hasAutoClick\":true,\"level\":0,\"loading\":0,\"multiProfitMultiplier\":\"5832\",\"resources\":\"0\",\"slot\":22,\"speedUpMultiplier\":8,\"update\":1569730785275,\"upgradePrice\":\"0\"},\"5\":{\"hasAutoClick\":true,\"level\":0,\"loading\":0,\"multiProfitMultiplier\":\"1944\",\"resources\":\"0\",\"slot\":23,\"speedUpMultiplier\":8,\"update\":1569730785075,\"upgradePrice\":\"0\"},\"6\":{\"level\":0,\"loading\":0,\"multiProfitMultiplier\":\"648\",\"resources\":\"0\",\"slot\":24,\"speedUpMultiplier\":8,\"update\":1569730785075,\"upgradePrice\":\"0\",\"hasAutoClick\":true},\"7\":{\"level\":0,\"loading\":0,\"multiProfitMultiplier\":\"648\",\"resources\":\"0\",\"slot\":25,\"speedUpMultiplier\":8,\"update\":1569730785075,\"upgradePrice\":\"0\",\"hasAutoClick\":true},\"8\":{\"level\":0,\"loading\":0,\"multiProfitMultiplier\":\"72\",\"resources\":\"0\",\"slot\":26,\"speedUpMultiplier\":8,\"update\":1569730785075,\"upgradePrice\":\"0\"},\"9\":{\"level\":0,\"loading\":0,\"multiProfitMultiplier\":\"72\",\"resources\":\"0\",\"slot\":27,\"speedUpMultiplier\":8,\"update\":1569730785075,\"upgradePrice\":\"0\",\"hasAutoClick\":true}}}}}");
    return JSON.parse("{\"profile\":{\"version\":10,\"gold\":\"999999\",\"gems\":\"19134630360\",\"seeds\":\"4200\",\"tokenCommon\":\"0\",\"tokenRare\":\"000\",\"tokenEpic\":\"000\",\"goldSpent\":\"27542\",\"seedsStrength\":2,\"firstTimeInGame\":1575878313354,\"tutorialPhase\":22,\"maxGoldModifier\":4,\"gameLanguage\":\"English\",\"sessionNumber\":2,\"harvestsCount\":1,\"lastHarvestTime\":1575894384306,\"gemsMultiProfit\":\"1\",\"adsWatched\":{\"count\":0,\"update\":0},\"lastDoubleTime\":0,\"level\":2,\"experience\":82,\"expToNextLevel\":114.99999999999999,\"savedVersion\":109},\"purchases\":{\"6\":1},\"fortuneWheel\":{\"freeSpins\":1,\"windowOpened\":false,\"jackpot\":500,\"update\":0},\"puzzle\":{\"boxes\":{\"0\":4,\"1\":6,\"2\":0,\"3\":0,\"4\":0},\"goods\":[{\"id\":1,\"level\":1,\"pieces\":0},{\"id\":2,\"level\":1,\"pieces\":0},{\"id\":3,\"level\":1,\"pieces\":0},{\"id\":4,\"level\":1,\"pieces\":0},{\"id\":5,\"level\":1,\"pieces\":0},{\"id\":6,\"level\":1,\"pieces\":0},{\"id\":7,\"level\":1,\"pieces\":0},{\"id\":8,\"level\":1,\"pieces\":0},{\"id\":9,\"level\":1,\"pieces\":0},{\"id\":10,\"level\":0,\"pieces\":0},{\"id\":11,\"level\":0,\"pieces\":0},{\"id\":12,\"level\":0,\"pieces\":0},{\"id\":13,\"level\":0,\"pieces\":0},{\"id\":14,\"level\":0,\"pieces\":0},{\"id\":15,\"level\":0,\"pieces\":0},{\"id\":16,\"level\":0,\"pieces\":0},{\"id\":17,\"level\":0,\"pieces\":0},{\"id\":18,\"level\":0,\"pieces\":0},{\"id\":19,\"level\":0,\"pieces\":0},{\"id\":20,\"level\":0,\"pieces\":0},{\"id\":21,\"level\":0,\"pieces\":0},{\"id\":22,\"level\":0,\"pieces\":0},{\"id\":23,\"level\":0,\"pieces\":1},{\"id\":24,\"level\":0,\"pieces\":0},{\"id\":25,\"level\":0,\"pieces\":0},{\"id\":26,\"level\":0,\"pieces\":0},{\"id\":27,\"level\":0,\"pieces\":0}],\"guards\":[{\"id\":1,\"level\":1,\"pieces\":0},{\"id\":2,\"level\":0,\"pieces\":0},{\"id\":3,\"level\":0,\"pieces\":0},{\"id\":4,\"level\":0,\"pieces\":0},{\"id\":5,\"level\":0,\"pieces\":0},{\"id\":6,\"level\":0,\"pieces\":0}],\"openedBox\":1,\"goldBoxPrice\":\"100000000000000\"},\"worlds\":{\"1\":{\"buildings\":{\"1\":{\"slot\":1,\"level\":15,\"resources\":\"0\",\"multiProfitMultiplier\":\"3\",\"lastTokensGetLevel\":100,\"upgradePrice\":\"1128\",\"loading\":0,\"update\":1575898766336},\"2\":{\"slot\":2,\"level\":3,\"resources\":\"0\",\"multiProfitMultiplier\":\"3\",\"lastTokensGetLevel\":25,\"upgradePrice\":\"8640\",\"loading\":0,\"update\":1575898752021},\"3\":{\"slot\":3,\"level\":0,\"resources\":\"0\",\"multiProfitMultiplier\":\"3\",\"upgradePrice\":\"0\",\"loading\":0,\"update\":1575898735002},\"4\":{\"slot\":4,\"level\":0,\"resources\":\"0\",\"multiProfitMultiplier\":\"3\",\"upgradePrice\":\"0\",\"loading\":0,\"update\":1575898735002},\"5\":{\"slot\":5,\"level\":0,\"resources\":\"0\",\"multiProfitMultiplier\":\"3\",\"upgradePrice\":\"0\",\"loading\":0,\"update\":1575898735002},\"6\":{\"slot\":6,\"level\":0,\"resources\":\"0\",\"multiProfitMultiplier\":\"3\",\"upgradePrice\":\"0\",\"loading\":0,\"update\":1575898735002},\"7\":{\"slot\":7,\"level\":0,\"resources\":\"0\",\"multiProfitMultiplier\":\"3\",\"upgradePrice\":\"0\",\"loading\":0,\"update\":1575898735002},\"8\":{\"slot\":8,\"level\":0,\"resources\":\"0\",\"multiProfitMultiplier\":\"3\",\"upgradePrice\":\"0\",\"loading\":0,\"update\":1575898735002},\"9\":{\"slot\":9,\"level\":0,\"resources\":\"0\",\"multiProfitMultiplier\":\"3\",\"upgradePrice\":\"0\",\"loading\":0,\"update\":1575898735002}},\"guards\":{\"1\":{\"id\":1}}},\"2\":{\"buildings\":{\"1\":{\"slot\":10,\"level\":0,\"resources\":\"0\",\"multiProfitMultiplier\":\"3\",\"upgradePrice\":\"0\",\"loading\":0,\"update\":1575898735002},\"2\":{\"slot\":11,\"level\":0,\"resources\":\"0\",\"multiProfitMultiplier\":\"3\",\"upgradePrice\":\"0\",\"loading\":0,\"update\":1575898735002},\"3\":{\"slot\":12,\"level\":0,\"resources\":\"0\",\"multiProfitMultiplier\":\"3\",\"upgradePrice\":\"0\",\"loading\":0,\"update\":1575898735002},\"4\":{\"slot\":13,\"level\":0,\"resources\":\"0\",\"multiProfitMultiplier\":\"3\",\"upgradePrice\":\"0\",\"loading\":0,\"update\":1575898735002},\"5\":{\"slot\":14,\"level\":0,\"resources\":\"0\",\"multiProfitMultiplier\":\"3\",\"upgradePrice\":\"0\",\"loading\":0,\"update\":1575898735002},\"6\":{\"slot\":15,\"level\":0,\"resources\":\"0\",\"multiProfitMultiplier\":\"3\",\"upgradePrice\":\"0\",\"loading\":0,\"update\":1575898735002},\"7\":{\"slot\":16,\"level\":0,\"resources\":\"0\",\"multiProfitMultiplier\":\"3\",\"upgradePrice\":\"0\",\"loading\":0,\"update\":1575898735002},\"8\":{\"slot\":17,\"level\":0,\"resources\":\"0\",\"multiProfitMultiplier\":\"3\",\"upgradePrice\":\"0\",\"loading\":0,\"update\":1575898735002},\"9\":{\"slot\":18,\"level\":0,\"resources\":\"0\",\"multiProfitMultiplier\":\"3\",\"upgradePrice\":\"0\",\"loading\":0,\"update\":1575898735002}},\"guards\":{\"1\":{\"id\":1}}},\"3\":{\"buildings\":{\"1\":{\"slot\":19,\"level\":0,\"resources\":\"0\",\"multiProfitMultiplier\":\"3\",\"upgradePrice\":\"0\",\"loading\":0,\"update\":1575898735002},\"2\":{\"slot\":20,\"level\":0,\"resources\":\"0\",\"multiProfitMultiplier\":\"3\",\"upgradePrice\":\"0\",\"loading\":0,\"update\":1575898735002},\"3\":{\"slot\":21,\"level\":0,\"resources\":\"0\",\"multiProfitMultiplier\":\"3\",\"upgradePrice\":\"0\",\"loading\":0,\"update\":1575898735002},\"4\":{\"slot\":22,\"level\":0,\"resources\":\"0\",\"multiProfitMultiplier\":\"3\",\"upgradePrice\":\"0\",\"loading\":0,\"update\":1575898735002},\"5\":{\"slot\":23,\"level\":0,\"resources\":\"0\",\"multiProfitMultiplier\":\"3\",\"upgradePrice\":\"0\",\"loading\":0,\"update\":1575898735002},\"6\":{\"slot\":24,\"level\":0,\"resources\":\"0\",\"multiProfitMultiplier\":\"3\",\"upgradePrice\":\"0\",\"loading\":0,\"update\":1575898735002},\"7\":{\"slot\":25,\"level\":0,\"resources\":\"0\",\"multiProfitMultiplier\":\"3\",\"upgradePrice\":\"0\",\"loading\":0,\"update\":1575898735002},\"8\":{\"slot\":26,\"level\":0,\"resources\":\"0\",\"multiProfitMultiplier\":\"3\",\"upgradePrice\":\"0\",\"loading\":0,\"update\":1575898735002},\"9\":{\"slot\":27,\"level\":0,\"resources\":\"0\",\"multiProfitMultiplier\":\"3\",\"upgradePrice\":\"0\",\"loading\":0,\"update\":1575898735002}},\"guards\":{\"1\":{\"id\":1}}}},\"quests\":{\"activeQuests\":[{\"id\":9,\"level\":1,\"progress\":0,\"isRefreshed\":false,\"isComplete\":false},{\"id\":5,\"level\":1,\"progress\":0,\"isRefreshed\":false,\"isComplete\":false},{\"id\":3,\"level\":2,\"progress\":0,\"isRefreshed\":false,\"isComplete\":false}],\"update\":1576313933950},\"dailyBonus\":{\"seed\":0,\"update\":1575878408290,\"lastBonus\":1},\"photo_quests\":{\"unlocked\":[\"PeriSkirt1\",\"PeriSkirt2\"],\"quests\":[{\"photoId\":\"PeriSkirt3\",\"progress\":5,\"isComplete\":false},{\"photoId\":\"DryadTailPlay1\",\"progress\":5,\"isComplete\":false},{\"photoId\":\"DryadTailPlay2\",\"progress\":5,\"isComplete\":false},{\"photoId\":\"DryadTailPlay3\",\"progress\":5,\"isComplete\":false},{\"photoId\":\"AphroditeGrapes1\",\"progress\":5,\"isComplete\":false},{\"photoId\":\"AphroditeGrapes2\",\"progress\":5,\"isComplete\":false},{\"photoId\":\"AphroditeGrapes3\",\"progress\":5,\"isComplete\":false}]}}");
}

function fixArray(obj) {
    if (Array.isArray(obj))
        return obj;

    const arr = [];
    for (var key in obj) {
        arr[parseInt(key)] = obj[key];
    }

    return arr;
}

class PlayerInfo {
    constructor(data, progress) {
        this.progress = progress;
        this.profile = progress.savedProgress.profile;

        this.nextLevelMultiplier = data.nextLevelMultiplier;
        this.expByOneCollecting = data.expByOneCollecting;
        this.expCollectDelay = data.expCollectDelay * 1000;
        this.gemsLevelUpReward = data.gemsLevelUpReward * RESOURCES_SCALE;
        this.boxReward = data.boxReward;
        this.prestigeExpPercent = data.prestigeExpPercent;
        this.lastClickedTime = 0;

        //clickController.onBuildingClicked.addListener(this.buildingWasClicked.bind(this));
        eventManager.onBuildingUpgraded.addListener(this.buildingUpgraded.bind(this));
        eventManager.onHarvestCompleted.addListener(this.harvestCompleted.bind(this));

        if (!this.profile.level) {
            this.profile.level = 1;
            this.profile.experience = 0;
            this.profile.expToNextLevel = data.expForFirstLevelUp;
        }
    }

    _addExperience(exp) {
        this.profile.experience += exp;
        if (this.profile.experience >= this.profile.expToNextLevel) {
            this.profile.experience -= this.profile.expToNextLevel;
            this.profile.expToNextLevel *= this.nextLevelMultiplier;
            this.profile.level++;
            this.progress.giveChests(BoxType.GoldBox, this.boxReward);//save is here
        }
        this.progress.onExperienceChanges.callListeners();
    }

    harvestCompleted() {
        this._addExperience(Math.trunc(this.prestigeExpPercent * this.profile.expToNextLevel));
    }

    buildingUpgraded() {
        this._addExperience(this.expByOneCollecting);
    }

    buildingWasClicked() {
        const time = Progress.getTimeNow();
        if (time - this.lastClickedTime >= this.expCollectDelay) {
            this.lastClickedTime = time;

            this._addExperience(this.expByOneCollecting);
        }
    }

    getExpProgress() {
        return this.profile.experience / this.profile.expToNextLevel;
    }

    getLevel() {
        return this.profile.level;
    }
}

class Progress {
    constructor(gameInit, progress, gameConfig, useGoblin) {
        this.useGoblin = useGoblin;

        // gameInit.onBuildingCreated.addListener(this.buildingCreated.bind(this));
        gameInit.onResourcesCollected.addListener(this.resourcesCollected.bind(this));
        gameInit.onBuildingLiked.addListener(this.buildingLiked.bind(this));
        gameInit.update.addListener(this.update.bind(this));
        this.onResourcesChanges = new UnnyAction();
        this.onExperienceChanges = new UnnyAction();
        this.onUpgradePurchased = new UnnyAction();

        //const localProgress = useGoblin ? this.loadProgress() : null;
        const localProgress = this.loadProgress();
        let save = progress;
        let localSaveUsed = false;
        if (!progress) {
            save = localProgress;
            localSaveUsed = true;
            console.log("no server progress -> use local")
        } else {
            if (localProgress) {
                const lp = localProgress.profile.savedVersion;
                const sp = progress.profile.savedVersion;
                console.log("server progress version: " + sp + " ; local version = " + lp);
                if (lp && (!sp || lp >= sp)) {
                    save = localProgress;
                    localSaveUsed = true;
                    gameAnalytics.sendServerError({
                            code: -1,
                            message: "Old Version (local: " + lp + '; server: ' + sp + " )"
                        }, "load_progress");
                }
            }
        }

        // console.info("SAVE: " + save.profile.tutorialPhase, save);
        if (save && save.profile && save.profile.version >= VisualData.getGameSettings().save_version) {
            this.savedProgress = save;
            this.savedProgress.profile.sessionNumber++;
            if (!localSaveUsed)
                this._getDeltaSave();
        }
        else {
            const startRes = gameConfig ? gameConfig.startResources : null;

            this.savedProgress = {
                profile: {
                    version: VisualData.getGameSettings().save_version,
                    gold: startRes ? startRes.gold.toString() + "00" : "0",//"00" = RESOURCES_SCALE
                    gems: startRes ? startRes.gems.toString() + "00" : "27500",
                    seeds: startRes ? startRes.prestige.toString() + "00" : "0",//prestige==seeds==cans==apples
                    tokenCommon: startRes ? startRes.tokenCommon.toString() + "00" : "0",
                    tokenRare: startRes ? startRes.tokenRare.toString() + "00" : "0",
                    tokenEpic: startRes ? startRes.tokenEpic.toString() + "00" : "0",
                    superDoublingToken: startRes ? startRes.superDoublingToken.toString() + "00" : "0",
                    goldSpent: "0",
                    seedsStrength: 2,
                    firstTimeInGame: Progress.getTimeNow(),
                    tutorialPhase: TutStartPhase,
                    maxGoldModifier: 0,
                    gameLanguage: "English",
                    sessionNumber: 1,
                    harvestsCount: 0,
                    lastHarvestTime: 0,
                    gemsMultiProfit: "1",
                    adsWatched: {
                        count: 0,
                        update: 0
                    },
                    lastDoubleTime: 0
                },
                tutorial: {
                    stepNumber: 0,
                    actionIndex: 0
                },
                purchases: {
                    //Id:key
                },
                fortuneWheel: {
                    freeSpins: 1,
                    windowOpened: false,
                    jackpot: JACKPOT_SIZE * RESOURCES_SCALE,
                    update: 0
                },
                puzzle: {
                    boxes: {
                        [BoxType.GoldBox]: 3,
                        [BoxType.GemsBox]: 0,
                        [BoxType.SuperBox]: 0,
                        [BoxType.GuardBox]: 0,
                        [BoxType.GuardSuperBox]: 0
                    },
                    goods: [],
                    guards: [],
                    openedBox: 0,
                    goldBoxPrice: "100000000000000"
                },
                worlds: {
                    1: {}
                },
                quests: {
                    activeQuests: [],
                    update: 0
                },
                dailyBonus: {
                    seed: 0,
                    update: 0,
                    lastBonus: 0
                }
            };

            this._resetConstructions();

            const puzzle = this.savedProgress.puzzle.goods;
            for (let i = 1; i <= 9; i++) {
                puzzle.push({
                    id: i,
                    level: 1,
                    pieces: 0
                });
            }

            for (let i = 10; i <= 27; i++) {
                puzzle.push({
                    id: i,
                    level: 0,
                    pieces: 0
                });
            }

            if (gBase && gBase.currentUnicorn)
                gBase.profile.setp(
                    this.savedProgress, null,
                    null, null, null, null,
                    (err) => {
                        if (err)
                            gameAnalytics.sendServerError(err, "setp");
                    }
                );

            this._getDeltaSave();
        }

        // this.savedProgress = getCheatSave();
        this.savedProgress.puzzle.goods = fixArray(this.savedProgress.puzzle.goods);
        // this.savedProgress.tutorial.stepNumber = TutPhases.TutorialEnd;
        // this._resetConstructions();
        // this._setResourceByName("tokenCommon", "99999900");
        // this._setResourceByName("gold", "999900");

        // this._setResourceByName("gems", "2000000");
        // this._setResourceByName("superDoublingToken", "1000");

        for (let i = 1; i <= VisualData.getWorldsCount(); i++) {
            if (!this.savedProgress.worlds.hasOwnProperty(i))
                this._resetWorld(i);
        }

        this.supervisor = {};

        this.general = {
            gold: bigInt(this._getResourceByName("gold")),
            seeds: bigInt(this._getResourceByName("seeds")),
            resourcesSpent: bigInt(this._getResourceByName("goldSpent")),
            gems: bigInt(this._getResourceByName("gems")),
            tokenCommon: bigInt(this._getResourceByName("tokenCommon")),
            tokenRare: bigInt(this._getResourceByName("tokenRare")),
            tokenEpic: bigInt(this._getResourceByName("tokenEpic")),
            superDoublingToken: bigInt(this._getResourceByName("superDoublingToken")),
            boxPrice: bigInt(this.savedProgress.puzzle.goldBoxPrice),
        };

        this.onPuzzlePeaceReceived = new UnnyAction();
        this.onPuzzleCompleted = new UnnyAction();
        this.onGuardPuzzleCompleted = new UnnyAction();
        this.onSeedsBonusChanged = new UnnyAction();
        this.onGuardWasChanged = new UnnyAction();

        this._updateTotalSeedsBonus();

        this.dailyBonusData = new DailyBonus(this.savedProgress.dailyBonus.seed, GameData.getLoginData());
        this.wheelOfFortune = new WheelOfFortune();

        this.lastSaveTime = Progress.getTimeNow();

        this.onResourcesChanges.addListener(this.saveProgress.bind(this));
        this.onPuzzlePeaceReceived.addListener(this.saveProgress.bind(this));
        this.onUpgradePurchased.addListener(this.saveProgress.bind(this));
    }

    _getResourceByName(name) {
        return this.savedProgress.profile[name] || 0;
    }

    getResourceByName(name) {
        return this.general[name];
    }

    _setResourceByName(name, value) {
        return this.savedProgress.profile[name] = value;
    }

    _resetWorld(worldId) {
        const oldWorld = this.savedProgress.worlds[worldId];
        const world = this.savedProgress.worlds[worldId] = {};
        const buildings = world['buildings'] = {};
        for (let i = 1; i <= 9; i++) {

            buildings[i] = {
                slot: i + (worldId - 1) * 9,
                level: 0,
                resources: "0",
                multiProfitMultiplier: this.savedProgress.profile.gemsMultiProfit,
            };

            //Copy value that don't get reset
            const oldBuilding = oldWorld && oldWorld.buildings ? oldWorld.buildings[i] : null;
            if (oldBuilding && oldBuilding.lastTokensGetLevel) {
                buildings[i].lastTokensGetLevel = oldBuilding.lastTokensGetLevel;
            }
        }
    }

    _resetConstructions() {
        for (let i = 1; i <= VisualData.getWorldsCount(); i++)
            this._resetWorld(i);
    }

    _updateTotalSeedsBonus() {
        if (this.general.seeds.compare(0) <= 0)
            this.general.seedsBonus = bigInt(1);
        else
            this.general.seedsBonus = this.general.seeds.multiply(this.savedProgress.profile.seedsStrength).divide(100 * RESOURCES_SCALE).add(1);
        // console.log("APPLES " + this.savedProgress.general.seedsBonus + " * "+ this.general.seeds + " = " + this.general.seedsBonus);
        this.onSeedsBonusChanged.callListeners(this.getTotalSeedsBonus());
    }

    static getTimeNow() {
        return Math.trunc(new Date().getTime());
    }

    static getDayNow() {
        return Math.trunc(this.getTimeNow() / (24 * 3600 * 1000));
    }

    static getDayFromTime(time) {
        return Math.trunc(time / (24 * 3600 * 1000));
        // return Math.trunc(Progress.getTimeNow() / (10));
    }

    getFortuneData() {
        return this.wheelOfFortune;
    }

    getDailyBonusData() {
        return this.dailyBonusData;
    }

    getMyDailyBonusInfo() {
        return this.savedProgress.dailyBonus;
    }

    getGuardEndTime() {
        return this.savedProgress.guard;
    }

    getGuardTimeLeft() {
        return this.getGuardEndTime() - Progress.getTimeNow();
    }

    isSupervisorActive() {
        return Progress.getTimeNow() < this.supervisor;
    }

    isGuardActive() {
        return Progress.getTimeNow() < this.savedProgress.guard;
    }

    getGuardMultiplier() {
        return this.isUpgradePurchased('hellprod.offer1') ? 3 : 2;
    }

    getTotalSeedsBonus() {
        return this.general.seedsBonus;
    }

    getBonusPerSeed() {
        return this.savedProgress.profile.seedsStrength;
    }

    getPuzzlesCountForId(id) {
        const info = this.getPuzzleInfoById(id);
        const size = GameData.getPuzzleSizePerLevel(info.level);
        let count = 0;
        for (let i = 0; i < size * size; i++) {
            if ((info.pieces & (1 << i)) !== 0)
                count++;
        }
        return count;
    }

    getPuzzleInfoById(id) {
        return this.savedProgress.puzzle.goods[id];
    }

    getGuardPuzzleInfoById(id) {
        return this.savedProgress.puzzle.guards[id];
    }

    getGuardPuzzleInfo() {
        return this.savedProgress.puzzle.guards;
    }

    getPuzzleInfo() {
        return this.savedProgress.puzzle.goods;
    }

    getWorlds() {
        return this.savedProgress.worlds;
    }

    getLastDoubleTime() {
        return this.savedProgress.profile.lastDoubleTime || 0;
    }

    setLastDoubleTime() {
        this.savedProgress.profile.lastDoubleTime = Progress.getTimeNow();
        this.saveProgress();
    }

    getBuildingsForWorld(worldId) {
        return this.savedProgress.worlds[worldId].buildings;
    }

    getTotalResources() {
        return this.general.gold;
    }

    getTotalGems() {
        return this.general.gems;
    }

    getTotalSeeds() {
        return this.general.seeds;
    }

    getChestsCount() {
        return this.savedProgress.puzzle.boxes[BoxType.GoldBox] + this.savedProgress.puzzle.boxes[BoxType.GemsBox];
    }

    // getAllPurchases() {
    //     return this.savedProgress.purchases;
    // }

    _isPurchaseRepeatable(data) {
        return (data.repeatable || data.priceType === "Gems");
    }

    _isPurchasePriceIncreasing(data) {
        return (data.repeatable || (data.priceType === "Gems" && data.upgradeType === "MultiProfit"));
    }

    canPurchaseUpgrade(data) {
        if (data.hasOwnProperty('slotNumber')) {
            if (data.slotNumber >= 0 && !this.isBuildingConstructed(1, data.slotNumber + 1))
                return false;
        }

        if (this._isPurchaseRepeatable(data))
            return true;

        return !this.isUpgradePurchased(data.id);
    }

    isUpgradePurchased(id) {
        return this.savedProgress.purchases.hasOwnProperty(id);
    }

    isDailyBonusAvailable() {
        const dayNow = Progress.getDayNow();
        const dayWas = Progress.getDayFromTime(this.getMyDailyBonusInfo().update);

        return dayNow > dayWas;
    }

    bonusWasActivated() {
        const info = this.getMyDailyBonusInfo();
        info.update = Progress.getTimeNow();
        info.lastBonus++;
        eventManager.dailyBonusCollected();

        this.saveProgress();
    }

    activateSupervisor() {
        this.supervisor = Progress.getTimeNow() + BanjoDuration * 1000;
        this.resourcesCollectedWithSupervisor = bigInt("0");
        eventManager.shortSpeedActivated();
    }

    addSupervisorResources(amount) {
        this.resourcesCollectedWithSupervisor = this.resourcesCollectedWithSupervisor.add(amount);
    }

    getSupervisorResourcesCollected() {
        return this.resourcesCollectedWithSupervisor;
    }

    activateGuard() {
        // socialManager.playRewardedAd();
        if (this.isGuardActive())
            this.savedProgress.guard += 3600 * GuardDurationHours * 1000;
        else
            this.savedProgress.guard = Progress.getTimeNow() + 3600 * GuardDurationHours * 1000;
        eventManager.longSpeedActivated();
        this.saveProgress();
    }

    increaseBonusPerSeed(count) {
        this.savedProgress.profile.seedsStrength += count;
        this._updateTotalSeedsBonus();

        this.saveProgress();
    }

    isResourcesWithTypeEnoughForPurchase(data) {
        const price = this.getPurchasePrice(data);
        switch (data.priceType) {
            case "Gold":
                return this.isResourcesEnough(price);
            case "Seeds":
                return this.isSeedsEnough(price);
            case "Gems":
                return this.isGemsEnough(price);
        }
        return true;
    }

    spendResourcesByType(data) {
        switch (data.priceType) {
            case "Gold":
                return this.resourcesSpent(data.bigInt);
            case "Seeds":
                return this.seedsSpent(data.bigInt);
            case "Gems":
                return this.gemsSpent(data.bigInt);
        }
    }

    spendResourcesByTypeAndAmount(type, amount) {
        switch (type.toLowerCase()) {
            case "gold":
                return this.resourcesSpent(amount);
            case "tokencommon":
            case "tokenrare":
            case "tokenepic":
            case "superdoublingtoken":
                return this.tokensSpent(type, amount);
            case "seeds":
                return this.seedsSpent(amount);
            case "gems":
                return this.gemsSpent(amount);
        }
    }

    spendSuperDoublingToken() {
        this.spendResourcesByTypeAndAmount("superDoublingToken", 1 * RESOURCES_SCALE);
    }

    getSuperDoublingTokens() {
        return this.getTokens("superDoublingToken");
    }

    haveAnySuperDoublingTokens() {
        return this.getSuperDoublingTokens().compare(0) > 0;
    }

    isResourcesWithTypeEnough(data) {
        switch (data.priceType) {
            case "Gold":
                return this.isResourcesEnough(data.bigInt);
            case "Seeds":
                return this.isSeedsEnough(data.bigInt);
            case "Gems":
                return this.isGemsEnough(data.bigInt);
        }
        return true;
    }

    getPurchasePrice(data) {
        if (this.savedProgress.purchases.hasOwnProperty(data.id) && this._isPurchasePriceIncreasing(data))
            return new bigInt(this.savedProgress.purchases[data.id]);
        return data.bigInt;
    }

    canPurchaseUpgradeById(id) {
        const data = GameData.getMarketPurchaseById(id);
        return data && this.canPurchaseUpgrade(data);
    }

    tryToPurchaseUpgrade(id) {
        const data = GameData.getMarketPurchaseById(id);

        if (!data || !this.canPurchaseUpgrade(data))
            return false;

        if (data.priceType === "IN_APP") {
            socialManager.purchase(id);
            return true;
        } else {
            return this.purchaseConfirmed(id, data);
        }

        return false;
    }

    publicConfirmedPayment(id) {
        const data = GameData.getMarketPurchaseById(id);
        if (data && data.gems) {
            const win = guiManager.openNewWindow(WindowType.WinInAppBought);
            if (win)
                win.setInAppData(data);
        }
        this.purchaseConfirmed(id, data);
    }

    purchaseConfirmed(id, data) {
        let price = this.getPurchasePrice(data);

        let mult;
        switch (data.priceType) {
            case "Gold":
                if (!this.isResourcesEnough(price))
                    return false;
                mult = 1000;
                this.resourcesSpent(price);
                break;
            case "Seeds":
                if (!this.isSeedsEnough(price))
                    return false;
                mult = 100;
                this.seedsSpent(price);
                break;
            case "IN_APP":
                if (data.currency) {
                    for (let i in data.currency) {
                        const amount = data.currency[i].value;
                        const type = data.currency[i].resourceType;
                        switch (type.toLowerCase()) {
                            case "gold":
                                this.addResources(amount);
                                break;
                            case "tokencommon":
                            case "tokenrare":
                            case "tokenepic":
                            case "superdoublingtoken":
                                this.tokensEarned(type, amount);
                                break;
                            case "seeds":
                                this.seedsEarned(amount);
                                break;
                            case "gems":
                                this.gotGems(amount);
                                break;
                        }
                    }
                }
                if (data.gems)
                    this.gotGems(data.gems);
                if (data.getFishCount)
                    this.addResources(data.getFishCount());
                if (data.getCansCount)
                    this.seedsEarned(data.getCansCount());
                if (data.getBoxesCount)
                    this.giveChests(BoxType.GoldBox, data.getBoxesCount());
                if (data.getPuzzles)
                    data.getPuzzles();
                break;
            case "Gems":
                if (!this.isGemsEnough(price))
                    return false;

                gameAnalytics.sendEvent("PurchaseUpgrade", {
                    "gems": this.getTotalGems(),
                    "spent": price.toString(),
                    "session": this.savedProgress.profile.sessionNumber,
                    id: id
                });

                mult = 2;
                this.gemsSpent(price);
                switch (data.upgradeType) {
                    case "MultiProfit":
                        const int = new bigInt(this.savedProgress.profile.gemsMultiProfit);
                        this.savedProgress.profile.gemsMultiProfit = int.multiply(data.parameter).toString();
                        break;
                    case "SuperSeed":
                        gameInit.harvestCompleted(true);
                        break;
                }
                break;
        }

        if (data.priceType !== "IN_APP") {
            if (!this._isPurchasePriceIncreasing(data))
                this.savedProgress.purchases[id] = 1;
            else
                this.savedProgress.purchases[id] = price ? price.multiply(mult).toString() : 1;
        }

        this.onUpgradePurchased.callListeners(data);

        eventManager.upgradePurchased(data);
        return true;
    }

    getPriceForGoldBox() {
        return this.general.boxPrice;
    }

    tryToPurchaseBoxForGold(count) {
        if (this.isResourcesEnough(this.general.boxPrice)) {
            this.purchaseBox(BoxType.GoldBox, count);
            this.resourcesSpent(this.general.boxPrice);

            this.general.boxPrice = this.general.boxPrice.multiply(3);
            this.savedProgress.puzzle.goldBoxPrice = this.general.boxPrice.toString();
            return this.getPriceForGoldBox();
        }
        return false;
    }

    purchaseBox(boxType, count) {
        this.giveChests(boxType, count);
        eventManager.boxPurchased(count);
    }

    giveChests(boxType, count) {
        this.savedProgress.puzzle.boxes[boxType] += count;
        this.saveProgress();

        eventManager.boxReceived(count);

        switch (boxType) {
            case BoxType.SuperBox:
                this.openSuperChest();
                break;
            case BoxType.GuardBox:
                this.openGuardChest();
                break;
            case BoxType.GuardSuperBox:
                this.openGuardSuperChest();
                break;
        }
    }

    getOpenedBoxes() {
        return this.savedProgress.puzzle.openedBox;
    }

    openGeneralChest(puzzle, onDuplicate, onPuzzleCompleted, onPuzzlePeaceReceived, boxType) {
        const image = Math.floor(Math.random() * puzzle.length);

        const info = puzzle[image];
        const size = GameData.getPuzzleSizePerLevel(info.level);

        const piece = Math.floor(Math.random() * size * size);

        const duplicate = (((1 << piece) & info.pieces) !== 0) || info.level >= MAX_PUZZLE_LEVEL;

        const before = Object.assign({}, info);
        if (duplicate) {
            onDuplicate(info);
        }
        else {
            info.pieces |= (1 << piece);
        }

        if (info.level < MAX_PUZZLE_LEVEL) {
            let completed = true;
            for (let i = 0; i < size * size; i++) {
                if ((1 << i & info.pieces) === 0) {
                    completed = false;
                    break;
                }
            }

            if (completed) {
                info.level++;
                info.pieces = 0;
                onPuzzleCompleted.callListeners(info);
            }
        }

        onPuzzlePeaceReceived.callListeners(before, image, piece, duplicate, boxType);

        this.saveProgress();
    }

    openGuardChest() {
        if (this.savedProgress.puzzle.boxes[BoxType.GuardBox] <= 0)
            return false;
        this.savedProgress.puzzle.boxes[BoxType.GuardBox]--;

        const puzzle = this.getGuardPuzzleInfo();
        this.openGeneralChest(puzzle,
            (info) => {
                const guard = gameInit.guardManager.getGuardById(info.id);
                if (!guard) {
                    console.error("no guard found for this puzzle: " + image, info)
                } else {
                    const token = guard.getRefundType();
                    this.tokensEarned(token, bigInt(GameData.getGemsForDublicate() * RESOURCES_SCALE));
                }
            },
            this.onGuardPuzzleCompleted,
            this.onPuzzlePeaceReceived,
            BoxType.GuardBox
        );

        eventManager.guardBoxOpened();
        return true;
    }

    openChest() {
        if (this.savedProgress.puzzle.boxes[BoxType.GoldBox] > 0)
            this.savedProgress.puzzle.boxes[BoxType.GoldBox]--;
        else
            this.savedProgress.puzzle.boxes[BoxType.GemsBox]--;

        this.savedProgress.puzzle.openedBox += 1;
        achsManager.boxWasOpened(this.savedProgress.puzzle.openedBox);

        const puzzle = this.getPuzzleInfo();
        this.openGeneralChest(puzzle,
            (info) => {
                this.gotGems(bigInt(GameData.getGemsForDublicate() * RESOURCES_SCALE));
            },
            this.onPuzzleCompleted,
            this.onPuzzlePeaceReceived,
            BoxType.GoldBox
        );

        eventManager.boxOpened();
    }

    _areAllPuzzlesCollected(puzzle) {
        for (let i = 0; i < puzzle.length; i++) {
            if (puzzle[i].level < MAX_PUZZLE_LEVEL)
                return false;
        }
        return true;
    }

    areAllPuzzlesCollected() {
        return this._areAllPuzzlesCollected(this.getPuzzleInfo());
    }

    areAllGuardPuzzlesCollected() {
        return this._areAllPuzzlesCollected(this.getGuardPuzzleInfo());
    }

    openSuperChestPuzzle(puzzleId, count) {
        this.specific_puzzle = {
            id: puzzleId,
            count: count
        };
        this.giveChests(BoxType.SuperBox, count);
    }

    openGeneralSuperChest(puzzle, onPuzzleCompleted, onPuzzlePeaceReceived, boxType) {
        const maxLevel = MAX_PUZZLE_LEVEL;

        let image = null;
        if (this.specific_puzzle && this.specific_puzzle.count > 0) {
            image = this.specific_puzzle.id;
            this.specific_puzzle.count--;
        }
        else {
            let completedCount = 0;
            for (let i = 0; i < puzzle.length; i++) {
                if (puzzle[i].level >= maxLevel)
                    completedCount++;
            }

            if (completedCount === puzzle.length) {
                console.log("Nothing to collect");
                return false;
            }

            let index = Math.floor(Math.random() * (puzzle.length - completedCount));

            image = index;
            for (let i = 0; i <= index; i++) {
                if (puzzle[i].level >= maxLevel) {
                    image++;
                    index++;
                }
            }
        }

        const info = puzzle[image];
        const size = GameData.getPuzzleSizePerLevel(info.level);

        let piece = 0;
        for (let i = 0; i < size * size; i++) {
            if ((1 << i & info.pieces) === 0) {
                piece = i;
                break;
            }
        }

        const before = Object.assign({}, info);
        const duplicate = false;
        info.pieces |= (1 << piece);

        if (info.level < maxLevel) {
            let completed = true;
            for (let i = 0; i < size * size; i++) {
                if ((1 << i & info.pieces) === 0) {
                    completed = false;
                    break;
                }
            }

            if (completed) {
                info.level++;
                info.pieces = 0;
                onPuzzleCompleted.callListeners(info);
            }
        }

        onPuzzlePeaceReceived.callListeners(before, image, piece, duplicate, boxType);
        this.saveProgress();
        return true;
    }

    openGuardSuperChest() {
        if (this.savedProgress.puzzle.boxes[BoxType.GuardSuperBox] <= 0 || this.areAllGuardPuzzlesCollected())
            return false;
        this.savedProgress.puzzle.boxes[BoxType.GuardSuperBox] -= 1;

        const puzzle = this.getGuardPuzzleInfo();
        this.openGeneralSuperChest(puzzle,
            this.onGuardPuzzleCompleted,
            this.onPuzzlePeaceReceived,
            BoxType.GuardSuperBox);

        eventManager.guardBoxOpened();

        return true;
    }

    openSuperChest() {
        if (this.savedProgress.puzzle.boxes[BoxType.SuperBox] <= 0 || this.areAllPuzzlesCollected())
            return false;
        this.savedProgress.puzzle.boxes[BoxType.SuperBox] -= 1;

        this.savedProgress.puzzle.openedBox += 1;
        achsManager.boxWasOpened(this.savedProgress.puzzle.openedBox);

        const puzzle = this.getPuzzleInfo();

        this.openGeneralSuperChest(puzzle,
            this.onPuzzleCompleted,
            this.onPuzzlePeaceReceived,
            BoxType.SuperBox);

        eventManager.boxOpened();

        return true;
    }

    getSeedsForSoulsCount() {
        const separator = bigInt("10000000000000000");
        const totalResources = this.general.gold.add(this.general.resourcesSpent).divide(RESOURCES_SCALE);
        if (totalResources.compare(0) <= 0)
            return new bigInt(0);

        if (totalResources.compare(separator) < 0) {
            let result = BigIntSqrRoot(totalResources);
            return BigIntSqrRoot(result).multiply(RESOURCES_SCALE);
        } else {
            let result = totalResources.multiply(totalResources).multiply(totalResources);
            result = BigIntSqrRoot(result);
            result = BigIntSqrRoot(result);
            result = BigIntSqrRoot(result);
            return result;//.divide(100);//RESOURCES_SCALE
        }
    }

    //region likes

    isLikesTimerActive() {
        return this.savedProgress.profile.likedTimer;
    }

    resetLikesTimer() {
        this.savedProgress.profile.likedTimer = 0;

        for (let w in this.savedProgress.worlds) {
            const world = this.savedProgress.worlds[w];
            const buildings = world.buildings;
            for (let b in buildings)
                buildings[b].likes = [];
        }

        eventManager.likesReseted();
        this.saveProgress();
    }

    getLikesTimeleft() {
        return (LIKES_RESET_TIMER - (Progress.getTimeNow() - this.savedProgress.profile.likedTimer));
    }

    buildingLiked(world, building) {
        if (!this.savedProgress.profile.likedTimer)
            this.savedProgress.profile.likedTimer = Progress.getTimeNow();
    }

    //endregion

    update() {
        if (this.isLikesTimerActive()) {
            if (this.getLikesTimeleft() <= 0)
                this.resetLikesTimer();
        }
    }

    /***
     *
     * @type {Building} building
     * @type {bigInt} resources
     */
    resourcesCollected(building, resources) {
        eventManager.soulsCollected(building.id, resources);
        this.addResources(resources);
    }

    _resourcesWereUpdated() {
        this._setResourceByName("gold", this.general.gold.toString());
    }

    _seedsWereUpdated() {
        this._setResourceByName("seeds", this.general.seeds.toString());
        this.onResourcesChanges.callListeners(this);
        this._updateTotalSeedsBonus();
    }

    _gemsWereUpdated() {
        this._setResourceByName("gems", this.general.gems.toString());
        this.onResourcesChanges.callListeners(this);
    }

    _tokensWereUpdated(type) {
        this._setResourceByName(type, this.general[type].toString());
        this.onResourcesChanges.callListeners(this);
    }

    /***
     *
     * @type {bigInt} resources
     */
    addResources(resources) {
        this.general.gold = this.general.gold.add(resources);
        this._resourcesWereUpdated();
        this.onResourcesChanges.callListeners(this, true);

        const len = Math.round(this._getResourceByName("gold").length / 3);
        if (len > this.savedProgress.profile.maxGoldModifier) {
            this.savedProgress.profile.maxGoldModifier = len;

            gameAnalytics.sendEvent("NewGoldNumber", {
                "gems": this.getTotalGems(),
                "gold": len,
                "session": this.savedProgress.profile.sessionNumber
            });
        }
    }

    isResourcesEnough(amount) {
        return this.general.gold.compare(amount) >= 0;
    }

    isSeedsEnough(amount) {
        return this.general.seeds.compare(amount) >= 0;
    }

    isGemsEnough(amount) {
        return this.general.gems.compare(amount) >= 0;
    }

    /***
     *
     * @type {bigInt} resources
     */
    resourcesSpent(resources) {
        this.general.gold = this.general.gold.minus(resources);
        this.general.resourcesSpent = this.general.resourcesSpent.add(resources);
        this._setResourceByName("goldSpent", this.general.resourcesSpent.toString());
        this._resourcesWereUpdated();
        this.onResourcesChanges.callListeners(this, false);
    }

    /***
     *
     * @type {bigInt} gems
     */
    seedsEarned(seeds) {
        this.general.seeds = this.general.seeds.add(seeds);
        this._seedsWereUpdated();
    }

    /***
     *
     * @type {bigInt} gems
     */
    seedsSpent(seeds) {
        this.general.seeds = this.general.seeds.minus(seeds);
        this._seedsWereUpdated();
    }

    /***
     *
     * @type {bigInt} gems
     */
    tokensEarned(type, amount) {
        this.general[type] = this.general[type].add(amount);
        this._tokensWereUpdated(type);
    }

    /***
     *
     * @type {bigInt} gems
     */
    tokensSpent(type, amount) {
        this.general[type] = this.general[type].minus(amount);
        this._tokensWereUpdated(type);
    }

    getTokens(type) {
        return this.general[type];
    }

    getJackPotSize() {
        return this.savedProgress.fortuneWheel.jackpot;
    }

    incJackPotSize() {
        this.savedProgress.fortuneWheel.jackpot += JACKPOT_INCREASE * RESOURCES_SCALE;
    }

    giveJackPot() {
        this.gotGems(this.savedProgress.fortuneWheel.jackpot);
        this.savedProgress.fortuneWheel.jackpot = JACKPOT_SIZE * RESOURCES_SCALE;
    }

    /***
     *
     * @type {int} gems
     */
    gotGems(gems) {
        this.general.gems = this.general.gems.add(gems);
        this._gemsWereUpdated();
    }

    /***
     *
     * @type {bigInt} gems
     */
    gemsSpent(gems) {
        gameAnalytics.sendEvent("GemsSpent", {
            "gems": this.general.gems.toString(),
            "spent": gems.toString(),
            "session": this.savedProgress.profile.sessionNumber
        });
        this.general.gems = this.general.gems.minus(gems);
        this._gemsWereUpdated();
    }

    saveBuilding(world, building) {
        const deltaJson = {worlds: {}};
        const worldJson = deltaJson.worlds[world.id] = {};
        worldJson[building.id] = this.savedProgress.worlds[world.id].buildings[building.id];

        //Send deltaJson to the server

        this.saveProgress();
    }

    buildingCreated(world, building) {
        //Check if that was from loading
        const blds = this.savedProgress.worlds[world.id].buildings;
        if (!blds.hasOwnProperty(building.id)) {
            this.saveBuilding(world, building);
        }
    }

    isWorldChangeAvailable() {
        return this.getHarvestsCount() >= 1;
    }

    getHarvestsCount() {
        return (this.savedProgress.profile.harvestsCount || 0);
    }

    harvestStarted() {
        // const count = this.savedProgress.profile.harvestsCount || 0;
        // this.savedProgress.profile.harvestsCount = count + 1;
        // this.saveProgress();
    }

    getOffer1StartTime() {
        return this.savedProgress.profile.lastHarvestTime ? this.savedProgress.profile.lastHarvestTime : this.savedProgress.profile.firstTimeInGame;
    }

    harvestCompleted(dontReset) {
        const count = this.savedProgress.profile.harvestsCount || 0;
        this.savedProgress.profile.harvestsCount = count + 1;
        this.savedProgress.profile.lastHarvestTime = Progress.getTimeNow();

        const seeds = this.getSeedsForSoulsCount();
        this._setResourceByName("gold", "0");
        this._setResourceByName("goldSpent", "0");
        this.general.gold = bigInt("0");
        this.general.resourcesSpent = bigInt("0");
        const gemsPurchases = {};
        for (let id in this.savedProgress.purchases) {
            const purchase = GameData.getMarketPurchaseById(id);

            if (purchase) {
                const type = purchase.priceType;
                if (type === "Gems" || type === "IN_APP")
                    gemsPurchases[id] = this.savedProgress.purchases[id];
            } else {
                gameAnalytics.sendEvent('LOCAL_ERROR',{
                    eventAction: "purchase_id=" + id,
                    eventLabel: 'no_purchase_in_harvest_complete'
                });
            }
        }
        this.savedProgress.purchases = gemsPurchases;

        this.seedsEarned(seeds);

        achsManager.reportPrestige(seeds);

        //give tokens
        const tokensForPrestige = GameData.getTokensForPrestige(this.savedProgress.profile.harvestsCount);
        if (tokensForPrestige) {
            this.tokensEarned(tokensForPrestige.tokenType, tokensForPrestige.amount);
        }

        if (!dontReset)
            this._resetConstructions();

        eventManager.harvestCompleted(seeds);

        this.saveProgress();
    }

    _getDeltaSave() {
        const newSave = {};

        if (!this.lastSave)
            this.lastSave = {};

        const lastSave = this.lastSave;

        function addFields(obj, path) {
            for (let k in obj) {
                const n = path + k;
                if ((typeof obj[k]) == "object") {
                    addFields(obj[k], n + ".");
                } else {
                    const v = obj[k];
                    if (lastSave[n] !== v) {
                        newSave[n] = obj[k];
                        lastSave[n] = v;
                    }
                }
            }
        }

        addFields(this.savedProgress, "");

        return newSave;
    }

    _writeToStorage() {
        const v = this.savedProgress.profile.savedVersion || 0;
        this.savedProgress.profile.savedVersion = v + 1;

        if (this.useGoblin)
        {
            if (socialManager.isAuthorizing()) {
                console.log("authorizing right now, won't save");
                return;
            }

            window.localStorage.setItem("allProgress", JSON.stringify(this.savedProgress));
            const deltaSave = this._getDeltaSave();
            this._sendDataToServer(deltaSave);
        }

        {
            console.log("Saving... " + this.savedProgress.profile.savedVersion);
            UnnyNet.UnnyNet.save(COLLECTION_NAME, COLLECTION_KEY_NAME, JSON.stringify(this.savedProgress), 0, (response) => {
                console.log("RESP", response);
                if (!response.success)
                    console.error("couldn't save", response.error);
            });
        }

        this.timerId = null;
        this.lastSaveTime = Progress.getTimeNow();
    }

    _sendDataToServer(deltaSave) {
        if (gBase.currentUnicorn)
            gBase.profile.update(
                deltaSave, null,
                null, null, null, null,
                (err) => {
                    if (err) {
                        gameAnalytics.sendServerError(err, "update");
                        socialManager.checkAuthStatus(err, () => this._sendDataToServer(deltaSave));
                    }
                }
            );
    }

    saveProgress() {
        if (this.timerId == null)
            this.timerId = setTimeout(this._writeToStorage.bind(this), 2000);
        else {
            if (Progress.getTimeNow() - this.lastSaveTime <= 10000) {
                clearTimeout(this.timerId);
                this.timerId = setTimeout(this._writeToStorage.bind(this), 2000);
            }
        }
    }

    static loadProgressFromServer(callback, useGoblin) {

        function AuthInUnnyNet(callback, goblinVersion) {
            UnnyNet.UnnyNet.load(COLLECTION_NAME, COLLECTION_KEY_NAME, (response)=>{
                if (response.success) {
                    if (response.data && response.data.length) {
                        const json = JSON.parse(response.data[0].value);
                        console.error("LOADED version: " + json.profile.savedVersion);
                        if (callback)
                            callback(json);
                        else {
                            console.log("UnnyNet version " + (json && json.profile ? json.profile.savedVersion : 'none') + " vs " + goblinVersion);
                        }
                    } else {
                        if (callback)
                            callback(null);
                    }
                } else {
                    console.error("Failed to load profile", response.error);
                    //TODO this is temporary:
                    if (callback)
                        callback(null);
                }
            });
        }

        if (useGoblin) {
            if (!gBase.currentAccount)
                callback(null);
            else {
                if (!gBase.currentAccount.haveProfile) {
                    gBase.profile.create((err) => {
                        if (err)
                            gameAnalytics.sendServerError(err, "create");
                    });
                    callback(null);
                } else {
                    gBase.profile.getp((err) => {
                        if (err)
                            gameAnalytics.sendServerError(err, "getp");
                        const data = gBase.currentProfile.profileData;
                        callback(data);

                        AuthInUnnyNet(null, data && data.profile ? data.profile.savedVersion : 'unknown');
                    });
                }
            }
        } else
            AuthInUnnyNet(callback);
    }

    loadProgress() {
        if (!this.useGoblin)
            return null;
        const value = window.localStorage.getItem("allProgress");
        // console.log("load " + value);
        return value ? JSON.parse(value) : null;
        // if (value) {
        //     return Promise.resolve(JSON.parse(value));
        // }
        // return Promise.reject();
    }

    cheatResources() {
        this.addResources(this.getTotalResources().add(1000).multiply(10));
        // this.seedsEarned(this.getTotalSeeds().add(1).multiply(10));
        this.gotGems(this.getTotalGems().add(1).multiply(10));
    }

    getTutorialPhase() {
        if (this.savedProgress.tutorial)
            return this.savedProgress.tutorial.stepNumber;
        return this.savedProgress.profile.tutorialPhase || 0;
    }

    setTutorialPhase(phase) {
        if (this.savedProgress.tutorial)
            this.savedProgress.tutorial.stepNumber = phase;
        else
            this.savedProgress.profile.tutorialPhase = phase;
        this.saveProgress();
    }

    getBuildingLevel(worldId, buildingId) {
        return this.savedProgress.worlds[worldId].buildings[buildingId].level;
    }

    isBuildingConstructed(worldId, buildingId) {
        return this.getBuildingLevel(worldId, buildingId) >= 1;
    }

    getBuildingInfo(worldId, buildingId) {
        return this.savedProgress.worlds[worldId].buildings[buildingId];
    }

    static getPhaseIndex(phase) {
        const data = GameData.getTutorialConfig();
        for (let i = 0; i < data.length; i++) {
            if (data[i].stepNumber === phase)
                return i;
        }
        return -1;
    }

    canCheckStore() {
        if (typeof TutPhases !== 'undefined')
            return this.getTutorialPhase() >= TutPhases.BuildSlots9 && this.getTutorialPhase() < TutPhases.FortuneWheel;
        return true;
    }

    isTutorialCompleted() {
        if (typeof TutPhases !== 'undefined')
            return (this.getTutorialPhase() >= TutPhases.BuildSlots6 && this.getTutorialPhase() < TutPhases.FortuneWheel) || VisualData.getGameSettings().no_tutorial;

        const data = GameData.getTutorialConfig();
        const phaseIndex = Progress.getPhaseIndex(this.getTutorialPhase());

        return phaseIndex < 0 || data[phaseIndex].actionType === 'Completed';
    }

    canShowBoss(worldId) {
        if (typeof TutPhases !== 'undefined')
            return (this.getTutorialPhase() >= TutPhases.SummonBoss || VisualData.getGameSettings().no_tutorial) && this.getConstructedBuildingsCount(worldId) >= 6;
        return this.getConstructedBuildingsCount(worldId) >= 6;
    }

    canShowGuard() {
        if (typeof TutPhases !== 'undefined')
            return ((this.getTutorialPhase() >= TutPhases.Boost4h || VisualData.getGameSettings().no_tutorial) && !VisualData.getGameSettings().no_guard);
        return !VisualData.getGameSettings().no_guard;
    }

    getConstructedBuildingsCount(worldId) {
        worldId = worldId || 1;
        const buildings = this.savedProgress.worlds[worldId].buildings;
        let count = 0;
        for (let i = 1; i <= 9; i++) {
            if (buildings[i].level !== 0)
                count++;
        }
        return count;
    }

    isResourcesEnoughForConstruction(building) {
        return (this.isResourcesEnough(building.getUpgradePrice()) && this.getPuzzleInfoById(building.slot - 1).level >= 1);
    }

    saveQuestsProgress(manager) {
        this.savedProgress.quests.update = manager.update;

        const savedQuests = this.savedProgress.quests.activeQuests;
        const quests = manager.activeQuests;
        for (let i = 0; i < quests.length; i++) {
            const q = quests[i];
            savedQuests[i] = {
                id: q.info.id,
                level: q.level,
                progress: q.progress,
                isRefreshed: q.isRefreshed,
                isComplete: q.isComplete,
                // fullProgress:
            };
        }
        this.saveProgress();
    }

    getQuestsProgress() {
        return this.savedProgress.quests;
    }

    resetProgress() {
        this.savedProgress.profile.version = 1;
        this.saveProgress();
    }

    getFreeSpinsCount() {
        return this.savedProgress.fortuneWheel.freeSpins;
    }

    getNextSpinTime() {
        return this.savedProgress.fortuneWheel.update + SpinsResporeTime - Progress.getTimeNow();
    }

    spendSpin() {
        if (this.getFreeSpinsCount() >= Progress.getMaxFreeSpins())
            this.savedProgress.fortuneWheel.update = Progress.getTimeNow();
        this.savedProgress.fortuneWheel.freeSpins = Math.max(0, this.savedProgress.fortuneWheel.freeSpins - 1);
    }

    canOpenOtherWorld() {
        const puzzle = this.getPuzzleInfo();

        for (let i = 9; i < puzzle.length; i++) {
            if (puzzle[i].level > 0)
                return true;
        }

        return this.getConstructedBuildingsCount() >= 9;
    }

    checkForNewSpin() {
        if (this.getFreeSpinsCount() < Progress.getMaxFreeSpins()) {
            if (this.getNextSpinTime() <= 0) {
                console.log("add new spin");
                this.savedProgress.fortuneWheel.freeSpins++;
                this.savedProgress.fortuneWheel.update += SpinsResporeTime;
                return true;
            }
        }
        return false;
    }

    _checkForAdsField() {
        if (!this.savedProgress.adsWatched) {
            this.savedProgress.adsWatched = {
                count: 0,
                update: 0
            };
        }

        const timeNow = Progress.getTimeNow();
        const dayNow = Progress.getDayFromTime(timeNow);
        const dayWas = Progress.getDayFromTime(this.savedProgress.adsWatched.update);
        if (dayNow != dayWas)
            this.savedProgress.adsWatched.count = 0;
    }

    getAdsWatchedToday() {
        this._checkForAdsField();
        return this.savedProgress.adsWatched.count;
    }

    adWasWatched() {
        this._checkForAdsField();
        this.savedProgress.adsWatched.count++;
        this.savedProgress.adsWatched.update = Progress.getTimeNow();
        this.saveProgress();
    }

    static getMaxFreeSpins() {
        return 3;
    }

    _checkPhotoQuests() {
        if (!this.savedProgress.photo_quests)
            this.savedProgress.photo_quests = {
                unlocked: [],
                quests: []
            };
        else {
            if (!this.savedProgress.photo_quests.unlocked)
                this.savedProgress.photo_quests.unlocked = [];
        }
    //     if (!this.photo_quests) {
    //         this.photo_quests = {};
    //         if (this.savedProgress.photo_quests) {
    //             const qq = this.savedProgress.photo_quests.quests;
    //             for (let q_id in qq) {
    //                 const pavelInfo = GameData.getPavelInfoFromPhotoId(q_id);
    //
    //                 this.photo_quests[pavelInfo.id] = {
    //                     level: pavelInfo.level,
    //                     progress: qq[q_id].progress
    //                 };
    //             }
    //
    //             const up = this.savedProgress.photo_quests.unlocked_photos;
    //             for (let q_id in up) {
    //
    //                 const pavelInfo = GameData.getPavelInfoFromPhotoId(up[q_id]);
    //                 if (!this.photo_quests.hasOwnProperty(pavelInfo.id)) {
    //                     this.photo_quests[pavelInfo.id] = {
    //                         level: pavelInfo.level + 1,
    //                         progress: 0
    //                     };
    //                 }
    //             }
    //         }
    //     }
    //
    //     if (!this.savedProgress.photo_quests) {
    //         this.savedProgress.photo_quests = {
    //             quests: {},
    //             unlocked_photos: []
    //         };
    //     }
    }

    // _getPhotoIdByPavelIdAndLevel(pavel_id, level) {
    //     return GameData.getPhotoData()[pavel_id].levels[level].photo_id;
    // }

    // _getPhotoIdByPavelId(pavel_id) {
    //     this._checkPhotoQuests();
    //     return this._getPhotoIdByPavelIdAndLevel(pavel_id, this.photo_quests.hasOwnProperty(id) ? this.photo_quests[id].level : 0);
    // }

    getPhotoQuestById(id) {
        this._checkPhotoQuests();

        const pq = this.savedProgress.photo_quests;

        for (let i in pq.quests) {
            const q = pq.quests[i];
            if (q.photoId === id)
                return q;
        }

        return {
            photoId: id,
            progress: 0,
            isComplete: pq.unlocked.includes(id)
        };
    }

    addPhotoForPrestige(photo) {
        this._checkPhotoQuests();

        const id = photo.id;
        const pq = this.savedProgress.photo_quests;
        if (!pq.unlocked.includes(id))
            pq.unlocked.push(id);

        this.saveProgress();
    }

    savePhotoQuestsCompleted(quest) {
        this._checkPhotoQuests();

        const id = quest.info.id;
        const pq = this.savedProgress.photo_quests;
        if (!pq.unlocked.includes(id))
            pq.unlocked.push(id);

        for (let i in pq.quests) {
            if (pq.quests[i].photoId === id) {
                pq.quests.splice(i, 1);
                break;
            }
        }

        this.saveProgress();
        eventManager.photoQuestClaimed();
    };

    savePhotoQuestsProgress(quest) {
        this._checkPhotoQuests();

        // console.info("savePhotoQuestsProgress", quest);
        const pq = this.savedProgress.photo_quests;

        const id = quest.info.id;
        let found = false;
        for (let i in pq.quests) {
            const q = pq.quests[i];
            if (q.photoId === id) {
                q.progress = quest.progress;
                found = true;
                break;
            }
        }

        if (!found) {
            pq.quests.push({
                photoId: id,
                progress: quest.progress,
                isComplete: false
            });
        }

        this.saveProgress();
    }

    haveAnyPhotos() {
        return this.savedProgress.photo_quests.unlocked.length > 0;
    }

    getAllUnlockedPhotos() {
        return this.savedProgress.photo_quests.unlocked;
    }

    unlockPhotoForSlot(slot_id) {
        const photoData = GameData.getPhotoDataBySlotId();
        // photoData.
    }

    static getTimeTillTheNextDay() {
        const day = Progress.getDayNow() + 1;
        const time = Progress.getTimeNow();
        return day * 24 * 3600 - time / 1000;
    }

    switchGuard(worldId, guard) {
        this.savedProgress.worlds[worldId].guards["1"].id = guard.id;
        this.saveProgress();

        this.onGuardWasChanged.callListeners(worldId, guard);
    }
}

let GameData = (function () {

    BUILDINGS_INFO = {};
    SLOTS_UPGRADE = null;

    MARKET_GOLD = [];
    MARKET_SEEDS = [];
    MARKET_GEMS = [];

    MARKET_DATA = {};

    ATLAS_SPRITES = {};

    IN_APP_DATA = {};
    TUTORIAL_CONFIG = {};

    PHOTO_DATA = null;
    PHOTOS_BY_MAINTAG_ARR = null;
    PHOTO_DATA_DICT = null;
    PHOTOS_FOR_PRESTIGE = null;

    TOKENS_DATA = null;

    ALL_RESOURCES_TYPES = ['gold', 'seeds', 'gems', 'tokenCommon', 'tokenRare', 'tokenEpic'];

    IN_APP_OFFERS = {
        'hellprod.offer1': {
            id: 'hellprod.offer1',
            priceType: 'IN_APP',

            getBoxesCount: function () {
                return 25;
            },

            getFishCount: function () {
                let count = gameInit.progress.getTotalSeeds().compare(RESOURCES_SCALE) >= 0 ? gameInit.progress.getTotalSeeds() : bigInt(RESOURCES_SCALE);
                return count.multiply(bigInt("10000000000000"));
            },

            getCansCount: function () {
                return gameInit.progress.getTotalSeeds().compare(RESOURCES_SCALE) >= 0 ? gameInit.progress.getTotalSeeds() : bigInt("10000").multiply(RESOURCES_SCALE);
            },

            getPuzzles: function () {
                gameInit.progress.openSuperChestPuzzle(20, 4);
            }
        }
    };

    _compareFunction = function (a, b) {
        const intA = new bigInt(a.price);
        const intB = new bigInt(b.price);
        return intA.compare(intB);
    };

    _compareFunctionOrder = function (a, b) {
        return a.order - b.order;
    };

    return {
        getAllResourcesType() {
            return ALL_RESOURCES_TYPES;
        },

        getGemsForDublicate() {
            return 5;
        },

        getMarketListGold() {
            return MARKET_GOLD;
        },

        getMarketListSeeds() {
            return MARKET_SEEDS;
        },

        getMarketListGems() {
            return MARKET_GEMS;
        },

        getInAppData() {
            return IN_APP_DATA;
        },

        getTutorialConfig() {
            return TUTORIAL_CONFIG;
        },

        getMarketPurchaseById(id) {
            return MARKET_DATA.hasOwnProperty(id) ? MARKET_DATA[id] : IN_APP_OFFERS[id];
        },

        getBuildingInfoBySlot(slot) {
            return BUILDINGS_INFO[slot];
        },

        getSlotsUpgrade() {
            return SLOTS_UPGRADE;
        },

        getPuzzleSizePerLevel(level) {
            switch (level) {
                case 0:
                case 1:
                    return 2;
                case 2:
                case 3:
                    return 3;
                case 4:
                case 5:
                    return 4;
            }
        },

        getPuzzleResourceBonusDivPerLevel(level) {
            switch (level) {
                case 0:
                case 1:
                case 2:
                    return 1;
                case 3:
                    return 2;
                case 4:
                    return 6;
                default:
                    return 26;
            }
        },

        getPuzzleResourceBonusPerLevel(level) {
            switch (level) {
                case 0:
                case 1:
                    return 1;
                case 2:
                    return 2;
                case 3:
                    return 6;
                case 4:
                    return 26;
                default:
                    return 126;
            }
        },

        getPuzzleBackNamePerLevel(level) {
            switch (level) {
                case 1:
                    return 'PuzzleOpened';
                case 2:
                    return 'PuzzleBronze';
                case 3:
                    return 'PuzzleSilver';
                case 4:
                    return 'PuzzleGold';
                case 5:
                    return 'PuzzleDiamond';
            }
            return null;
        },

        getPuzzlesIconNamePerLevel(level) {
            switch (level) {
                case 1:
                    return 'PuzzlesOpened';
                case 2:
                    return 'PuzzlesBronze';
                case 3:
                    return 'PuzzlesSilver';
                case 4:
                    return 'PuzzlesGold';
                case 5:
                    return 'PuzzlesDiamond';
            }
            return null;
        },

        getPuzzlesTextPerLevel(level) {
            switch (level) {
                case 1:
                    return 'PuzzleCounterOpened';
                case 2:
                    return 'PuzzleCounterBronze';
                case 3:
                    return 'PuzzleCounterSilver';
                case 4:
                    return 'PuzzleCounterGold';
                case 5:
                    return 'PuzzleCounterDiamond';
            }
            return null;
        },

        getIconByType(priceType) {
            switch (priceType.toLowerCase()) {
                case "gold":
                    return 'PriceIcon';
                case "seeds":
                    return 'PriceSeeds';
                case "gems":
                    return 'PriceGems';
                case "tokencommon":
                    return 'TokenCommon';
                case "tokenrare":
                    return 'TokenRare';
                case "tokenepic":
                    return 'TokenEpic';
            }
            return null;
        },

        getPuzzleIcon(id) {
            return BUILDINGS_INFO[id].visual.puzzle;
        },

        getBoxData() {
            return BOX_DATA;
        },

        getBoxByType(boxType){
            for (let i in BOX_DATA) {
                if (BOX_DATA[i].boxType === boxType)
                    return BOX_DATA[i];
            }
            return null;
        },

        getLoginData() {
            return LOGIN_DATA;
        },

        getRandomQuest() {
            // return QUESTS_DATA[10];
            return QUESTS_DATA[Math.floor(Math.random() * QUESTS_DATA.length)];
        },

        getQuestById(id) {
            for (let i in QUESTS_DATA) {
                if (QUESTS_DATA[i].id === id)
                    return QUESTS_DATA[i];
            }
            return null;
        },

        getPhotoData() {
            return PHOTO_DATA;
        },

        getPrestigePhotos() {
            return PHOTOS_FOR_PRESTIGE;
        },

        getPhotosByMainTagArray() {
            return PHOTOS_BY_MAINTAG_ARR;
        },

        getPhotosByTagArray() {
            return PHOTOS_BY_TAG_ARR;
        },

        getPhotosByFilterArray() {
            return PHOTOS_BY_FILTER_ARR;
        },

        getPhotoById(id) {
            return PHOTO_DATA_DICT[id];
        },

        getPhotoDataBySlotId(id) {
            for (let i in PHOTO_DATA) {
                if (PHOTO_DATA[i].goodsId == id)
                    return PHOTO_DATA[i];
            }
            return null;
        },

        prepareAtlases(atlasJson) {
            if (atlasJson) {
                for (let i in atlasJson.textures) {
                    const frames = atlasJson.textures[i].frames;
                    for (let f in frames) {
                        ATLAS_SPRITES[frames[f].filename] = 1;
                    }
                }
            }
        },

        getAtlasName(objInfo) {
            return ATLAS_SPRITES.hasOwnProperty(objInfo.file) ? "AtlasJson" : null;
        },

        getTokensForNextSlotLevelUp(level) {
            if (!TOKENS_DATA)
                return 0;

            const tl = TOKENS_DATA.slotLevelTokens;
            for (let i = 0; i < tl.length; i++) {
                if (tl[i].parameter > level)
                    return tl[i];
            }
            return 0;
        },

        getTokensForSlotLevelUp(level) {
            return TOKENS_DATA ? TOKENS_DATA.tokensForLevel[level] : null;
        },

        getTokensForPrestige(number) {
            return TOKENS_DATA ? TOKENS_DATA.tokensForPrestige[number] : null;
        },

        getTokensInfoForWorld(worldId) {
            return TOKENS_DATA ? TOKENS_DATA.locations[parseInt(worldId) - 1] : null;
        },

        prepareGameData(data) {
            const goodsData = data.GoodsData;
            const slotsUpgrade = data.SlotsUpgrade;
            const marketData = data.MarketData;
            const boxData = data.BoxData;
            const questsData = data.QuestsData;
            const loginData = data.LoginData;
            const inAppData = data.InAppLots;

            TUTORIAL_CONFIG = data.TutorialConfig;

            QUESTS_DATA = questsData;
            inAppData.sort(_compareFunctionOrder);

            for (let i = 0; i < goodsData.length; i++) {
                const val = goodsData[i];
                let add = 0;
                if (val.puzzleType) {
                    switch (val.puzzleType) {
                        case "Basic":
                            add = 0;
                            break;
                        case "Middle":
                            add = 9;
                            break;
                        default:
                            add = 18;
                            break;
                    }
                } else {
                    switch (val.location) {
                        case "greece":
                            add = 0;
                            break;
                        case "celtic":
                            add = 9;
                            break;
                        default:
                            add = 18;
                            break;
                    }
                }

                val.slotNumber = val.slotNumber % 9;

                const newKey = BUILDINGS_INFO[(val.slotNumber + 1 + add)] = {};

                newKey.name = val.name;
                newKey.construct = {
                    price: bigInt(val.createPrice).multiply(RESOURCES_SCALE)
                };

                newKey.visual = {
                    icon: val.smallIcon,
                    drop: val.drop,
                    puzzle: val.icon
                };

                newKey.production = {
                    base: bigInt(val.incomeBase).multiply(RESOURCES_SCALE),
                    perLevel: 0
                };

                newKey.upgrade = {
                    base: bigInt(val.upgradePriceBase).multiply(RESOURCES_SCALE),
                    scale: val.upgradePriceStep,
                };

                newKey.loading = {
                    duration: val.incomeTimerBase,
                };
            }

            SLOTS_UPGRADE = slotsUpgrade;

            for (let i in marketData) {
                const val = marketData[i];
                switch (val.priceType) {
                    case "Gold":
                        MARKET_GOLD.push(val);
                        break;
                    case "Seeds":
                        MARKET_SEEDS.push(val);
                        break;
                    case "Gems":
                        if (val.priceGems)
                            val.price = val.priceGems.toString();
                        MARKET_GEMS.push(val);
                        break;
                }
                if (!val.hasOwnProperty('slotNumber')) {
                    if (val.hasOwnProperty('upgradeTier'))
                        val.slotNumber = val.upgradeTier - 1;
                }
                val.bigInt = bigInt(val.price).multiply(RESOURCES_SCALE);
                MARKET_DATA[val.id] = val;
            }

            IN_APP_DATA = inAppData;
            for (let i in inAppData) {
                const val = inAppData[i];
                if (!val.hasOwnProperty("id"))
                    val.id = val.itemIdprod;
                val.priceType = "IN_APP";
                val.repeatable = true;
                val.originalGems = val.gems;
                val.gems *= RESOURCES_SCALE;
                MARKET_DATA[val.id] = val;

                if (val.hasOwnProperty("currency")) {
                    const cur = val.currency;
                    for (let i in cur) {
                        cur[i].value += "00";
                    }
                }
            }

            MARKET_GOLD.sort(_compareFunction);
            MARKET_SEEDS.sort(_compareFunction);

            BOX_DATA = boxData;
            for (let i = 0; i < BOX_DATA.length; i++) {
                const d = BOX_DATA[i];
                if (!d.priceGems)
                    d.priceGems = d.price;
                d.bigInt = bigInt(d.priceGems).multiply(RESOURCES_SCALE);
            }

            LOGIN_DATA = loginData;

            if (data.PhotoData) {
                PHOTO_DATA = data.PhotoData;
                PHOTOS_BY_MAINTAG_ARR = [];
                PHOTOS_BY_TAG_ARR = [];
                PHOTOS_BY_FILTER_ARR = [];
                PHOTO_DATA_DICT = {};
                let photosByMainTag = {};
                let photosByTag = {};
                let photosByFilters = {};
                for (let i in PHOTO_DATA) {
                    const pd = PHOTO_DATA[i];
                    PHOTO_DATA_DICT[pd.id] = pd;

                    for (let r in ALL_RESOURCES_TYPES) {
                        const type = ALL_RESOURCES_TYPES[r];
                        pd[type + "_bigInt"] = bigInt(pd[type]).multiply(RESOURCES_SCALE);
                    }

                    switch (pd.puzzleLevel) {
                        case "Simple":
                            pd.level = 1;
                            break;
                        case "Bronze":
                            pd.level = 2;
                            break;
                        case "Silver":
                            pd.level = 3;
                            break;
                        case "Gold":
                            pd.level = 4;
                            break;
                        case "Diamond":
                            pd.level = 5;
                            break;
                    }

                    let arr = !photosByMainTag.hasOwnProperty(pd.mainTag) ? photosByMainTag[pd.mainTag] = [] : photosByMainTag[pd.mainTag];
                    arr.push(pd);

                    const tags = pd.tags;
                    const filters = pd.filters;

                    for (let i in tags) {
                        const s = tags[i];
                        arr = !photosByTag.hasOwnProperty(s) ? photosByTag[s] = [] : photosByTag[s];
                        arr.push(pd);
                    }

                    for (let i in filters) {
                        const s = filters[i];
                        arr = !photosByFilters.hasOwnProperty(s) ? photosByFilters[s] = [] : photosByFilters[s];
                        arr.push(pd);
                    }
                }

                for (let i in photosByTag) {
                    const arr = photosByTag[i];
                    PHOTOS_BY_TAG_ARR.push({
                        tag: i,
                        array: arr
                    });
                }

                for (let i in photosByFilters) {
                    const arr = photosByFilters[i];
                    PHOTOS_BY_FILTER_ARR.push({
                        filter: i,
                        array: arr
                    });
                }

                function compareLevels(a, b) {
                    return a.level - b.level;
                }

                //sort photos by level
                for (let i in photosByMainTag) {
                    const arr = photosByMainTag[i];
                    arr.sort(compareLevels);
                    PHOTOS_BY_MAINTAG_ARR.push({
                        tag: arr[0].mainTag,
                        array: arr
                    });
                }

                if (data.TokenData) {
                    TOKENS_DATA = data.TokenData;
                    const tl = TOKENS_DATA.slotLevelTokens;
                    const d = TOKENS_DATA.tokensForLevel = {};
                    for (let i in tl) {
                        const t = tl[i];
                        d[t.parameter] = t.amount * RESOURCES_SCALE;
                    }

                    const tp = TOKENS_DATA.prestigeTokens;
                    const d2 = TOKENS_DATA.tokensForPrestige = {};

                    for (let i in tp) {
                        const t = tp[i];
                        d2[t.parameter] = {
                            tokenType: t.tokenType,
                            amount: t.amount * RESOURCES_SCALE
                        };
                    }

                    for (let i in TOKENS_DATA.locations) {
                        const l = TOKENS_DATA.locations[i];
                        l.tokenDropAmount *= RESOURCES_SCALE;
                        l.duplicatePuzzleAmount *= RESOURCES_SCALE;
                        l.tokenDropLimit *= RESOURCES_SCALE;
                    }


                    PHOTOS_FOR_PRESTIGE = data.PrestigePhotos;
                    for (let pr of PHOTOS_FOR_PRESTIGE)
                        PHOTO_DATA.push(pr);
                }
            }
        }
    }
})();

class QuestBase {
    constructor(prms, progress) {
        this.info = prms;
        if (progress) {
            this.level = progress.level;
            this.progress = progress.progress;
            this.isRefreshed = progress.isRefreshed;
            this.isComplete = progress.isComplete;
        } else {
            this.level = Math.floor(Math.random() * prms.reward.length);
            this.progress = 0;
            this.isRefreshed = false;
            this.isComplete = false;
        }
        if (prms.hasOwnProperty("reward")) {
            this.originalReward = prms.reward[this.level];
            this.reward = this.originalReward * RESOURCES_SCALE;
            this.count = prms.levels[this.level];
        } else {
            this.count = prms.questCount;//photo quests
        }

        this.completeCallback = prms.completeCallback;
        this.claimCallback = prms.claimCallback;
        this.replaceCallback = prms.replaceCallback;
        this.progressChanged = prms.progressChanged;

        if (this.progress >= this.count)
            this.completeCallback(this);
    }

    hasAction() {
        return this.info.hasAction;
    }

    useAction() {

    }

    getRewardForUI() {
        return this.originalReward;
    }

    increaseProgress(count) {
        this.progress += count;
        if (this.progress >= this.count)
            this.completeCallback(this);

        this.progressChanged(this);

        eventManager.actionQuestProgress(this);
    }

    canReplaceQuest() {
        return !this.isRefreshed;
    }

    canDisplayQuest() {
        return !this.isComplete;
    }

    replaceQuest() {
        this.isRefreshed = true;
        this.replaceCallback();
    }

    claimReward() {
        this.isComplete = true;
        this.claimCallback(this);
    }

    clearCallback() {

    }

    isReadyToClaim() {
        return this.progress >= this.count;
    }
}

class QuestBoxOpen extends QuestBase {
    constructor(prms, progress) {
        super(prms, progress);
        this.subscribe = () => this.increaseProgress(1);
        eventManager.onBoxOpened.addListener(this.subscribe);
    }

    clearCallback() {
        eventManager.onBoxOpened.removeListener(this.subscribe);
    }
}

class QuestBoxPurchased extends QuestBase {
    constructor(prms, progress) {
        super(prms, progress);
        this.subscribe = (count) => this.increaseProgress(count);
        eventManager.onBoxPurchased.addListener(this.subscribe);
    }

    clearCallback() {
        eventManager.onBoxPurchased.removeListener(this.subscribe);
    }
}

class QuestCollectSoulsTimes extends QuestBase {
    constructor(prms, progress) {
        super(prms, progress);
        this.subscribe = (slot) => {
            if (slot === prms.slot || !prms.slot)
                this.increaseProgress(1);
        };
        eventManager.onSoulsCollected.addListener(this.subscribe);
    }

    clearCallback() {
        eventManager.onSoulsCollected.removeListener(this.subscribe);
    }
}

class QuestCollectSoulsAmount extends QuestBase {
    constructor(prms, progress) {
        super(prms, progress);
        this.progress = bigInt(this.progress);
        this.subscribe = (slot, count) => {
            if (slot === prms.slot || !prms.slot)
            // this.increaseProgress(count);
                this.progress = this.progress.add(count);
        };
        eventManager.onSoulsCollected.addListener(this.subscribe);
    }

    clearCallback() {
        eventManager.onSoulsCollected.removeListener(this.subscribe);
    }
}

class QuestLongSpeedActivate extends QuestBase {
    constructor(prms, progress) {
        super(prms, progress);
        this.subscribe = () => {
            this.increaseProgress(1);
        };
        eventManager.onLongSpeedActivated.addListener(this.subscribe);
    }

    clearCallback() {
        eventManager.onLongSpeedActivated.removeListener(this.subscribe);
    }
}

class QuestShortSpeedActivate extends QuestBase {
    constructor(prms, progress) {
        super(prms, progress);
        this.subscribe = () => {
            this.increaseProgress(1);
        };
        eventManager.onShortSpeedActivated.addListener(this.subscribe);
    }

    clearCallback() {
        eventManager.onShortSpeedActivated.removeListener(this.subscribe);
    }
}

class QuestPurchaseUpgrade extends QuestBase {
    constructor(prms, progress) {
        super(prms, progress);
        this.subscribe = (upgradeInfo) => {
            if (!prms.priceType || prms.priceType === upgradeInfo.priceType)
                this.increaseProgress(1);
        };
        eventManager.onUpgradePurchased.addListener(this.subscribe);
    }

    clearCallback() {
        eventManager.onUpgradePurchased.removeListener(this.subscribe);
    }
}

class QuestBuildingUpgraded extends QuestBase {
    constructor(prms, progress) {
        super(prms, progress);
        this.subscribe = (building, slot) => {
            if (slot === prms.slot || !prms.slot)
                this.increaseProgress(1);
        };
        eventManager.onBuildingUpgraded.addListener(this.subscribe);
    }

    clearCallback() {
        eventManager.onBuildingUpgraded.removeListener(this.subscribe);
    }
}

class QuestBuildingUpgraded25 extends QuestBase {
    constructor(prms, progress) {
        super(prms, progress);
        this.subscribe = (building, slot) => {
            if ((slot === prms.slot || !prms.slot) && (building.getLevel() % 25) === 0)
                this.increaseProgress(1);
        };
        eventManager.onBuildingUpgraded.addListener(this.subscribe);
    }

    clearCallback() {
        eventManager.onBuildingUpgraded.removeListener(this.subscribe);
    }
}

class QuestShare extends QuestBase {
    constructor(prms, progress) {
        super(prms, progress);
    }

    useAction() {
        socialManager.postMessage(() => {
            this.increaseProgress(1);
        });
    }

    claimReward() {
        super.claimReward();
        localStorage.setItem("quest_1000", Progress.getDayNow());
    }
}

class QuestHarvest extends QuestBase {
    constructor(prms, progress) {
        super(prms, progress);
        this.subscribe = () => {
            this.increaseProgress(1);
        };
        eventManager.onHarvestCompleted.addListener(this.subscribe);
    }

    clearCallback() {
        eventManager.onHarvestCompleted.removeListener(this.subscribe);
    }
}

class QuestsManager {
    constructor(questsFromProgress) {
        this.activeQuests = [];
        this.mainQuests = [];

        const timeNow = Progress.getTimeNow();
        const dayNow = Progress.getDayFromTime(timeNow);
        const dayWas = Progress.getDayFromTime(questsFromProgress.update);

        this.update = timeNow;
        if (dayNow === dayWas) {
            const quests = questsFromProgress.activeQuests;
            for (let i = 0; i < quests.length; i++) {
                const p = quests[i];
                const info = GameData.getQuestById(p.id);
                const quest = this._initQuest(info, p);
                this.activeQuests.push(quest);
            }
        }
        this.activateRandomQuests(this.activeQuests.length);

        const gameSettings = VisualData.getGameSettings();
        if (gameSettings.share && gameSettings.share.hasOwnProperty(AllGetParams.game_platform) && gameSettings.share[AllGetParams.game_platform]) {
            const day = localStorage.getItem("quest_1000");
            if (Progress.getDayNow() > day) {
                const quest = this._initQuest({
                    id: 1000,
                    type: 'SharePost',
                    levels: [1],
                    reward: [5],
                    info: 'SharePostInfo',
                    hasAction: true
                }, null);
                this.mainQuests.push(quest);
            }
        }
    }

    getQuestInfo(index) {
        if (this.mainQuests.length > index)
            return this.mainQuests[index];
        return this.activeQuests[index - this.mainQuests.length];
    }

    replaceQuest(index) {
        const info = GameData.getRandomQuest();
        let quest = this._initQuest(info);
        this.activeQuests[index] = quest;
        quest.replaceQuest();
    }

    questCompleted(quest) {
        eventManager.questCompleted(quest);
    }

    questClaimed(quest) {
        gameInit.progress.gotGems(quest.reward);
        this.progressChanged();
        eventManager.questClaimed(quest);
    }

    questReplaced() {
        this.progressChanged();
    }

    progressChanged() {
        gameInit.progress.saveQuestsProgress(this);
    }

    static publicGetQuest(prms, progress) {
        const type = prms.type || prms.questType;
        switch (type) {
            case "OpenBox":
                return new QuestBoxOpen(prms, progress);
            case "CollectCrop":
                return new QuestHarvest(prms, progress);
            case "CollectLastSlot":
                prms.slot = 9;
                return new QuestCollectSoulsTimes(prms, progress);
            case "Banjo":
                return new QuestShortSpeedActivate(prms, progress);
            case "Rain":
                return new QuestLongSpeedActivate(prms, progress);
            case "MacroUpgrades":
                return new QuestPurchaseUpgrade(prms, progress);
            case "BuyBox":
                return new QuestBoxPurchased(prms, progress);
            case "FirstSlotUpgrade":
                return new QuestBuildingUpgraded25(prms, progress);
            case "SeedsUpgrades":
                prms.priceType = "Seeds";
                return new QuestPurchaseUpgrade(prms, progress);
            case "CollectGold":
                return new QuestCollectSoulsTimes(prms, progress);
            //TODO not implemented
            case "Gift":
            case "NewLevelGold":
                // return new QuestBase(prms, progress);
                return new QuestCollectSoulsTimes(prms, progress);
            case "SharePost":
                return new QuestShare(prms, progress);
        }
        return null;
    }

    _initQuest(prms, progress) {
        if (!prms)
            return null;

        switch (prms.type) {
            //TODO not implemented
            case "Gift":
            case "NewLevelGold":
                prms = GameData.getQuestById(prms.id - 1);
                break;
        }
        prms.completeCallback = this.questCompleted.bind(this);
        prms.claimCallback = this.questClaimed.bind(this);
        prms.replaceCallback = this.questReplaced.bind(this);
        prms.progressChanged = this.progressChanged.bind(this);

        return QuestsManager.publicGetQuest(prms, progress);
    }

    activateRandomQuestForSlot(slot) {
        //TODO value depends on quest
        const info = GameData.getRandomQuest();
        let quest = this._initQuest(info);
        this.activeQuests[slot] = quest;
    }

    activateRandomQuests(startIndex) {
        for (let i = startIndex; i < 3; i++) {
            this.activateRandomQuestForSlot(i);
        }

        if (startIndex < 3)
            this.progressChanged();
    }

    isAnyCompleteQuest() {
        for (let i in this.activeQuests) {
            const q = this.activeQuests[i];
            if (q && q.isReadyToClaim() && !q.isComplete)
                return true;
        }
        return false;
    }
}

const ResourceIncreaseGold = 20;
const ResourceIncreaseSeed = 10;

class BonusBase {
    constructor(prms) {
        this.info = prms;
    }
    
    activateBonus() {
    }

    _getType() {
        return this.info.bonusType;
    }
    
    getIconName() {
        return "DailyBonus_" + this._getType();
    }

    getIconPath() {
        return VisualData.getDailyBonusIconsFolder() + this._getType() + ".png";
    }
    
    getText() {
        return this.info.parameter.toString();
    }

    isUpdatable() {
        return false;
    }
}

class BonusWithIndex extends BonusBase {
    constructor(prms, index) {
        super(prms);
        this.index = index;
    }
}

class BonusResources extends BonusWithIndex{

    activateBonus() {
        super.activateBonus();
        gameInit.progress.addResources(this.getCount());
    }

    getCount() {
        return Math.max(gameInit.progress.getTotalResources().multiply(Math.trunc(this.getKoeff() * RESOURCES_SCALE)).divide(RESOURCES_SCALE), 1000 * RESOURCES_SCALE);
    }

    isUpdatable() {
        return true;
    }

    getKoeff() {
        return (this.info.parameter + this.index * ResourceIncreaseGold) / 100;
    }

    getText() {
        return 'x' + (this.getKoeff() + 1).toFixed(2);
    }
}

// class BonusScaleResources extends BonusBase{
//
//     activateBonus() {
//         super.activateBonus();
//         let current = gameInit.progress.getResources();
//         gameInit.progress.addResources(Math.trunc(current * this.info.value));
//     }
// }

class BonusGems extends BonusBase {

    activateBonus() {
        super.activateBonus();
        gameInit.progress.gotGems(this.info.parameter * RESOURCES_SCALE);
    }
}

class BonusSeeds extends BonusWithIndex {

    activateBonus() {
        super.activateBonus();
        gameInit.progress.seedsEarned(this.getCount());
    }

    getKoeff() {
        return (this.info.parameter + this.index * ResourceIncreaseSeed) / 100;
    }

    getText() {
        return 'x' + (this.getKoeff() + 1);
    }

    getCount() {
        return Math.max(gameInit.progress.getTotalSeeds().multiply(Math.trunc(this.getKoeff() * RESOURCES_SCALE)).divide(RESOURCES_SCALE), 1000 * RESOURCES_SCALE);
    }

    isUpdatable() {
        return true;
    }
}

class BonusSeedsStrength extends BonusBase {

    activateBonus() {
        super.activateBonus();
        gameInit.progress.increaseBonusPerSeed(this.info.parameter);
    }

    getText() {
        return "+" + super.getText() + "%";
    }
}

class BonusBox extends BonusBase {

    activateBonus() {
        super.activateBonus();
        gameInit.progress.giveChests(BoxType.GoldBox, this.info.parameter);
    }
}

class BonusSuperBox extends BonusBase {

    activateBonus() {
        super.activateBonus();
        gameInit.progress.giveChests(BoxType.SuperBox, this.info.parameter);
    }

    _getType() {
        return "SuperBox";
    }
}

class BonusTimeTravel extends BonusBase {
    activateBonus() {
        super.activateBonus();
        gameInit.upgradePurchased({
            upgradeType: this.info.bonusType,
            parameter: this.info.parameter * 3600
        });
    }
}

class DailyBonus
{
    constructor(seed, data) {
        this.bonuses = {};
        this.goldIndex = 0;
        this.seedIndex = 0;

        const totalDays = 30;
        const randomPrizes = [];
        let takenDays = 0;

        for (let k in data) {
            const info = data[k];
            const day = info.number || info.dayOfMonth;
            if (day > 0) {
                const bonus = this._generateBonus(info);
                this.bonuses[day] = bonus;
                takenDays++;
            } else
                randomPrizes.push(info);
        }

        for (let i = 0; i < randomPrizes.length && randomPrizes.length < (totalDays - takenDays);i++) {
            randomPrizes.push(randomPrizes[i]);
        }

        const rnd = new Random(seed);

        for (let i = 1; i<= totalDays;i++) {
            if (!this.bonuses.hasOwnProperty(i)) {
                const ind = Math.trunc(rnd.nextFloat() * randomPrizes.length);
                const bonus = this._generateBonus(randomPrizes[ind]);
                if (bonus)
                    this.bonuses[i] = bonus;
                randomPrizes.splice(ind, 1);
            }
        }
    }

    _generateBonus(info) {
        switch (info.bonusType) {
            case "Gold": return new BonusResources(info, this.goldIndex++);
            case "Box": return new BonusBox(info);
            case "SuperBox":
            case "MiddlePuzzle":
            case "SuperPuzzle":
            case "Puzzle":
                return new BonusSuperBox(info);
            case "TimeTravel": return new BonusTimeTravel(info);
            case "Seed": return new BonusSeeds(info, this.seedIndex++);
            case "SeedStrength": return new BonusSeedsStrength(info);
            case "Crystal":
            case "MegaCrystal":
                return new BonusGems(info);
        }
        return null;
    }

    getBonusForDay(day){
        return this.bonuses[day];
    }
}

class WheelPrizeBase {
    constructor(prms) {
        this.info = prms;
    }

    getChance() {
        return this.info.chance;
    }
    
    activateBonus() {
        gameInit.progress.incJackPotSize();
    }

    getType() {
        return this.info.bonusType;
    }
    
    getIconName() {
        return "DailyBonus_" + this.info.bonusType;
    }

    getIconPath() {
        return VisualData.getDailyBonusIconsFolder() + this.info.bonusType + ".png";
    }
    
    getText() {
        return this.info.parameter;
    }

    needToUpdate() {
        return false;
    }
}

class WheelResources extends WheelPrizeBase {
    
    activateBonus() {
        super.activateBonus();
        gameInit.progress.addResources(this._getBonusSize());
    }

    _getBonusSize()
    {
        let biggest;
        const seeds = gameInit.progress.getTotalSeeds();
        if (seeds.compare(RESOURCES_SCALE) > 0) {
            biggest = seeds.multiply(1000);
        } else
            biggest = bigInt(1000 * RESOURCES_SCALE);

        const production = GetAllBuildingsProduction(20 * 60);
        return production.compare(biggest) >= 0 ? production : biggest;
    }

    getText() {
        return LocalizationManager.getLocalizedNumber(this._getBonusSize());
    }

    needToUpdate() {
        return true;
    }
}

class WheelGems extends WheelPrizeBase {

    activateBonus() {
        super.activateBonus();
        gameInit.progress.gotGems(this.info.parameter);
    }

    getText() {
        return Math.round(this.info.parameter / RESOURCES_SCALE);
    }
}

class WheelJackPot extends WheelPrizeBase {

    activateBonus() {
        // super.activateBonus(); Don't call it
        gameInit.progress.giveJackPot();
    }

    getText() {
        return Math.round(gameInit.progress.getJackPotSize() / RESOURCES_SCALE);
    }

    needToUpdate() {
        return true;
    }
}

class WheelBox extends WheelPrizeBase {

    activateBonus() {
        super.activateBonus();
        gameInit.progress.giveChests(BoxType.GoldBox, this.info.parameter);
    }
}

class WheelTimeTravel extends WheelPrizeBase {
    activateBonus() {
        super.activateBonus();
        gameInit.upgradePurchased({
            upgradeType: this.info.bonusType,
            parameter: this.info.parameter * 60
        });
    }
}

class WheelOfFortune
{
    constructor() {
        this.bonuses = [
            new WheelTimeTravel({
                chance: 10,
                parameter: 30,
                bonusType: "TimeTravel"
            }),
            new WheelBox({
                chance: 5,
                parameter: 1,
                bonusType: 'Box',
            }),
            new WheelJackPot({
                chance: 3,
                bonusType: 'JackPot'
            }),
            new WheelTimeTravel({
                chance: 35,
                parameter: 15,
                bonusType: "TimeTravel",
            }),
            new WheelGems({
                chance: 12,
                parameter: 5 * RESOURCES_SCALE,
                bonusType: 'Gems'
            }),
            new WheelResources({
                chance: 35,
                bonusType: 'Gold'
            })
        ];
    }

    getBonuses() {
        return this.bonuses;
    }
}

class PhotoManager {
    constructor(progress) {
        this.activeQuests = {};

        progress.onPuzzleCompleted.addListener(this.newPuzzleCompleted.bind(this));
        const photoData = GameData.getPhotoData();

        for (let i = 0; i < photoData.length; i++) {
            const p = photoData[i];
            this._addPhotoQuest(p);
        }

        eventManager.onHarvestCompleted.addListener(this._harvestCompleted.bind(this));
    }

    _harvestCompleted() {
        const count = gameInit.progress.getHarvestsCount();
        const photos = GameData.getPrestigePhotos();
        for (let v of photos) {
            if (v.prestigeCount == count) {
                gameInit.progress.addPhotoForPrestige(v);
                break;
            }
        }
    }

    _addPhotoQuest(photoData) {
        if (!photoData.goodsId)
            return;

        const puzzleInfo = gameInit.progress.getPuzzleInfoById(photoData.goodsId - 1);
        const myQ = gameInit.progress.getPhotoQuestById(photoData.id);
        if (puzzleInfo.level >= photoData.level && !myQ.isComplete) {
            const quest = this._initQuest(photoData, myQ);
            this.activeQuests[photoData.id] = quest;
        }
    }

    newPuzzleCompleted(info) {
        const data = GameData.getPhotoDataBySlotId(info.id);
        if (data)
            this._addPhotoQuest(data);
    }

    questCompleted(quest) {

    }

    questClaimed(quest) {
        quest.clearCallback();
        gameInit.progress.savePhotoQuestsCompleted(quest);
        delete this.activeQuests[quest.info.id];
    }

    progressChanged(quest) {
        gameInit.progress.savePhotoQuestsProgress(quest);
    }

    _initQuest(prms, progress) {
        if (!prms)
            return null;

        prms.completeCallback = this.questCompleted.bind(this);
        prms.claimCallback = this.questClaimed.bind(this);
        prms.progressChanged = this.progressChanged.bind(this);

        return QuestsManager.publicGetQuest(prms, progress);
    }

    getQuestById(id) {
        return this.activeQuests.hasOwnProperty(id) ? this.activeQuests[id] : null;
    }
}

class GuardInfo {
    constructor(info) {
        this.id = info.id;
        this.isBase = info.isBase;
        this.tokenType = info.tokenType;//tokens player get if he gets duplicate puzzle
        this.title = info.title;
        this.unlockTier = info.unlockTier;
        this.passives = info.passives;
        this.passiveLevels = [];
        for (let i in info.passiveLevels)
            this.passiveLevels.push(parseInt(info.passiveLevels[i]));
        this.activeLevels = [];
        for (let i in info.activeLevels)
            this.activeLevels.push(parseInt(info.activeLevels[i]));
        this.level = -1;
    }

    setLevel(level) {
        this.level = level;
    }

    getRefundType() {
        return this.tokenType;
    }

    getPassiveBonusesType() {
        return this.passives;
    }

    getPassiveBonusValue() {
        return this.passiveLevels[this.level];
    }

    getPassiveBonusValueMinimum() {
        return this.passiveLevels[this.level > 0 ? this.level : 1];
    }

    getActiveBonusValue() {
        return this.activeLevels[this.level];
    }

    getActiveBonusValueMinumum() {
        return this.activeLevels[this.level > 0 ? this.level : 1];
    }
}

class GuardManager {
    constructor(data) {
        this.guards = [];
        this.guardsByID = {};
        this.guardsPerWorld = {};
        for (let i in data) {
            const g = new GuardInfo(data[i]);
            this.guardsByID[g.id] = g;
            this.guards.push(g);
        }
    }

    _getBaseGuardId() {
        for (let i in this.guards) {
            if (this.guards[i].isBase)
                return this.guards[i];
        }
    }

    getGuardById(id) {
        return this.guardsByID[id];
    }

    getGuardIcon(id) {
        const guard = this.getGuardById(id);
        if (!guard)
            console.error("no guard found " + id);
        else {
            return guard.title;
        }
        return null;
    }

    setProgress(progress) {
        const allPuzzles = progress.savedProgress.puzzle;
        const puzzles = allPuzzles.guards ? allPuzzles.guards : allPuzzles.guards = [];
        for (let i in puzzles) {
            const p = puzzles[i];
            const g = this.getGuardById(p.id);
            if (!g) {
                console.error("Guard wasn't found for puzzle", p);
            } else
                g.setLevel(p.level);
        }

        for (let i in this.guards) {
            const g = this.guards[i];
            if (g.level < 0) {
                //add to save
                const level = g.isBase ? 1 : 0;
                puzzles.push({
                    id: g.id,
                    level: level,
                    pieces: 0
                });
                g.setLevel(level);
            }
        }

        const baseGuard = this._getBaseGuardId();
        if (!baseGuard)
            console.error("No Base Guard specified");
        const worlds = progress.savedProgress.worlds;
        for (let i in worlds) {
            const w = worlds[i];
            if (!w.guards)
                w.guards = {
                    "1": {
                        id: baseGuard.id
                    }
                };

            this._setGuardForWorld(i, this.getGuardById(w.guards["1"].id));
        }

        progress.onGuardPuzzleCompleted.addListener(this.puzzleCompleted.bind(this));
    }

    doesWorldHasGuard(worldId, guard) {
        const info = this.guardsPerWorld[worldId];
        return info.guard === guard;
    }

    isGuardBusy(guard_id) {
        const g = this.guards[guard_id];
        if (g.isBase)
            return false;

        for (let i in this.guardsPerWorld) {
            const guard = this.guardsPerWorld[i].guard;
            if (guard.id === guard_id)
                return true;
        }
        return false;
    }

    _setGuardForWorld(worldId, guard) {
        const info = this.guardsPerWorld[worldId] = {
            guard: guard
        };

        const passives = guard.getPassiveBonusesType();
        for (let i in passives) {
            switch (passives[i]) {
                case 'UnlimitedPlace':
                    info.unlimited = true;
                    break;
                case 'MultiProfit':
                case 'MultiProfitLow':
                    info.multiProfit = guard.getPassiveBonusValue();
                    break;
                case 'SeedProc':
                    info.seedsBonus = guard.getPassiveBonusValue();
                    break;
            }
        }
    }

    getGuardForWorld(worldId) {
        return this.guardsPerWorld[worldId].guard;
    }

    getActiveBonusForWorld(worldId) {
        const guard = this.guardsPerWorld[worldId].guard;
        return guard.getActiveBonusValue();
    }

    getSeedsBonusForWorld(worldId) {
        const world = this.guardsPerWorld[worldId];
        return world.seedsBonus || 0;
    }

    getProfitMultiplier(worldId) {
        const world = this.guardsPerWorld[worldId];
        return world.multiProfit || 0;
    }

    switchGuard(worldId, guard) {
        this._setGuardForWorld(worldId, guard);
        gameInit.progress.switchGuard(worldId, guard);
    }

    puzzleCompleted(info) {
        const guard = this.getGuardById(info.id);
        if (guard) {
            guard.level = info.level;
            //TODO recalculate bonuses from this guard - check it
            eventManager.guardLeveledUp(guard);
        }
        else
            console.error("guard wasn't found by id ", info);
    }

    //
    // UnlimitedPlace - можно ставить несколько копий
    // MultiProfit - + производительность
    // MultiProfitLow - + производительность для апгрейд тиров 1-Х (Х определяется где то в гейм конфиге, вроде бы)
    // SeedProc - + к бонусу от престиж валюты
}

class AchsManager {
    constructor() {
        this.delayTimers = {};
    }

    callWithDelay(key, action, delay = 5000) {
        if (this.delayTimers[key])
            clearInterval(this.delayTimers[key]);

        this.delayTimers[key] = setTimeout(() => {
            action();
            this.delayTimers[key] = null;
        }, delay);
    }

    reportPrestige(revenue) {
        if (!CURRENT_UN_DATA)
            return;

        UnnyNet.UnnyNet.reportAchievements(CURRENT_UN_DATA.achievements.factory, 1);

        const length = revenue.toString().length - 2;//because of RESOURCES_SCALE
        UnnyNet.UnnyNet.reportLeaderboards(CURRENT_UN_DATA.leaderboards.factory, length);
    }

    slotWasUpgraded(building) {
        if (!CURRENT_UN_DATA)
            return;

        const intSlot = parseInt(building.slot);
        if (intSlot >= 1 && intSlot <= 9) {
            this.callWithDelay('slot_' + building.slot, () => {
                UnnyNet.UnnyNet.reportAchievements(CURRENT_UN_DATA.achievements["slot_" + intSlot], building.getLevel(), (response) => {
                    if (!response.success)
                        console.error("response", response);
                });
            });
        }
    }

    boxWasOpened(total) {
        if (CURRENT_UN_DATA)
            this.callWithDelay('boxes', () => {
                UnnyNet.UnnyNet.reportLeaderboards(CURRENT_UN_DATA.leaderboards.boxes, total);
            }, 10000);
    }
}

const achsManager = new AchsManager();

class GameInit{
    constructor() {
        this.preload = new UnnyAction();
        this.create = new UnnyAction();
        this.update = new UnnyAction();
        this.loaded = new UnnyAction();
        this.reseted = new UnnyAction();
        this.onBuildingCreated = new UnnyAction();
        this.onBuildingUpgraded = new UnnyAction();
        this.onResourcesCollected = new UnnyAction();
        this.onResourcesUpdated = new UnnyAction();
        this.onBuildingResourcesUpdated = new UnnyAction();
        this.onBuildingUpdated = new UnnyAction();
        this.onBuildingLiked = new UnnyAction();
        this.onWorldChanged = new UnnyAction();
        this.onWorldPreChanged = new UnnyAction();

        this.allWorlds = [];
        this.selectedWorld = "1";
    }

    GamePreload(engine) {
        this.engine = engine;

        const load = engine.load;
        load.setPath(VisualData.getDataFolder());
        const oldSystem = !!CURRENT_ENVIRONMENT.env;
        if (oldSystem) {
            load.json('GoodsData', 'goods_data.json');
            load.json('SlotsUpgrade', 'slots_upgrade_data.json');
            load.json('MarketData', 'market_upgrades.json');
            load.json('BoxData', 'box_data.json');
            load.json('QuestsData', 'dailyquests_data.json');
            load.json('LoginData', 'loginbonus_data.json');
        }
        load.json('InAppLots', 'in_app_lots.json?v=3');

        // if (VisualData.getGameSettings().photos)
        //     load.json('PhotoData', 'photo_data.json');

        load.setPath(VisualData.getFolderPath());
        const localization = 'Localization_' + GameSettings.language;
        load.json(localization, VisualData.getLocalizationsFolder() + localization + '.json');

        const atlas = VisualData.getAtlasPath();
        if (atlas)
            load.multiatlas('atlas_sprites', atlas);

        this.preload.callListeners(engine);
    }

    upgradePurchased(data) {
        for (let key in this.allWorlds) {
            const world = this.allWorlds[key];
            world.upgradePurchased(data);
        }

        switch (data.upgradeType) {
            case 'SeedProc':
                this.progress.increaseBonusPerSeed(data.parameter);
                break;
            //TODO implement those:
            case 'SuperSeed':
            case 'Upgrade':
                break;
        }
    }

    LoadProgress() {
        // const purchases = this.progress.getAllPurchases();
        // for (let key in purchases) {
        //     const data = GameData.getMarketPurchaseById(key);
        //     this.upgradePurchased(data);
        // }
        let offlineResourcesCollected = bigInt(0);

        eventManager.onLoadResourcesAdded.clear();
        eventManager.onLoadResourcesAdded.addListener((resources)=>{
            offlineResourcesCollected = offlineResourcesCollected.add(resources);
        });

        const worlds = this.progress.getWorlds();
        for (let key in worlds) {
            const w = new World(this, key);
            this.allWorlds.push(w);
            w.onBuildingCreated.addListener(this.buildingCreated.bind(this));
            w.onBuildingUpgraded.addListener(this.buildingUpgraded.bind(this));
            w.onResourcesCollected.addListener(this.resourcesCollected.bind(this));
            w.onBuildingPreUpgrade.addListener(this.buildingPreUpgrade.bind(this));
            w.onBuildingUpdated.addListener(this.buildingUpdated.bind(this));
            w.onResourcesUpdated.addListener(this.buildingResourcesUpdate.bind(this));
            w.onBuildingLiked.addListener(this.buildingLiked.bind(this));
            w.loadProgress(this.progress);
        }

        eventManager.offlineCollected(Progress.getTimeNow() - this.progress.getLastDoubleTime(), offlineResourcesCollected);

        this.loaded.callListeners(this.progress);
    }

    GameCreate(engine, hideCallback) {
        const cache = engine.cache;
        const oldSystem = !!CURRENT_ENVIRONMENT.env;
        const data = oldSystem ? {
                GoodsData: cache.json.get('GoodsData'),
                SlotsUpgrade: cache.json.get('SlotsUpgrade'),
                MarketData: cache.json.get('MarketData'),
                BoxData: cache.json.get('BoxData'),
                QuestsData: cache.json.get('QuestsData'),
                LoginData: cache.json.get('LoginData'),
                InAppLots: cache.json.get('InAppLots')
            } :
            {
                InAppLots: cache.json.get('InAppLots')
            };

        if (oldSystem)
        {
            const localization = 'Localization_' + GameSettings.language;
            const json = cache.json.get(localization);
            GameSettings.allLanguages[GameSettings.language] = json;
            LocalizationManager.initWithJson(json);
        }

        socialManager.setAllGetParams(parseGetParams());
        try {
            socialManager.initialize(VisualData.getGameSettings());
        } catch (e) {
            console.error(e);
        }

        let platform;
        switch (AllGetParams.game_platform) {
            case "vk":
                platform = UnnyNet.Platform.VKONTAKTE;
                break;
            case "ok":
                platform = UnnyNet.Platform.ODNOKLASSNIKI;
                break;
            case "fb":
                platform = UnnyNet.Platform.FACEBOOK;
                break;
            case "fb_instant":
                platform = UnnyNet.Platform.FB_INSTANT;
                break;
            case "nutaku":
                platform = UnnyNet.Platform.NUTAKU;
                break;
        }

        UnnyNet.UnnyNet.initialize({
            game_id: CURRENT_ENVIRONMENT.un_game_id,
            public_key: CURRENT_ENVIRONMENT.un_key,
            default_channel: "0",
            open_animation: UnnyNet.ViewOpenDirection.RIGHT_TO_LEFT,
            game_login: false,
            platform: platform,
            load_dictionaries: !oldSystem,
            debug: DEBUG_MODE,
            environment: CURRENT_ENVIRONMENT.environment,
            fb_app_id: VisualData.getGameSettings().fb_app_id//TODO it's temporary here
        }, ()=> {
            console.info("DONE");
            UnnyNet.UnnyNet.setFrame({
                top: 0,
                right: 0,
                left: '',
                bottom: 0,
                width: '37%',
                height: '100%'
            });

            if (!oldSystem) {
                const rgc = UnnyNet.UnnyNet.RGC;
                data.GoodsData = rgc.getDictionary("slots");
                data.SlotsUpgrade = rgc.getDictionary("slotsUpgrades");
                data.MarketData = rgc.getDictionary("upgrades");
                data.BoxData = rgc.getDictionary("boxes");
                data.LoginData = rgc.getDictionary("loginBonuses");
                data.QuestsData = rgc.getDictionary("dailyQuests");
                data.TutorialConfig = rgc.getDictionary("tutorialConfig");

                if (VisualData.getGameSettings().photos) {
                    data.PhotoData = rgc.getDictionary("photos");
                    data.TokenData = rgc.getDictionary("tokensConfig");
                    data.PrestigePhotos = rgc.getDictionary("prestigePhotos");
                }

                this.gameConfig = rgc.getDictionary("gameConfig");

                if (VisualData.getGameSettings().guards)
                    this.guardManager = new GuardManager(rgc.getDictionary("managers"));

                LocalizationManager.initWithJson(rgc.getDictionary("localizationEnglish"));
            }

            GameData.prepareGameData(data);

            const useGoblin = !!CURRENT_ENVIRONMENT.hmac;

            const loadProgress = () => {
                Progress.loadProgressFromServer((progress) => {
                    this.progress = new Progress(this, progress, this.gameConfig, useGoblin);
                    if (this.gameConfig)
                        this.playerInfo = new PlayerInfo(this.gameConfig.playerLevels, this.progress);
                    if (this.guardManager)
                        this.guardManager.setProgress(this.progress);
                    this.progress.onUpgradePurchased.addListener(this.upgradePurchased.bind(this));

                    this.create.callListeners(engine);

                    this.time = engine.time.now / 1000;
                    this.LoadProgress();

                    this.questsManager = new QuestsManager(this.progress.getQuestsProgress());
                    if (VisualData.getGameSettings().photos)
                        this.photoManager = new PhotoManager(this.progress);

                    audioManager.load(engine);

                    hideCallback();
                }, useGoblin);
            };

            if (useGoblin) {
                socialManager.authorize(() => {
                    loadProgress();
                });
            } else
                loadProgress();
        });
    }

    GameUpdate(engine) {
        if (!this.progress)
            return;

        const newTime = engine.time.now / 1000;
        this.deltaTime = newTime - this.time;
        this.time = newTime;

        this.update.callListeners(this.deltaTime);

        // const daynow = Progress.getDayNow();
        // if (this.daynow !== daynow) {
        //     // console.log("DAY " + daynow);
        //     this.daynow = daynow;
        // }
    }

    buildingPreUpgrade(world, building) {
        const price = building.getUpgradePrice();
        this.progress.resourcesSpent(price);
        this.onResourcesUpdated.callListeners(this.progress);
    }

    resourcesCollected(building, resources) {
        this.onResourcesCollected.callListeners(building, resources);
        this.onResourcesUpdated.callListeners(this.progress);
    }

    buildingResourcesUpdate(world, building) {
        this.onBuildingResourcesUpdated.callListeners(world, building);
    }

    buildingCreated(world, building) {
        this.onBuildingCreated.callListeners(world, building);
    }

    buildingUpgraded(world, building) {
        this.onBuildingUpgraded.callListeners(world, building);
    }

    buildingUpdated(world, building) {
        this.onBuildingUpdated.callListeners(world, building);
    }

    buildingLiked(world, building) {
        this.onBuildingLiked.callListeners(world, building);
    }

    harvestCompleted(dontReset) {
        this.progress.harvestCompleted(dontReset);
        this.reseted.callListeners(this.progress);
    }

    getBuildingById(worldIndex, id) {
        return this.allWorlds[worldIndex - 1].getBuildingById(id);
    }

    switchWorld(worldId) {
        if (!this.progress.canOpenOtherWorld()) {
            guiManager.openNewWindow(WindowType.WinOtherWorlds);
        } else {
            this.onWorldPreChanged.callListeners(() => {
                this.selectedWorld = worldId;
                this.onWorldChanged.callListeners(this.selectedWorld);
            });
        }
    }

    switchToTheNextWorld() {
        this.switchWorld((parseInt(this.selectedWorld) % VisualData.getWorldsCount() + 1).toString());//TODO test it
    }

    openLikesForBuilding(building) {
        this.likedBuilding = building;
        if (socialManager.openLikes)
            socialManager.openLikes();
    }

    likedSuccessfull(ids) {
        if (this.likedBuilding)
            this.likedBuilding.addLikes(ids);
    }
}

let gameInit = new GameInit();

if (!String.prototype.format) {
    String.prototype.format = function() {
        var args = arguments;
        return this.replace(/{(\d+)}/g, function(match, number) {
            return typeof args[number] !== 'undefined'
                ? args[number]
                : match
                ;
        });
    };
}

let LocalizationManager = (function() {

    const ALPHABET = 'abcdefghijklmnopqrstuvwxyz';
    let ALL_WORDS = null;

    _getLocalizization = function(text){
        if (ALL_WORDS.hasOwnProperty(text))
            return ALL_WORDS[text];
        return "!!!" + text;
    };

    _getNumberText = function (count){
        if (count >= 1 && count <= 4)
            return this._getLocalizization("GoldString" + count);

        if (count >= 5) {
            count -= 5;
            const alpLen = ALPHABET.length;
            if (count < ALPHABET.length) {
                const char = ALPHABET.charAt(count);
                return char + char;
            } else {
                count -= alpLen;
                if (count < ALPHABET.length) {
                    const char = ALPHABET.charAt(count).toUpperCase();
                    return char + char + char;
                } else {
                    count -= alpLen;
                    if (count < ALPHABET.length) {
                        const char = ALPHABET.charAt(count).toUpperCase();
                        return char + 'x4';
                    } else {
                        count -= alpLen;
                        if (count < ALPHABET.length) {
                            const char = ALPHABET.charAt(count).toUpperCase();
                            return char + 'x5';
                        } else {
                            count -= alpLen;
                            if (count < ALPHABET.length) {
                                const char = ALPHABET.charAt(count).toUpperCase();
                                return char + 'x6';
                            } else
                                return '!!!'
                        }
                    }
                }
            }
        }

        return null;
    };

    return {
        initWithJson(json) {
            ALL_WORDS = json;
        },

        getLocalizization(text, defaultText){
            if (ALL_WORDS.hasOwnProperty(text))
                return ALL_WORDS[text];
            if (defaultText)
                return defaultText;
            return "!!!" + text;
        },

        getTutorialLocalizization(text){
            return text;
        },

        removeCodes(text) {
            text = text.split("\\n").join("");

            while (true) {
                const index = text.indexOf("<");
                if (index < 0)
                    break;

                const index2 = text.indexOf(">");
                if (index >= index2)
                    break;

                text = text.slice(0, index) + text.slice(index2 + 1);
            }

            return text;
        },

        getLocalizedNumberString(str, shorter_all = true){
            if (str.length <= 2)
                return "0";

            str = str.substring(0, str.length - 2);

            const len = str.length;
            if (len <= 4 && shorter_all)
                return str;

            let count = Math.trunc(len / 3);
            let numbersCount = len - count * 3;
            if (numbersCount === 0) {
                numbersCount = 3;
                count--;
            }

            const letters = _getNumberText(count);
            let number = str.substring(0, numbersCount);
            if (len >= 4) {
                const decimal = str.substring(numbersCount, numbersCount + 1);
                if (decimal !== '0')
                    number += ',' + decimal;
            }
            return letters ? number + ' ' + letters : str;
        },

        getLocalizedNumber(bigNumber){
            return this.getLocalizedNumberString(bigNumber.toString());
        },

        getStoreItemTitle(item) {
            if (!item.upgradeType)
                return this.getLocalizization(item.title);

            let name = "Title";
            switch (item.upgradeType) {
                case "MultiProfit": {
                    if (item.priceType === "Gems")
                        name = "GemsTitle";
                    else {
                        if (item.slotNumber < 0)
                            name = "AllTitle";
                    }
                    break;
                }
                case "TimeTravel": {
                    name = "Title" + item.parameter;
                    break;
                }
            }

            return this.getLocalizization(item.upgradeType + name);
        },

        getStoreItemDescription(item) {
            if (!item.upgradeType)
                return this.getLocalizization(item.description).format(item.originalGems);

            let name = "Desc";
            switch (item.upgradeType) {
                case "MultiProfit": {
                    switch (item.priceType) {
                        case "Gems":
                            return this.getLocalizization(item.upgradeType +"GemsDesc");
                        case "Gold":
                        case "Seeds":
                            if (item.slotNumber >= 0)
                                return this.getLocalizization(item.upgradeType +"DescMultiSlot").format(item.slotNumber + 1, item.parameter);
                            else
                                return this.getLocalizization(item.upgradeType +"AllDesc").format(item.parameter);
                    }
                    break;
                }
                case "SeedProc": {
                    return this.getLocalizization(item.upgradeType +"Desc").format(item.parameter);
                }
                case "TimeTravel": {
                    return this.getLocalizization(item.upgradeType + "Desc" + item.parameter);
                }
                case "Upgrade": {
                    return this.getLocalizization("UpgradeDescMultiSlot").format(item.parameter, item.slotNumber + 1);
                }
                case "AutoClick": {
                    if (item.slotNumber >= 0)
                        return this.getLocalizization(item.upgradeType +"DescMultiSlot").format(item.slotNumber + 1);
                    else
                        return this.getLocalizization(item.upgradeType +"Desc");
                }
            }
            return this.getLocalizization(item.upgradeType + name);
        }
    }
})();

class Loader {
    constructor(parent, backImg, frontImg, x, y, scale, makeFast, isCircular) {
        scale = scale || 1;
        if (backImg) {
            this.back = parent.scene.add.sprite(x, y, backImg).setScale(scale).setDepth(parent.depth + 1);
            parent.add(this.back);
        }

        this.parent = parent;
        this.x = x;
        this.y = y;

        this.progressBar = parent.scene.add.sprite(x, y, frontImg).setScale(scale).setDepth(parent.depth + 2);
        this.isCircular = isCircular;
        if (isCircular) {
            this.loadMask = parent.scene.make.graphics();
            this.loadMask.setPosition(x * localScale, y * localScale);
            this.progressBar.mask = new Phaser.Display.Masks.GeometryMask(parent.scene, this.loadMask);
        } else {
            this.progressBar.setOrigin(0, 0.5).setPositionX(this.progressBar.x / localScale - this.progressBar.width / 2 * scale * imageSizeLocalScale / localScale);
        }
        this.scale = scale;
        this.value = -1;

        parent.add(this.progressBar);

        if (makeFast) {
            this._makeFast();
            this.fastBar.obj.setForceInvisible(true);
        }
    }

    setTint(color) {
        this.progressBar.tint = color;
    }

    setVisible(visible) {
        if (this.back)
            this.back.setVisible(visible);
        this.progressBar.setVisible(visible);
    }

    setProgress(value) {
        if (Math.abs(value - this.value) > 0.005) {
            if (this.isCircular) {
                const loadBar = this.loadMask;
                loadBar.clear();
                loadBar.lineStyle(20, 0, 1);
                loadBar.beginPath();
                loadBar.arc(0, 0, 20, 0, Math.PI * 2 * value, false);
                loadBar.strokePath();
                loadBar.closePath();
            } else {
                this.value = Math.min(value, 1);
                this.progressBar.setScale(this.value * this.scale, this.scale);
            }
            return true;
        }
        return false;
    }

    _makeFast() {
        if (this.isCircular) {
            this.fastBar = {
                obj: this.parent.scene.add.sprite(this.x, this.y, 'FastProduction')
            };
            // animManager.rotationCircleAnimation(this.fastBar.obj, 1, null);
        } else {
            this.fastBar = PrepareSpriteSheetObject(this.parent.scene, 'FastProduction', this.x, this.y);
        }
            this.fastBar.obj.setDepth(this.parent.depth + 2);
            this.fastBar.obj.setScale(1.1);
            this.parent.add(this.fastBar.obj);
    }

    setFast(fast) {
        this.fastBar.obj.forceInvisible = this.progressBar.visible = !fast;
        this.progressBar.forceInvisible = fast;

        if (this.parent.visible !== false || !fast)
            this.fastBar.obj.setVisible(fast);
    }

    getOriginX() {
        return this.progressBar.x / localScale;
    }

    getWidth() {
        return this.progressBar.width;
    }
}

class SpriteSheetObject {
    constructor(obj, info) {
        this.obj = obj;
        this.frame = 0;
        this.time = 0;
        this.info = info;
        gameInit.update.addListener(this.update.bind(this));
    }

    setVisible(visible) {
        this.obj.setVisible(visible);
    }

    update(deltaTime) {
        if (this.obj.visible) {
            this.time += deltaTime;
            if (this.time >= this.info.period) {
                this.time -= this.info.period;
                this.frame = (this.frame + 1) % this.info.frames;
                this.obj.setFrame(this.frame);
            }
        }
    }
}

class AnimatedObject {

    constructor(obj, animations) {
        this.obj = obj;
        this.animations = animations;
        this.nextPlay = 0;
        this.playAppear();
        this.visible = true;
    }

    getAnimationDuration(name) {
        // return 0;
        const anims = this.obj.skeletonData.animations;
        for (let i in anims) {
            if (anims[i].name === name)
               return anims[i].duration;
        }
        return 0;
    }

    playAnimation(name, force) {
        const duration = this.getAnimationDuration(name);

        const time = Progress.getTimeNow() / 1000;
        if (time >= this.nextPlay || force) {
            this.nextPlay = time + duration;
            this.obj.play(name);
            if (this.animations.idle)
                this.obj.addAnimation(0, this.animations.idle, true, duration);
        }
    }

    getObject() {
        return this.obj;
    }

    setPosition(x, y) {
        return this.obj.setPosition(x, y);
    }

    setVisible(visible) {
        this.visible = visible;
        this.obj.setVisible(visible);
    }

    destroy(param) {
        this.obj.destroy(param);
    }

    playAction(force) {
        if (this.animations.action)
            this.playAnimation(this.animations.action, force);
    }

    playAppear(force) {
        if (this.animations.appear)
            this.playAnimation(this.animations.appear, force);
    }

    playDisappear(force) {
        if (this.animations.disappear)
            this.playAnimation(this.animations.disappear, force);
    }

    _play(anim) {
        this.obj.play(anim, true);
    }

    playActiveLoop() {
        if (this.animations.active)
            this._play(this.animations.active);
    }

    playIdleLoop() {
        if (this.animations.idle)
            this._play(this.animations.idle);
    }
}

let GlobalInputLocked = false;

const GlobalClickables = [];

let LockedAnimatedObject = null;
let focused_object = null;

function lockAtOneAnimatedObject(animatedObject) {
    LockedAnimatedObject = animatedObject;
    GlobalInputLocked = false;
}

function unlockAnimatedObject() {
    LockedAnimatedObject = null;
    GlobalInputLocked = false;
}

function SetClickablesActive(active) {
    if (active) {
        for (let i = GlobalClickables.length - 1; i >= 0; i--) {
            const gr = GlobalClickables[i];
            if (gr && gr.active)
                gr.setInteractive();
            else
                GlobalClickables.splice(i, 1);
        }
    } else {
        for (let i = GlobalClickables.length - 1; i >= 0; i--) {
            const gr = GlobalClickables[i];
            if (gr && gr.active)
                gr.disableInteractive();
            else
                GlobalClickables.splice(i, 1);
        }
    }
}

function timeToStringClock(time) {
    function giveTimeNumberAsString(number) {
        if (number >= 10)
            return number;
        return "0" + number;
    }

    const hours = Math.trunc(time / 3600);
    const minutes = Math.trunc((time % 3600) / 60);
    const seconds = Math.trunc(time % 60);
    if (hours > 0)
        return "{0}:{1}:{2}".format(giveTimeNumberAsString(hours), giveTimeNumberAsString(minutes), giveTimeNumberAsString(seconds));
    else
        return "{0}:{1}".format(giveTimeNumberAsString(minutes), giveTimeNumberAsString(seconds));
}

let spineMethodsReady = false;
function PrepareSpineMethods(obj) {
    if (!spineMethodsReady) {
        spineMethodsReady = true;
        const scale = localScale;
        // const scale = imageSizeLocalScale;
        const prot = obj.constructor.prototype;
        const oldSpinePosition = prot.setPosition;
        function newSpinePosition(x, y) {
            return oldSpinePosition.call(this, x * scale, y * scale);
        }

        const oldSpineScale = prot.setScale;
        function newSpineScale(x, y) {
            return oldSpineScale.call(this, x * scale, y ? y * scale : y);
        }

        prot.setPosition = newSpinePosition;
        prot.setScale = newSpineScale;
        prot.setScale2 = function (x, y) {
            return oldSpineScale.call(this, x * imageSizeLocalScale, y ? y * imageSizeLocalScale : y);
        };

        obj.setPosition(obj.x, obj.y);

        overloadSetVisible(prot);
    }
}

function PrepareSpriteSheetObject(engine, name, x, y) {
    const allObj = VisualData.ALL_OBJECTS[name];
    const sprite = engine.add.sprite(x, y, name);
    return new SpriteSheetObject(sprite, allObj);
}

function addInvisibleClickable(engine, group, depth, x, y, scale) {
    const obj = engine.add.sprite (0,0).setInteractive();
    obj.clickable = true;
    if (group) {
        obj.setVisible(group.visible);
        group.add(obj);
    }
    obj.setPosition(x / localScale, y / localScale);
    const scalesize = 10 * GlobalScale / imagesDeltaScale;
    obj.setScale(scalesize * (scale ? scale.x : 1), scalesize * (scale ? scale.y : 1));
    obj.setDepth(depth).setOrigin(0.5, 0.9);
    obj.clicker = true;
    return obj;
}

function PrepareObject(objects, group, engine, depth, pos, clickCallback) {
    let main = null;
    for (let i = 0;i < objects.length;i++) {
        const b = objects[i];
        if (!b.name)
            continue;

        let x = (pos ? pos.x : 0) + VisualData.MAP_PARAMS.center.x;
        let y = (pos ? pos.y : 0) + VisualData.MAP_PARAMS.center.y;

        if (b.hasOwnProperty('x'))
            x += b.x;
        if (b.hasOwnProperty('y'))
            y += b.y;

        const allObj = VisualData.ALL_OBJECTS[b.name];

        let obj;
        const clickable = b.click && clickCallback;
        switch (allObj.type) {
            case UnnyObjectType.SpriteSheet: {
                const sprite = group.create(x, y, b.name);
                if (clickable)
                    sprite.setInteractive();
                if (allObj.hasOwnProperty('animation')) {
                    const animName = allObj.animation.key;
                    sprite.anims.load(animName);
                    sprite.anims.play(animName);
                }
                obj = sprite;

                main = new SpriteSheetObject(obj, allObj);
                break;
            }
            case UnnyObjectType.Spine: {
                obj = engine.add.spine(x, y, b.name, allObj.animations.idle, true);
                PrepareSpineMethods(obj);

                // obj = engine.add.sprite(x, y, b.name);

                if (b.focused)
                    focused_object = obj;

                obj.setScale(allObj.scale || 1);
                main = new AnimatedObject(obj, allObj.animations, allObj);

                if (b.hasOwnProperty('scale'))
                    main.obj.setScale(b.scale);

                obj.objName = b.name + "_spine";
                if (clickable) {
                    obj.setDepth(depth);
                    obj = addInvisibleClickable(engine, group, depth, main.obj.x, main.obj.y, b.scaleSize);
                }

                if (group)
                    group.add(main.obj);
                break;
            }
            default:
                obj = group.create(x, y, b.name);
                obj.setVisible(group.visible);
                if (b.hasOwnProperty('scale'))
                    obj.setScale(b.scale);

                obj.objName = b.name + "_default";
                if (clickable) {
                    obj.setDepth(depth);
                    obj = addInvisibleClickable(engine, group, depth, obj.x, obj.y);
                }

                break;
        }

        obj.objName = b.name;
        if (clickable) {
            GlobalClickables.push(obj);
            obj.clickable = true;

            const delay = 200;

            function canBeClicked() {
                if (main && !main.obj.visible)
                    return false;

                return (!LockedAnimatedObject || LockedAnimatedObject === main);
            }

            const funcDown = () => {
                if (!canBeClicked())
                    return;

                obj.lastTime = engine.time.now;
                if (engine.input.activePointer.isDown && !GlobalInputLocked)
                    clickCallback('down');
            };
            const funcMove = () => {
                if (!canBeClicked())
                    return;

                if (engine.input.activePointer.isDown && !GlobalInputLocked) {
                    const newTime = engine.time.now;
                    if (newTime - obj.lastTime >= delay || !obj.lastTime) {
                        obj.lastTime = newTime;
                        clickCallback('move');
                    }
                }
            };
            obj.on('pointerdown', funcDown);
            obj.on('pointermove', funcMove);
        }

        obj.setDepth(depth);
    }
    return main;
}

function SetGroupVisible(group, visible, startElement) {
    group.invisible = !visible;
    group.setVisible(visible);
    if (group.children)
    {
        const children = group.children.entries;
        if (children) {
            startElement = startElement || 0;
            for (let i = startElement; i < children.length; i++) {
                if (!children[i].forceInvisible)
                    children[i].setVisible(visible);
            }
        }
    } else {
        if (group.list) {
            for (let i = 0; i < group.list.length; i++) {
                if (!group.list[i].forceInvisible)
                    group.list[i].setVisible(visible);
            }
        }
    }
}

function SetBuildingVisible(group, visible, clicker) {
    group.setVisible(clicker);
    if (group.children)
    {
        const children = group.children.entries;
        if (children) {
            for (let i = 0; i < children.length; i++)
                children[i].setVisible(children[i].clicker ? clicker : visible);
        }
    }
}

let loadCallbackHelper;
let loadingImages = {};
let loadedImages = {};

for (let i in VisualData.PRELOAD_OBJECTS) {
    loadedImages[VisualData.PRELOAD_OBJECTS[i]] = 1;
}

function LoadingComplete() {
    loadedImages = Object.assign(loadedImages, loadingImages);
    loadingImages = {};
    loadCallbackHelper.callAndClearListeners();
}

function LoadingError() {
    console.log("Error Occured");
}

function CreateImageInGroup(engine, group, name, callback) {
    LoadPreparedFile(engine, name, () => {
        const image = engine.add.sprite(0, 0, name);
        group.add(image);
        callback(image);
    });
}

function CreateImage(engine, x, y, name, callback) {
    LoadPreparedFile(engine, name, () => {
        callback(engine.add.sprite(x, y, name));
    });
}

function PreloadObjects(engine, objects, callback) {
    let count = 0;
    for (let i = 0;i < objects.length;i++) {
        const name = objects[i].name;
        if (name && !loadedImages.hasOwnProperty(name)) {
            LoadPreparedFile(engine, name, count === 0 ? callback : null);
            count++;
        }
    }

    if (count === 0 && callback)
        callback();
}

function LoadPreparedFile(engine, name, callback) {
    const allObj = VisualData.ALL_OBJECTS[name];
    if (!allObj)
        console.trace("ERROR " + name);
    else {
        switch (allObj.type) {
            case UnnyObjectType.Spine:
                LoadFile(engine, name, allObj.json, callback, allObj.type, allObj.atlas);
                break;
            default:
                LoadFile(engine, name, allObj.file, callback, allObj.type);
                break;
        }
    }
}

function LoadFile(engine, name, path, callback, type, secondPath) {
    if (loadedImages.hasOwnProperty(name)) {
        callback();
        return;
    }

    path += "?v=15";
    secondPath += "?v=15";

    if (!loadingImages.hasOwnProperty(name)) {
        switch (type) {
            case UnnyObjectType.Audio:
                engine.load.audio(name, path);
                break;
            case UnnyObjectType.Spine:
                engine.load.spine(name, path, secondPath);
                break;
            case UnnyObjectType.Json:
                engine.load.json(name, path);
                break;
            // case UnnyObjectType.NineSlice:
            //     const allObj = VisualData.ALL_OBJECTS[name];
            //     console.log(">> ", allObj);
            //     // engine.load.nineSlice(name, path, 25);
            //     engine.load.image(name, path);
            //     break;
            default:
                const obj = VisualData.ALL_OBJECTS[name];
                if (!obj || !GameData.getAtlasName(obj))
                    engine.load.image(name, path);
                break;
        }
        loadingImages[name] = 1;
    }

    if (!loadCallbackHelper) {
        loadCallbackHelper = new UnnyAction();
        engine.load.on('complete', LoadingComplete, this);
        engine.load.on('loadError', LoadingError, this);
    }

    loadCallbackHelper.addListener(callback);

    if (!engine.load.isLoading())
        engine.load.start();
}

function WaitForEverythingToLoad(callback) {
    if (!gameInit.engine.load.isLoading())
        callback();
    else
        loadCallbackHelper.addListener(callback);
}

function PrepareAndCreateObject(object, parent, engine, depth, callback, clickCallback) {
    const objects = object.objects;
    const name = objects[0].name;
    LoadPreparedFile(engine, name, () => {
        const obj = PrepareObject(objects, parent, engine, depth, null, clickCallback);
        if (callback)
            callback(obj);
    });
}

class ClickController {

    constructor() {
        this.onBuildingClicked = new UnnyAction();
        this.onFabrikaWasClicked = new UnnyAction();
        this.onPodkovaWasClicked = new UnnyAction();
    }

    buildingWasClicked(buildingInterface) {
        this.onBuildingClicked.callListeners(buildingInterface);
    }

    fabrikaWasClicked(buildingInterface) {
        this.onFabrikaWasClicked.callListeners(buildingInterface);
    }

    podkovaWasClicked(buildingInterface) {
        this.onPodkovaWasClicked.callListeners(buildingInterface);
    }
}

let clickController = new ClickController();

class VisualBuilding {

    constructor(engine, building, visible) {
        this.buildingInterface = building;
        this.buildingInterface.onUpgraded.addListener(this.buildingUpgraded.bind(this));
        this.buildingInterface.onResourcesUpdated.addListener(this.resourcesUpdated.bind(this));

        this.group = engine.add.group();
        this.engine = engine;
        if (visible)
            this.applyTexture(this.buildingInterface.getLevel());
        else
            this.delayApplyTexture = true;

        this.setVisible(visible);

        building.onReseted.addListener(this.reseted.bind(this));
        building.onUnlockChanged.addListener(this.changeVisibility.bind(this));
    }

    harvestStarted() {
        if (this.buildingInterface.getLevel() > 0) {
            this.buildingInterface.harvest = 5;
            return true;
        } else
            this.setVisible(false);
        return false;
    }

    reseted() {
        this.applyTexture(this.buildingInterface.getLevel());
        this.setVisible(this.buildingInterface.world.isSelected());
    }

    resourcesUpdated(building) {
        if (building.autoCollect) {
            if (this.animatedObject)
                this.animatedObject.playAction();
        }
    }

    isHarvested() {
        return !this.buildingInterface.harvest;
    }

    buildingWasClicked(action) {
        // console.log("buildingWasClicked " + action + " > " + this.buildingInterface.getLevel() + " harv = " + this.buildingInterface.harvest + " :res = " + this.buildingInterface.anyResources);
        if (action === 'move' && this.buildingInterface.getLevel() === 0)
            return;

        let playAnimation = false;

        if (this.buildingInterface.harvest) {
            this.buildingInterface.harvest--;
            if (!this.buildingInterface.harvest)
                this.setVisible(false);
            playAnimation = true;
            eventManager.harvestClicked();
        } else
            playAnimation = this.buildingInterface.anyResources || this.buildingInterface.getLevel() === 0;

        if (playAnimation) {
            clickController.buildingWasClicked(this.buildingInterface);
            if (this.animatedObject)
                this.animatedObject.playAction(true);
        }
    }

    setProductionVisible(visible) {
        SetGroupVisible(this.group, visible, this.buildingInterface.getLevel() ? 0 : 1);
    }

    setVisible(visible) {
        if (this.delayApplyTexture) {
            this.delayApplyTexture = false;
            this.applyTexture(this.buildingInterface.getLevel());
        }
        this.visible = visible;
        SetBuildingVisible(this.group, visible && !this.buildingInterface.isUnlocked(), visible);
    }

    buildingUpgraded(building) {
        if (building.getLevel() === 1)
            this.applyTexture(building.getLevel());
    }

    changeVisibility() {
        this.setVisible(this.visible);
    }

    isVisible() {
        return (!this.buildingInterface.isUnlocked() && this.group.visible);
    }

    getPosition() {
        return this.position;
    }

    applyTexture(level) {
        const engine = this.engine;
        this.group.clear(true, true);

        const bInfo = VisualData.PLACED_BUILDINGS[this.buildingInterface.slot];
        const pos = bInfo.position;
        const levels = bInfo.levels;

        let bName = null;
        for (let i = 0;i < levels.length; i++){
            bName = levels[i].building;
            if (!levels[i].hasOwnProperty('maxLevel') || level <= levels[i].maxLevel)
                break;
        }

        this.position = pos;

        if (bName) {
            const building = VisualData.VISUAL_BUILDINGS[bName];
            const objects = building.objects;
            PreloadObjects(engine, objects, ()=> {
                this.animatedObject = PrepareObject(objects, this.group, engine, bInfo.depth, pos, this.buildingWasClicked.bind(this));
                if (this.animatedObject)
                    this.animatedObject.setVisible(this.isVisible());
            });
        }
    }
}

class VisualInit {

    constructor() {
        gameInit.preload.addListener(this.preload.bind(this));
        gameInit.create.addListener(this.create.bind(this));
        gameInit.onBuildingCreated.addListener(this.buildingCreated.bind(this));
        gameInit.onBuildingUpgraded.addListener(this.buildingUpgraded.bind(this));
        gameInit.onWorldChanged.addListener(this.worldChanged.bind(this));
        gameInit.onWorldPreChanged.addListener(this.worldPreChanged.bind(this));
        gameInit.loaded.addListener(this.progressWasLoaded.bind(this));
        gameInit.update.addListener(this.update.bind(this));
        gameInit.reseted.addListener(this.reseted.bind(this));
    }

    worldPreChanged(callback) {
        const self = this;
        function go(splitAnimation, callback) {
            //splitAnimation.playAction(true);
            splitAnimation.playAppear(true);
            divElementForLabels.style.display = 'none';
            if (self.timer)
                clearTimeout(self.timer);

            self.timer = setTimeout(()=>{
                if (callback)
                    callback();
                // self.timer = setTimeout(()=> {
                WaitForEverythingToLoad(()=>{
                    splitAnimation.playDisappear(true);
                    self.timer = setTimeout(()=> {
                        GlobalInputLocked = false;
                        unlockGUI();
                        divElementForLabels.style.display = 'inherit';
                        self.timer = null;
                        splitAnimation.setVisible(false);
                    }, 1000);
                });
                //, 1000);
            }, 1000);
        }

        if (!VisualData.SPLIT_SCREEN) {
            callback();
        } else {
            GlobalInputLocked = true;
            lockGuiEverything();

            if (this.splitAnimation) {
                this.splitAnimation.setVisible(true);
                go(this.splitAnimation, callback);
            } else {
                PrepareAndCreateObject(VisualData.SPLIT_SCREEN, null, this.engine, OverlayDepth + WinDefaultDepth, (splitAnimation) => {
                    this.splitAnimation = splitAnimation;
                    go(this.splitAnimation, callback);
                });
            }
        }
    }

    worldChanged(worldId) {
        for (let id in this.visible_groups) {
            if (this.visible_groups[id]) {
                if (id !== worldId)
                    this.setBuildingsVisible(id, false);
            } else {
                if (id === worldId)
                    this.setBuildingsVisible(id, true);
            }
        }

        this.showBackground(worldId);
        audioManager.playWorldMusic(worldId);
        this.updateBossState();
    }

    preload(engine) {
        this.engine = engine;
        const loader = engine.load;

        for (let i in VisualData.PRELOAD_OBJECTS) {
            const key = VisualData.PRELOAD_OBJECTS[i];
            const obj = VisualData.ALL_OBJECTS[key];
            // const path = VisualData.getGullPath(obj.path);
            if (!obj) {
                console.log("[ERROR] No such object: " + key);
                continue;
            }

            switch (obj.type) {
                case UnnyObjectType.SpriteSheet:
                    const newParams = {
                        frameWidth: Math.trunc(obj.frameWidth * GlobalScale / imagesDeltaScale),
                        frameHeight: (obj.frameHeight * GlobalScale / imagesDeltaScale)
                    };
                    loader.spritesheet(key, obj.file, newParams);
                    break;
                case UnnyObjectType.Spine:
                    if (loader.spine)
                        loader.spine(key, obj.json, obj.atlas);
                    break;
                // case UnnyObjectType.NineSlice:
                //     loader.nineSlice(key, obj.file, obj.paddingY, obj.paddingX, obj.paddingX, obj.paddingY);
                //     break;
                default:
                    if (!GameData.getAtlasName(obj))
                        loader.image(key, obj.file);
                    break;
            }
        }
    }

    create(engine) {
        for (let i in VisualData.PRELOAD_OBJECTS) {
            const key = VisualData.PRELOAD_OBJECTS[i];
            const obj = VisualData.ALL_OBJECTS[key];

            if (!obj)
                continue;

            switch (obj.type) {
                case UnnyObjectType.SpriteSheet:
                {
                    if (obj.hasOwnProperty('animation')) {
                        const config = Object.assign({
                            frames: engine.anims.generateFrameNumbers(key)
                        }, obj.animation);
                        engine.anims.create(config);
                    }
                    break;
                }
            }
        }

        this.backgrounds = {};
        this.showBackground(gameInit.selectedWorld);

        this.groups = {};
        this.visible_groups = {};
    }

    updatePodkova(progress) {
        if (this.podkova) {
            this.podkovaActive = progress.isGuardActive();
            if (this.podkovaActive) {
                this.podkova.playActiveLoop();
                this.podkovaTimer.setVisible(true);
            }
            else {
                this.podkova.playIdleLoop();
                this.podkovaTimer.setVisible(false);
            }
        }
    }

    setGameObjectsVisible(visible) {
        if (this.podkovaTimer && this.podkovaActive)
            this.podkovaTimer.setVisible(visible);
    }

    update() {
        if (this.podkovaActive !== gameInit.progress.isGuardActive())
            this.updatePodkova(gameInit.progress);

        if (this.podkovaActive) {
            const left = Math.trunc(gameInit.progress.getGuardTimeLeft() / 1000);
            if (this.podkovaTimerTime !== left) {
                this.podkovaTimerTime = left;
                this.podkovaTimer.time.setText(timeToStringClock(left));
            }
        }
    }

    progressWasLoaded(progress) {
        this.updatePodkova(progress);
    }

    showBackground(worldId, callback) {
        if (!this.backgrounds.hasOwnProperty(worldId)) {
            this.backgrounds[worldId] = this.engine.add.group();
            PrepareAndCreateObject(VisualData.BACKGROUNDS[worldId], this.backgrounds[worldId], this.engine, 0, callback);
        }

        // //testing
        // LoadFile(this.engine, "test_back", "test_back/test1.jpg", ()=>{
        //     console.log("loaded");
        //     this.engine.add.sprite(RealScreenWidth / 2, RealScreenHeight / 2, "test_back").setScale(0.58).alpha = 0.8;
        // });

        for (let i in this.backgrounds)
            SetGroupVisible(this.backgrounds[i], i == worldId);

        //load fabrika and podkova if necessary and apply position
        if (!this.fabrika && VisualData.FABRIKA) {
            PrepareAndCreateObject(VisualData.FABRIKA, null, this.engine, 1, (fabrika)=>{
                this.fabrika = fabrika;
                this.updateBossState();
            }, (action)=>clickController.fabrikaWasClicked(action));
        }

        if (!this.podkova && VisualData.PODKOVA) {
            PrepareAndCreateObject(VisualData.PODKOVA, null, this.engine, 1, (podkova)=>{
                this.podkova = podkova;
                this.podkova.setVisible(gameInit.progress.canShowGuard());
                this.podkovaTimer = this.engine.add.container();
                const back = this.engine.add.sprite(0, 0, 'RainTimerBack');
                this.podkovaTimer.add(back);
                this.podkovaTimer.time = this.engine.add.text(0, -4 * GlobalScale, null, DefaultFontSmall).setOrigin(0.5);
                this.podkovaTimer.add(this.podkovaTimer.time);
                this.podkovaTimer.setPosition(this.podkova.obj.x / localScale, this.podkova.obj.y / localScale + 100 * GlobalScale);
                this.podkovaTimer.setDepth(WinDefaultDepth - 1000);
            }, (action)=>clickController.podkovaWasClicked(action));
        }

        if (!this.supervisor && VisualData.SUPERVISOR) {
            PrepareAndCreateObject(VisualData.SUPERVISOR, null, this.engine, 1, (podkova)=>{
                this.supervisor = podkova;
                // this.podkova.setVisible(gameInit.progress.canShowGuard());
            }, ()=>guiManager.openNewWindow(WindowType.WinSupervisor));
        }
    }

    updateBossState() {
        if (this.fabrika)
            this.fabrika.setVisible(gameInit.progress.canShowBoss(gameInit.selectedWorld));
    }

    getBoss() {
        return this.fabrika;
    }

    showGuard() {
        if (this.podkova)
            this.podkova.setVisible(true);
    }

    showSuperVisor() {
        if (this.supervisor)
            this.supervisor.setVisible(true);
    }

    getGuard() {
        return this.podkova;
    }

    getSuperVisor() {
        return this.supervisor;
    }

    reseted() {
        this.updateBossState();
    }

    buildingUpgraded(world, building) {
        if (building.getLevel() === 1) {
            this.updateBossState();
        }
    }

    buildingCreated(world, building) {
        let group;
        if (!this.groups.hasOwnProperty(world.id)) {
            group = this.groups[world.id] = {};
            this.visible_groups[world.id] = world.isSelected();
        } else
            group = this.groups[world.id];

        group[building.id] = new VisualBuilding(this.engine, building, this.visible_groups[world.id]);
    }

    setBuildingsProductionVisible(worldId, visible) {
        const group = this.groups[worldId];
        if (group) {
            for (let i in group)
                group[i].setProductionVisible(visible);
        }
    }

    setBuildingsVisible(worldId, visible) {
        const group = this.groups[worldId];
        if (group) {
            for (let i in group)
                group[i].setVisible(visible);
        }
        this.visible_groups[worldId] = visible;
    }

    prepareForHarvest() {
        const worldId = gameInit.selectedWorld;

        const group = this.groups[worldId];
        let count = 0;
        if (group) {
            for (let i in group) {
                if (group[i].harvestStarted())
                    count++;
            }
        }
        return count;
    }

    getAllVisibleBuildings() {
        return this.groups[gameInit.selectedWorld];
    }
}

let visualGame = new VisualInit();

class GUINotification extends Phaser.GameObjects.Container {
    constructor(config) {
        super(config.scene, config.x, config.y);
        this.config = config;

        config.scene.add.existing(this);

        const scale = VisualData.GUI_Common.notification_scale;
        this.image = config.scene.add.sprite(0, 0, 'Notification').setScale(scale);
        this.text = config.scene.add.textOld(0, 0, config.getText(), DefaultFontNotifications).setOrigin(0.5);
        this.add(this.image);
        this.add(this.text);
        animManager.jumpFishAnimation(this, {
            height: 20 * GlobalScale,
            scale: 0.2
        }, 0.6);

        if (config.group)
            config.group.add(this);

        this.config.subscribe(this.update.bind(this));
    }

    setVisible(visible) {
        super.setVisible(this.config.parent.visible && visible && this.config.isVisible());
    }

    update() {
        this.setVisible(true);
        this.text.setText(this.config.getText());
    }
}

class GUIScroll {
    constructor(engine, config, getCellMethod, getItemsMethod) {
        // let background = engine.add.sprite(0, 0, 'WinUpgradeBack').setInteractive().setDepth(WinDefaultDepth - 1000);
        const padding = (config.width - config.cellWidth * config.columns);
        const conf = {
            // Position
            x: config.x * localScale,
            y: config.y * localScale,

            // Elements
            // background: engine.add.sprite(0, 0, "ExitButton").setDepth(5000),
            // background: engine.rexUI.add.roundRectangle(0, 0, 0, 0, 13, 0xffffff),
            // background: background,

            table: {
                width: config.width * GlobalScale * localScale,
                height: config.height * GlobalScale * localScale,

                cellWidth: config.cellWidth * GlobalScale * localScale,
                cellHeight: config.cellHeight * GlobalScale * localScale,
                // width: config.width,
                // height: config.height,
                //
                // cellWidth: config.cellWidth,
                // cellHeight: config.cellHeight,
                columns: config.columns,
                interactive: false
            },

            // slider: {
            //track: engine.rexUI.add.roundRectangle(0, 0, 20, 10, 10, 0x260e04),
            //thumb: engine.rexUI.add.roundRectangle(0, 0, 0, 0, 13, 0xff0000),
            // },

            scroller: {
                slidingDeceleration: 5000,
                backDeceleration: 2000,
            },

            space: {
                left: padding * GlobalScale * localScale,
                right: 0,
                top: 0,
                bottom: 0,

                table: 0,
            },

            createCellContainerCallback: getCellMethod,

            items: getItemsMethod(),//this.getItems(5),

            name: '',
        };

        if (config.track && config.thumb) {
            conf.slider = {
                track: engine.add.sprite(0, 0, config.track),
                thumb: engine.add.sprite(0, 0, config.thumb)
            }
        }

        // this.table = engine.rexUI.add.gridTable(conf).setInteractive().setDepth(WinDefaultDepth).layout();
        this.table = new RexPlugins.UI.GridTable(engine, conf).setInteractive().setDepth(WinDefaultDepth).layout();
    }

    setScrollerEnable(enable) {
        this.table.setScrollerEnable(enable);
        this.scrollerDisabled = !enable;
    }

    fakeMove() {
        this.fakeUp = !this.fakeUp;
        this._mouseWheel(0, this.fakeUp ? -1 : 1);
    }

    _mouseWheel(x, y) {
        if (this.scrollerDisabled)
            return;

        let t = this.table.t + Math.sign(y) * Math.min(Math.abs(y), 30) * 0.01;
        if (t) {
            if (t < 0)
                t = 0;
            if (t > 1)
                t = 1;
            this.table.setT(t);
        }
    }

    setVisible(visible) {
        this.table.visible = visible;
        if (this.table.visible) {
            if (!this.wheel) {
                this.wheel = this._mouseWheel.bind(this);
                eventManager.onMouseWheel.addListener(this.wheel);
            }
        } else {
            if (this.wheel) {
                eventManager.onMouseWheel.removeListener(this.wheel);
                this.wheel = null;
            }
        }
    }
}

class GUITextArea {
    constructor(engine, config, getContent) {
        const COLOR_PRIMARY = 0xaea4ae;
        const COLOR_LIGHT = 0x7b5e57;
        const COLOR_DARK = 0x260e04;

        const conf = {
            x: config.x * localScale,
            y: config.y * localScale,
            // anchor: undefined,
            width: config.width * GlobalScale * localScale,
            height: config.height * GlobalScale * localScale,

            // Elements
            // background: engine.rexUI.add.roundRectangle(0, 0, 2, 2, 0, COLOR_PRIMARY),
            // background: null,

            text: engine.rexUI.add.BBCodeText(50, 50, null, PhotoQuestDescFont).setOrigin(0.5),
            // text: text,
            // textWidth: undefined,
            // textHeight: undefined,

            // slider: {
            //     track: engine.rexUI.add.roundRectangle(0, 0, 20, 10, 10, COLOR_DARK),
            //     thumb: engine.rexUI.add.roundRectangle(0, 0, 0, 0, 13, COLOR_LIGHT),
            // },

            scroller: {
                threshold: 10,
                slidingDeceleration: 5000,
                backDeceleration: 2000,
            },

            clamplChildOY: false,

            // header: headerGameObject,
            // footer: footerGameObject,

            space: {
                left: 0,
                right: 0,
                top: 0,
                bottom: 0,

                text: 0,
                // text: {
                //    top: 0,
                //    bottom: 0,
                //    left: 0,
                //    right: 0,
                //},
                header: 0,
                footer: 0,
            },

            expand: {
                header: true,
                footer: true,
            },

            align: {
                header: 'center',
                footer: 'center',
            },

            content: getContent(),

            // name: '',
            // draggable: false
        };

        this.textArea = engine.rexUI.add.textArea(conf)
            .setInteractive()
            .setDepth(WinDefaultDepth)
            .drawBounds(engine.add.graphics(), 0xff0000)
            .layout();
    }

    _mouseWheel(x, y) {
        let t = this.textArea.t + Math.sign(y) * Math.min(Math.abs(y), 30) * 0.01;
        if (t) {
            if (t < 0)
                t = 0;
            if (t > 1)
                t = 1;
            this.textArea.setT(t);
        }
    }

    setText(text) {
        this.textArea.setText(text);
    }

    setVisible(visible) {
        this.textArea.visible = visible;
        if (this.textArea.visible) {
            if (!this.wheel) {
                this.wheel = this._mouseWheel.bind(this);
                eventManager.onMouseWheel.addListener(this.wheel);
            }
        } else {
            if (this.wheel) {
                eventManager.onMouseWheel.removeListener(this.wheel);
                this.wheel = null;
            }
        }
    }
}

let mainResourceIcon = null;
let cansResourceIcon = null;
let hudResources;
let photoTokensCommon = {};

class HUDResources {
    /***
     *
     * @type {GUIManager} gui
     * @type {GameInit} gameInit
     */
    constructor(gameInit) {
        gameInit.loaded.addListener(this.gameLoaded.bind(this));
        hudResources = this;

        this.gems_Visible = true;
        this.stars_Visible = true;
        this.tokens_Visible = true;
    }

    setVisible(visible) {
        this.visible = visible;
        SetGroupVisible(this.group, visible);
        if (visible) {
            this.udpateResourcesHelp();

            if (VisualData.getGameSettings().photos) {
                this.showGems(this.gems_Visible);
                this.showStars(this.stars_Visible);
                this.showTokens(this.tokens_Visible);
                this.setTokensVisible(this.tokensVisible);
            }
        }
    }

    hideForTutorial() {
        this.showGems(false);
        this.showStars(false);
        this.showTokens(false);
    }

    showGems(visible = true) {
        this.gems_Visible = visible;
        this.gemsContainer.setVisible(visible);
        this.updateStars();
        this.updateTokens();
    }

    showStars(visible = true) {
        this.stars_Visible = visible;
        this.starsContainer.setVisible(visible);
        this.updateTokens();
    }

    showTokens(visible = true) {
        this.tokens_Visible = visible;
        this.tokensButton.setVisible(visible);
    }

    updateTokens() {
        let count = 0;
        if (!this.gems_Visible)
            count++;
        if (!this.stars_Visible)
            count++;

        this.tokesGroup.setPosition(0, -this.Distance * count);
        this.tokensButton.setPosition(this.tokensButtonOriginal.x, this.tokensButtonOriginal.y - this.Distance * count);
    }

    updateStars() {
        this.starsContainer.setPosition(0, this.gems_Visible ? 0 : -this.Distance);
    }

    createGame(engine) {
        this.group = engine.add.group();

        const centerX = VisualData.MAP_PARAMS.center.x;
        const centerY = VisualData.MAP_PARAMS.center.y;
        const Distance = 120 * GlobalScale;
        const IconOffset = 30 * GlobalScale;
        const LabelOffset = 80 * GlobalScale;

        this.Distance = Distance;

        let x = centerX - RealScreenWidth / 2 + 50 * GlobalScale;
        let y = centerY - RealScreenHeight / 2 + 80 * GlobalScale;

        const font = DefaultFontSmall;
        const info = VisualData.GUI_HUDResources;

        let image;

        this.gemsContainer = engine.add.container(0, 0);
        this.starsContainer = engine.add.container(0, 0);
        this.group.add(this.gemsContainer);
        this.group.add(this.starsContainer);

        if (VisualData.getGameSettings().player_level) {
            this.playerExpLoader = new Loader(this.group, 'PlayerExpLoaderBack', 'PlayerExpLoader', x + 300 * GlobalScale, y);
            image = engine.add.sprite(x, y, 'PlayerIcon').setOrigin(0, 0.5);
            this.group.add(image);

            this.playerStar = engine.add.sprite(x, y, 'PlayerExpStar');
            this.group.add(this.playerStar);

            this.playerStarLabel = engine.add.text(x, y, null, PlayerLevelFont).setOrigin(0.5, 0.5);
            this.group.add(this.playerStarLabel);

            y += Distance;

            this.setPlayersData();
        }

        image = engine.add.sprite(x, y, info.singleImage ? info.singleImage : 'HudResBack1').setOrigin(0, 0.5);
        if (info.hudBackScale)
            image.setScale(info.hudBackScale, 1);
        this.group.add(image);
        mainResourceIcon = this.group.create(x + IconOffset, y, 'PriceIcon').setScale(0.85, 0.9);
        this.resources = engine.add.text(x + LabelOffset, y + info.labelOffsetY * GlobalScale, '99999', font).setOrigin(0, 0.5);
        this.group.add(this.resources);
        this.resourcesHelp = new BasicButton(this.group, {
            'scene': engine,
            'key': 'SeedsQuestIcon',
            'x': x + info.greenButtonOffsetX1 * GlobalScale,
            'y': y,
        }, () => guiManager.openNewWindow(WindowType.WinResourcesInfo));

        y += Distance;
        image = engine.add.sprite(x, y, info.singleImage ? info.singleImage : 'HudResBack2').setOrigin(0, 0.5);
        if (info.hudBackScale)
            image.setScale(info.hudBackScale, 1);
        this.gemsContainer.add(image);
        const gemsIcon = engine.add.sprite(x + IconOffset, y, 'PriceGems');
        this.gemsContainer.add(gemsIcon);
        this.gems = engine.add.text(x + LabelOffset, y + info.labelOffsetY * GlobalScale, '99999', font).setOrigin(0, 0.5);
        this.gemsContainer.add(this.gems);
        new BasicButton(this.gemsContainer, {
            'scene': engine,
            'key': 'HudPlusButton',
            'x': x + info.greenButtonOffsetX1 * GlobalScale,
            'y': y,
        }, () => guiManager.openGemsStore());

        y += Distance;
        image = engine.add.sprite(x, y, info.singleImage ? info.singleImage : 'HudResBack3').setOrigin(0, 0.5);
        if (info.hudBackScale)
            image.setScale(info.hudBackScale, 1);
        this.starsContainer.add(image);
        cansResourceIcon = engine.add.sprite(x + IconOffset, y, 'PriceSeeds').setScale(0.9);
        this.starsContainer.add(cansResourceIcon);
        this.seeds = engine.add.text(x + LabelOffset, y + info.labelOffsetY * GlobalScale, '99999', font).setOrigin(0, 0.5);
        this.starsContainer.add(this.seeds);
        new BasicButton(this.starsContainer, {
            'scene': engine,
            'key': 'SeedsQuestIcon',
            'x': x + info.greenButtonOffsetX1 * GlobalScale,
            'y': y,
        }, () => guiManager.openNewWindow(WindowType.WinApples));

        if (VisualData.getGameSettings().photos) {
            y += Distance;
            this.tokesGroup = engine.add.container(0, 0);
            this.group.add(this.tokesGroup);
            this.tokens = ['tokenCommon', 'tokenRare', 'tokenEpic'];
            this.photo_tokens = [];

            const bx = x + 120 * GlobalScale;
            this.tokensButton = new BasicButton(this.group, {
                'scene': engine,
                'key': 'HudTokensOpen',
                'x': bx,
                'y': y
            }, () => {
                this.setTokensVisible(!this.tokensVisible, false);
            });

            this.tokensButtonOriginal = {x: bx, y: y};

            for (let i in this.tokens) {
                y += Distance * 0.7;

                const token = this.tokens[i];
                image = engine.add.sprite(x, y, 'HudTokensBack').setOrigin(0, 0.5);
                this.tokesGroup.add(image);
                photoTokensCommon[token] = engine.add.sprite(x + IconOffset, y, GameData.getIconByType(token));
                this.tokesGroup.add(photoTokensCommon[token]);
                this.photo_tokens[i] = engine.add.text(x + LabelOffset, y + info.labelOffsetY * GlobalScale, null, font).setOrigin(0, 0.5);
                this.tokesGroup.add(this.photo_tokens[i]);
            }

            this.setTokensVisible(false, true);
        }

        this.group.setDepth(WinDefaultDepth + 100);
    }

    setTokensVisible(visible) {
        this.tokensVisible = visible;
        this.tokesGroup.setVisible(visible);
    }

    /***
     *
     * @type {Progress} progress
     */
    gameLoaded(progress) {
        progress.onResourcesChanges.addListener(this.updateResources.bind(this));
        progress.onExperienceChanges.addListener(this.updateExperience.bind(this));
        this.updateResources(progress);
    }

    /***
     *
     * @type {Progress} progress
     */
    updateResources(progress) {
        this.resources.setText(LocalizationManager.getLocalizedNumber(progress.getTotalResources()));
        this.gems.setText(LocalizationManager.getLocalizedNumber(progress.getTotalGems()));
        this.seeds.setText(LocalizationManager.getLocalizedNumber(progress.getTotalSeeds()));

        if (this.photo_tokens) {
            for (let i in this.tokens) {
                this.photo_tokens[i].setText(LocalizationManager.getLocalizedNumber(progress.getTokens(this.tokens[i])));
            }
        }
        this.udpateResourcesHelp();
    }

    udpateResourcesHelp() {
        this.resourcesHelp.setVisible(this.visible && gameInit.progress.getTotalResources().compare("100000000000000000") >= 0);
    }

    setPlayersData() {
        const prog = gameInit.playerInfo.getExpProgress();
        if (this.playerExpLoader.setProgress(prog)) {
            const x = this.playerExpLoader.getOriginX() + this.playerExpLoader.getWidth() * prog;
            this.playerStarLabel.setPosition(x, this.playerStarLabel.y / localScale);
            this.playerStar.setPositionX(x);
        }

        const level = gameInit.playerInfo.getLevel();
        if (level !== this.playerLevel) {
            this.playerLevel = level;
            this.playerStarLabel.setText(level);
        }
    }

    updateExperience() {
        this.setPlayersData();
    }
}

const OverlayDepth = 30000;
const WinDefaultDepth = 10000;
let TextScale = 1;
let TextScale2 = 1;

function getFont(size) {
    return Math.trunc(size * GlobalScale * localScale * TextScale * 1.2 * 2) + 'px';
}

function getLineSpacing(spacing) {
    return Math.trunc(spacing * GlobalScale * localScale * TextScale);
}

function getFont2(size) {
    // return Math.trunc(size * GlobalScale * localScale * TextScale / dpi * 1.4) + 'px PT Sans Narrow';
    return Math.trunc(size * GlobalScale * localScale * TextScale2 / dpi * 1.4) + 'px';
}

function getStroke(size) {
    return Math.max(1, Math.trunc(size * 1.8 * GlobalScale * localScale / dpi));
}

//ElectraMedium
//ArchivoBlack
let DefaultFontVeryBig, DefaultFontBig, DefaultFont, DefaultFontSmall, DefaultFontSmall2, DefaultFontSmallPuzzleBonus,
    DefaultFontBlack, DefaultFontSmallBlack, DefaultFontVerySmall, DefaultFontVerySmall2;
let DefaultFontWheel, DefaultFontNotifications;

function SetIconToTheRightOfTheLabel(label, icon, distance) {
    label.onTextPositionUpdated.addListener(() => {
        icon.setPositionX(label.x / localScale + label.getInnerWidth() * (1 - label.originX) + distance * GlobalScale);
    });
}

function createFont(obj) {
    //obj.fontFamily = "PT Sans Narrow";
    obj.fontFamily = "kid_kosmicregular";
    obj.fontSize = obj.font;
    delete obj.font;
    return obj;
}

class ToogleButton {
    constructor(engine, group, icon, x, y, callback, winInfo) {
        this.winInfo = winInfo;
        const offset = (winInfo && winInfo.activeOffset) || 0;
        this.button = new BasicButton(group, {
                'scene': engine,
                'key': winInfo.tabClose || 'Tab_Close',
                'x': x + (winInfo.tabCloseOffsetX || 0) * GlobalScale,
                'y': y
            },
            callback)
            .setOrigin(0.5, 1)
            .setDepth(WinDefaultDepth - 250);
        this.x = x;
        this.y = y;
        this.selected = new BasicButton(group, {
                'scene': engine,
                'key': winInfo.tabOpen || 'Tab_Open',
                'x': x,
                'y': y + offset
            },
            callback)
            .setOrigin(0.5, 1)
            .setDepth(WinDefaultDepth - 120);
        this.icon = group.create(x, y - 70, icon).setDepth(WinDefaultDepth - 50);
        this._setScale(false);
    }

    _setScale(selected) {
        this.icon.setScale((100 * GlobalScale / this.icon.width / imagesDeltaScale) * (selected ? ((this.winInfo && this.winInfo.iconScaleActive) || 1) : 1));
    }

    addSale(group, icon) {
        this.icon2 = group.create(this.x - 10, this.y - 95, icon).setDepth(WinDefaultDepth - 50).setScale(0.8);
    }

    setSelected(selected) {
        this.selected.setVisible(selected);
        this.button.setVisible(!selected);
        const posY = this.y - (selected ? ((this.winInfo && this.winInfo.iconOffsetActive) || 100) * GlobalScale : ((this.winInfo && this.winInfo.iconOffset) || 70) * GlobalScale);
        this.icon.setPositionY(posY);
        this._setScale(selected);
        if (this.icon2) {
            if (selected)
                this.icon2.setScale(1).setPositionY(posY - 50);
            else
                this.icon2.setScale(0.8).setPositionY(posY - 40);
        }
    }
}

function setStoreCellLocked(group, locked) {
    const color = locked ? LockTint : NormalTint;

    const storeGUI = VisualData.GUI_WinStore;
    if (storeGUI.btnSpriteInactive)
        group.unny_btn.setTexture(locked ? storeGUI.btnSpriteInactive : storeGUI.btnSpriteNormal);
    else
        group.priceText.tint = color;

    group.unny_btn.setButtonLocked(locked);

    if (group.priceIcon)
        group.priceIcon.tint = color;
}

function setLockedColor(group, locked) {
    group.tint = locked ? LockTint : NormalTint;
}

function createStoreCell(engine, group, cellCenterX, cellCenterY, title, imageName, imagePath, desc, priceImg, price, purchaseCallback, ignoreVisibility, scroll, addSecondLabel, descOffset) {
    const depth = WinDefaultDepth + 100;

    const storeGUI = VisualData.GUI_WinStore;

    group.unny_back = engine.add.sprite(cellCenterX, cellCenterY, "Store_Slot").setDepth(depth);
    if (storeGUI.store_back_scale)
        group.unny_back.setScale(storeGUI.store_back_scale);
    group.add(group.unny_back);

    if (storeGUI.headerImg) {
        const headerImg = engine.add.sprite(cellCenterX, cellCenterY + storeGUI.headerOffsetY * GlobalScale, storeGUI.headerImg).setDepth(depth);
        group.add(headerImg);
    }

    group.unny_text = engine.add.textOld(cellCenterX, cellCenterY + storeGUI.headerOffsetY * GlobalScale, title, storeGUI.headerFont ? DefaultFontPurchaseSlot : DefaultFontVerySmall).setOrigin(0.5, 0.5).setDepth(depth);
    group.add(group.unny_text);
    group.unny_text.setWordWrapWidth((storeGUI.header_wrap || 400) * GlobalScale);

    const btnCenterY = cellCenterY + storeGUI.btnOffsetY * GlobalScale;
    group.unny_container = engine.add.container(cellCenterX, btnCenterY);
    group.unny_btn = new BasicButton(group.unny_container, {
        'scene': engine,
        'key': (GameData.getIconByType("Gems") === priceImg && storeGUI.btnSpriteGems) || storeGUI.btnSpriteNormal || 'DefaultButton',
        'x': 0,
        'y': 0,
        'scale_parent': true,
        // 'minWidth': storeGUI.btnMinWidth,
        'scale': storeGUI.btnScale || 1
    }, purchaseCallback);

    // group.add(group.unny_btn.setDepth(depth));
    group.add(group.unny_container.setDepth(depth));

    //Image
    let loading = true;
    if (imageName) {
        LoadFile(engine, imageName, imagePath, () => {
            if (group && group.active) {
                const sprite = engine.add.sprite((group.x / localScale || 0) + cellCenterX, (group.y / localScale || 0) + cellCenterY - (storeGUI.imageOffset || 110) * GlobalScale, imageName)
                    .setDepth(depth);
                group.add(sprite);
                group.unny_sprite = sprite;
                if (!ignoreVisibility && !group.visible && group.children)
                    sprite.setVisible(false);
                else {
                    if (scroll && !loading)
                        scroll.fakeMove();
                }
            }
        });
    }
    loading = false;
    //

    desc = LocalizationManager.removeCodes(desc);
    group.unny_desc = engine.add.textOld(cellCenterX, cellCenterY + storeGUI.descOffsetY * GlobalScale + (descOffset || 0), desc, DefaultFontVerySmall).setOrigin(0.5, 0.5).setDepth(depth);
    group.add(group.unny_desc);
    group.unny_desc.setWordWrapWidth(400 * GlobalScale);

    let priceText;
    if (priceImg) {
        const sign = VisualData.GUI_WinStore.price_icon_right ? 1 : -1;
        const priceIcon = engine.add.sprite(sign * 120 * GlobalScale, 0, priceImg);
        priceIcon.setScale(70 / priceIcon.width * GlobalScale / imagesDeltaScale).setDepth(depth);
        group.unny_container.add(priceIcon);
        group.priceIcon = priceIcon;
        priceText = engine.add.textOld(sign * 70 * GlobalScale, 0, price, DefaultFontVerySmall2).setOrigin(0.5 + sign / 2, 0.5).setDepth(depth);
    } else {
        priceText = engine.add.textOld(0, 0, price, DefaultFontVerySmall2).setOrigin(0.5, 0.5).setDepth(depth);
    }
    group.priceText = priceText;
    group.unny_container.add(priceText);

    if (addSecondLabel) {
        group.priceText2 = engine.add.textOld(0, 50 * GlobalScale, null, DefaultFontVerySmall).setOrigin(0.5, 0.5).setDepth(depth);
        group.unny_container.add(group.priceText2);
    }
    return priceText;
}

class WinBase {
    constructor(gui, gameInit) {
        gui.onCreate.addListener(this.createGame.bind(this));
        this.onClose = new UnnyAction();
        this.gui = gui;
        this.disableClickables = false;
        this.gameInit = gameInit;

        this.applyWinInfo("GUI_" + this.constructor.name);
    }

    createButton(key, x, y, action, scale) {
        const btn = new BasicButton(this.group, {
            'scene': this.engine,
            'key': key,
            'x': x,
            'y': y,
            'scale': scale
        }, action);
        this.addButton(btn);
        return btn;
    }

    applyWinInfo(key) {
        this.winInfo = VisualData[key] || {};

        if (this.winInfo.nineSlice)
            this.nineSlice = this.winInfo.nineSlice;
    }

    addButton(button) {
        if (!this.allButtons)
            this.allButtons = [];

        this.allButtons.push(button);
    }

    playButtonsAnimation() {
        if (this.allButtons) {
            for (let i in this.allButtons) {
                animManager.applyButtonShowAnimation(this.allButtons[i]);
            }
        }
    }

    createGroup() {
        this.group = this.engine.add.container(this.centerX, this.centerY).setDepth(WinDefaultDepth);
    }

    createGroupNotCenter() {
        this.group = this.engine.add.container(0, 0).setDepth(WinDefaultDepth);
    }

    createGame(engine) {
        this.centerX = VisualData.MAP_PARAMS.center.x;
        this.centerY = VisualData.MAP_PARAMS.center.y;

        this.engine = engine;
        this.createGroup();
        this.group.setVisible(false);
    }

    destroyImage() {
        if (this.image) {
            this.image.destroy(true);
            this.image = null;
        }
    }

    _createBlackBackground() {
        const size = 32 * GlobalScale;
        this.group.create(size * 5, size * 3, 'BlackPixel')
            .setScale(RealScreenWidth / size + 10, RealScreenHeight / size + 20)
            .setDepth(WinDefaultDepth - 2).setInteractive();
    }

    closeWindow() {
        this.setWindowVisible(false);
        this.destroyImage();
        this.onClose.callListeners(this);
    }

    playOpenAnimation() {
        animManager.applyWinOpenAnimation(this.group);
    }

    setWindowVisible(visible) {
        // console.error("setWindowVisible " + visible + " of " + this.constructor.name);

        this.visible = visible;
        SetGroupVisible(this.group, visible);

        if (!this.enableClickables)
            SetClickablesActive(!visible);

        if (visible) {
            this.playOpenAnimation();
            this.playButtonsAnimation();
        }
    }

    localize() {

    }

    imageWasLoaded() {

    }

    loadImage(icon, x, y) {
        LoadPreparedFile(this.engine, icon, () => {
            this.destroyImage();
            if (this.visible) {
                this.image = this.group.create(x, y, icon).setDepth(WinDefaultDepth + 1);
                let scale = (this.info && this.info.scaleImage) || 1;
                scale *= (this.winInfo && this.winInfo.scaleImage) || 1;
                if (scale !== 1)
                    this.image.setScale(scale);
                this.imageWasLoaded();
            }
        });
    }

    getWinInfoValue(key, def) {
        if (this.winInfo && this.winInfo.hasOwnProperty(key))
            return this.winInfo[key] * GlobalScale;
        return def * GlobalScale;
    }

    getWinInfoValueNoScale(key, def) {
        if (this.winInfo && this.winInfo.hasOwnProperty(key))
            return this.winInfo[key];
        return def;
    }

    _getHeaderFont() {
        return DefaultFontBig;
    }

    createHeader(engine) {
        const y = this.getWinInfoValue('headerOffset', -600);
        if (this.winInfo.header_image) {
            const img = engine.add.sprite(0, y, this.winInfo.header_image).setDepth(WinDefaultDepth);
            this.group.add(img);
        }
        this.header = engine.add.text(0, y, null, this._getHeaderFont())
            .setOrigin(0.5, 0.5)
            .setDepth(WinDefaultDepth);
        this.group.add(this.header);
    }

    createActionButton(engine, action, y, visible, scale, x, minWidth, icon, image, font, textOffsetX) {
        y = y || this.getWinInfoValue('buttonOffset', 500 * GlobalScale);
        x = x || this.getWinInfoValue('buttonOffsetX', 0);
        this.actionButton = new ButtonWithText(this.group, {
            'scene': engine,
            'key': image || 'DefaultButton',
            'x': x,
            'y': y,
            'scale': scale,
            'minWidth': minWidth,//for nine slice
            icon: icon,
            font: font,
            textOffsetX: textOffsetX,
        }, action)
            .setDepth(WinDefaultDepth + 100);

        this.buttonLabel = this.actionButton.caption;
        return this.buttonLabel;
    }

    getTutorialButton() {
        return this.actionButton;
    }

    hideAllButtonsForTutorial() {
        for (let i in this.allButtons)
            this.allButtons[i].setForceInvisible(true);
    }

    showAllButtonsFromTutorial() {
        for (let i in this.allButtons)
            this.allButtons[i].forceInvisible = false;

        this.setAllButtonsVisible(true);
    }

    showButtonFromTutorial(btn) {
        btn.setVisible(true);
        btn.forceInvisible = false;
    }

    setAllButtonsVisible(visible) {
        for (let i in this.allButtons) {
            if (!visible || !this.allButtons[i].forceInvisible)
                this.allButtons[i].setVisible(visible);
        }
    }

    _showAllButtonsBack() {
        for (let i in this.allButtons) {
            const btn = this.allButtons[i];
            if (btn.temp_mark) {
                delete btn.temp_mark;
                btn.setVisible(true);
                animManager.applyButtonShowAnimation(btn);
            }
        }
    }

    hideAllButtonsForTime(duration) {
        for (let i in this.allButtons) {
            const btn = this.allButtons[i];
            if (btn.visible) {
                btn.setVisible(false);
                btn.temp_mark = true;
            }
        }

        setTimeout(() => {
            this._showAllButtonsBack();
        }, duration * 1000);
    }

    _addImage(x, y, name, scale = 1, callback = null) {
        CreateImage(this.engine, x, y, name, (image) => {
            if (scale !== 1)
                image.setScale(scale);
            this.group.add(image);
            if (callback)
                callback(image);
        });
    }

    getExitButton() {
        return this.exitButton;
    }
}

class WinWithExit extends WinBase {

    createGame(engine) {
        super.createGame(engine);
        this.createExitButton();
    }

    createExitButton() {
        let x, y;
        if (VisualData.IsVertical()) {
            x = 150 * GlobalScale;
            y = RealScreenHeight - 150 * GlobalScale;
        } else {
            x = RealScreenWidth - 180 * GlobalScale;
            y = 150 * GlobalScale;
        }
        this.exitButton = new BasicButton(null, {
            'scene': this.engine,
            'key': 'ExitButton',
            'x': x,
            'y': y,
        }, this.closeWindow.bind(this)).setDepth(WinDefaultDepth);
        this.exitButton.visible = false;
        this.addButton(this.exitButton);
    }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);
        if (this.exitButton)
            this.exitButton.visible = visible;
    }
}

let staticWinBack = null;
let staticWinBlackBack = null;

let staticBackgrounds = {};

class WinWithBack extends WinWithExit {

    constructor(gui, gameInit){
        super(gui, gameInit);
    }

    createBack() {
        if (!staticWinBack) {
            staticWinBack = this.engine.add.container(this.centerX, this.centerY).setDepth(WinDefaultDepth - 1);

            staticWinBack.add(this.engine.add.sprite(0, 0, 'WinStandardBack').setDepth(WinDefaultDepth - 1));
            staticWinBack.setVisible(false);
        }
    }

    createGame(engine) {
        super.createGame(engine);

        if (!staticWinBlackBack) {
            const size = 32 * GlobalScale;
            staticWinBlackBack = engine.add.sprite(this.centerX + size * 5, this.centerY + size * 3, 'BlackPixel')
                .setScale(RealScreenWidth / size + 20, RealScreenHeight / size + 20)
                .setDepth(WinDefaultDepth - 200);
            staticWinBlackBack.setVisible(false);
        }

        if (!this.nineSlice) {
            this.createBack();
        } else {
            if (!staticBackgrounds.hasOwnProperty(this.nineSlice) && this.nineSlice !== 'none') {
                const container = this.engine.add.container(this.centerX, this.centerY).setDepth(WinDefaultDepth - 1);
                const back = engine.add.myNineSlice(0, 0, VisualData.WINDOW_NINE_SLICE[this.nineSlice]).setOrigin(0.5);
                container.add(back);
                container.setVisible(false);
                staticBackgrounds[this.nineSlice] = container;
            }
        }
    }

    showBackground(visible) {
        let back = staticWinBack;
        if (back) {
            back.setVisible(visible);
            if (visible)
                animManager.applyWinOpenAnimation(back);
        }
    }

    showBackOrNineSlice(visible){
        let back = null;

        if (this.nineSlice)
            back = staticBackgrounds[this.nineSlice];

        if (back) {
            back.setVisible(visible);
            if (visible)
                animManager.applyWinOpenAnimation(back);
        } else
            this.showBackground(visible);
    }

    setBlackBackVisible(visible) {
        if (staticWinBlackBack)
            staticWinBlackBack.setVisible(visible);
    }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);
        if (this.nineSlice !== 'none')
            this.showBackOrNineSlice(visible);
        this.setBlackBackVisible(visible);

        if (visible)
            audioManager.playWindowOpen();
    }
}

let staticWinBrownBack = null;

class WinWithBrownBack extends WinWithBack {

    createGame(engine) {
        super.createGame(engine);

        if (!staticWinBrownBack) {
            const size = 32 * GlobalScale;
            staticWinBrownBack = engine.add.sprite(this.centerX + size * 5, this.centerY + size * 3, 'CollectionBack')
                .setScale(RealScreenWidth / size + 10, RealScreenHeight / size + 10)
                .setDepth(WinDefaultDepth - 1000);
            staticWinBrownBack.setVisible(false);
        }

        // this.createMyExitButton();
    }

    createExitButton2() {
        //TOTO temp hack
    }

    playOpenAnimation() {
        //no default animation
    }

    showBackground() {
        //DO nothing
    }

    setBlackBackVisible(visible) {
        if (this.nineSlice)
            super.setBlackBackVisible(visible);
        else {
            if (staticWinBrownBack)
                staticWinBrownBack.setVisible(visible);
        }
    }

    createMyExitButton() {
        this.exitButton = new BasicButton(this.group, {
            'scene': this.engine,
            'key': 'ExitButton',
            'x': this.centerX - RealScreenWidth / 2 + 150 * GlobalScale,
            'y': this.centerY + RealScreenHeight / 2 - 150 * GlobalScale,
        }, this.closeWindow.bind(this)).setDepth(WinDefaultDepth);
        this.addButton(this.exitButton);
    }

    createGroup() {
        this.createGroupNotCenter();
    }
}

class WinDailyBonus extends WinWithBrownBack {
    constructor(gui, gameInit){
        super(gui, gameInit);
    }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);

        if (visible) {
            if (!this.prepared)
                this.prepareWindow();
            else {
                const dailyBonusData = this.gameInit.progress.getDailyBonusData();
                for (let i = 0;i < this.days.length;i++) {
                    const dayInfo = dailyBonusData.getBonusForDay(i + 1);
                    if (dayInfo && dayInfo.isUpdatable()) {
                        const group = this.days[i];
                        group.parameter.setText(dayInfo.getText());
                    }
                }
            }

            const dailyBonusInfo = this.gameInit.progress.getMyDailyBonusInfo();

            const dayNow = Progress.getDayNow();
            const dayWas = Progress.getDayFromTime(dailyBonusInfo.update);

            if (dayNow > dayWas && dailyBonusInfo.lastBonus >= this.days.length)
                dailyBonusInfo.lastBonus = 0;
            this.setBonusInfo(dailyBonusInfo.lastBonus, dayNow > dayWas);
            this._updateButtonState();
        }
    }

    _applyVisibilityClosed(group) {
        if (group.img_closed)
            group.img_closed.visible = group.vis_closed === true;
    }

    _applyVisibilityCheck(group) {
        if (group.img_check)
            group.img_check.visible = group.vis_check === true;
    }

    _applyVisibilityActive(group) {
        if (group.img_active)
            group.img_active.visible = group.vis_active === true;
    }

    setBonusInfo(lastBonus, activeNext) {
        this.activeIndex = -1;
        for (let i = 0;i < this.days.length;i++) {
            const group = this.days[i];

            if (i < lastBonus) {
                group.vis_closed = group.vis_check = true;
                group.vis_active = false;
            } else {
                group.vis_closed = group.vis_check = false;
                group.vis_active = (i == lastBonus && activeNext);//== on purpose
                if (group.vis_active)
                    this.activeIndex = i;
            }
            this._applyVisibilityClosed(group);
            this._applyVisibilityCheck(group);
            this._applyVisibilityActive(group);
        }
    }

    prepareWindow() {
        this.prepared = true;
        const engine = this.engine;

        this.days = [];

        const columns = this.winInfo.columns;
        const rows = this.winInfo.rows;
        const distance = this.winInfo.distance * GlobalScale;

        const dailyBonusData = this.gameInit.progress.getDailyBonusData();

        let index = 0;
        for (let j = 0;j < rows; j++) {
            for (let i = 0; i < columns; i++) {
                index++;

                const dayInfo = dailyBonusData.getBonusForDay(index);
                if (!dayInfo)
                    break;
                const group = engine.add.container();

                group.setPosition(
                    this.centerX + (i - columns / 2 + 0.5) * distance,
                    this.centerY + (j - rows / 2 + 0.5) * distance - this.winInfo.addDistance * GlobalScale);
                group.depth = WinDefaultDepth;

                CreateImageInGroup(engine, group, 'Daily_Opened', (image) => {
                    image.setDepth(WinDefaultDepth);
                    if (this.winInfo.btnsScale)
                        image.setScale(this.winInfo.btnsScale);
                });

                CreateImageInGroup(engine, group, 'Daily_Active', (image) => {
                    group.img_active = image.setDepth(WinDefaultDepth + 10);
                    if (this.winInfo.btnsScale)
                        group.img_active.setScale(this.winInfo.btnsScale);
                    this._applyVisibilityActive(group);
                });

                if (dayInfo) {
                    LoadFile(engine, dayInfo.getIconName(), dayInfo.getIconPath(), () => {
                        const addImg = () => {
                            const img = engine.add.sprite(0, 0, dayInfo.getIconName());
                            group.add(img);
                            img.setDepth(WinDefaultDepth + 15);

                            group.parameter = engine.add.text((this.winInfo.text_x || 110) * GlobalScale, (this.winInfo.text_y || 30) * GlobalScale, dayInfo.getText(), this.winInfo.font ? DefaultFontDailyBonus : DefaultFont)
                                .setOrigin(1, 0)
                                .setDepth(WinDefaultDepth + 18);
                            group.add(group.parameter);
                        };

                        if (!this.winInfo.dailyClosedDepth)
                            addImg();

                        CreateImageInGroup(engine, group, 'Daily_Closed', (image) => {
                            group.img_closed = image.setDepth(WinDefaultDepth + 20);
                            if (this.winInfo.btnsScale)
                                group.img_closed.setScale(this.winInfo.btnsScale);

                            if (this.winInfo.dailyClosedDepth)
                                addImg();
                            this._applyVisibilityClosed(group);

                            CreateImageInGroup(engine, group, 'Daily_Check', (image) => {
                                image.x += 90 * GlobalScale * localScale;
                                image.y += (this.winInfo.check_y || -90) * GlobalScale * localScale;
                                group.img_check = image.setDepth(WinDefaultDepth + 30);
                                this._applyVisibilityCheck(group);
                            });
                        });
                    });
                }

                this.group.add(group);
                this.days.push(group);
            }
        }

        this.createActionButton(engine, this.buttonClicked.bind(this), RealScreenHeight - 200 * GlobalScale, true, 1, RealScreenWidth / 2, 700);
    }

    _updateButtonState() {
        if (this.activeIndex >= 0) {
            this.buttonLabel.setText(LocalizationManager.getLocalizization("LoginBonusGetBtn"));
            this.actionButton.setButtonLocked(false);
        }
        else {
            this.buttonLabel.setText(LocalizationManager.getLocalizization("LoginBonusBlockedBtn"));
            this.actionButton.setButtonLocked(true);
        }
    }

    buttonClicked() {
        if (this.activeIndex >= 0) {
            const dailyBonusData = this.gameInit.progress.getDailyBonusData();
            const bonus = dailyBonusData.getBonusForDay(this.activeIndex + 1);
            if (bonus)
                bonus.activateBonus();
            else
                console.log('No bonus');
            this.gameInit.progress.bonusWasActivated();

            //Visual Update
            const group = this.days[this.activeIndex];
            group.vis_closed = group.vis_check = true;
            group.vis_active = false;
            this._applyVisibilityClosed(group);
            this._applyVisibilityCheck(group);
            this._applyVisibilityActive(group);

            this.activeIndex = -1;
            this._updateButtonState();
        }
    }

    localize() {
        super.localize();
        this.header.setText(LocalizationManager.getLocalizization("LoginBonusTitle"));
    }

    createGame(engine) {
        super.createGame(engine);

        this.header = this.engine.add.text(this.centerX, 100 * GlobalScale, null, DefaultFont)
            .setOrigin(0.5, 0)
            .setDepth(WinDefaultDepth + 1);
        this.group.add(this.header);
    //     this.prepareWindow();
        SetGroupVisible(this.group, false);
    }
}

let staticWinLargeBack = null;

class WinWithLargeBack extends WinWithBack {

    constructor(gui, gameInit){
        super(gui, gameInit);
    }

    createBack() {
        if (!staticWinLargeBack) {
            staticWinLargeBack = this.engine.add.container(this.centerX, this.centerY).setDepth(WinDefaultDepth - 1);
            staticWinLargeBack.add(this.engine.add.sprite(0, 100 * GlobalScale, 'WinUpgradeBack').setDepth(WinDefaultDepth - 100));
            staticWinLargeBack.visible = false;
            staticWinLargeBack.setDepth(WinDefaultDepth - 100);
        }
    }

    showBackground(visible) {
        if (staticWinLargeBack) {
            staticWinLargeBack.visible = visible;
            if (visible)
                animManager.applyWinOpenAnimation(staticWinLargeBack);
        }
    }
}

const PuzzleColorsPerLevel = [
    0xF5CA98,
    0xE59360,
    0xCFCFCF,
    0xFFCC45,
    0x88DDFF,
    0x90cef5
];

class WinDropPuzzle extends WinWithBrownBack {
    constructor(gui, gameInit) {
        super(gui, gameInit);
        this.disableClickables = true;
        this.itemsToDestroy = [];
    }

    createExitButton() {

    }

    createGame(engine) {
        super.createGame(engine);

        function mult(o) {
            o.x *= localScale;
            o.y *= localScale;
            return o;
        }

        const boxScale = 1.5;
        this.dropPoint = ({x: this.centerX, y: this.centerY + 400 * GlobalScale});
        this.puzzlePoint = ({x: this.centerX, y: this.centerY - 100 * GlobalScale});
        this.puzzleUpPoint = ({x: this.centerX, y: this.centerY - 300 * GlobalScale});
        this.collectedPoint = ({x: this.centerX, y: this.centerY});
        this.collectedPoint2 = mult({x: this.centerX, y: this.centerY});
        this.startPoxY = -RealScreenHeight * 0.1;

        this.giftBox = this.engine.add.sprite(0, 0, "GiftBox").setScale(boxScale).setOrigin(0.5, 1);
        this.group.add(this.giftBox);

        this.giftBoxSuper = this.engine.add.sprite(0, 0, "GiftBoxSuper").setScale(boxScale).setOrigin(0.5, 1);
        this.group.add(this.giftBoxSuper);

        this.giftGuardBox = this.engine.add.sprite(0, 0, "ChestGuard").setScale(boxScale).setOrigin(0.5, 1);
        this.group.add(this.giftGuardBox);

        this.giftGuardBoxSuper = this.engine.add.sprite(0, 0, "ChestGuardSuper").setScale(boxScale).setOrigin(0.5, 1);
        this.group.add(this.giftGuardBoxSuper);

        this.giftBoxOpen = this.engine.add.sprite(0, 0, "GiftBoxOpen").setScale(boxScale).setPosition(this.dropPoint.x - 60 * GlobalScale, this.dropPoint.y - 40 * GlobalScale).setOrigin(0.5, 1);
        this.group.add(this.giftBoxOpen);

        this.giftBoxSuperOpen = this.engine.add.sprite(0, 0, "GiftBoxSuperOpen").setScale(boxScale * 1.2).setPosition(this.dropPoint.x - 70 * GlobalScale, this.dropPoint.y + 10 * GlobalScale).setOrigin(0.5, 1);
        this.group.add(this.giftBoxSuperOpen);

        this.giftGuardBoxOpen = this.engine.add.sprite(0, 0, "ChestGuardOpen").setScale(boxScale).setPosition(this.dropPoint.x - 60 * GlobalScale, this.dropPoint.y - 40 * GlobalScale).setOrigin(0.5, 1);
        this.group.add(this.giftGuardBoxOpen);

        this.giftGuardBoxSuperOpen = this.engine.add.sprite(0, 0, "ChestGuardSuperOpen").setScale(boxScale * 1.2).setPosition(this.dropPoint.x - 70 * GlobalScale, this.dropPoint.y + 10 * GlobalScale).setOrigin(0.5, 1);
        this.group.add(this.giftGuardBoxSuperOpen);

        this.header = this.engine.add.text(this.centerX, 300 * GlobalScale, "", DefaultFont).setOrigin(0.5);
        this.group.add(this.header);
        this.bottomLabel = this.engine.add.text(this.centerX, RealScreenHeight - 500 * GlobalScale, "", DefaultFont).setOrigin(0.5);
        this.group.add(this.bottomLabel);

        this.createActionButton(this.engine, this._tryToCloseWindow.bind(this), RealScreenHeight - 250 * GlobalScale, true, 1, this.centerX);
    }

    _tryToCloseWindow() {
        this._destroyStuff();
        if (!gameInit.progress.openSuperChest()) {
            if (!gameInit.progress.openGuardChest()) {
                if (!gameInit.progress.openGuardSuperChest())
                    this.closeWindow();
            }
        }
    }

    localize() {
        this.buttonLabel.setText(LocalizationManager.getLocalizization("ButtonOk"));
    }

    createMyExitButton() {
        //Do nothing
    }

    _destroyStuff() {
        if (this.itemsToDestroy && this.itemsToDestroy.length) {
            for (let i in this.itemsToDestroy)
                this.itemsToDestroy[i].destroy();
            this.itemsToDestroy = [];
        }
    }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);
        if (!visible)
            this._destroyStuff();
    }

    dropPuzzle(beforeInfo, imageId, drop, dublicate, type) {
        const imageInfo = beforeInfo;
        const guard = type === BoxType.GuardBox || type === BoxType.GuardSuperBox;
        const newImageInfo = guard ? gameInit.progress.getGuardPuzzleInfoById(imageId) : gameInit.progress.getPuzzleInfoById(imageId);
        const size = GameData.getPuzzleSizePerLevel(imageInfo.level);
        const engine = this.engine;

        const i = Math.trunc(drop / size);
        const j = drop % size;

        this.header.setVisible(false);
        this.bottomLabel.setVisible(false);
        this.actionButton.setVisible(false);
        this.buttonLabel.setVisible(false);

        this.giftBox.setVisible(type === BoxType.GoldBox);
        this.giftBoxSuper.setVisible(type === BoxType.SuperBox);
        this.giftGuardBox.setVisible(type === BoxType.GuardBox);
        this.giftGuardBoxSuper.setVisible(type === BoxType.GuardSuperBox);
        this.giftBoxOpen.setVisible(false);
        this.giftGuardBoxOpen.setVisible(false);
        this.giftBoxSuperOpen.setVisible(false);
        this.giftGuardBoxSuperOpen.setVisible(false);

        let box = null;
        switch (type) {
            case BoxType.GoldBox:
                box = this.giftBox;
                break;
            case BoxType.SuperBox:
                box = this.giftBoxSuper;
                break;
            case BoxType.GuardBox:
                box = this.giftGuardBox;
                break;
            case BoxType.GuardSuperBox:
                box = this.giftGuardBoxSuper;
                break;
        }
        let openedBox = null;
        switch (type) {
            case BoxType.GoldBox:
                openedBox = this.giftBoxOpen;
                break;
            case BoxType.SuperBox:
                openedBox = this.giftBoxSuperOpen;
                break;
            case BoxType.GuardBox:
                openedBox = this.giftGuardBoxOpen;
                break;
            case BoxType.GuardSuperBox:
                openedBox = this.giftGuardBoxSuperOpen;
                break;
        }

        box.setPosition(this.dropPoint.x, this.startPoxY);

        // console.log("imageId " + imageId + " > " + drop);
        //Image
        const ImageName = guard ? gameInit.guardManager.getGuardIcon(imageId + 1) : GameData.getPuzzleIcon(imageId + 1);

        LoadFile(engine, ImageName, (guard ? VisualData.getManagerPuzzleFolder() : VisualData.getPuzzleFolder()) + ImageName + ".png", () => {

            animManager.moveToPointExtra(box, this.dropPoint, 0.05, 0.3, () => {
                audioManager.playChestSound(0);
                animManager.changeShape(box, 0.4, 0.5, 1, () => {
                    animManager.rotationAnimation(box, 10, 0.7, 3, () => {
                        box.setVisible(false);
                        openedBox.setVisible(true);

                        const scale = 0.5;
                        const puzzleCont = engine.add.container(this.puzzlePoint.x, this.puzzlePoint.y);
                        const puzzleImg = engine.add.sprite(0, 0, ImageName);
                        const step = puzzleImg.width / size;
                        puzzleImg.setCrop(i * step, j * step, step, step).setScale(scale * size).setOrigin((i + 0.5) / size, (j + 0.5) / size);

                        let realLevel = newImageInfo.level;
                        if (newImageInfo.pieces & (1 << (drop)))
                            realLevel++;

                        if (VisualData.getGameSettings().puzzle_top) {
                            puzzleImg.tint = PuzzleColorsPerLevel[realLevel - 1];
                        } else {
                            const backImg = engine.add.sprite(0, 0, GameData.getPuzzleBackNamePerLevel(realLevel));
                            backImg.setScale(puzzleImg.width / backImg.width * scale);
                            puzzleCont.add(backImg);
                        }

                        puzzleCont.add(puzzleImg);
                        puzzleCont.setDepth(WinDefaultDepth + 100);
                        puzzleCont.angle = 180;

                        //Labels
                        if (dublicate) {
                            this.header.text = LocalizationManager.getLocalizization("GetPuzzlePartDupTitle");
                            this.bottomLabel.text = LocalizationManager.getLocalizization("GetPuzzlePartDupText").format(GameData.getGemsForDublicate());
                        } else {
                            this.header.text = LocalizationManager.getLocalizization("GetPuzzlePartText");
                            this.bottomLabel.text = LocalizationManager.getLocalizization("GetPuzzlePartTitle");
                        }
                        this.header.setVisible(true);
                        this.bottomLabel.setVisible(true);
                        animManager.applyWinOpenAnimation(this.header);
                        animManager.applyWinOpenAnimation(this.bottomLabel);

                        //Labels...

                        audioManager.playChestSound(1);
                        const upDuration = 0.3;
                        animManager.moveToPointExtra(puzzleCont, this.puzzleUpPoint, 0.1, upDuration);
                        animManager.scaleAnimation(puzzleCont, 2, upDuration);
                        animManager.rotationAnimation(puzzleCont, 180, upDuration, 0.25, () => {
                            animManager.animationChangeAlpha(openedBox, 0, 0.3, () => {
                                openedBox.setVisible(false);
                                openedBox.alpha = 1;

                                const collectedPuzzle = winPuzzleInstance.getCell({
                                    item: imageInfo,
                                    index: imageId,
                                    realLevel: newImageInfo.level
                                }, true, false, null, guard);
                                this.itemsToDestroy.push(collectedPuzzle);
                                collectedPuzzle.setPosition(this.collectedPoint2.x * localScale, RealScreenHeight * 1.1 * localScale);
                                const moveUpDuration = 0.5;
                                animManager.moveToPointExtra(collectedPuzzle, this.collectedPoint2, 0.05, moveUpDuration);

                                animManager.waitAnimation(0.7 * moveUpDuration, () => {
                                    const downDuration = 0.5;
                                    animManager.scaleAnimation(puzzleCont, 1, downDuration);
                                    animManager.rotationAnimation(puzzleCont, 90, downDuration, 0.25);
                                    puzzleCont.setPosition(this.collectedPoint.x, this.collectedPoint.y);
                                    const fallAnim = animManager.moveToPointExtra(puzzleCont, this.puzzleUpPoint, 0.5, downDuration, () => {
                                        audioManager.playChestSound(2);
                                        puzzleCont.destroy(true);
                                        if (!dublicate) {
                                            const prevBack = collectedPuzzle.images[i * size + j];
                                            prevBack.destroy(true);

                                            const puzzleSize = size;
                                            const backSize = winPuzzleInstance.winInfo.partSize * GlobalScale;
                                            const partSize = backSize / puzzleSize;

                                            let x = collectedPuzzle.x / localScale;
                                            let y = collectedPuzzle.y / localScale;

                                            let newBack;
                                            if (VisualData.getGameSettings().puzzle_top) {
                                                newBack = engine.add.sprite(x, y, ImageName)
                                                    .setDepth(WinDefaultDepth + 100 - 10);
                                                newBack.setCrop(i * partSize, j * partSize, partSize, partSize);
                                                newBack.tint = PuzzleColorsPerLevel[realLevel - 1];
                                            } else {
                                                x += (i - puzzleSize * 0.5) * partSize;
                                                y += (j - puzzleSize * 0.5) * partSize;

                                                newBack = engine.add.sprite(x, y, GameData.getPuzzleBackNamePerLevel(realLevel))
                                                    .setOrigin(0, 0)
                                                    .setDepth(WinDefaultDepth + 100 - 10);

                                                newBack.setScale(partSize / newBack.width / imagesDeltaScale);
                                            }
                                            collectedPuzzle.add(newBack);
                                        }

                                        this.actionButton.setVisible(true);
                                        this.buttonLabel.setVisible(true);
                                        animManager.applyButtonShowAnimation(this.actionButton);
                                    });
                                    fallAnim.setInverse();
                                });
                            });
                        });
                    });
                })
            });
        });
    }
}

let winPuzzleInstance;

class WinPuzzle extends WinWithBrownBack {
    constructor(gui, gameInit) {
        super(gui, gameInit);

        this.disableClickables = true;
        this.selectedTab = 0;
        winPuzzleInstance = this;
        this.allCells = [];
    }

    localize() {
        super.localize();

        this.header.text = LocalizationManager.getLocalizization("PuzzlesWindowTitle");

        for (let i = 0; i < 5; i++)
            this.puzzleNames[i].text = LocalizationManager.getLocalizization(GameData.getPuzzlesTextPerLevel(i + 1));
    }

    addTab(icon, x, y) {
        const tab = new ToogleButton(this.engine, this.group, icon, x, y, () => this.tabWasSwitched(tab), this.winInfo);

        this.tabs.push(tab);
        return this.tabs.length - 1;
    }

    _prepareWindow() {
        if (this.prepared)
            return;

        this.prepared = true;

        this.createStore(this.engine);
    }

    createGame(engine) {
        super.createGame(engine);

        const yPos = this.centerY + this.winInfo.togglesY * GlobalScale;

        this.header = engine.add.text(this.centerX - this.winInfo.togglesX * GlobalScale, yPos - 30 * GlobalScale, null, DefaultFont)
            .setOrigin(0, 1)
            .setDepth(WinDefaultDepth + 1);
        this.group.add(this.header);

        //Tabs
        const distance = this.winInfo.togglesDistance * GlobalScale;
        let xPos = this.centerX + this.winInfo.togglesX * GlobalScale - distance;

        if (this.gameInit.guardManager)
            xPos -= distance;

        this.tabs = [];
        this.slotsPuzzleTab = this.addTab('PuzzleTabIcon', xPos, yPos);
        xPos += distance;
        if (this.gameInit.guardManager) {
            this.guardsPuzzleTab = this.addTab('GuardsTabIcon', xPos, yPos);
            xPos += distance;
        }
        this.storeTab = this.addTab('BoxTabIcon', xPos, yPos);

        let index = 0;
        this.configs = [];
        this.configs[index++] = VisualData.PUZZLE_SCROLL_CONFIG;
        if (this.gameInit.guardManager)
            this.configs[index++] = VisualData.PUZZLE_SCROLL_CONFIG_MANAGERS;
        this.configs[index] = VisualData.PUZZLE_SCROLL_CONFIG_STORE;

        for (let i in this.configs) {
            this.configs[i].x = this.centerX + this.configs[i].offsetX * GlobalScale;
            this.configs[i].y = this.centerY + this.configs[i].offsetY * GlobalScale;
        }

        this.groups = [];
        this.groups.push(engine.add.group());
        this.groups.push(engine.add.group());

        this.createSummary(engine);
        // this.createStore(engine);

        for (let i in this.groups)
            SetGroupVisible(this.groups[i], false);
        SetGroupVisible(this.group, false);
    }

    createStore(engine) {
        let index = 0;
        this.scroll = [];
        this.scroll.push(new GUIScroll(engine, this.configs[index], this.getCell.bind(this), this.getItems.bind(this)));
        this.scroll[index++].setVisible(false);

        if (this.gameInit.guardManager) {
            this.scroll.push(new GUIScroll(engine, this.configs[index], this.getCellManager.bind(this), this.getItems.bind(this)));
            this.scroll[index++].setVisible(false);
        }

        this.scroll.push(new GUIScroll(engine, this.configs[index], this.getStoreCell.bind(this), this.getStoreItems.bind(this)));
        this.scroll[index].setVisible(false);
    }

    updateChestsNumber() {
        const group = this.allCells[0];

        if (!group || !group.active)
            return;

        const chestsCount = gameInit.progress.getChestsCount();

        const showButton = chestsCount > 0 && this.selectedTab === this.storeTab && this.visible;

        if (showButton) {
            if (!this.myChestsBack || !this.myChestsBack.active) {
                const config = this.configs[this.storeTab];
                const depth = WinDefaultDepth + 200;
                const center = false;
                const cellCenterX = center ? 0 : config.cellWidth / 2 * GlobalScale;
                const cellCenterY = center ? 0 : config.cellHeight / 2 * GlobalScale;

                const offsetX = (this.winInfo.popup_x || 80) * GlobalScale;
                const offsetY = (this.winInfo.popup_y || -180) * GlobalScale;

                const px = group.x / localScale + cellCenterX + offsetX;
                const py = group.y / localScale + cellCenterY + offsetY;
                this.myChestsBack = this.engine.add.sprite(px, py, "BoxCounter").setDepth(depth);
                this.myChestsNumber = this.engine.add.textOld(px, py, "H", DefaultFont).setDepth(depth + 1).setOrigin(0.5);

                group.add(this.myChestsBack);
                group.add(this.myChestsNumber);
            }
        } else {
            if (this.myChestsBack && this.myChestsBack.active) {
                this.myChestsBack.destroy();
                this.myChestsNumber.destroy();
                this.myChestsBack = null;
                this.myChestsNumber = null;
            }
        }

        if (chestsCount > 0 && this.selectedTab === this.storeTab) {
            if (this.myChestsNumber && this.myChestsNumber.active)
                this.myChestsNumber.text = chestsCount;
            setStoreCellLocked(this.availableBoxes, false);
            if (this.visible)
                this.scroll[this.storeTab].fakeMove();
        } else {
            setStoreCellLocked(this.availableBoxes, true);
        }
    }

    createSummary(engine) {
        const group = this.groups[0];
        const distanceX = (this.winInfo.icons_distanceX || 800) * GlobalScale;
        const distanceY = 120 * GlobalScale;

        const cx = this.centerX + distanceX / 4;
        const cy = RealScreenHeight - distanceY * 3 - 20 * GlobalScale;

        this.puzzleNumbers = [];
        this.puzzleNames = [];

        for (let i = 1; i <= 5; i++) {
            const x = cx - (i % 2) * distanceX;
            const y = cy + Math.trunc(((i - 1) / 2)) * distanceY;
            group.create(x, y, GameData.getPuzzlesIconNamePerLevel(i))
                .setOrigin(0, 0)
                .setDepth(WinDefaultDepth);

            const number = engine.add.text(x + 130 * GlobalScale, y - 10 * GlobalScale, null, this.winInfo.puzzleNumberFont ? PuzzleNumberFont : DefaultFontSmall).setDepth(WinDefaultDepth);
            const name = engine.add.text(x + 130 * GlobalScale, y + 50 * GlobalScale, null, DefaultFontSmall2).setDepth(WinDefaultDepth);
            this.puzzleNumbers.push(number);
            this.puzzleNames.push(name);
            group.add(number);
            group.add(name);
        }
    }

    tabWasSwitched(tab) {
        for (let i = 0; i < this.tabs.length; i++) {
            if (this.tabs[i] === tab) {
                this.tabs[i].setSelected(true);
                this.selectedTab = i;
            } else {
                this.tabs[i].setSelected(false);
            }
        }

        for (let i in this.scroll)
            this.scroll[i].setVisible(i == this.selectedTab);

        if (this.selectedTab === this.storeTab) {
            this.scroll[this.selectedTab].table.setItems(this.getStoreItems());
            this.updateChestsNumber();
            SetGroupVisible(this.groups[1], true);
            SetGroupVisible(this.groups[0], false);
        } else {
            this.updateNumbers();
            this.scroll[this.selectedTab].table.setItems(this.getItems());
            SetGroupVisible(this.groups[0], true);
            SetGroupVisible(this.groups[1], false);
        }
    }

    updateNumbers() {
        const puzzles = this.getItems();
        const counts = [];
        for (let i = 0; i < 5; i++)
            counts.push(0);

        for (let i = 0; i < puzzles.length; i++) {
            if (puzzles[i].level > 0)
                counts[puzzles[i].level - 1]++;
        }

        const max = "/" + puzzles.length;
        for (let i = 0; i < 5; i++)
            this.puzzleNumbers[i].text = counts[i] + max;
    }

    _removeTimer() {
        if (this.boxShakeTimer) {
            clearInterval(this.boxShakeTimer);
            this.boxShakeTimer = null;
        }
    }

    setGuardsPage() {
        this.selectedTab = this.guardsPuzzleTab;
    }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);
        this._removeTimer();
        if (visible) {
            this._prepareWindow();
            this.tabWasSwitched(this.tabs[this.selectedTab]);
            this.updateChestsNumber();
            this.boxShakeTimer = setInterval(() => {
                if (gameInit.progress.getChestsCount() > 0 && this.availableBoxes && this.availableBoxes.active && this.availableBoxes.unny_sprite) {
                    if (!this.availableBoxesPos)
                        this.availableBoxesPos = {
                            x: (this.availableBoxes.unny_sprite.x - this.availableBoxes.x) / localScale,
                            y: (this.availableBoxes.unny_sprite.y - this.availableBoxes.y) / localScale
                        };
                    this.availableBoxes.unny_sprite.setPosition(this.availableBoxesPos.x + this.availableBoxes.x / localScale, this.availableBoxesPos.y + this.availableBoxes.y / localScale);
                    if (this.boxShakeAnimation)
                        this.boxShakeAnimation.stopAnimation();
                    this.boxShakeAnimation = animManager.shakeBox(this.availableBoxes.unny_sprite, 7, 20 * GlobalScale, 0.6, 2);
                }
            }, 2000);
        } else {
            for (let i in this.scroll)
                this.scroll[i].table.setVisible(false);

            for (let i in this.groups)
                SetGroupVisible(this.groups[i], visible);
        }

        hudResources.setVisible(this.winInfo.showHud && visible);
    }

    _checkPriceInGold(group, price) {
        setStoreCellLocked(group, !gameInit.progress.isResourcesEnough(price));
    }

    _checkPrice(group, data) {
        setStoreCellLocked(group, !gameInit.progress.isResourcesWithTypeEnough(data));
    }

    getStoreCell(cell, center) {
        const progress = gameInit.progress;
        const engine = this.engine;

        const config = this.configs[this.storeTab];
        const cellCenterX = center ? 0 : config.cellWidth / 2 * GlobalScale;
        const cellCenterY = center ? 0 : config.cellHeight / 2 * GlobalScale;
        const goldBox = GameData.getBoxByType("Gold");
        const gemsBox = GameData.getBoxByType("Gem");
        const superBox = GameData.getBoxByType("GemSuper");
        const guardBox = GameData.getBoxByType("Guard");
        const superGuardBox = GameData.getBoxByType("GuardSuper");

        const offsetX = (this.winInfo.popup_x || 80) * GlobalScale;
        const offsetY = (this.winInfo.popup_y || -180) * GlobalScale;

        let group = engine.rexUI.add.container(0, 0);
        const depth = WinDefaultDepth + 200;
        const chestImage = "GiftBoxStore";
        const chestImagePath = VisualData.getChestIconPath();

        this.allCells[cell.index] = group;

        switch (cell.index) {
            case 0:
                this.availableBoxesPos = null;
                this.availableBoxes = group;

                createStoreCell(engine, group, cellCenterX, cellCenterY,
                    LocalizationManager.getLocalizization("BoxOpenTitle"),
                    "OpenedBox",
                    VisualData.getPuzzleUIFolder() + "OpenedBox.png",
                    LocalizationManager.getLocalizization("BoxOpenDesc"),
                    null,
                    LocalizationManager.getLocalizization("BoxOpenButtonText", "OPEN"),
                    () => {
                        if (progress.getChestsCount() > 0) {
                            progress.openChest();
                            this.updateChestsNumber();
                        }
                    }
                );

                this.updateChestsNumber();
                break;
            case 1:
                let price = progress.getPriceForGoldBox();
                const boxForGold = createStoreCell(engine, group, cellCenterX, cellCenterY,
                    LocalizationManager.getLocalizization("BoxGoldTitle"),
                    chestImage,
                    chestImagePath,
                    LocalizationManager.getLocalizization("BoxGoldDesc"),
                    GameData.getIconByType(goldBox.priceType),
                    LocalizationManager.getLocalizedNumber(price),
                    () => {
                        price = progress.tryToPurchaseBoxForGold(goldBox.count);
                        if (price) {
                            this.updateChestsNumber();
                            boxForGold.text = LocalizationManager.getLocalizedNumber(price);
                            this._checkPriceInGold(group, price);
                        }
                    });

                this._checkPriceInGold(group, price);

                group.add(engine.add.sprite(cellCenterX + offsetX, cellCenterY + offsetY, "BoxCounter").setDepth(depth));
                group.add(engine.add.textOld(cellCenterX + offsetX, cellCenterY + offsetY, "x1", DefaultFont).setDepth(depth).setOrigin(0.5));
                break;
            case 2:
                createStoreCell(engine, group, cellCenterX, cellCenterY,
                    LocalizationManager.getLocalizization("BoxGemTitle"),
                    chestImage,
                    chestImagePath,
                    LocalizationManager.getLocalizization("BoxGemDesc"),
                    GameData.getIconByType(gemsBox.priceType),
                    gemsBox.priceGems,
                    () => {
                        const gemsPrice = gemsBox.bigInt;
                        if (progress.isGemsEnough(gemsPrice)) {
                            if (!progress.areAllPuzzlesCollected()) {
                                progress.gemsSpent(gemsPrice);
                                progress.purchaseBox(BoxType.GemsBox, gemsBox.count);
                                this.updateChestsNumber();
                            }
                        } else
                            guiManager.openNewWindow(WindowType.WinNotEnoughGems);
                    });

                group.add(engine.add.sprite(cellCenterX + offsetX, cellCenterY + offsetY, "BoxCounter").setDepth(depth));
                group.add(engine.add.textOld(cellCenterX + offsetX, cellCenterY + offsetY, "x3", DefaultFont).setDepth(depth).setOrigin(0.5));
                break;
            case 3:
                createStoreCell(engine, group, cellCenterX, cellCenterY,
                    LocalizationManager.getLocalizization("BoxGemSuperTitle"),
                    "GiftBoxSuper",
                    VisualData.getStoreFolder() + "GiftBoxSuper.png",
                    LocalizationManager.getLocalizization("BoxGemSuperDesc"),
                    GameData.getIconByType(superBox.priceType),
                    superBox.priceGems,
                    () => {
                        const gemsPrice = superBox.bigInt;
                        if (progress.isGemsEnough(gemsPrice)) {
                            if (!progress.areAllPuzzlesCollected()) {
                                progress.gemsSpent(gemsPrice);
                                progress.giveChests(BoxType.SuperBox, superBox.count);
                            }
                        } else
                            guiManager.openNewWindow(WindowType.WinNotEnoughGems);
                    });
                break;
            case 4:
                createStoreCell(engine, group, cellCenterX, cellCenterY,
                    LocalizationManager.getLocalizization("BoxGuardTitle"),
                    "ChestGuard",
                    "UI/Windows/GetPuzzlePart/ChestGuard.png",
                    LocalizationManager.getLocalizization("BoxGuardDesc"),
                    GameData.getIconByType(guardBox.priceType),
                    guardBox.priceGems,
                    () => {
                        const gemsPrice = guardBox.bigInt;
                        if (progress.isGemsEnough(gemsPrice)) {
                            if (!progress.areAllPuzzlesCollected()) {
                                progress.gemsSpent(gemsPrice);
                                progress.purchaseBox(BoxType.GuardBox, guardBox.count);
                                this.updateChestsNumber();
                            }
                        } else
                            guiManager.openNewWindow(WindowType.WinNotEnoughGems);
                    });
                break;
            case 5:
                createStoreCell(engine, group, cellCenterX, cellCenterY,
                    LocalizationManager.getLocalizization("BoxGuardSuperTitle"),
                    "ChestGuardSuper",
                    "UI/Windows/GetPuzzlePart/ChestGuardSuper.png",
                    LocalizationManager.getLocalizization("BoxGuardSuperDesc"),
                    GameData.getIconByType(superGuardBox.priceType),
                    superGuardBox.priceGems,
                    () => {
                        const gemsPrice = superGuardBox.bigInt;
                        if (progress.isGemsEnough(gemsPrice)) {
                            if (!progress.areAllPuzzlesCollected()) {
                                progress.gemsSpent(gemsPrice);
                                progress.giveChests(BoxType.GuardSuperBox, superGuardBox.count);
                            }
                        } else
                            guiManager.openNewWindow(WindowType.WinNotEnoughGems);
                    });
                break;
        }

        return group.setOrigin(0).setDepth(depth);
    }

    getCellManager(cell, center, button) {
        const engine = this.engine;

        let group = engine.rexUI.add.container(0, 0);
        group.puzzle = this.getCell(cell, true, true, () => {
            this.gameInit.guardManager.switchGuard(this.gameInit.selectedWorld, guard);
            this.scroll[this.selectedTab].table.setItems(this.getItems());
        }, true);

        group.puzzle.setPosition(100 * localScale, 100 * localScale);
        group.add(group.puzzle);

        const guard = this.gameInit.guardManager.getGuardById(cell.item.id);
        const selectedGuard = this.gameInit.guardManager.getGuardForWorld(this.gameInit.selectedWorld);

        if (!guard)
            console.error("guard wasn't found ", cell.item);
        else {
            let y = 70 * GlobalScale;
            const nameBack = engine.add.sprite(650 * GlobalScale, y, 'Managers_UnderText_1').setDepth(WinDefaultDepth + 100).setScale(1.5, 1);
            group.add(nameBack);
            let name = engine.add.textOld(650 * GlobalScale, y, guard.title, DefaultFont).setOrigin(0.5, 0.5).setDepth(WinDefaultDepth + 100);
            group.add(name);
            y += 90 * GlobalScale;

            const passives = guard.getPassiveBonusesType();
            for (let i in passives) {
                const pb = passives[i];

                let text = null;
                if (guard.level > 0) {
                    switch (pb) {
                        case 'MultiProfit':
                        case 'MultiProfitLow':
                            if (guard.getPassiveBonusValueMinimum())
                                text = "Profit: +" + guard.getPassiveBonusValueMinimum() + "%";
                            else
                                text = null;
                            break;
                        case 'SeedProc':
                            text = "Seeds Bonus +" + guard.getPassiveBonusValueMinimum();
                            break;
                        default:
                            text = pb;
                            break;
                    }
                } else
                    text = "???";

                if (text) {
                    group.passive = engine.add.textOld(400 * GlobalScale, y, text, DefaultFontSmallBlack)
                        .setOrigin(0, 0.5)
                        .setDepth(WinDefaultDepth + 100);
                    group.add(group.passive);
                }

                y += 40 * GlobalScale;
            }

            if (guard.level > 0) {
                y += 30 * GlobalScale;
                group.passive = engine.add.textOld(400 * GlobalScale, y, LocalizationManager.getLocalizization("Manager_super_doubling").format(guard.getActiveBonusValueMinumum()), DefaultFontSmallBlack)
                    .setOrigin(0, 0.5)
                    .setDepth(WinDefaultDepth + 100);
                group.add(group.passive);
            }

            if (selectedGuard === guard) {
                const doneIcon = engine.add.sprite(350 * GlobalScale, 50 * GlobalScale, 'PhotoQuestDoneIcon').setDepth(WinDefaultDepth + 1000);
                group.add(doneIcon);
            }
        }

        return group;
    }

    getCell(cell, center, button, callback, manager) {
        const config = this.configs[this.slotsPuzzleTab];

        const puzzle = cell.item;
        const engine = this.engine;
        // const item = cell.item;
        //
        // if (!item) {
        //     return engine.rexUI.add.label();
        // }
        const cellCenterX = center ? 0 : config.cellWidth / 2 * GlobalScale;
        const cellCenterY = center ? 0 : config.cellHeight / 2 * GlobalScale;

        let group = engine.rexUI.add.container(0, 0);
        group.images = [];

        const depth = WinDefaultDepth + 100;

        //Image
        const ImageName = manager ? gameInit.guardManager.getGuardIcon(puzzle.id) : GameData.getPuzzleIcon(cell.index + 1);
        const puzzleSize = GameData.getPuzzleSizePerLevel(puzzle.level);

        const set = VisualData.getGameSettings();

        let loading = true;
        if (ImageName) {
            LoadFile(engine, ImageName, (manager ? VisualData.getManagerPuzzleFolder() : VisualData.getPuzzleFolder()) + ImageName + ".png", () => {
                if (group && group.active) {
                    const x0 = group.x / localScale;
                    const y0 = group.y / localScale;
                    // if (button) {
                    //     group.unny_button = new BasicButton(group, {
                    //         'scene': engine,
                    //         'key': ImageName,
                    //         'x': x0 + cellCenterX,
                    //         'y': y0 + cellCenterY,
                    //         'scale_parent': true
                    //     }, callback).setDepth(depth - 7);
                    //     group.add(group.unny_button);
                    // } else {
                    //TODO fix button for managers
                    if (!set.puzzle_top) {
                        const sprite = engine.add.sprite(x0 + cellCenterX, y0 + cellCenterY, ImageName)
                            .setDepth(depth - 7);
                        group.add(sprite);
                    }
                    // }

                    //Background
                    const backSize = this.winInfo.partSize * GlobalScale;
                    const partSize2 = this.winInfo.frontPartSize * GlobalScale / puzzleSize;
                    const partSize = backSize / puzzleSize;

                    const backDepth = depth - 10;
                    let index = 0;

                    for (let i = 0; i < puzzleSize; i++) {
                        for (let j = 0; j < puzzleSize; j++) {
                            let realLevel = puzzle.level;
                            if ((puzzle.pieces & (1 << (index++))) !== 0)
                                realLevel++;

                            let backImg = null;
                            if (realLevel === 0) {
                                let puzzleImg = null;
                                switch (index) {
                                    case 1:
                                        puzzleImg = 'PuzzleItemLockUL';
                                        break;
                                    case 2:
                                        puzzleImg = 'PuzzleItemLockDL';
                                        break;
                                    case 3:
                                        puzzleImg = 'PuzzleItemLockUR';
                                        break;
                                    case 4:
                                        puzzleImg = 'PuzzleItemLockDR';
                                        break;
                                }

                                if (this.winInfo.centerBlock) {
                                    backImg = engine.add.sprite(x0 + cellCenterX, y0 + cellCenterY, puzzleImg)
                                        .setDepth(depth - 2);
                                } else {
                                    const x = cellCenterX + (i - puzzleSize * 0.5) * partSize2;
                                    const y = cellCenterY + (j - puzzleSize * 0.5) * partSize2;
                                    backImg = engine.add.sprite(x0 + x, y0 + y, puzzleImg).setDepth(depth - 2).setOrigin(0, 0);
                                }
                            } else {
                                if (set.puzzle_top) {
                                    backImg = engine.add.sprite(x0 + cellCenterX, y0 + cellCenterY, ImageName)
                                        .setDepth(depth - 7);
                                    backImg.setCrop(i * partSize, j * partSize, partSize, partSize);
                                    backImg.tint = PuzzleColorsPerLevel[realLevel - 1];
                                } else {
                                    const x = cellCenterX + (i - puzzleSize * 0.5) * partSize;
                                    const y = cellCenterY + (j - puzzleSize * 0.5) * partSize;

                                    backImg = engine.add.sprite(x0 + x, y0 + y, GameData.getPuzzleBackNamePerLevel(realLevel))
                                        .setOrigin(0, 0)
                                        .setDepth(backDepth);

                                    backImg.setScale(partSize / backImg.width / imagesDeltaScale);
                                }
                            }

                            group.add(backImg);
                            group.images.push(backImg);
                        }
                    }

                    if (!loading && this.scroll)
                        this.scroll[this.selectedTab].fakeMove();
                }
            });
        }
        loading = false;
        //

        if (!this.winInfo.no_frame) {
            const frame = engine.add.sprite(cellCenterX, cellCenterY, "PuzzleItemFrame").setDepth(depth - 5);
            group.add(frame);
        }

        if (puzzle.level > 0 && puzzle.level < 5 && this.winInfo.showGrid) {
            const bonusBack = engine.add.sprite(cellCenterX, cellCenterY, "Grid" + puzzleSize)
                .setDepth(depth - 6);
            group.add(bonusBack);
        }

        const hintLevel = cell.realLevel ? cell.realLevel : puzzle.level;
        if (hintLevel >= 2) {
            const bonusBack = engine.add.sprite(cellCenterX + this.winInfo.BonusOffsetX * GlobalScale, cellCenterY - 140 * GlobalScale, "PuzzleBonusBack")
                .setOrigin(1, 0.5)
                .setScale(1.2, 1)
                .setDepth(depth);
            group.add(bonusBack);

            const resources = engine.add.sprite(cellCenterX - 95 * GlobalScale, cellCenterY - 140 * GlobalScale, "PriceIcon")
                .setScale(0.7)
                .setDepth(depth);
            group.add(resources);

            const bonusText = engine.add.textOld(cellCenterX - 50 * GlobalScale, cellCenterY - 140 * GlobalScale, "+" + (GameData.getPuzzleResourceBonusPerLevel(hintLevel) - 1) * 100 + "%", DefaultFontSmallPuzzleBonus)
                .setOrigin(0, 0.5)
                .setDepth(depth);
            group.add(bonusText);
        }

        return group
            .setOrigin(0);
        // .setDepth(depth);
    }

    getItems() {
        return this.selectedTab === this.slotsPuzzleTab ? gameInit.progress.getPuzzleInfo() : gameInit.progress.getGuardPuzzleInfo();
    }

    getStoreItems() {
        if (gameInit.guardManager)
            return [0, 1, 2, 3, 4, 5];
        return [0, 1, 2, 3];
    }

    getSelectedTab() {
        return this.selectedTab;
    }

    getBoxesTab() {
        return this.tabs[this.storeTab].button;
    }

    getBoxesScroll() {
        return this.scroll[this.storeTab];
    }

    getPuzzleOpenBox() {
        return this.allCells[0].unny_btn;
    }

    setGuardsTab() {
        this.selectedTab = this.guardsPuzzleTab;
    }
}

const GEMS_VIDEO_REWARD_ID = 'gemsForVideoAd';

class WinStore extends WinWithLargeBack {

    constructor(gui, gameInit){
        super(gui, gameInit);
        this.selectedTab = 0;
        this.allCells = {};
        this.disableClickables = true;
    }

    createSettingsButton() {
        let x, y;
        // if (VisualData.IsVertical()) {
        //     x = 150 * GlobalScale;
        //     y = RealScreenHeight - 150 * GlobalScale;
        // } else {
        x = RealScreenWidth - 180 * GlobalScale;
        y = RealScreenHeight - 150 * GlobalScale;
        // }
        this.settings = new BasicButton(null, {
            'scene': this.engine,
            'key': 'SettingsBtn',
            'x': x,
            'y': y,
        }, ()=>{
            this.gui.openNewWindow(WindowType.WinSettings);
        }).setDepth(WinDefaultDepth);
        this.addButton(this.settings);
        this.settings.setVisible(false);
    }

    createGame(engine) {
        super.createGame(engine);

        this.engine = engine;

        const yPos = this.winInfo.togglesY * GlobalScale;
        let xPos = this.winInfo.togglesX * GlobalScale;
        const distance = this.winInfo.togglesDistance * GlobalScale;

        this.tabs = [];
        this.addTab('TabIcon_Actual', xPos, yPos);
        xPos += distance;
        this.addTab('PriceIcon', xPos, yPos);
        xPos += distance;
        this.addTab('PriceSeeds', xPos, yPos);
        xPos += distance;
        this.addTab('PriceGems', xPos, yPos);

        xPos = -this.winInfo.togglesX * GlobalScale;
        const inAppTab = this.addTab('TabIcon_Money', xPos, yPos);

        if (AllGetParams.game_env.startsWith("fish_vk_dev"))
            inAppTab.addSale(this.group, 'Sale_Banner');

        this.config = VisualData.STORE_SCROLL_CONFIG;
        this.config.x = this.centerX + this.config.offsetX * GlobalScale;
        this.config.y = this.centerY + this.config.offsetY * GlobalScale;

        this.slots = [];
        this.scroll = new GUIScroll(engine, this.config, this.getCell.bind(this), this.getItems.bind(this));
        this.scroll.setVisible(false);
        // this.group.add(this.scroll.table);

        SetGroupVisible(this.group, false);

        this.createSettingsButton();
    }

    getFirstUpgradeSlot(){
        return this.allCells[VisualData.getAutoClickSlot1Id()].unny_btn;
    }

    addTab(icon, x, y) {
        const tab = new ToogleButton(this.engine, this.group, icon, x, y, () => this.tabWasSwitched(tab), this.winInfo);
        this.tabs.push(tab);
        return tab;
    }

    _getOneItemFromList(list) {
        for (let i = 0; i < list.length; i++) {
            if (this.gameInit.progress.canPurchaseUpgrade(list[i]))
                return list[i];
        }

        for (let i = 0; i < list.length; i++) {
            if (!this.gameInit.progress.isUpgradePurchased(list[i].id))
                return list[i];
        }
        return null;
    }

    _upgradeSelectedTabItems() {
        this.slots = [];
        let list = null;
        switch (this.selectedTab) {
            case 0: {
                let item = null;
                item = this._getOneItemFromList(GameData.getMarketListGold());
                if (item)
                    this.slots.push(item);

                item = this._getOneItemFromList(GameData.getMarketListSeeds());
                if (item)
                    this.slots.push(item);

                item = this._getOneItemFromList(GameData.getMarketListGems());
                if (item)
                    this.slots.push(item);

                this.scroll.table.setItems(this.slots);
                return;
            }
            case 1: list = GameData.getMarketListGold();
                break;
            case 2: list = GameData.getMarketListSeeds();
                break;
            case 3: list = GameData.getMarketListGems();
                break;
            case 4: list = GameData.getInAppData();
                break;
        }

        // console.info(list);
        if (list) {
            for (let i = 0; i < list.length; i++) {
                if (this.gameInit.progress.canPurchaseUpgrade(list[i]) || WinStore.isUnlimitedPurchaseIndex(this.selectedTab)) {
                    this.slots.push(list[i]);

                    if (this.slots.length >= this.config.maxSlots)
                        break;
                }
            }

            this.scroll.table.setItems(this.slots);
        }
    }

    static isUnlimitedPurchaseIndex(index) {
        return index > 3;
    }

    tabWasSwitched(tab) {
        for (let i = 0;i < this.tabs.length;i++) {
            if (this.tabs[i] === tab) {
                this.tabs[i].setSelected(true);
                this.selectedTab = i;

                this._upgradeSelectedTabItems();
            } else {
                this.tabs[i].setSelected(false);
            }
        }

        this.scroll.table.setT(0);
    }

    tryToPurchaseUpgrade(id) {
        //TODO check resources
        switch (id) {
            case GEMS_VIDEO_REWARD_ID: {
                const progress = gameInit.progress;
                if (progress.getAdsWatchedToday() < AdsAvailableToWatchADay) {
                    PlayRewardedAd(() => {
                        gameAnalytics.sendEvent("Ads_For_Gems");
                        progress.adWasWatched();
                        const data = GameData.getMarketPurchaseById(id);
                        progress.gotGems(data.gems);
                        this._upgradeSelectedTabItems();
                    }, true);
                }
                return;
            }
        }

        if (this.gameInit.progress.tryToPurchaseUpgrade(id)) {
            if (!WinStore.isUnlimitedPurchaseIndex(this.selectedTab))
                this._upgradeSelectedTabItems();
        } else {
            this.closeWindow();
            guiManager.openNewWindow(WindowType.WinNotEnoughGems);
        }
    }

    _getStoreCellButtonCaption(item) {
        if (item.price)
            return LocalizationManager.getLocalizedNumber(gameInit.progress.getPurchasePrice(item));

        switch (item.id) {
            case GEMS_VIDEO_REWARD_ID: {
                return gameInit.progress.getAdsWatchedToday() + "/" + AdsAvailableToWatchADay;
            }
        }

        const price = socialManager.getPriceLabel(item.id);
        if (price)
            return price;

        return "Unknown";
    }

    getCell(cell) {
        const engine = this.engine;

        const item = cell.item;
        const group = engine.rexUI.add.container(0, 0);

        if (!item)
            return group;

        const config = this.config;
        const cellCenterX = config.cellWidth / 2 * GlobalScale;
        const cellCenterY= config.cellHeight / 2 * GlobalScale;

        const imageName = WinStore.getImageName(item);

        const isInApp = item.priceType === "IN_APP" && item.id !== GEMS_VIDEO_REWARD_ID;
        const isDoubled = isInApp && !VisualData.getGameSettings().dont_double;
        let priceIcon = GameData.getIconByType(item.priceType);
        if (!priceIcon && isInApp && VisualData.getGameSettings().display_hard_icon)
            priceIcon = 'InAppIcon';

        createStoreCell(engine, group, cellCenterX, cellCenterY,
            LocalizationManager.getStoreItemTitle(item),
            imageName,
            VisualData.getStoreFolder() + imageName + ".png",
            LocalizationManager.getStoreItemDescription(item),
            priceIcon,
            this._getStoreCellButtonCaption(item),
            () => this.tryToPurchaseUpgrade(item.id),
            true, this.scroll, item.id === GEMS_VIDEO_REWARD_ID && gameInit.progress.getAdsWatchedToday() >= AdsAvailableToWatchADay,
            isDoubled ? - 30 * GlobalScale : 0
        );

        if (isDoubled) {
            let x = group.unny_desc.x/localScale;
            let y = group.unny_desc.y/localScale;
            y += 60 * GlobalScale;
            group.unny_desc2 = engine.add.textOld(x, y, LocalizationManager.getLocalizization(item.description).format(item.originalGems / 2), DefaultFontVerySmall)
                .setOrigin(0.5, 0.5)
                .setDepth(WinDefaultDepth + 100);
            group.add(group.unny_desc2);
            group.unny_desc2.setWordWrapWidth(400 * GlobalScale);

            group.unny_line = engine.add.sprite(x, y, "DoubleInappCross").setDepth(WinDefaultDepth + 200);
            group.add(group.unny_line);

            x = cellCenterX - 160 * GlobalScale;
            y = cellCenterY - 170 * GlobalScale;
            switch (item.id) {
                case "hellprodgems200":
                    group.unny_like = engine.add.sprite(x, y, "InappLike").setDepth(WinDefaultDepth + 200);
                    group.add(group.unny_like);
                    break;
                case "hellprodgems500":
                    if (VisualData.getGameSettings().show_best) {
                        group.unny_like = engine.add.sprite(x, y, "InappLike1").setDepth(WinDefaultDepth + 200);
                        group.add(group.unny_like);

                        group.unny_best = engine.add.textOld(x, y, LocalizationManager.getLocalizization("Best"), DefaultFontSmallPuzzleBonus)
                            .setOrigin(0.5, 0.5)
                            .setDepth(WinDefaultDepth + 300);
                        group.add(group.unny_best);
                    }
                    break;
            }
        }

        group.item = item;
        this.allCells[item.id] = group;
        this._checkPriceForButton(group);
        if (group.priceText2) {
            this.timerText = group.priceText2;
            this.updateTimer();
        }
        return group.setOrigin(0).setDepth(WinDefaultDepth + 100);
    }

    _checkPriceForButton(group) {
        let locked;
        switch (group.item.id) {
            case GEMS_VIDEO_REWARD_ID: {
                locked = gameInit.progress.getAdsWatchedToday() >= AdsAvailableToWatchADay;
                break;
            }
            default:
                locked = group.item.priceType !== "Gems" && !gameInit.progress.isResourcesWithTypeEnoughForPurchase(group.item);
                break;
        }
        if (group.item.priceType !== "Gems")
            setStoreCellLocked(group, locked);
    }

    static getImageName(item) {
        if (item.icon)
            return item.icon;

        if (item.title) {
            return item.title.replace("Name","");
        }
        switch (item.upgradeType) {
            case "MultiProfit": {
                if (item.priceType === "Gems")
                    return "MultiProfitGems";
                return item.slotNumber >= 0 ? "MultiProfitOneSlot" : "MultiProfitAll";
            }
            case "TimeTravel": {
                switch (item.parameter) {
                    case 3600 * 4: return "TimeTravel4h";
                    case 3600 * 24: return "TimeTravel24h";
                    case 3600 * 24 * 7: return "TimeTravel7d";
                }
                break;
            }
            default:
                return item.upgradeType;
        }
        return null;
    }

    getItems() {
        return this.slots;
    }

    setGemsPage() {
        this.forceGems = true;
    }

    removeTimer() {
        if (this.timer) {
            clearInterval(this.timer);
            this.timer = null;
        }
    }

    updateTimer() {
        if (this.timerText && this.timerText.active) {
            this.timerText.setText(timeToStringClock(Progress.getTimeTillTheNextDay()));
        }
    }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);
        // GlobalInputLocked = visible;
        this.scroll.setVisible(visible);
        this.removeTimer();

        if (visible) {
            if (this.forceGems) {
                this.selectedTab = 4;
                this.forceGems = false;
            } else
                this.selectedTab = 0;
            this.tabWasSwitched(this.tabs[this.selectedTab]);

            if (gameInit.progress.canCheckStore()) {
                socialManager.checkPurchases((itemId) => {
                    gameInit.progress.publicConfirmedPayment(itemId);
                });
            }

            this.timer = setInterval(()=>{
                this.updateTimer();
            }, 1000);
        }

        this.settings.setVisible(visible);
        hudResources.setVisible(this.winInfo.showHud && visible);
    }
}

class WinFortuneWheel extends WinWithExit {
    constructor(gui, gameInit) {
        super(gui, gameInit);

        this.lightAnimation = 1;
        this.lightIndex = 0;
        this.lightTime = 0;
        this.timeToUpdate = 0;

        this.rotationSpeed = 800;
        this.accelDuration = 1;
        this.stopDuration = 3;
        this.sinK = 0.8;
        this.returnScale = 0.001;

        this.stopPath1 = (1 - this.sinK) * (this.sinK + 2 * (1 - this.sinK) / Math.PI) * this.stopDuration * this.rotationSpeed;
        this.stopPath2 = this.sinK * this.sinK * (1 - 2 / Math.PI) * this.stopDuration * this.rotationSpeed;
        this.stopPath = this.stopPath1 + this.stopPath2;
    }

    createGame(engine) {
        super.createGame(engine);
        this._createBlackBackground();

        this.exitButton.ignoreTutorial = true;
    }

    localize() {
        super.localize();

        if (this.header)
            this.header.setText(LocalizationManager.getLocalizization("FortuneWheelWindowTitle"));

        if (this.buttonLabel)
            this.buttonLabel.setText(LocalizationManager.getLocalizization("FortuneWheelWindowGemsButton").format(GEMS_PRICE_FOR_WHEEL_SPIN));

        if (this.buttonLabelFree)
            this.buttonLabelFree.setText(LocalizationManager.getLocalizization("FortuneWheelWindowAdButton"));

        this._updateSpinsTimer();
        this._updateSpinsCount();
    }

    _updateButtonLocalization() {
        if (!this.visible)
            return;

        const spins = gameInit.progress.getFreeSpinsCount() > 0;

        this.actionButtonFree.setVisible(spins);
        this.buttonLabelFree.setVisible(spins);
        this.actionButton.setVisible(!spins);
        this.buttonLabel.setVisible(!spins);
        this.buttonGems.setVisible(!spins);
    }

    _updateSpinsCount() {
        if (this.spinsCounter) {
            const spins = gameInit.progress.getFreeSpinsCount();
            this.spinsCounter.setText(LocalizationManager.getLocalizization("FortuneWheelWindowSpinCountText").format(spins, Progress.getMaxFreeSpins()));
            if (this.visible)
                this.spinsTimer.setVisible(spins < Progress.getMaxFreeSpins());

            this._updateButtonLocalization();
        }
    }

    _updateSpinsTimer() {
        if (this.spinsTimer) {
            const time = gameInit.progress.getNextSpinTime() / 1000;
            if (time <= 0) {
                if (gameInit.progress.checkForNewSpin())
                    this._updateSpinsCount();
            } else
                this.spinsTimer.setText(LocalizationManager.getLocalizization("FortuneWheelWindowCooldownText").format(timeToStringClock(time)));
        }
    }

    _startArrowAnimation() {
        if (this.arrowImage && !this.arrowAnimation) {
            this.arrowImage.setPositionY(this.arrosPos.y);
            this.arrowAnimation = animManager.moveSinInfinite(this.arrowImage, 1, 0, 50 * GlobalScale);
        }
    }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);

        if (visible) {
            if (!this.updateListener) {
                this.updateListener = this.updateWindow.bind(this);
                gameInit.update.addListener(this.updateListener);
            }

            this._startArrowAnimation();
        } else {
            if (this.updateListener) {
                gameInit.update.removeListener(this.updateListener);
                this.updateListener = null;
            }

            if (this.arrowAnimation) {
                this.arrowAnimation.stopAnimation();
                this.arrowAnimation = null;
            }
        }
        if (visible) {
            if (this.loaded) {
                //Refresh gold
                this._updateTexts(true);
            } else {
                this.loaded = true;
                const engine = this.engine;

                const x = this.winInfo.backX * GlobalScale;
                const y = this.winInfo.backY * GlobalScale;

                const btnY = y + this.winInfo.buttonY * GlobalScale;

                this.createActionButton(engine, this.spinWheel.bind(this), btnY, true, 1, 0, 800, 'AdCam');
                this.actionButtonFree = this.actionButton;
                this.buttonLabelFree = this.buttonLabel;

                this.createActionButton(engine, this.spinWheel.bind(this), btnY, true, 1, 0, 800);

                this.buttonGems = this.group.create(0, btnY, 'PriceGems').setOrigin(0, 0.5);

                const backImage = 'FortuneWheelBack';
                CreateImage(engine, x, y, backImage, (image) => {
                    this.group.add(image);
                    image.setDepth(WinDefaultDepth).setVisible(this.visible);
                    image.setScale(this.winInfo.wheel_scale);

                    //this.rotation = engine.rexUI.add.label();
                    this.rotation = engine.add.container(x + this.winInfo.rotationX * this.winInfo.wheel_scale * GlobalScale, y + this.winInfo.rotationY * this.winInfo.wheel_scale * GlobalScale).setDepth(WinDefaultDepth + 10);
                    this.rotation.setScale(this.winInfo.wheel_scale);
                    // this.rotation.x = x - 90;
                    // this.rotation.y = y - 110;
                    this.rotation.angle = this.winInfo.initRotation;
                    this.group.add(this.rotation);

                    const wheel = 'FortuneWheel';
                    LoadPreparedFile(engine, wheel, () => {
                        this.wheel = this.rotation.create(0, 0, wheel).setDepth(WinDefaultDepth + 100);
                        this.wheel.angle = 180;

                        const arrow = 'FortuneWheelArrow';
                        LoadPreparedFile(engine, arrow, () => {
                            this.arrosPos = {
                                x: x + this.winInfo.arrowX * GlobalScale,
                                y: y + this.winInfo.arrowY * GlobalScale
                            };
                            this.arrowImage = this.group.create(this.arrosPos.x, this.arrosPos.y, arrow).setDepth(WinDefaultDepth + 130);
                            this._startArrowAnimation();
                        });

                        this.header = engine.add.text(0, this.winInfo.headerY * GlobalScale - RealScreenHeight / 2, null, DefaultFontBig)
                            .setOrigin(0.5, 0.5)
                            .setDepth(WinDefaultDepth + 40);
                        this.group.add(this.header);

                        this.placePrizes();

                        this.createLights(x, y);

                        const devil = 'FortuneDevil';
                        LoadPreparedFile(engine, devil, () => {
                            this.group.create(x + this.winInfo.heroX * GlobalScale, y + this.winInfo.heroY * GlobalScale, devil).setDepth(WinDefaultDepth + 120);
                        });

                        this.spinsCounter = engine.add.text(0, btnY - this.getWinInfoValue("buttonHeaderDeltaY", 125), null, DefaultFont)
                            .setOrigin(0.5, 0.5)
                            .setDepth(WinDefaultDepth + 200);
                        this.group.add(this.spinsCounter);

                        this.spinsTimer = engine.add.text(0, btnY - this.getWinInfoValue("buttonHeaderDeltaY2", 200), null, DefaultFont)
                            .setOrigin(0.5, 0.5)
                            .setDepth(WinDefaultDepth + 200);
                        this.group.add(this.spinsTimer);

                        this.localize();
                    });
                });
            }

            this._updateButtonLocalization();
            const timer = setInterval(() => {
                let kill = !this.visible;
                if (this.buttonLabel.isVisible()) {
                    this.buttonGems.setPositionX((this.buttonLabel.x + this.buttonLabel.getInnerWidth()));
                    kill = true;
                }
                if (kill)
                    clearInterval(timer);
            }, 210);
        }
    }

    getTutorialButton() {
        return this.actionButtonFree;
    }

    createLights(backX, backY) {
        this.lights = [];
        const list = this.winInfo.lights;
        const backSize = this.winInfo.backSize;
        for (let i in list) {
            const p = list[i];
            const x = backX + (p.x - backSize.width / 2) * GlobalScale * this.winInfo.wheel_scale;
            const y = backY + (p.y - backSize.height / 2) * GlobalScale * this.winInfo.wheel_scale;
            const l = this.group.create(x, y, 'Effect_Glow').setDepth(WinDefaultDepth + 100).setScale(this.winInfo.lightScale || 2);
            l.alpha = this.winInfo.lightAlpha || 0.3;
            this.lights.push(l);
            l.setVisible(false);
        }
    }

    placePrizes() {
        const items = gameInit.progress.getFortuneData().getBonuses();
        const engine = this.engine;
        const depth = WinDefaultDepth + 100;
        this.allPrizesText = [];

        for (let i = 0; i < items.length; i++) {
            const type = items[i].getType();

            let label = null;
            let image = null;
            let imageAngle;
            let labelAngle;

            let radius = this.winInfo.radius * GlobalScale;
            let imgRadius = radius;

            const angle = 30 + 60 * i;
            let imgScale = 1;

            let x = 0;
            let y = 0;
            let wordWrap = 150;
            let originX = 0;

            switch (type) {
                case "Gold": {
                    image = "PriceIcon";
                    imageAngle = angle;

                    label = items[i].getText();
                    labelAngle = angle;
                    imgScale = 0.8;
                    imgRadius *= 0.7;
                    wordWrap = 400;
                    originX = 0.5;
                    break;
                }
                case "Gems": {
                    image = "PriceGems";
                    imageAngle = angle - 5;

                    label = items[i].getText();
                    labelAngle = imageAngle + 10;
                    break;
                }
                case "TimeTravel": {
                    image = "FortuneItemTimeTravel";
                    imageAngle = angle - 15;

                    label = LocalizationManager.getLocalizization("FortuneWheelWindowMinutes").format(items[i].getText());
                    labelAngle = imageAngle + 12;
                    imgScale = 0.9;
                    break;
                }
                case "Box": {
                    image = "GiftBox";
                    imageAngle = angle;

                    imgRadius -= 10;
                    imgScale = 0.8;
                    break;
                }
                case "JackPot": {
                    image = "PriceGems";
                    imageAngle = angle - 10;

                    label = items[i].getText();
                    labelAngle = imageAngle + 10;

                    radius -= 50 * GlobalScale;
                    imgRadius = radius;

                    if (this.winInfo.jackpotImage) {
                        const back = engine.add.sprite(x, y, "FortuneJackpot")
                            .setOrigin(0, 0)
                            .setDepth(depth);
                        this.rotation.add(back);
                    }
                    break;
                }
            }

            imageAngle *= Math.PI / 180;
            labelAngle *= Math.PI / 180;

            if (image) {
                const img = engine.add.sprite(x + imgRadius * Math.sin(imageAngle), y - imgRadius * Math.cos(imageAngle), image)
                    .setScale(imgScale * 0.85)
                    .setDepth(depth);
                img.angle = angle;
                this.rotation.add(img);
            }

            if (label) {
                const text = engine.add.textOld(x + radius * Math.sin(labelAngle), y - radius * Math.cos(labelAngle), label, DefaultFontWheel)
                    .setOrigin(originX, 0.5)
                    .setWordWrapWidth(wordWrap * GlobalScale)
                    .setDepth(depth);
                text.angle = angle;
                this.allPrizesText[i] = text;
                this.rotation.add(text)
            }
        }
    }

    _updateTexts(force) {
        const items = gameInit.progress.getFortuneData().getBonuses();
        for (let i = 0; i < items.length; i++) {
            if ((items[i].needToUpdate() || force) && this.allPrizesText[i]) {
                this.allPrizesText[i].setText(items[i].getText());
            }
        }
    }

    rotateWheel(deltaTime) {
        if (this.isRotating) {
            this.rotationTime += deltaTime;
            let vk = 1;

            if (!this.isStopping) {
                if (this.rotationTime < this.accelDuration) {
                    if (this.rotationTime <= this.accelDuration * this.sinK) {
                        let t = this.rotationTime / (this.accelDuration * this.sinK);
                        vk = (1 + Math.sin(-Math.PI / 2 * (1 - t))) * this.sinK;
                    }
                    else {
                        let t = (this.rotationTime - this.accelDuration * this.sinK) / (this.accelDuration * (1 - this.sinK));
                        vk = this.sinK + Math.sin(Math.PI / 2 * t) * (1 - this.sinK);
                    }
                }

                if (this.rotationLeft <= this.stopPath) {
                    this.isStopping = true;
                    this.rotationTime = 0;
                }
            }
            else {
                if (this.rotationTime <= this.stopDuration * (1 - this.sinK)) {
                    let t = this.rotationTime / (this.stopDuration * (1 - this.sinK));
                    vk = this.sinK + (1 - this.sinK) * Math.cos(t * Math.PI / 2);
                }
                else {
                    let t = (this.rotationTime - this.stopDuration * (1 - this.sinK)) / (this.stopDuration * this.sinK);

                    let sign = t > 1 ? -30 : 1;
                    vk = sign * this.sinK * (1 + Math.cos(Math.PI / 2 * (1 + t))) * (1 + t * this.returnScale);
                }
            }

            let delta = deltaTime * this.rotationSpeed * vk;
            if (this.rotationLeft - delta > 0 && vk < 0) {
                this.stopWheel();

                gameInit.progress.spendSpin();
                this._updateSpinsCount();
                this._updateSpinsTimer();

                this.reward.activateBonus();
                setTimeout(() => {
                    if (this.visible)
                        this._updateTexts();
                }, 1000);

                this.rotation.angle += this.rotationLeft;
                this.rotationLeft = 0;
                this.isRotating = false;
            } else {
                this.rotation.angle += delta;
                this.rotationLeft -= delta;
            }
        }
    }

    //     if (this.rotationLeft <= 0) {
    //         this.stopWheel();
    //
    //         gameInit.progress.spendSpin();
    //         this._updateSpinsCount();
    //         this._updateSpinsTimer();
    //
    //         this.reward.activateBonus();
    //         setTimeout(() => {
    //             if (this.visible)
    //                 this._updateTexts();
    //         }, 1000);
    //     } else {
    //
    //         if (this.rotationSpeed >= 50)
    //             this.rotationSpeed *= 0.996;
    //
    //         const speed = this.rotationSpeed;
    //
    //         const angle = speed * deltaTime;
    //         this.rotation.angle += angle;
    //         this.rotationLeft -= angle;
    //     }
    // }

    updateWindow(deltaTime) {
        if (this.listener) {
            this.rotateWheel(deltaTime);
        }

        if (this.timeToUpdate <= 0 && this.spinsTimer && this.spinsTimer.visible) {
            this.timeToUpdate = 1;
            this._updateSpinsTimer();
        } else
            this.timeToUpdate -= deltaTime;

        if (this.lights) {
            this.lightTime += deltaTime;
            switch (this.lightAnimation) {
                case 1: {
                    if (this.lightTime > 0.05) {
                        this.lightTime = 0;
                        this.lights[this.lightIndex].setVisible(false);
                        this.lightIndex = (this.lightIndex - 1);
                        if (this.lightIndex < 0)
                            this.lightIndex = this.lights.length - 1;
                        this.lights[this.lightIndex].setVisible(true);
                    }
                    break;
                }
                case 2: {
                    if (this.lightTime > 0.2) {
                        this.lightTime = 0;
                        this.lightIndex = (this.lightIndex + 1) % 2;
                        for (let i in this.lights)
                            this.lights[i].setVisible((i % 2) === this.lightIndex);
                    }
                    break;
                }
            }
        }
    }

    stopWheel() {
        this.listener = false;
        this.lightAnimation = 2;
        if (this.arrowAnimation) {
            this.arrowAnimation.stopAnimation();
            this.arrowAnimation = null;
        }

        animManager.moveToPointExtra(this.arrowImage, {x: this.arrosPos.x, y: this.arrosPos.y + 50}, 0.1, 0.2);

        unlockGUI();
    }

    spinWheel() {
        if (!this.listener) {

            const func = () => {
                eventManager.fortuneWheelUsed();
                gameAnalytics.sendEvent("Ad_Wheel");
                this._startArrowAnimation();
                this.lightAnimation = 1;

                const items = gameInit.progress.getFortuneData().getBonuses();

                let ind = Math.random() * 100;
                let index = 0;
                for (let i = 0; i < items.length; i++) {
                    const chance = items[i].getChance();
                    if (ind <= chance) {
                        index = i;
                        break;
                    } else
                        ind -= chance;
                }

                const finalAngle = (60 * (5 - index) + 360 * 8 + 30);// + 5 + Math.random() * 50 + 360);
                this.rotation.angle = this.rotation.angle % 360;

                this.reward = items[index];
                this.rotationLeft = finalAngle - this.rotation.angle;
                this.rotationTime = 0;
                this.isStopping = false;
                this.isRotating = true;
                // this.time = (finalAngle - this.rotation.angle) / this.rotationSpeed;
                this.listener = true;

                lockGuiEverything();
                this.exitButton.ignoreTutorial = false;
            };

            if (gameInit.progress.getFreeSpinsCount() <= 0) {
                if (!gameInit.progress.isGemsEnough(GEMS_PRICE_FOR_WHEEL_SPIN * RESOURCES_SCALE)) {
                    guiManager.openNewWindow(WindowType.WinNotEnoughGems);
                } else {
                    gameInit.progress.gemsSpent(GEMS_PRICE_FOR_WHEEL_SPIN * RESOURCES_SCALE);
                    func();
                }
            } else {
                this.exitButton.ignoreTutorial = false;
                PlayRewardedAd(func);
            }
        }
    }
}

class WinQuests extends WinWithBrownBack {
    constructor(gui, gameInit) {
        super(gui, gameInit);
    }

    createGame(engine) {
        super.createGame(engine);
        this.questGroups = [];
        this.prepareWindow(engine);

        eventManager.onActionQuestProgress.addListener(this._actionQuestProgress.bind(this));
    }

    _actionQuestProgress() {
        if (this.visible) {
            const qm = gameInit.questsManager;
            for (let i = 0; i < this.questGroups.length; i++)
                this._applyQuestInfo(this.questGroups[i], qm.getQuestInfo(i));
        }
    }

    _getYPosForQuest(index) {
        return this.centerY + (index - 1) * this.winInfo.distance * GlobalScale + this.winInfo.centerY * GlobalScale;
    }

    prepareWindow(engine) {
        this.header = engine.add.text(this.centerX, 70 * GlobalScale, null, DefaultFont)
            .setOrigin(0.5, 0)
            .setDepth(WinDefaultDepth + 1);

        this.group.add(this.header);

        this.timerText = engine.add.text(300 * GlobalScale, RealScreenHeight - 100 * GlobalScale, null, DefaultFont)
            .setOrigin(0, 0.5)
            .setDepth(WinDefaultDepth + 1);
        this.group.add(this.timerText);

        this.noQuestsText = engine.add.text(this.centerX, this.centerY + 500 * GlobalScale, null, DefaultFont)
            .setOrigin(0.5, 0.5)
            .setDepth(WinDefaultDepth + 1);
        this.group.add(this.noQuestsText);

        LoadPreparedFile(this.engine, this.winInfo.noMoreQuestsIcon, () => {
            this.noQuestsTextIcon = this.group.create(this.centerX, this.centerY - 100 * GlobalScale, this.winInfo.noMoreQuestsIcon).setDepth(WinDefaultDepth + 1);
            this.group.add(this.noQuestsTextIcon);
            this.noQuestsTextIcon.setVisible(this.group.visible && this.noQuestsTextIconVisible || false);
        });

        for (let i = 0; i < 3; i++) {
            const group = engine.add.container();
            const info = group;

            info.index = i;
            group.setPosition(this.centerX, this._getYPosForQuest(i));
            group.depth = WinDefaultDepth;

            group.create(0, 0, 'QuestBack').setDepth(WinDefaultDepth);
            // CreateImageInGroup(engine, group, 'QuestBack', (image) => {
            //     image.setDepth(WinDefaultDepth);//.visible = this.visible;
            // });

            info.button = new ButtonWithText(group, {
                'scene': engine,
                'key': this.winInfo.buttonName || 'DefaultButton',
                'x': this.getWinInfoValue('claim_x', 0),
                'y': this.getWinInfoValue('claim_y', 170),
                'minWidth' : this.winInfo.claim_minwidth ? this.winInfo.claim_minwidth * GlobalScale: null
            }, () => this._collectQuest(i))
                .setDepth(WinDefaultDepth + 1);

            info.refreshButton = new BasicButton(group, {
                'scene': engine,
                'key': 'Quests_RefreshBtn',
                'x': this.getWinInfoValue('refresh_x', -460),
                'y': this.getWinInfoValue('refresh_y', -170),
            }, () => this._replaceQuest(i))
                .setDepth(WinDefaultDepth + 1);

            info.loader = new Loader(group, 'Quests_ProgressBar', 'Quests_ProgressFill', this.getWinInfoValue('loader_x', -60), this.getWinInfoValue('loader_y', 50));

            if (!this.winInfo.join_desc_and_progress) {
                info.progress = engine.add.text(120 * GlobalScale, 50 * GlobalScale, null, DefaultFontSmall)
                    .setOrigin(0, 0.5)
                    .setDepth(WinDefaultDepth + 1);
                group.add(info.progress);
            }

            const rightPrizeX = 370;
            if (!this.winInfo.reward_one_line) {
                info.prizes = engine.add.text(rightPrizeX * GlobalScale, -70 * GlobalScale, null, DefaultFontSmall)
                    .setOrigin(0.5, 0.5)
                    .setDepth(WinDefaultDepth + 1);
                group.add(info.prizes);
            }

            CreateImageInGroup(engine, group, 'PriceGems', (image) => {
                info.gemsImage = image.setPosition(rightPrizeX * GlobalScale, 10 * GlobalScale);
                image.setDepth(WinDefaultDepth);
            });

            info.xLabel = engine.add.text(this.getWinInfoValue('x_x', rightPrizeX + 20), this.getWinInfoValue('x_y', 30), null, this.winInfo.reward_one_line ? DefaultFontSmallBlack : DefaultFontSmall)
                .setOrigin(0, 0.5)
                .setDepth(WinDefaultDepth + 1);
            group.add(info.xLabel);

            info.description = engine.add.text(this.getWinInfoValue('desc_x', 0), this.getWinInfoValue('desc_y', -60), null, DefaultFontSmallBlack)
                .setOrigin(this.winInfo.hasOwnProperty('desc_ox') ? this.winInfo.desc_ox : 0.5, 0.5)
                .setWordWrapWidth(this.getWinInfoValue('desc_width', 500))
                .setDepth(WinDefaultDepth + 1);
            group.add(info.description);

            this.questGroups.push(info);
            this.group.add(group);
        }

        if (TEST_MODE)
            this.createButton('MM_Btn_Worlds', 100, 100, () => this._testQuests());

        SetGroupVisible(this.group, false);
    }

    _testQuests() {
        gameInit.questsManager.activateRandomQuests(0);
        this.setWindowVisible(true);
    }

    localize() {
        super.localize();

        this.header.setText(LocalizationManager.getLocalizization("DailyQuestsTitle"));
        this.noQuestsText.setText(LocalizationManager.getLocalizization("DailyQuestsNoQuestsLabel"));

        this.prizesString = LocalizationManager.getLocalizization("DailyQuestsRewardLabel");
        for (let i in this.questGroups) {
            const group = this.questGroups[i];
            this._applyQuestButtonLocalization(group, gameInit.questsManager && gameInit.questsManager.getQuestInfo(i));
            if (group.prizes)
                group.prizes.setText(this.prizesString);
        }
    }

    _applyQuestButtonLocalization(group, quest) {
        group.button.caption.setText(quest && quest.hasAction() && !this._isQuestCompleted(group.index) ? LocalizationManager.getLocalizization("BanjoManTipStart") : LocalizationManager.getLocalizization("DailyQuestsCollectBtn"));
    }

    _applyQuestInfo(group, quest) {
        if (!quest.canDisplayQuest()) {
            group.setVisible(false);
            return false;
        }

        group.setVisible(true);

        const info = quest.info;

        const current = Math.min(quest.progress, quest.count);
        if (!this.winInfo.reward_one_line)
            group.xLabel.setText("x" + quest.getRewardForUI());
        else {
            group.xLabel.setText(this.prizesString + ": " + quest.getRewardForUI());

            setTimeout(() => {
                //group.gemsImage.setPosition(group.xLabel.x + group.xLabel.getInnerWidth(), group.xLabel.y);
                group.gemsImage.setPosition(group.xLabel.x/localScale + group.xLabel.getInnerWidth() + 20 * GlobalScale + group.gemsImage.width / 2 / localScale, group.xLabel.y/localScale);
            }, 210);
        }
        if (group.progress) {
            group.description.setText(LocalizationManager.getLocalizization(info.info).format(quest.count));
            group.progress.setText(current + '/' + quest.count);
        } else {
            group.description.setText(LocalizationManager.getLocalizization(info.info).format(quest.count) + " (" + current + '/' + quest.count + ")");
        }
        group.loader.setProgress(current / quest.count);

        this._applyQuestButtonLocalization(group, quest);

        const completed = this._isQuestCompleted(group.index);
        //group.button.setButtonLocked(!completed && !quest.hasAction());
        const vis = completed || quest.hasAction();
        group.button.setVisible(vis);
        group.button.caption.setVisible(vis);

        group.refreshButton.setVisible(quest.canReplaceQuest() && !completed);

        if (!this.winInfo.no_icon) {
            const icon = "Quest_" + info.type;
            const path = VisualData.getQuestIcons() + info.type + ".png";
            LoadFile(this.engine, icon, path, () => {
                if (this.visible) {
                    if (group.icon)
                        group.icon.destroy(true);
                    group.icon = this.engine.add.sprite((this.winInfo.iconCenterX || -370) * GlobalScale, 0, icon).setDepth(WinDefaultDepth + 1);
                    group.add(group.icon);
                    if (this.winInfo.iconsScale)
                        group.icon.setScale(this.winInfo.iconsScale);
                }
            });
        }
        return true;
    }

    _replaceQuest(index) {
        const qm = gameInit.questsManager;
        qm.replaceQuest(index);

        this._applyQuestInfo(this.questGroups[index], qm.getQuestInfo(index));
    }

    _isQuestCompleted(index) {
        const qm = gameInit.questsManager;
        const quest = qm.getQuestInfo(index);
        return quest.progress >= quest.count;
    }

    _collectQuest(index) {
        const qm = gameInit.questsManager;
        const quest = qm.getQuestInfo(index);
        if (quest.progress >= quest.count) {
            this.questGroups[index].setVisible(false);
            quest.claimReward();
            let dec = 1;
            for (let i = 0; i < index; i++)
                if (!this.questGroups[i].visible)
                    dec++;
            for (let i = index + 1; i < this.questGroups.length; i++) {
                if (this.questGroups[i].visible) {
                    const pos = {
                        x: this.centerX,
                        y: this._getYPosForQuest(i - dec)
                    };
                    animManager.moveToPointExtra(this.questGroups[i], pos, 0.1, 0.4);
                } else
                    dec++;
            }
        } else {
            if (quest.hasAction())
                quest.useAction();
        }
        this._checkForNoQuests();
    }

    _updateTimer() {
        this.timerText.setText(LocalizationManager.getLocalizization("DailyQuestsTimer").format(timeToStringClock(Progress.getTimeTillTheNextDay())));
    }

    _checkForNoQuests() {
        let visible = true;
        for (let i = 0; i < this.questGroups.length; i++) {
            if (this.questGroups[i].visible) {
                visible = false;
                break;
            }
        }

        this.noQuestsTextIconVisible = visible;
        if (this.noQuestsTextIcon)
            this.noQuestsTextIcon.setVisible(visible);
        this.noQuestsText.setVisible(visible);
    }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);

        if (visible) {
            const qm = gameInit.questsManager;
            let dec = 0;
            for (let i = 0; i < this.questGroups.length; i++) {
                if (!this._applyQuestInfo(this.questGroups[i], qm.getQuestInfo(i)))
                    dec++;

                this.questGroups[i].setPositionY(this._getYPosForQuest(i - dec));
            }
            if (!this.timer) {
                this.timer = setInterval(() => this._updateTimer(), 1000);
                this._updateTimer();
            }
            this._checkForNoQuests();
        } else {
            if (this.timer) {
                clearInterval(this.timer);
                this.timer = null;
            }
        }
    }
}

class WinHarvested extends WinBase {
    constructor(gui, gameInit){
        super(gui, gameInit);
        this.cansCount = 20;
    }

    createGame(engine) {
        super.createGame(engine);
        this._createBlackBackground();
    }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);
        if (visible) {
            if (!this.header) {
                const icon = 'collectCropSplash';
                LoadPreparedFile(this.engine, icon, () => {
                    this.destroyImage();
                    if (this.visible) {
                        this.group.create(0, this.getWinInfoValue('imageY', 0), icon).setDepth(WinDefaultDepth - 10);

                        if (!this.header) {
                            this.header = this.engine.add.text(0, this.getWinInfoValue('headerY', -600), null, this.winInfo.font ? PrestigeFontHeader : DefaultFontBig)
                                .setOrigin(0.5, 0.5)
                                .setWordWrapWidth(1200 * GlobalScale)
                                .setDepth(WinDefaultDepth);
                            this.group.add(this.header);

                            this.description = this.engine.add.text(0, this.getWinInfoValue('descY', 500), this.seeds ? this._getDescription() : null,  this.winInfo.font ? PrestigeFontDescription : DefaultFontBig)
                                .setOrigin(0.5, 0.5)
                                .setWordWrapWidth(1200 * GlobalScale)
                                .setDepth(WinDefaultDepth);
                            this.group.add(this.description);

                            this.createActionButton(this.engine, this.closeWindow.bind(this), RealScreenHeight / 2 - 150 * GlobalScale, true).setText(LocalizationManager.getLocalizization("ButtonOk"));
                            this.addButton(this.actionButton);
                        }

                        this.header.setText(LocalizationManager.getLocalizization("CollectCropSplash"));
                        this._playAnimation();
                    }
                });
            } else
                this._playAnimation();

        } else {
            this._sendCansToResoruces();
        }
    }

    _playAnimation() {
        this._hideUIForAnimation();
        this._startAnimation().then(() => {
            this.header.setVisible(true);
            animManager.applyWinOpenAnimation(this.header, ()=>{
                this.description.setVisible(true);
                animManager.applyWinOpenAnimation(this.description, ()=> {
                    this.actionButton.setVisible(true);
                    this.buttonLabel.setVisible(true);
                    animManager.applyButtonShowAnimation(this.actionButton);

                    if (VisualData.getGameSettings().photos) {
                        const count = gameInit.progress.getHarvestsCount();
                        const photos = GameData.getPrestigePhotos();
                        for (let v of photos) {
                            if (v.prestigeCount == count) {
                                setTimeout(() => {
                                    this._removeAllCans();
                                    const win = guiManager.openNewWindow(WindowType.WinPhotosPreview, true);
                                    win.setImage(v);
                                }, 100);
                                break;
                            }
                        }
                    }
                });
            })
        });
    }

    _hideUIForAnimation() {
        this.header.setVisible(false);
        this.description.setVisible(false);
        this.actionButton.setVisible(false);
        this.buttonLabel.setVisible(false);
    }

    timeout(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    _removeAllCans() {
        if (this.cans) {
            for (let i in this.cans)
                this.cans[i].destroy(true);
        }
        this.cans = null;
    }

    async _sendCansToResoruces() {
        if (this.cans) {
            for (let i in this.cans) {
                const icon = this.cans[i];
                animManager.moveToPoint(icon, cansResourceIcon, 0.5, ()=>{
                    icon.destroy(true);
                    animManager.changeShapeOfSouls(cansResourceIcon);
                });
                await this.timeout(100);
            }
        }
        this.cans = null;
    }

    async _startAnimation() {
        if (this.cans)
            this._sendCansToResoruces();

        this.cans = [];
        const radius = 400 * GlobalScale;
        for (let i = 0; i < this.cansCount;i++) {
            if (this.cans) {
                const angle = Math.PI * 2 * Math.random();
                const r = radius * (Math.random() * 0.7 + 0.3);
                const can = this.engine.add.sprite(this.centerX + r * Math.sin(angle), this.centerY + r * Math.cos(angle), "PriceSeeds")
                    .setDepth(WinDefaultDepth + 100);
                this.cans.push(can);

                await this.timeout(100);
            }
        }

        return Promise.resolve(true);
    }

    _getDescription() {
        return LocalizationManager.getLocalizization("CollectCropSplashText").format(LocalizationManager.getLocalizedNumber(this.seeds));
    }

    setApplesAcount(seeds) {
        this.seeds = seeds;
        if (this.description)
            this.description.text = this._getDescription();
    }
}

class WinSettings extends WinWithExit {
    constructor(gui, gameInit){
        super(gui, gameInit);
    }

    createGame(engine) {
        super.createGame(engine);
        this._createBlackBackground();
    }

    createGame(engine) {
        super.createGame(engine);
        this._createBlackBackground();
    }

    localize() {
        super.localize();

        if (this.header)
            this.header.setText(LocalizationManager.getLocalizization("ButtonChangeLanguage"));

        if (this.soundsText)
            this.soundsText.setText(LocalizationManager.getLocalizization("SettingsSound"));

        if (this.musicText)
            this.musicText.setText(LocalizationManager.getLocalizization("SettingsMusic"));
    }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);

        if (visible && !this.initialized) {
            this.initialized = true;

            const distanceX = 300 * GlobalScale;
            const distanceY = 250 * GlobalScale;
            const columns = this.winInfo.languages_columns;

            this.header = this.addText(0, - 100 * GlobalScale);

            const allLanguages = VisualData.getAllLanguages();
            let index = 0;
            for (let i in allLanguages) {
                const lang = allLanguages[i];
                const name = 'Language_' + lang;
                const x = (i % columns - (columns - 1) / 2) * distanceX;
                const y = 100 * GlobalScale + Math.trunc(i / columns) * distanceY;
                LoadPreparedFile(this.engine, name, () => {
                    this.createButton(name, x, y, ()=>{
                        SetCurrentLanguage(lang);
                    });
                });
                index++;
            }

            this.settingsButtons = {};

            const posX = 300 * GlobalScale;
            const posY = -550 * GlobalScale;
            const textDist = 200 * GlobalScale;

            this.soundsText = this.addText(-posX, posY + textDist);
            this.musicText = this.addText(posX, posY + textDist);

            this.loadAndCreateButton("Sounds_On", -posX, posY, ()=>{
                this.settingsButtons["Sounds_Off"].setVisible(true);
                this.settingsButtons["Sounds_On"].setVisible(false);
                SetSoundsState(false);
            }, ()=>{
                return !GameSettings.soundsOff;
            });

            this.loadAndCreateButton("Sounds_Off", -posX, posY, ()=>{
                this.settingsButtons["Sounds_On"].setVisible(true);
                this.settingsButtons["Sounds_Off"].setVisible(false);
                SetSoundsState(true);
            }, ()=>{
                return !!GameSettings.soundsOff;
            });

            this.loadAndCreateButton("Music_On", posX, posY, ()=>{
                this.settingsButtons["Music_Off"].setVisible(true);
                this.settingsButtons["Music_On"].setVisible(false);
                SetMusicState(false);
            }, ()=>{
                return !GameSettings.musicOff;
            });

            this.loadAndCreateButton("Music_Off", posX, posY, ()=>{
                this.settingsButtons["Music_On"].setVisible(true);
                this.settingsButtons["Music_Off"].setVisible(false);
                SetMusicState(true);
            }, ()=>{
                return !!GameSettings.musicOff;
            });

            this.localize();

            const version = this.engine.add.text(RealScreenWidth / 2 - 50, RealScreenHeight / 2 - 50, "v" + GAME_VERSION, DefaultFontSmall)
                .setOrigin(1, 0.5)
                .setDepth(WinDefaultDepth + 40);

            this.group.add(version);

            // if (TEST_MODE)
                this.createButton('MM_Btn_Worlds', RealScreenWidth / 2 - 100, 0, () => gameInit.progress.resetProgress());
        } else {
            this.setButtonVisible("Sounds_On", !GameSettings.soundsOff);
            this.setButtonVisible("Sounds_Off", !!GameSettings.soundsOff);
            this.setButtonVisible("Music_On", !GameSettings.musicOff);
            this.setButtonVisible("Music_Off", !!GameSettings.musicOff);
        }
    }

    addText(x, y) {
        const text = this.engine.add.text(x, y, null, DefaultFontBig)
            .setOrigin(0.5, 0.5)
            .setDepth(WinDefaultDepth + 40);

        this.group.add(text);
        return text;
    }

    loadAndCreateButton(name, x, y, action, isVisible) {
        LoadPreparedFile(this.engine, name, () => {
            const b = this.createButton(name, x, y, action);
            this.settingsButtons[name] = b;
            b.setVisible(isVisible());
        });
    }

    setButtonVisible(name, visible) {
        const btn = this.settingsButtons[name];
        if (btn)
            btn.setVisible(visible);
    }
}

class WinConstruct extends WinWithBack {
    constructor(gui, gameInit){
        super(gui, gameInit);
    }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);
    }

    localize() {
        super.localize();
        this.buttonLabel.setText(LocalizationManager.getLocalizization("BuySlotButtonText"));
    }

    createGame(engine) {
        super.createGame(engine);

        this.createActionButton(engine, this.constructBuilding.bind(this), null, false, null, null, 500);
        this.createHeader(engine);
    }

    constructBuilding() {
        this.building.upgradeBuilding();
        this.closeWindow();
    }

    setInfo(building) {
        const icon = building.getBigIcon();
        this.building = building;
        LoadFile(this.engine, icon, building.getBigIconPath(), () => {
            this.destroyImage();
            if (this.visible)
                this.image = this.group.create(0, -30 * GlobalScale, icon).setDepth(WinDefaultDepth + 1).setScale(this.building.getBigIconScale());
        });

        this.header.setText(LocalizationManager.getLocalizization(building.getLocalizationKey()));
    }
}

class WinUpgrade extends WinWithExit {
    closeWindow(){
        super.closeWindow();
        this.gui.changeMode(GUIMode.Normal);
    }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);
        hudResources.setVisible(visible);

        this._clearTimer();
        if (visible) {
            this.label.setVisible(guiManager.guiMode === GUIMode.Likes);
            this.resetTimer.setVisible(guiManager.guiMode === GUIMode.Likes);

            if (guiManager.guiMode === GUIMode.Likes) {
                this.timer = setInterval(() => {
                    this._updateTimer();
                }, 1000);

                this._updateTimer();
            }
        }
    }

    _updateTimer() {
        if (gameInit.progress.isLikesTimerActive()) {
            this.resetTimer.setVisible(true);
            this.resetTimer.setText(timeToStringClock(Math.trunc(gameInit.progress.getLikesTimeleft()/1000)));
        } else
            this.resetTimer.setVisible(false);
    }

    _clearTimer() {
        if (this.timer) {
            clearInterval(this.timer);
            this.timer = null;
        }
    }

    localize() {
        super.localize();
        this.label.setText(LocalizationManager.getLocalizization("LikesInfoText"));
    }

    createGame(engine) {
        super.createGame(engine);

        this.label = engine.add.text(0, RealScreenHeight / 2 - 200 * GlobalScale, null, DefaultFontBig)
            .setOrigin(0.5, 0.5)
            .setDepth(WinDefaultDepth);
        this.group.add(this.label);

        this.resetTimer = engine.add.text(0, RealScreenHeight / 2 - 100 * GlobalScale, null, DefaultFont)
            .setOrigin(0.5, 0.5)
            .setDepth(WinDefaultDepth);
        this.group.add(this.resetTimer);
    }
}

class WinLocationSelection extends WinWithBrownBack {
    constructor(gui, gameInit) {
        super(gui, gameInit);
        this.worlds = [];
        for (let i = 1; i <= VisualData.getWorldsCount(); i++)
            this.worlds.push(i);
    }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);

        if (visible) {
            if (!this.prepared) {
                this.prepared = true;
                this.config = VisualData.LOCATIONS_MENU_SCROLL_CONFIG;
                this.config.x = this.centerX + this.config.offsetX * GlobalScale;
                this.config.y = this.centerY + this.config.offsetY * GlobalScale;

                this.scroll = new GUIScroll(this.engine, this.config, this.getCell.bind(this), this.getItems.bind(this));
            }

            this.scroll.table.setItems(this.getItems());
        }

        this.scroll.setVisible(visible);
    }

    getItems() {
        return this.worlds;
    }

    getCell(cell) {
        const engine = this.engine;
        const config = this.config;
        const cellCenterX = config.cellWidth / 2 * GlobalScale;
        const cellCenterY = config.cellHeight / 2 * GlobalScale;
        const item = cell.item;

        let group = engine.rexUI.add.container(0, 0);
        group.unny_container = engine.add.container(cellCenterX, cellCenterY);
        group.add(group.unny_container);

        const fileName = "location" + item;
        const icon = "LocationWindow_" + fileName;
        const locationPath = VisualData.getLocationsFolder() + fileName + ".png";

        LoadFile(this.engine, icon, locationPath, () => {
            if (this.visible && group.active) {
                const canOpen = item === 1 || gameInit.progress.canOpenOtherWorld();
                const callback = (gameInit.selectedWorld != item) ? () => {
                    gameInit.switchWorld(item.toString());
                    this.closeWindow();
                } : null;

                group.unny_button = new BasicButton(group.unny_container, {
                    'scene': engine,
                    'key': canOpen ? 'LocationsBtnGreen' : 'LocationsBtnGrey',
                    'x': 0,
                    'y': 0,
                }, callback);

                const img = engine.add.sprite(-340 * GlobalScale, 0, icon);
                group.unny_container.add(img);

                const levelDesc = engine.add.textOld(-110 * GlobalScale, -80 * GlobalScale, "Location " + item, GirlsMenuHeaderFont).setOrigin(0);
                group.unny_container.add(levelDesc.setDepth(WinDefaultDepth + 200));

                const photoDesc = engine.add.textOld(-110 * GlobalScale, -20 * GlobalScale, LocalizationManager.getLocalizization("Locations_location_" + item), GirlsMenuDescFont).setOrigin(0).setWordWrapWidth(460 * GlobalScale);
                group.unny_container.add(photoDesc);
            }
        });

        return group.setOrigin(0).setDepth(WinDefaultDepth + 100);
    }
}

class WinBossProccess extends WinBase {
    constructor(gui, gameInit) {
        super(gui, gameInit);
        this.enableClickables = true;
        eventManager.onHarvestClicked.addListener(() => {
            this.waitingTime = 0;
            if (this.pointing) {
                this.pointing = false;
                tutorial._hideFinger();
            }
        });
    }

    localize() {
        super.localize();
        this.description.setText(LocalizationManager.getLocalizization("CollectCropTipText"));
    }

    createGame(engine) {
        super.createGame(engine);

        this.description = engine.add.text(0, -RealScreenHeight / 2 + 100 * GlobalScale, null, DefaultFont)
            .setOrigin(0.5, 0.5)
            .setDepth(WinDefaultDepth);
        this.description.visible = false;
        this.group.add(this.description);
    }

    _clearTimer() {
        if (this.timer) {
            clearInterval(this.timer);
            this.timer = null;
        }
    }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);

        this._clearTimer();
        if (visible) {
            this.waitingTime = 0;
            this.timer = setInterval(() => {
                if (this.pointing)
                    return;

                this.waitingTime += 1;
                if (this.waitingTime >= 3) {
                    const group = visualGame.getAllVisibleBuildings();
                    for (let k in group) {
                        const b = group[k];
                        if (!b.isHarvested()) {
                            this.pointing = true;
                            const pos = b.getPosition();
                            tutorial.pointAtPosition({
                                x: pos.x,
                                y: pos.y - 200 * GlobalScale
                            });
                            break;
                        }
                    }
                }
            }, 1000);
        }
    }
}

class WinWithPicture extends WinWithBack {
    constructor(gui, gameInit, info) {
        super(gui, gameInit);
        this.info = info;
    }

    applyWinInfo(key) {
        this.winInfo = Object.assign({}, VisualData.GUI_WinWithPicture, VisualData[key]);

        if (this.winInfo.nineSlice)
            this.nineSlice = this.winInfo.nineSlice;
    }

    localize() {
        super.localize();

        if (this.header)
            this.header.setText(LocalizationManager.getLocalizization(this.info.header));
        if (this.description)
            this.description.setText(this.info.getDescription ? this.info.getDescription() : LocalizationManager.getLocalizization(this.info.description));
        if (this.buttonLabel)
            this.buttonLabel.setText(this.info.dontLocalizeButton ? this.info.button : LocalizationManager.getLocalizization(this.info.button));
    }

    createExitButton() {
        if (!this.info.no_exit)
            super.createExitButton();
    }

    createButton() {
        if (this.info.button)
            this.createActionButton(this.engine, this.actionClicked.bind(this), this.info.buttonY || this.winInfo.buttonY, true, null, null, this.info.btn_min_width, this.info.icon, this.winInfo.btnImage);
    }

    createGame(engine) {
        super.createGame(engine);

        if (this.info.header)
            this.createHeader(engine);

        this.createButton();

        if ((this.info.description || this.info.getDescription) && !this.winInfo.no_description) {
            const func = this.info.oldText ? engine.add.textOld : engine.add.text;
            this.description = func(this.getWinInfoValue("descriptionX", 0), this.getWinInfoValue("descriptionY", -300), null, this.info.smallFont ? DefaultFontSmallBlack : DefaultFontBlack)
                .setWordWrapWidth((this.info.wordWrapWidth || 900) * GlobalScale)
                .setOrigin(0.5, this.getWinInfoValueNoScale("descriptionOY", 0.5))
                .setDepth(WinDefaultDepth);
            this.group.add(this.description);
        }
    }

    actionClicked() {
        this.closeWindow();
        if (this.info.action)
            this.info.action();
    }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);

        if (visible) {
            let x = (this.info.imageX || 0);
            let y = (this.info.imageY || 100);
            if (this.winInfo) {
                if (this.winInfo.imageX)
                    x += this.winInfo.imageX;
                if (this.winInfo.imageY)
                    y += this.winInfo.imageY;
            }
            this.loadImage(this.info.image, x * GlobalScale, y * GlobalScale);
        } else
            this.destroyImage();
    }
}

class WinOtherWorlds extends WinWithPicture {

}

class WinBossSummon extends WinWithPicture {

    _getHeaderFont() {
        return this.winInfo.headerFont ? BossSummonHeaderFont : super._getHeaderFont();
    }

    localize() {
        super.localize();
        if (this.mythButtonLabel)
            this.mythButtonLabel.setText(LocalizationManager.getLocalizization("Prestige_start_hard").format(50));
    }

    createButton() {
        if (this.winInfo.mystButtons) {
            this.mythButtonLabel = this.createActionButton(this.engine, this.actionClicked.bind(this), this.winInfo.buttonY2, true, 1, 0, this.info.btn_min_width, this.info.icon, this.winInfo.btnImage2, DefaultFontSmallBtns, -40 * GlobalScale);
            this.summonGemsIcon = this.group.create(0, this.winInfo.buttonY2, 'PriceGems').setOrigin(0, 0.5);
            SetIconToTheRightOfTheLabel(this.mythButtonLabel, this.summonGemsIcon, 20);
            this.mythButton = this.actionButton;
            this.mythButton.setButtonLocked(true);

            const y = this.getWinInfoValue('headerOffset', -600);
            const image = this.engine.add.sprite(-370 * GlobalScale, y, 'PrestigeStar')
                .setOrigin(0.5, 0.5)
                .setDepth(WinDefaultDepth + 20);
            this.group.add(image);
        }
        super.createButton();
    }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);

        if (visible) {
            const seeds = LocalizationManager.getLocalizedNumber(this.gameInit.progress.getSeedsForSoulsCount());
            if (this.description)
                this.description.setText(LocalizationManager.removeCodes(LocalizationManager.getLocalizization(this.info.description)
                    .format(seeds)));
        }
    }
}

class WinWithUnlockedExitButton extends WinWithPicture {

    createGame(engine) {
        super.createGame(engine);
        this.exitButton.ignoreTutorial = true;
    }
}

class WinGuard extends WinWithUnlockedExitButton {

    localizeButton3x() {
        if (gameInit.progress.getGuardMultiplier() > 2.5)
            this.buttonLabel.setText(LocalizationManager.getLocalizization('RainButtonFreePro'));
    }

    localize() {
        super.localize();
        this.localizeButton3x();
    }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);

        if (visible) {
            this.description.setText(LocalizationManager.getLocalizization(this.info.description)
                .format(GuardDurationHours));
            this.localizeButton3x();
        }
    }
}

class WinBanjoEnd extends WinWithPicture {

    setNumber(number) {
        this.number = number
    }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);

        if (visible) {
            this.description.setText(LocalizationManager.getLocalizization(this.info.description)
                .format(LocalizationManager.getLocalizedNumber(this.number)));
        }
    }
}

class WinBanjoPreEnd extends WinWithPicture {

    createGame(engine) {
        super.createGame(engine);

        this.description2 = engine.add.text(this.info.descriptionX * GlobalScale, this.info.descriptionY * GlobalScale, null, DefaultFontVeryBig)
            .setOrigin(0.5, 0.5)
            .setDepth(WinDefaultDepth);
        this.group.add(this.description2);
    }

    imageWasLoaded() {
        super.imageWasLoaded();

        if (!this.amplitudeImage) {
            this.amplitudeImage = animManager.scaleSinInfinite(this.image, 0.6, 0.9, 0.1);
        }
    }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);

        if (visible) {
            const max = gameInit.progress.getSupervisorResourcesCollected();
            const steps = 40;
            const step = max.divide(steps);
            let curStep = 1;
            let current = step;

            let amplitudeDesc = animManager.scaleSinInfinite(this.description2, 0.6, 0.8, 0.2);

            let timer = setInterval(() => {
                curStep++;
                if (curStep === steps) {
                    this.description2.setText(LocalizationManager.getLocalizedNumber(max));
                    clearInterval(timer);

                    amplitudeDesc.stopAnimation();
                    if (this.amplitudeImage) {
                        this.amplitudeImage.stopAnimation();
                        this.amplitudeImage = null;
                    }

                    setTimeout(() => {
                        guiManager.getWindowByType(WindowType.WinBanjoEnd).setNumber(gameInit.progress.getSupervisorResourcesCollected());
                        guiManager.openNewWindow(WindowType.WinBanjoEnd, true);
                    }, 2000);
                } else {
                    current = current.add(step);
                    this.description2.setText(LocalizationManager.getLocalizedNumber(current));
                }
            }, 100);
        }
    }
}

class WinTimeTravel extends WinWithPicture {

    setTravelTime(minutes, image) {
        this.minutes = minutes;
        this.info.image = image;
    }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);

        if (visible) {
            this.description.setText(LocalizationManager.getLocalizization(this.info.description)
                .format(this.minutes));
        }
    }
}

class WinInAppBought extends WinWithPicture {
    setInAppData(data) {
        this.description.setText(LocalizationManager.getLocalizization(this.info.description) + "\n" + data.originalGems);
    }
}

class WinAppleDescription extends WinWithPicture {

    localize() {
        super.localize();

        if (this.winInfo.hardcoded_myth) {
            this.header.setText(LocalizationManager.getLocalizization("Prestige_info_title"));
            this.prestigeDescription.setText(LocalizationManager.getLocalizization("Prestige_info_text"));
            this.totalBonus.setText(LocalizationManager.getLocalizization("Prestige_info_text_2").format(this.gameInit.progress.getBonusPerSeed()));
        } else {
            this.profitBonus.setText(LocalizationManager.getLocalizization("SeedInfoProfitBonus"));
            this.totalBonus.setText(LocalizationManager.getLocalizization("SeedInfoTotalProfit"));
            this.label1.setText(LocalizationManager.getLocalizization("SeedInfoBiggerFarm") + " " + LocalizationManager.getLocalizization("SeedInfoGetSeeds"));
            // this.label2.text = LocalizationManager.getLocalizization("SeedInfoGetSeeds");
        }
    }

    _getHeaderFont() {
        return this.winInfo.headerFont ? BossSummonHeaderFont : super._getHeaderFont();
    }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);

        if (visible) {
            if (this.winInfo.hardcoded_myth) {
                this.totalBonus.setText(LocalizationManager.getLocalizization("Prestige_info_text_2").format(this.gameInit.progress.getBonusPerSeed()));
            } else {
                this.profitNumber.setText(this.gameInit.progress.getBonusPerSeed() + '%');
                this.totalNumber.setText(LocalizationManager.getLocalizedNumber(this.gameInit.progress.getTotalSeedsBonus().minus(1).multiply(100 * RESOURCES_SCALE)) + '%');
            }
        }
    }

    createGame(engine) {
        super.createGame(engine);

        const info = this.winInfo;

        if (info.hardcoded_myth) {
            this.info.image = null;
            const startY = -200 * GlobalScale;
            const centerX = 0;
            const width = 900 * GlobalScale;

            let y = startY;
            this.prestigeDescription = engine.add.text(centerX, y, null, DefaultFontSmallBlack)
                .setOrigin(0.5, 0.5)
                .setWordWrapWidth(width)
                .setDepth(WinDefaultDepth);
            this.group.add(this.prestigeDescription);

            y += 150 * GlobalScale;

            this.totalBonus = engine.add.text(centerX, y, null, DefaultFontSmallBlack)
                .setOrigin(0.5, 0.5)
                .setWordWrapWidth(width)
                .setDepth(WinDefaultDepth);
            this.group.add(this.totalBonus);

            y += 350 * GlobalScale;
            const imageView = this.engine.add.sprite(centerX, y, 'CollectCrop')
                .setOrigin(0.5, 0.5)
                .setDepth(WinDefaultDepth + 10);
            this.group.add(imageView);

            y = this.getWinInfoValue('headerOffset', -600);
            const image = this.engine.add.sprite(-370 * GlobalScale, y, 'PrestigeStar')
                .setOrigin(0.5, 0.5)
                .setDepth(WinDefaultDepth + 20);
            this.group.add(image);

        } else {
            const distanceX = (info ? info.distanceX : 430) * GlobalScale;
            const startY = (info ? info.startY : -300) * GlobalScale;
            const centerX = (info ? info.centerX : 0) * GlobalScale;
            const distanceY = (info ? info.distanceY : 75) * GlobalScale;

            let y = startY;
            this.profitBonus = engine.add.text(centerX - distanceX, y, null, DefaultFontBlack)
                .setOrigin(0, 0.5)
                .setDepth(WinDefaultDepth);
            this.group.add(this.profitBonus);

            this.profitNumber = engine.add.text(centerX + distanceX, y, null, DefaultFontBlack)
                .setOrigin(1, 0.5)
                .setDepth(WinDefaultDepth);
            this.group.add(this.profitNumber);

            y += distanceY;
            this.totalBonus = engine.add.text(centerX - distanceX, y, null, DefaultFontBlack)
                .setOrigin(0, 0.5)
                .setDepth(WinDefaultDepth);
            this.group.add(this.totalBonus);

            this.totalNumber = engine.add.text(centerX + distanceX, y, null, DefaultFontBlack)
                .setOrigin(1, 0.5)
                .setDepth(WinDefaultDepth);
            this.group.add(this.totalNumber);

            y += 1 * distanceY;
            this.label1 = engine.add.text(centerX, y, null, DefaultFontSmallBlack)
                .setOrigin(0.5, 0)
                .setWordWrapWidth(900 * GlobalScale)
                .setDepth(WinDefaultDepth);
            this.group.add(this.label1);

            // y += distanceY;
            // this.label2 = engine.add.text(centerX, y, null, DefaultFontBlack)
            //     .setOrigin(0.5, 0.5)
            //     .setDepth(WinDefaultDepth);
            // this.group.add(this.label2);
        }
    }
}

const GEMS_PRICE_FOR_ADS = 5;

class WinGemsInsteadOfAds extends WinWithPicture {

    setCallback(callback) {
        this.info.action = () => {
            if (!gameInit.progress.isGemsEnough(GEMS_PRICE_FOR_ADS * RESOURCES_SCALE)) {
                guiManager.openNewWindow(WindowType.WinNotEnoughGems);
            } else {
                gameInit.progress.gemsSpent(GEMS_PRICE_FOR_ADS * RESOURCES_SCALE);
                callback();
            }
        };
    }
}


class WinWelcomeBack extends WinWithUnlockedExitButton {

    setOfflineCollect(resources) {
        this.offlineResources = resources;
        this.description.setText(LocalizationManager.getLocalizization(this.info.description)
            .format(LocalizationManager.getLocalizedNumber(resources)));
    }
}

class WinQuestBubble extends WinBase {

    setData(text, image, callback) {
        this.finalText = text;
        this.lettersCount = 0;
        this.text.setText("");
        const name = "Tutorial_" + image;
        const path = "Tutorial/" + image + ".png";
        LoadFile(this.engine, name, path, () => {
            if (this.visible) {
                this.destroyImage();
                this.image = this.engine.add.sprite(this.mainX + 320 * GlobalScale, RealScreenHeight / 2 - 80 * GlobalScale, name)
                    .setOrigin(0.5, 1)
                    .setDepth(WinDefaultDepth + 10);
                this.group.add(this.image);
            }
        });

        this.callback = callback;
        this.showTime = Progress.getTimeNow();

        this.clearTimer();

        this.timer = setInterval(()=>{
            this.lettersCount++;
            if (this.lettersCount >= this.finalText.length)
                this.clearTimer();
            this.text.setText(this.finalText.substring(0, this.lettersCount));
        }, 20);
    }

    clearTimer() {
        if (this.timer) {
            clearInterval(this.timer);
            this.timer = null;
        }
    }

    createGame(engine) {
        super.createGame(engine);

        const y = RealScreenHeight / 2 - 200 * GlobalScale;
        const textW = 700 * GlobalScale;
        const textH = 160 * GlobalScale;
        const tOffset = -100 * GlobalScale;

        const clicked = () => {
            if (Progress.getTimeNow() - this.showTime >= 1000) {
                this.closeWindow();
                if (this.callback)
                    this.callback();
            }
        };

        const depth = WinDefaultDepth + 200;
        {
            const size = 32 * GlobalScale;
            new BasicButton(this.group, {
                'scene': engine,
                'key': 'BlackPixel',
                'x': this.centerX - size * 10,
                'y': this.centerY,
                dont_scale: true,
                scale: Math.max(RealScreenWidth, RealScreenHeight) / size + 20
            }, clicked);

            this.group.setDepth(depth);
        }

        const x = this.mainX = 300 * GlobalScale;

        const back = engine.add.sprite(x, y, 'QuestBack').setDepth(depth + 10);
        this.group.add(back);

        new BasicButton(this.group, {
            'scene': engine,
            'key': 'Daily_Check',
            'x': x + 510 * GlobalScale,
            'y': y + 110 * GlobalScale,
            scale: 1.2
        }, clicked).setDepth(depth + 11);

        this.text = engine.add.text(x + tOffset - textW / 2, y - textH / 2, null, QuestFont).setOrigin(0, 0).setWordWrapWidth(textW).setDepth(depth + 20);
        this.group.add(this.text);
    }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);

        if (visible) {
            audioManager.playWindowOpen();
            eventManager.bubbleAppeared();
        }
        else
            this.clearTimer();
    }
}

class MyResources {
    constructor(gui, gameInit) {
        this.gui = gui;

        gameInit.create.addListener(this.createGame.bind(this));
        gameInit.loaded.addListener(this.gameWasLoaded.bind(this));
        gameInit.onResourcesUpdated.addListener(this.resourcesUpdate.bind(this));
    }
}

class WinZoomIn extends WinWithExit {

    constructor(gui, gameInit) {
        super(gui, gameInit);
        this.callback = this.onBuildingClicked.bind(this);
        this.enableClickables = true;
    }

    onBuildingClicked(building) {
        if (building.getLevel() > 0 && !this.zoomed) {
            this.zoomed = true;

            const all = visualGame.getAllVisibleBuildings();
            const b = all[building.id];
            const pos = b.getPosition();

            const camera = this.engine.cameras.main;
            camera.pan((pos.x + VisualData.MAP_PARAMS.center.x) * localScale, (pos.y + VisualData.MAP_PARAMS.center.y) * localScale, 300, 'Linear');
            camera.zoomTo(2.6, 300, 'Linear');

            setTimeout(() => {
                window.onclick = () => {
                    window.onclick = null;

                    const camera = this.engine.cameras.main;
                    camera.pan(VisualData.MAP_PARAMS.center.x * localScale, VisualData.MAP_PARAMS.center.y * localScale, 300, 'Linear');
                    camera.zoomTo(1, 300, 'Linear');
                    this.zoomed = false;
                };
            }, 1000);
        }
    }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);

        if (visible)
            clickController.onBuildingClicked.addListener(this.callback);
        else
            clickController.onBuildingClicked.removeListener(this.callback);
    }
}

class WinMain extends WinBase {
    constructor(gui, gameInit) {
        super(gui, gameInit);

        this.enableClickables = true;
        this.hudResources = new HUDResources(gameInit);
        gameInit.onWorldChanged.addListener(this.worldChanged.bind(this));
    }

    setAllButtonsVisible(visible) {
        super.setAllButtonsVisible(visible);
        if (visible)
            this.worldChanged(gameInit.selectedWorld);
    }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);
        hudResources.setVisible(visible);
        this.worldChanged(gameInit.selectedWorld);
        this.updateBossState();
    }

    worldChanged(worldIndex) {
        if (!this.worldbtn2_Inverse)
            return;

        if (!gameInit.progress.isWorldChangeAvailable()) {
            this.worldbtn_Inverse.setForceInvisible(true);
            this.worldbtn.setForceInvisible(true);
            this.worldbtn2_Inverse.setForceInvisible(true);
            this.worldbtn2.setForceInvisible(true);
            return;
        }

        switch (parseInt(worldIndex)) {
            case 1:
                this.worldbtn_Inverse.setForceInvisible(true);
                this.worldbtn.setForceInvisible(false);

                this.worldbtn2_Inverse.setForceInvisible(true);
                this.worldbtn2.setForceInvisible(false);
                break;
            case 3:
                this.worldbtn_Inverse.setForceInvisible(false);
                this.worldbtn.setForceInvisible(true);

                this.worldbtn2_Inverse.setForceInvisible(true);
                this.worldbtn2.setForceInvisible(false);
                break;
            case 2:
                this.worldbtn_Inverse.setForceInvisible(true);
                this.worldbtn.setForceInvisible(false);

                this.worldbtn2_Inverse.setForceInvisible(false);
                this.worldbtn2.setForceInvisible(true);
                break;
        }
    }

    playOpenAnimation() {

    }

    createButtonsVertical() {
        const width = RealScreenWidth;
        const centerX = this.centerX;
        const centerY = this.centerY;
        let posY = centerY + RealScreenHeight / 2 - 150 * GlobalScale;
        const delta = width / 4;

        this.createButton('MM_Btn_Login', centerX - delta * 1.5, posY, () => UnnyNet.UnnyNet.openUnnyNet());
        this.upgradeButton = this.createButton('MM_Btn_Upgrade', centerX - delta * 0.5, posY, () => this.gui.changeMode(GUIMode.UpgradeBuildings));
        // this.createButton('MM_Btn_Likes', centerX + delta * 0.5, posY, () => this.gui.openNewWindow(WindowType.WinDropPuzzle));
        this.createButton('MM_Btn_Worlds', centerX + delta * 1.5, posY, () => {
            gameInit.switchToTheNextWorld();
        });

        posY = centerY - RealScreenHeight / 2 + 150 * GlobalScale;
        let posX = centerX + RealScreenWidth / 2 - 150 * GlobalScale;

        this.storeButton = this.createButton('MM_Btn_Store', posX, posY, () => this.gui.openNewWindow(WindowType.WinStore));

        posX -= 250 * GlobalScale;
        this.puzzlesButton = this.createButton('MM_Btn_Chests', posX, posY, () => this.gui.openNewWindow(WindowType.WinPuzzle));

        posX = RealScreenWidth - 100 * GlobalScale;
        posY = RealScreenHeight - 800 * GlobalScale;
        this.fortuneButton = this.createButton('FortuneHUDButton', posX, posY, () => this.gui.openNewWindow(WindowType.WinFortuneWheel));

        posY += 180 * GlobalScale;
        this.questsButton = this.createButton('QuestsHUDButton', posX, posY, () => this.gui.openNewWindow(WindowType.WinQuests));

        posY += 180 * GlobalScale;
        this.dailyBonus = this.createButton('Daily_HUDButton', posX, posY, () => this.gui.openNewWindow(WindowType.WinDaily));

        if (TEST_MODE)
            this.createButton('MM_Btn_Worlds', posX, posY + 250 * GlobalScale, () => gameInit.progress.cheatResources());
        this.allButtons.pop();
    }

    createButtonsMyth() {
        const gameSettings = VisualData.getGameSettings();

        const distance = 180 * GlobalScale;
        const distance2 = 120 * GlobalScale;
        const padding = 100 * GlobalScale;
        const paddingX = 120 * GlobalScale;
        const padding2 = 80 * GlobalScale;

        const bottomButtons = RealScreenHeight - padding;

        const centerX = this.centerX;

        if (gameSettings.photos) {
            this.girlsMenu = this.createButton('MM_Btn_GirlMenu', centerX, bottomButtons - 24 * GlobalScale, () => {
                guiManager.openNewWindow(WindowType.WinPhotosMainMenu);
                // guiManager.openNewWindow(WindowType.WinPhotosList);
            });
        }

        if (gameSettings.likes && gameSettings.likes.hasOwnProperty(AllGetParams.game_platform) && gameSettings.likes[AllGetParams.game_platform]) {
            this.createButton('MM_Btn_Likes', padding, RealScreenHeight - padding - distance * 2, () => this.gui.changeMode(GUIMode.Likes));
        }

        this.upgradeButton = this.createButton('MM_Btn_Upgrade', centerX - distance * 2, bottomButtons, () => this.gui.changeMode(GUIMode.UpgradeBuildings));
        this.storeButton = this.createButton('MM_Btn_Store', centerX - distance, bottomButtons, () => this.gui.openNewWindow(WindowType.WinStore));
        this.puzzlesButton = this.createButton('MM_Btn_Chests', centerX + distance, bottomButtons, () => this.gui.openNewWindow(WindowType.WinPuzzle));
        this.photoAlbum = this.createButton('MM_Btn_PhotoAlbum', centerX + distance * 2, bottomButtons, () => this.gui.openNewWindow(WindowType.WinPhotosList));

        this.createButton('MM_Btn_Worlds', RealScreenWidth - paddingX, padding, () => this.gui.openNewWindow(WindowType.WinLocationSelection));
        this.superVisorButton = this.createButton('MM_Btn_ManagerDoubling', RealScreenWidth - paddingX * 3, padding, () => this.gui.openNewWindow(WindowType.WinManagerDoubling));

        this.factoryButton = this.createButton('MM_Btn_Prestige', centerX, padding, () => this.gui.openNewWindow(WindowType.WinBossSummon));

        let y = padding + distance;
        this.questsButton = this.createButton('QuestsHUDButton', RealScreenWidth - padding2, y, () => this.gui.openNewWindow(WindowType.WinQuests));
        y += distance2;
        this.dailyBonus = this.createButton('Daily_HUDButton', RealScreenWidth - padding2, y, () => this.gui.openNewWindow(WindowType.WinDaily));

        y += distance2;
        this.zoom = this.createButton('MM_Btn_Zoom', RealScreenWidth - padding2, y, () => this.gui.openNewWindow(WindowType.WinZoomIn));

        // this.fortuneButton = this.createButton('FortuneHUDButton', RealScreenWidth - padding2, y, () => this.gui.openNewWindow(WindowType.WinFortuneWheel));

        // this._createOffersIfPossible();

        if (TEST_MODE)
            this.createButton('MM_Btn_Worlds', RealScreenWidth - padding, RealScreenHeight - padding, () => gameInit.progress.cheatResources());
        this.allButtons.pop();
    }

    createSizeButtons() {
        let x = 100;
        let y = 400;
        const distance = 60;

        this.speed = 1;

        function printInfo() {
            const obj = focused_object;
            console.log("X: " + (obj.x / localScale - RealScreenWidth / 2) + " ;Y: " + (obj.y / localScale - RealScreenHeight / 2) + " ;SX: " + (obj.scaleX / localScale) + " ;SY: " + (obj.scaleY / localScale))
        }

        this.createButton('QuestsHUDButton', x, y, () => {
            const obj = focused_object;
            obj.setPosition(obj.x / localScale - this.speed, obj.y / localScale);
            printInfo();
        });

        this.createButton('QuestsHUDButton', x + distance, y - distance / 2, () => {
            const obj = focused_object;
            obj.setPosition(obj.x / localScale, obj.y / localScale - this.speed);
            printInfo();
        });

        this.createButton('QuestsHUDButton', x + distance, y + distance / 2, () => {
            const obj = focused_object;
            obj.setPosition(obj.x / localScale, obj.y / localScale + this.speed);
            printInfo();
        });

        this.createButton('QuestsHUDButton', x + 2 * distance, y, () => {
            const obj = focused_object;
            obj.setPosition(obj.x / localScale + this.speed, obj.y / localScale);
            printInfo();
        });

        y += distance * 2;
        x += distance;

        this.createButton('QuestsHUDButton', x - distance / 2, y, () => {
            const obj = focused_object;
            obj.setScale(obj.scaleX / localScale - 0.01, obj.scaleY / localScale - 0.01);
            printInfo();
        });

        this.createButton('QuestsHUDButton', x + distance / 2, y, () => {
            const obj = focused_object;
            obj.setScale(obj.scaleX / localScale + 0.01, obj.scaleY / localScale + 0.01);
            printInfo();
        });


        this.createButton('QuestsHUDButton', x, y + 2 * distance, () => {
            this.speed = this.speed === 1 ? 10 : 1;
            console.warn("set speed " + this.speed);
        });
    }

    createButtonsHorizontal() {
        const gameSettings = VisualData.getGameSettings();

        const distance = 250 * GlobalScale;
        const padding = 170 * GlobalScale;
        const padding2 = padding + 30 * GlobalScale;

        const centerX = this.centerX;

        if (VisualData.ALL_OBJECTS.MM_Btn_Bread && !gameSettings.no_supervisor)
            this.superVisorButton = this.createButton('MM_Btn_Bread', 4.5 * padding, padding, () => this.gui.openNewWindow(WindowType.WinSupervisor));

        // this.createButton('MM_Btn_Login', padding, RealScreenHeight - padding, () => this.gui.openNewWindow(WindowType.WinBossSummon));
        if (!gameSettings.no_wheel)
            this.fortuneButton = this.createButton('FortuneHUDButton', padding, RealScreenHeight - padding, () => this.gui.openNewWindow(WindowType.WinFortuneWheel));
        this.dailyBonus = this.createButton('Daily_HUDButton', padding, RealScreenHeight - padding - distance, () => this.gui.openNewWindow(WindowType.WinDaily));
        this.upgradeButton = this.createButton('MM_Btn_Upgrade', RealScreenWidth - padding2, RealScreenHeight - padding, () => this.gui.changeMode(GUIMode.UpgradeBuildings));
        this.questsButton = this.createButton('QuestsHUDButton', RealScreenWidth - padding2, RealScreenHeight - padding - distance, () => this.gui.openNewWindow(WindowType.WinQuests));
        if (gameSettings.photos) {
            this.createButton('MM_Btn_GirlMenu', RealScreenWidth - padding2, RealScreenHeight - padding - distance * 2, () => {
                guiManager.openNewWindow(WindowType.WinPhotosMainMenu);
            });
        }

        if (gameSettings.likes && gameSettings.likes.hasOwnProperty(AllGetParams.game_platform) && gameSettings.likes[AllGetParams.game_platform]) {
            this.createButton('MM_Btn_Likes', padding, RealScreenHeight - padding - distance * 2, () => this.gui.changeMode(GUIMode.Likes));
        }

        if (!gameSettings.locations_window) {
            this.worldbtn2 = this.createButton('MM_Btn_Worlds2', RealScreenWidth - padding2, RealScreenHeight - padding - distance * 2, () => {
                gameInit.switchWorld("2");
            });
            this.worldbtn2_Inverse = this.createButton('MM_Btn_Worlds2_Inverse', RealScreenWidth - padding2, RealScreenHeight - padding - distance * 2, () => {
                gameInit.switchWorld("1");
            });
            this.worldbtn2_Inverse.setForceInvisible(true);
        }

        const paddigSmall = padding / 1.5;

        this.storeButton = this.createButton('MM_Btn_Store', centerX - distance, paddigSmall, () => this.gui.openNewWindow(WindowType.WinStore));
        this.puzzlesButton = this.createButton('MM_Btn_Chests', centerX, paddigSmall, () => this.gui.openNewWindow(WindowType.WinPuzzle));
        if (!gameSettings.locations_window) {
            this.worldbtn = this.createButton('MM_Btn_Worlds', centerX + distance, paddigSmall, () => {
                gameInit.switchWorld("3");
            });
            this.worldbtn_Inverse = this.createButton('MM_Btn_Worlds_Inverse', centerX + distance, paddigSmall, () => {
                gameInit.switchWorld("1");
            });
            this.worldbtn_Inverse.setForceInvisible(true);
        }

        this.createButton('QuestsHUDButton', centerX + distance * 2, paddigSmall, () => UnnyNet.UnnyNet.openUnnyNet(), 0.8);

        this._createOffersIfPossible();

        if (TEST_MODE)
            this.createButton('MM_Btn_Worlds', RealScreenWidth - padding, padding, () => gameInit.progress.cheatResources());
        this.allButtons.pop();
    }

    _createOffersIfPossible() {
        if (this._canShowOffer1() && !this.offerButton1) {
            const padding = 200 * GlobalScale;
            this.offerButton1 = this.createButton('OfferButton1', 0, 0, () => this.gui.openNewWindow(WindowType.WinSpecialOffer1));

            this.offerButton1Interval = setInterval(() => {
                this.offerButton1.setPosition(RealScreenWidth - padding, 800 * GlobalScale);
                if (this.lastAnimation)
                    this.lastAnimation.stopAnimation();
                this.lastAnimation = animManager.shakeBox(this.offerButton1, 7, 20 * GlobalScale, 0.6, 2);
            }, 2000);
        }
    }

    _canShowOffer1() {
        if (VisualData.getGameSettings().no_offers)
            return false;
        return gameInit.progress.getHarvestsCount() > 0 && gameInit.progress.canPurchaseUpgradeById('hellprod.offer1');
    }

    _checkPurchases() {
        if (this.offerButton1 && !this._canShowOffer1()) {
            this.offerButton1.destroy();
            clearInterval(this.offerButton1Interval);
            this.offerButton1 = null;
            this.offerButton1Interval = null;
        }
    }

    playBreadAnimation() {
        this.hideAllButtonsForTime(BanjoDuration);
        lockGuiEverything();
        animManager.playFallingBread(this.engine, this.group, BanjoDuration, () => {
            unlockGUI();
            this.gui.openNewWindow(WindowType.WinBanjoPreEnd);
        });
    }

    createGroup() {
        this.createGroupNotCenter();
    }

    createMainMenu() {
        // this.createSizeButtons();

        if (VisualData.getGameName) {
            switch (VisualData.getGameName()) {
                case 'MYTH':
                    this.createButtonsMyth();
                    return;
            }
        }

        if (VisualData.IsVertical())
            this.createButtonsVertical();
        else
            this.createButtonsHorizontal();

        gameInit.onBuildingUpgraded.addListener(this.buildingUpgraded.bind(this));
        gameInit.reseted.addListener(this.reseted.bind(this));
    }

    updateBossState() {
        if (this.factoryButton)
            this.factoryButton.setVisible(this.visible && gameInit.progress.canShowBoss(gameInit.selectedWorld));
    }

    reseted() {
        this.updateBossState();
    }

    buildingUpgraded(world, building) {
        if (building.getLevel() === 1) {
            this.updateBossState();
        }
    }

    createGame(engine) {
        super.createGame(engine);
        this.createMainMenu();
        this.hudResources.createGame(engine);

        eventManager.onUpgradePurchased.addListener(this._checkPurchases.bind(this));
        eventManager.onHarvestCompleted.addListener(this._createOffersIfPossible.bind(this));

        const progress = gameInit.progress;
        this.allNotifications = [];
        this._createNotificationForButton(
            engine,
            this.storeButton,
            function (func) {
                progress.onResourcesChanges.addListener(func);
            },
            function () {
                const list = GameData.getMarketListGold();
                for (let i = 0; i < list.length; i++) {
                    if (progress.canPurchaseUpgrade(list[i])) {
                        const price = progress.getPurchasePrice(list[i]);
                        return progress.isResourcesEnough(price)
                    }
                }
                return false;
            },
            function () {
                return "!";
            }
        );

        this._createNotificationForButton(
            engine,
            this.puzzlesButton,
            function (func) {
                eventManager.onBoxPurchased.addListener(func);
                eventManager.onBoxReceived.addListener(func);
                eventManager.onBoxOpened.addListener(func);
                eventManager.onGuardBoxOpened.addListener(func);
            },
            function () {
                return progress.getChestsCount() > 0;
            },
            function () {
                return progress.getChestsCount().toString();
            }
        );

        this._createNotificationForButton(
            engine,
            this.dailyBonus,
            function (func) {
                eventManager.onDailyBonusCollected.addListener(func);
            },
            function () {
                return progress.isDailyBonusAvailable();
            },
            function () {
                return "!";
            }
        );

        this._createNotificationForButton(
            engine,
            this.questsButton,
            function (func) {
                eventManager.onQuestCompleted.addListener(func);
                eventManager.onQuestClaimed.addListener(func);
            },
            function () {
                return gameInit.questsManager && gameInit.questsManager.isAnyCompleteQuest();
            },
            function () {
                return "!";
            }
        );
    }

    _createNotificationForButton(engine, btn, subscribe, isVisible, getText) {
        this.allNotifications.push(new GUINotification({
                scene: engine,
                parent: btn,
                group: this.group,
                x: (btn.x - btn.width * 0.4) / localScale,
                y: (btn.y + btn.height * 0.4) / localScale,
                subscribe: subscribe,
                isVisible: isVisible,
                getText: getText
            })
        );
    }

    showUpgradeButton() {
        this.showButtonFromTutorial(this.upgradeButton);
    }

    showStoreButton() {
        this.showButtonFromTutorial(this.storeButton);
    }

    showSuperVisorButton() {
        if (this.superVisorButton)
            this.showButtonFromTutorial(this.superVisorButton);
        else
            visualGame.showSuperVisor()
    }

    showGirlsMenuButton() {
        this.showButtonFromTutorial(this.girlsMenu);
    }

    showPhotoAlbum() {
        this.showButtonFromTutorial(this.photoAlbum);
    }

    getUpgradeButton() {
        return this.upgradeButton;
    }

    getStoreButton() {
        return this.storeButton;
    }

    getSuperVisorButton() {
        return this.superVisorButton;
    }

    getPuzzlesButton() {
        return this.puzzlesButton;
    }

    getFortuneWheelButton() {
        return this.fortuneButton;
    }

    getBossButton() {
        return this.factoryButton;
    }

    showBossButton() {
        this.showButtonFromTutorial(this.factoryButton);
    }

    _updateAllNotifications() {
        for (let i in this.allNotifications)
            this.allNotifications[i].update();
    }

    hideAllButtonsForTutorial() {
        super.hideAllButtonsForTutorial();
        this._updateAllNotifications();
    }

    showAllButtonsFromTutorial() {
        super.showAllButtonsFromTutorial();
        this._updateAllNotifications();
        this.worldChanged(gameInit.selectedWorld);
    }

    showButtonFromTutorial(btn) {
        super.showButtonFromTutorial(btn);
        this._updateAllNotifications();
    }

    setAllButtonsVisible(visible) {
        super.setAllButtonsVisible(visible);
        this._updateAllNotifications();
    }

    hideAllButtonsForTime(duration) {
        super.hideAllButtonsForTime(duration);
        this._updateAllNotifications();
    }

    _showAllButtonsBack() {
        super._showAllButtonsBack();
        this._updateAllNotifications();
    }

    getGirlsMenuButton() {
        return this.girlsMenu;
    }
}

let buildingsGUI = null;

class BuildingsGUI extends WinBase{
    constructor(gui, gameInit) {
        super(gui, gameInit);
        gui.onBuildingCreated.addListener(this.buildingCreated.bind(this));
        gui.onModeChanged.addListener(this.modeChanged.bind(this));

        this.worldsData = {};

        gui.onBuildingResourcesUpdated.addListener(this.resourcesUpdate.bind(this));
        gui.onBuildingUpdated.addListener(this.productionUpdate.bind(this));
        gui.onBuildingLiked.addListener(this.buildingLiked.bind(this));
        gui.onBuildingUpgraded.addListener(this.buildingUpgrade.bind(this));
        gui.onReset.addListener(this.resetAll.bind(this));
        gameInit.onWorldChanged.addListener(this.worldChanged.bind(this));

        this.enableClickables = true;
        clickController.onBuildingClicked.addListener(this.buildingWasClicked.bind(this));
        gameInit.loaded.addListener(this._progressLoaded.bind(this));

        eventManager.onBuildingUpgraded.addListener(this._updateAvailabilityForUpdrages.bind(this));
        eventManager.onPhotoTokensEarnedFromBuilding.addListener(this._tokensWereEarned.bind(this));

        buildingsGUI = this;
    }

    _progressLoaded(progress) {
        progress.onPuzzleCompleted.addListener(this.puzzleCompleted.bind(this));
        progress.onPuzzlePeaceReceived.addListener(this.puzzlePeaceReceived.bind(this));
    }

    setWorldVisible(worldId, visible) {
        const worldsData = this.worldsData[worldId];

        const prod = worldsData.production;
        const purc = worldsData.purchase;

        for (let key in prod) {
            if (purc.hasOwnProperty(key)) {
                SetGroupVisible(purc[key].group, visible);
            } else
                SetGroupVisible(prod[key].group, visible);
        }

        worldsData.visible = visible;
    }

    worldChanged(worldId) {
        for (let id in this.worldsData) {
            if (this.worldsData[id].visible) {
                if (id !== worldId) {
                    this.setWorldVisible(id, false);
                }
            } else {
                if (id === worldId)
                    this.setWorldVisible(id, true);
            }
        }
    }

    _sendFlyingResources(worldsData, buildingId, destination, resName, dontPlaySound) {
        const production = worldsData.production;
        if (production.hasOwnProperty(buildingId)) {
            resName = resName || 'PriceIcon';
            const groupInfo = production[buildingId];

            let x,y;
            if (groupInfo.icon) {
                x = groupInfo.icon.x;
                y = groupInfo.icon.y;
            } else {
                x = groupInfo.resources.x;
                y = groupInfo.resources.y;
            }

            const icon = this.engine.add.sprite(x / localScale, y / localScale, resName).setScale(VisualData.ANIMATIONS.flyingResourcesScale).setDepth(OverlayDepth);
            const p = {
                x: destination.x / localScale,
                y: destination.y / localScale
            };
            animManager.moveToPointSin(icon, p, VisualData.ANIMATIONS.flyingResources, () => {
                icon.destroy(true);
                animManager.changeShapeOfSouls(destination);
            });

            if (!dontPlaySound)
                audioManager.playBuildingClick();
        }
    }

    _setUpgradeShieledAvailable(upgradeInfo, available) {
        if (upgradeInfo.available !== available) {
            upgradeInfo.available = available;

            const set = VisualData.getGameSettings();
            if (set.shields && set.shields.shield_locked) {
                upgradeInfo.table.setTexture(available ? 'TableUpgrade' : set.shields.shield_locked);
            } else {
                const color = available ? NormalTint : LockTint;

                upgradeInfo.table.tint = color;
                upgradeInfo.level.tint = color;
                upgradeInfo.price.tint = color;
                if (upgradeInfo.priceIcon)
                    upgradeInfo.priceIcon.tint = color;
                if (upgradeInfo.loadedIcon)
                    upgradeInfo.loadedIcon.tint = color;
                upgradeInfo.loader.setTint(color);
            }
        }
    }

    _updateAvailabilityForUpdrages() {
        if (guiManager.guiMode === GUIMode.UpgradeBuildings) {
            for (let w in this.worldsData) {
                const worldsData = this.worldsData[w];
                if (!worldsData.visible)
                    continue;

                const upgradeInfo = worldsData.upgrade;
                const wIndex = parseInt(w);
                for (let b in upgradeInfo) {
                    const building = gameInit.getBuildingById(wIndex, b);
                    this._setUpgradeShieledAvailable(upgradeInfo[b], gameInit.progress.isResourcesEnough(building.getUpgradePrice()));
                }
            }
        }
    }

    hideSomeLabelsForTutorial() {
        const worldId = 1;
        const buildingId = 1;

        const worldsData = this.worldsData[worldId];
        const upgradeInfo = worldsData.upgrade[buildingId];
        upgradeInfo.upgrade_reward.setVisible(false);
    }

    _tokensWereEarned(building, tokenType) {
        if (building.getLevel() === 0)
            return;

        for (let w in this.worldsData) {
            const worldsData = this.worldsData[w];
            if (!worldsData.visible)
                continue;

            this._sendFlyingResources(worldsData, building.id, photoTokensCommon[tokenType], GameData.getIconByType(tokenType));
        }
    }

    buildingWasClicked(building) {
        if (building.getLevel() === 0)
            return;

        for (let w in this.worldsData) {
            const worldsData = this.worldsData[w];
            if (!worldsData.visible)
                continue;

            switch (guiManager.guiMode) {
                case GUIMode.UpgradeBuildings:
                    const upgradeInfo = worldsData.upgrade;
                    if (upgradeInfo.hasOwnProperty(building.id)) {
                        const upgrade = upgradeInfo[building.id];

                        if (!upgrade.available)// not enough resources
                            continue;

                        const set = VisualData.getGameSettings();
                        if (set.shields && !set.shields.drop_icon)
                            continue;

                        const smallIcon = building.getDropIcon();
                        LoadFile(this.engine, smallIcon, building.getDropIconPath(), () => {
                            const rnd = (Math.random() - 0.5);
                            const x = upgrade.x + rnd * 160 * GlobalScale;
                            const vx = -rnd * 50 * GlobalScale;
                            const sprite = this.engine.add.sprite(x, upgrade.y - 75 * GlobalScale, smallIcon).setDepth(upgrade.depth - 100);
                            const scale = VisualData.getGameSettings().drop_image_scale;
                            if (scale)
                                sprite.setScale(scale);
                            animManager.randomJumpRotation(sprite, {vx: vx,
                                vy: -200 * GlobalScale,
                                g: 70 * GlobalScale,
                                angle: (Math.random() - 0.5) * 60
                            }, 0.4, ()=> {
                                sprite.destroy(true);
                            });
                        });

                        animManager.jumpShieldAnimation(upgrade.group, {height: 40 * GlobalScale, scale: 0.1}, 0.3);
                    }
                    break;
                case GUIMode.Likes:
                    gameInit.openLikesForBuilding(building);
                    break;
                case GUIMode.Normal:
                    this._sendFlyingResources(worldsData, building.id, mainResourceIcon);
                    break;
                case GUIMode.Boss:
                    const boss = visualGame.getBoss();
                    this._sendFlyingResources(worldsData, building.id, boss ? boss.getObject() : mainResourceIcon);
                    break;
            }
            break;
        }
    }

    showNormal(show, showUpgrade, showLikes, worldID) {
        if (showUpgrade)
            this._updateAvailabilityForUpdrages();

        const worldsData = this.worldsData[worldID];
        const prod = worldsData.production;
        const upgr = worldsData.upgrade;
        const likesGroup = worldsData.likes;
        const purc = worldsData.purchase;

        const set = VisualData.getGameSettings();

        for (let key in prod) {
            if (purc.hasOwnProperty(key)) {
                SetGroupVisible(purc[key].group, show);
            } else
                SetGroupVisible(prod[key].group, show);

            const upgrade = upgr[key];
            if (upgrade) {
                SetGroupVisible(upgrade.group, showUpgrade);

                if (!set.dont_show_shield_icon && showUpgrade && !upgrade.iconLoading) {
                    upgrade.iconLoading = true;
                    const smallIcon = upgrade.building.getSmallIcon();
                    LoadFile(this.engine, smallIcon, upgrade.building.getSmallIconPath(), () => {
                        upgrade.loadedIcon = upgrade.group.create(- 90 * GlobalScale, - 135 * GlobalScale, smallIcon).setDepth(upgrade.depth + 1).setScale(0.6);
                        setLockedColor(upgrade.loadedIcon, !upgrade.available);
                    });
                }
            }

            const likes = likesGroup[key];
            if (likes) {
                SetGroupVisible(likes.group, showLikes);

                if (showLikes && !likes.iconLoading) {
                    likes.iconLoading = true;
                    const smallIcon = likes.building.getSmallIcon();
                    LoadFile(this.engine, smallIcon, likes.building.getSmallIconPath(), () => {
                        likes.loadedIcon = likes.group.create(- 90 * GlobalScale, - 135 * GlobalScale, smallIcon).setDepth(likes.depth + 1).setScale(0.6);
                        setLockedColor(likes.loadedIcon, !likes.available);
                    });
                }
            }
        }
    }

    modeChanged(newMode, worldID) {
        this.showNormal(newMode === GUIMode.Normal, newMode === GUIMode.UpgradeBuildings, newMode === GUIMode.Likes, worldID);
    }

    resetAll() {
        for (let k in this.worldsData) {
            const worldData = this.worldsData[k];
            const upgradeGroup = worldData.upgrade;
            for (let up in upgradeGroup) {
                const info = upgradeGroup[up];
                this.createPurchaseLabel(info.building, worldData, true);
                info.group.destroy(true);
            }

            const likesGroup = worldData.likes;
            for (let up in likesGroup) {
                likesGroup[up].group.destroy(true);
            }

            const productionGroup = worldData.production;
            for (let up in productionGroup) {
                const prod = worldData.production[up];
                prod.isFast = false;
                prod.loader.setFast(false);
                prod.resources.setText("0");
                SetGroupVisible(prod.group, false);
            }
            worldData.upgrade = {};
            worldData.likes = {};
        }
    }

    buildingCreated(world, building, engine) {
        let worldData;
        if (!this.worldsData.hasOwnProperty(world.id)) {
            worldData = this.worldsData[world.id] = {
                production: {},
                upgrade: {},
                purchase: {},
                likes: {},
                visible: world.isSelected()
            }
        } else
            worldData = this.worldsData[world.id];

        const productionGroup = worldData.production;
        // const purchaseGroup = worldData.purchase;

        const bInfo = VisualData.PLACED_BUILDINGS[building.slot];
        const depth = bInfo.depth + 100;
        const pos = bInfo.position;

        let x = pos.x + this.centerX;
        let y = pos.y + this.centerY;

        const bLevel = building.getLevel();
        const set = VisualData.getGameSettings();
        //production
        const visProdGroup = engine.add.group();
        const progX = x + (pos.lx || 0) * GlobalScale;
        const progY = y + (pos.ly || 60) * GlobalScale;
        const resources = bLevel === 0 ? ''  : this.getBuildingProducedResources(building);
        let text = engine.add.text(progX + (set.productionText ? set.productionText.x * GlobalScale : 0), progY + (set.productionText ? set.productionText.y : 10) * GlobalScale, resources, set.productionText ? DefaultFontProduction : DefaultFontSmall).setOrigin(set.productionText ? set.productionText.ox : 0.5, set.productionText ? set.productionText.oy : 0);
        const loader = new Loader(visProdGroup, 'Production_Progress_Bar_Back', 'Production_Progress_Bar', progX, progY, 1, true, VisualData.getGameSettings().circular_progress);

        const groupInfo = {
            resources: text,
            loader: loader,
            group: visProdGroup,
        };

        productionGroup[building.id] = groupInfo;
        visProdGroup.add(text);
        if (!set.dont_show_production_icon) {
            groupInfo.icon = visProdGroup.create(progX - 55 * GlobalScale, progY - 30 * GlobalScale, 'PriceIcon').setScale(0.6);
            animManager.jumpFishAnimation(groupInfo.icon, {
                height: 40 * GlobalScale,
                scale: 0.2,
            }, 0.6);
        }

        if (bLevel === 0 || !worldData.visible)
            SetGroupVisible(visProdGroup, false);
        visProdGroup.setDepth(depth);

        if (!set.dont_show_production_icon)
            groupInfo.icon.setDepth(depth + 5);
        //production...

        //upgrade && likes
        if (bLevel > 0) {
            this.createUpgradeGroup(world, building);
            this.createLikesGroup(world, building);
        }
        //upgrade...

        //purchase
        if (bLevel === 0)
            this.createPurchaseLabel(building, worldData);
        //upgrade...
    }

    puzzlePeaceReceived(info) {
        if (info.level === 0) {
            const worldId = Math.trunc((info.id - 1) / 9 + 1);
            const worldData = this.worldsData[worldId];
            const buildingId = info.id - (worldId - 1) * 9;
            const purchaseData = worldData.purchase[buildingId];

            if (purchaseData && purchaseData.needPuzzle) {
                purchaseData.price.setText(gameInit.progress.getPuzzlesCountForId(info.id - 1) + "/4");
            }
        }
    }

    puzzleCompleted(info) {
        if (info.level > 0) {
            const worldId = Math.trunc((info.id - 1) / 9 + 1);
            const worldData = this.worldsData[worldId];
            const buildingId = info.id - (worldId - 1) * 9;
            const purchaseData = worldData.purchase[buildingId];

            if (purchaseData) {
                if (purchaseData.needPuzzle) {
                    purchaseData.group.destroy(true);
                    const building = gameInit.getBuildingById(worldId, buildingId);
                    this.createPurchaseLabel(building, worldData);
                }
            }
        }
    }

    getPurchaseButton(world_id, slot_id) {
        const purchase = this.worldsData[world_id].purchase;
        return purchase.hasOwnProperty(slot_id) ? purchase[slot_id].button : null;
    }

    createPurchaseLabel(building, worldData, invisible) {
        const engine = this.engine;
        const bInfo = VisualData.PLACED_BUILDINGS[building.slot];
        const center = VisualData.VISUAL_BUILDINGS[bInfo.levels[0].building].objects[0];
        const depth = bInfo.depth + 100;
        const pos = bInfo.position;

        const purchaseGroup = worldData.purchase;

        let x = pos.x + this.centerX + (center.x || 0);
        let y = pos.y + this.centerY + (center.y || 0);

        const puzzleId = building.slot - 1;
        const puzzleInfo = gameInit.progress.getPuzzleInfoById(puzzleId);
        const needPuzzle = puzzleInfo.level < 1;

        const visPurchaseGroup = engine.add.group();
        const useButtons = VisualData.getGameSettings().slot_purchase_as_buttons;
        let purchaseIcon;
        let purchaseLabel;
        let button;
        let font = DefaultFontSmall;
        let iconPos;
        let pricePos;
        if (!needPuzzle)
        {
            const bGUI = VisualData.GUI_BuildingsGUI;
            let originX = 0.5;

            if (useButtons) {
                iconPos = useButtons.icon_pos;
                pricePos = useButtons.price_pos;
                button = new BasicButton(visPurchaseGroup, {
                    'scene': engine,
                    'key': useButtons.available,
                    'x': x,
                    'y': y
                }, () => clickController.buildingWasClicked(building));
                originX = 0;
                font = DefaultFontPurchaseSlot;
            } else {
                iconPos = {x: 0, y: -36 * GlobalScale};
                pricePos = {x: 0, y: 30 * GlobalScale};
            }

            purchaseIcon = engine.add.sprite(x + iconPos.x, y + iconPos.y, "PriceIcon").setScale(bGUI.purchaseIconScale);
            purchaseLabel = engine.add.text(x + pricePos.x, y + pricePos.y, this.getBuildingUpgradePrice(building), font)
                .setOrigin(originX, 0.5);
        }
        else {
            if (useButtons) {
                iconPos = useButtons.icon_pos_puzzle;
                pricePos = useButtons.price_pos_puzzle;
                button = new BasicButton(visPurchaseGroup, {
                    'scene': engine,
                    'key': useButtons.puzzle,
                    'x': x,
                    'y': y
                }, () => clickController.buildingWasClicked(building));
                font = DefaultFontPurchaseSlot;
                button.setButtonLocked(true);
            } else {
                iconPos = {x: -17 * GlobalScale, y: 10 * GlobalScale};
                pricePos = {x: 0, y: 10 * GlobalScale};
            }
            purchaseIcon = engine.add.sprite(x + iconPos.x, y + iconPos.y, "LockPuzzle").setOrigin(1, 0.5);
            purchaseLabel = engine.add.text(x + pricePos.x, y + pricePos.y, gameInit.progress.getPuzzlesCountForId(puzzleId) + "/4", font).setOrigin(0, 0.5);

            if (!useButtons) {
                const lockSprite = engine.add.sprite(x, y - 80 * GlobalScale, "LockIcon");
                visPurchaseGroup.add(lockSprite);
            }
        }

        const purchaseInfo = {
            price: purchaseLabel,
            icon: purchaseIcon,
            group: visPurchaseGroup,
            needPuzzle: needPuzzle,
            button: button
        };

        purchaseGroup[building.id] = purchaseInfo;
        visPurchaseGroup.add(purchaseIcon);
        visPurchaseGroup.add(purchaseLabel);
        visPurchaseGroup.setDepth(depth);
        if (!worldData.visible || invisible)
            SetGroupVisible(visPurchaseGroup, false);

        building.onUnlockChanged.addListener(this.changeBuildingAvailability.bind(this));
        this.changeBuildingAvailability(building);
    }

    changeBuildingAvailability(building) {
        const worldId = Math.trunc((building.slot - 1) / 9 + 1);
        const worldsData = this.worldsData[worldId];
        const purchase = worldsData.purchase;
        if (purchase.hasOwnProperty(building.id)) {
            const purchaseInfo = purchase[building.id];
            if (purchaseInfo.needPuzzle)
                return;

            const settings = VisualData.getGameSettings();
            if (building.unlocked) {
                if (!settings.no_availability_jump) {
                    if (!purchaseInfo.jumpAnimation)
                        purchaseInfo.jumpAnimation = animManager.fallFishAnimation(purchaseInfo.icon, {
                            height: 60 * GlobalScale,
                            scale: 0.2,
                        }, 0.6);
                }

                if (settings.slot_purchase_as_buttons) {
                    if (purchaseInfo.button) {
                        purchaseInfo.button.setTexture(settings.slot_purchase_as_buttons.available);
                        purchaseInfo.button.setButtonLocked(false);
                    }
                }
            } else {
                if (purchaseInfo.jumpAnimation) {
                    purchaseInfo.jumpAnimation.stopAnimation();
                    purchaseInfo.jumpAnimation = null;
                }

                if (settings.slot_purchase_as_buttons) {
                    if (purchaseInfo.button) {
                        purchaseInfo.button.setTexture(settings.slot_purchase_as_buttons.locked);
                        purchaseInfo.button.setButtonLocked(true);
                    }
                }
            }
        }
    }

    createUpgradeGroup(world, building) {
        const engine = this.engine;
        const worldData = this.worldsData[world.id];
        const upgradeGroup = worldData.upgrade ? worldData.upgrade : (worldData.upgrade = {});

        const bInfo = VisualData.PLACED_BUILDINGS[building.slot];
        const center = VisualData.VISUAL_BUILDINGS[bInfo.levels[0].building].objects[0];
        const depth = bInfo.depth + 100;
        const pos = bInfo.position;
        const bLevel = building.getLevel();

        let x = pos.x + this.centerX + (center.x || 0);
        let y = pos.y + this.centerY + (center.y || 0);

        const visUpgradeGroup = engine.add.container();
        visUpgradeGroup.setPosition(x, y);
        const upX = 0;
        const upY = 0 - 60 * GlobalScale;
        const table = visUpgradeGroup.create(upX, upY, 'TableUpgrade').setInteractive();
        const clearTimer = function () {
            if (table.timer) {
                clearInterval(table.timer);
                table.timer = null;
            }
        };

        const set = VisualData.getGameSettings();

        const iconX = upX - (VisualData.GUI_BuildingsGUI.tableIconX || 100) * GlobalScale;
        const priceIcon = !set.shields || set.shields.icon ? visUpgradeGroup.create(iconX, upY + 20 * GlobalScale, 'PriceIcon').setScale(0.55) : null;
        const textlevel = (set.shields && set.shields.level_suffix) ? set.shields.level_suffix + bLevel : bLevel;
        let levelLabel = engine.add.text(upX + (set.shields ? set.shields.level_x : 0) * GlobalScale, upY + (set.shields ? set.shields.level_y : -40) * GlobalScale, textlevel, set.shields ? ShieldFontLevel : DefaultFont).setOrigin(0.5);
        let upgradePrice = engine.add.text(iconX + (set.shields ? set.shields.upgrade_x : 40) * GlobalScale, upY + (set.shields ? set.shields.upgrade_y : 20) * GlobalScale, this.getBuildingUpgradePrice(building),  set.shields ? ShieldFontPrice : DefaultFontSmall2).setOrigin(0, 0.5);
        //upgradePrice.setFitSize((VisualData.GUI_BuildingsGUI.tablePriceFitWidth || 160) * GlobalScale, 80 * GlobalScale);
        const bGUI = VisualData.GUI_BuildingsGUI;
        const loaderUpgrade = new Loader(visUpgradeGroup, null, 'Upgrade_Progress_Bar', upX + bGUI.loaderOffsetX * GlobalScale, upY + bGUI.loaderOffsetY * GlobalScale, bGUI.loaderScale);
        loaderUpgrade.setProgress(building.getUpgradeProgress());

        const upgradeInfo = {
            priceIcon: priceIcon,
            level: levelLabel,
            price: upgradePrice,
            group: visUpgradeGroup,
            table: table,
            iconLoading: false,
            x: x,
            y: y,
            depth: depth,
            building: building,
            loader: loaderUpgrade,
            available: true
        };

        if (set.shields && set.shields.rewards) {
            const info = GameData.getTokensInfoForWorld(world.id);
            if (info) {
                const xx = upX + set.shields.reward_x * GlobalScale;
                const yy = upY + set.shields.reward_y * GlobalScale;
                visUpgradeGroup.create(xx, yy, GameData.getIconByType(info.tokenType)).setScale(0.5);
                const tokensInfo = GameData.getTokensForNextSlotLevelUp(building.level);
                const t = engine.add.text(xx + 30 * GlobalScale, yy, tokensInfo.amount + " at lvl " + tokensInfo.parameter, ShieldRewardFont).setOrigin(0, 0.5);
                visUpgradeGroup.add(t);

                upgradeInfo.upgrade_reward_count = tokensInfo.parameter;
                upgradeInfo.upgrade_reward = t;
            }
        }

        table.on('pointerdown', () => {
            if (!upgradeInfo.available)// not enough resources
                return;

            table.down = true;
            clearTimer();
            setTimeout(() => {
                if (table.down) {
                    clearTimer();
                    table.counter = 0;
                    table.timer = setInterval(() => {
                        if (!upgradeInfo.available)// not enough resources
                        {
                            clearTimer();
                            return;
                        }

                        clickController.buildingWasClicked(building);
                        table.counter++;
                        audioManager.playUpgrade(table.counter);
                    }, 100);
                }
            }, 500);
            clickController.buildingWasClicked(building);
            audioManager.playUpgrade(0);
        });

        table.on('pointerout', () => {
            table.down = false;
            clearTimer();
        });

        table.on('pointerup', () => {
            table.down = false;
            clearTimer();
        });

        upgradeGroup[building.id] = upgradeInfo;
        visUpgradeGroup.add(levelLabel);
        visUpgradeGroup.add(upgradePrice);
        SetGroupVisible(visUpgradeGroup, false);
        visUpgradeGroup.setDepth(depth);
    }

    createLikesGroup(world, building) {
        const engine = this.engine;
        const worldData = this.worldsData[world.id];
        const likesGroup = worldData.likes ? worldData.likes : (worldData.likes = {});

        const bInfo = VisualData.PLACED_BUILDINGS[building.slot];
        const center = VisualData.VISUAL_BUILDINGS[bInfo.levels[0].building].objects[0];
        const depth = bInfo.depth + 100;
        const pos = bInfo.position;

        let x = pos.x + this.centerX + (center.x || 0);
        let y = pos.y + this.centerY + (center.y || 0);

        const visUpgradeGroup = engine.add.container();
        visUpgradeGroup.setPosition(x, y);
        const upX = 0;
        const upY = 0 - 60 * GlobalScale;
        const table = visUpgradeGroup.create(upX, upY, 'TableLike').setInteractive();

        const priceIcon = visUpgradeGroup.create(upX + 90 * GlobalScale, upY - 70 * GlobalScale, 'LikePlus');
        let levelLabel = engine.add.text(upX - 0 * GlobalScale, upY - 20 * GlobalScale, building.getLikes(), DefaultFont).setOrigin(0.5);

        const upgradeInfo = {
            priceIcon: priceIcon,
            level: levelLabel,
            group: visUpgradeGroup,
            table: table,
            iconLoading: false,
            x: x,
            y: y,
            depth: depth,
            building: building,
            available: true
        };

        table.on('pointerup', () => {
            clickController.buildingWasClicked(building);
        });

        likesGroup[building.id] = upgradeInfo;
        visUpgradeGroup.add(levelLabel);
        SetGroupVisible(visUpgradeGroup, false);
        visUpgradeGroup.setDepth(depth);


        building.onLikesReseted.addListener((b) => {
            if (levelLabel) {
                levelLabel.setText(b.getLikes());
            }
        });
    }

    localize() {
        super.localize();

        // for (let k in this.worldsData) {
        //     const worldData = this.worldsData[k];
        //     const upgradeGroup = worldData.upgrade;
        //     for (let up in upgradeGroup) {
        //         const info = upgradeGroup[up];
        //         this.createPurchaseLabel(info.building, worldData);
        //         info.group.destroy(true);
        //
        //         const prod = worldData.production[up];
        //         prod.isFast = false;
        //         prod.loader.setFast(false);
        //         prod.resources.text = "0";
        //         SetGroupVisible(prod.group, false);
        //     }
        //     worldData.upgrade = {};
        // }
    }

    getBuildingProducedResources(building) {
        return LocalizationManager.getLocalizedNumber(building.getProducedResources());
    }

    getBuildingUpgradePrice(building) {
        return LocalizationManager.getLocalizedNumber(building.getUpgradePrice());
    }

    buildingUpgrade(world, building) {
        const worldsData = this.worldsData[world.id];
        const purchaseData = worldsData.purchase;

        if (purchaseData.hasOwnProperty(building.id)){
            const b = purchaseData[building.id];
            b.group.destroy(true);
            if (b.jumpAnimation)
                b.jumpAnimation.stopAnimation();
            delete purchaseData[building.id];
            SetGroupVisible(worldsData.production[building.id].group, true);
        }

        if (!worldsData.upgrade.hasOwnProperty(building.id))
            this.createUpgradeGroup(world, building);

        if (!worldsData.likes.hasOwnProperty(building.id))
            this.createLikesGroup(world, building);

        const groupInfo = worldsData.upgrade[building.id];
        let text = building.getLevel();
        const set = VisualData.getGameSettings();
        if (set.shields && set.shields.level_suffix)
            text = set.shields.level_suffix + text;
        groupInfo.level.setText(text);
        groupInfo.price.setText(this.getBuildingUpgradePrice(building));
        groupInfo.loader.setProgress(building.getUpgradeProgress());

        if (set.shields && set.shields.rewards) {
            const info = GameData.getTokensInfoForWorld(world.id);
            if (info) {
                const tokensInfo = GameData.getTokensForNextSlotLevelUp(building.level);

                if (groupInfo.upgrade_reward_count !== tokensInfo.parameter) {
                    groupInfo.upgrade_reward.setText(tokensInfo.amount + " at lvl " + tokensInfo.parameter);
                    groupInfo.upgrade_reward_count = tokensInfo.parameter;
                }
            }
        }
    }

    resourcesUpdate(world, building) {
        const groupInfo = this.worldsData[world.id].production[building.id];
        groupInfo.resources.setText(this.getBuildingProducedResources(building));
    }

    buildingLiked(world, building) {
        const groupInfo = this.worldsData[world.id].likes[building.id];
        if (groupInfo)
            groupInfo.level.setText(building.getLikes());
    }

    productionUpdate(world, building) {
        if (building.getLevel() > 0) {
            const groupInfo = this.worldsData[world.id].production[building.id];
            if (!groupInfo.isFast) {
                if (building.getLoadingTime() < 1 && building.autoCollect) {
                    groupInfo.isFast = true;
                    groupInfo.loader.setFast(true);
                } else
                    groupInfo.loader.setProgress(building.getLoadingPercentage());
            }
            if (groupInfo.icon && building.anyResources !== groupInfo.icon.visible) {
                groupInfo.icon.setVisible(building.anyResources && !groupInfo.group.invisible);
            }
        }
    }
}



class WinPhotosMainMenu extends WinWithBrownBack {
    constructor(gui, gameInit) {
        super(gui, gameInit);
        this.allCells = {};
    }

    localize() {
        super.localize();
        // this.description.setText(LocalizationManager.getLocalizization("CollectCropTipText"));
    }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);

        if (visible) {
            if (!this.prepared) {
                this.prepared = true;
                this.config = VisualData.PHOTOS_MENU_SCROLL_CONFIG;
                this.config.x = this.centerX + this.config.offsetX * GlobalScale;
                this.config.y = this.centerY + this.config.offsetY * GlobalScale;

                this.scroll = new GUIScroll(this.engine, this.config, this.getCell.bind(this), this.getItems.bind(this));
            }

            this.scroll.table.setItems(this.getItems());
        }

        this.scroll.setVisible(visible);
        // this.photosButton.setVisible(visible && gameInit.progress.haveAnyPhotos());
    }

    getItems() {
        return GameData.getPhotosByMainTagArray();
    }

    getCell(cell) {
        const engine = this.engine;
        const config = this.config;
        const cellCenterX = config.cellWidth / 2 * GlobalScale;
        const cellCenterY = config.cellHeight / 2 * GlobalScale;
        const item = cell.item;

        // const mySlotInfo = gameInit.progress.getPhotoQuestById(item.id);
        const photosGroup = item.array;
        let completedQuests = 0;
        for (let p in photosGroup) {
            const pq = gameInit.progress.getPhotoQuestById(photosGroup[p].id);
            if (pq.isComplete)
                completedQuests++;
        }

        let group = engine.rexUI.add.container(0, 0);
        group.unny_container = engine.add.container(cellCenterX, cellCenterY);
        group.add(group.unny_container);


        const girlName = item.tag.toLowerCase() + "_menu";
        const icon = "GirlIconMenu_" + girlName;
        const girlPath = VisualData.getGirlsImagesFolder() + girlName + ".png";

        LoadFile(this.engine, icon, girlPath, () => {
            if (this.visible && group.active) {

                group.unny_button = new BasicButton(group.unny_container, {
                    'scene': engine,
                    'key': icon,
                    'x': 0,
                    'y': 0,
                }, () => {
                    const win = guiManager.openNewWindow(WindowType.WinPhotosQuest);
                    win.selectQuest(item);
                });

                const levelDesc = engine.add.textOld(40 * GlobalScale, -80 * GlobalScale, "PHOTOS " + completedQuests + "/" + photosGroup.length, GirlsMenuHeaderFont).setOrigin(0);
                group.unny_container.add(levelDesc.setDepth(WinDefaultDepth + 200));

                const photoDesc = engine.add.textOld(40 * GlobalScale, -20 * GlobalScale, item.tag.toLowerCase() + ' description', GirlsMenuDescFont).setOrigin(0).setWordWrapWidth(320 * GlobalScale);
                group.unny_container.add(photoDesc);
            }
        });

        this.allCells[item.tag] = group;
        return group.setOrigin(0).setDepth(WinDefaultDepth + 100);
    }

    getButtonByTag(tag) {
        const group = this.allCells[tag];
        return group ? group.unny_button : null;
    }

    getButtonPosByTag() {
        return  {
            x: 0,
            y: - 400 * GlobalScale
        }
    }
}

class WinGirlBio extends WinWithBrownBack {
    constructor(gui, gameInit) {
        super(gui, gameInit);
        // eventManager.onBubbleAppeared.addListener(this.bubbleAppeared.bind(this));
    }

    // bubbleAppeared() {
    //     if (this.visible && this.photoDesc)
    //         this.photoDesc.setVisible(false);
    // }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);

        if (visible) {
            if (!this.prepared) {
                this.prepared = true;
                const engine = this.engine;

                this.photoDesc = engine.add.text(this.centerX, this.centerY - 240 * GlobalScale, null, PhotoQuestDescFont).setOrigin(0.5, 0).setWordWrapWidth(1000 * GlobalScale);//.setDepth(WinDefaultDepth + 100);
                this.group.add(this.photoDesc);
            }
        }
    }

    selectGirl(girlName) {

        this.photoDesc.setText('\'\'There is something for you there\'\' - Peristera said.\n' +
            '\n' +
            'You ‘ve walked through the forest. \n' +
            '\'\'I don’t know what I am looking for exactly.. But Peri is so tender and caring, I am sure that she hide something amazing here.\'\'\n' +
            '\n' +
            'From the forest noises you starting to hear the quiet dog whining. You start looking for the sourse. In the roots of the old tree you find her. \n' +
            '\n' +
            '\'\'Oh, that wasn’t a dog, that was a Dryad, the spirit of nature! Looks like this one chose to take the appearance of a fox-girl. And a naked one at that! Not that I mind. Foxy ears and tail are so cute\'\' \n' +
            '\n' +
            'Dryad sits there with knees up to her chin frightened, but interested. \n' +
            '\n' +
            '\'\'She’s absolutely amazing - her gentle lines, her clear mind, her naive look - oh, that is SO incredibly sexy!\'\'');

        const icon = "GirlIcon_" + girlName;
        const girlPath = VisualData.getGirlsImagesFolder() + girlName + ".png";

        LoadFile(this.engine, icon, girlPath, () => {
            if (this.visible) {
                this.destroyImage();
                this.image = this.group.create(this.centerX - 26 * GlobalScale, this.centerY - 600 * GlobalScale, icon).setDepth(WinDefaultDepth + 1);
            }
        });
    }
}

class WinPhotosQuest extends WinWithBrownBack {
    constructor(gui, gameInit) {
        super(gui, gameInit);
        this.resourcesModules = {};
        this.collectedPuzzle = [];
        this.nonSelectedScale = 0.7;
    }

    prepareScrollWithDescription() {
        this.textArea = new GUITextArea(this.engine, {
            x: this.centerX,
            y: this.centerY + 250 * GlobalScale,
            width: 900,
            height: 600,
        }, ()=> {
            return "";

            return '\'\'There is something for you there\'\' - Peristera said.\n' +
            '\n' +
            'You ‘ve walked through the forest. \n' +
            '\'\'I don’t know what I am looking for exactly.. But Peri is so tender and caring, I am sure that she hide something amazing here.\'\'\n' +
            '\n' +
            'From the forest noises you starting to hear the quiet dog whining. You start looking for the sourse. In the roots of the old tree you find her. \n' +
            '\n' +
            '\'\'Oh, that wasn’t a dog, that was a Dryad, the spirit of nature! Looks like this one chose to take the appearance of a fox-girl. And a naked one at that! Not that I mind. Foxy ears and tail are so cute\'\' \n' +
            '\n' +
            'Dryad sits there with knees up to her chin frightened, but interested. \n' +
            '\n' +
            '\'\'She’s absolutely amazing - her gentle lines, her clear mind, her naive look - oh, that is SO incredibly sexy!\'\''});

        this.group.add(this.textArea.textArea.setDepth(20000).setOrigin(0.5));
    }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);

        if (visible) {
            if (!this.prepared) {
                this.prepared = true;
                const engine = this.engine;

                this.GirlDescription = new BasicButton(this.group, {
                    'scene': engine,
                    'key': 'GirlDescription',
                    'x': RealScreenWidth - 180 * GlobalScale,
                    'y': RealScreenHeight - 150 * GlobalScale,
                    'scale': 0.3
                }, () => {
                    const win = guiManager.openNewWindow(WindowType.WinGirlBio);
                    win.selectGirl(this.girlName);
                });

                const centerX = this.centerX;
                let startY = this.centerY + 200 * GlobalScale;

                //quest
                const questCenterX = centerX + 200 * GlobalScale;
                // const questFrame = engine.add.sprite(questCenterX, startY, 'PhotoQuestFrame').setScale(1.8, 1.2);
                // this.group.add(questFrame);
                this.questDesc = engine.add.text(questCenterX, startY - 30 * GlobalScale, null, DefaultFontSmallBlack).setOrigin(0.5, 0.5).setWordWrapWidth(560 * GlobalScale);
                this.group.add(this.questDesc);

                const progressY = startY + 30 * GlobalScale;
                this.loader = new Loader(this.group, 'PhotoQuestBar', 'PhotoQuestBarFull', questCenterX - 60 * GlobalScale, progressY);
                this.questProgress = engine.add.text(questCenterX + 150 * GlobalScale, progressY, null, DefaultFontSmallBlack).setOrigin(0, 0.5);
                this.group.add(this.questProgress);

                this.quest_done_icon = this.engine.add.sprite(questCenterX - 250 * GlobalScale, startY - 120 * GlobalScale, 'PhotoQuestDoneIcon');
                this.group.add(this.quest_done_icon);

                startY += 300 * GlobalScale;

                // this.photoName = engine.add.text(centerX, startY, null, DefaultFont).setOrigin(0.5);
                // this.group.add(this.photoName);

                // startY += 50 * GlobalScale;
                // this.photoDesc = engine.add.text(centerX, startY, null, PhotoQuestDescFont).setOrigin(0.5, 0).setWordWrapWidth(900 * GlobalScale);
                // this.group.add(this.photoDesc);


                const btnY = this.centerY + 700 * GlobalScale;
                this.createActionButton(engine, () => {
                    const pq = gameInit.progress.getPhotoQuestById(this.selectedQuest.id);
                    const quest = gameInit.photoManager.getQuestById(this.selectedQuest.id);

                    if (pq.isComplete) {
                        const photoImage = GameData.getPhotoById(pq.photoId);
                        if (photoImage) {
                            const win = guiManager.openNewWindow(WindowType.WinPhotosPreview);
                            win.setImage(photoImage);
                        }
                        return;
                    }

                    if (!this._isResourcesEnough())
                        return;

                    const questProgress = gameInit.photoManager.getQuestById(this.selectedQuest.id);
                    if (!questProgress || questProgress.progress < questProgress.count)
                        return;

                    const all = GameData.getAllResourcesType();
                    for (let i in all) {
                        const type = all[i];
                        const count = this.selectedQuest[type];
                        if (!count || count === "0")
                            continue;

                        const requiredResources = this.selectedQuest[type + '_bigInt'];
                        gameInit.progress.spendResourcesByTypeAndAmount(type, requiredResources);
                    }

                    if (quest) {
                        quest.claimReward();
                        this.selectSpecificQuest(this.selectedQuest);

                        const win = guiManager.openNewWindow(WindowType.WinPhotosPreview);
                        win.setImage(quest.info);
                    }
                }, btnY, true, 1, centerX, 800 * GlobalScale, null, 'PhotoQuestUnlockButton');

                this.photoLockIcon = engine.add.sprite(centerX, btnY, 'PhotoLock').setDepth(WinDefaultDepth + 200);
                this.group.add(this.photoLockIcon);

                this.prepareScrollWithDescription();

                this.localize();
            }
            else {
                if (this.selectedQuest)
                    this.selectSpecificQuest(this.selectedQuest);
            }
        }

        hudResources.setVisible(visible);
    }

    _isResourcesEnough() {
        const all = GameData.getAllResourcesType();
        for (let i in all) {
            const type = all[i];
            const count = this.selectedQuest[type];
            if (!count || count === "0")
                continue;

            const myResources = gameInit.progress.getResourceByName(type);
            const requiredResources = this.selectedQuest[type + '_bigInt'];
            if (myResources.compare(requiredResources) < 0)
                return false;
        }
        return true;
    }

    loadPuzzle() {
        const slot = this.selectedQuest.goodsId;
        const image = slot - 1;

        if (this.puzzleImage) {
            this.puzzleImage.destroy();
        }

        this.puzzleImage = winPuzzleInstance.getCell({
            item: {
                id: slot,
                level: this.selectedQuest.level,
                pieces: 0,
            },
            index: image
        }, true);

        const x = this.centerX - 300 * GlobalScale;
        const y = this.centerY + 170 * GlobalScale;
        this.puzzleImage.setPosition(x * localScale, y * localScale);
        this.group.add(this.puzzleImage);

        const puzzleText = this.engine.add.textOld(x, y - 180 * GlobalScale, "Collect Puzzle", DefaultFontSmallBlack).setOrigin(0.5, 0.5).setWordWrapWidth(600 * GlobalScale).setDepth(WinDefaultDepth + 100);
        this.puzzleImage.add(puzzleText);

        this.puzzle_done_icon = this.engine.add.sprite(x - 100 * GlobalScale, y - 100 * GlobalScale, 'PhotoQuestDoneIcon').setDepth(WinDefaultDepth + 200);
        this.puzzleImage.add(this.puzzle_done_icon);
    }

    selectSpecificQuest(quest) {
        // this.photoName.setText("Photo name");
        // this.photoDesc.setText("You immediately stands up to take of your toga. Dryad jumps away gracefully and start running around you on all fours\n");

        this.selectedQuest = quest;

        for (let i in this.collectedPuzzle) {
            const p = this.collectedPuzzle[i];
            if (p) {
                p.setExternalScale(p.itemArr === quest ? 1 : this.nonSelectedScale);
            }
        }

        for (let i in this.resourcesModules)
            this.resourcesModules[i].setVisible(false);

        const pq = gameInit.progress.getPhotoQuestById(quest.id);
        if (pq.isComplete) {
            this.quest_done_icon.setVisible(false);
            this.questProgress.setVisible(false);
            this.loader.setVisible(false);
            this.photoLockIcon.setVisible(false);
            this.buttonLabel.setVisible(true);

            this.questDesc.setVisible(false);
            this.buttonLabel.setText(LocalizationManager.getTutorialLocalizization("VIEW"));//TODO localize
            this.textArea.setVisible(true);
            this.textArea.setText(LocalizationManager.getLocalizization(quest.id));
            if (this.puzzleImage)
                this.puzzleImage.destroy();
            return;
        } else {
            this.loadPuzzle();
            this.questDesc.setVisible(true);
            this.buttonLabel.setText(LocalizationManager.getTutorialLocalizization("UNLOCK"));//TODO localize
            this.textArea.setVisible(false);
        }
        const questProgress = gameInit.photoManager.getQuestById(quest.id);
        let visible;
        let lockVisible;
        if (questProgress) {
            const qText = LocalizationManager.getLocalizization("Daily" + questProgress.info.questType + "Info").format(questProgress.count);
            this.questDesc.setText(qText);
            this.loader.setProgress(questProgress.progress / questProgress.count);
            this.questProgress.setText(questProgress.progress + '/' + questProgress.count);
            visible = true;
            lockVisible = questProgress.progress < questProgress.count;
        } else {
            visible = false;
            lockVisible = true;
            this.questDesc.setText("COMPLETE THE PUZZLE TO UNLOCK THE QUEST");
        }
        this.quest_done_icon.setVisible(!lockVisible);
        this.questProgress.setVisible(visible);
        this.loader.setVisible(visible);

        this.activeResources = [];

        const all = GameData.getAllResourcesType();
        for (let i in all) {
            const type = all[i];
            const count = quest[type];
            if (!count || count === "0")
                continue;

            let pGroup;
            if (this.resourcesModules.hasOwnProperty(type)) {
                pGroup = this.resourcesModules[type];
                pGroup.setVisible(true);
            } else {
                pGroup = this.resourcesModules[type] = this.engine.add.container(0, 0).setDepth(WinDefaultDepth + 1000);
                this.group.add(pGroup);

                // const frame = this.engine.add.sprite(0, 0, 'PhotoQuestFrame').setScale(0.75, 1);
                // pGroup.add(frame);
                const sprite = this.engine.add.sprite(-120 * GlobalScale, 0, GameData.getIconByType(type));
                if (type.toLowerCase().startsWith('token'))
                    sprite.setScale(0.65);
                pGroup.unny_text = this.engine.add.textOld(-80 * GlobalScale, 0, null, PhotoQuestPrice).setOrigin(0, 0.5);
                pGroup.unny_done_icon = this.engine.add.sprite(0, 0, 'PhotoQuestDoneIcon');

                pGroup.add(sprite);
                pGroup.add(pGroup.unny_text);
                pGroup.add(pGroup.unny_done_icon);
            }

            const myResources = gameInit.progress.getResourceByName(type);
            const requiredResources = quest[type + '_bigInt'];
            const enoughResoruces = myResources.compare(requiredResources) >= 0;
            pGroup.unny_done_icon.setVisible(enoughResoruces);
            pGroup.unny_text.setText(LocalizationManager.getLocalizedNumber(myResources) + ' / ' + LocalizationManager.getLocalizedNumber(requiredResources))
                .setWordWrapWidth(280 * GlobalScale);
            this.activeResources.push(pGroup);

            if (!enoughResoruces)
                lockVisible = true;
        }

        const distance = 300 * GlobalScale;

        let x = this.centerX - distance * (this.activeResources.length - 1) / 2;

        for (let i in this.activeResources) {
            this.activeResources[i].setPosition(x, this.centerY + 450 * GlobalScale);
            x += distance;
        }

        this.photoLockIcon.setVisible(lockVisible);
        this.buttonLabel.setVisible(!lockVisible);
    }

    selectQuest(item) {
        const girlName = item.tag.toLowerCase();
        this.girlName = girlName;
        const icon = "GirlIcon_" + girlName;
        const girlPath = VisualData.getGirlsImagesFolder() + girlName + ".png";

        for (let i in this.collectedPuzzle) {
            if (this.collectedPuzzle[i])
                this.collectedPuzzle[i].destroy();
        }
        this.collectedPuzzle = [];

        LoadFile(this.engine, icon, girlPath, () => {
            if (this.visible) {
                this.destroyImage();
                this.image = this.group.create(this.centerX - 26 * GlobalScale, this.centerY - 600 * GlobalScale, icon).setDepth(WinDefaultDepth + 1);

                const distance = 260 * GlobalScale;
                const puzzlesY = this.centerY - 250 * GlobalScale;
                let posX = this.centerX - (item.array.length - 1) / 2 * distance;

                this.selectSpecificQuest(item.array[0]);

                for (let i in item.array) {
                    const arr = item.array[i];
                    const previewName = arr.id;
                    const px = posX;
                    posX += distance;
                    const iconNamePreview = "Preview_" + previewName;
                    LoadFile(this.engine, iconNamePreview, VisualData.getGirlsPreviewFolder() + previewName + ".png", () => {
                        if (this.visible && this.girlName === girlName) {
                            const previewBtn = new BasicButton(this.group, {
                                'scene': this.engine,
                                'key': iconNamePreview,
                                'x': px,
                                'y': puzzlesY
                            }, () => {
                                this.selectSpecificQuest(arr);
                            });

                            previewBtn.tint = PuzzleColorsPerLevel[0];
                            previewBtn.itemArr = arr;

                            this.collectedPuzzle[i] = previewBtn;

                            previewBtn.setExternalScale(this.selectedQuest === arr ? 1 : this.nonSelectedScale);
                        }
                    });
                }
            }
        });
    }
}

class WinManagerDoubling extends WinWithBrownBack {

    createGame(engine) {
        super.createGame(engine);
        eventManager.onBubbleAppeared.addListener(this.bubbleAppeared.bind(this));
    }

    bubbleAppeared() {
        if (this.visible && this.superDouble)
            this.superDouble.setVisible(false);
    }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);
        if (visible) {
            this.prepareWindow();
            this.setInfo();
        }
    }

    setInfo() {
        const engine = this.engine;
        if (this.collectedPuzzle)
            this.collectedPuzzle.destroy();

        this.resources.setText(LocalizationManager.getLocalizedNumber(gameInit.progress.getSuperDoublingTokens()));

        const guard = this.gameInit.guardManager.getGuardForWorld(this.gameInit.selectedWorld);
        if (!guard)
            console.error("there is no guard in the world " + this.gameInit.selectedWorld);
        else {
            const allPuzzles = this.gameInit.progress.getGuardPuzzleInfo();
            let info = null;
            for (let i in allPuzzles) {
                if (allPuzzles[i].id === guard.id) {
                    info = allPuzzles[i];
                    break;
                }
            }
            if (!info)
                console.error("puzzle info wasn't found", guard);
            else {
                this.collectedPuzzle = winPuzzleInstance.getCell({
                    item: info,
                    index: guard.id
                }, false, false, null, true);
                this.group.add(this.collectedPuzzle);

                let y = 50 * GlobalScale;
                const nameBack = engine.add.sprite(650 * GlobalScale, y, 'Managers_UnderText_1').setDepth(WinDefaultDepth + 100).setScale(1.5, 1);
                this.collectedPuzzle.add(nameBack);
                let name = engine.add.textOld(650 * GlobalScale, y, guard.title, DefaultFont).setOrigin(0.5, 0.5).setDepth(WinDefaultDepth + 100);
                this.collectedPuzzle.add(name);
                y += 70;

                const passives = guard.getPassiveBonusesType();
                for (let i in passives) {
                    const pb = passives[i];

                    let text = null;
                    switch (pb) {
                        case 'MultiProfit':
                        case 'MultiProfitLow':
                            if (guard.getPassiveBonusValueMinimum())
                                text = "Profit: +" + guard.getPassiveBonusValueMinimum() + "%";
                            else
                                text = null;
                            break;
                        case 'SeedProc':
                            text = "Seeds Bonus +" + guard.getPassiveBonusValueMinimum();
                            break;
                        default:
                            text = pb;
                            break;
                    }
                    if (text) {
                        const passive = engine.add.textOld(400 * GlobalScale, y, text, FontManagerWindow)
                            .setOrigin(0, 0.5)
                            .setDepth(WinDefaultDepth + 100);
                        this.collectedPuzzle.add(passive);
                    }

                    y += 60 * GlobalScale;
                }

                y += 50 * GlobalScale;
                let active = engine.add.textOld(400 * GlobalScale, y, LocalizationManager.getLocalizization("Manager_super_doubling").format(guard.getActiveBonusValueMinumum()), FontManagerWindow)
                    .setOrigin(0, 0.5)
                    .setDepth(WinDefaultDepth + 100);
                this.collectedPuzzle.add(active);

                this.collectedPuzzle.setPosition((this.centerX - 450 * GlobalScale) * localScale, (this.centerY - 550 * GlobalScale) * localScale);
                this.group.add(this.collectedPuzzle);
            }
        }
    }

    getTutorialButton() {
        return this.doubleButton;
    }

    prepareWindow() {
        if (this.prepared)
            return;
        this.prepared = true;

        const engine = this.engine;

        let y = this.centerY + 600 * GlobalScale;
        this.superDouble = engine.add.container(this.centerX, y);
        y = 0;
        this.group.add(this.superDouble);
        const back = engine.add.sprite(0, 0, 'QuestBack').setDepth(WinDefaultDepth);
        this.superDouble.add(back);

        this.doubleForeverLabel = engine.add.text(0, y, LocalizationManager.getLocalizization("RainDesc").format(4), FontManagerWindow)
            .setOrigin(0.5, 0.5)
            .setWordWrapWidth(1000 * GlobalScale)
            .setDepth(WinDefaultDepth + 100);
        this.superDouble.add(this.doubleForeverLabel);

        y -= 100 * GlobalScale;
        const nameBack = engine.add.sprite(0, y, 'Managers_UnderText_2').setDepth(WinDefaultDepth + 100);
        this.superDouble.add(nameBack);
        let name = engine.add.text(0, y, "SUPER DOUBLING", DefaultFont).setOrigin(0.5, 0.5).setDepth(WinDefaultDepth + 100);
        this.superDouble.add(name);

        y += 240 * GlobalScale;
        const button = new ButtonWithText(this.superDouble, {
            'scene': engine,
            // 'key': 'DefaultButton',
            'key': 'ButtonPink',
            'x': 0,
            'y': y,
            // 'scale_parent': true,
            // 'minWidth': 1000 * GlobalScale
        }).setDepth(WinDefaultDepth + 100);
        button.caption.setText("BUY FOR $5");

        //top
        this.guardDescription = engine.add.text(this.centerX, this.centerY + 100 * GlobalScale, "She likes very dirty sex and different toys", FontManagerWindow)
            .setOrigin(0.5, 0.5)
            .setWordWrapWidth(1000 * GlobalScale)
            .setDepth(WinDefaultDepth + 100);
        this.group.add(this.guardDescription);

        let x = this.centerX - 270 * GlobalScale;
        y = this.centerY - 130 * GlobalScale;
        new BasicButton(this.group, {
            'scene': engine,
            'key': 'ButtonGreen',
            'x': x,
            'y': y,
        }, () => {
            this.gui.openGuardsTab();
        }).setDepth(WinDefaultDepth + 100);

        let btnText = engine.add.textOld(x, y, "CHANGE", DefaultFontVerySmall2)
            .setOrigin(0.5, 0.5)
            .setDepth(WinDefaultDepth + 100);
        this.group.add(btnText);

        this.doubleButton = new ButtonWithText(this.group, {
            'scene': engine,
            'key': 'ButtonBlue',
            'x': this.centerX,
            'y': this.centerY + 300 * GlobalScale,
            'font': DefaultFont
        }, () => {
            if (gameInit.progress.haveAnySuperDoublingTokens()) {
                gameInit.progress.spendSuperDoublingToken();
                gameInit.progress.activateSupervisor();
                this.gui.getWindowByType(WindowType.WinMain).playBreadAnimation();
                this.closeWindow();
            } else
                guiManager.openGemsStore();
        }).setDepth(WinDefaultDepth + 100);
        this.doubleButton.caption.setText('X2 profit for 15 seconds');


        y = 120 * GlobalScale;
        x = this.centerX - 500 * GlobalScale;
        const info = VisualData.GUI_HUDResources;
        const image = engine.add.sprite(x, y, 'HudResBack').setOrigin(0, 0.5);
        if (info.hudBackScale)
            image.setScale(info.hudBackScale, 1);
        this.group.add(image);
        this.group.create(x + 30 * GlobalScale, y, 'PriceDoublingToken').setScale(0.85, 0.9);
        this.resources = engine.add.text(x + 80 * GlobalScale, y + info.labelOffsetY * GlobalScale, null, DefaultFontSmall).setOrigin(0, 0.5);
        this.group.add(this.resources);
        new BasicButton(this.group, {
            'scene': engine,
            'key': 'HudPlusButton',
            'x': x + info.greenButtonOffsetX1 * GlobalScale,
            'y': y,
        }, () => guiManager.openGemsStore());
    }
}

class WinPhotosPreview extends WinWithPicture {
    constructor(gui, gameInit, config) {
        super(gui, gameInit, config);
    }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);
        this.button.style.display = this.photo.style.display = visible ? 'inherit' : 'none';
    }

    setImage(item) {
        this.photo.src = item.name;
    }

    createGame(engine) {
        super.createGame(engine);

        const canvas = document.getElementById("phaser-app");

        const divElement = document.createElement("img");
        divElement.className = "photo-image";
        canvas.appendChild(divElement);

        this.photo = divElement;

        this.button = document.createElement("img");
        this.button.className = "photo-exit";
        canvas.appendChild(this.button);

        this.button.src = VisualData.getFolderPath() +  CommonVisualData.ALL_OBJECTS["ExitButton"].file;

        this.button.onclick = () => {
            this.closeWindow();
        };

        this.setWindowVisible(false);
    }
}

class WinPhotosList extends WinWithBrownBack {
    constructor(gui, gameInit) {
        super(gui, gameInit);
        this.selectedTab = 0;
    }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);

        if (visible) {
            this.tabWasSwitched(this.tabs[this.selectedTab]);

            if (!this.prepared) {
                this.prepared = true;
                this.config = VisualData.PHOTOS_LIST_SCROLL_CONFIG;
                this.config.x = this.centerX + this.config.offsetX * GlobalScale;
                this.config.y = this.centerY + this.config.offsetY * GlobalScale;

                this.scroll = new GUIScroll(this.engine, this.config, this.getCell.bind(this), this.getItems.bind(this));
            }
        }

        this.scroll.setVisible(visible);
    }

    addTab(icon, x, y) {
        const tab = new ToogleButton(this.engine, this.group, icon, x, y, () => this.tabWasSwitched(tab), this.winInfo);
        this.tabs.push(tab);
    }

    tabWasSwitched(tab) {
        for (let i = 0; i < this.tabs.length; i++) {
            if (this.tabs[i] === tab) {
                this.tabs[i].setSelected(true);
                this.selectedTab = i;

                // SetGroupVisible(this.groups[i], true);
            } else {
                this.tabs[i].setSelected(false);
                // SetGroupVisible(this.groups[i], false);
            }
        }

        if (this.scroll)
            this.scroll.table.setItems(this.getItems());
    }

    createGame(engine) {
        super.createGame(engine);

        let xPos = this.centerX - 500 * GlobalScale;
        let yPos = this.centerY - 630 * GlobalScale;
        const distance = 300 * GlobalScale;

        this.tabs = [];
        this.addTab('TabAlbum_Misc', xPos, yPos);
        xPos += distance;
        this.addTab('TabAlbum_Girl', xPos, yPos);
        xPos += distance;
        this.addTab('TabAlbum_Genre', xPos, yPos);
    }

    getItems() {
        switch (this.selectedTab) {
            case 0:
                return GameData.getPhotoData();
            case 1:
                return GameData.getPhotosByTagArray();
            case 2:
                return GameData.getPhotosByFilterArray();
        }
    }

    getCell(cell) {
        const engine = this.engine;
        const config = this.config;

        if (this.selectedTab === 0)
            return WinPhotosListSingleImages.createCell(cell, engine, config, this);

        const cellCenterX = config.cellWidth / 2 * GlobalScale;
        const cellCenterY = config.cellHeight / 2 * GlobalScale;
        const depth = WinDefaultDepth + 100;
        let group = engine.rexUI.add.container(0, 0);

        const item = cell.item;
        const y = cellCenterY + 200 * GlobalScale;
        const distance = 30 * GlobalScale;
        const array = item.array;
        let name = item.tag || item.filter;

        group.unny_container = engine.add.container(cellCenterX, cellCenterY);
        group.add(group.unny_container);

        group.unny_back = new BasicButton(group.unny_container, {
            'scene': engine,
            'key': 'Album_Frame',
            'x': 0,
            'y': 0,
            'scale_parent': true
        }, () => {
            const win = guiManager.openNewWindow(WindowType.WinPhotosListSingleImages);
            win.setPhotos(item.array, name);
        });

        const photoName = engine.add.textOld(cellCenterX, y - distance, name, DefaultFontSmall).setOrigin(0.5);
        group.add(photoName);

        let completedQuests = 0;
        for (let i in array) {
            const pq = gameInit.progress.getPhotoQuestById(array[i].id);
            if (pq.isComplete)
                completedQuests++;
        }

        const photoCount = engine.add.textOld(cellCenterX, y + distance, "PHOTOS " + completedQuests + "/" + array.length, PhotosCountInListFont).setOrigin(0.5);
        group.add(photoCount);

        //Image
        const imageName = "PHOTO_PLACEHOLDER";
        const imagePath = "UI/Windows/PhotoAlbum/picture.png";
        let loading = true;
        if (imageName) {
            LoadFile(engine, imageName, imagePath, () => {
                if (group && group.active) {
                    const sprite = engine.add.sprite((group.x / localScale || 0) + cellCenterX, (group.y / localScale || 0) + cellCenterY, imageName)
                        .setDepth(depth);
                    group.add(sprite);
                    group.unny_sprite = sprite;
                    if (this.scroll && !loading)
                        this.scroll.fakeMove();
                }
            });
        }
        loading = false;

        return group.setOrigin(0).setDepth(WinDefaultDepth + 100);
    }
}

class WinPhotosListSingleImages extends WinWithBrownBack {
    constructor(gui, gameInit) {
        super(gui, gameInit);
    }

    setPhotos(photos, title) {
        this.photosList = photos;
        if (this.scroll)
            this.scroll.table.setItems(this.getItems());
        this.header.setText(title);
    }

    createGame(engine) {
        super.createGame(engine);

        const depth = WinDefaultDepth + 1000;
        const posY = this.centerY + this.getWinInfoValue('headerOffset', -500);
        const x = this.centerX;
        this.header = engine.add.text(x, posY, null, DefaultFontBig)
            .setOrigin(0.5, 0.5)
            .setDepth(depth);
        this.group.add(this.header);

        const distance = 500 * GlobalScale;
        const spriteLeft = engine.add.sprite(x - distance, posY, 'StripeText').setDepth(depth);
        this.group.add(spriteLeft);
        const spriteRight = engine.add.sprite(x + distance, posY, 'StripeText').setDepth(depth);
        this.group.add(spriteRight);
    }

    setWindowVisible(visible) {
        super.setWindowVisible(visible);

        if (visible) {
            if (!this.prepared) {
                this.prepared = true;
                this.config = VisualData.PHOTOS_LIST_SINGLE_SCROLL_CONFIG;
                this.config.x = this.centerX + this.config.offsetX * GlobalScale;
                this.config.y = this.centerY + this.config.offsetY * GlobalScale;

                this.scroll = new GUIScroll(this.engine, this.config, this.getCell.bind(this), this.getItems.bind(this));
            }
        }

        this.scroll.setVisible(visible);
    }

    getItems() {
        return this.photosList || [];
    }

    getCell(cell) {
        return WinPhotosListSingleImages.createCell(cell, this.engine, this.config, this);
    }

    static createCell(cell, engine, config, scrollParent) {
        const cellCenterX = config.cellWidth / 2 * GlobalScale;
        const cellCenterY = config.cellHeight / 2 * GlobalScale;
        let group = engine.rexUI.add.container(0, 0);
        const depth = WinDefaultDepth + 100;

        const item = cell.item;
        const pq = gameInit.progress.getPhotoQuestById(item.id);

        group.unny_container = engine.add.container(cellCenterX, cellCenterY);
        group.add(group.unny_container);

        group.unny_back = new BasicButton(group.unny_container, {
            'scene': engine,
            'key': 'Album_Frame',
            'x': 0,
            'y': 0,
            'scale_parent': true
        }, () => {
            if (pq.isComplete) {
                const win = guiManager.openNewWindow(WindowType.WinPhotosPreview);
                win.setImage(item);
            }
        });

        let imageName;
        let imagePath;
        let fit = false;

        if (!pq.isComplete) {
            const y = cellCenterY + 200 * GlobalScale;

            const lock = engine.add.sprite(cellCenterX, y, 'WhiteSpace');
            group.add(lock);

            const photoName = engine.add.textOld(cellCenterX, y, "Photo is Locked", DefaultFontVerySmall).setOrigin(0.5);
            group.add(photoName);

            imageName = "PHOTO_PLACEHOLDER";
            imagePath = "UI/Windows/PhotoAlbum/picture.png";

            engine.load.setPath(VisualData.getFolderPath());
        } else {
            imageName = "PHOTO_" + item.id;
            imagePath = item.name;
            fit = true;
            engine.load.setPath("");
        }

        //Image
        let loading = true;
        if (imageName) {
            LoadFile(engine, imageName, imagePath, () => {
                if (group && group.active) {
                    const sprite = engine.add.sprite((group.x / localScale || 0) + cellCenterX, (group.y / localScale || 0) + cellCenterY, imageName)
                        .setDepth(depth);

                    if (fit)
                        sprite.setScale(Math.min(332 / sprite.width * GlobalScale, 239 / sprite.height * GlobalScale));

                    group.add(sprite);
                    group.unny_sprite = sprite;

                    if (scrollParent.scroll && !loading)
                        scrollParent.scroll.fakeMove();
                }
            });
        }
        loading = false;

        return group.setOrigin(0).setDepth(WinDefaultDepth + 100);
    }
}

class WinSpecialOffer extends WinWithExit {

    setWindowVisible(visible) {
        super.setWindowVisible(visible);

        if (this.timer) {
            clearInterval(this.timer);
            this.timer = null;
        }

        if (visible) {
            if (!this.loaded) {
                this.loaded = true;
                this._addImage(0, 0, this._getBackName(), 1, () => {
                    this._addImage(400 * GlobalScale, -500 * GlobalScale, "Offer_Timer", 1, (image) => {
                        if (this._getTimeLeft() > 0) {
                            this.timerBack = image;
                            this.timerText = this.engine.add.text(400 * GlobalScale, -500 * GlobalScale, null, DefaultFontSmall)
                                .setOrigin(0.5, 0.5)
                                .setDepth(WinDefaultDepth + 40);
                            this.group.add(this.timerText);
                        } else
                            image.setVisible(false);
                    });
                    this._addAdditionalElements();

                    this.prices = [];
                    const products = this._getProducts();
                    if (products) {
                        for (let i in products) {
                            const p = products[i];
                            const num = i;
                            this._addImage(p.x * GlobalScale, p.y * GlobalScale, p.name, 1, () => {
                                this._addImage((p.x + 120) * GlobalScale, (p.y - 120) * GlobalScale, 'HudPlusButton');
                                this._addImage(p.x * GlobalScale, p.y * GlobalScale, p.icon, p.scale);
                                if (p.title) {
                                    this.prices[num] = this.engine.add.text((p.x + 100) * GlobalScale, (p.y + 30) * GlobalScale, p.title, DefaultFontSmall)
                                        .setOrigin(1, 0).setDepth(WinDefaultDepth + 1000);
                                    this.group.add(this.prices[num]);
                                }
                            });
                        }
                    }

                    this.description = this.engine.add.text(50 * GlobalScale, 380 * GlobalScale, null, DefaultFontSmallBlack)
                        .setOrigin(0.5, 0.5)
                        .setWordWrapWidth(700 * GlobalScale)
                        .setDepth(WinDefaultDepth + 40);
                    this.group.add(this.description);

                    this.createActionButton(this.engine, this.buttonClicked.bind(this), 750 * GlobalScale, true, 1, 50 * GlobalScale, 400);
                    this.buttonLabel.setText(socialManager.getPriceLabel(this._getPurchaseId()));

                    const oldPrice = socialManager.getDisplayPrice(socialManager.getPrice(this._getPurchaseId()) * 5);
                    this.oldPrice = this.engine.add.textOld(50 * GlobalScale, 600 * GlobalScale, oldPrice, DefaultFontBig)
                        .setOrigin(0.5, 0.5);
                    // .setDepth(WinDefaultDepth + 40);
                    this.group.add(this.oldPrice);
                    this._addImage(50 * GlobalScale, 600 * GlobalScale, 'Offer_Line');

                    this._addImage(400 * GlobalScale, 600 * GlobalScale, 'Offer_Label', 1, () => {
                        this.group.add(this.engine.add.text(400 * GlobalScale, 600 * GlobalScale, "-80%", DefaultFontBig).setOrigin(0.5, 0.5));
                    });

                    this.localize();
                });
            } else {
                this.localize();

                const visible = (this._getTimeLeft() > 0)
                if (this.timerText)
                    this.timerText.setVisible(visible);
                if (this.timerBack)
                    this.timerBack.setVisible(visible);
            }

            this.timer = setInterval(()=> {
                if (this.timerText) {
                    const timeLeft = Math.trunc(this._getTimeLeft() / 1000);
                    if (timeLeft > 0)
                        this.timerText.setText(timeToStringClock(timeLeft));
                    else
                    {
                        this.timerText.setVisible(false);
                        this.timerBack.setVisible(false);
                        clearInterval(this.timer);
                        this.timer = null;
                    }
                } else
                    clearInterval(this.timer);
            }, 1000);
        }
    }

    buttonClicked() {
        this.closeWindow();
        gameInit.progress.tryToPurchaseUpgrade(this._getPurchaseId());
        // gameInit.progress.publicConfirmedPayment(this._getPurchaseId());
    }

    localize() {
        if (this.description)
            this.description.setText(LocalizationManager.getLocalizization(this._getDescriptionName()));

        if (this.prices) {
            const products = this._getProducts();
            if (products) {
                for (let i in products) {
                    const p = products[i];
                    if (p.title && this.prices[i])
                        this.prices[i].setText(p.title);
                }
            }
        }
    }

    _getTimeLeft() {
        console.error("_getTimeLeft: Not implemented");
        return null;
    }

    _getPurchaseId() {
        console.error("_getPurchaseId: Not implemented");
        return null;
    }

    _addAdditionalElements() {

    }

    _getProducts() {
        console.error("_getProducts: Not implemented");
        return null;
    }

    _getBackName() {
        console.error("_getBackName: Not implemented");
        return null;
    }
}

class WinSpecialOffer1 extends WinSpecialOffer {
    _getProducts() {
        const distanceX = 300;
        const distanceY = -30;
        let startX = -440;
        let startY = 150;
        const obj = [];
        for (let i = 1; i <= 4; i++) {
            obj.push({
                x: startX,
                y: startY,
                name: 'Offer_Frame' + i
            });
            startX += distanceX;
            startY += distanceY;
        }
        obj[0].icon = 'PriceIconBig';
        obj[1].icon = 'GiftBox';
        obj[2].icon = 'PriceSeedsBig';
        obj[3].icon = 'Alien_puzzle';

        obj[1].scale = 0.7;
        obj[3].scale = 0.7;

        const data = GameData.getMarketPurchaseById(this._getPurchaseId());
        obj[0].title = LocalizationManager.getLocalizedNumber(data.getFishCount());
        obj[1].title = data.getBoxesCount();
        obj[2].title = LocalizationManager.getLocalizedNumber(data.getCansCount());
        return obj;
    }

    _getTimeLeft() {
        return 24 * 3600 * 1000 - (Progress.getTimeNow() - gameInit.progress.getOffer1StartTime());
    }

    _addAdditionalElements() {
        this._addImage(0, -250 * GlobalScale, "Offer_Horseshoe");
    }

    _getBackName() {
        return 'OfferBack1';
    }

    _getDescriptionName() {
        return 'SpecOfferCloudDesc';
    }

    _getPurchaseId() {
        return 'hellprod.offer1';
    }
}

const GUIMode = {
    Normal: 1,
    UpgradeBuildings: 2,
    Boss: 3,
    Likes: 4,
};

const WindowType = {
    WinMain: 0,
    WinConstruct: 1,
    WinBuildings: 2,
    WinUpgrade: 3,
    WinStore: 4,
    WinPuzzle: 5,
    WinBossSummon: 6,
    WinBossProccess: 7,
    WinHarvested: 8,
    WinFortuneWheel: 9,
    WinQuests: 10,
    WinSupervisor: 11,
    WinGuard: 12,
    WinDaily: 13,
    WinDropPuzzle: 14,
    WinNoAdd: 15,
    WinNotEnoughGems: 16,
    WinWaiting: 17,
    WinFreeUpgrade: 18,
    WinTimeTravel: 19,
    WinApples: 20,
    WinBanjoEnd: 21,
    WinBanjoPreEnd: 22,
    WinSettings: 23,
    WinAdBLock: 24,
    WinOtherWorlds: 25,
    WinPhotosMainMenu: 26,
    WinPhotosQuest: 27,
    WinPhotosPreview: 28,
    WinInAppBought: 29,
    WinPhotosList: 30,
    WinWelcomeBack: 31,
    WinResourcesInfo: 32,
    WinSpecialOffer1: 33,
    WinPhotosListSingleImages: 34,
    WinManagerDoubling: 35,
    WinZoomIn: 36,
    QuestBubble: 37,
    WinGirlBio: 38,
    WinLocationSelection: 39,
};

class GUIManager {

    constructor(gameInit) {
        gameInit.create.addListener(this.create.bind(this));
        gameInit.preload.addListener(this.preload.bind(this));
        gameInit.onBuildingCreated.addListener(this.buildingCreated.bind(this));
        gameInit.onBuildingUpdated.addListener(this.buildingUpdated.bind(this));
        gameInit.onBuildingLiked.addListener(this.buildingLiked.bind(this));
        gameInit.onBuildingResourcesUpdated.addListener(this.buildingResourcesUpdated.bind(this));
        gameInit.onBuildingUpgraded.addListener(this.buildingUpgraded.bind(this));
        clickController.onBuildingClicked.addListener(this.buildingClicked.bind(this));
        this.onBuildingCreated = new UnnyAction();
        this.onBuildingUpgraded = new UnnyAction();
        this.onBuildingUpdated = new UnnyAction();
        this.onBuildingLiked = new UnnyAction();
        this.onResourcesUpdated = new UnnyAction();
        this.onBuildingResourcesUpdated = new UnnyAction();
        this.onReset = new UnnyAction();

        this.onModeChanged = new UnnyAction();
        this.onCreate = new UnnyAction();
        this.guiMode = GUIMode.Normal;

        this.allWindows = [];
        this.allWindows[WindowType.WinMain] = new WinMain(this, gameInit);
        this.allWindows[WindowType.WinConstruct] = new WinConstruct(this, gameInit);
        this.allWindows[WindowType.WinBuildings] = new BuildingsGUI(this, gameInit);
        this.allWindows[WindowType.WinUpgrade] = new WinUpgrade(this, gameInit);
        this.allWindows[WindowType.WinStore] = new WinStore(this, gameInit);
        this.allWindows[WindowType.WinPuzzle] = new WinPuzzle(this, gameInit);
        this.allWindows[WindowType.WinBossSummon] = new WinBossSummon(this, gameInit, {
            header: "CollectCropTitle",
            description: "CollectCropText",
            image: "CollectCrop",
            button: "CollectCropStartButton",
            btn_min_width: 750,
            action: ()=>this.changeMode(GUIMode.Boss)
        });
        this.allWindows[WindowType.WinBossProccess] = new WinBossProccess(this, gameInit);
        this.allWindows[WindowType.WinHarvested] = new WinHarvested(this, gameInit);
        this.allWindows[WindowType.WinFortuneWheel] = new WinFortuneWheel(this, gameInit);
        this.allWindows[WindowType.WinQuests] = new WinQuests(this, gameInit);
        this.allWindows[WindowType.WinSupervisor] = new WinWithUnlockedExitButton(this, gameInit, {
            header: "BanjoTitle",
            description: "BanjoDesc",
            image: "Banjo",
            button: "BanjoButtonText",
            btn_min_width: 800,
            icon: 'AdCam',
            action: ()=>{
                PlayRewardedAd(()=> {
                    gameAnalytics.sendEvent("Ad_Banjo");
                    gameInit.progress.activateSupervisor();
                    this.getWindowByType(WindowType.WinMain).playBreadAnimation();
                });
            }
        });
        this.allWindows[WindowType.WinWelcomeBack] = new WinWelcomeBack(this, gameInit, {
            header: "MultiplyOnStartTitle",
            description: "MultiplyOnStartDesc",
            image: "Banjo",
            button: "MultiplyOnStartButton",
            btn_min_width: 800,
            icon: 'AdCam',
            action: ()=>{
                PlayRewardedAd(() => {
                    gameAnalytics.sendEvent("Ad_WelcomeBack");
                    const win = guiManager.getWindowByType(WindowType.WinWelcomeBack);
                    guiManager.getWindowByType(WindowType.WinBanjoEnd).setNumber(win.offlineResources.multiply(2));
                    guiManager.openNewWindow(WindowType.WinBanjoEnd);
                    eventManager.offlineDoubled();
                    gameInit.progress.setLastDoubleTime();
                });
            }
        });
        this.allWindows[WindowType.WinGuard] = new WinGuard(this, gameInit, {
            header: "RainTitle",
            description: "RainDescFreeProSpecial",
            image: "Cloud",
            button: "RainButtonText",
            btn_min_width: 600,
            icon: 'AdCam',
            action: ()=>{
                PlayRewardedAd(()=> {
                    gameAnalytics.sendEvent("Ad_Rain");
                    gameInit.progress.activateGuard();
                }, gameInit.progress.isGuardActive());
            }
        });
        this.allWindows[WindowType.WinDaily] = new WinDailyBonus(this, gameInit);
        this.allWindows[WindowType.WinDropPuzzle] = new WinDropPuzzle(this, gameInit);

        this.allWindows[WindowType.WinNoAdd] = new WinGemsInsteadOfAds(this, gameInit, {
            header: "NoAdTitle",
            description: "NoAdText",
            image: "NoAdAndRatings",
            button: GEMS_PRICE_FOR_ADS,
            dontLocalizeButton: true,
            icon: 'PriceGems',
            btn_min_width: 300,
        });

        this.allWindows[WindowType.WinAdBLock] = new WinGemsInsteadOfAds(this, gameInit, {
            header: "NoAdTitle",
            description: "AdBlock",
            image: "NoAdAndRatings",
            button: GEMS_PRICE_FOR_ADS,
            dontLocalizeButton: true,
            icon: 'PriceGems',
            btn_min_width: 300,
        });

        this.allWindows[WindowType.WinOtherWorlds] = new WinOtherWorlds(this, gameInit, {
            header: "LocationsNotOpenedWindowTitle",
            description: "LocationsNotOpenedWindowDesc",
            image: "OtherWorldsLocked",
            scaleImage: VisualData.IsVertical() ? 0.7 : 1,
            button: "ButtonOk",
            no_exit: true,
            smallFont: true,
            wordWrapWidth: 900
        });

        this.allWindows[WindowType.WinInAppBought] = new WinInAppBought(this, gameInit, {
            header: "GetPuzzlePartTitle",
            description: "PopupInApp",
            image: "FortuneDevil",
            button: "ButtonOk",
            no_exit: true,
            imageX: 100,
            imageY: 70,
            scaleImage: 0.9
        });

        this.allWindows[WindowType.WinNotEnoughGems] = new WinWithPicture(this, gameInit, {
            description: "NotEnoughGemsText",
            image: "NotEnoughGems",
            button: "ButtonOk",
            imageX: 100,
            action: ()=>this.openGemsStore()
        });

        this.allWindows[WindowType.WinWaiting] = new WinWithPicture(this, gameInit, {
            description: "GiftWindowGettingInfo",
            image: "Wait",
            no_exit: true,
        });

        this.allWindows[WindowType.WinFreeUpgrade] = new WinWithPicture(this, gameInit, {
            header: 'PurchaseForAdWindowTitle',
            description: "PurchaseForAdWindowDesc",
            image: "Clockwork_icon_big",
            button: "ButtonOk",
        });

        this.allWindows[WindowType.WinTimeTravel] = new WinTimeTravel(this, gameInit, {
            description: "TimeTravelWindowText",
            image: "TimeTravel4h",
            button: "ButtonOk",
        });

        this.allWindows[WindowType.WinApples] = new WinAppleDescription(this, gameInit, {
            header: "SeedInfoTitle",
            image: "AppleInfo",
            imageY: 300
        });

        this.allWindows[WindowType.WinBanjoEnd] = new WinBanjoEnd(this, gameInit, {
            header: "BanjoEndTitle",
            description: "BanjoEndDesc",
            image: "BanjoEnd",
            button: "ButtonOk",
            no_exit: true,
        });

        this.allWindows[WindowType.WinBanjoPreEnd] = new WinBanjoPreEnd(this, gameInit, {
            header: "BanjoEndTitle",
            image: "MultiplyOnStart",
            imageX: 200,
            no_exit: true,
            descriptionX: 350,
            descriptionY: 100,
        });

        this.allWindows[WindowType.WinResourcesInfo] = new WinWithPicture(this, gameInit, {
            getDescription: ()=>this._getResourcesInfoDescription(),
            image: VisualData.IsVertical() ? null : "FortuneDevil",
            button: "ButtonOk",
            imageX: 0,
            imageY: -10,
            no_exit: true,
            buttonY: 200
        });

        this.allWindows[WindowType.WinSpecialOffer1] = new WinSpecialOffer1(this, gameInit);

        this.allWindows[WindowType.WinSettings] = new WinSettings(this, gameInit);

        if (VisualData.getGameSettings().photos) {
            this.allWindows[WindowType.WinPhotosMainMenu] = new WinPhotosMainMenu(this, gameInit);
            this.allWindows[WindowType.WinPhotosQuest] = new WinPhotosQuest(this, gameInit);
            this.allWindows[WindowType.WinGirlBio] = new WinGirlBio(this, gameInit);
            this.allWindows[WindowType.WinPhotosPreview] = new WinPhotosPreview(this, gameInit,  {
                description: "GiftWindowGettingInfo",
                image: "collectCropSplash",
                no_exit: true,
                imageX: 100,
                oldText: true
            });
            this.allWindows[WindowType.WinPhotosList] = new WinPhotosList(this, gameInit);
            this.allWindows[WindowType.WinPhotosListSingleImages] = new WinPhotosListSingleImages(this, gameInit);
            this.allWindows[WindowType.WinManagerDoubling] = new WinManagerDoubling(this, gameInit);
            this.allWindows[WindowType.WinZoomIn] = new WinZoomIn(this, gameInit);
            this.allWindows[WindowType.QuestBubble] = new WinQuestBubble(this, gameInit);
            this.allWindows[WindowType.WinLocationSelection] = new WinLocationSelection(this, gameInit);
        }

        this.activeWindows = [];
        this.activeWindows.push(this.allWindows[WindowType.WinMain]);

        for (let i in this.allWindows) {
            const win = this.allWindows[i];
            win.winType = i;
            // win.setWindowVisible(false);
            win.onClose.addListener(this.onWindowsClosed.bind(this));
        }

        clickController.onFabrikaWasClicked.addListener((action)=>{
            if (action === 'down' && this.isNormalMode() && !gameInit.progress.isSupervisorActive())
                this.openNewWindow(WindowType.WinBossSummon);
        });
        clickController.onPodkovaWasClicked.addListener((action)=>{
            if (action === 'down' && this.isNormalMode() && !gameInit.progress.isSupervisorActive())
                this.openNewWindow(WindowType.WinGuard)
        });

        eventManager.onHarvestCompleted.addListener((seeds)=>{
            const win = this.openNewWindow(WindowType.WinHarvested, true);
            win.setApplesAcount(seeds);
        });

        // eventManager.onOfflineCollected.addListener((time, resources)=>{
        //     if (time > 3600000 && resources.compare(0) > 0 && gameInit.progress.isTutorialCompleted()) {
        //         setTimeout(() => {
        //             const win = this.openNewWindow(WindowType.WinWelcomeBack);
        //             win.setOfflineCollect(resources);
        //         }, 1000);
        //     }
        // })
    }

    showQuestMessage(text, image, callback) {
        const win = this.openNewWindow(WindowType.QuestBubble, false, true);
        win.setData(text, image, callback);
    }

    _getResourcesInfoDescription() {
        let s = "";
        let strNum = "100";
        let strNum2 = "1";
        for (let i = 1; i < 7; i++) {
            strNum += "000";
            strNum2 += ",000";
            s += LocalizationManager.getLocalizedNumberString(strNum, false) + " = " + strNum2 + "\n";
        }
        return s;
    }

    preload() {
        CalculateFonts();
    }

    _checkForNewPopup() {
        if (this.popups.length > 0) {
            const info = this.popups[0];
            this.popup.textLabel.setText(info.text);
            this.popup.setVisible(true);
            this.popups.splice(0, 1);
            audioManager.playInfo();

            let iconToDestroy = null;
            if (info.icon) {
                iconToDestroy = this.engine.add.sprite(this.popup.thumb.x, this.popup.thumb.y, info.icon);
                const scale = VisualData.getGameSettings().popup_image_scale;
                if (scale)
                    iconToDestroy.setScale(scale);
                this.popup.add(iconToDestroy);
                this.popup.thumb.setVisible(false);
            } else
                this.popup.thumb.setVisible(true);

            this.popupTimer = setTimeout(()=>{
                this.popup.setVisible(false);

                if (iconToDestroy)
                    iconToDestroy.destroy(true);

                setTimeout(()=> {
                    this.popupTimer = null;
                    this._checkForNewPopup();
                }, 500);
            }, 2000);
        }
    }

    showPopup(text, icon) {
        if (this.popups.length <= 1) {
            this.popups.push({
                text: text,
                icon: icon
            });

            if (!this.popupTimer)
                this._checkForNewPopup();
        }
    }

    createPopup(engine) {
        this.popups = [];
        this.popup = engine.add.container();
        const back = engine.add.sprite(0, 0, 'Popup').setOrigin(0, 0.5);
        this.popup.thumb = engine.add.sprite(-10 * GlobalScale, -20 * GlobalScale, 'PopupThumbsUp');
        this.popup.textLabel = engine.add.text(50 * GlobalScale, 0, '+100%', DefaultFontSmall2).setOrigin(0, 0.5);
        this.popup.add(back);
        this.popup.add(this.popup.thumb);
        this.popup.add(this.popup.textLabel);

        this.popup.setPosition(RealScreenWidth - back.width * imagesDeltaScale - 100 * GlobalScale, RealScreenHeight * 0.4);
        this.popup.setDepth(WinDefaultDepth + 1000);
        this.popup.setVisible(false);

        eventManager.onUpgradePurchased.addListener(()=>{
            this.showPopup(LocalizationManager.getLocalizization("PopupMarketUpgrade"));
        });
        eventManager.onMacroUpgraded.addListener((building, bonus)=>{
            let text = "Unknown";
            switch (bonus.upgradeType) {
                case 'SpeedUp':
                    text = LocalizationManager.getLocalizization("PopupSpeedUpMacro");
                    break;
                case 'MultiProfit':
                    text = LocalizationManager.getLocalizization("PopupMultiprofitMacro").format(bonus.parameter);
                    break;
            }
            LoadFile(this.engine, building.getSmallIcon(), building.getSmallIconPath(), () => {
                this.showPopup(text, building.getSmallIcon());
            });
        });

        eventManager.onBoxReceived.addListener((amount) => {
            this.showPopup(LocalizationManager.getLocalizization("PopupBox").format(amount));
        });
    }

    onWindowsClosed(window) {
        const wins = this.activeWindows;
        if (wins[wins.length - 1] === window) {
            wins.pop();
            if (wins.length > 0)
                wins[wins.length - 1].setWindowVisible(true);
        } else {
            for (let i in wins) {
                if (wins[i] === window) {
                    wins.splice(i, 1);
                    break;
                }
            }
        }

        this._checkForProduction();
    }

    _checkForProduction() {
        const wins = this.activeWindows;
        const type = this.getActiveWindow().winType;
        const showGUI = wins.length === 1;
        const show = showGUI || type == WindowType.WinBossProccess || type == WindowType.WinZoomIn;

        visualGame.setBuildingsProductionVisible(gameInit.selectedWorld, show);
        visualGame.setGameObjectsVisible(showGUI);

        if (type != WindowType.WinUpgrade && (type != WindowType.QuestBubble || this.guiMode !== GUIMode.UpgradeBuildings))
            this.allWindows[WindowType.WinBuildings].showNormal(showGUI, false, false, gameInit.selectedWorld);

        if (type === WindowType.WinMain) {
            this.checkForTutorialPhrase();
        } else
            this.hideTutorialText();
    }

    showTimeTravel(minutes, image) {
        const windowType = WindowType.WinTimeTravel;
        const win = this.allWindows[windowType];
        win.setTravelTime(minutes, image);
        this.openNewWindow(windowType);
    }

    openGemsStore() {
        const windowType = WindowType.WinStore;
        const win = this.allWindows[windowType];
        win.setGemsPage();
        this.openNewWindow(windowType);
    }

    openGuardsTab() {
        const windowType = WindowType.WinPuzzle;
        const win = this.allWindows[windowType];
        win.setGuardsPage();
        this.openNewWindow(windowType);
    }

    getWinTypeAtTheTop() {
        return this.activeWindows[this.activeWindows.length - 1].winType;
    }

    getActiveWindow() {
        return this.activeWindows[this.activeWindows.length - 1];
    }

    getWindowByType(windowType) {
        return this.allWindows[windowType];
    }

    openNewWindow(windowType, closePrevious, preserveWindow) {
        const wins = this.activeWindows;
        const win = this.allWindows[windowType];

        if (win === wins[wins.length - 1])
            return win;

        if (closePrevious) {
            wins[wins.length - 1].closeWindow();
            return this.openNewWindow(windowType, false);
        }
        else {
            if (!preserveWindow)
                wins[wins.length - 1].setWindowVisible(false);
        }

        win.setWindowVisible(true);
        wins.push(win);

        this._checkForProduction();
        return win;
    }

    isNormalMode() {
        return this.guiMode === GUIMode.Normal;
    }

    changeMode(newMode) {
        const worldID = gameInit.selectedWorld;
        this.guiMode = newMode;
        this.onModeChanged.callListeners(this.guiMode, worldID);

        // visualGame.setBuildingsProductionVisible(worldID, this.guiMode !== GUIMode.UpgradeBuildings);

        switch (newMode) {
            case GUIMode.UpgradeBuildings:
            case GUIMode.Likes:
                this.openNewWindow(WindowType.WinUpgrade);
                break;
            case GUIMode.Boss:
                audioManager.playWorldMusic(0);
                gameInit.progress.harvestStarted();
                this.createHarvestAnimation();
                this.openNewWindow(WindowType.WinBossProccess);
                this.harvestBuildings = visualGame.prepareForHarvest();
                break;
        }
    }

    createHarvestAnimation() {
        if (!VisualData.FACTORY_WORKING)
            return;

        PrepareAndCreateObject(VisualData.FACTORY_WORKING, null, this.engine, OverlayDepth + WinDefaultDepth, (splitAnimation) => {
            this.harvesting = splitAnimation;
            if (this.guiMode !== GUIMode.Boss)
                this.stopHarvestingAnimation();
            else
                this.harvesting.obj.setPosition(this.harvesting.obj.x / localScale, this.harvesting.obj.y / localScale + 774 * GlobalScale);
        });
    }

    stopHarvestingAnimation() {
        if (this.harvesting) {
            this.harvesting.destroy(true);
            this.harvesting = null;
        }
    }

    localize() {
        for (let i in this.allWindows)
            this.allWindows[i].localize();
    }

    create(engine) {
        this.engine = engine;
        this.onCreate.callListeners(engine);

        for (let i in this.allWindows)
            this.allWindows[i].localize();

        this.activeWindows[0].setWindowVisible(true);

        gameInit.progress.onPuzzlePeaceReceived.addListener(this.puzzleReceived.bind(this));
        gameInit.progress.onUpgradePurchased.addListener(this.upgradePurchased.bind(this));

        const set = VisualData.getGameSettings();

        this.tutorialLabel = engine.add.text(VisualData.MAP_PARAMS.center.x, RealScreenHeight - (set.tut_phrase_y || 0) * GlobalScale, null, (typeof TutorialFont !== 'undefined') ? TutorialFont : DefaultFontBig)
            .setOrigin(0.5, 1)
            .setWordWrapWidth(2000 * GlobalScale)
            .setDepth(WinDefaultDepth - 2000);
        this.hideTutorialText();

        this.createPopup(engine);
    }

    checkForTutorialPhrase() {
        if (this.tutorialLabel.text)
            this.tutorialLabel.setVisible(true);
    }

    setTutorialPhrase(text) {
        this.tutorialLabel.setText(text);
        this.tutorialLabel.setVisible(text != null && this.getActiveWindow().winType == WindowType.WinMain);
    }

    hideTutorialText(){
        this.tutorialLabel.setVisible(false);
    }

    upgradePurchased(bonus) {
        switch (bonus.upgradeType) {
            case 'TimeTravel':
                this.showTimeTravel(bonus.parameter / 60, WinStore.getImageName(bonus));
                break;
        }
    }

    puzzleReceived(prevImg, imageId, piece, duplicate, boxType){
        const win = this.openNewWindow(WindowType.WinDropPuzzle);
        win.dropPuzzle(prevImg, imageId, piece, duplicate, boxType);
    }

    buildingUpgraded(world, building) {
        this.onBuildingUpgraded.callListeners(world, building, this.engine);
    }

    buildingCreated(world, building) {
        this.onBuildingCreated.callListeners(world, building, this.engine);
    }

    buildingLiked(world, building) {
        this.onBuildingLiked.callListeners(world, building, this.engine);
    }

    buildingUpdated(world, building) {
        this.onBuildingUpdated.callListeners(world, building, this.engine);
    }

    buildingResourcesUpdated(world, building) {
        this.onBuildingResourcesUpdated.callListeners(world, building);
    }

    tryToUpgradeBuilding(buildingInterface) {
        if (gameInit.progress.isResourcesEnough(buildingInterface.getUpgradePrice())) {
            buildingInterface.upgradeBuilding();
        }
    }

    tryToConstructBuilding(buildingInterface) {
        if (gameInit.progress.isSupervisorActive())
            return;

        if (gameInit.progress.isResourcesEnoughForConstruction(buildingInterface)) {
            const win = this.openNewWindow(WindowType.WinConstruct);
            win.setInfo(buildingInterface);
        }
    }

    buildingClicked(buildingInterface) {
        // console.log("buildingClicked " + this.guiMode + " : " + buildingInterface.harvest);
        switch (this.guiMode) {
            case GUIMode.Normal: {
                if (buildingInterface.getLevel() === 0)
                    this.tryToConstructBuilding(buildingInterface);
                else
                    buildingInterface.buildingWasClicked();
                break;
            }
            case GUIMode.UpgradeBuildings:
                if (buildingInterface.getLevel() > 0)
                    this.tryToUpgradeBuilding(buildingInterface);
                break;
            case GUIMode.Boss:
                if (!buildingInterface.harvest) {
                    this.harvestBuildings--;
                    if (!this.harvestBuildings) {
                        this.changeMode(GUIMode.Normal);

                        gameInit.harvestCompleted();
                        this.stopHarvestingAnimation();
                        this.onReset.callListeners();
                        audioManager.playWorldMusic(1);
                    }
                }
                break;
        }
    }
}

const guiManager = new GUIManager(gameInit);

const tutorial = new Tutorial();
gameInit.create.addListener(tutorial.onCreated.bind(tutorial));
if (!VisualData.getGameSettings().no_tutorial) {
    eventManager.onAdStarted.addListener(tutorial.onAdStarted.bind(tutorial));
    eventManager.onFortuneWheelUsed.addListener(tutorial.onAdStarted.bind(tutorial));
    gameInit.loaded.addListener((progress) => tutorial.loaded(progress));
}

'use strict';

VisualData.MAP_PARAMS.center = {
    x: RealScreenWidth /2,
    y: RealScreenHeight /2,
};

const renderType = Phaser.WEBGL;
// const renderType = Phaser.CANVAS;

const remotePluginPath = 'https://unnyhog.github.io/';

let config = {
    type: renderType,
    parent: 'phaser-app',

    audio: {
        disableWebAudio: true
    },

    width: gameW,
    height: gameH,
    // autoRound: false,
    // fps: {
    //     target: 30,
    //     min: 2,
    //     max: 30,
    //     forceSetTimeOut: true
    // },
    // render: {
    //     antialias: true
    // },

    autoRound: false,
    scale: {
        // parent: 'phaser-app',
        // mode: Phaser.DOM.NONE,
        // mode: Phaser.Scale.FIT,
        // autoCenter: Phaser.Scale.CENTER_BOTH,
        width: gameW,
        height: gameH,
        zoom: 1 / dpi,
    },
    plugins: {
        // global: [ NineSlice.Plugin.DefaultCfg ]
        global: [ NineSlice.Plugin.DefaultCfg ]
    },
    scene: {
        preload: preload,
        create: create,
        update: update,
        pack: {
            files: [
                {
                    type: 'scenePlugin',
                    key: renderType === Phaser.WEBGL ? 'SpineWebGLPlugin' : 'SpineCanvasPlugin',
                    url: remotePluginPath + (renderType === Phaser.WEBGL ? 'plugins/SpineWebGLPlugin.js' : 'plugins/SpineCanvasPlugin.js'),
                    sceneKey: 'spine'
                },
                {
                    type: 'scenePlugin',
                    key: 'rexuiplugin',
                    url: remotePluginPath + 'plugins/rexuiplugin.min.js',
                    sceneKey: 'rexUI'
                }
            ]
        },
    }
};

function preload1() {

}

function create1() {
console.warn("1111122");
}

function update1() {

}

let gBase = null;

const loadingImage = window.document.getElementById("progress-fill");
let lastVal = 0;
const ScreenSize = {
    width: gameW / dpi,
    height: gameH / dpi
};


const loadingSplash = window.document.getElementById("loading-div");
loadingSplash.style.width = ScreenSize.width + 'px';
loadingSplash.style.height = ScreenSize.height + 'px';

const divElementForLabels = window.document.getElementById("labels-div");
divElementForLabels.style.width = ScreenSize.width + 'px';
divElementForLabels.style.height = ScreenSize.height + 'px';

if (!useNewScale)
    config.scale.zoom = Math.min(window.innerHeight / RealScreenHeight, window.innerWidth / RealScreenWidth);

let game = null;
let GlobalGameLink;
// let game = new Phaser.Game({
//     type: Phaser.WEBGL,
//     parent: 'phaser-example',
//     scene1: {
//         preload: preload,
//         create: create,
//         update: update
//     }
// });

const atlasPath = VisualData.getAtlasFullPath();
if (atlasPath) {
    readTextFile(atlasPath, (json) => {
        if (!game) {
            GameData.prepareAtlases(json ? JSON.parse(json) : null);
            GlobalGameLink = game = new Phaser.Game(config);
        }
    });
} else {
    if (!game) {
        GameData.prepareAtlases(null);
        GlobalGameLink = game = new Phaser.Game(config);
    }
}

function readTextFile(file, callback) {
    var rawFile = new XMLHttpRequest();
    rawFile.overrideMimeType("application/json");
    rawFile.open("GET", file, true);
    rawFile.onreadystatechange = function() {
        if (rawFile.status == "200") {
            if (rawFile.readyState === 4) {
                callback(rawFile.responseText);
            }
        }else {
            // console.error(rawFile);
            callback(null);
        }
    };
    rawFile.send(null);
}

function preload () {
    this.load.on('progress', function (value) {
        if (value > lastVal) {
            loadingImage.style.width = (value * 30) + '%';
            lastVal = value;
        }
    });

    gameInit.GamePreload(this);
}

function PlayRewardedAd(doneCallback, dontSkipForTut) {
    if (!socialManager)
        return;

    function onNoAds() {
        guiManager.openNewWindow(WindowType.WinNoAdd);
        guiManager.getWindowByType(WindowType.WinNoAdd).setCallback(doneCallback);
    }

    function onAdBlock() {
        guiManager.openNewWindow(WindowType.WinAdBLock);
        guiManager.getWindowByType(WindowType.WinAdBLock).setCallback(doneCallback);
    }

    function onCompleted() {
        audioManager.unMuteSounds();
        unlockAnimatedObject();
        unlockGUI();
        doneCallback();
    }

    function onStarted() {
        eventManager.adStarted();
        audioManager.muteSounds();
        GlobalInputLocked = true;
        lockGuiEverything();
    }

    const tutCompleted = gameInit.progress.isTutorialCompleted() || dontSkipForTut;

    const callbacks = {
        onCompleted: onCompleted,
        onNoAds: tutCompleted ? onNoAds : onCompleted,
        onAdBlock: tutCompleted ? onAdBlock : onCompleted,
        onStarted: onStarted
    };

    socialManager.playRewardedAd(callbacks);
}

const DefaultWidth = 500;

function UpdateTextPosition(text) {
    if (!text.newText)
        return;

    if (text.newText.style.visibility === 'hidden' || divElementForLabels.style.display === 'none') {
        text.needToUpdate = true;
        return;
    }

    const style = text.newText.style;
    let x = text.x;
    let y = text.y;
    if (text.parent) {
        x += text.parent.x;
        y += text.parent.y;
    }
    style.left = (x / dpi - text.newText.clientWidth * text.originX) + "px";
    style.top = (y / dpi - text.newText.clientHeight * (text.originY)) + "px";

    text.onTextPositionUpdated.callListeners();
}

function prepareTextToHtml(engine) {

    //Text
    const oldTextPosition = Phaser.GameObjects.Text.prototype.setPosition;
    function newTextPosition(x, y) {
        oldTextPosition.call(this, x * localScale, y * localScale);
        UpdateTextPosition(this);
        return this;
    }

    const oldTextWrap = Phaser.GameObjects.Text.prototype.setWordWrapWidth;
    function newTextWrap(width) {
        if (this.newText)
            this.newText.style.maxWidth = (width * localScale / dpi) + "px";
        else
            width *= 2;
        return oldTextWrap.call(this, width * localScale);
    }

    const oldSetVisible = Phaser.GameObjects.Text.prototype.setVisible;
    function newSetVisible(visible) {
        if (this.newText) {
            if (visible) {
                if (!this.newText.timer) {
                    this.newText.timer = setTimeout(() => {
                        this.newText.style.visibility = 'visible';
                        if (this.needToUpdate) {
                            UpdateTextPosition(this);
                            this.fitText();
                            this.needToUpdate = false;
                        }
                        this.newText.timer = null;
                    }, 200);
                }
            }
            else {
                this.newText.style.visibility = 'hidden';
                if (this.newText.timer) {
                    clearInterval(this.newText.timer);
                    this.newText.timer = null;
                }
            }
        }
        return oldSetVisible.call(this, visible);
    }

    function newIsVisible() {
        if (this.newText)
            return this.newText.style.visibility === 'visible';
        return this.visible;
    }

    const oldTest = engine.add.text;
    function newText(x, y, name, style) {
        const t = oldTest.call(this, x, y, null).setScale(1);
        const element = document.createElement("div");
        element.innerText = name;
        element.className = "myp";
        // element.style.font = style.font2;
        element.style.fontSize = style.font2;
        element.style.color = style.fill;
        // element.style.fontWeight = "bolder";
        element.style.webkitTextStrokeColor = style.stroke;
        element.style.webkitTextStrokeWidth = Math.trunc(style.strokeThickness / 3) + "px";
        if (style.align)
            element.style.textAlign = style.align;
        if (style.lineSpacing)
            element.style.lineHeight = "0.95";
        divElementForLabels.appendChild(element);

        t.newText = element;
        t.renderFlags = 0;

        t.onTextPositionUpdated = new UnnyAction();
        UpdateTextPosition(t);
        return t;
    }

    const oldSetText = Phaser.GameObjects.Text.prototype.setText;
    Phaser.GameObjects.Text.prototype.setText = function(text) {
        if (text === this.text)
            return this;
        if (this.newText) {
            this.newText.innerText = text;
            UpdateTextPosition(this);
            this.fitText();
        }
        return oldSetText.call(this, text);
    };

    const oldSetOrigin = Phaser.GameObjects.Text.prototype.setOrigin;
    function newSetOrigin(x, y) {
        oldSetOrigin.call(this, x, y);
        UpdateTextPosition(this);
        return this;
    }

    engine.add.text = newText.bind(engine.add);
    Phaser.GameObjects.Text.prototype.setPosition = newTextPosition;
    Phaser.GameObjects.Text.prototype.setWordWrapWidth = newTextWrap;
    Phaser.GameObjects.Text.prototype.setVisible = newSetVisible;
    Phaser.GameObjects.Text.prototype.setOrigin = newSetOrigin;
    Phaser.GameObjects.Text.prototype.getWidth = function() {
        return this.newText? this.newText.clientWidth : this.width;
    };
    Phaser.GameObjects.Text.prototype.getInnerWidth = function() {
        const width = this.newText && this.newText.childNodes[0] && this.newText.childNodes[0].clientWidth;
        return (width || this.newText.clientWidth || this.width) * dpi / localScale;
    };
    Phaser.GameObjects.Text.prototype.isVisible = newIsVisible;


    function newTextOld(x, y, text, font) {
        return oldTest.call(this, x, y, text, font).setScale(0.5, 0.5);
    }
    engine.add.textOld = newTextOld.bind(engine.add);

    Phaser.GameObjects.Text.prototype.fitText = function() {
        if (this.newText && (this.newText.style.visibility === 'hidden' || divElementForLabels.style.display === 'none')) {
            this.needToUpdate = true;
            return;
        }

        if (this.newText && this.fittingWidth && this.newText.innerText) {
            this.newText.style.width = this.fittingWidth + "px";
            this.newText.style.height = this.fittingHeight + "px";

            if (this.fittingWidth > 1)
                textFit(this.newText);
        }
    };

    Phaser.GameObjects.Text.prototype.setFitSize = function(width, height) {
        if (!this.fittingWidth)
            this.newText.className += " myp-fit";
        this.fittingWidth = width * localScale / dpi;
        this.fittingHeight = height * localScale / dpi;
        this.fitText();
        return this;
    }
}

function overloadSetVisible(object) {
    const oldSetVisible = object.setVisible;
    function newSetVisible(visible) {
        if (!this.clickable)
            this.setActive(visible);
        return oldSetVisible.call(this, visible);
    }
    object.setVisible = newSetVisible;
}

function create ()
{
    const engine = this;
    const cachedAdd = this.add;

    const oldContainerPosition = Phaser.GameObjects.Container.prototype.setPosition;
    function newContainerPosition(x, y) {
        oldContainerPosition.call(this, x ? x * localScale : x, y ? y * localScale : y);
        for (let i = 0; i < this.list.length; i++)
            UpdateTextPosition(this.list[i]);
        return this;
    }
    Phaser.GameObjects.Container.prototype.setPosition = newContainerPosition;

    Phaser.GameObjects.Container.prototype.setPositionX = function(x) {
        this.x = x * localScale;
        for (let i = 0; i < this.list.length; i++)
            UpdateTextPosition(this.list[i]);
        return this;
    };

    Phaser.GameObjects.Container.prototype.setPositionY = function(y) {
        this.y = y * localScale;
        for (let i = 0; i < this.list.length; i++)
            UpdateTextPosition(this.list[i]);
        return this;
    };

    const oldSetVisible = Phaser.GameObjects.Container.prototype.setVisible;
    function newSetVisible(visible) {
        for (let i = 0; i < this.list.length; i++) {
            if (!this.list[i].forceInvisible)
                this.list[i].setVisible(visible);
        }
        return oldSetVisible.call(this, visible);
    }
    Phaser.GameObjects.Container.prototype.setVisible = newSetVisible;

    const oldAddChild = Phaser.GameObjects.Container.prototype.add;
    function newAddChild(obj) {
        if (obj.type === 'Text') {
            if (!this.visible)
                obj.setVisible(this.visible);
            obj.parent = this;
            UpdateTextPosition(obj);
        }
        return oldAddChild.call(this, obj);
    }
    Phaser.GameObjects.Container.prototype.add = newAddChild;

    // const oldContainerScale = Phaser.GameObjects.Container.prototype.setScale;
    // function newContainerScale(x, y) {
    //     return oldContainerScale.call(this, x ? x * localScale : x, y ? y * localScale : y);
    // }
    // Phaser.GameObjects.Container.prototype.setScale = newContainerScale;

    Phaser.GameObjects.Container.prototype.create = function (x, y, name) {
        const image = engine.add.sprite(x, y, name);
        this.add(image);
        return image;
    };

    Phaser.GameObjects.Group.prototype.create = function (x, y, name) {
        const image = engine.add.sprite(x, y, name);
        this.add(image);
        return image;
    };

    Phaser.GameObjects.Group.prototype.setVisible = function (visible) {
        this.visible = visible;
        return this;
    };

    engine.add.myNineSlice = function (x, y, info) {
        const width = info.width * GlobalScale / imagesDeltaScale;
        const height = info.height * GlobalScale / imagesDeltaScale;
        const nineSliceInfo = VisualData.ALL_OBJECTS[info.name];
        const paddingX = nineSliceInfo.paddingX * GlobalScale / imagesDeltaScale;
        const paddingY = nineSliceInfo.paddingY * GlobalScale / imagesDeltaScale;
        const dy = (info.y || 0) * GlobalScale;
        const obj = engine.add.nineslice(
            x * localScale, (y + dy) * localScale,             // this is the starting x/y location
            width, height,         // the width and height of your object
            info.name,             // a key to an already loaded image
            paddingX,              // the width and height to offset for a corner slice
            paddingY               // (optional) pixels to offset when computing the safe usage area
        );

        const prot = obj.constructor.prototype;
        if (!prot.scalePrepared) {
            prot.scalePrepared = true;

            overloadSetVisible(prot);

            // const oldPosition1 = prot.setPosition;
            // function newPosition1(x, y) {
            //     return oldPosition1.call(this, x ? x * localScale : x, y ? y * localScale : y);
            // }

            const oldScale1 = prot.setScale;
            function newScale1(x, y) {
                return oldScale1.call(this, x * imageSizeLocalScale, y ? y * imageSizeLocalScale : y);
            }

            // prot.setPosition = newPosition1;
            prot.setScale = newScale1;
        }

        obj.setScale(1);

        return obj;
    };

    if (useNewScale) {
        //Sprites
        const oldSetPosition = Phaser.GameObjects.Sprite.prototype.setPosition;
        function newSetPosition(x, y) {
            return oldSetPosition.call(this, x * localScale, y * localScale);
        }

        const oldSetScale = Phaser.GameObjects.Sprite.prototype.setScale;
        function newSetScale(x, y) {
            return oldSetScale.call(this, x * imageSizeLocalScale, y ? y * imageSizeLocalScale : y);
        }

        const oldSprite = this.add.sprite;
        let spritesCount = 0;
        function newSprite(x, y, name) {
            // spritesCount++;
            // console.log("spritesCount " + spritesCount + " > " + name);
            const obj = VisualData.ALL_OBJECTS[name];
            if (obj) {
                if (GameData.getAtlasName(obj))
                    return oldSprite.call(cachedAdd, x, y, 'atlas_sprites', obj.file).setScale(1);
            }
            return oldSprite.call(cachedAdd, x, y, name).setScale(1);
            // return oldSprite.call(cachedAdd, x, y, "MM_Btn_Login").setScale(1);
        }

        this.add.sprite = newSprite.bind(this.add);
        Phaser.GameObjects.Sprite.prototype.setPosition = newSetPosition;
        Phaser.GameObjects.Sprite.prototype.setPositionX = function(x) {
            return this.x = x * localScale;
        };
        Phaser.GameObjects.Sprite.prototype.setPositionY = function(y) {
            return this.y = y * localScale;
        };
        Phaser.GameObjects.Sprite.prototype.setScale = newSetScale;
        Phaser.GameObjects.Sprite.prototype.setScale2 = newSetScale;
        Phaser.GameObjects.Sprite.prototype.setForceInvisible = function(invisible) {
            this.forceInvisible = invisible;
            this.visible = !invisible;
        };

        overloadSetVisible(Phaser.GameObjects.Text.prototype);//Old text

        prepareTextToHtml(engine);

        overloadSetVisible(Phaser.GameObjects.Sprite.prototype);
        // overloadSetVisible(Phaser.GameObjects.Group.prototype);
        overloadSetVisible(Phaser.GameObjects.Container.prototype);
        overloadSetVisible(Phaser.GameObjects.Text.prototype);//New text
    }

    gameInit.GameCreate(this, () => {
        loadingSplash.style.display = 'none';

        setInterval(()=>{
            if (gBase)
                gBase.userInputBeenDone();
        }, 60000);
    });

    gameTrail = new GameTrail(gameInit);

    window.addEventListener('wheel',function(event){
        event.preventDefault();
        eventManager.mouseWheel(event.deltaX, event.deltaY);
        return false;
    }, { passive: false });

    // const pp = window.document.getElementById("phaser-app");
    // const divp = document.createElement("p");
    // const sstyle = divp.style;
    // sstyle.position = "fixed";
    // sstyle.left = '50px';
    // sstyle.top = '50px';
    // divp.innerHTML = "Width = " + window.innerWidth + " ; height = " + window.innerHeight;
    // pp.appendChild(divp);
}

function update () {
    gameInit.GameUpdate(this);
}

