!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.UnnyNet=t():e.UnnyNet=t()}(window,(function(){return function(e){var t=window.webpackHotUpdateUnnyNet;window.webpackHotUpdateUnnyNet=function(e,n){!function(e,t){if(g[e]&&b[e]){for(var n in b[e]=!1,t)Object.prototype.hasOwnProperty.call(t,n)&&(h[n]=t[n]);0==--y&&0===m&&O()}}(e,n),t&&t(e,n)};var n,a=!0,o="9277ec6077d1c95b8eac",r=1e4,i={},u=[],l=[];function s(e){var t=C[e];if(!t)return R;function a(a){return t.hot.active?(C[a]?-1===C[a].parents.indexOf(e)&&C[a].parents.push(e):(u=[e],n=a),-1===t.children.indexOf(a)&&t.children.push(a)):(console.warn("[HMR] unexpected require("+a+") from disposed module "+e),u=[]),R(a)}function o(e){return{configurable:!0,enumerable:!0,get:function(){return R[e]},set:function(t){R[e]=t}}}for(var r in R)Object.prototype.hasOwnProperty.call(R,r)&&"e"!==r&&"t"!==r&&Object.defineProperty(a,r,o(r));return a.e=function(e){return"ready"===d&&f("prepare"),m++,R.e(e).then(t,(function(e){throw t(),e}));function t(){m--,"prepare"===d&&(_[e]||P(e),0===m&&0===y&&O())}},a.t=function(e,t){return 1&t&&(e=a(e)),R.t(e,-2&t)},a}var c=[],d="idle";function f(e){d=e;for(var t=0;t<c.length;t++)c[t].call(null,e)}var p,h,v,y=0,m=0,_={},b={},g={};function k(e){return+e+""===e?+e:e}function w(e){if("idle"!==d)throw new Error("check() is only allowed in idle status");return a=e,f("check"),function(e){return e=e||1e4,new Promise((function(t,n){if("undefined"==typeof XMLHttpRequest)return n(new Error("No browser support"));try{var a=new XMLHttpRequest,r=R.p+""+o+".hot-update.json";a.open("GET",r,!0),a.timeout=e,a.send(null)}catch(e){return n(e)}a.onreadystatechange=function(){if(4===a.readyState)if(0===a.status)n(new Error("Manifest request to "+r+" timed out."));else if(404===a.status)t();else if(200!==a.status&&304!==a.status)n(new Error("Manifest request to "+r+" failed."));else{try{var e=JSON.parse(a.responseText)}catch(e){return void n(e)}t(e)}}}))}(r).then((function(e){if(!e)return f("idle"),null;b={},_={},g=e.c,v=e.h,f("prepare");var t=new Promise((function(e,t){p={resolve:e,reject:t}}));return h={},P(0),"prepare"===d&&0===m&&0===y&&O(),t}))}function P(e){g[e]?(b[e]=!0,y++,function(e){var t=document.createElement("script");t.charset="utf-8",t.src=R.p+""+e+"."+o+".hot-update.js",document.head.appendChild(t)}(e)):_[e]=!0}function O(){f("ready");var e=p;if(p=null,e)if(a)Promise.resolve().then((function(){return A(a)})).then((function(t){e.resolve(t)}),(function(t){e.reject(t)}));else{var t=[];for(var n in h)Object.prototype.hasOwnProperty.call(h,n)&&t.push(k(n));e.resolve(t)}}function A(t){if("ready"!==d)throw new Error("apply() is only allowed in ready status");var n,a,r,l,s;function c(e){for(var t=[e],n={},a=t.map((function(e){return{chain:[e],id:e}}));0<a.length;){var o=a.pop(),r=o.id,i=o.chain;if((l=C[r])&&!l.hot._selfAccepted){if(l.hot._selfDeclined)return{type:"self-declined",chain:i,moduleId:r};if(l.hot._main)return{type:"unaccepted",chain:i,moduleId:r};for(var u=0;u<l.parents.length;u++){var s=l.parents[u],c=C[s];if(c){if(c.hot._declinedDependencies[r])return{type:"declined",chain:i.concat([s]),moduleId:r,parentId:s};-1===t.indexOf(s)&&(c.hot._acceptedDependencies[r]?(n[s]||(n[s]=[]),p(n[s],[r])):(delete n[s],t.push(s),a.push({chain:i.concat([s]),id:s})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:n}}function p(e,t){for(var n=0;n<t.length;n++){var a=t[n];-1===e.indexOf(a)&&e.push(a)}}function y(){console.warn("[HMR] unexpected require("+P.moduleId+") to disposed module")}t=t||{};var m={},_=[],b={};for(var w in h)if(Object.prototype.hasOwnProperty.call(h,w)){var P;s=k(w);var O=!1,A=!1,E=!1,I="";switch((P=h[w]?c(s):{type:"disposed",moduleId:w}).chain&&(I="\nUpdate propagation: "+P.chain.join(" -> ")),P.type){case"self-declined":t.onDeclined&&t.onDeclined(P),t.ignoreDeclined||(O=new Error("Aborted because of self decline: "+P.moduleId+I));break;case"declined":t.onDeclined&&t.onDeclined(P),t.ignoreDeclined||(O=new Error("Aborted because of declined dependency: "+P.moduleId+" in "+P.parentId+I));break;case"unaccepted":t.onUnaccepted&&t.onUnaccepted(P),t.ignoreUnaccepted||(O=new Error("Aborted because "+s+" is not accepted"+I));break;case"accepted":t.onAccepted&&t.onAccepted(P),A=!0;break;case"disposed":t.onDisposed&&t.onDisposed(P),E=!0;break;default:throw new Error("Unexception type "+P.type)}if(O)return f("abort"),Promise.reject(O);if(A)for(s in b[s]=h[s],p(_,P.outdatedModules),P.outdatedDependencies)Object.prototype.hasOwnProperty.call(P.outdatedDependencies,s)&&(m[s]||(m[s]=[]),p(m[s],P.outdatedDependencies[s]));E&&(p(_,[P.moduleId]),b[s]=y)}var S,T=[];for(a=0;a<_.length;a++)s=_[a],C[s]&&C[s].hot._selfAccepted&&b[s]!==y&&T.push({module:s,errorHandler:C[s].hot._selfAccepted});f("dispose"),Object.keys(g).forEach((function(e){!1===g[e]&&function(e){delete installedChunks[e]}(e)}));for(var N,D,q=_.slice();0<q.length;)if(s=q.pop(),l=C[s]){var j={},F=l.hot._disposeHandlers;for(r=0;r<F.length;r++)(n=F[r])(j);for(i[s]=j,l.hot.active=!1,delete C[s],delete m[s],r=0;r<l.children.length;r++){var M=C[l.children[r]];M&&0<=(S=M.parents.indexOf(s))&&M.parents.splice(S,1)}}for(s in m)if(Object.prototype.hasOwnProperty.call(m,s)&&(l=C[s]))for(D=m[s],r=0;r<D.length;r++)N=D[r],0<=(S=l.children.indexOf(N))&&l.children.splice(S,1);for(s in f("apply"),o=v,b)Object.prototype.hasOwnProperty.call(b,s)&&(e[s]=b[s]);var U=null;for(s in m)if(Object.prototype.hasOwnProperty.call(m,s)&&(l=C[s])){D=m[s];var G=[];for(a=0;a<D.length;a++)if(N=D[a],n=l.hot._acceptedDependencies[N]){if(-1!==G.indexOf(n))continue;G.push(n)}for(a=0;a<G.length;a++){n=G[a];try{n(D)}catch(n){t.onErrored&&t.onErrored({type:"accept-errored",moduleId:s,dependencyId:D[a],error:n}),t.ignoreErrored||(U=U||n)}}}for(a=0;a<T.length;a++){var L=T[a];s=L.module,u=[s];try{R(s)}catch(a){if("function"==typeof L.errorHandler)try{L.errorHandler(a)}catch(n){t.onErrored&&t.onErrored({type:"self-accept-error-handler-errored",moduleId:s,error:n,originalError:a}),t.ignoreErrored||(U=U||n),U=U||a}else t.onErrored&&t.onErrored({type:"self-accept-errored",moduleId:s,error:a}),t.ignoreErrored||(U=U||a)}}return U?(f("fail"),Promise.reject(U)):(f("idle"),new Promise((function(e){e(_)})))}var C={};function R(t){if(C[t])return C[t].exports;var a=C[t]={i:t,l:!1,exports:{},hot:function(e){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:n!==e,active:!0,accept:function(e,n){if(void 0===e)t._selfAccepted=!0;else if("function"==typeof e)t._selfAccepted=e;else if("object"==typeof e)for(var a=0;a<e.length;a++)t._acceptedDependencies[e[a]]=n||function(){};else t._acceptedDependencies[e]=n||function(){}},decline:function(e){if(void 0===e)t._selfDeclined=!0;else if("object"==typeof e)for(var n=0;n<e.length;n++)t._declinedDependencies[e[n]]=!0;else t._declinedDependencies[e]=!0},dispose:function(e){t._disposeHandlers.push(e)},addDisposeHandler:function(e){t._disposeHandlers.push(e)},removeDisposeHandler:function(e){var n=t._disposeHandlers.indexOf(e);0<=n&&t._disposeHandlers.splice(n,1)},check:w,apply:A,status:function(e){if(!e)return d;c.push(e)},addStatusHandler:function(e){c.push(e)},removeStatusHandler:function(e){var t=c.indexOf(e);0<=t&&c.splice(t,1)},data:i[e]};return n=void 0,t}(t),parents:(l=u,u=[],l),children:[]};return e[t].call(a.exports,a,a.exports,s(t)),a.l=!0,a.exports}return R.m=e,R.c=C,R.d=function(e,t,n){R.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},R.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},R.t=function(e,t){if(1&t&&(e=R(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(R.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)R.d(n,a,function(t){return e[t]}.bind(null,a));return n},R.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return R.d(t,"a",t),t},R.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},R.p="",R.h=function(){return o},s(17)(R.s=17)}([function(e,t,n){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),t.Errors=void 0;function o(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var r=u(n(5)),i=u(n(9));function u(e){return e&&e.__esModule?e:{default:e}}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=t.Errors={NotInitialized:-1,Unknown:1,NotAuthorized:2,NoMessage:3,NoChannel:4,UnnynetNotReady:5,NoGameId:6,NoSuchLeaderboard:7,NoLeaderboardsForTheGame:8,NoAchievementsForTheGame:9,NoGuildsForTheGame:10,NotInGuild:11,NoSuchAchievement:12,WrongAchievementType:13,AchievementIsNotPublished:14,LeaderboardReportsTooOften:15,FailedToJoinChannel:16,NoAccessToken:1e3,StorageRequestsMadeTooOften:1001,NoSuchProduct:1002,StorageError:1003,UnityPurchasing_PurchasingUnavailable:1010,UnityPurchasing_NoProductsAvailable:1011,UnityPurchasing_AppNotKnown:1012,UnityPurchasing_ProductIsNotAvailable:1013,UnityPurchasing_PurchaseFailed:1014,Nutaku_Error:1100,PaymentFailed:1200},c=(function(e,t,n){t&&o(e.prototype,t),n&&o(e,n)}(d,null,[{key:"GetCommand",value:function(e){return d.jsCommands[e]}},{key:"getResponceData",value:function(e){var t={};return e.error?(t.success=!1,t.error=e.error):t.success=!0,e.data&&(t.data=e.data),t}},{key:"getErrorResponse",value:function(e,t){return{success:!1,error:{code:e,message:1<arguments.length&&void 0!==t?t:""}}}},{key:"getSuccessResponse",value:function(e){var t=0<arguments.length&&void 0!==e?e:null,n={success:!0};return t&&(n.data=t),n}},{key:"onCallback",value:function(e,t,n){var a;a=e?d.getErrorResponse(s.Unknown,e.status+":"+e.statusText):d.getSuccessResponse(t),n&&n(a)}},{key:"_onAuth",value:function(e){var t=e?e.accessToken:null,n=e?e.refreshToken:null;t&&(r.default.setToken(t),i.default.updateTokenForRequests(t)),n&&r.default.setRefreshToken(n)}},{key:"onAuthCallback",value:function(e,t,n){var a=void 0;e?a=d.getErrorResponse(s.Unknown,e.status+":"+e.statusText):(a=d.getSuccessResponse(t),d._onAuth(t)),n&&n(a)}}]),d);function d(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d)}c.Command={OpenLeaderBoards:1,OpenAchievements:2,OpenFriends:3,OpenChannel:4,OpenGuilds:5,OpenMyGuild:6,SetSafeArea:7,SendMessage:20,UnnyNetWasOpened:30,ReportLeaderboardScoresAsync:40,ReportAchievementProgressAsync:41,AddGuildExperience:60,RequestFailed:70,RequestSucceeded:71,RequestReply:72,SetKeyboardOffset:80,SetConfig:81,SetDefaultChannel:82,AuthorizeWithCredentials:100,AuthorizeAsGuest:101,AuthorizeWithCustomId:102,ForceLogout:110,GetGuildInfo:120,GetAchievementsInfo:130,GetPlayerPublicInfo:140,GetLeaderboardScores:150,JoinPrivateChannel:160,LeaveAllPrivateChannels:161},c.jsCommands=(l(a={},c.Command.OpenLeaderBoards,"window.globalReactFunctions.apiOpenLeaderboards();"),l(a,c.Command.OpenAchievements,"window.globalReactFunctions.apiOpenAchievements();"),l(a,c.Command.OpenFriends,"window.globalReactFunctions.apiOpenFriends();"),l(a,c.Command.OpenChannel,"window.globalReactFunctions.apiOpenChannel('{0}');"),l(a,c.Command.OpenGuilds,"window.globalReactFunctions.apiOpenGuilds();"),l(a,c.Command.OpenMyGuild,"window.globalReactFunctions.apiOpenMyGuild();"),l(a,c.Command.SendMessage,"window.globalReactFunctions.apiSendMessage('{0}', '{1}');"),l(a,c.Command.UnnyNetWasOpened,"window.globalReactFunctions.apiUnnyNetWasOpened();"),l(a,c.Command.ReportLeaderboardScoresAsync,"window.globalReactFunctions.apiReportLeaderboardScoresAsync(<*id*>, '{0}', {1}, '{2}');"),l(a,c.Command.ReportAchievementProgressAsync,"window.globalReactFunctions.apiReportAchievementProgressAsync(<*id*>, {0}, {1});"),l(a,c.Command.AddGuildExperience,"window.globalReactFunctions.apiAddGuildExperience('{0}');"),l(a,c.Command.RequestFailed,"window.globalReactFunctions.requestFailed('{0}', \"{1}\");"),l(a,c.Command.RequestSucceeded,"window.globalReactFunctions.requestSucceeded('{0}');"),l(a,c.Command.RequestReply,"window.globalReactFunctions.requestReply('{0}', '{1}');"),l(a,c.Command.SetKeyboardOffset,"window.globalReactFunctions.apiSetKeyboardOffset('{0}');"),l(a,c.Command.SetConfig,"window.globalReactFunctions.apiSetConfig('{0}');"),l(a,c.Command.SetDefaultChannel,"window.globalReactFunctions.apiSetDefaultChannel('{0}');"),l(a,c.Command.AuthorizeWithCredentials,"window.globalReactFunctions.apiAuthWithCredentials('{0}', '{1}', '{2}');"),l(a,c.Command.AuthorizeAsGuest,"window.globalReactFunctions.apiAuthAsGuest('{0}');"),l(a,c.Command.AuthorizeWithCustomId,"window.globalReactFunctions.apiAuthWithCustomId('{0}', '{1}');"),l(a,c.Command.ForceLogout,"window.globalReactFunctions.apiForceLogout();"),l(a,c.Command.GetGuildInfo,"window.globalReactFunctions.apiGetGuildInfo(<*id*>, {0});"),l(a,c.Command.SetSafeArea,"window.globalReactFunctions.apiSetSafeArea({0}, {1}, {2}, {3});"),l(a,c.Command.GetAchievementsInfo,"window.globalReactFunctions.apiGetAchievementsInfo(<*id*>);"),l(a,c.Command.GetPlayerPublicInfo,"window.globalReactFunctions.apiGetPlayerPublicInfo(<*id*>);"),l(a,c.Command.GetLeaderboardScores,"window.globalReactFunctions.apiGetLeaderboardScores(<*id*>, '{0}');"),l(a,c.Command.JoinPrivateChannel,"window.globalReactFunctions.apiJoinPrivateChannel(<*id*>, '{0}', '{1}');"),l(a,c.Command.LeaveAllPrivateChannels,"window.globalReactFunctions.apiLeaveAllPrivateChannels(<*id*>);"),a),t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var r=m(n(18)),i=m(n(13)),u=n(0),l=m(u),s=m(n(14)),c=m(n(19)),d=(m(n(8)),m(n(2))),f=m(n(6)),p=m(n(21)),h=m(n(16)),v=m(n(10)),y=m(n(5));function m(e){return e&&e.__esModule?e:{default:e}}String.prototype.format||(String.prototype.format=function(){var e=arguments;return this.replace(/{(\d+)}/g,(function(t,n){return void 0!==e[n]?e[n]:t}))});var _=d.default.Environment.Development,b=(a(g,null,[{key:"initialize",value:function(e){new g(e)}}]),a(g,[{key:"_prepareConfig",value:function(e){return e.game_id||console.error("You need to provide game_id"),v.default.onGameLoginRequest&&(e.game_login=1),e.platform===d.default.Platform.FB_INSTANT&&(e.lite_version||(e.lite_version=!0,console.warn("FB Instant can use only lite version of UnnyNet: Forced Lite"))),e}},{key:"_initServices",value:function(){this.API=new f.default(this.config),this.socialPlatform=p.default.createSocialPlatform(this,this.config.platform)}},{key:"_prepareWebView",value:function(){this.config.lite_version||(this.webView=new r.default(this.config),this.webView.openGameUrl(this.config,this.socialPlatform.getDeviceIdForNakama()),this.webView.onMessageReceived=this._receiveMessage.bind(this),this._loadQueue())}},{key:"_setDebug",value:function(e){this.debug=e}},{key:"_receiveMessage",value:function(e){var t=e.path,n=e.args;switch(t){case"authorised":v.default.onPlayerAuthorized&&v.default.onPlayerAuthorized(n),this.config.default_channel&&g._setDefaultChannel(this.config.default_channel);break;case"logged_out":v.default.onPlayerLoggedOut&&v.default.onPlayerLoggedOut();break;case"renamed":v.default.onPlayerNameChanged&&v.default.onPlayerNameChanged(n.name);break;case"rank_changed":v.default.onRankChanged&&v.default.onRankChanged(n);break;case"new_guild":null!=v.default.onNewGuild&&v.default.onNewGuild(n);break;case"ask_new_guild":case"popup_appeared":c.default.create(t,n,g._sendRequestReply);break;case"popup_button_clicked":c.default.buttonClicked(n);break;case"ach_completed":null!=v.default.onAchievementCompleted&&v.default.onAchievementCompleted(n);break;case"new_message":null!=v.default.onNewMessageReceived&&v.default.onNewMessageReceived(n);break;case"game_login_request":null!=v.default.onGameLoginRequest&&v.default.onGameLoginRequest();break;case"request_reply":s.default.replyReceived(n);break;case"open_url":n.url&&window.open(n.url,"_blank");break;case"debug":this._setDebug(1==n.enable)}g.log("_receiveMessage",e)}},{key:"_update",value:function(){this._checkQueue(),(!this.last_save_time||Date.now()-this.last_save_time>=1e3*d.default.REQUESTS_SAVE_TIME)&&this._saveQueue()}},{key:"_getSaveKey",value:function(){return"UN_SAVE_"+this.config.game_id}},{key:"_saveQueue",value:function(){this.last_save_time=Date.now();var e=[];for(var t in this.queue){var n=this.queue[t];n.needToSave()&&e.push(n.getSaveData())}var a=this._getSaveKey();0===e.length?localStorage.removeItem(a):localStorage.setItem(a,JSON.stringify(e))}},{key:"_loadQueue",value:function(){var e=this._getSaveKey(),t=localStorage.getItem(e);if(t){var n=JSON.parse(t);for(var a in n){var o=i.default.loadData(n[a]);this.queue.push(o)}g.log("_loadQueue",this.queue),localStorage.removeItem(e)}}},{key:"_checkQueue",value:function(){var e=this;if(0!==this.queue.length&&g._checkWebView()){var t=null,n=!1;for(var a in this.queue){var o=this.queue[a];if(!n||!o.isRequestWithFixedOrder()){if(!o.isWaiting()){t=o;break}if(o.isRequestWithFixedOrder()&&(n=!0),o.startedTime&&Date.now()-o.startedTime<1e3*d.default.MAX_DELAYED_CONFIRMATIONS)continue;t=o;break}}if(t){t.startedTime=Date.now();try{g.log("evaluate",t.getCode()),this.webView.evaluateJavaScript(t.getCode(),(function(n){g.log("response",n);var a=!1;if(n.success)t.isDelayedRequestConfirm()?t.startWaiting():a=!0,t.info.openWindow&&g.openUnnyNet();else if(n.error)switch(n.error.code){case u.Errors.UnnynetNotReady:case u.Errors.NotAuthorized:g.log("Waiting...",n);break;default:a=!0}a&&(e.queue.shift(),null!=t&&t.invokeCallback(n),e._checkQueue())}))}catch(n){console.error("EVAL ERROR: ",n)}}}}},{key:"hideWebView",value:function(){this.webView&&(null!=v.default.onUnnyNetClosed&&v.default.onUnnyNetClosed(),this.webView.hide(this.config))}},{key:"showWebView",value:function(){this.webView&&(this.webView.show(this.config),g.evaluateCommand(l.default.Command.UnnyNetWasOpened,!1,null))}}],[{key:"getAPI",value:function(){return g.instance.API}},{key:"getSocialPlatform",value:function(){return g.instance.socialPlatform}},{key:"log",value:function(e){for(var t,n=arguments.length,a=Array(1<n?n-1:0),o=1;o<n;o++)a[o-1]=arguments[o];g.instance.debug&&(t=console).info.apply(t,["[UNNYNET_JS] "+e].concat(a))}},{key:"_setDefaultChannel",value:function(e){var t=l.default.GetCommand(l.default.Command.SetDefaultChannel).format(e);g.evaluateCodeInJavaScript(new i.default(l.default.Command.SetDefaultChannel,t,!1))}},{key:"_sendRequestReply",value:function(e,t){var n=l.default.GetCommand(l.default.Command.RequestReply).format(e,t);g.evaluateCodeInJavaScript(new i.default(l.default.Command.RequestReply,n,!1))}},{key:"_checkWebView",value:function(){return!!g.instance||(console.error("UnnyNet wasn't properly initialized"),!1)}},{key:"evaluateCommand",value:function(e,t,n){g.evaluateCodeInJavaScript(new i.default(e,l.default.GetCommand(e),t,n))}},{key:"evaluateCodeInJavaScript",value:function(e,t){var n=1<arguments.length&&void 0!==t&&t;if(g._checkWebView())if(g.instance.config.lite_version)console.warn("You can't use this method in Lite Mode");else{for(var a=g.instance.queue,o=-1,r=1;r<a.length;r++)if(a[r].couldBeReplaced(e.Command)){o=r;break}if(-1===o){if(n?a.unshift(e):a.push(e),1===a.length)g.instance._checkQueue();else if(a.length>=d.default.MAX_QUEUE_LENGTH)for(var i=0;i<a.length;i++)if(a[i].isDelayedRequestConfirm()){a.splice(i,1);break}}else a[o]=e}}},{key:"delayedCommandWasConfirmed",value:function(e){var t=g.instance.queue;for(var n in t)if(e===t[n]){t.splice(n,1);break}}},{key:"openUnnyNet",value:function(){g._checkWebView()&&g.instance.showWebView()}},{key:"closeUnnyNet",value:function(){g._checkWebView()&&g.instance.hideWebView()}},{key:"setFrame",value:function(e){g.instance.webView&&g.instance.webView.setFrame(e)}},{key:"setCloseButtonVisible",value:function(e){g.instance.webView&&g.instance.webView.setCloseButtonVisible(e)}}]),g);function g(e){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),this.storage=null,(g.instance=this).config=this._prepareConfig(e),this.allGetParams=function(){var e={},t=window.location.search;if(t&&0<t.length)for(var n=(t=t.substring(1)).split("&"),a=0;a<n.length;a++){var o=n[a].split("=");o[0].startsWith("amp;")?e[o[0].substring(4)]=o[1]:e[o[0]]=o[1]}return e}(),this.queue=[],this.environment=this.config.hasOwnProperty("environment")?this.config.environment:_,y.default.setEnvironment(this.environment),this._initServices(),this._setDebug(this.config.debug),g.log("INIT",this.config),this._prepareWebView(),this.storage=new h.default(this.config.game_id,(function(){g.log("Storage was initialized"),t.socialPlatform.authorize((function(e){t.API.sendInitEvent(),t.config.callback(e)}))})),setInterval(this._update.bind(this),1e3*d.default.CHECK_PERIOD)}b.instance=null,t.default=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={GENERAL_CONSTANTS:{REMOTE_URL:"https://unnynet.com",VERSION:3,PLUGIN_VERSION:"3.0",API_URL:"https://test-un-api.unnynet.com",ANAL_URL:"https://un-api-anal.unnynet.com"},MAX_DELAYED_CONFIRMATIONS:10,REQUESTS_SAVE_TIME:60,CHECK_PERIOD:1,MAX_QUEUE_LENGTH:100,STORAGE_DELAY:2e4,SEND_REQUEST_RETRY_DELAY:1,ANIMATIONS:{OPEN_DURATION:.5},Platform:{VKONTAKTE:3,FACEBOOK:4,ODNOKLASSNIKI:5,FB_INSTANT:6,IOS_APPSTORE:7,ANDROID_GOOGLE_PLAY:8,NUTAKU_PC_BROWSER:9,NUTAKU_SP_BROWSER:10,NUTAKU_ANDROID:11,NUTAKU_CLIENT_GAMES:12},PurchaseStatusFilter:{ALL:0,PENDING:1,COMPLETED:2,CLAIMED:3},Environment:{Development:0,Stage:1,Production:2}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=n(0),r=s(o),i=s(n(6)),u=s(n(2)),l=s(n(11));function s(e){return e&&e.__esModule?e:{default:e}}var c=(function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(d,[{key:"authorize",value:function(e){this._sendError("authorize",e)}},{key:"_autoAuthInNakama",value:function(){console.error("No nakama auth for current platform")}},{key:"getDeviceIdForNakama",value:function(){return null}},{key:"playRewardedAd",value:function(e){var t=this;0<this.preloadedAds.length?this._playRewardedAd(e):this.preloadRewardedAd(e,(function(e){return t._playRewardedAd(e)}))}},{key:"_playRewardedAd",value:function(e){this._sendError("_playRewardedAd",e.onError)}},{key:"preloadRewardedAd",value:function(e){this._sendError("preloadRewardedAd",e.onError)}},{key:"purchaseProduct",value:function(e,t){this._sendError("purchaseProduct",t)}},{key:"completePurchase",value:function(e,t){return i.default.createDefaultRequest("/v2/payments/all/complete",{un_order_id:e},t)}},{key:"getPurchases",value:function(){}},{key:"claimPurchase",value:function(e,t){return i.default.createDefaultRequest("/v2/payments/all/claim",{un_order_id:e},t)}},{key:"_sendError",value:function(e,t){var n=e+" isn't implemented for this platform";console.error(n),t&&t(r.default.getErrorResponse(o.Errors.Unknown,n))}},{key:"_findPendingPurchaseByField",value:function(e,t,n){l.default.getPurchases(u.default.PurchaseStatusFilter.PENDING,(function(a){if(a.success){var o=a.data,i=!0,u=!1,l=void 0;try{for(var s,c=o[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var d=s.value;if(d[e]===t){n(r.default.getSuccessResponse(d));break}}}catch(a){u=!0,l=a}finally{try{!i&&c.return&&c.return()}finally{if(u)throw l}}}else n(a)}))}}]),d);function d(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d),this.environment=e.environment,this.API=e.API,this.allGetParams=e.allGetParams,this.config=e.config,this.preloadedAds=[],this.platform=this.config.platform}t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=l(n(0)),r=n(13),i=l(r),u=l(n(1));function l(e){return e&&e.__esModule?e:{default:e}}var s=(function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(c,null,[{key:"openWindow",value:function(e,t){u.default.evaluateCommand(e,!0,t)}},{key:"_evalCodeFull",value:function(e,t,n,a,r){var l=o.default.GetCommand(e),s=String.prototype.format.apply(l,r),c=new i.default(e,s,n,t);u.default.evaluateCodeInJavaScript(c,a)}},{key:"evalCode",value:function(e,t){var n=Array.prototype.slice.call(arguments,2);c._evalCodeFull(e,t,!1,!1,n)}},{key:"evalCodeAndOpen",value:function(e,t){var n=Array.prototype.slice.call(arguments,2);c._evalCodeFull(e,t,!0,!1,n)}},{key:"evalCodeDelayed",value:function(e,t){var n=Array.prototype.slice.call(arguments,2),a=o.default.GetCommand(e),i=String.prototype.format.apply(a,n),l=new r.UnnyCommandInfoDelayed(e,i,t);u.default.evaluateCodeInJavaScript(l)}},{key:"evalCodeHighPriority",value:function(e,t){var n=Array.prototype.slice.call(arguments,2);c._evalCodeFull(e,t,!1,!0,n)}},{key:"evalCodeAdvanced",value:function(e,t){c.evalCodeDelayed.apply(this,arguments)}}]),c);function c(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c)}t.default=s},function(e,t,n){"use strict";function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e,t,n){n&&a(e,n)}(r,0,[{key:"setEnvironment",value:function(e){r.environment=e}},{key:"_saveValue",value:function(e,t){localStorage.setItem(e,t)}},{key:"_getValue",value:function(e){return localStorage.getItem(e)}},{key:"_removeItem",value:function(e){localStorage.removeItem(e)}},{key:"setToken",value:function(e){r._saveValue(r._getTokenKeyForEnvironment(),e)}},{key:"getToken",value:function(){return r._getValue(r._getTokenKeyForEnvironment())}},{key:"setRefreshToken",value:function(e){r._saveValue(r._getRefreshTokenKeyForEnvironment(),e)}},{key:"getRefreshToken",value:function(){r._getValue(r._getRefreshTokenKeyForEnvironment())}},{key:"clearTokens",value:function(){r._removeItem(r._getTokenKeyForEnvironment()),r._removeItem(r._getRefreshTokenKeyForEnvironment())}},{key:"_getTokenKeyForEnvironment",value:function(){return"env"+r.environment+"un_token"}},{key:"_getRefreshTokenKeyForEnvironment",value:function(){return"env"+r.environment+"un_refresh_token"}}]),r);function r(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r)}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=d(n(5)),r=d(n(20)),i=n(0),u=d(i),l=d(n(9)),s=d(n(2)),c=d(n(1));function d(e){return e&&e.__esModule?e:{default:e}}var f=(function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(p,[{key:"_sendDefaultError",value:function(e,t){t&&t(u.default.getErrorResponse(i.Errors.Unknown,e)),console.error(e)}},{key:"authWithLogin",value:function(e,t,n){return this._clearTokens(),p.createAuthRequest("/v2/auth/name",{name:e,password:t},n)}},{key:"authWithVK",value:function(e,t,n){return this._clearTokens(),e?t?p.createAuthRequest("/v2/auth/vk",{user_id:e,token:t},n):this._sendDefaultError("[VK]: no auth_key provided",n):this._sendDefaultError("[VK]: no viewer_id provided",n)}},{key:"authWithOK",value:function(e,t,n){return this._clearTokens(),e?t?p.createAuthRequest("/v2/auth/ok",{access_token:e,session_secret_key:t},n):this._sendDefaultError("[OK]: no session_secret_key provided",n):this._sendDefaultError("[OK]: no access_token provided",n)}},{key:"authWithFB",value:function(e,t){return this._clearTokens(),e?p.createAuthRequest("/v2/auth/fb",{token:e},t):this._sendDefaultError("[FB]: no auth_key provided",t)}},{key:"_save",value:function(e,t,n,a,o){0<=a||(a=-1),p.instance._createNewRequest("/v1/saves",{collection:e,key:t,value:n},(function(e,t){return u.default.onCallback(e,t,o)})).setToken(this._getToken()).setHeader("data-version",a.toString()).post()}},{key:"save",value:function(e,t,n,a,o){this._getToken()?this._save(e,t,n,a,o):o&&o(u.default.getErrorResponse(i.Errors.NoAccessToken))}},{key:"_load",value:function(e,t,n){p.createDefaultGetRequest("/v1/saves?collection="+e+(t?"&key="+t:""),n)}},{key:"load",value:function(e,t,n){this._getToken()?this._load(e,t,n):n&&n(u.default.getErrorResponse(i.Errors.NoAccessToken))}},{key:"sendInitEvent",value:function(){if(this.config.api_game_id)return this._createNewRequest(s.default.GENERAL_CONSTANTS.ANAL_URL+"/v1/event/init/device",{device_id:c.default.getSocialPlatform().getDeviceIdForNakama(),game_id:this.config.api_game_id}).post();console.log("Please provide api_game_id to use analytics")}},{key:"_createNewRequest",value:function(e,t,n){return t?(t.env=this._getEnvironment(),t.platform=this.config.platform):e+=(e.includes("?")?"&":"?")+this.getHeaderParams,new r.default(e,t,n)}},{key:"_clearTokens",value:function(){o.default.clearTokens()}},{key:"_getToken",value:function(){return o.default.getToken()}},{key:"_getEnvironment",value:function(){return this.config.environment}}],[{key:"createDefaultRequest",value:function(e,t,n){return p.instance._createNewRequest(e,t,(function(e,t){return u.default.onCallback(e,t,n)})).setToken(p.instance._getToken()).post()}},{key:"createDefaultGetRequest",value:function(e,t){return p.instance._createNewRequest(e,null,(function(e,n){return u.default.onCallback(e,n,t)})).setToken(p.instance._getToken()).get()}},{key:"createAuthRequest",value:function(e,t,n){return t.env=p.instance._getEnvironment(),t.game_id=p.instance.config.game_id,t.public_key=p.instance.config.public_key,t.device_id=c.default.getSocialPlatform().getDeviceIdForNakama(),p.instance._createNewRequest(e,t,(function(e,t){return u.default.onAuthCallback(e,t,n)})).markAsAuth().post()}}]),p);function p(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p),(p.instance=this).config=e,this.apiRequests=new l.default(this.config),this.getHeaderParams="env={0}&platform={1}".format(this.config.environment,this.config.platform)}t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=u(n(4)),r=u(n(0)),i=u(n(1));function u(e){return e&&e.__esModule?e:{default:e}}var l=(function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(s,null,[{key:"authorizeWithCredentials",value:function(e,t,n,a){o.default.evalCodeHighPriority(r.default.Command.AuthorizeWithCredentials,a,e,t,n)}},{key:"authorizeAsGuest",value:function(e,t){o.default.evalCodeHighPriority(r.default.Command.AuthorizeAsGuest,t,e)}},{key:"authorizeWithCustomId",value:function(e,t,n){o.default.evalCodeHighPriority(r.default.Command.AuthorizeWithCustomId,n,e,t)}},{key:"forceLogout",value:function(e){o.default.evalCode(r.default.Command.ForceLogout,e)}},{key:"authorize",value:function(e,t,n){i.default.getAPI().authWithLogin(e,t,n)}}]),s);function s(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s)}t.default=l},function(e,t,n){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),(a=n(1))&&a.__esModule,t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o,r=(o=n(1))&&o.__esModule?o:{default:o},i=(function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(u,[{key:"_getSaveKey",value:function(){return this.localSaveKey}},{key:"_updateTokenForRequests",value:function(e){for(var t in this.requestsQueue){var n=this.requestsQueue[t].data.request;n.headers.hasOwnProperty("Authorization")&&(n.headers.Authorization="Bearer "+e)}}},{key:"_enqueueRequest",value:function(e,t,n,a,o){var r={data:{url:e,request:t},callback:o,retries:0,save:n};a?this.requestsQueue.unshift(r):this.requestsQueue.push(r),this.requests_were_updated=!0,1===this.requestsQueue.length&&this._sendNextRequest()}},{key:"_checkRequestToSave",value:function(){if(0<this.requestsQueue.length&&this.requests_were_updated){var e=Date.now();5e3<e-this.last_update_time&&(this.last_update_time=e,this.requests_were_updated=!1,this.saveRequests())}}},{key:"_removeFirstRequest",value:function(e){for(var t=0;t<this.requestsQueue.length;t++)if(this.requestsQueue[t]===e){this.requestsQueue.splice(t,1);break}this._sendNextRequest(),this.last_update_time=Date.now()}},{key:"_sendNextRequest",value:function(){var e=this;if(0!==this.requestsQueue.length){var t=this.requestsQueue[0],n=t.data.url,a=t.data.request,o=t.callback;r.default.log("fetch",n,t),fetch(n,a).then((function(e){return r.default.log("fetch response",e,t),200<=e.status&&e.status<300?e.json():Promise.reject(e)})).then((function(n){o&&o(null,n),e._removeFirstRequest(t)})).catch((function(n){r.default.log("fetch failed",n,t),t.retries<3?(t.retries++,setTimeout((function(){return e._sendNextRequest()}),1e3)):(o&&o(n,null),e._removeFirstRequest(t))}))}}},{key:"loadRequests",value:function(){var e=localStorage.getItem(this._getSaveKey());if(e){var t=JSON.parse(e);if(t)for(var n in t){var a=t[n];this._enqueueRequest(a.url,a.request,!0,null)}localStorage.removeItem(this._getSaveKey())}}},{key:"saveRequests",value:function(){var e=Math.min(100,this.requestsQueue.length);if(0<e){for(var t=[],n=0;n<e;n++)this.requestsQueue[n].save&&t.push(this.requestsQueue[n].data);localStorage.setItem(this._getSaveKey(),JSON.stringify(t))}}}],[{key:"updateTokenForRequests",value:function(e){u.instance._updateTokenForRequests(e)}},{key:"enqueueRequest",value:function(e,t,n,a){u.instance._enqueueRequest(e,t,n,!1,a)}},{key:"enqueueImportantRequest",value:function(e,t,n,a){u.instance._enqueueRequest(e,t,n,!0,a)}}]),u);function u(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),this.localSaveKey="UN_API_SAVE_"+e.environment+"_"+e.game_id,this.requestsQueue=[],(u.instance=this).last_update_time=Date.now(),this.requests_were_updated=!1}t.default=i},function(e,t,n){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),(a=n(4))&&a.__esModule,t.default=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=s(n(1)),r=s(n(2)),i=s(n(6)),u=n(0),l=s(u);function s(e){return e&&e.__esModule?e:{default:e}}var c=(function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(d,null,[{key:"purchaseProduct",value:function(e,t){t?d.getProducts((function(n){if(n.success){var a=d._getProductById(e);if(a){var r=o.default.getSocialPlatform();r.purchaseProduct(a,(function(e){if(e.success){var n=e.data.id;r.completePurchase(n,(function(e){e.success?r.claimPurchase(e.data.id,t):t(e)}))}else t(e)}))}else t(l.default.getErrorResponse(u.Errors.NoSuchProduct,"No such product with Id: "+e))}else t(n)})):console.error("[Payments] You need to provide doneCallback for purchaseProduct")}},{key:"restorePurchases",value:function(e){e?d.getPurchases(r.default.PurchaseStatusFilter.COMPLETED,(function(t){if(console.log("**COMPLETED",t),t.success){var n=t.data,a=!0,o=!1,i=void 0;try{for(var u,l=n[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var s=u.value,c=s.id;c?d.claimPurchase(c,e):console.error("[ERROR] restorePurchases - no order id",s)}}catch(t){o=!0,i=t}finally{try{!a&&l.return&&l.return()}finally{if(o)throw i}}d.getPurchases(r.default.PurchaseStatusFilter.PENDING,(function(t){if(console.log("**PENDING",t),t.success){var n=t.data,a=!0,o=!1,r=void 0;try{for(var i,u=n[Symbol.iterator]();!(a=(i=u.next()).done);a=!0){var l=i.value,s=l.id;s?d.completePurchase(s,(function(t){console.log("**completePurchase",t),t.success?d.claimPurchase(t.data.id,e):e(t)})):console.error("[ERROR] restorePurchases - no order id",l)}}catch(t){o=!0,r=t}finally{try{!a&&u.return&&u.return()}finally{if(o)throw r}}}else e(t)}))}else e(t)})):console.error("[Payments] You need to provide doneCallback for restorePurchases")}},{key:"_getProductById",value:function(e){return d.cachedProducts.formattedProducts[e]}},{key:"_createFormattedProducts",value:function(e){var t={},n=!0,a=!1,o=void 0;try{for(var r,i=e[Symbol.iterator]();!(n=(r=i.next()).done);n=!0){var u=r.value;u.product_id=u.base_id,u.platform_product_id=u.item_id,t[u.product_id]=u}}catch(e){a=!0,o=e}finally{try{!n&&i.return&&i.return()}finally{if(a)throw o}}return t}},{key:"getProducts",value:function(e){if(!(Date.now()-d.cachedProducts.time<=6e4))return i.default.createDefaultGetRequest("/v2/payments/products",(function(t){t.success&&(d.cachedProducts={time:Date.now(),originalResponse:t,formattedProducts:d._createFormattedProducts(t.data)}),e&&e(t)}));e&&e(d.cachedProducts.originalResponse)}},{key:"getPurchases",value:function(e,t){return o.default.getSocialPlatform().getPurchases(e,t),i.default.createDefaultGetRequest("/v2/payments/purchases?status="+e,t)}},{key:"completePurchase",value:function(e,t){o.default.getSocialPlatform().completePurchase(e,t)}},{key:"claimPurchase",value:function(e,t){o.default.getSocialPlatform().claimPurchase(e,t)}}]),d);function d(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d)}c.cachedProducts={},t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ViewOpenDirection=void 0;function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o,r=(o=n(2))&&o.__esModule?o:{default:o},i=t.ViewOpenDirection={NONE:0,LEFT_TO_RIGHT:2,RIGHT_TO_LEFT:4,TOP_TO_BOTTOM:1,BOTTOM_TO_TOP:3},u=(function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(l,[{key:"_receiveMessage",value:function(e){if(e.origin===r.default.GENERAL_CONSTANTS.REMOTE_URL&&e.data)if(console.info("data!",e.data),e.data.reply){var t=e.data.id;if(this.evaluationsById.hasOwnProperty(t)){var n=e.data.reply,a=this.evaluationsById[t].callback;delete this.evaluationsById[t],a(n)}}else if(e.data&&e.data.message&&e.data.message.split){var o=decodeURIComponent(e.data.message).split("?"),i=void 0,u={};0<o.length&&(i=o[0],1<o.length&&(u=JSON.parse(o[1]))),this.onMessageReceived&&this.onMessageReceived({path:i,args:u})}}},{key:"openUrl",value:function(e){this.iFrame.src=e}},{key:"setFrame",value:function(e){this.cachedFrame=e,this._isVisible()?this._applyNormalPosition():this._applyHiddenPosition()}},{key:"_applyNormalPosition",value:function(){var e=this.cachedFrame,t=this.parent.style;t.left=e.left,t.right=e.right,t.top=e.top,t.bottom=e.bottom,t.width=e.width,t.height=e.height}},{key:"_applyHiddenPosition",value:function(){var e=this.parent.style;switch(this._applyNormalPosition(),this.config.open_animation){case i.LEFT_TO_RIGHT:e.left="-"+e.width,e.right=void 0;break;case i.RIGHT_TO_LEFT:e.left=void 0,e.right="-"+e.width;break;case i.TOP_TO_BOTTOM:e.top="-"+e.height,e.bottom=void 0;break;case i.BOTTOM_TO_TOP:e.top=void 0,e.bottom="-"+e.height}}},{key:"_isVisible",value:function(){return"visible"===this.parent.style.visibility}},{key:"_setAnimationActive",value:function(e){var t=this.parent.style;t["-webkit-transition"]=t.transition=e?"all "+r.default.ANIMATIONS.OPEN_DURATION+"s ease-in-out":void 0}},{key:"_clearTimer",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null)}},{key:"hide",value:function(){var e=this;this._clearTimer(),this._applyHiddenPosition(),this.timer=setTimeout((function(){e.parent.style.visibility="hidden",e.timer=null}),1e3*r.default.ANIMATIONS.OPEN_DURATION)}},{key:"show",value:function(){this._clearTimer(),this.parent.style.visibility="visible",this._applyNormalPosition()}},{key:"evaluateJavaScript",value:function(e,t){var n={eval_code:e,id:this.instanceId++};this.evaluationsById[n.id]={callback:t},this.window.postMessage(n,r.default.GENERAL_CONSTANTS.REMOTE_URL)}}]),l);function l(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l);var t=document.createElement("div");this.parent=document.body.appendChild(t);var n=document.createElement("iframe");this.iFrame=this.parent.appendChild(n),this.window=this.iFrame.contentWindow;var a=this.iFrame.style;a.position="absolute",a.left=a.right="0",a.top=a.bottom="0",a.width=a.height="100%",a.border="none";var o=this.parent.style;o.zIndex="999999",o.position="fixed",o.visibility="hidden",this.config=e,this.evaluationsById={},this.instanceId=0,this.onMessageReceived=null,e.open_animation&&this._setAnimationActive(!0),this.setFrame({top:0,right:0,left:"",bottom:0,width:"50%",height:"100%"}),window.addEventListener("message",this._receiveMessage.bind(this),!1)}t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnnyCommandInfoDelayed=void 0;var a=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var r=u(n(0)),i=u(n(14));function u(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=(a(c,[{key:"getSaveData",value:function(){var e={command:this.info.command,code:this.info.code};return 0<=this.req_id&&(e.req_id=this.req_id),e}},{key:"getCode",value:function(){return this.info.code}},{key:"setCode",value:function(e){this.info.code=e}},{key:"getCommand",value:function(){return this.info.command}},{key:"invokeCallback",value:function(e){this.info.callback&&this.info.callback(e)}},{key:"invokeCallbackDelayed",value:function(e){var t=r.default.getResponceData(e);return this.info.callbackDelayed&&this.info.callbackDelayed(t),t}},{key:"needToSave",value:function(){switch(this.info.command){case r.default.Command.SendMessage:case r.default.Command.ReportLeaderboardScoresAsync:case r.default.Command.ReportAchievementProgressAsync:case r.default.Command.AddGuildExperience:return!0;default:return!1}}},{key:"couldBeReplaced",value:function(e){var t=this.getCommand();switch(e){case r.default.Command.OpenLeaderBoards:case r.default.Command.OpenAchievements:case r.default.Command.OpenFriends:case r.default.Command.OpenChannel:case r.default.Command.OpenGuilds:case r.default.Command.OpenMyGuild:return t===r.default.Command.OpenLeaderBoards||t===r.default.Command.OpenAchievements||t===r.default.Command.OpenFriends||t===r.default.Command.OpenChannel||t===r.default.Command.OpenGuilds||t===r.default.Command.OpenMyGuild;case r.default.Command.AuthorizeWithCredentials:case r.default.Command.AuthorizeAsGuest:case r.default.Command.AuthorizeWithCustomId:case r.default.Command.ForceLogout:case r.default.Command.GetGuildInfo:case r.default.Command.GetAchievementsInfo:case r.default.Command.GetPlayerPublicInfo:case r.default.Command.GetLeaderboardScores:case r.default.Command.SetSafeArea:case r.default.Command.UnnyNetWasOpened:case r.default.Command.JoinPrivateChannel:case r.default.Command.LeaveAllPrivateChannels:return t===e;default:return!1}}},{key:"_isOpenCommand",value:function(e){switch(e){case r.default.Command.OpenLeaderBoards:case r.default.Command.OpenAchievements:case r.default.Command.OpenFriends:case r.default.Command.OpenChannel:case r.default.Command.OpenGuilds:case r.default.Command.OpenMyGuild:return!0;default:return!1}}},{key:"sameType",value:function(e){var t=this.getCommand();return!(!this._isOpenCommand(e)||!this._isOpenCommand(t))||e===t}},{key:"isDelayedRequestConfirm",value:function(){return c.isDelayedRequestConfirm(this.getCommand())}},{key:"isRequestWithFixedOrder",value:function(){return c.isRequestWithFixedOrder(this.getCommand())}},{key:"startWaiting",value:function(){this.delayedRequestWaiting=!0}},{key:"isWaiting",value:function(){return this.delayedRequestWaiting}}],[{key:"loadData",value:function(e){var t=null;return e.hasOwnProperty("req_id")?((t=new d(e.command,e.code)).setRequestId(e.req_id),i.default.addLoadedRequest(t)):t=new c(e.command,e.code),t}},{key:"isDelayedRequestConfirm",value:function(e){switch(e){case r.default.Command.ReportLeaderboardScoresAsync:case r.default.Command.ReportAchievementProgressAsync:return!0}return!1}},{key:"isRequestWithFixedOrder",value:function(e){switch(e){case r.default.Command.ReportLeaderboardScoresAsync:return!0}return!1}}]),c);function c(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;l(this,c),this.info={command:e,code:t,openWindow:n,callback:a},this.startedTime=null,this.req_id=-1,this.delayedRequestWaiting=!1}t.default=s;var d=t.UnnyCommandInfoDelayed=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(f,s),a(f,[{key:"setRequestId",value:function(e){this.req_id=e}}]),f);function f(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;l(this,f);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,e,t,!1,null));return a.info.callbackDelayed=n,i.default.addRequest(a),a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o,r=(o=n(1))&&o.__esModule?o:{default:o},i=n(0),u=(function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(l,[{key:"_requestId",value:function(){return this.uniqueIds===Number.MAX_SAFE_INTEGER?this.uniqueIds=0:this.uniqueIds++,this.uniqueIds}}],[{key:"getInstance",value:function(){return l.staticRequestsManagerInstance||(l.staticRequestsManagerInstance=new l),l.staticRequestsManagerInstance}},{key:"addRequest",value:function(e){var t=l.getInstance(),n=t._requestId();if((t.allRequests[n]=e).getCode()){var a=e.getCode().replace("<*id*>",n);e.setRequestId(n),e.setCode(a)}}},{key:"addLoadedRequest",value:function(e){if(0<=e.req_id){var t=l.getInstance(),n=e.req_id;t.allRequests[n]=e,n>=t.uniqueIds&&(t.uniqueIds=n===Number.MAX_SAFE_INTEGER?0:n+1)}}},{key:"replyReceived",value:function(e){var t=l.getInstance(),n=e.id;if(t.allRequests.hasOwnProperty(n)){var a=t.allRequests[n],o=a.invokeCallbackDelayed(e);if(a.isDelayedRequestConfirm()){var u=o.success;if(!u)switch(o.error.code){case i.Errors.NoSuchLeaderboard:case i.Errors.NoSuchAchievement:case i.Errors.WrongAchievementType:case i.Errors.AchievementIsNotPublished:u=!0}u&&(r.default.delayedCommandWasConfirmed(a),delete t.allRequests[n])}else delete t.allRequests[n]}}}]),l);function l(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),this.uniqueIds=0,this.allRequests={}}u.staticRequestsManagerInstance=null,t.default=u},function(e,t,n){"use strict";function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e,t,n){n&&a(e,n)}(r,0,[{key:"loadScript",value:function(e,t,n){if(document.getElementById(t))n&&n();else{var a=document.createElement("script");a.id=t,a.src=e,a.onload=n,a.onerror=n,document.body.appendChild(a)}}},{key:"loadChainOfScripts",value:function(e,t){if(0!==e.length){var n=e.pop();r.loadScript(n.url,n.id,(function(){r.loadChainOfScripts(e,t)}))}else t&&t()}}]),r);function r(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r)}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=s(n(27)),r=s(n(1)),i=s(n(2)),u=n(0),l=s(u);function s(e){return e&&e.__esModule?e:{default:e}}var c=(function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(d,null,[{key:"getRawDictionary",value:function(e){return d.RGC.getDictionary(e)}},{key:"save",value:function(e,t){if(d._canSaveDataAndUpdateSaveTime(e)){var n=d._getLastVersion(e);r.default.getAPI().save(e.collection,e.key,e.value,n,(function(n){n.success&&d._updateVersion(e,n.data.version),t&&t(n)}))}else t&&t(d._getStorageError())}},{key:"load",value:function(e,t){d._canLoadDataAndUpdateLoadTime(e)?r.default.getAPI().load(e.collection,e.key,(function(n){n.success&&n.data.length&&d._updateVersion(e,n.data[0].version),t&&t(n)})):t&&t(d._getStorageError())}},{key:"_updateVersion",value:function(e,t){d._getOrCreateDataObjectFromCache(e).version=t}},{key:"_canSaveDataAndUpdateSaveTime",value:function(e){var t=d._getOrCreateDataObjectFromCache(e),n=Date.now();return(!t.last_save||n-t.last_save>=i.default.STORAGE_DELAY)&&(t.last_save=n,!0)}},{key:"_canLoadDataAndUpdateLoadTime",value:function(e){var t=d._getOrCreateDataObjectFromCache(e),n=Date.now();return(!t.last_load||n-t.last_load>=i.default.STORAGE_DELAY)&&(t.last_load=n,!0)}},{key:"_getOrCreateDataObjectFromCache",value:function(e){var t=d._cachedData,n=t.hasOwnProperty(e.collection)?t[e.collection]:t[e.collection]={};return n.hasOwnProperty(e.key)?n[e.key]:n[e.key]={}}},{key:"_getLastVersion",value:function(e){if(!e.ignore_version&&d._cachedData.hasOwnProperty(e.collection)){var t=d._cachedData[e.collection];if(t.hasOwnProperty(e.key))return t[e.key].version}return-1}},{key:"_getStorageError",value:function(){return l.default.getErrorResponse(u.Errors.StorageRequestsMadeTooOften,"You were trying to save/load from the same collection/key too often. Please do that maximum once per 20 seconds.")}}]),d);function d(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d),d.RGC=o.default.UnnyRGC.initialize({game_id:e},(function(){t&&t()}))}c.RGC=null,c._cachedData={},t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=y(n(7)),o=y(n(29)),r=y(n(10)),i=y(n(30)),u=y(n(16)),l=y(n(11)),s=y(n(31)),c=n(32),d=y(c),f=n(12),p=n(0),h=y(n(2)),v=y(n(33));function y(e){return e&&e.__esModule?e:{default:e}}t.default={Auth:a.default,Chat:i.default,Events:r.default,Social:o.default,Storage:u.default,Payments:l.default,MainController:s.default,PopupButtons:d.default,ButtonType:c.ButtonType,ViewOpenDirection:f.ViewOpenDirection,Errors:p.Errors,Advertising:v.default,Platform:h.default.Platform,Environment:h.default.Environment,PurchaseStatusFilter:h.default.PurchaseStatusFilter}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=u(n(12)),r=u(n(2)),i=(u(n(8)),u(n(1)));function u(e){return e&&e.__esModule?e:{default:e}}var l=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(s,o.default),function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(s,[{key:"openGameUrl",value:function(e,t){var n={game_id:e.game_id,public_key:e.public_key,version:r.default.GENERAL_CONSTANTS.VERSION,device:"web",location_origin:window.location.origin};e.game_login&&(n.game_login=1),t&&(n.device_id=t),e.platform&&(n.platform=e.platform),i.default.log("DEVICE_ID",t);var a=encodeURIComponent(JSON.stringify(n)),o=r.default.GENERAL_CONSTANTS.REMOTE_URL+"/#/plugin/?data="+a;this.openUrl(o)}},{key:"setCloseButtonVisible",value:function(e){this.closeBtn.style.visibility=e?"visible":"hidden"}}]),s);function s(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,e)),n=document.createElement("button");t.closeBtn=t.parent.appendChild(n),t.closeBtn.innerHTML='<img width="100%" height="100%" src="https://unnynet.azureedge.net/users/attachments/b246adbe-c1af-4532-88ca-f1d1709b0211/355f6e10-6a3c-11ea-a35e-ebf4b961e71e.png" />',t.closeBtn.onclick=i.default.closeUnnyNet;var a=t.closeBtn.style;return a.position="absolute",a.top=a.right="7px",a.padding="0",a.width=a.height="36px",a.outline="none",a.background="none",a.border="none",t}t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=n(0),r=(i(n(8)),i(n(10)));function i(e){return e&&e.__esModule?e:{default:e}}var u=(function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(l,null,[{key:"create",value:function(e,t,n){switch(e){case"ask_new_guild":l._askNewGuildRequest(t,n);break;case"popup_appeared":l._playerPopupAppearedRequest(t,n)}}},{key:"sendFailed",value:function(e,t,n,a){var r=2<arguments.length&&void 0!==n?n:"";t(e,'{"success": 0, "error": {"code":'+(3<arguments.length&&void 0!==a?a:o.Errors.Unknown)+', "message": "'+r+'"}}')}},{key:"sendSuccess",value:function(e,t){t(e,'{"success": 1}')}},{key:"sendSuccessWithData",value:function(e,t,n){n(e,'{"success": 1, "data":'+t+"}")}},{key:"_askNewGuildRequest",value:function(e,t){var n=e.sys_id,a=null;r.default.onNewGuildRequest&&(a=r.default.onNewGuildRequest(e)),a?l.sendFailed(n,t,a):l.sendSuccess(n,t)}},{key:"_playerPopupAppearedRequest",value:function(e,t){var n=e.sys_id;if(null!=r.default.onPopupOpened){var a=r.default.onPopupOpened(e);if(null!=a)return void l.sendSuccessWithData(n,a.parse(),t)}l.sendSuccess(n,t)}},{key:"buttonClicked",value:function(e){if(PopupButtons.activePopup){var t=e.button_id;if(t){var n=parseInt(t);PopupButtons.activePopup.buttonClicked(n)}}}}]),l);function l(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l)}t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=i(n(9)),r=(i(n(5)),i(n(2)));function i(e){return e&&e.__esModule?e:{default:e}}var u=(function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(l,[{key:"setHeaders",value:function(e){return this.headers=e,this}},{key:"setHeader",value:function(e,t){return this.headers||(this.headers={}),this.headers[e]=t,this}},{key:"setToken",value:function(e){return this.setHeader("Authorization","Bearer "+e)}},{key:"_sendRequest",value:function(e,t){this.important?o.default.enqueueImportantRequest(this.url,e,t,this.callback):o.default.enqueueRequest(this.url,e,t,this.callback)}},{key:"_send",value:function(e,t){if(e.headers={"Content-Type":"application/json"},this.headers)for(var n in this.headers)e.headers[n]=this.headers[n];this._sendRequest(e,t)}},{key:"markAsAuth",value:function(){return this.markAsUnsavable().markImportant()}},{key:"markAsUnsavable",value:function(){return this.savePost=!1,this}},{key:"markImportant",value:function(){return this.important=!0,this}},{key:"get",value:function(){this._send({method:"GET"},!1)}},{key:"post",value:function(){var e={method:"POST"};this.data&&(e.body=JSON.stringify(this.data)),this._send(e,this.savePost)}}]),l);function l(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),this.url=e.startsWith("http")?e:r.default.GENERAL_CONSTANTS.API_URL+e,this.data=t,this.callback=n,this.retry=0,this.savePost=!0,this.important=!1}t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=d(n(2)),r=d(n(22)),i=d(n(23)),u=d(n(24)),l=d(n(25)),s=d(n(3)),c=d(n(26));function d(e){return e&&e.__esModule?e:{default:e}}var f=(function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(p,null,[{key:"createSocialPlatform",value:function(e,t){switch(t){case o.default.Platform.NUTAKU_PC_BROWSER:return new r.default(e);case o.default.Platform.VKONTAKTE:return new i.default(e);case o.default.Platform.ODNOKLASSNIKI:return new u.default(e);case o.default.Platform.FACEBOOK:return new l.default(e);case o.default.Platform.FB_INSTANT:return new c.default(e);default:return new s.default(e)}}}]),p);function p(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p)}t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=c(n(3)),r=n(0),i=c(r),u=c(n(5)),l=c(n(2)),s=c(n(6));function c(e){return e&&e.__esModule?e:{default:e}}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(p,o.default),function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(p,[{key:"authorize",value:function(e){this.authWithNutakuGadget(e)}},{key:"getDeviceIdForNakama",value:function(){return null}},{key:"authWithNutakuGadget",value:function(e){if("undefined"!=typeof gadgets){var t;u.default.clearTokens();var n=(d(t={},gadgets.io.RequestParameters.METHOD,gadgets.io.MethodType.POST),d(t,gadgets.io.RequestParameters.CONTENT_TYPE,gadgets.io.ContentType.JSON),d(t,gadgets.io.RequestParameters.POST_DATA,gadgets.io.encodeValues({game_id:this.config.game_id,public_key:this.config.public_key,env:this.config.environment})),d(t,gadgets.io.RequestParameters.AUTHORIZATION,gadgets.io.AuthorizationType.SIGNED),t);console.error("SENDING...",n);var a=l.default.GENERAL_CONSTANTS.API_URL+"/v1/auth/nutaku_pc";console.warn("URL = "+a),gadgets.io.makeRequest(a,(function(t){console.info("NUTAKU REPLY",t),t.errors&&t.errors.length&&console.error("AUTH ERROR",t.errors),i.default.onAuthCallback(null,t.data,e)}),n)}else e(i.default.getErrorResponse(r.Errors.Unknown,"no Gadgets found to authorize"))}},{key:"authWithNutaku",value:function(e,t,n,a,o,r){return u.default.clearTokens(),s.default.createAuthRequest("/v1/auth/nutaku",{user_id:e,platform:t.toString(),oauth_token:n,oauth_token_secret:a,autologin_token:o,game_id:this.config.game_id,public_key:this.config.public_key},r)}},{key:"purchaseProduct",value:function(e,t){var n={};n[opensocial.BillingItem.Field.SKU_ID]=e.platform_product_id,n[opensocial.BillingItem.Field.PRICE]=Math.round(e.price),n[opensocial.BillingItem.Field.COUNT]=1,n[opensocial.BillingItem.Field.DESCRIPTION]="item 001",n[nutaku.BillingItem.Field.NAME]="Much Doge1",n[nutaku.BillingItem.Field.IMAGE_URL]=e.icon;var a=opensocial.newBillingItem(n),o={};o[opensocial.Payment.Field.ITEMS]=[a],o[opensocial.Payment.Field.PAYMENT_TYPE]=opensocial.Payment.PaymentType.PAYMENT;var r=opensocial.newPayment(o);console.info("MAKE_PURCHASE",r),opensocial.requestPayment(r,(function(e){if(e.hadError())console.error("ERROR",e),i.default.onCallback(e,null,t);else{var n=e.getData(),a=n.getField(nutaku.Payment.Field.PAYMENT_ID);console.info("INFO> "+a,n),i.default.onCallback(null,e,t)}}))}},{key:"completePurchase",value:function(e){return s.default.createDefaultRequest("/v1/payments/nutaku/complete",{un_order_id:e,user_id:this.nutaku_user_id})}},{key:"claimPurchase",value:function(e){return s.default.createDefaultRequest("/v1/payments/all/claim",{un_order_id:e})}}]),p);function p(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(p.__proto__||Object.getPrototypeOf(p)).call(this,e));if(t.nutaku_user_id=0,"undefined"!=typeof opensocial){var n=opensocial.newDataRequest();n.add(n.newFetchPersonRequest(opensocial.IdSpec.PersonId.VIEWER),"viewer"),n.send((function(e){if(e.hadError())console.error("[NUTAKU] get user info error",e);else{var n=e.get("viewer");if(n.hadError())console.error("[NUTAKU] get item error",n);else{var a=n.getData();t.nutaku_user_id=a.getId(),console.info("USER",a)}}}))}return t}t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=u(n(3)),r=u(n(7)),i=u(n(15));function u(e){return e&&e.__esModule?e:{default:e}}var l=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(s,o.default),function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(s,[{key:"authorize",value:function(e){var t=this;this._initializeVk((function(){t.API.authWithVK(t._getVkUserId(),t._getVkAccessToken(),e),t._autoAuthInNakama()}))}},{key:"_getVkUserId",value:function(){return this.allGetParams.viewer_id}},{key:"_getVkAccessToken",value:function(){return this.allGetParams.access_token}},{key:"_getAdsAppId",value:function(){return this.allGetParams.api_id}},{key:"_autoAuthInNakama",value:function(){r.default.authorizeAsGuest("")}},{key:"getDeviceIdForNakama",value:function(){return"vkontakte_"+this._getVkUserId()}},{key:"_initializeVk",value:function(e){var t=this;window!==top?i.default.loadChainOfScripts([{url:"https://vk.com/js/api/xd_connection.js?2",id:"vk_api"},{url:"https://ad.mail.ru/static/admanhtml/rbadman-html5.min.js",id:"vk_adman"},{url:"https://vk.com/js/api/adman_init.js",id:"vk_adman_init"}],(function(){VK.addCallback("onOrderSuccess",(function(e){console.error("!!onOrderSuccess ",e),t.purchaseCallback&&t._findPendingPurchaseByField("order_id",e,t.purchaseCallback)})),e()})):e&&e()}},{key:"_playRewardedAd",value:function(e){if(0<this.preloadedAds.length){var t=this.preloadedAds.pop();e&&(e.onStarted&&t.onStarted((function(){return e.onStarted()})),e.onCompleted&&t.onCompleted((function(){return e.onCompleted()})),e.onSkipped&&t.onSkipped((function(){return e.onSkipped()})),e.onClicked&&t.onClicked((function(){return e.onClicked()}))),t.start("preroll"),this.preloadRewardedAd()}else this.preloadRewardedAd(e,this._playRewardedAd)}},{key:"preloadRewardedAd",value:function(e,t){var n=this;"undefined"!=typeof admanInit?admanInit({user_id:this._getVkUserId(),app_id:this._getAdsAppId(),type:"rewarded"},(function(a){n.preloadedAds.push(a),t&&t(e)}),(function(){console.error("onNoAds"),e&&e.onNoAds&&e.onNoAds()})):e&&e.onAdBlock&&e.onAdBlock()}},{key:"purchaseProduct",value:function(e,t){this.purchaseCallback=t;var n={type:"item",item:e.platform_product_id};VK.callMethod("showOrderBox",n)}}]),s);function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(s.__proto__||Object.getPrototypeOf(s)).apply(this,arguments))}t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=l(n(3)),r=l(n(7)),i=l(n(15)),u=l(n(11));function l(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var c=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(d,o.default),function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(d,[{key:"authorize",value:function(e){var t=this;this._initializeOk((function(){t.API.authWithOK(t.authData.session_key,t.authData.session_secret_key,e),t._autoAuthInNakama()}))}},{key:"_autoAuthInNakama",value:function(){r.default.authorizeAsGuest("")}},{key:"getDeviceIdForNakama",value:function(){return"odnoklassniki_"+this.allGetParams.logged_user_id}},{key:"_initializeOk",value:function(e){var t=this;window!==top?i.default.loadChainOfScripts([{url:"//api.ok.ru/js/fapi5.js",id:"ok_fapi"}],(function(){t._initFAPI(),e&&e()})):e&&e()}},{key:"_initFAPI",value:function(){var e=this;if("undefined"!=typeof FAPI){var t=FAPI.Util.getRequestParameters();console.info("rParams",t),this.authData=t,FAPI.init(this.authData.api_server,this.authData.apiconnection,(function(){window.API_callback=function(t,n,a){switch(console.info("FAPI method "+t+"; result = "+n+"; data = ",a),t){case"postMediatopic":case"showInvite":break;case"showPayment":"ok"===n&&u.default.restorePurchases(e.purchaseProductCallback);break;case"prepareMidroll":switch(a){case"ready":e.callbackAdIsReady&&e.callbackAdIsReady();break;case"in_use":e.callbackAdStarted&&e.callbackAdStarted();break;default:e.callbackOnNoAds&&e.callbackOnNoAds()}break;case"showMidroll":if("ok"===n)switch(a){case"complete":e.callbackAdCompleted&&e.callbackAdCompleted()}else e.callbackOnNoAds&&e.callbackOnNoAds()}}}),(function(e){alert("Ошибка инициализации")}))}}},{key:"preloadRewardedAd",value:function(e,t){var n=this;this.callbackAdIsReady=function(){n.preloadedAds.push(1),t&&t(e),n.callbackAdIsReady=null},this.callbackOnNoAds=function(){console.warn("onNoAds"),e&&e.onNoAds&&e.onNoAds(),n.callbackOnNoAds=null},FAPI.invokeUIMethod("prepareMidroll")}},{key:"_playRewardedAd",value:function(e){var t=this;e&&(e.onStarted&&(this.callbackAdStarted=function(){e.onStarted(),t.callbackAdStarted=null}),e.onCompleted&&(this.callbackAdCompleted=function(){e.onCompleted(),t.callbackAdCompleted=null})),0<this.preloadedAds.length?(this.preloadedAds.pop(),FAPI.invokeUIMethod("showMidroll"),this.preloadRewardedAd()):this.preloadRewardedAd(e,this._playRewardedAd)}},{key:"purchaseProduct",value:function(e,t){console.info("!!!productInfo ",e),this.purchaseProductCallback=t,FAPI.UI.showPayment(e.name,e.description,e.platform_product_id,e.price,null,null,"ok","true")}}]),d);function d(){var e,t,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d);for(var a=arguments.length,o=Array(a),r=0;r<a;r++)o[r]=arguments[r];return(t=n=s(this,(e=d.__proto__||Object.getPrototypeOf(d)).call.apply(e,[this].concat(o)))).callbackOnNoAds=null,n.callbackAdIsReady=null,n.callbackAdStarted=null,n.callbackAdCompleted=null,s(n,t)}t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=c(n(3)),r=n(0),i=c(r),u=c(n(7)),l=c(n(6)),s=c(n(2));function c(e){return e&&e.__esModule?e:{default:e}}var d=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(f,o.default),function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(f,[{key:"authorize",value:function(e){var t=this;this._initializeFacebook((function(){console.warn("INITIALIZED -> auth: "+t.accessToken),t.API.authWithFB(t.accessToken,e)}))}},{key:"_autoAuthInNakama",value:function(){u.default.authorizeAsGuest("")}},{key:"getDeviceIdForNakama",value:function(){return"facebook_"+this.fbUserID}},{key:"_initializeFacebook",value:function(e){var t,n,a,o,r=this;window!==top?(window.fbAsyncInit=function(){FB.init({appId:r.fb_app_id,cookie:!0,xfbml:!0,version:"v3.3"}),FB.AppEvents.logPageView();var t=function(e){var t={scope:"email"};e&&(t.auth_type="rerequest"),FB.login((function(e){n(e)}),t)},n=function(n){console.info("FB STATUS",n),"connected"===n.status?function(n){r.accessToken=n.authResponse.accessToken,r.fbUserID=n.authResponse.userID,FB.api("/me",{locale:"en_US",fields:"name, picture, email"},(function(n){console.info(n),n.hasOwnProperty("email")?(r.fbUserEmail=n.email,r.fbUserName=n.name,e&&e()):t(!0)}))}(n):t()};FB.getLoginStatus((function(e){n(e)}))},n="facebook-jssdk",a=void 0,o=(t=document).getElementsByTagName("script")[0],t.getElementById(n)||((a=t.createElement("script")).id=n,a.src="https://connect.facebook.net/en_US/sdk.js",o.parentNode.insertBefore(a,o))):e&&e()}},{key:"purchaseProduct",value:function(e,t){var n=this;FB.ui({method:"pay",action:"purchaseiap",product_id:e.platform_product_id,developer_payload:"this_is_a_test_payload"},(function(e){console.info("**PURCHASE",e),n._prepareAndSendPurchaseResponse(e,t)}))}},{key:"completePurchase",value:function(e,t){var n=this.tempDict[e];if(!n)return t(i.default.getErrorResponse(r.Errors.PaymentFailed,"Temp info wasn't found"));l.default.createDefaultRequest("/v2/payments/fb/complete",{signed_request:n.signed_request,purchase_token:n.purchase_token},t)}},{key:"_prepareAndSendPurchaseResponse",value:function(e,t){if(e.signed_request&&e.purchase_token){var n=this.tempPurchaseId--;this.tempDict[n]=e,t(i.default.getSuccessResponse({id:n}))}else t(i.default.getErrorResponse(r.Errors.PaymentFailed,e.error_code+":"+e.error_message))}},{key:"getPurchases",value:function(e,t){var n=this;e===s.default.PurchaseStatusFilter.PENDING&&FB.api("/app/purchases","get",{access_token:this.accessToken},(function(e){console.log("purchases payload:",e),e.data&&function(){var a=[],o=!0,r=!1,u=void 0;try{for(var l,s=e.data[Symbol.iterator]();!(o=(l=s.next()).done);o=!0){var c=l.value;n._prepareAndSendPurchaseResponse(c,(function(e){e.success&&a.push({id:e.data.id})}))}}catch(o){r=!0,u=o}finally{try{!o&&s.return&&s.return()}finally{if(r)throw u}}var d=i.default.getSuccessResponse(a);t(d)}()}))}}]),f);function f(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,e));return t.fb_app_id=e.config.fb_app_id,t.tempPurchaseId=-1,t.tempDict={},t}t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=u(n(3)),r=u(n(8)),i=u(n(1));function u(e){return e&&e.__esModule?e:{default:e}}var l=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(s,o.default),function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(s,[{key:"authorize",value:function(e){this._initializeFacebook((function(){console.warn("INITIALIZED -> auth"),r.default.authorize("test_user1","test_password",e)}))}},{key:"_initializeFacebook",value:function(e){var t,n,a,o;window===top?e&&e():(n="facebook-jssdk",a=void 0,o=(t=document).getElementsByTagName("script")[0],t.getElementById(n)||((a=t.createElement("script")).id=n,a.src="https://connect.facebook.net/en_US/fbinstant.6.3.js",a.onload=function(){"undefined"!=typeof FBInstant?FBInstant.initializeAsync().then((function(){function t(){FBInstant.startGameAsync().then((function(){FBInstant.context.getID(),FBInstant.context.getType();var t=FBInstant.player.getPhoto();this.fbUserID=FBInstant.player.getID(),this.fbUserName=FBInstant.player.getName(),console.info("PLAYERID "+this.fbUserID+" <> "+this.fbUserName,t),e&&e()})).catch((function(e){console.error("Failed to startGameAsync",e)}))}i.default.onLoadingProgress?i.default.onLoadingProgress((function(e){FBInstant.setLoadingProgress(e)}),t):t()})).catch((function(e){console.error("Failed to initializeAsync",e)})):e&&e()},o.parentNode.insertBefore(a,o)))}}]),s);function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(s.__proto__||Object.getPrototypeOf(s)).apply(this,arguments))}t.default=l},function(e,t,n){"use strict";(function(e){var n,a,o,r,i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};window,r=function(){return function(e){var t=window.webpackHotUpdateUnnyAdmin;window.webpackHotUpdateUnnyAdmin=function(e,n){!function(e,t){if(k[e]&&g[e]){for(var n in g[e]=!1,t)Object.prototype.hasOwnProperty.call(t,n)&&(v[n]=t[n]);0==--m&&0===_&&A()}}(e,n),t&&t(e,n)};var n,a=!0,o="222703fd7b689a678937",r=1e4,u={},l=[],s=[];function c(e){var t=R[e];if(!t)return E;function a(a){return t.hot.active?(R[a]?-1===R[a].parents.indexOf(e)&&R[a].parents.push(e):(l=[e],n=a),-1===t.children.indexOf(a)&&t.children.push(a)):(console.warn("[HMR] unexpected require("+a+") from disposed module "+e),l=[]),E(a)}function o(e){return{configurable:!0,enumerable:!0,get:function(){return E[e]},set:function(t){E[e]=t}}}for(var r in E)Object.prototype.hasOwnProperty.call(E,r)&&"e"!==r&&"t"!==r&&Object.defineProperty(a,r,o(r));return a.e=function(e){return"ready"===f&&p("prepare"),_++,E.e(e).then(t,(function(e){throw t(),e}));function t(){_--,"prepare"===f&&(b[e]||O(e),0===_&&0===m&&A())}},a.t=function(e,t){return 1&t&&(e=a(e)),E.t(e,-2&t)},a}var d=[],f="idle";function p(e){f=e;for(var t=0;t<d.length;t++)d[t].call(null,e)}var h,v,y,m=0,_=0,b={},g={},k={};function w(e){return+e+""===e?+e:e}function P(e){if("idle"!==f)throw new Error("check() is only allowed in idle status");return a=e,p("check"),(t=(t=r)||1e4,new Promise((function(e,n){if("undefined"==typeof XMLHttpRequest)return n(new Error("No browser support"));try{var a=new XMLHttpRequest,r=E.p+""+o+".hot-update.json";a.open("GET",r,!0),a.timeout=t,a.send(null)}catch(e){return n(e)}a.onreadystatechange=function(){if(4===a.readyState)if(0===a.status)n(new Error("Manifest request to "+r+" timed out."));else if(404===a.status)e();else if(200!==a.status&&304!==a.status)n(new Error("Manifest request to "+r+" failed."));else{try{var t=JSON.parse(a.responseText)}catch(t){return void n(t)}e(t)}}}))).then((function(e){if(!e)return p("idle"),null;g={},b={},k=e.c,y=e.h,p("prepare");var t=new Promise((function(e,t){h={resolve:e,reject:t}}));return v={},O(0),"prepare"===f&&0===_&&0===m&&A(),t}));var t}function O(e){var t,n;k[e]?(g[e]=!0,m++,t=e,(n=document.createElement("script")).charset="utf-8",n.src=E.p+""+t+"."+o+".hot-update.js",document.head.appendChild(n)):b[e]=!0}function A(){p("ready");var e=h;if(h=null,e)if(a)Promise.resolve().then((function(){return C(a)})).then((function(t){e.resolve(t)}),(function(t){e.reject(t)}));else{var t=[];for(var n in v)Object.prototype.hasOwnProperty.call(v,n)&&t.push(w(n));e.resolve(t)}}function C(t){if("ready"!==f)throw new Error("apply() is only allowed in ready status");var n,a,r,i,s;function c(e){for(var t=[e],n={},a=t.map((function(e){return{chain:[e],id:e}}));0<a.length;){var o=a.pop(),r=o.id,u=o.chain;if((i=R[r])&&!i.hot._selfAccepted){if(i.hot._selfDeclined)return{type:"self-declined",chain:u,moduleId:r};if(i.hot._main)return{type:"unaccepted",chain:u,moduleId:r};for(var l=0;l<i.parents.length;l++){var s=i.parents[l],c=R[s];if(c){if(c.hot._declinedDependencies[r])return{type:"declined",chain:u.concat([s]),moduleId:r,parentId:s};-1===t.indexOf(s)&&(c.hot._acceptedDependencies[r]?(n[s]||(n[s]=[]),d(n[s],[r])):(delete n[s],t.push(s),a.push({chain:u.concat([s]),id:s})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:n}}function d(e,t){for(var n=0;n<t.length;n++){var a=t[n];-1===e.indexOf(a)&&e.push(a)}}function h(){console.warn("[HMR] unexpected require("+P.moduleId+") to disposed module")}t=t||{};var m={},_=[],b={};for(var g in v)if(Object.prototype.hasOwnProperty.call(v,g)){var P;s=w(g);var O=!1,A=!1,C=!1,I="";switch((P=v[g]?c(s):{type:"disposed",moduleId:g}).chain&&(I="\nUpdate propagation: "+P.chain.join(" -> ")),P.type){case"self-declined":t.onDeclined&&t.onDeclined(P),t.ignoreDeclined||(O=new Error("Aborted because of self decline: "+P.moduleId+I));break;case"declined":t.onDeclined&&t.onDeclined(P),t.ignoreDeclined||(O=new Error("Aborted because of declined dependency: "+P.moduleId+" in "+P.parentId+I));break;case"unaccepted":t.onUnaccepted&&t.onUnaccepted(P),t.ignoreUnaccepted||(O=new Error("Aborted because "+s+" is not accepted"+I));break;case"accepted":t.onAccepted&&t.onAccepted(P),A=!0;break;case"disposed":t.onDisposed&&t.onDisposed(P),C=!0;break;default:throw new Error("Unexception type "+P.type)}if(O)return p("abort"),Promise.reject(O);if(A)for(s in b[s]=v[s],d(_,P.outdatedModules),P.outdatedDependencies)Object.prototype.hasOwnProperty.call(P.outdatedDependencies,s)&&(m[s]||(m[s]=[]),d(m[s],P.outdatedDependencies[s]));C&&(d(_,[P.moduleId]),b[s]=h)}var S,T=[];for(a=0;a<_.length;a++)s=_[a],R[s]&&R[s].hot._selfAccepted&&b[s]!==h&&T.push({module:s,errorHandler:R[s].hot._selfAccepted});p("dispose"),Object.keys(k).forEach((function(e){!1===k[e]&&delete installedChunks[e]}));for(var N,D,q=_.slice();0<q.length;)if(s=q.pop(),i=R[s]){var j={},F=i.hot._disposeHandlers;for(r=0;r<F.length;r++)(n=F[r])(j);for(u[s]=j,i.hot.active=!1,delete R[s],delete m[s],r=0;r<i.children.length;r++){var M=R[i.children[r]];M&&0<=(S=M.parents.indexOf(s))&&M.parents.splice(S,1)}}for(s in m)if(Object.prototype.hasOwnProperty.call(m,s)&&(i=R[s]))for(D=m[s],r=0;r<D.length;r++)N=D[r],0<=(S=i.children.indexOf(N))&&i.children.splice(S,1);for(s in p("apply"),o=y,b)Object.prototype.hasOwnProperty.call(b,s)&&(e[s]=b[s]);var U=null;for(s in m)if(Object.prototype.hasOwnProperty.call(m,s)&&(i=R[s])){D=m[s];var G=[];for(a=0;a<D.length;a++)if(N=D[a],n=i.hot._acceptedDependencies[N]){if(-1!==G.indexOf(n))continue;G.push(n)}for(a=0;a<G.length;a++){n=G[a];try{n(D)}catch(n){t.onErrored&&t.onErrored({type:"accept-errored",moduleId:s,dependencyId:D[a],error:n}),t.ignoreErrored||(U=U||n)}}}for(a=0;a<T.length;a++){var L=T[a];s=L.module,l=[s];try{E(s)}catch(a){if("function"==typeof L.errorHandler)try{L.errorHandler(a)}catch(n){t.onErrored&&t.onErrored({type:"self-accept-error-handler-errored",moduleId:s,error:n,originalError:a}),t.ignoreErrored||(U=U||n),U=U||a}else t.onErrored&&t.onErrored({type:"self-accept-errored",moduleId:s,error:a}),t.ignoreErrored||(U=U||a)}}return U?(p("fail"),Promise.reject(U)):(p("idle"),new Promise((function(e){e(_)})))}var R={};function E(t){if(R[t])return R[t].exports;var a,o=R[t]={i:t,l:!1,exports:{},hot:(a={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:n!==t,active:!0,accept:function(e,t){if(void 0===e)a._selfAccepted=!0;else if("function"==typeof e)a._selfAccepted=e;else if("object"==(void 0===e?"undefined":i(e)))for(var n=0;n<e.length;n++)a._acceptedDependencies[e[n]]=t||function(){};else a._acceptedDependencies[e]=t||function(){}},decline:function(e){if(void 0===e)a._selfDeclined=!0;else if("object"==(void 0===e?"undefined":i(e)))for(var t=0;t<e.length;t++)a._declinedDependencies[e[t]]=!0;else a._declinedDependencies[e]=!0},dispose:function(e){a._disposeHandlers.push(e)},addDisposeHandler:function(e){a._disposeHandlers.push(e)},removeDisposeHandler:function(e){var t=a._disposeHandlers.indexOf(e);0<=t&&a._disposeHandlers.splice(t,1)},check:P,apply:C,status:function(e){if(!e)return f;d.push(e)},addStatusHandler:function(e){d.push(e)},removeStatusHandler:function(e){var t=d.indexOf(e);0<=t&&d.splice(t,1)},data:u[t]},n=void 0,a),parents:(s=l,l=[],s),children:[]};return e[t].call(o.exports,o,o.exports,c(t)),o.l=!0,o.exports}return E.m=e,E.c=R,E.d=function(e,t,n){E.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},E.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},E.t=function(e,t){if(1&t&&(e=E(e)),8&t)return e;if(4&t&&"object"==(void 0===e?"undefined":i(e))&&e&&e.__esModule)return e;var n=Object.create(null);if(E.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)E.d(n,a,function(t){return e[t]}.bind(null,a));return n},E.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return E.d(t,"a",t),t},E.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},E.p="",E.h=function(){return o},c(0)(E.s=0)}([function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var a,o=(a=n(1))&&a.__esModule?a:{default:a};t.default={UnnyRGC:o.default}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.Errors=void 0;var a="function"==typeof Symbol&&"symbol"==i(Symbol.iterator)?function(e){return void 0===e?"undefined":i(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":i(e)};function o(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var r=l(n(2)),u=l(n(3));function l(e){return e&&e.__esModule?e:{default:e}}var s,c,d="name",f="version",p=t.Errors={FAILED_DOWNLOAD_VERSIONS:1e3,FAILED_DOWNLOAD_DICTIONARY:1001,PARSING_ERROR:1002},h=0,v=1,y=(c=[{key:"_sendFailedCallback",value:function(e,t,n){e({success:!1,error:{code:t,message:n}})}},{key:"initialize",value:function(e,t){return(m.instance=new m)._initialize(e.game_id,t),m.instance}}],o((s=m).prototype,[{key:"_getFileExtension",value:function(){return".json"}},{key:"_downloadNextDictionary",value:function(){function e(e){var n=t.allDictionaries[e];if(n.status===v){var a=t.downloadUrl+n[d]+(n.version?"_v"+n.version:"")+t._getFileExtension();return m.instance.downloader.loadJson(a,(function(e){e.success?(n.value=e.data,n.status=h,t.db.saveDictionary(n[d],n.value,n[f]),t._downloadNextDictionary()):(e.error.code=p.FAILED_DOWNLOAD_DICTIONARY,t.callback(e))})),{v:void 0}}}var t=this;for(var n in this.allDictionaries){var o=e(n);if("object"===(void 0===o?"undefined":a(o)))return o.v}this.callback&&(this.callback({success:!0}),this.callback=null)}},{key:"_initialize",value:function(e,t){var n=this;this.callback=t,this.db=new u.default("UNNY_RGC_"+e,2),this.downloadUrl="https://dictionaries-unnynet.fra1.cdn.digitaloceanspaces.com/dictionaries/"+e+"/";var a="https://dictionaries-unnynet.fra1.digitaloceanspaces.com/dictionaries/"+e+"/versions"+this._getFileExtension()+"?timestamp="+Math.trunc((new Date).getTime());m.instance.downloader.loadJson(a,(function(e){if(e.success){var a=e.data.dictionaries;a?n.db.waitForTheConnection((function(){for(var e=a.length,t=function(t){var o=a[t],r=o[d];n.db.loadDictionary(r,(function(t){o[f]<=(t?t.version:-1)&&t.value?(o.status=h,o.value=t.value):o.status=v,n.allDictionaries[o.name]=o,0==--e&&n._downloadNextDictionary()}))},o=0;o<a.length;o++)t(o)})):m._sendFailedCallback(t,p.PARSING_ERROR,e.data.toString())}else e.error.code=p.FAILED_DOWNLOAD_VERSIONS,t(e)}))}},{key:"getDictionary",value:function(e){return this.allDictionaries.hasOwnProperty(e)?this.allDictionaries[e].value:null}}]),o(s,c),m);function m(){!function(e){if(!(e instanceof m))throw new TypeError("Cannot call a class as a function")}(this),this.downloader=new r.default,this.allDictionaries=[]}t.default=y},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}(o.prototype,[{key:"loadJson",value:function(e,t){fetch(e).then((function(e){return e.json()})).then((function(e){return t({success:!0,data:e})})).catch((function(e){return t({success:!1,error:{message:e.toString()}})}))}}]),o);function o(){!function(e){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}(this)}t.default=a},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var a=0,o=-1,r=2,i=3,u="all_dictionaries",l=(function(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}(s.prototype,[{key:"_callCallback",value:function(){this.callback&&(this.callback(this.isActive()),this.callback=null)}},{key:"waitForTheConnection",value:function(e){this.callback=e,this.dbState!==r&&this._callCallback()}},{key:"saveDictionary",value:function(e,t,n){if(this.isActive())try{this.db.transaction([u],"readwrite").objectStore(u).put({name:e,value:t,version:n}).onerror=function(t){console.error("Failed to save "+e,t)}}catch(t){console.error("Something went wrong during saving",t)}}},{key:"loadDictionary",value:function(e,t){if(this.isActive())try{var n=this.db.transaction([u],"readonly").objectStore(u).get(e);n.onerror=function(n){console.error("couldn't load dictionary "+e,n),t(null)},n.onsuccess=function(){t(n.result)}}catch(n){console.error("Something went wrong during loading",n),t(null)}}},{key:"isActive",value:function(){return this.dbState===i}}]),s);function s(e,t){var n=this;if(function(e){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}(this),this.dbSupport=!!window.indexedDB,this.dbSupport){this.dbState=r;var l=window.indexedDB.open(e,t);l.onerror=function(e){console.error("Couldn't connect to DB",l.errorCode),n.dbState=a,n._callCallback()},l.onsuccess=function(e){n.db=e.target.result,n.dbState=i,n._callCallback()},l.onupgradeneeded=function(e){n.db=e.target.result,n.db.createObjectStore(u,{keyPath:"name"})}}else console.error("IndexedDB isn't supported"),this.dbState=o}t.default=l}]).default},"object"==i(t)&&"object"==i(e)?e.exports=r():(a=[],void 0===(o="function"==typeof(n=r)?n.apply(t,a):n)||(e.exports=o))}).call(this,n(28)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=i(n(4)),r=i(n(0));function i(e){return e&&e.__esModule?e:{default:e}}var u=(function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(l,null,[{key:"reportLeaderboardScore",value:function(e,t,n,a){var i=n?encodeURIComponent(n):"";o.default.evalCodeDelayed(r.default.Command.ReportLeaderboardScoresAsync,a,e,t,i)}},{key:"getLeaderboardScores",value:function(e,t){o.default.evalCodeAdvanced(r.default.Command.GetLeaderboardScores,t,e)}},{key:"reportAchievementProgress",value:function(e,t,n){o.default.evalCodeDelayed(r.default.Command.ReportAchievementProgressAsync,n,e,t)}},{key:"getAchievementsInfo",value:function(e){o.default.evalCodeAdvanced(r.default.Command.GetAchievementsInfo,e)}},{key:"addGuildExperience",value:function(e,t){o.default.evalCode(r.default.Command.AddGuildExperience,t,e)}},{key:"getGuildInfo",value:function(e,t){o.default.evalCodeAdvanced(r.default.Command.GetGuildInfo,t,e?1:0)}}]),l);function l(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l)}t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=i(n(4)),r=i(n(0));function i(e){return e&&e.__esModule?e:{default:e}}var u=(function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(l,null,[{key:"sendMessageToChannel",value:function(e,t,n){t&&o.default.evalCode(r.default.Command.SendMessage,n,e,t)}},{key:"joinPrivateChannel",value:function(e,t,n){o.default.evalCodeDelayed(r.default.Command.JoinPrivateChannel,n,e,t)}},{key:"leaveAllPrivateChannels",value:function(e){o.default.evalCodeDelayed(r.default.Command.LeaveAllPrivateChannels,e)}}]),l);function l(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l)}t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=u(n(4)),r=u(n(1)),i=u(n(0));function u(e){return e&&e.__esModule?e:{default:e}}var l=(function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(s,null,[{key:"init",value:function(e){r.default.initialize(e)}},{key:"open",value:function(){r.default.openUnnyNet()}},{key:"close",value:function(){r.default.closeUnnyNet()}},{key:"openLeaderboards",value:function(e){o.default.openWindow(i.default.Command.OpenLeaderBoards,e)}},{key:"openAchievements",value:function(e){o.default.openWindow(i.default.Command.OpenAchievements,e)}},{key:"openFriends",value:function(e){o.default.openWindow(i.default.Command.OpenFriends,e)}},{key:"openChannel",value:function(e,t){o.default.evalCodeAndOpen(i.default.Command.OpenChannel,t,e)}},{key:"openGuilds",value:function(e){o.default.openWindow(i.default.Command.OpenGuilds,e)}},{key:"openMyGuild",value:function(e){o.default.openWindow(i.default.Command.OpenMyGuild,e)}},{key:"setFrame",value:function(e){r.default.setFrame(e)}},{key:"setCloseButtonVisible",value:function(e){r.default.setCloseButtonVisible(e)}},{key:"getPlayerPublicInfo",value:function(e){o.default.evalCodeAdvanced(i.default.Command.GetPlayerPublicInfo,e)}}]),s);function s(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s)}t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=t.ButtonType={Primary:"Primary",Secondary:"Secondary",Success:"Success",Info:"Info",Warning:"Warning",Danger:"Danger"},r=(function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(i,[{key:"addButton",value:function(e,t,n){var a=2<arguments.length&&void 0!==n?n:o.Primary;this.allButtons.push({id:i._buttonInstance++,title:e,type:a}),this.allButtonsAction.push(t)}},{key:"parse",value:function(){var e=JSON.stringify(this.allButtons);return console.log("> "+e),'{"buttons": '+e+"}"}},{key:"buttonClicked",value:function(e){for(var t=0;t<this.allButtons.length;t++)if(this.allButtons[t].id===e){var n=this.allButtonsAction[t];n&&n();break}}}]),i);function i(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(i.activePopup=this).allButtons=[],this.allButtonsAction=[]}r._buttonInstance=0,t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o,r=(o=n(1))&&o.__esModule?o:{default:o},i=(function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(u,null,[{key:"playRewardedAd",value:function(e){r.default.getSocialPlatform().playRewardedAd(e)}}]),u);function u(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u)}t.default=i}]).default}));